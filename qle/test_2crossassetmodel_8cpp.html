<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<title>QuantExt: test/crossassetmodel.cpp File Reference</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="quantextextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-qle@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.10</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_13e138d54eb8818da29c3992edef070a.html">test</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">crossassetmodel.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="toplevelfixture_8hpp_source.html">toplevelfixture.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="utilities_8hpp_source.html">utilities.hpp</a>&quot;</code><br />
<code>#include &lt;boost/test/unit_test.hpp&gt;</code><br />
<code>#include &lt;boost/test/data/test_case.hpp&gt;</code><br />
<code>#include &lt;<a class="el" href="multipathgeneratorbase_8hpp_source.html">qle/methods/multipathgeneratorbase.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="cdsoptionhelper_8hpp_source.html">qle/models/cdsoptionhelper.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="cirppconstantfellerparametrization_8hpp_source.html">qle/models/cirppconstantfellerparametrization.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="commodityschwartzmodel_8hpp_source.html">qle/models/commodityschwartzmodel.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="commodityschwartzparametrization_8hpp_source.html">qle/models/commodityschwartzparametrization.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="cpicapfloorhelper_8hpp_source.html">qle/models/cpicapfloorhelper.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="crlgm1fparametrization_8hpp_source.html">qle/models/crlgm1fparametrization.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="crossassetanalytics_8hpp_source.html">qle/models/crossassetanalytics.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="crossassetanalyticsbase_8hpp_source.html">qle/models/crossassetanalyticsbase.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="crossassetmodel_8hpp_source.html">qle/models/crossassetmodel.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="crossassetmodelimpliedeqvoltermstructure_8hpp_source.html">qle/models/crossassetmodelimpliedeqvoltermstructure.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="crossassetmodelimpliedfxvoltermstructure_8hpp_source.html">qle/models/crossassetmodelimpliedfxvoltermstructure.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="dkimpliedyoyinflationtermstructure_8hpp_source.html">qle/models/dkimpliedyoyinflationtermstructure.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="dkimpliedzeroinflationtermstructure_8hpp_source.html">qle/models/dkimpliedzeroinflationtermstructure.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="eqbsconstantparametrization_8hpp_source.html">qle/models/eqbsconstantparametrization.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="eqbsparametrization_8hpp_source.html">qle/models/eqbsparametrization.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="eqbspiecewiseconstantparametrization_8hpp_source.html">qle/models/eqbspiecewiseconstantparametrization.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="fxbsconstantparametrization_8hpp_source.html">qle/models/fxbsconstantparametrization.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="fxbsparametrization_8hpp_source.html">qle/models/fxbsparametrization.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="fxbspiecewiseconstantparametrization_8hpp_source.html">qle/models/fxbspiecewiseconstantparametrization.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="fxeqoptionhelper_8hpp_source.html">qle/models/fxeqoptionhelper.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="gaussian1dcrossassetadaptor_8hpp_source.html">qle/models/gaussian1dcrossassetadaptor.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="infdkparametrization_8hpp_source.html">qle/models/infdkparametrization.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="irlgm1fconstantparametrization_8hpp_source.html">qle/models/irlgm1fconstantparametrization.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="irlgm1fparametrization_8hpp_source.html">qle/models/irlgm1fparametrization.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="irlgm1fpiecewiseconstanthullwhiteadaptor_8hpp_source.html">qle/models/irlgm1fpiecewiseconstanthullwhiteadaptor.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="irlgm1fpiecewiseconstantparametrization_8hpp_source.html">qle/models/irlgm1fpiecewiseconstantparametrization.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="irlgm1fpiecewiselinearparametrization_8hpp_source.html">qle/models/irlgm1fpiecewiselinearparametrization.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="jyimpliedzeroinflationtermstructure_8hpp_source.html">qle/models/jyimpliedzeroinflationtermstructure.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="lgm_8hpp_source.html">qle/models/lgm.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="lgmimplieddefaulttermstructure_8hpp_source.html">qle/models/lgmimplieddefaulttermstructure.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="lgmimpliedyieldtermstructure_8hpp_source.html">qle/models/lgmimpliedyieldtermstructure.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="linkablecalibratedmodel_8hpp_source.html">qle/models/linkablecalibratedmodel.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="parametrization_8hpp_source.html">qle/models/parametrization.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="piecewiseconstanthelper_8hpp_source.html">qle/models/piecewiseconstanthelper.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="pseudoparameter_8hpp_source.html">qle/models/pseudoparameter.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="analyticcclgmfxoptionengine_8hpp_source.html">qle/pricingengines/analyticcclgmfxoptionengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="analyticdkcpicapfloorengine_8hpp_source.html">qle/pricingengines/analyticdkcpicapfloorengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="analyticlgmcdsoptionengine_8hpp_source.html">qle/pricingengines/analyticlgmcdsoptionengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="analyticlgmswaptionengine_8hpp_source.html">qle/pricingengines/analyticlgmswaptionengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="analyticxassetlgmeqoptionengine_8hpp_source.html">qle/pricingengines/analyticxassetlgmeqoptionengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="blackcdsoptionengine_8hpp_source.html">qle/pricingengines/blackcdsoptionengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="crossccyswapengine_8hpp_source.html">qle/pricingengines/crossccyswapengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="depositengine_8hpp_source.html">qle/pricingengines/depositengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="discountingcommodityforwardengine_8hpp_source.html">qle/pricingengines/discountingcommodityforwardengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="discountingcurrencyswapengine_8hpp_source.html">qle/pricingengines/discountingcurrencyswapengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="discountingequityforwardengine_8hpp_source.html">qle/pricingengines/discountingequityforwardengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="discountingfxforwardengine_8hpp_source.html">qle/pricingengines/discountingfxforwardengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="discountingriskybondengine_8hpp_source.html">qle/pricingengines/discountingriskybondengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="discountingswapenginemulticurve_8hpp_source.html">qle/pricingengines/discountingswapenginemulticurve.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="numericlgmmultilegoptionengine_8hpp_source.html">qle/pricingengines/numericlgmmultilegoptionengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="oiccbasisswapengine_8hpp_source.html">qle/pricingengines/oiccbasisswapengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="paymentdiscountingengine_8hpp_source.html">qle/pricingengines/paymentdiscountingengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="commodityschwartzstateprocess_8hpp_source.html">qle/processes/commodityschwartzstateprocess.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="crossassetstateprocess_8hpp_source.html">qle/processes/crossassetstateprocess.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="irlgm1fstateprocess_8hpp_source.html">qle/processes/irlgm1fstateprocess.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="pricecurve_8hpp_source.html">qle/termstructures/pricecurve.hpp</a>&gt;</code><br />
<code>#include &lt;ql/currencies/america.hpp&gt;</code><br />
<code>#include &lt;ql/currencies/europe.hpp&gt;</code><br />
<code>#include &lt;ql/indexes/ibor/euribor.hpp&gt;</code><br />
<code>#include &lt;ql/indexes/ibor/gbplibor.hpp&gt;</code><br />
<code>#include &lt;ql/indexes/ibor/usdlibor.hpp&gt;</code><br />
<code>#include &lt;ql/indexes/inflation/euhicp.hpp&gt;</code><br />
<code>#include &lt;ql/indexes/inflation/ukrpi.hpp&gt;</code><br />
<code>#include &lt;ql/instruments/cpicapfloor.hpp&gt;</code><br />
<code>#include &lt;ql/instruments/vanillaoption.hpp&gt;</code><br />
<code>#include &lt;ql/math/optimization/levenbergmarquardt.hpp&gt;</code><br />
<code>#include &lt;ql/math/randomnumbers/rngtraits.hpp&gt;</code><br />
<code>#include &lt;ql/math/statistics/incrementalstatistics.hpp&gt;</code><br />
<code>#include &lt;ql/methods/montecarlo/multipathgenerator.hpp&gt;</code><br />
<code>#include &lt;ql/methods/montecarlo/pathgenerator.hpp&gt;</code><br />
<code>#include &lt;ql/models/shortrate/calibrationhelpers/swaptionhelper.hpp&gt;</code><br />
<code>#include &lt;ql/models/shortrate/onefactormodels/gsr.hpp&gt;</code><br />
<code>#include &lt;ql/pricingengines/swaption/gaussian1dswaptionengine.hpp&gt;</code><br />
<code>#include &lt;ql/pricingengines/credit/midpointcdsengine.hpp&gt;</code><br />
<code>#include &lt;ql/quotes/simplequote.hpp&gt;</code><br />
<code>#include &lt;ql/termstructures/credit/flathazardrate.hpp&gt;</code><br />
<code>#include &lt;ql/termstructures/inflation/interpolatedzeroinflationcurve.hpp&gt;</code><br />
<code>#include &lt;ql/termstructures/inflationtermstructure.hpp&gt;</code><br />
<code>#include &lt;ql/termstructures/yield/flatforward.hpp&gt;</code><br />
<code>#include &lt;ql/time/calendars/target.hpp&gt;</code><br />
<code>#include &lt;ql/time/daycounters/actual360.hpp&gt;</code><br />
<code>#include &lt;ql/time/daycounters/thirty360.hpp&gt;</code><br />
<code>#include &lt;boost/make_shared.hpp&gt;</code><br />
<code>#include &lt;boost/accumulators/accumulators.hpp&gt;</code><br />
<code>#include &lt;boost/accumulators/statistics/covariance.hpp&gt;</code><br />
<code>#include &lt;boost/accumulators/statistics/error_of_mean.hpp&gt;</code><br />
<code>#include &lt;boost/accumulators/statistics/mean.hpp&gt;</code><br />
<code>#include &lt;boost/accumulators/statistics/stats.hpp&gt;</code><br />
<code>#include &lt;boost/accumulators/statistics/variates/covariate.hpp&gt;</code><br />
</div>
<p><a href="test_2crossassetmodel_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5186ce7bb509123ef0fc2709e0b6267f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a5186ce7bb509123ef0fc2709e0b6267f">BOOST_AUTO_TEST_CASE</a> (testBermudanLgm1fGsr)</td></tr>
<tr class="separator:a5186ce7bb509123ef0fc2709e0b6267f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4af3e4a9624e0a8c86929b767c248912"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a4af3e4a9624e0a8c86929b767c248912">BOOST_AUTO_TEST_CASE</a> (testBermudanLgmInvariances)</td></tr>
<tr class="separator:a4af3e4a9624e0a8c86929b767c248912"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1521fc86e1270fe62fc0441a30345aa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#ae1521fc86e1270fe62fc0441a30345aa">BOOST_AUTO_TEST_CASE</a> (testNonstandardBermudanSwaption)</td></tr>
<tr class="separator:ae1521fc86e1270fe62fc0441a30345aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2328effe637801c2b45b6beb2b97840b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a2328effe637801c2b45b6beb2b97840b">BOOST_AUTO_TEST_CASE</a> (testLgm1fCalibration)</td></tr>
<tr class="separator:a2328effe637801c2b45b6beb2b97840b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a852d7254bff61434239cbe761e6a71"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a0a852d7254bff61434239cbe761e6a71">BOOST_AUTO_TEST_CASE</a> (testCcyLgm3fForeignPayouts)</td></tr>
<tr class="separator:a0a852d7254bff61434239cbe761e6a71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa805d3226078c812c44a7e7c967b3118"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#aa805d3226078c812c44a7e7c967b3118">BOOST_AUTO_TEST_CASE</a> (testLgm5fFxCalibration)</td></tr>
<tr class="separator:aa805d3226078c812c44a7e7c967b3118"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac898aef27142112ab0445cb7be80c42e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#ac898aef27142112ab0445cb7be80c42e">BOOST_AUTO_TEST_CASE</a> (testLgm5fFullCalibration)</td></tr>
<tr class="separator:ac898aef27142112ab0445cb7be80c42e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac803ea58b611f2153da35dc43b96444a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#ac803ea58b611f2153da35dc43b96444a">BOOST_AUTO_TEST_CASE</a> (testLgm5fMoments)</td></tr>
<tr class="separator:ac803ea58b611f2153da35dc43b96444a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae727668e620dbe4a01fafc4b6f038954"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#ae727668e620dbe4a01fafc4b6f038954">BOOST_AUTO_TEST_CASE</a> (testLgmGsrEquivalence)</td></tr>
<tr class="separator:ae727668e620dbe4a01fafc4b6f038954"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4be9b6573285ff076d712d27f3cf5b99"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a4be9b6573285ff076d712d27f3cf5b99">BOOST_AUTO_TEST_CASE</a> (testLgmMcWithShift)</td></tr>
<tr class="separator:a4be9b6573285ff076d712d27f3cf5b99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27aa91f8a54f4e16c2108c81069baad0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a27aa91f8a54f4e16c2108c81069baad0">BOOST_AUTO_TEST_CASE</a> (testIrFxCrCirppMartingaleProperty)</td></tr>
<tr class="separator:a27aa91f8a54f4e16c2108c81069baad0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5f98fe0b75d1c67826a58638cdc792f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#aa5f98fe0b75d1c67826a58638cdc792f">BOOST_AUTO_TEST_CASE</a> (testIrFxCrMoments)</td></tr>
<tr class="separator:aa5f98fe0b75d1c67826a58638cdc792f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c37030f2044afb608c297cfd4e7489a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a9c37030f2044afb608c297cfd4e7489a">BOOST_AUTO_TEST_CASE</a> (testIrFxCrCorrelationRecovery)</td></tr>
<tr class="separator:a9c37030f2044afb608c297cfd4e7489a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fd0420762b02abebd65319a1db321a9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a1fd0420762b02abebd65319a1db321a9">BOOST_DATA_TEST_CASE</a> (testIrFxInfCrComMartingaleProperty, bdata::make(<a class="el" href="test_2crossassetmodel_8cpp.html#aa848a14c24baafa9e714abd087d2062b">infEurFlags</a>) *bdata::make(<a class="el" href="test_2crossassetmodel_8cpp.html#aabb2919210687ea5ff99ba34f08dd185">infGbpFlags</a>) *bdata::make(<a class="el" href="test_2crossassetmodel_8cpp.html#a6cd3e0f20d5d2ffb978002d671c329dc">flatVolsFlags</a>) *bdata::make(<a class="el" href="test_2commodityschwartzmodel_8cpp.html#a391af7283d1ddfef2b73086f39b487dd">driftFreeState</a>), infEurIsDk, infGbpIsDk, flatVols, <a class="el" href="test_2commodityschwartzmodel_8cpp.html#a391af7283d1ddfef2b73086f39b487dd">driftFreeState</a>)</td></tr>
<tr class="separator:a1fd0420762b02abebd65319a1db321a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a845ff59e670b87ff4d3abec50e3273c9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a845ff59e670b87ff4d3abec50e3273c9">BOOST_DATA_TEST_CASE</a> (testIrFxInfCrComMoments, bdata::make(<a class="el" href="test_2crossassetmodel_8cpp.html#aa848a14c24baafa9e714abd087d2062b">infEurFlags</a>) *bdata::make(<a class="el" href="test_2crossassetmodel_8cpp.html#aabb2919210687ea5ff99ba34f08dd185">infGbpFlags</a>) *bdata::make(<a class="el" href="test_2crossassetmodel_8cpp.html#a6cd3e0f20d5d2ffb978002d671c329dc">flatVolsFlags</a>) *bdata::make(<a class="el" href="test_2commodityschwartzmodel_8cpp.html#a391af7283d1ddfef2b73086f39b487dd">driftFreeState</a>), infEurIsDk, infGbpIsDk, flatVols, <a class="el" href="test_2commodityschwartzmodel_8cpp.html#a391af7283d1ddfef2b73086f39b487dd">driftFreeState</a>)</td></tr>
<tr class="separator:a845ff59e670b87ff4d3abec50e3273c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c092efee780e717bdbd58983cca33e8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a0c092efee780e717bdbd58983cca33e8">BOOST_AUTO_TEST_CASE</a> (testIrFxInfCrEqMartingaleProperty)</td></tr>
<tr class="separator:a0c092efee780e717bdbd58983cca33e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc08cf7dcff36d548c38261b7358fa70"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#abc08cf7dcff36d548c38261b7358fa70">BOOST_AUTO_TEST_CASE</a> (testIrFxInfCrEqMoments)</td></tr>
<tr class="separator:abc08cf7dcff36d548c38261b7358fa70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92aed2cebb3cd1f9dbb26f6faadd6ed5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a92aed2cebb3cd1f9dbb26f6faadd6ed5">BOOST_AUTO_TEST_CASE</a> (testEqLgm5fPayouts)</td></tr>
<tr class="separator:a92aed2cebb3cd1f9dbb26f6faadd6ed5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa89ea3d346617cd549d68c8d53d75bb2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#aa89ea3d346617cd549d68c8d53d75bb2">BOOST_AUTO_TEST_CASE</a> (testEqLgm5fCalibration)</td></tr>
<tr class="separator:aa89ea3d346617cd549d68c8d53d75bb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a230062c157e987f941fead5bf5501c45"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a230062c157e987f941fead5bf5501c45">BOOST_AUTO_TEST_CASE</a> (testEqLgm5fMoments)</td></tr>
<tr class="separator:a230062c157e987f941fead5bf5501c45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ff435d86fb0d97d317f68db7db2057a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a8ff435d86fb0d97d317f68db7db2057a">BOOST_AUTO_TEST_CASE</a> (testCorrelationRecovery)</td></tr>
<tr class="separator:a8ff435d86fb0d97d317f68db7db2057a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a132847111b22b5a9cc8124b290fc9d1d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a132847111b22b5a9cc8124b290fc9d1d">BOOST_AUTO_TEST_CASE</a> (testIrFxInfCrCorrelationRecovery)</td></tr>
<tr class="separator:a132847111b22b5a9cc8124b290fc9d1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad195f8f6efc789deda39f76a1a4a21e9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#ad195f8f6efc789deda39f76a1a4a21e9">BOOST_AUTO_TEST_CASE</a> (testIrFxInfCrEqCorrelationRecovery)</td></tr>
<tr class="separator:ad195f8f6efc789deda39f76a1a4a21e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bcc91c2f009e439388195393beed77e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a5bcc91c2f009e439388195393beed77e">BOOST_AUTO_TEST_CASE</a> (testCpiCalibrationByAlpha)</td></tr>
<tr class="separator:a5bcc91c2f009e439388195393beed77e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d42876af41cfdd820f76db826b25e15"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a7d42876af41cfdd820f76db826b25e15">BOOST_AUTO_TEST_CASE</a> (testCpiCalibrationByH)</td></tr>
<tr class="separator:a7d42876af41cfdd820f76db826b25e15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36e1a4d58e785be16c1670dad9566928"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a36e1a4d58e785be16c1670dad9566928">BOOST_AUTO_TEST_CASE</a> (testCrCalibration)</td></tr>
<tr class="separator:a36e1a4d58e785be16c1670dad9566928"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aa848a14c24baafa9e714abd087d2062b"><td class="memItemLeft" align="right" valign="top">vector&lt; <a class="el" href="classbool.html">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#aa848a14c24baafa9e714abd087d2062b">infEurFlags</a> { true, false }</td></tr>
<tr class="separator:aa848a14c24baafa9e714abd087d2062b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabb2919210687ea5ff99ba34f08dd185"><td class="memItemLeft" align="right" valign="top">vector&lt; <a class="el" href="classbool.html">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#aabb2919210687ea5ff99ba34f08dd185">infGbpFlags</a> { true, false }</td></tr>
<tr class="separator:aabb2919210687ea5ff99ba34f08dd185"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cd3e0f20d5d2ffb978002d671c329dc"><td class="memItemLeft" align="right" valign="top">vector&lt; <a class="el" href="classbool.html">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a6cd3e0f20d5d2ffb978002d671c329dc">flatVolsFlags</a> { true, false }</td></tr>
<tr class="separator:a6cd3e0f20d5d2ffb978002d671c329dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c026c3769e1c51837f568ca6099e729"><td class="memItemLeft" align="right" valign="top">vector&lt; <a class="el" href="classbool.html">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2crossassetmodel_8cpp.html#a2c026c3769e1c51837f568ca6099e729">driftFreeState</a> { true, false }</td></tr>
<tr class="separator:a2c026c3769e1c51837f568ca6099e729"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a5186ce7bb509123ef0fc2709e0b6267f" name="a5186ce7bb509123ef0fc2709e0b6267f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5186ce7bb509123ef0fc2709e0b6267f">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[1/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testBermudanLgm1fGsr&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l00186">186</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  186</span>                                           {</div>
<div class="line"><span class="lineno">  187</span> </div>
<div class="line"><span class="lineno">  188</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing consistency of Bermudan swaption pricing in &quot;</span></div>
<div class="line"><span class="lineno">  189</span>                       <span class="stringliteral">&quot;LGM 1F and GSR models...&quot;</span>);</div>
<div class="line"><span class="lineno">  190</span> </div>
<div class="line"><span class="lineno">  191</span>    BermudanTestData d;</div>
<div class="line"><span class="lineno">  192</span> </div>
<div class="line"><span class="lineno">  193</span>    <span class="comment">// we use the Hull White adaptor for the LGM parametrization</span></div>
<div class="line"><span class="lineno">  194</span>    <span class="comment">// which should lead to equal Bermudan swaption prices</span></div>
<div class="line"><span class="lineno">  195</span>    boost::shared_ptr&lt;IrLgm1fParametrization&gt; lgm_p = boost::make_shared&lt;IrLgm1fPiecewiseConstantHullWhiteAdaptor&gt;(</div>
<div class="line"><span class="lineno">  196</span>        EURCurrency(), d.yts, d.stepTimes_a, d.sigmas_a, d.stepTimes_a, d.kappas_a);</div>
<div class="line"><span class="lineno">  197</span> </div>
<div class="line"><span class="lineno">  198</span>    <span class="comment">// fix any T forward measure</span></div>
<div class="line"><span class="lineno">  199</span>    boost::shared_ptr&lt;Gsr&gt; gsr = boost::make_shared&lt;Gsr&gt;(d.yts, d.stepDates, d.sigmas, d.reversion, 50.0);</div>
<div class="line"><span class="lineno">  200</span> </div>
<div class="line"><span class="lineno">  201</span>    boost::shared_ptr&lt;LinearGaussMarkovModel&gt; lgm = boost::make_shared&lt;LinearGaussMarkovModel&gt;(lgm_p);</div>
<div class="line"><span class="lineno">  202</span> </div>
<div class="line"><span class="lineno">  203</span>    boost::shared_ptr&lt;Gaussian1dModel&gt; lgm_g1d = boost::make_shared&lt;Gaussian1dCrossAssetAdaptor&gt;(lgm);</div>
<div class="line"><span class="lineno">  204</span> </div>
<div class="line"><span class="lineno">  205</span>    boost::shared_ptr&lt;PricingEngine&gt; swaptionEngineGsr =</div>
<div class="line"><span class="lineno">  206</span>        boost::make_shared&lt;Gaussian1dSwaptionEngine&gt;(gsr, 64, 7.0, <span class="keyword">true</span>, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  207</span> </div>
<div class="line"><span class="lineno">  208</span>    boost::shared_ptr&lt;PricingEngine&gt; swaptionEngineLgm =</div>
<div class="line"><span class="lineno">  209</span>        boost::make_shared&lt;Gaussian1dSwaptionEngine&gt;(lgm_g1d, 64, 7.0, <span class="keyword">true</span>, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  210</span> </div>
<div class="line"><span class="lineno">  211</span>    boost::shared_ptr&lt;PricingEngine&gt; swaptionEngineLgm2 =</div>
<div class="line"><span class="lineno">  212</span>        boost::make_shared&lt;NumericLgmSwaptionEngine&gt;(lgm, 7.0, 16, 7.0, 32);</div>
<div class="line"><span class="lineno">  213</span> </div>
<div class="line"><span class="lineno">  214</span>    d.swaption-&gt;setPricingEngine(swaptionEngineGsr);</div>
<div class="line"><span class="lineno">  215</span>    Real npvGsr = d.swaption-&gt;NPV();</div>
<div class="line"><span class="lineno">  216</span>    d.swaption-&gt;setPricingEngine(swaptionEngineLgm);</div>
<div class="line"><span class="lineno">  217</span>    Real npvLgm = d.swaption-&gt;NPV();</div>
<div class="line"><span class="lineno">  218</span>    d.swaption-&gt;setPricingEngine(swaptionEngineLgm2);</div>
<div class="line"><span class="lineno">  219</span>    Real npvLgm2 = d.swaption-&gt;NPV();</div>
<div class="line"><span class="lineno">  220</span> </div>
<div class="line"><span class="lineno">  221</span>    Real tol = 0.2E-4; <span class="comment">// basis point tolerance</span></div>
<div class="line"><span class="lineno">  222</span> </div>
<div class="line"><span class="lineno">  223</span>    <span class="keywordflow">if</span> (std::fabs(npvGsr - npvLgm) &gt; tol)</div>
<div class="line"><span class="lineno">  224</span>        BOOST_ERROR(<span class="stringliteral">&quot;Failed to verify consistency of Bermudan swaption price &quot;</span></div>
<div class="line"><span class="lineno">  225</span>                    <span class="stringliteral">&quot;in IrLgm1f / Gaussian1d adaptor engine (&quot;</span></div>
<div class="line"><span class="lineno">  226</span>                    &lt;&lt; npvLgm &lt;&lt; <span class="stringliteral">&quot;) and Gsr (&quot;</span> &lt;&lt; npvGsr &lt;&lt; <span class="stringliteral">&quot;) models, tolerance is &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno">  227</span> </div>
<div class="line"><span class="lineno">  228</span>    <span class="keywordflow">if</span> (std::fabs(npvGsr - npvLgm2) &gt; tol)</div>
<div class="line"><span class="lineno">  229</span>        BOOST_ERROR(<span class="stringliteral">&quot;Failed to verify consistency of Bermudan swaption price &quot;</span></div>
<div class="line"><span class="lineno">  230</span>                    <span class="stringliteral">&quot;in IrLgm1f / Numeric LGM engine (&quot;</span></div>
<div class="line"><span class="lineno">  231</span>                    &lt;&lt; npvLgm2 &lt;&lt; <span class="stringliteral">&quot;) and Gsr (&quot;</span> &lt;&lt; npvGsr &lt;&lt; <span class="stringliteral">&quot;) models, tolerance is &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno">  232</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4af3e4a9624e0a8c86929b767c248912" name="a4af3e4a9624e0a8c86929b767c248912"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4af3e4a9624e0a8c86929b767c248912">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[2/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testBermudanLgmInvariances&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l00234">234</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  234</span>                                                 {</div>
<div class="line"><span class="lineno">  235</span> </div>
<div class="line"><span class="lineno">  236</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing LGM model invariances for Bermudan &quot;</span></div>
<div class="line"><span class="lineno">  237</span>                       <span class="stringliteral">&quot;swaption pricing...&quot;</span>);</div>
<div class="line"><span class="lineno">  238</span> </div>
<div class="line"><span class="lineno">  239</span>    BermudanTestData d;</div>
<div class="line"><span class="lineno">  240</span> </div>
<div class="line"><span class="lineno">  241</span>    boost::shared_ptr&lt;IrLgm1fParametrization&gt; lgm_p2 = boost::make_shared&lt;IrLgm1fPiecewiseConstantHullWhiteAdaptor&gt;(</div>
<div class="line"><span class="lineno">  242</span>        EURCurrency(), d.yts, d.stepTimes_a, d.sigmas_a, d.stepTimes_a, d.kappas_a);</div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span>    boost::shared_ptr&lt;LinearGaussMarkovModel&gt; lgm2 = boost::make_shared&lt;LinearGaussMarkovModel&gt;(lgm_p2);</div>
<div class="line"><span class="lineno">  245</span> </div>
<div class="line"><span class="lineno">  246</span>    boost::shared_ptr&lt;Gaussian1dModel&gt; lgm_g1d2 = boost::make_shared&lt;Gaussian1dCrossAssetAdaptor&gt;(lgm2);</div>
<div class="line"><span class="lineno">  247</span> </div>
<div class="line"><span class="lineno">  248</span>    boost::shared_ptr&lt;PricingEngine&gt; swaptionEngineLgm2 =</div>
<div class="line"><span class="lineno">  249</span>        boost::make_shared&lt;Gaussian1dSwaptionEngine&gt;(lgm_g1d2, 64, 7.0, <span class="keyword">true</span>, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  250</span> </div>
<div class="line"><span class="lineno">  251</span>    d.swaption-&gt;setPricingEngine(swaptionEngineLgm2);</div>
<div class="line"><span class="lineno">  252</span>    Real npvLgm = d.swaption-&gt;NPV();</div>
<div class="line"><span class="lineno">  253</span> </div>
<div class="line"><span class="lineno">  254</span>    lgm_p2-&gt;shift() = -5.0;</div>
<div class="line"><span class="lineno">  255</span>    lgm_p2-&gt;scaling() = 3.0;</div>
<div class="line"><span class="lineno">  256</span> </div>
<div class="line"><span class="lineno">  257</span>    <span class="comment">// parametrizations are not observed, so we have to call update ourselves</span></div>
<div class="line"><span class="lineno">  258</span>    lgm2-&gt;update();</div>
<div class="line"><span class="lineno">  259</span> </div>
<div class="line"><span class="lineno">  260</span>    Real npvLgm2 = d.swaption-&gt;NPV();</div>
<div class="line"><span class="lineno">  261</span> </div>
<div class="line"><span class="lineno">  262</span>    Real tol = 1.0E-5;</div>
<div class="line"><span class="lineno">  263</span> </div>
<div class="line"><span class="lineno">  264</span>    <span class="keywordflow">if</span> (std::fabs(npvLgm - npvLgm2) &gt; tol)</div>
<div class="line"><span class="lineno">  265</span>        BOOST_ERROR(<span class="stringliteral">&quot;Failed to verify consistency of Bermudan swaption price &quot;</span></div>
<div class="line"><span class="lineno">  266</span>                    <span class="stringliteral">&quot;under LGM model invariances, difference is &quot;</span></div>
<div class="line"><span class="lineno">  267</span>                    &lt;&lt; (npvLgm - npvLgm2));</div>
<div class="line"><span class="lineno">  268</span> </div>
<div class="line"><span class="lineno">  269</span>} <span class="comment">// testBermudanLgm1fGsr</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae1521fc86e1270fe62fc0441a30345aa" name="ae1521fc86e1270fe62fc0441a30345aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae1521fc86e1270fe62fc0441a30345aa">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[3/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testNonstandardBermudanSwaption&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l00271">271</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  271</span>                                                      {</div>
<div class="line"><span class="lineno">  272</span> </div>
<div class="line"><span class="lineno">  273</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing numeric LGM swaption engine for non-standard swaption...&quot;</span>);</div>
<div class="line"><span class="lineno">  274</span> </div>
<div class="line"><span class="lineno">  275</span>    BermudanTestData d;</div>
<div class="line"><span class="lineno">  276</span> </div>
<div class="line"><span class="lineno">  277</span>    boost::shared_ptr&lt;NonstandardSwaption&gt; ns_swaption = boost::make_shared&lt;NonstandardSwaption&gt;(*d.swaption);</div>
<div class="line"><span class="lineno">  278</span> </div>
<div class="line"><span class="lineno">  279</span>    boost::shared_ptr&lt;IrLgm1fParametrization&gt; lgm_p = boost::make_shared&lt;IrLgm1fPiecewiseConstantHullWhiteAdaptor&gt;(</div>
<div class="line"><span class="lineno">  280</span>        EURCurrency(), d.yts, d.stepTimes_a, d.sigmas_a, d.stepTimes_a, d.kappas_a);</div>
<div class="line"><span class="lineno">  281</span> </div>
<div class="line"><span class="lineno">  282</span>    boost::shared_ptr&lt;LinearGaussMarkovModel&gt; lgm = boost::make_shared&lt;LinearGaussMarkovModel&gt;(lgm_p);</div>
<div class="line"><span class="lineno">  283</span> </div>
<div class="line"><span class="lineno">  284</span>    boost::shared_ptr&lt;PricingEngine&gt; engine = boost::make_shared&lt;NumericLgmSwaptionEngine&gt;(lgm, 7.0, 16, 7.0, 32);</div>
<div class="line"><span class="lineno">  285</span>    boost::shared_ptr&lt;PricingEngine&gt; ns_engine =</div>
<div class="line"><span class="lineno">  286</span>        boost::make_shared&lt;NumericLgmNonstandardSwaptionEngine&gt;(lgm, 7.0, 16, 7.0, 32);</div>
<div class="line"><span class="lineno">  287</span> </div>
<div class="line"><span class="lineno">  288</span>    d.swaption-&gt;setPricingEngine(engine);</div>
<div class="line"><span class="lineno">  289</span>    ns_swaption-&gt;setPricingEngine(ns_engine);</div>
<div class="line"><span class="lineno">  290</span> </div>
<div class="line"><span class="lineno">  291</span>    Real npv = d.swaption-&gt;NPV();</div>
<div class="line"><span class="lineno">  292</span>    Real ns_npv = d.swaption-&gt;NPV();</div>
<div class="line"><span class="lineno">  293</span> </div>
<div class="line"><span class="lineno">  294</span>    Real tol = 1.0E-12;</div>
<div class="line"><span class="lineno">  295</span>    <span class="keywordflow">if</span> (std::fabs(npv - ns_npv) &gt;= tol)</div>
<div class="line"><span class="lineno">  296</span>        BOOST_ERROR(<span class="stringliteral">&quot;Failed to verify consistency of Bermudan swaption price (&quot;</span></div>
<div class="line"><span class="lineno">  297</span>                    &lt;&lt; npv &lt;&lt; <span class="stringliteral">&quot;) and Bermudan nonstandard swaption price (&quot;</span> &lt;&lt; ns_npv &lt;&lt; <span class="stringliteral">&quot;), difference is &quot;</span></div>
<div class="line"><span class="lineno">  298</span>                    &lt;&lt; (npv - ns_npv) &lt;&lt; <span class="stringliteral">&quot;, tolerance is &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno">  299</span>} <span class="comment">// testNonstandardBermudanSwaption</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2328effe637801c2b45b6beb2b97840b" name="a2328effe637801c2b45b6beb2b97840b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2328effe637801c2b45b6beb2b97840b">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[4/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testLgm1fCalibration&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l00301">301</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  301</span>                                           {</div>
<div class="line"><span class="lineno">  302</span> </div>
<div class="line"><span class="lineno">  303</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing calibration of LGM 1F model (analytic engine) &quot;</span></div>
<div class="line"><span class="lineno">  304</span>                       <span class="stringliteral">&quot;against GSR parameters...&quot;</span>);</div>
<div class="line"><span class="lineno">  305</span> </div>
<div class="line"><span class="lineno">  306</span>    <span class="comment">// for fixed kappa != 0.0 we calibrate sigma via</span></div>
<div class="line"><span class="lineno">  307</span>    <span class="comment">// the Hull White Adaptor</span></div>
<div class="line"><span class="lineno">  308</span> </div>
<div class="line"><span class="lineno">  309</span>    SavedSettings backup;</div>
<div class="line"><span class="lineno">  310</span> </div>
<div class="line"><span class="lineno">  311</span>    Date evalDate(12, January, 2015);</div>
<div class="line"><span class="lineno">  312</span>    Settings::instance().evaluationDate() = evalDate;</div>
<div class="line"><span class="lineno">  313</span>    Handle&lt;YieldTermStructure&gt; yts(boost::make_shared&lt;FlatForward&gt;(evalDate, 0.02, Actual365Fixed()));</div>
<div class="line"><span class="lineno">  314</span>    boost::shared_ptr&lt;IborIndex&gt; euribor6m = boost::make_shared&lt;Euribor&gt;(6 * Months, yts);</div>
<div class="line"><span class="lineno">  315</span> </div>
<div class="line"><span class="lineno">  316</span>    <span class="comment">// coterminal basket 1y-9y, 2y-8y, ... 9y-1y</span></div>
<div class="line"><span class="lineno">  317</span> </div>
<div class="line"><span class="lineno">  318</span>    std::vector&lt;boost::shared_ptr&lt;BlackCalibrationHelper&gt; &gt; basket;</div>
<div class="line"><span class="lineno">  319</span>    Real impliedVols[] = { 0.4, 0.39, 0.38, 0.35, 0.35, 0.34, 0.33, 0.32, 0.31 };</div>
<div class="line"><span class="lineno">  320</span>    std::vector&lt;Date&gt; expiryDates;</div>
<div class="line"><span class="lineno">  321</span> </div>
<div class="line"><span class="lineno">  322</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; 9; ++i) {</div>
<div class="line"><span class="lineno">  323</span>        boost::shared_ptr&lt;BlackCalibrationHelper&gt; <a class="code hl_typedef" href="piecewiseatmoptionletcurve_8cpp.html#ac28af33f0db47fd24320c0ae0844971f">helper</a> = boost::make_shared&lt;SwaptionHelper&gt;(</div>
<div class="line"><span class="lineno">  324</span>            (i + 1) * Years, (9 - i) * Years, Handle&lt;Quote&gt;(boost::make_shared&lt;SimpleQuote&gt;(impliedVols[i])), euribor6m,</div>
<div class="line"><span class="lineno">  325</span>            1 * Years, Thirty360(Thirty360::BondBasis), Actual360(), yts);</div>
<div class="line"><span class="lineno">  326</span>        basket.push_back(<a class="code hl_typedef" href="piecewiseatmoptionletcurve_8cpp.html#ac28af33f0db47fd24320c0ae0844971f">helper</a>);</div>
<div class="line"><span class="lineno">  327</span>        expiryDates.push_back(</div>
<div class="line"><span class="lineno">  328</span>            boost::static_pointer_cast&lt;SwaptionHelper&gt;(<a class="code hl_typedef" href="piecewiseatmoptionletcurve_8cpp.html#ac28af33f0db47fd24320c0ae0844971f">helper</a>)-&gt;swaption()-&gt;exercise()-&gt;dates().back());</div>
<div class="line"><span class="lineno">  329</span>    }</div>
<div class="line"><span class="lineno">  330</span> </div>
<div class="line"><span class="lineno">  331</span>    std::vector&lt;Date&gt; stepDates(expiryDates.begin(), expiryDates.end() - 1);</div>
<div class="line"><span class="lineno">  332</span> </div>
<div class="line"><span class="lineno">  333</span>    Array stepTimes_a(stepDates.size());</div>
<div class="line"><span class="lineno">  334</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; stepDates.size(); ++i) {</div>
<div class="line"><span class="lineno">  335</span>        stepTimes_a[i] = yts-&gt;timeFromReference(stepDates[i]);</div>
<div class="line"><span class="lineno">  336</span>    }</div>
<div class="line"><span class="lineno">  337</span> </div>
<div class="line"><span class="lineno">  338</span>    Real kappa = 0.05;</div>
<div class="line"><span class="lineno">  339</span> </div>
<div class="line"><span class="lineno">  340</span>    std::vector&lt;Real&gt; gsrInitialSigmas(stepDates.size() + 1, 0.0050);</div>
<div class="line"><span class="lineno">  341</span>    std::vector&lt;Real&gt; lgmInitialSigmas2(stepDates.size() + 1, 0.0050);</div>
<div class="line"><span class="lineno">  342</span> </div>
<div class="line"><span class="lineno">  343</span>    Array lgmInitialSigmas2_a(lgmInitialSigmas2.begin(), lgmInitialSigmas2.end());</div>
<div class="line"><span class="lineno">  344</span>    Array kappas_a(lgmInitialSigmas2_a.size(), kappa);</div>
<div class="line"><span class="lineno">  345</span> </div>
<div class="line"><span class="lineno">  346</span>    boost::shared_ptr&lt;IrLgm1fParametrization&gt; lgm_p = boost::make_shared&lt;IrLgm1fPiecewiseConstantHullWhiteAdaptor&gt;(</div>
<div class="line"><span class="lineno">  347</span>        EURCurrency(), yts, stepTimes_a, lgmInitialSigmas2_a, stepTimes_a, kappas_a);</div>
<div class="line"><span class="lineno">  348</span> </div>
<div class="line"><span class="lineno">  349</span>    <span class="comment">// fix any T forward measure</span></div>
<div class="line"><span class="lineno">  350</span>    boost::shared_ptr&lt;Gsr&gt; gsr = boost::make_shared&lt;Gsr&gt;(yts, stepDates, gsrInitialSigmas, kappa, 50.0);</div>
<div class="line"><span class="lineno">  351</span> </div>
<div class="line"><span class="lineno">  352</span>    boost::shared_ptr&lt;LinearGaussMarkovModel&gt; lgm = boost::make_shared&lt;LinearGaussMarkovModel&gt;(lgm_p);</div>
<div class="line"><span class="lineno">  353</span> </div>
<div class="line"><span class="lineno">  354</span>    boost::shared_ptr&lt;PricingEngine&gt; swaptionEngineGsr =</div>
<div class="line"><span class="lineno">  355</span>        boost::make_shared&lt;Gaussian1dSwaptionEngine&gt;(gsr, 64, 7.0, <span class="keyword">true</span>, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  356</span> </div>
<div class="line"><span class="lineno">  357</span>    boost::shared_ptr&lt;PricingEngine&gt; swaptionEngineLgm = boost::make_shared&lt;AnalyticLgmSwaptionEngine&gt;(lgm);</div>
<div class="line"><span class="lineno">  358</span> </div>
<div class="line"><span class="lineno">  359</span>    <span class="comment">// calibrate GSR</span></div>
<div class="line"><span class="lineno">  360</span> </div>
<div class="line"><span class="lineno">  361</span>    LevenbergMarquardt lm(1E-8, 1E-8, 1E-8);</div>
<div class="line"><span class="lineno">  362</span>    EndCriteria ec(1000, 500, 1E-8, 1E-8, 1E-8);</div>
<div class="line"><span class="lineno">  363</span> </div>
<div class="line"><span class="lineno">  364</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basket.size(); ++i) {</div>
<div class="line"><span class="lineno">  365</span>        basket[i]-&gt;setPricingEngine(swaptionEngineGsr);</div>
<div class="line"><span class="lineno">  366</span>    }</div>
<div class="line"><span class="lineno">  367</span> </div>
<div class="line"><span class="lineno">  368</span>    gsr-&gt;calibrateVolatilitiesIterative(basket, lm, ec);</div>
<div class="line"><span class="lineno">  369</span> </div>
<div class="line"><span class="lineno">  370</span>    Array gsrSigmas = gsr-&gt;volatility();</div>
<div class="line"><span class="lineno">  371</span> </div>
<div class="line"><span class="lineno">  372</span>    <span class="comment">// calibrate LGM</span></div>
<div class="line"><span class="lineno">  373</span> </div>
<div class="line"><span class="lineno">  374</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basket.size(); ++i) {</div>
<div class="line"><span class="lineno">  375</span>        basket[i]-&gt;setPricingEngine(swaptionEngineLgm);</div>
<div class="line"><span class="lineno">  376</span>    }</div>
<div class="line"><span class="lineno">  377</span> </div>
<div class="line"><span class="lineno">  378</span>    lgm-&gt;calibrateVolatilitiesIterative(basket, lm, ec);</div>
<div class="line"><span class="lineno">  379</span> </div>
<div class="line"><span class="lineno">  380</span>    Array lgmSigmas = lgm-&gt;parametrization()-&gt;parameterValues(0);</div>
<div class="line"><span class="lineno">  381</span> </div>
<div class="line"><span class="lineno">  382</span>    Real tol0 = 1E-8;</div>
<div class="line"><span class="lineno">  383</span>    Real tol = 2E-5;</div>
<div class="line"><span class="lineno">  384</span> </div>
<div class="line"><span class="lineno">  385</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; gsrSigmas.size(); ++i) {</div>
<div class="line"><span class="lineno">  386</span>        <span class="comment">// check calibration itself, we should match the market prices</span></div>
<div class="line"><span class="lineno">  387</span>        <span class="comment">// rather exactly (note that this tests the lgm calibration,</span></div>
<div class="line"><span class="lineno">  388</span>        <span class="comment">// not the gsr calibration)</span></div>
<div class="line"><span class="lineno">  389</span>        <span class="keywordflow">if</span> (std::fabs(basket[i]-&gt;modelValue() - basket[i]-&gt;marketValue()) &gt; tol0)</div>
<div class="line"><span class="lineno">  390</span>            BOOST_ERROR(<span class="stringliteral">&quot;Failed to calibrate to market swaption #&quot;</span></div>
<div class="line"><span class="lineno">  391</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;, market price is &quot;</span> &lt;&lt; basket[i]-&gt;marketValue() &lt;&lt; <span class="stringliteral">&quot; while model price is &quot;</span></div>
<div class="line"><span class="lineno">  392</span>                        &lt;&lt; basket[i]-&gt;modelValue());</div>
<div class="line"><span class="lineno">  393</span>        <span class="comment">// compare calibrated model parameters</span></div>
<div class="line"><span class="lineno">  394</span>        <span class="keywordflow">if</span> (std::fabs(gsrSigmas[i] - lgmSigmas[i]) &gt; tol)</div>
<div class="line"><span class="lineno">  395</span>            BOOST_ERROR(<span class="stringliteral">&quot;Failed to verify LGM&#39;s sigma from Hull White adaptor (#&quot;</span></div>
<div class="line"><span class="lineno">  396</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;), which is &quot;</span> &lt;&lt; lgmSigmas[i] &lt;&lt; <span class="stringliteral">&quot; while GSR&#39;s sigma is &quot;</span> &lt;&lt; gsrSigmas[i] &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno">  397</span>    }</div>
<div class="line"><span class="lineno">  398</span> </div>
<div class="line"><span class="lineno">  399</span>    <span class="comment">// calibrate LGM as component of CrossAssetModel</span></div>
<div class="line"><span class="lineno">  400</span> </div>
<div class="line"><span class="lineno">  401</span>    <span class="comment">// create a second set of parametrization ...</span></div>
<div class="line"><span class="lineno">  402</span>    boost::shared_ptr&lt;IrLgm1fParametrization&gt; lgm_p21 = boost::make_shared&lt;IrLgm1fPiecewiseConstantHullWhiteAdaptor&gt;(</div>
<div class="line"><span class="lineno">  403</span>        USDCurrency(), yts, stepTimes_a, lgmInitialSigmas2_a, stepTimes_a, kappas_a);</div>
<div class="line"><span class="lineno">  404</span>    boost::shared_ptr&lt;IrLgm1fParametrization&gt; lgm_p22 = boost::make_shared&lt;IrLgm1fPiecewiseConstantHullWhiteAdaptor&gt;(</div>
<div class="line"><span class="lineno">  405</span>        EURCurrency(), yts, stepTimes_a, lgmInitialSigmas2_a, stepTimes_a, kappas_a);</div>
<div class="line"><span class="lineno">  406</span> </div>
<div class="line"><span class="lineno">  407</span>    <span class="comment">// ... and a fx parametrization ...</span></div>
<div class="line"><span class="lineno">  408</span>    Array notimes_a(0);</div>
<div class="line"><span class="lineno">  409</span>    Array sigma_a(1, 0.10);</div>
<div class="line"><span class="lineno">  410</span>    boost::shared_ptr&lt;FxBsParametrization&gt; fx_p = boost::make_shared&lt;FxBsPiecewiseConstantParametrization&gt;(</div>
<div class="line"><span class="lineno">  411</span>        EURCurrency(), Handle&lt;Quote&gt;(boost::make_shared&lt;SimpleQuote&gt;(1.00)), notimes_a, sigma_a);</div>
<div class="line"><span class="lineno">  412</span> </div>
<div class="line"><span class="lineno">  413</span>    <span class="comment">// ... and set up an crossasset model with USD as domestic currency ...</span></div>
<div class="line"><span class="lineno">  414</span>    std::vector&lt;boost::shared_ptr&lt;Parametrization&gt; &gt; parametrizations;</div>
<div class="line"><span class="lineno">  415</span>    parametrizations.push_back(lgm_p21);</div>
<div class="line"><span class="lineno">  416</span>    parametrizations.push_back(lgm_p22);</div>
<div class="line"><span class="lineno">  417</span>    parametrizations.push_back(fx_p);</div>
<div class="line"><span class="lineno">  418</span>    Matrix rho(3, 3, 0.0);</div>
<div class="line"><span class="lineno">  419</span>    rho[0][0] = rho[1][1] = rho[2][2] = 1.0;</div>
<div class="line"><span class="lineno">  420</span>    boost::shared_ptr&lt;CrossAssetModel&gt; xmodel =</div>
<div class="line"><span class="lineno">  421</span>        boost::make_shared&lt;CrossAssetModel&gt;(parametrizations, rho, SalvagingAlgorithm::None);</div>
<div class="line"><span class="lineno">  422</span> </div>
<div class="line"><span class="lineno">  423</span>    <span class="comment">// .. whose EUR component we calibrate as before and compare the</span></div>
<div class="line"><span class="lineno">  424</span>    <span class="comment">// result against the 1d case and as well check that the USD</span></div>
<div class="line"><span class="lineno">  425</span>    <span class="comment">// component was not touched by the calibration.</span></div>
<div class="line"><span class="lineno">  426</span> </div>
<div class="line"><span class="lineno">  427</span>    boost::shared_ptr&lt;PricingEngine&gt; swaptionEngineLgm2 = boost::make_shared&lt;AnalyticLgmSwaptionEngine&gt;(xmodel, 1);</div>
<div class="line"><span class="lineno">  428</span> </div>
<div class="line"><span class="lineno">  429</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basket.size(); ++i) {</div>
<div class="line"><span class="lineno">  430</span>        basket[i]-&gt;setPricingEngine(swaptionEngineLgm2);</div>
<div class="line"><span class="lineno">  431</span>    }</div>
<div class="line"><span class="lineno">  432</span> </div>
<div class="line"><span class="lineno">  433</span>    xmodel-&gt;calibrateIrLgm1fVolatilitiesIterative(1, basket, lm, ec);</div>
<div class="line"><span class="lineno">  434</span> </div>
<div class="line"><span class="lineno">  435</span>    Array lgmSigmas2eur = xmodel-&gt;irlgm1f(1)-&gt;parameterValues(0);</div>
<div class="line"><span class="lineno">  436</span>    Array lgmSigmas2usd = xmodel-&gt;irlgm1f(0)-&gt;parameterValues(0);</div>
<div class="line"><span class="lineno">  437</span> </div>
<div class="line"><span class="lineno">  438</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; gsrSigmas.size(); ++i) {</div>
<div class="line"><span class="lineno">  439</span>        <span class="comment">// compare calibrated model parameters against 1d calibration before</span></div>
<div class="line"><span class="lineno">  440</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(lgmSigmas2eur[i], lgmSigmas[i]))</div>
<div class="line"><span class="lineno">  441</span>            BOOST_ERROR(<span class="stringliteral">&quot;Failed to verify crossasset LGM1F component calibration &quot;</span></div>
<div class="line"><span class="lineno">  442</span>                        <span class="stringliteral">&quot;at parameter #&quot;</span></div>
<div class="line"><span class="lineno">  443</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; against 1d calibration, which is &quot;</span> &lt;&lt; lgmSigmas2eur[i] &lt;&lt; <span class="stringliteral">&quot; while 1d calibration was &quot;</span></div>
<div class="line"><span class="lineno">  444</span>                        &lt;&lt; lgmSigmas[i] &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno">  445</span>        <span class="comment">// compare usd component against start values (since it was not</span></div>
<div class="line"><span class="lineno">  446</span>        <span class="comment">// calibrated, so should not have changed)</span></div>
<div class="line"><span class="lineno">  447</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(lgmSigmas2usd[i], lgmInitialSigmas2[i]))</div>
<div class="line"><span class="lineno">  448</span>            BOOST_ERROR(<span class="stringliteral">&quot;Non calibrated crossasset LGM1F component was changed by &quot;</span></div>
<div class="line"><span class="lineno">  449</span>                        <span class="stringliteral">&quot;other&#39;s component calibration at #&quot;</span></div>
<div class="line"><span class="lineno">  450</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;, the new value is &quot;</span> &lt;&lt; lgmSigmas2usd[i] &lt;&lt; <span class="stringliteral">&quot; while the initial value was &quot;</span></div>
<div class="line"><span class="lineno">  451</span>                        &lt;&lt; lgmInitialSigmas2[i]);</div>
<div class="line"><span class="lineno">  452</span>    }</div>
<div class="line"><span class="lineno">  453</span> </div>
<div class="line"><span class="lineno">  454</span>} <span class="comment">// testLgm1fCalibration</span></div>
<div class="ttc" id="anamespace_quant_ext_html_a1cab4fb6a720eff245acb9f3a7a9e7c5"><div class="ttname"><a href="namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">QuantExt::close_enough</a></div><div class="ttdeci">Filter close_enough(const RandomVariable &amp;x, const RandomVariable &amp;y)</div><div class="ttdef"><b>Definition:</b> <a href="qle_2math_2randomvariable_8cpp_source.html#l00496">randomvariable.cpp:496</a></div></div>
<div class="ttc" id="apiecewiseatmoptionletcurve_8cpp_html_ac28af33f0db47fd24320c0ae0844971f"><div class="ttname"><a href="piecewiseatmoptionletcurve_8cpp.html#ac28af33f0db47fd24320c0ae0844971f">helper</a></div><div class="ttdeci">QuantLib::BootstrapHelper&lt; QuantLib::OptionletVolatilityStructure &gt; helper</div><div class="ttdef"><b>Definition:</b> <a href="piecewiseatmoptionletcurve_8cpp_source.html#l00044">piecewiseatmoptionletcurve.cpp:44</a></div></div>
</div><!-- fragment --><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="test_2crossassetmodel_8cpp_a2328effe637801c2b45b6beb2b97840b_cgraph.png" border="0" usemap="#atest_2crossassetmodel_8cpp_a2328effe637801c2b45b6beb2b97840b_cgraph" alt=""/></div>
<map name="atest_2crossassetmodel_8cpp_a2328effe637801c2b45b6beb2b97840b_cgraph" id="atest_2crossassetmodel_8cpp_a2328effe637801c2b45b6beb2b97840b_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,196,31"/>
<area shape="rect" href="namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5" title=" " alt="" coords="244,5,409,31"/>
</map>
</div>

</div>
</div>
<a id="a0a852d7254bff61434239cbe761e6a71" name="a0a852d7254bff61434239cbe761e6a71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a852d7254bff61434239cbe761e6a71">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[5/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCcyLgm3fForeignPayouts&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l00456">456</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  456</span>                                                 {</div>
<div class="line"><span class="lineno">  457</span> </div>
<div class="line"><span class="lineno">  458</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing pricing of foreign payouts under domestic &quot;</span></div>
<div class="line"><span class="lineno">  459</span>                       <span class="stringliteral">&quot;measure in Ccy LGM 3F model...&quot;</span>);</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>    SavedSettings backup;</div>
<div class="line"><span class="lineno">  462</span> </div>
<div class="line"><span class="lineno">  463</span>    Date referenceDate(30, July, 2015);</div>
<div class="line"><span class="lineno">  464</span> </div>
<div class="line"><span class="lineno">  465</span>    Settings::instance().evaluationDate() = referenceDate;</div>
<div class="line"><span class="lineno">  466</span> </div>
<div class="line"><span class="lineno">  467</span>    Handle&lt;YieldTermStructure&gt; eurYts(boost::make_shared&lt;FlatForward&gt;(referenceDate, 0.02, Actual365Fixed()));</div>
<div class="line"><span class="lineno">  468</span> </div>
<div class="line"><span class="lineno">  469</span>    Handle&lt;YieldTermStructure&gt; usdYts(boost::make_shared&lt;FlatForward&gt;(referenceDate, 0.05, Actual365Fixed()));</div>
<div class="line"><span class="lineno">  470</span> </div>
<div class="line"><span class="lineno">  471</span>    <span class="comment">// use different grids for the EUR and USD  models and the FX volatility</span></div>
<div class="line"><span class="lineno">  472</span>    <span class="comment">// process to test the piecewise numerical integration ...</span></div>
<div class="line"><span class="lineno">  473</span> </div>
<div class="line"><span class="lineno">  474</span>    std::vector&lt;Date&gt; volstepdatesEur, volstepdatesUsd, volstepdatesFx;</div>
<div class="line"><span class="lineno">  475</span> </div>
<div class="line"><span class="lineno">  476</span>    volstepdatesEur.push_back(Date(15, July, 2016));</div>
<div class="line"><span class="lineno">  477</span>    volstepdatesEur.push_back(Date(15, July, 2017));</div>
<div class="line"><span class="lineno">  478</span>    volstepdatesEur.push_back(Date(15, July, 2018));</div>
<div class="line"><span class="lineno">  479</span>    volstepdatesEur.push_back(Date(15, July, 2019));</div>
<div class="line"><span class="lineno">  480</span>    volstepdatesEur.push_back(Date(15, July, 2020));</div>
<div class="line"><span class="lineno">  481</span> </div>
<div class="line"><span class="lineno">  482</span>    volstepdatesUsd.push_back(Date(13, April, 2016));</div>
<div class="line"><span class="lineno">  483</span>    volstepdatesUsd.push_back(Date(13, September, 2016));</div>
<div class="line"><span class="lineno">  484</span>    volstepdatesUsd.push_back(Date(13, April, 2017));</div>
<div class="line"><span class="lineno">  485</span>    volstepdatesUsd.push_back(Date(13, September, 2017));</div>
<div class="line"><span class="lineno">  486</span>    volstepdatesUsd.push_back(Date(13, April, 2018));</div>
<div class="line"><span class="lineno">  487</span>    volstepdatesUsd.push_back(Date(15, July, 2018)); <span class="comment">// shared with EUR</span></div>
<div class="line"><span class="lineno">  488</span>    volstepdatesUsd.push_back(Date(13, April, 2019));</div>
<div class="line"><span class="lineno">  489</span>    volstepdatesUsd.push_back(Date(13, September, 2019));</div>
<div class="line"><span class="lineno">  490</span> </div>
<div class="line"><span class="lineno">  491</span>    volstepdatesFx.push_back(Date(15, July, 2016)); <span class="comment">// shared with EUR</span></div>
<div class="line"><span class="lineno">  492</span>    volstepdatesFx.push_back(Date(15, October, 2016));</div>
<div class="line"><span class="lineno">  493</span>    volstepdatesFx.push_back(Date(15, May, 2017));</div>
<div class="line"><span class="lineno">  494</span>    volstepdatesFx.push_back(Date(13, September, 2017)); <span class="comment">// shared with USD</span></div>
<div class="line"><span class="lineno">  495</span>    volstepdatesFx.push_back(Date(15, July, 2018));      <span class="comment">//  shared with EUR and USD</span></div>
<div class="line"><span class="lineno">  496</span> </div>
<div class="line"><span class="lineno">  497</span>    std::vector&lt;Real&gt; eurVols, usdVols, fxVols;</div>
<div class="line"><span class="lineno">  498</span> </div>
<div class="line"><span class="lineno">  499</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; volstepdatesEur.size() + 1; ++i) {</div>
<div class="line"><span class="lineno">  500</span>        eurVols.push_back(0.0050 + (0.0080 - 0.0050) * std::exp(-0.3 * <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(i)));</div>
<div class="line"><span class="lineno">  501</span>    }</div>
<div class="line"><span class="lineno">  502</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; volstepdatesUsd.size() + 1; ++i) {</div>
<div class="line"><span class="lineno">  503</span>        usdVols.push_back(0.0030 + (0.0110 - 0.0030) * std::exp(-0.3 * <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(i)));</div>
<div class="line"><span class="lineno">  504</span>    }</div>
<div class="line"><span class="lineno">  505</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; volstepdatesFx.size() + 1; ++i) {</div>
<div class="line"><span class="lineno">  506</span>        fxVols.push_back(0.15 + (0.20 - 0.15) * std::exp(-0.3 * <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(i)));</div>
<div class="line"><span class="lineno">  507</span>    }</div>
<div class="line"><span class="lineno">  508</span> </div>
<div class="line"><span class="lineno">  509</span>    Array alphaTimesEur(volstepdatesEur.size()), alphaEur(eurVols.begin(), eurVols.end()), kappaTimesEur(0),</div>
<div class="line"><span class="lineno">  510</span>        kappaEur(1, 0.02);</div>
<div class="line"><span class="lineno">  511</span>    Array alphaTimesUsd(volstepdatesUsd.size()), alphaUsd(usdVols.begin(), usdVols.end()), kappaTimesUsd(0),</div>
<div class="line"><span class="lineno">  512</span>        kappaUsd(1, 0.04);</div>
<div class="line"><span class="lineno">  513</span>    Array fxTimes(volstepdatesFx.size()), fxSigmas(fxVols.begin(), fxVols.end());</div>
<div class="line"><span class="lineno">  514</span> </div>
<div class="line"><span class="lineno">  515</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; alphaTimesEur.size(); ++i) {</div>
<div class="line"><span class="lineno">  516</span>        alphaTimesEur[i] = eurYts-&gt;timeFromReference(volstepdatesEur[i]);</div>
<div class="line"><span class="lineno">  517</span>    }</div>
<div class="line"><span class="lineno">  518</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; alphaTimesUsd.size(); ++i) {</div>
<div class="line"><span class="lineno">  519</span>        alphaTimesUsd[i] = eurYts-&gt;timeFromReference(volstepdatesUsd[i]);</div>
<div class="line"><span class="lineno">  520</span>    }</div>
<div class="line"><span class="lineno">  521</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; fxTimes.size(); ++i) {</div>
<div class="line"><span class="lineno">  522</span>        fxTimes[i] = eurYts-&gt;timeFromReference(volstepdatesFx[i]);</div>
<div class="line"><span class="lineno">  523</span>    }</div>
<div class="line"><span class="lineno">  524</span> </div>
<div class="line"><span class="lineno">  525</span>    boost::shared_ptr&lt;IrLgm1fParametrization&gt; eurLgmParam = boost::make_shared&lt;IrLgm1fPiecewiseConstantParametrization&gt;(</div>
<div class="line"><span class="lineno">  526</span>        EURCurrency(), eurYts, alphaTimesEur, alphaEur, kappaTimesEur, kappaEur);</div>
<div class="line"><span class="lineno">  527</span> </div>
<div class="line"><span class="lineno">  528</span>    boost::shared_ptr&lt;IrLgm1fParametrization&gt; usdLgmParam = boost::make_shared&lt;IrLgm1fPiecewiseConstantParametrization&gt;(</div>
<div class="line"><span class="lineno">  529</span>        USDCurrency(), usdYts, alphaTimesUsd, alphaUsd, kappaTimesUsd, kappaUsd);</div>
<div class="line"><span class="lineno">  530</span> </div>
<div class="line"><span class="lineno">  531</span>    <span class="comment">// USD per EUR (foreign per domestic)</span></div>
<div class="line"><span class="lineno">  532</span>    Handle&lt;Quote&gt; usdEurSpotToday(boost::make_shared&lt;SimpleQuote&gt;(0.90));</div>
<div class="line"><span class="lineno">  533</span> </div>
<div class="line"><span class="lineno">  534</span>    boost::shared_ptr&lt;FxBsParametrization&gt; fxUsdEurBsParam =</div>
<div class="line"><span class="lineno">  535</span>        boost::make_shared&lt;FxBsPiecewiseConstantParametrization&gt;(USDCurrency(), usdEurSpotToday, fxTimes, fxSigmas);</div>
<div class="line"><span class="lineno">  536</span> </div>
<div class="line"><span class="lineno">  537</span>    std::vector&lt;boost::shared_ptr&lt;Parametrization&gt; &gt; singleModels;</div>
<div class="line"><span class="lineno">  538</span>    singleModels.push_back(eurLgmParam);</div>
<div class="line"><span class="lineno">  539</span>    singleModels.push_back(usdLgmParam);</div>
<div class="line"><span class="lineno">  540</span>    singleModels.push_back(fxUsdEurBsParam);</div>
<div class="line"><span class="lineno">  541</span> </div>
<div class="line"><span class="lineno">  542</span>    boost::shared_ptr&lt;CrossAssetModel&gt; ccLgm = boost::make_shared&lt;CrossAssetModel&gt;(singleModels);</div>
<div class="line"><span class="lineno">  543</span> </div>
<div class="line"><span class="lineno">  544</span>    Size eurIdx = ccLgm-&gt;ccyIndex(EURCurrency());</div>
<div class="line"><span class="lineno">  545</span>    Size usdIdx = ccLgm-&gt;ccyIndex(USDCurrency());</div>
<div class="line"><span class="lineno">  546</span>    Size eurUsdIdx = usdIdx - 1;</div>
<div class="line"><span class="lineno">  547</span> </div>
<div class="line"><span class="lineno">  548</span>    ccLgm-&gt;correlation(CrossAssetModel::AssetType::IR, eurIdx, CrossAssetModel::AssetType::IR, usdIdx, -0.2);</div>
<div class="line"><span class="lineno">  549</span>    ccLgm-&gt;correlation(CrossAssetModel::AssetType::IR, eurIdx, CrossAssetModel::AssetType::FX, eurUsdIdx, 0.8);</div>
<div class="line"><span class="lineno">  550</span>    ccLgm-&gt;correlation(CrossAssetModel::AssetType::IR, usdIdx, CrossAssetModel::AssetType::FX, eurUsdIdx, -0.5);</div>
<div class="line"><span class="lineno">  551</span> </div>
<div class="line"><span class="lineno">  552</span>    boost::shared_ptr&lt;LinearGaussMarkovModel&gt; eurLgm = boost::make_shared&lt;LinearGaussMarkovModel&gt;(eurLgmParam);</div>
<div class="line"><span class="lineno">  553</span>    boost::shared_ptr&lt;LinearGaussMarkovModel&gt; usdLgm = boost::make_shared&lt;LinearGaussMarkovModel&gt;(usdLgmParam);</div>
<div class="line"><span class="lineno">  554</span> </div>
<div class="line"><span class="lineno">  555</span>    boost::shared_ptr&lt;StochasticProcess&gt; process = ccLgm-&gt;stateProcess();</div>
<div class="line"><span class="lineno">  556</span>    boost::shared_ptr&lt;StochasticProcess&gt; usdProcess = usdLgm-&gt;stateProcess();</div>
<div class="line"><span class="lineno">  557</span> </div>
<div class="line"><span class="lineno">  558</span>    <span class="comment">// path generation</span></div>
<div class="line"><span class="lineno">  559</span> </div>
<div class="line"><span class="lineno">  560</span>    Size n = 500000; <span class="comment">// number of paths</span></div>
<div class="line"><span class="lineno">  561</span>    Size seed = 121; <span class="comment">// seed</span></div>
<div class="line"><span class="lineno">  562</span>    <span class="comment">// maturity of test payoffs</span></div>
<div class="line"><span class="lineno">  563</span>    Time T = 5.0;</div>
<div class="line"><span class="lineno">  564</span>    <span class="comment">// take large steps, but not only one (since we are testing)</span></div>
<div class="line"><span class="lineno">  565</span>    Size <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a> = <span class="keyword">static_cast&lt;</span>Size<span class="keyword">&gt;</span>(T * 2.0);</div>
<div class="line"><span class="lineno">  566</span>    TimeGrid grid(T, <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>);</div>
<div class="line"><span class="lineno">  567</span>    PseudoRandom::rsg_type sg2 = PseudoRandom::make_sequence_generator(<a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>, seed);</div>
<div class="line"><span class="lineno">  568</span> </div>
<div class="line"><span class="lineno">  569</span>    <a class="code hl_class" href="class_quant_ext_1_1_multi_path_generator_mersenne_twister.html">MultiPathGeneratorMersenneTwister</a> pg(process, grid, seed, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  570</span>    PathGenerator&lt;PseudoRandom::rsg_type&gt; pg2(usdProcess, grid, sg2, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  571</span> </div>
<div class="line"><span class="lineno">  572</span>    <span class="comment">// test</span></div>
<div class="line"><span class="lineno">  573</span>    <span class="comment">// 1 deterministic USD cashflow under EUR numeraire vs. price on USD curve</span></div>
<div class="line"><span class="lineno">  574</span>    <span class="comment">// 2 zero bond option USD under EUR numeraire vs. USD numeraire</span></div>
<div class="line"><span class="lineno">  575</span>    <span class="comment">// 3 fx option USD-EUR under EUR numeraire vs. analytical price</span></div>
<div class="line"><span class="lineno">  576</span> </div>
<div class="line"><span class="lineno">  577</span>    accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; stat1, stat2a, stat2b, stat3;</div>
<div class="line"><span class="lineno">  578</span> </div>
<div class="line"><span class="lineno">  579</span>    <span class="comment">// same for paths2 since shared time grid</span></div>
<div class="line"><span class="lineno">  580</span>    <span class="keywordflow">for</span> (Size j = 0; j &lt; n; ++j) {</div>
<div class="line"><span class="lineno">  581</span>        Sample&lt;MultiPath&gt; path = pg.next();</div>
<div class="line"><span class="lineno">  582</span>        Sample&lt;Path&gt; path2 = pg2.next();</div>
<div class="line"><span class="lineno">  583</span>        Size l = path.value[0].length() - 1;</div>
<div class="line"><span class="lineno">  584</span>        Real fx = std::exp(path.value[2][l]);</div>
<div class="line"><span class="lineno">  585</span>        Real zeur = path.value[0][l];</div>
<div class="line"><span class="lineno">  586</span>        Real zusd = path.value[1][l];</div>
<div class="line"><span class="lineno">  587</span>        Real zusd2 = path2.value[l];</div>
<div class="line"><span class="lineno">  588</span> </div>
<div class="line"><span class="lineno">  589</span>        <span class="comment">// 1 USD paid at T deflated with EUR numeraire</span></div>
<div class="line"><span class="lineno">  590</span>        stat1(1.0 * fx / eurLgm-&gt;numeraire(T, zeur));</div>
<div class="line"><span class="lineno">  591</span> </div>
<div class="line"><span class="lineno">  592</span>        <span class="comment">// 2 USD zero bond option at T on P(T,T+10) strike 0.5 ...</span></div>
<div class="line"><span class="lineno">  593</span>        <span class="comment">// ... under EUR numeraire ...</span></div>
<div class="line"><span class="lineno">  594</span>        Real zbOpt = std::max(usdLgm-&gt;discountBond(T, T + 10.0, zusd) - 0.5, 0.0);</div>
<div class="line"><span class="lineno">  595</span>        stat2a(zbOpt * fx / eurLgm-&gt;numeraire(T, zeur));</div>
<div class="line"><span class="lineno">  596</span>        <span class="comment">// ... and under USD numeraire ...</span></div>
<div class="line"><span class="lineno">  597</span>        Real zbOpt2 = std::max(usdLgm-&gt;discountBond(T, T + 10.0, zusd2) - 0.5, 0.0);</div>
<div class="line"><span class="lineno">  598</span>        stat2b(zbOpt2 / usdLgm-&gt;numeraire(T, zusd2));</div>
<div class="line"><span class="lineno">  599</span> </div>
<div class="line"><span class="lineno">  600</span>        <span class="comment">// 3 USD-EUR fx option @0.9</span></div>
<div class="line"><span class="lineno">  601</span>        stat3(std::max(fx - 0.9, 0.0) / eurLgm-&gt;numeraire(T, zeur));</div>
<div class="line"><span class="lineno">  602</span>    }</div>
<div class="line"><span class="lineno">  603</span> </div>
<div class="line"><span class="lineno">  604</span>    boost::shared_ptr&lt;VanillaOption&gt; fxOption =</div>
<div class="line"><span class="lineno">  605</span>        boost::make_shared&lt;VanillaOption&gt;(boost::make_shared&lt;PlainVanillaPayoff&gt;(Option::Call, 0.9),</div>
<div class="line"><span class="lineno">  606</span>                                          boost::make_shared&lt;EuropeanExercise&gt;(referenceDate + 5 * 365));</div>
<div class="line"><span class="lineno">  607</span> </div>
<div class="line"><span class="lineno">  608</span>    boost::shared_ptr&lt;AnalyticCcLgmFxOptionEngine&gt; ccLgmFxOptionEngine =</div>
<div class="line"><span class="lineno">  609</span>        boost::make_shared&lt;AnalyticCcLgmFxOptionEngine&gt;(ccLgm, 0);</div>
<div class="line"><span class="lineno">  610</span> </div>
<div class="line"><span class="lineno">  611</span>    ccLgmFxOptionEngine-&gt;cache();</div>
<div class="line"><span class="lineno">  612</span> </div>
<div class="line"><span class="lineno">  613</span>    fxOption-&gt;setPricingEngine(ccLgmFxOptionEngine);</div>
<div class="line"><span class="lineno">  614</span> </div>
<div class="line"><span class="lineno">  615</span>    Real npv1 = mean(stat1);</div>
<div class="line"><span class="lineno">  616</span>    Real error1 = error_of&lt;tag::mean&gt;(stat1);</div>
<div class="line"><span class="lineno">  617</span>    Real expected1 = usdYts-&gt;discount(5.0) * usdEurSpotToday-&gt;value();</div>
<div class="line"><span class="lineno">  618</span>    Real npv2a = mean(stat2a);</div>
<div class="line"><span class="lineno">  619</span>    Real error2a = error_of&lt;tag::mean&gt;(stat2a);</div>
<div class="line"><span class="lineno">  620</span>    Real npv2b = mean(stat2b) * usdEurSpotToday-&gt;value();</div>
<div class="line"><span class="lineno">  621</span>    ;</div>
<div class="line"><span class="lineno">  622</span>    Real error2b = error_of&lt;tag::mean&gt;(stat2b) * usdEurSpotToday-&gt;value();</div>
<div class="line"><span class="lineno">  623</span>    Real npv3 = mean(stat3);</div>
<div class="line"><span class="lineno">  624</span>    Real error3 = error_of&lt;tag::mean&gt;(stat3);</div>
<div class="line"><span class="lineno">  625</span> </div>
<div class="line"><span class="lineno">  626</span>    <span class="comment">// accept this relative difference in error estimates</span></div>
<div class="line"><span class="lineno">  627</span>    Real tolError = 0.2;</div>
<div class="line"><span class="lineno">  628</span>    <span class="comment">// accept tolErrEst*errorEstimate as absolute difference</span></div>
<div class="line"><span class="lineno">  629</span>    Real tolErrEst = 1.0;</div>
<div class="line"><span class="lineno">  630</span> </div>
<div class="line"><span class="lineno">  631</span>    <span class="keywordflow">if</span> (std::fabs((error1 - 4E-4) / 4E-4) &gt; tolError)</div>
<div class="line"><span class="lineno">  632</span>        BOOST_ERROR(<span class="stringliteral">&quot;error estimate deterministic &quot;</span></div>
<div class="line"><span class="lineno">  633</span>                    <span class="stringliteral">&quot;cashflow pricing can not be &quot;</span></div>
<div class="line"><span class="lineno">  634</span>                    <span class="stringliteral">&quot;reproduced, is &quot;</span></div>
<div class="line"><span class="lineno">  635</span>                    &lt;&lt; error1 &lt;&lt; <span class="stringliteral">&quot;, expected 4E-4, relative tolerance &quot;</span> &lt;&lt; tolError);</div>
<div class="line"><span class="lineno">  636</span>    <span class="keywordflow">if</span> (std::fabs((error2a - 1E-4) / 1E-4) &gt; tolError)</div>
<div class="line"><span class="lineno">  637</span>        BOOST_ERROR(<span class="stringliteral">&quot;error estimate zero bond &quot;</span></div>
<div class="line"><span class="lineno">  638</span>                    <span class="stringliteral">&quot;option pricing (foreign measure) can &quot;</span></div>
<div class="line"><span class="lineno">  639</span>                    <span class="stringliteral">&quot;not be reproduced, is &quot;</span></div>
<div class="line"><span class="lineno">  640</span>                    &lt;&lt; error2a &lt;&lt; <span class="stringliteral">&quot;, expected 1E-4, relative tolerance &quot;</span> &lt;&lt; tolError);</div>
<div class="line"><span class="lineno">  641</span>    <span class="keywordflow">if</span> (std::fabs((error2b - 7E-5) / 7E-5) &gt; tolError)</div>
<div class="line"><span class="lineno">  642</span>        BOOST_ERROR(<span class="stringliteral">&quot;error estimate zero bond &quot;</span></div>
<div class="line"><span class="lineno">  643</span>                    <span class="stringliteral">&quot;option pricing (domestic measure) can &quot;</span></div>
<div class="line"><span class="lineno">  644</span>                    <span class="stringliteral">&quot;not be reproduced, is &quot;</span></div>
<div class="line"><span class="lineno">  645</span>                    &lt;&lt; error2b &lt;&lt; <span class="stringliteral">&quot;, expected 7E-5, relative tolerance &quot;</span> &lt;&lt; tolError);</div>
<div class="line"><span class="lineno">  646</span>    <span class="keywordflow">if</span> (std::fabs((error3 - 2.7E-4) / 2.7E-4) &gt; tolError)</div>
<div class="line"><span class="lineno">  647</span>        BOOST_ERROR(<span class="stringliteral">&quot;error estimate fx option pricing can not be reproduced, is &quot;</span></div>
<div class="line"><span class="lineno">  648</span>                    &lt;&lt; error3 &lt;&lt; <span class="stringliteral">&quot;, expected 2.7E-4, relative tolerance &quot;</span> &lt;&lt; tolError);</div>
<div class="line"><span class="lineno">  649</span> </div>
<div class="line"><span class="lineno">  650</span>    <span class="keywordflow">if</span> (std::fabs(npv1 - expected1) &gt; tolErrEst * error1)</div>
<div class="line"><span class="lineno">  651</span>        BOOST_ERROR(<span class="stringliteral">&quot;can no reproduce deterministic cashflow pricing, is &quot;</span></div>
<div class="line"><span class="lineno">  652</span>                    &lt;&lt; npv1 &lt;&lt; <span class="stringliteral">&quot;, expected &quot;</span> &lt;&lt; expected1 &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tolErrEst &lt;&lt; <span class="stringliteral">&quot;*&quot;</span> &lt;&lt; error1);</div>
<div class="line"><span class="lineno">  653</span> </div>
<div class="line"><span class="lineno">  654</span>    <span class="keywordflow">if</span> (std::fabs(npv2a - npv2b) &gt; tolErrEst * std::sqrt(error2a * error2a + error2b * error2b))</div>
<div class="line"><span class="lineno">  655</span>        BOOST_ERROR(<span class="stringliteral">&quot;can no reproduce zero bond option pricing, domestic &quot;</span></div>
<div class="line"><span class="lineno">  656</span>                    <span class="stringliteral">&quot;measure result is &quot;</span></div>
<div class="line"><span class="lineno">  657</span>                    &lt;&lt; npv2a &lt;&lt; <span class="stringliteral">&quot;, foreign measure result is &quot;</span> &lt;&lt; npv2b &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tolErrEst &lt;&lt; <span class="stringliteral">&quot;*&quot;</span></div>
<div class="line"><span class="lineno">  658</span>                    &lt;&lt; std::sqrt(error2a * error2a + error2b * error2b));</div>
<div class="line"><span class="lineno">  659</span> </div>
<div class="line"><span class="lineno">  660</span>    <span class="keywordflow">if</span> (std::fabs(npv3 - fxOption-&gt;NPV()) &gt; tolErrEst * error3)</div>
<div class="line"><span class="lineno">  661</span>        BOOST_ERROR(<span class="stringliteral">&quot;can no reproduce fx option pricing, monte carlo result is &quot;</span></div>
<div class="line"><span class="lineno">  662</span>                    &lt;&lt; npv3 &lt;&lt; <span class="stringliteral">&quot;, analytical pricing result is &quot;</span> &lt;&lt; fxOption-&gt;NPV() &lt;&lt; <span class="stringliteral">&quot;, tolerance is &quot;</span> &lt;&lt; tolErrEst</div>
<div class="line"><span class="lineno">  663</span>                    &lt;&lt; <span class="stringliteral">&quot;*&quot;</span> &lt;&lt; error3);</div>
<div class="line"><span class="lineno">  664</span> </div>
<div class="line"><span class="lineno">  665</span>} <span class="comment">// testCcyLgm3fForeignPayouts</span></div>
<div class="ttc" id="aclass_quant_ext_1_1_multi_path_generator_mersenne_twister_html"><div class="ttname"><a href="class_quant_ext_1_1_multi_path_generator_mersenne_twister.html">QuantExt::MultiPathGeneratorMersenneTwister</a></div><div class="ttdoc">Instantiation of MultiPathGenerator with standard PseudoRandom traits.</div><div class="ttdef"><b>Definition:</b> <a href="multipathgeneratorbase_8hpp_source.html#l00053">multipathgeneratorbase.hpp:53</a></div></div>
<div class="ttc" id="atest_2commodityschwartzmodel_8cpp_html_a84e1cc7fe4440301cfe72e7c64be988b"><div class="ttname"><a href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a></div><div class="ttdeci">std::vector&lt; Size &gt; steps</div><div class="ttdef"><b>Definition:</b> <a href="test_2commodityschwartzmodel_8cpp_source.html#l00109">commodityschwartzmodel.cpp:109</a></div></div>
</div><!-- fragment --><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="test_2crossassetmodel_8cpp_a0a852d7254bff61434239cbe761e6a71_cgraph.png" border="0" usemap="#atest_2crossassetmodel_8cpp_a0a852d7254bff61434239cbe761e6a71_cgraph" alt=""/></div>
<map name="atest_2crossassetmodel_8cpp_a0a852d7254bff61434239cbe761e6a71_cgraph" id="atest_2crossassetmodel_8cpp_a0a852d7254bff61434239cbe761e6a71_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,196,38"/>
<area shape="rect" href="class_quant_ext_1_1_multi_path_generator_mersenne_twister.html#ad8f5a33568da4f97b76944e9621547e2" title=" " alt="" coords="244,5,441,45"/>
</map>
</div>

</div>
</div>
<a id="aa805d3226078c812c44a7e7c967b3118" name="aa805d3226078c812c44a7e7c967b3118"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa805d3226078c812c44a7e7c967b3118">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[6/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testLgm5fFxCalibration&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l00961">961</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  961</span>                                             {</div>
<div class="line"><span class="lineno">  962</span> </div>
<div class="line"><span class="lineno">  963</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing fx calibration in Ccy LGM 5F model...&quot;</span>);</div>
<div class="line"><span class="lineno">  964</span> </div>
<div class="line"><span class="lineno">  965</span>    Lgm5fTestData d;</div>
<div class="line"><span class="lineno">  966</span> </div>
<div class="line"><span class="lineno">  967</span>    <span class="comment">// we test the 5f model against the 3f model eur-gbp</span></div>
<div class="line"><span class="lineno">  968</span>    std::vector&lt;boost::shared_ptr&lt;Parametrization&gt; &gt; singleModelsProjected;</div>
<div class="line"><span class="lineno">  969</span>    singleModelsProjected.push_back(d.eurLgm_p);</div>
<div class="line"><span class="lineno">  970</span>    singleModelsProjected.push_back(d.gbpLgm_p);</div>
<div class="line"><span class="lineno">  971</span>    singleModelsProjected.push_back(d.fxGbp_p);</div>
<div class="line"><span class="lineno">  972</span> </div>
<div class="line"><span class="lineno">  973</span>    Matrix cProjected(3, 3);</div>
<div class="line"><span class="lineno">  974</span>    <span class="keywordflow">for</span> (Size i = 0, ii = 0; i &lt; 5; ++i) {</div>
<div class="line"><span class="lineno">  975</span>        <span class="keywordflow">if</span> (i != 0 &amp;&amp; i != 3) {</div>
<div class="line"><span class="lineno">  976</span>            <span class="keywordflow">for</span> (Size j = 0, jj = 0; j &lt; 5; ++j) {</div>
<div class="line"><span class="lineno">  977</span>                <span class="keywordflow">if</span> (j != 0 &amp;&amp; j != 3)</div>
<div class="line"><span class="lineno">  978</span>                    cProjected[ii][jj++] = d.c[i][j];</div>
<div class="line"><span class="lineno">  979</span>            }</div>
<div class="line"><span class="lineno">  980</span>            ++ii;</div>
<div class="line"><span class="lineno">  981</span>        }</div>
<div class="line"><span class="lineno">  982</span>    }</div>
<div class="line"><span class="lineno">  983</span> </div>
<div class="line"><span class="lineno">  984</span>    boost::shared_ptr&lt;CrossAssetModel&gt; ccLgmProjected =</div>
<div class="line"><span class="lineno">  985</span>        boost::make_shared&lt;CrossAssetModel&gt;(singleModelsProjected, cProjected, SalvagingAlgorithm::None);</div>
<div class="line"><span class="lineno">  986</span> </div>
<div class="line"><span class="lineno">  987</span>    boost::shared_ptr&lt;AnalyticCcLgmFxOptionEngine&gt; ccLgmFxOptionEngineUsd =</div>
<div class="line"><span class="lineno">  988</span>        boost::make_shared&lt;AnalyticCcLgmFxOptionEngine&gt;(d.ccLgmExact, 0);</div>
<div class="line"><span class="lineno">  989</span> </div>
<div class="line"><span class="lineno">  990</span>    boost::shared_ptr&lt;AnalyticCcLgmFxOptionEngine&gt; ccLgmFxOptionEngineGbp =</div>
<div class="line"><span class="lineno">  991</span>        boost::make_shared&lt;AnalyticCcLgmFxOptionEngine&gt;(d.ccLgmExact, 1);</div>
<div class="line"><span class="lineno">  992</span> </div>
<div class="line"><span class="lineno">  993</span>    boost::shared_ptr&lt;AnalyticCcLgmFxOptionEngine&gt; ccLgmProjectedFxOptionEngineGbp =</div>
<div class="line"><span class="lineno">  994</span>        boost::make_shared&lt;AnalyticCcLgmFxOptionEngine&gt;(ccLgmProjected, 0);</div>
<div class="line"><span class="lineno">  995</span> </div>
<div class="line"><span class="lineno">  996</span>    ccLgmFxOptionEngineUsd-&gt;cache();</div>
<div class="line"><span class="lineno">  997</span>    ccLgmFxOptionEngineGbp-&gt;cache();</div>
<div class="line"><span class="lineno">  998</span>    ccLgmProjectedFxOptionEngineGbp-&gt;cache();</div>
<div class="line"><span class="lineno">  999</span> </div>
<div class="line"><span class="lineno"> 1000</span>    <span class="comment">// while the initial fx vol starts at 0.2 for usd and 0.15 for gbp</span></div>
<div class="line"><span class="lineno"> 1001</span>    <span class="comment">// we calibrate to helpers with 0.15 and 0.2 target implied vol</span></div>
<div class="line"><span class="lineno"> 1002</span>    std::vector&lt;boost::shared_ptr&lt;BlackCalibrationHelper&gt; &gt; helpersUsd, helpersGbp;</div>
<div class="line"><span class="lineno"> 1003</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt;= d.volstepdatesFx.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1004</span>        boost::shared_ptr&lt;BlackCalibrationHelper&gt; tmpUsd = boost::make_shared&lt;FxEqOptionHelper&gt;(</div>
<div class="line"><span class="lineno"> 1005</span>            i &lt; d.volstepdatesFx.size() ? d.volstepdatesFx[i] : d.volstepdatesFx.back() + 365, 0.90, d.fxEurUsd,</div>
<div class="line"><span class="lineno"> 1006</span>            Handle&lt;Quote&gt;(boost::make_shared&lt;SimpleQuote&gt;(0.15)), d.ccLgmExact-&gt;irlgm1f(0)-&gt;termStructure(),</div>
<div class="line"><span class="lineno"> 1007</span>            d.ccLgmExact-&gt;irlgm1f(1)-&gt;termStructure());</div>
<div class="line"><span class="lineno"> 1008</span>        boost::shared_ptr&lt;BlackCalibrationHelper&gt; tmpGbp = boost::make_shared&lt;FxEqOptionHelper&gt;(</div>
<div class="line"><span class="lineno"> 1009</span>            i &lt; d.volstepdatesFx.size() ? d.volstepdatesFx[i] : d.volstepdatesFx.back() + 365, 1.35, d.fxEurGbp,</div>
<div class="line"><span class="lineno"> 1010</span>            Handle&lt;Quote&gt;(boost::make_shared&lt;SimpleQuote&gt;(0.20)), d.ccLgmExact-&gt;irlgm1f(0)-&gt;termStructure(),</div>
<div class="line"><span class="lineno"> 1011</span>            d.ccLgmExact-&gt;irlgm1f(2)-&gt;termStructure());</div>
<div class="line"><span class="lineno"> 1012</span>        tmpUsd-&gt;setPricingEngine(ccLgmFxOptionEngineUsd);</div>
<div class="line"><span class="lineno"> 1013</span>        tmpGbp-&gt;setPricingEngine(ccLgmFxOptionEngineGbp);</div>
<div class="line"><span class="lineno"> 1014</span>        helpersUsd.push_back(tmpUsd);</div>
<div class="line"><span class="lineno"> 1015</span>        helpersGbp.push_back(tmpGbp);</div>
<div class="line"><span class="lineno"> 1016</span>    }</div>
<div class="line"><span class="lineno"> 1017</span> </div>
<div class="line"><span class="lineno"> 1018</span>    LevenbergMarquardt lm(1E-8, 1E-8, 1E-8);</div>
<div class="line"><span class="lineno"> 1019</span>    EndCriteria ec(1000, 500, 1E-8, 1E-8, 1E-8);</div>
<div class="line"><span class="lineno"> 1020</span> </div>
<div class="line"><span class="lineno"> 1021</span>    <span class="comment">// calibrate USD-EUR FX volatility</span></div>
<div class="line"><span class="lineno"> 1022</span>    d.ccLgmExact-&gt;calibrateBsVolatilitiesIterative(CrossAssetModel::AssetType::FX, 0, helpersUsd, lm, ec);</div>
<div class="line"><span class="lineno"> 1023</span>    <span class="comment">// calibrate GBP-EUR FX volatility</span></div>
<div class="line"><span class="lineno"> 1024</span>    d.ccLgmExact-&gt;calibrateBsVolatilitiesIterative(CrossAssetModel::AssetType::FX, 1, helpersGbp, lm, ec);</div>
<div class="line"><span class="lineno"> 1025</span> </div>
<div class="line"><span class="lineno"> 1026</span>    Real tol = 1E-6;</div>
<div class="line"><span class="lineno"> 1027</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; helpersUsd.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1028</span>        Real market = helpersUsd[i]-&gt;marketValue();</div>
<div class="line"><span class="lineno"> 1029</span>        Real model = helpersUsd[i]-&gt;modelValue();</div>
<div class="line"><span class="lineno"> 1030</span>        Real calibratedVol = d.ccLgmExact-&gt;fxbs(0)-&gt;parameterValues(0)[i];</div>
<div class="line"><span class="lineno"> 1031</span>        <span class="keywordflow">if</span> (std::fabs(market - model) &gt; tol) {</div>
<div class="line"><span class="lineno"> 1032</span>            BOOST_ERROR(<span class="stringliteral">&quot;calibration for fx option helper #&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (USD) failed, market premium is &quot;</span> &lt;&lt; market</div>
<div class="line"><span class="lineno"> 1033</span>                                                             &lt;&lt; <span class="stringliteral">&quot; while model premium is &quot;</span> &lt;&lt; model);</div>
<div class="line"><span class="lineno"> 1034</span>        }</div>
<div class="line"><span class="lineno"> 1035</span>        <span class="comment">// the stochastic rates produce some noise, but do not have a huge</span></div>
<div class="line"><span class="lineno"> 1036</span>        <span class="comment">// impact on the effective volatility, so we check that they are</span></div>
<div class="line"><span class="lineno"> 1037</span>        <span class="comment">// in line with a cached example (note that the analytic fx option</span></div>
<div class="line"><span class="lineno"> 1038</span>        <span class="comment">// pricing engine was checked against MC in another test case)</span></div>
<div class="line"><span class="lineno"> 1039</span>        <span class="keywordflow">if</span> (std::fabs(calibratedVol - 0.143) &gt; 0.01) {</div>
<div class="line"><span class="lineno"> 1040</span>            BOOST_ERROR(<span class="stringliteral">&quot;calibrated fx volatility #&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (USD) seems off, expected to be 0.143 +- 0.01, but is &quot;</span></div>
<div class="line"><span class="lineno"> 1041</span>                                                     &lt;&lt; calibratedVol);</div>
<div class="line"><span class="lineno"> 1042</span>        }</div>
<div class="line"><span class="lineno"> 1043</span>    }</div>
<div class="line"><span class="lineno"> 1044</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; helpersGbp.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1045</span>        Real market = helpersGbp[i]-&gt;marketValue();</div>
<div class="line"><span class="lineno"> 1046</span>        Real model = helpersGbp[i]-&gt;modelValue();</div>
<div class="line"><span class="lineno"> 1047</span>        Real calibratedVol = d.ccLgmExact-&gt;fxbs(1)-&gt;parameterValues(0)[i];</div>
<div class="line"><span class="lineno"> 1048</span>        <span class="keywordflow">if</span> (std::fabs(market - model) &gt; tol)</div>
<div class="line"><span class="lineno"> 1049</span>            BOOST_ERROR(<span class="stringliteral">&quot;calibration for fx option helper #&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (GBP) failed, market premium is &quot;</span> &lt;&lt; market</div>
<div class="line"><span class="lineno"> 1050</span>                                                             &lt;&lt; <span class="stringliteral">&quot; while model premium is &quot;</span> &lt;&lt; model);</div>
<div class="line"><span class="lineno"> 1051</span>        <span class="comment">// see above</span></div>
<div class="line"><span class="lineno"> 1052</span>        <span class="keywordflow">if</span> (std::fabs(calibratedVol - 0.193) &gt; 0.01)</div>
<div class="line"><span class="lineno"> 1053</span>            BOOST_ERROR(<span class="stringliteral">&quot;calibrated fx volatility #&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (USD) seems off, expected to be 0.193 +- 0.01, but is &quot;</span></div>
<div class="line"><span class="lineno"> 1054</span>                                                     &lt;&lt; calibratedVol);</div>
<div class="line"><span class="lineno"> 1055</span>    }</div>
<div class="line"><span class="lineno"> 1056</span> </div>
<div class="line"><span class="lineno"> 1057</span>    <span class="comment">// calibrate the projected model</span></div>
<div class="line"><span class="lineno"> 1058</span> </div>
<div class="line"><span class="lineno"> 1059</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; helpersGbp.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1060</span>        helpersGbp[i]-&gt;setPricingEngine(ccLgmProjectedFxOptionEngineGbp);</div>
<div class="line"><span class="lineno"> 1061</span>    }</div>
<div class="line"><span class="lineno"> 1062</span> </div>
<div class="line"><span class="lineno"> 1063</span>    ccLgmProjected-&gt;calibrateBsVolatilitiesIterative(CrossAssetModel::AssetType::FX, 0, helpersGbp, lm, ec);</div>
<div class="line"><span class="lineno"> 1064</span> </div>
<div class="line"><span class="lineno"> 1065</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; helpersGbp.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1066</span>        Real fullModelVol = d.ccLgmExact-&gt;fxbs(1)-&gt;parameterValues(0)[i];</div>
<div class="line"><span class="lineno"> 1067</span>        Real projectedModelVol = ccLgmProjected-&gt;fxbs(0)-&gt;parameterValues(0)[i];</div>
<div class="line"><span class="lineno"> 1068</span>        <span class="keywordflow">if</span> (std::fabs(fullModelVol - projectedModelVol) &gt; tol)</div>
<div class="line"><span class="lineno"> 1069</span>            BOOST_ERROR(<span class="stringliteral">&quot;calibrated fx volatility of full model @&quot;</span></div>
<div class="line"><span class="lineno"> 1070</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; fullModelVol &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with that of the projected model (&quot;</span></div>
<div class="line"><span class="lineno"> 1071</span>                        &lt;&lt; projectedModelVol &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno"> 1072</span>    }</div>
<div class="line"><span class="lineno"> 1073</span> </div>
<div class="line"><span class="lineno"> 1074</span>} <span class="comment">// testLgm5fFxCalibration</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac898aef27142112ab0445cb7be80c42e" name="ac898aef27142112ab0445cb7be80c42e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac898aef27142112ab0445cb7be80c42e">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[7/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testLgm5fFullCalibration&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l01076">1076</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1076</span>                                               {</div>
<div class="line"><span class="lineno"> 1077</span> </div>
<div class="line"><span class="lineno"> 1078</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing full calibration of Ccy LGM 5F model...&quot;</span>);</div>
<div class="line"><span class="lineno"> 1079</span> </div>
<div class="line"><span class="lineno"> 1080</span>    Lgm5fTestData d;</div>
<div class="line"><span class="lineno"> 1081</span> </div>
<div class="line"><span class="lineno"> 1082</span>    <span class="comment">// calibration baskets</span></div>
<div class="line"><span class="lineno"> 1083</span> </div>
<div class="line"><span class="lineno"> 1084</span>    std::vector&lt;boost::shared_ptr&lt;BlackCalibrationHelper&gt; &gt; basketEur, basketUsd, basketGbp, basketEurUsd, basketEurGbp;</div>
<div class="line"><span class="lineno"> 1085</span> </div>
<div class="line"><span class="lineno"> 1086</span>    boost::shared_ptr&lt;IborIndex&gt; euribor6m = boost::make_shared&lt;Euribor&gt;(6 * Months, d.eurYts);</div>
<div class="line"><span class="lineno"> 1087</span>    boost::shared_ptr&lt;IborIndex&gt; usdLibor3m = boost::make_shared&lt;USDLibor&gt;(3 * Months, d.usdYts);</div>
<div class="line"><span class="lineno"> 1088</span>    boost::shared_ptr&lt;IborIndex&gt; gbpLibor3m = boost::make_shared&lt;GBPLibor&gt;(3 * Months, d.gbpYts);</div>
<div class="line"><span class="lineno"> 1089</span> </div>
<div class="line"><span class="lineno"> 1090</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt;= d.volstepdates.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1091</span>        Date tmp = i &lt; d.volstepdates.size() ? d.volstepdates[i] : d.volstepdates.back() + 365;</div>
<div class="line"><span class="lineno"> 1092</span>        <span class="comment">// EUR: atm+200bp, 150bp normal vol</span></div>
<div class="line"><span class="lineno"> 1093</span>        basketEur.push_back(boost::shared_ptr&lt;SwaptionHelper&gt;(<span class="keyword">new</span> SwaptionHelper(</div>
<div class="line"><span class="lineno"> 1094</span>            tmp, 10 * Years, Handle&lt;Quote&gt;(boost::make_shared&lt;SimpleQuote&gt;(0.015)), euribor6m, 1 * Years, Thirty360(Thirty360::BondBasis),</div>
<div class="line"><span class="lineno"> 1095</span>            Actual360(), d.eurYts, BlackCalibrationHelper::RelativePriceError, 0.04, 1.0, Normal)));</div>
<div class="line"><span class="lineno"> 1096</span>        <span class="comment">// USD: atm, 20%, lognormal vol</span></div>
<div class="line"><span class="lineno"> 1097</span>        basketUsd.push_back(boost::shared_ptr&lt;SwaptionHelper&gt;(</div>
<div class="line"><span class="lineno"> 1098</span>            <span class="keyword">new</span> SwaptionHelper(tmp, 10 * Years, Handle&lt;Quote&gt;(boost::make_shared&lt;SimpleQuote&gt;(0.30)), usdLibor3m,</div>
<div class="line"><span class="lineno"> 1099</span>                               1 * Years, Thirty360(Thirty360::BondBasis), Actual360(), d.usdYts,</div>
<div class="line"><span class="lineno"> 1100</span>                               BlackCalibrationHelper::RelativePriceError, Null&lt;Real&gt;(), 1.0, ShiftedLognormal, 0.0)));</div>
<div class="line"><span class="lineno"> 1101</span>        <span class="comment">// GBP: atm-200bp, 10%, shifted lognormal vol with shift = 2%</span></div>
<div class="line"><span class="lineno"> 1102</span>        basketGbp.push_back(boost::shared_ptr&lt;SwaptionHelper&gt;(<span class="keyword">new</span> SwaptionHelper(</div>
<div class="line"><span class="lineno"> 1103</span>            tmp, 10 * Years, Handle&lt;Quote&gt;(boost::make_shared&lt;SimpleQuote&gt;(0.30)), gbpLibor3m, 1 * Years, Thirty360(Thirty360::BondBasis),</div>
<div class="line"><span class="lineno"> 1104</span>            Actual360(), d.usdYts, BlackCalibrationHelper::RelativePriceError, 0.02, 1.0, ShiftedLognormal, 0.02)));</div>
<div class="line"><span class="lineno"> 1105</span>    }</div>
<div class="line"><span class="lineno"> 1106</span> </div>
<div class="line"><span class="lineno"> 1107</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; d.volstepdatesFx.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1108</span>        Date tmp = i &lt; d.volstepdatesFx.size() ? d.volstepdatesFx[i] : d.volstepdatesFx.back() + 365;</div>
<div class="line"><span class="lineno"> 1109</span>        <span class="comment">// EUR-USD: atm, 30% (lognormal) vol</span></div>
<div class="line"><span class="lineno"> 1110</span>        basketEurUsd.push_back(boost::make_shared&lt;FxEqOptionHelper&gt;(</div>
<div class="line"><span class="lineno"> 1111</span>            tmp, Null&lt;Real&gt;(), d.fxEurUsd, Handle&lt;Quote&gt;(boost::make_shared&lt;SimpleQuote&gt;(0.20)), d.eurYts, d.usdYts,</div>
<div class="line"><span class="lineno"> 1112</span>            BlackCalibrationHelper::RelativePriceError));</div>
<div class="line"><span class="lineno"> 1113</span>        <span class="comment">// EUR-GBP: atm, 10% (lognormal) vol</span></div>
<div class="line"><span class="lineno"> 1114</span>        basketEurGbp.push_back(boost::make_shared&lt;FxEqOptionHelper&gt;(</div>
<div class="line"><span class="lineno"> 1115</span>            tmp, Null&lt;Real&gt;(), d.fxEurGbp, Handle&lt;Quote&gt;(boost::make_shared&lt;SimpleQuote&gt;(0.20)), d.eurYts, d.gbpYts,</div>
<div class="line"><span class="lineno"> 1116</span>            BlackCalibrationHelper::RelativePriceError));</div>
<div class="line"><span class="lineno"> 1117</span>    }</div>
<div class="line"><span class="lineno"> 1118</span> </div>
<div class="line"><span class="lineno"> 1119</span>    <span class="comment">// pricing engines</span></div>
<div class="line"><span class="lineno"> 1120</span> </div>
<div class="line"><span class="lineno"> 1121</span>    boost::shared_ptr&lt;PricingEngine&gt; eurSwEng = boost::make_shared&lt;AnalyticLgmSwaptionEngine&gt;(d.ccLgmExact, 0);</div>
<div class="line"><span class="lineno"> 1122</span>    boost::shared_ptr&lt;PricingEngine&gt; usdSwEng = boost::make_shared&lt;AnalyticLgmSwaptionEngine&gt;(d.ccLgmExact, 1);</div>
<div class="line"><span class="lineno"> 1123</span>    boost::shared_ptr&lt;PricingEngine&gt; gbpSwEng = boost::make_shared&lt;AnalyticLgmSwaptionEngine&gt;(d.ccLgmExact, 2);</div>
<div class="line"><span class="lineno"> 1124</span> </div>
<div class="line"><span class="lineno"> 1125</span>    boost::shared_ptr&lt;AnalyticCcLgmFxOptionEngine&gt; eurUsdFxoEng =</div>
<div class="line"><span class="lineno"> 1126</span>        boost::make_shared&lt;AnalyticCcLgmFxOptionEngine&gt;(d.ccLgmExact, 0);</div>
<div class="line"><span class="lineno"> 1127</span>    boost::shared_ptr&lt;AnalyticCcLgmFxOptionEngine&gt; eurGbpFxoEng =</div>
<div class="line"><span class="lineno"> 1128</span>        boost::make_shared&lt;AnalyticCcLgmFxOptionEngine&gt;(d.ccLgmExact, 1);</div>
<div class="line"><span class="lineno"> 1129</span> </div>
<div class="line"><span class="lineno"> 1130</span>    eurUsdFxoEng-&gt;cache();</div>
<div class="line"><span class="lineno"> 1131</span>    eurGbpFxoEng-&gt;cache();</div>
<div class="line"><span class="lineno"> 1132</span> </div>
<div class="line"><span class="lineno"> 1133</span>    <span class="comment">// assign engines to calibration instruments</span></div>
<div class="line"><span class="lineno"> 1134</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basketEur.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1135</span>        basketEur[i]-&gt;setPricingEngine(eurSwEng);</div>
<div class="line"><span class="lineno"> 1136</span>    }</div>
<div class="line"><span class="lineno"> 1137</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basketUsd.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1138</span>        basketUsd[i]-&gt;setPricingEngine(usdSwEng);</div>
<div class="line"><span class="lineno"> 1139</span>    }</div>
<div class="line"><span class="lineno"> 1140</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basketGbp.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1141</span>        basketGbp[i]-&gt;setPricingEngine(gbpSwEng);</div>
<div class="line"><span class="lineno"> 1142</span>    }</div>
<div class="line"><span class="lineno"> 1143</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basketEurUsd.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1144</span>        basketEurUsd[i]-&gt;setPricingEngine(eurUsdFxoEng);</div>
<div class="line"><span class="lineno"> 1145</span>    }</div>
<div class="line"><span class="lineno"> 1146</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basketEurGbp.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1147</span>        basketEurGbp[i]-&gt;setPricingEngine(eurGbpFxoEng);</div>
<div class="line"><span class="lineno"> 1148</span>    }</div>
<div class="line"><span class="lineno"> 1149</span> </div>
<div class="line"><span class="lineno"> 1150</span>    <span class="comment">// calibrate the model</span></div>
<div class="line"><span class="lineno"> 1151</span> </div>
<div class="line"><span class="lineno"> 1152</span>    LevenbergMarquardt lm(1E-8, 1E-8, 1E-8);</div>
<div class="line"><span class="lineno"> 1153</span>    EndCriteria ec(1000, 500, 1E-8, 1E-8, 1E-8);</div>
<div class="line"><span class="lineno"> 1154</span> </div>
<div class="line"><span class="lineno"> 1155</span>    d.ccLgmExact-&gt;calibrateIrLgm1fVolatilitiesIterative(0, basketEur, lm, ec);</div>
<div class="line"><span class="lineno"> 1156</span>    d.ccLgmExact-&gt;calibrateIrLgm1fVolatilitiesIterative(1, basketUsd, lm, ec);</div>
<div class="line"><span class="lineno"> 1157</span>    d.ccLgmExact-&gt;calibrateIrLgm1fVolatilitiesIterative(2, basketGbp, lm, ec);</div>
<div class="line"><span class="lineno"> 1158</span> </div>
<div class="line"><span class="lineno"> 1159</span>    d.ccLgmExact-&gt;calibrateBsVolatilitiesIterative(CrossAssetModel::AssetType::FX, 0, basketEurUsd, lm, ec);</div>
<div class="line"><span class="lineno"> 1160</span>    d.ccLgmExact-&gt;calibrateBsVolatilitiesIterative(CrossAssetModel::AssetType::FX, 1, basketEurGbp, lm, ec);</div>
<div class="line"><span class="lineno"> 1161</span> </div>
<div class="line"><span class="lineno"> 1162</span>    <span class="comment">// check the results</span></div>
<div class="line"><span class="lineno"> 1163</span> </div>
<div class="line"><span class="lineno"> 1164</span>    Real tol = 1E-6;</div>
<div class="line"><span class="lineno"> 1165</span> </div>
<div class="line"><span class="lineno"> 1166</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basketEur.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1167</span>        Real model = basketEur[i]-&gt;modelValue();</div>
<div class="line"><span class="lineno"> 1168</span>        Real market = basketEur[i]-&gt;marketValue();</div>
<div class="line"><span class="lineno"> 1169</span>        <span class="keywordflow">if</span> (std::abs((model - market) / market) &gt; tol)</div>
<div class="line"><span class="lineno"> 1170</span>            BOOST_ERROR(<span class="stringliteral">&quot;calibration failed for instrument #&quot;</span></div>
<div class="line"><span class="lineno"> 1171</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; in EUR basket, model value is &quot;</span> &lt;&lt; model &lt;&lt; <span class="stringliteral">&quot; market value is &quot;</span> &lt;&lt; market</div>
<div class="line"><span class="lineno"> 1172</span>                        &lt;&lt; <span class="stringliteral">&quot; relative error &quot;</span> &lt;&lt; std::abs((model - market) / market) &lt;&lt; <span class="stringliteral">&quot; tolerance &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 1173</span>    }</div>
<div class="line"><span class="lineno"> 1174</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basketUsd.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1175</span>        Real model = basketUsd[i]-&gt;modelValue();</div>
<div class="line"><span class="lineno"> 1176</span>        Real market = basketUsd[i]-&gt;marketValue();</div>
<div class="line"><span class="lineno"> 1177</span>        <span class="keywordflow">if</span> (std::abs((model - market) / market) &gt; tol)</div>
<div class="line"><span class="lineno"> 1178</span>            BOOST_ERROR(<span class="stringliteral">&quot;calibration failed for instrument #&quot;</span></div>
<div class="line"><span class="lineno"> 1179</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; in USD basket, model value is &quot;</span> &lt;&lt; model &lt;&lt; <span class="stringliteral">&quot; market value is &quot;</span> &lt;&lt; market</div>
<div class="line"><span class="lineno"> 1180</span>                        &lt;&lt; <span class="stringliteral">&quot; relative error &quot;</span> &lt;&lt; std::abs((model - market) / market) &lt;&lt; <span class="stringliteral">&quot; tolerance &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 1181</span>    }</div>
<div class="line"><span class="lineno"> 1182</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basketGbp.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1183</span>        Real model = basketGbp[i]-&gt;modelValue();</div>
<div class="line"><span class="lineno"> 1184</span>        Real market = basketGbp[i]-&gt;marketValue();</div>
<div class="line"><span class="lineno"> 1185</span>        <span class="keywordflow">if</span> (std::abs((model - market) / market) &gt; tol)</div>
<div class="line"><span class="lineno"> 1186</span>            BOOST_ERROR(<span class="stringliteral">&quot;calibration failed for instrument #&quot;</span></div>
<div class="line"><span class="lineno"> 1187</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; in GBP basket, model value is &quot;</span> &lt;&lt; model &lt;&lt; <span class="stringliteral">&quot; market value is &quot;</span> &lt;&lt; market</div>
<div class="line"><span class="lineno"> 1188</span>                        &lt;&lt; <span class="stringliteral">&quot; relative error &quot;</span> &lt;&lt; std::abs((model - market) / market) &lt;&lt; <span class="stringliteral">&quot; tolerance &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 1189</span>    }</div>
<div class="line"><span class="lineno"> 1190</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basketEurUsd.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1191</span>        Real model = basketEurUsd[i]-&gt;modelValue();</div>
<div class="line"><span class="lineno"> 1192</span>        Real market = basketEurUsd[i]-&gt;marketValue();</div>
<div class="line"><span class="lineno"> 1193</span>        <span class="keywordflow">if</span> (std::abs((model - market) / market) &gt; tol)</div>
<div class="line"><span class="lineno"> 1194</span>            BOOST_ERROR(<span class="stringliteral">&quot;calibration failed for instrument #&quot;</span></div>
<div class="line"><span class="lineno"> 1195</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; in EUR-USD basket, model value is &quot;</span> &lt;&lt; model &lt;&lt; <span class="stringliteral">&quot; market value is &quot;</span> &lt;&lt; market</div>
<div class="line"><span class="lineno"> 1196</span>                        &lt;&lt; <span class="stringliteral">&quot; relative error &quot;</span> &lt;&lt; std::abs((model - market) / market) &lt;&lt; <span class="stringliteral">&quot; tolerance &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 1197</span>    }</div>
<div class="line"><span class="lineno"> 1198</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basketEurUsd.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1199</span>        Real model = basketEurGbp[i]-&gt;modelValue();</div>
<div class="line"><span class="lineno"> 1200</span>        Real market = basketEurGbp[i]-&gt;marketValue();</div>
<div class="line"><span class="lineno"> 1201</span>        <span class="keywordflow">if</span> (std::abs((model - market) / market) &gt; tol)</div>
<div class="line"><span class="lineno"> 1202</span>            BOOST_ERROR(<span class="stringliteral">&quot;calibration failed for instrument #&quot;</span></div>
<div class="line"><span class="lineno"> 1203</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; in EUR-GBP basket, model value is &quot;</span> &lt;&lt; model &lt;&lt; <span class="stringliteral">&quot; market value is &quot;</span> &lt;&lt; market</div>
<div class="line"><span class="lineno"> 1204</span>                        &lt;&lt; <span class="stringliteral">&quot; relative error &quot;</span> &lt;&lt; std::abs((model - market) / market) &lt;&lt; <span class="stringliteral">&quot; tolerance &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 1205</span>    }</div>
<div class="line"><span class="lineno"> 1206</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac803ea58b611f2153da35dc43b96444a" name="ac803ea58b611f2153da35dc43b96444a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac803ea58b611f2153da35dc43b96444a">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[8/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testLgm5fMoments&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l01208">1208</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1208</span>                                       {</div>
<div class="line"><span class="lineno"> 1209</span> </div>
<div class="line"><span class="lineno"> 1210</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing analytic moments vs. Euler and exact discretization &quot;</span></div>
<div class="line"><span class="lineno"> 1211</span>                       <span class="stringliteral">&quot;in Ccy LGM 5F model...&quot;</span>);</div>
<div class="line"><span class="lineno"> 1212</span> </div>
<div class="line"><span class="lineno"> 1213</span>    Lgm5fTestData d;</div>
<div class="line"><span class="lineno"> 1214</span> </div>
<div class="line"><span class="lineno"> 1215</span>    boost::shared_ptr&lt;StochasticProcess&gt; p_exact = d.ccLgmExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 1216</span>    boost::shared_ptr&lt;StochasticProcess&gt; p_euler = d.ccLgmEuler-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 1217</span> </div>
<div class="line"><span class="lineno"> 1218</span>    Real T = 10.0;                            <span class="comment">// horizon at which we compare the moments</span></div>
<div class="line"><span class="lineno"> 1219</span>    Size <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a> = <span class="keyword">static_cast&lt;</span>Size<span class="keyword">&gt;</span>(T * 10.0); <span class="comment">// number of simulation steps</span></div>
<div class="line"><span class="lineno"> 1220</span>    Size paths = 25000;                       <span class="comment">// number of paths</span></div>
<div class="line"><span class="lineno"> 1221</span> </div>
<div class="line"><span class="lineno"> 1222</span>    Array e_an = p_exact-&gt;expectation(0.0, p_exact-&gt;initialValues(), T);</div>
<div class="line"><span class="lineno"> 1223</span>    Matrix v_an = p_exact-&gt;covariance(0.0, p_exact-&gt;initialValues(), T);</div>
<div class="line"><span class="lineno"> 1224</span> </div>
<div class="line"><span class="lineno"> 1225</span>    TimeGrid grid(T, <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>);</div>
<div class="line"><span class="lineno"> 1226</span> </div>
<div class="line"><span class="lineno"> 1227</span>    <a class="code hl_class" href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html">MultiPathGeneratorSobolBrownianBridge</a> pgen(p_euler, grid);</div>
<div class="line"><span class="lineno"> 1228</span>    <a class="code hl_class" href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html">MultiPathGeneratorSobolBrownianBridge</a> pgen2(p_exact, grid);</div>
<div class="line"><span class="lineno"> 1229</span> </div>
<div class="line"><span class="lineno"> 1230</span>    accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; e_eu[5], e_eu2[5];</div>
<div class="line"><span class="lineno"> 1231</span>    accumulator_set&lt;double, stats&lt;tag::covariance&lt;double, tag::covariate1&gt; &gt; &gt; v_eu[5][5], v_eu2[5][5];</div>
<div class="line"><span class="lineno"> 1232</span> </div>
<div class="line"><span class="lineno"> 1233</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; paths; ++i) {</div>
<div class="line"><span class="lineno"> 1234</span>        Sample&lt;MultiPath&gt; path = pgen.next();</div>
<div class="line"><span class="lineno"> 1235</span>        Sample&lt;MultiPath&gt; path2 = pgen2.next();</div>
<div class="line"><span class="lineno"> 1236</span>        <span class="keywordflow">for</span> (Size ii = 0; ii &lt; 5; ++ii) {</div>
<div class="line"><span class="lineno"> 1237</span>            Real cii = path.value[ii].back();</div>
<div class="line"><span class="lineno"> 1238</span>            Real cii2 = path2.value[ii].back();</div>
<div class="line"><span class="lineno"> 1239</span>            e_eu[ii](cii);</div>
<div class="line"><span class="lineno"> 1240</span>            e_eu2[ii](cii2);</div>
<div class="line"><span class="lineno"> 1241</span>            <span class="keywordflow">for</span> (Size jj = 0; jj &lt;= ii; ++jj) {</div>
<div class="line"><span class="lineno"> 1242</span>                Real cjj = path.value[jj].back();</div>
<div class="line"><span class="lineno"> 1243</span>                v_eu[ii][jj](cii, covariate1 = cjj);</div>
<div class="line"><span class="lineno"> 1244</span>                Real cjj2 = path2.value[jj].back();</div>
<div class="line"><span class="lineno"> 1245</span>                v_eu2[ii][jj](cii2, covariate1 = cjj2);</div>
<div class="line"><span class="lineno"> 1246</span>            }</div>
<div class="line"><span class="lineno"> 1247</span>        }</div>
<div class="line"><span class="lineno"> 1248</span>    }</div>
<div class="line"><span class="lineno"> 1249</span> </div>
<div class="line"><span class="lineno"> 1250</span>    Real errTolLd[] = { 0.2E-4, 0.2E-4, 0.2E-4, 10.0E-4, 10.0E-4 };</div>
<div class="line"><span class="lineno"> 1251</span> </div>
<div class="line"><span class="lineno"> 1252</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; 5; ++i) {</div>
<div class="line"><span class="lineno"> 1253</span>        <span class="comment">// check expectation against analytical calculation (Euler)</span></div>
<div class="line"><span class="lineno"> 1254</span>        <span class="keywordflow">if</span> (std::fabs(mean(e_eu[i]) - e_an[i]) &gt; errTolLd[i]) {</div>
<div class="line"><span class="lineno"> 1255</span>            BOOST_ERROR(<span class="stringliteral">&quot;analytical expectation for component #&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; e_an[i]</div>
<div class="line"><span class="lineno"> 1256</span>                                                                 &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical value (Euler &quot;</span></div>
<div class="line"><span class="lineno"> 1257</span>                                                                    <span class="stringliteral">&quot;discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 1258</span>                                                                 &lt;&lt; mean(e_eu[i]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 1259</span>                                                                 &lt;&lt; e_an[i] - mean(e_eu[i]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 1260</span>                                                                 &lt;&lt; errTolLd[i]);</div>
<div class="line"><span class="lineno"> 1261</span>        }</div>
<div class="line"><span class="lineno"> 1262</span>        <span class="comment">// check expectation against analytical calculation (exact disc)</span></div>
<div class="line"><span class="lineno"> 1263</span>        <span class="keywordflow">if</span> (std::fabs(mean(e_eu2[i]) - e_an[i]) &gt; errTolLd[i]) {</div>
<div class="line"><span class="lineno"> 1264</span>            BOOST_ERROR(<span class="stringliteral">&quot;analytical expectation for component #&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; e_an[i]</div>
<div class="line"><span class="lineno"> 1265</span>                                                                 &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical value (Exact &quot;</span></div>
<div class="line"><span class="lineno"> 1266</span>                                                                    <span class="stringliteral">&quot;discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 1267</span>                                                                 &lt;&lt; mean(e_eu2[i]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 1268</span>                                                                 &lt;&lt; e_an[i] - mean(e_eu2[i]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 1269</span>                                                                 &lt;&lt; errTolLd[i]);</div>
<div class="line"><span class="lineno"> 1270</span>        }</div>
<div class="line"><span class="lineno"> 1271</span>    }</div>
<div class="line"><span class="lineno"> 1272</span> </div>
<div class="line"><span class="lineno"> 1273</span>    <span class="comment">// we have to deal with different natures of volatility</span></div>
<div class="line"><span class="lineno"> 1274</span>    <span class="comment">// for ir (normal) and fx (ln) so different error</span></div>
<div class="line"><span class="lineno"> 1275</span>    <span class="comment">// tolerances apply</span></div>
<div class="line"><span class="lineno"> 1276</span>    Real tollNormal = 0.1E-4; <span class="comment">// ir-ir</span></div>
<div class="line"><span class="lineno"> 1277</span>    Real tolMixed = 0.25E-4;  <span class="comment">// ir-fx</span></div>
<div class="line"><span class="lineno"> 1278</span>    Real tolLn = 8.0E-4;      <span class="comment">// fx-fx</span></div>
<div class="line"><span class="lineno"> 1279</span>    Real tol;                 <span class="comment">// set below</span></div>
<div class="line"><span class="lineno"> 1280</span> </div>
<div class="line"><span class="lineno"> 1281</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; 5; ++i) {</div>
<div class="line"><span class="lineno"> 1282</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 1283</span>            <span class="keywordflow">if</span> (i &lt; 3) {</div>
<div class="line"><span class="lineno"> 1284</span>                tol = tollNormal;</div>
<div class="line"><span class="lineno"> 1285</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1286</span>                <span class="keywordflow">if</span> (j &lt; 3) {</div>
<div class="line"><span class="lineno"> 1287</span>                    tol = tolMixed;</div>
<div class="line"><span class="lineno"> 1288</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1289</span>                    tol = tolLn;</div>
<div class="line"><span class="lineno"> 1290</span>                }</div>
<div class="line"><span class="lineno"> 1291</span>            }</div>
<div class="line"><span class="lineno"> 1292</span>            <span class="keywordflow">if</span> (std::fabs(covariance(v_eu[i][j]) - v_an[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 1293</span>                BOOST_ERROR(<span class="stringliteral">&quot;analytical covariance at (&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;) (&quot;</span> &lt;&lt; v_an[i][j]</div>
<div class="line"><span class="lineno"> 1294</span>                                                         &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical &quot;</span></div>
<div class="line"><span class="lineno"> 1295</span>                                                            <span class="stringliteral">&quot;value (Euler discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 1296</span>                                                         &lt;&lt; covariance(v_eu[i][j]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 1297</span>                                                         &lt;&lt; v_an[i][j] - covariance(v_eu[i][j]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 1298</span>                                                         &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 1299</span>            }</div>
<div class="line"><span class="lineno"> 1300</span>            <span class="keywordflow">if</span> (std::fabs(covariance(v_eu2[i][j]) - v_an[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 1301</span>                BOOST_ERROR(<span class="stringliteral">&quot;analytical covariance at (&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;) (&quot;</span> &lt;&lt; v_an[i][j]</div>
<div class="line"><span class="lineno"> 1302</span>                                                         &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical &quot;</span></div>
<div class="line"><span class="lineno"> 1303</span>                                                            <span class="stringliteral">&quot;value (Exact discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 1304</span>                                                         &lt;&lt; covariance(v_eu2[i][j]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 1305</span>                                                         &lt;&lt; v_an[i][j] - covariance(v_eu2[i][j]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 1306</span>                                                         &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 1307</span>            }</div>
<div class="line"><span class="lineno"> 1308</span>        }</div>
<div class="line"><span class="lineno"> 1309</span>    }</div>
<div class="line"><span class="lineno"> 1310</span> </div>
<div class="line"><span class="lineno"> 1311</span>} <span class="comment">// testLgm5fMoments</span></div>
<div class="ttc" id="aclass_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge_html"><div class="ttname"><a href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html">QuantExt::MultiPathGeneratorSobolBrownianBridge</a></div><div class="ttdoc">Instantiation using SobolBrownianGenerator from models/marketmodels/browniangenerators.</div><div class="ttdef"><b>Definition:</b> <a href="multipathgeneratorbase_8hpp_source.html#l00102">multipathgeneratorbase.hpp:102</a></div></div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="test_2crossassetmodel_8cpp_ac803ea58b611f2153da35dc43b96444a_cgraph.png" border="0" usemap="#atest_2crossassetmodel_8cpp_ac803ea58b611f2153da35dc43b96444a_cgraph" alt=""/></div>
<map name="atest_2crossassetmodel_8cpp_ac803ea58b611f2153da35dc43b96444a_cgraph" id="atest_2crossassetmodel_8cpp_ac803ea58b611f2153da35dc43b96444a_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,196,38"/>
<area shape="rect" href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html#ad8f5a33568da4f97b76944e9621547e2" title=" " alt="" coords="244,5,441,45"/>
</map>
</div>

</div>
</div>
<a id="ae727668e620dbe4a01fafc4b6f038954" name="ae727668e620dbe4a01fafc4b6f038954"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae727668e620dbe4a01fafc4b6f038954">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[9/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testLgmGsrEquivalence&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l01313">1313</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1313</span>                                            {</div>
<div class="line"><span class="lineno"> 1314</span> </div>
<div class="line"><span class="lineno"> 1315</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing equivalence of GSR and LGM models...&quot;</span>);</div>
<div class="line"><span class="lineno"> 1316</span> </div>
<div class="line"><span class="lineno"> 1317</span>    SavedSettings backup;</div>
<div class="line"><span class="lineno"> 1318</span> </div>
<div class="line"><span class="lineno"> 1319</span>    Date evalDate(12, January, 2015);</div>
<div class="line"><span class="lineno"> 1320</span>    Settings::instance().evaluationDate() = evalDate;</div>
<div class="line"><span class="lineno"> 1321</span>    Handle&lt;YieldTermStructure&gt; yts(boost::make_shared&lt;FlatForward&gt;(evalDate, 0.02, Actual365Fixed()));</div>
<div class="line"><span class="lineno"> 1322</span> </div>
<div class="line"><span class="lineno"> 1323</span>    Real T[] = { 10.0, 20.0, 50.0, 100.0 };</div>
<div class="line"><span class="lineno"> 1324</span>    Real sigma[] = { 0.0050, 0.01, 0.02 };</div>
<div class="line"><span class="lineno"> 1325</span>    Real kappa[] = { -0.02, -0.01, 0.0, 0.03, 0.07 };</div>
<div class="line"><span class="lineno"> 1326</span> </div>
<div class="line"><span class="lineno"> 1327</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; <a class="code hl_define" href="utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(T); ++i) {</div>
<div class="line"><span class="lineno"> 1328</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt; <a class="code hl_define" href="utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(sigma); ++j) {</div>
<div class="line"><span class="lineno"> 1329</span>            <span class="keywordflow">for</span> (Size k = 0; k &lt; <a class="code hl_define" href="utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(kappa); ++k) {</div>
<div class="line"><span class="lineno"> 1330</span> </div>
<div class="line"><span class="lineno"> 1331</span>                std::vector&lt;Date&gt; stepDates;</div>
<div class="line"><span class="lineno"> 1332</span>                std::vector&lt;Real&gt; sigmas(1, sigma[j]);</div>
<div class="line"><span class="lineno"> 1333</span> </div>
<div class="line"><span class="lineno"> 1334</span>                boost::shared_ptr&lt;Gsr&gt; gsr = boost::make_shared&lt;Gsr&gt;(yts, stepDates, sigmas, kappa[k], T[i]);</div>
<div class="line"><span class="lineno"> 1335</span> </div>
<div class="line"><span class="lineno"> 1336</span>                Array stepTimes_a(0);</div>
<div class="line"><span class="lineno"> 1337</span>                Array sigmas_a(1, sigma[j]);</div>
<div class="line"><span class="lineno"> 1338</span>                Array kappas_a(1, kappa[k]);</div>
<div class="line"><span class="lineno"> 1339</span> </div>
<div class="line"><span class="lineno"> 1340</span>                <span class="comment">// for shift = -H(T) we change the LGM measure to the T forward</span></div>
<div class="line"><span class="lineno"> 1341</span>                <span class="comment">// measure effectively</span></div>
<div class="line"><span class="lineno"> 1342</span>                Real shift = <a class="code hl_function" href="namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(kappa[k], 0.0) ? -T[i] : -(1.0 - std::exp(-kappa[k] * T[i])) / kappa[k];</div>
<div class="line"><span class="lineno"> 1343</span>                boost::shared_ptr&lt;IrLgm1fParametrization&gt; lgm_p =</div>
<div class="line"><span class="lineno"> 1344</span>                    boost::make_shared&lt;IrLgm1fPiecewiseConstantHullWhiteAdaptor&gt;(EURCurrency(), yts, stepTimes_a,</div>
<div class="line"><span class="lineno"> 1345</span>                                                                                 sigmas_a, stepTimes_a, kappas_a);</div>
<div class="line"><span class="lineno"> 1346</span>                lgm_p-&gt;shift() = shift;</div>
<div class="line"><span class="lineno"> 1347</span> </div>
<div class="line"><span class="lineno"> 1348</span>                boost::shared_ptr&lt;LinearGaussMarkovModel&gt; lgm = boost::make_shared&lt;LinearGaussMarkovModel&gt;(lgm_p);</div>
<div class="line"><span class="lineno"> 1349</span> </div>
<div class="line"><span class="lineno"> 1350</span>                boost::shared_ptr&lt;StochasticProcess1D&gt; gsr_process = gsr-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 1351</span>                boost::shared_ptr&lt;StochasticProcess1D&gt; lgm_process =</div>
<div class="line"><span class="lineno"> 1352</span>                    boost::dynamic_pointer_cast&lt;StochasticProcess1D&gt;(lgm-&gt;stateProcess());</div>
<div class="line"><span class="lineno"> 1353</span> </div>
<div class="line"><span class="lineno"> 1354</span>                Size N = 10000; <span class="comment">// number of paths</span></div>
<div class="line"><span class="lineno"> 1355</span>                Size seed = 123456;</div>
<div class="line"><span class="lineno"> 1356</span>                Size <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a> = 1;       <span class="comment">// one large step</span></div>
<div class="line"><span class="lineno"> 1357</span>                Real T2 = T[i] - 5.0; <span class="comment">// we check a distribution at this time</span></div>
<div class="line"><span class="lineno"> 1358</span> </div>
<div class="line"><span class="lineno"> 1359</span>                TimeGrid grid(T2, <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>);</div>
<div class="line"><span class="lineno"> 1360</span> </div>
<div class="line"><span class="lineno"> 1361</span>                PseudoRandom::rsg_type sg = PseudoRandom::make_sequence_generator(<a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a> * 1, seed);</div>
<div class="line"><span class="lineno"> 1362</span>                PathGenerator&lt;PseudoRandom::rsg_type&gt; pgen_gsr(gsr_process, grid, sg, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1363</span>                PathGenerator&lt;PseudoRandom::rsg_type&gt; pgen_lgm(lgm_process, grid, sg, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1364</span> </div>
<div class="line"><span class="lineno"> 1365</span>                accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt;, tag::variance&gt; &gt; stat_lgm, stat_gsr;</div>
<div class="line"><span class="lineno"> 1366</span> </div>
<div class="line"><span class="lineno"> 1367</span>                Real tol = 1.0E-12;</div>
<div class="line"><span class="lineno"> 1368</span>                <span class="keywordflow">for</span> (Size ii = 0; ii &lt; N; ++ii) {</div>
<div class="line"><span class="lineno"> 1369</span>                    Sample&lt;Path&gt; path_lgm = pgen_lgm.next();</div>
<div class="line"><span class="lineno"> 1370</span>                    Sample&lt;Path&gt; path_gsr = pgen_gsr.next();</div>
<div class="line"><span class="lineno"> 1371</span>                    Real yGsr = (path_gsr.value.back() - gsr_process-&gt;expectation(0.0, 0.0, T2)) /</div>
<div class="line"><span class="lineno"> 1372</span>                                gsr_process-&gt;stdDeviation(0.0, 0.0, T2);</div>
<div class="line"><span class="lineno"> 1373</span>                    Real xLgm = path_lgm.value.back();</div>
<div class="line"><span class="lineno"> 1374</span>                    Real gsrRate = -std::log(gsr-&gt;zerobond(T2 + 1.0, T2, yGsr));</div>
<div class="line"><span class="lineno"> 1375</span>                    <span class="comment">// it&#39;s nice to have uniform interfaces in all models ...</span></div>
<div class="line"><span class="lineno"> 1376</span>                    Real lgmRate = -std::log(lgm-&gt;discountBond(T2, T2 + 1.0, xLgm));</div>
<div class="line"><span class="lineno"> 1377</span>                    stat_gsr(gsrRate);</div>
<div class="line"><span class="lineno"> 1378</span>                    stat_lgm(lgmRate);</div>
<div class="line"><span class="lineno"> 1379</span>                    <span class="comment">// check pathwise identity</span></div>
<div class="line"><span class="lineno"> 1380</span>                    <span class="keywordflow">if</span> (std::fabs(gsrRate - lgmRate) &gt;= tol) {</div>
<div class="line"><span class="lineno"> 1381</span>                        BOOST_ERROR(<span class="stringliteral">&quot;lgm rate (&quot;</span> &lt;&lt; lgmRate &lt;&lt; <span class="stringliteral">&quot;) deviates from gsr rate (&quot;</span> &lt;&lt; gsrRate &lt;&lt; <span class="stringliteral">&quot;) on path #&quot;</span></div>
<div class="line"><span class="lineno"> 1382</span>                                                 &lt;&lt; i);</div>
<div class="line"><span class="lineno"> 1383</span>                    }</div>
<div class="line"><span class="lineno"> 1384</span>                }</div>
<div class="line"><span class="lineno"> 1385</span> </div>
<div class="line"><span class="lineno"> 1386</span>                <span class="comment">// effectively we are checking a pathwise identity</span></div>
<div class="line"><span class="lineno"> 1387</span>                <span class="comment">// here as well, but the statistics seems to better</span></div>
<div class="line"><span class="lineno"> 1388</span>                <span class="comment">// summarize a possible problem, so we output differences</span></div>
<div class="line"><span class="lineno"> 1389</span>                <span class="comment">// in the mean as well</span></div>
<div class="line"><span class="lineno"> 1390</span>                <span class="keywordflow">if</span> (std::fabs(mean(stat_gsr) - mean(stat_lgm)) &gt; tol ||</div>
<div class="line"><span class="lineno"> 1391</span>                    std::fabs(variance(stat_gsr) - variance(stat_lgm)) &gt; tol) {</div>
<div class="line"><span class="lineno"> 1392</span>                    BOOST_ERROR(<span class="stringliteral">&quot;failed to verify LGM-GSR equivalence, &quot;</span></div>
<div class="line"><span class="lineno"> 1393</span>                                <span class="stringliteral">&quot;(mean,variance) of zero rate is (&quot;</span></div>
<div class="line"><span class="lineno"> 1394</span>                                &lt;&lt; mean(stat_gsr) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; variance(stat_gsr) &lt;&lt; <span class="stringliteral">&quot;) for GSR, (&quot;</span> &lt;&lt; mean(stat_lgm)</div>
<div class="line"><span class="lineno"> 1395</span>                                &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; variance(stat_lgm) &lt;&lt; <span class="stringliteral">&quot;) for LGM, for T=&quot;</span> &lt;&lt; T[i] &lt;&lt; <span class="stringliteral">&quot;, sigma=&quot;</span> &lt;&lt; sigma[j]</div>
<div class="line"><span class="lineno"> 1396</span>                                &lt;&lt; <span class="stringliteral">&quot;, kappa=&quot;</span> &lt;&lt; kappa[k] &lt;&lt; <span class="stringliteral">&quot;, shift=&quot;</span> &lt;&lt; shift);</div>
<div class="line"><span class="lineno"> 1397</span>                }</div>
<div class="line"><span class="lineno"> 1398</span>            }</div>
<div class="line"><span class="lineno"> 1399</span>        }</div>
<div class="line"><span class="lineno"> 1400</span>    }</div>
<div class="line"><span class="lineno"> 1401</span> </div>
<div class="line"><span class="lineno"> 1402</span>} <span class="comment">// testLgmGsrEquivalence</span></div>
<div class="ttc" id="autilities_8hpp_html_ad0e13d94164219be2d5bbd4d65e71d1e"><div class="ttname"><a href="utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a></div><div class="ttdeci">#define LENGTH(a)</div><div class="ttdef"><b>Definition:</b> <a href="utilities_8hpp_source.html#l00027">utilities.hpp:27</a></div></div>
</div><!-- fragment --><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="test_2crossassetmodel_8cpp_ae727668e620dbe4a01fafc4b6f038954_cgraph.png" border="0" usemap="#atest_2crossassetmodel_8cpp_ae727668e620dbe4a01fafc4b6f038954_cgraph" alt=""/></div>
<map name="atest_2crossassetmodel_8cpp_ae727668e620dbe4a01fafc4b6f038954_cgraph" id="atest_2crossassetmodel_8cpp_ae727668e620dbe4a01fafc4b6f038954_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,196,31"/>
<area shape="rect" href="namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5" title=" " alt="" coords="244,5,409,31"/>
</map>
</div>

</div>
</div>
<a id="a4be9b6573285ff076d712d27f3cf5b99" name="a4be9b6573285ff076d712d27f3cf5b99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4be9b6573285ff076d712d27f3cf5b99">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[10/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testLgmMcWithShift&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l01404">1404</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1404</span>                                         {</div>
<div class="line"><span class="lineno"> 1405</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing LGM1F Monte Carlo simulation with shifted H...&quot;</span>);</div>
<div class="line"><span class="lineno"> 1406</span> </div>
<div class="line"><span class="lineno"> 1407</span>    <span class="comment">// cashflow time</span></div>
<div class="line"><span class="lineno"> 1408</span>    Real T = 50.0;</div>
<div class="line"><span class="lineno"> 1409</span> </div>
<div class="line"><span class="lineno"> 1410</span>    <span class="comment">// shift horizons</span></div>
<div class="line"><span class="lineno"> 1411</span>    Real T_shift[] = { 0.0, 10.0, 20.0, 30.0, 40.0, 50.0 };</div>
<div class="line"><span class="lineno"> 1412</span> </div>
<div class="line"><span class="lineno"> 1413</span>    <span class="comment">// tolerances for error of mean</span></div>
<div class="line"><span class="lineno"> 1414</span>    Real eom_tol[] = { 0.17, 0.05, 0.02, 0.01, 0.005, 1.0E-12 };</div>
<div class="line"><span class="lineno"> 1415</span> </div>
<div class="line"><span class="lineno"> 1416</span>    Handle&lt;YieldTermStructure&gt; yts(boost::make_shared&lt;FlatForward&gt;(0, NullCalendar(), 0.02, Actual365Fixed()));</div>
<div class="line"><span class="lineno"> 1417</span> </div>
<div class="line"><span class="lineno"> 1418</span>    boost::shared_ptr&lt;IrLgm1fParametrization&gt; lgm =</div>
<div class="line"><span class="lineno"> 1419</span>        boost::make_shared&lt;IrLgm1fConstantParametrization&gt;(EURCurrency(), yts, 0.01, 0.01);</div>
<div class="line"><span class="lineno"> 1420</span>    boost::shared_ptr&lt;StochasticProcess&gt; p = boost::make_shared&lt;IrLgm1fStateProcess&gt;(lgm);</div>
<div class="line"><span class="lineno"> 1421</span> </div>
<div class="line"><span class="lineno"> 1422</span>    boost::shared_ptr&lt;LinearGaussMarkovModel&gt; model = boost::make_shared&lt;LinearGaussMarkovModel&gt;(lgm);</div>
<div class="line"><span class="lineno"> 1423</span> </div>
<div class="line"><span class="lineno"> 1424</span>    Size <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a> = 1;</div>
<div class="line"><span class="lineno"> 1425</span>    Size paths = 10000;</div>
<div class="line"><span class="lineno"> 1426</span>    Size seed = 42;</div>
<div class="line"><span class="lineno"> 1427</span>    TimeGrid grid(T, <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>);</div>
<div class="line"><span class="lineno"> 1428</span> </div>
<div class="line"><span class="lineno"> 1429</span>    <a class="code hl_class" href="class_quant_ext_1_1_multi_path_generator_mersenne_twister.html">MultiPathGeneratorMersenneTwister</a> pgen(p, grid, seed, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1430</span> </div>
<div class="line"><span class="lineno"> 1431</span>    <span class="keywordflow">for</span> (Size ii = 0; ii &lt; <a class="code hl_define" href="utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(T_shift); ++ii) {</div>
<div class="line"><span class="lineno"> 1432</span> </div>
<div class="line"><span class="lineno"> 1433</span>        lgm-&gt;shift() = -(1.0 - <a class="code hl_function" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9">exp</a>(-0.01 * T_shift[ii])) / 0.01;</div>
<div class="line"><span class="lineno"> 1434</span> </div>
<div class="line"><span class="lineno"> 1435</span>        accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; e_eu;</div>
<div class="line"><span class="lineno"> 1436</span> </div>
<div class="line"><span class="lineno"> 1437</span>        <span class="keywordflow">for</span> (Size i = 0; i &lt; paths; ++i) {</div>
<div class="line"><span class="lineno"> 1438</span>            Sample&lt;MultiPath&gt; path = pgen.next();</div>
<div class="line"><span class="lineno"> 1439</span>            Sample&lt;MultiPath&gt; path_a = pgen.next();</div>
<div class="line"><span class="lineno"> 1440</span>            e_eu(1.0 / model-&gt;numeraire(T, path.value[0].back()));</div>
<div class="line"><span class="lineno"> 1441</span>            e_eu(1.0 / model-&gt;numeraire(T, path_a.value[0].back()));</div>
<div class="line"><span class="lineno"> 1442</span>        }</div>
<div class="line"><span class="lineno"> 1443</span> </div>
<div class="line"><span class="lineno"> 1444</span>        Real discount = yts-&gt;discount(T);</div>
<div class="line"><span class="lineno"> 1445</span> </div>
<div class="line"><span class="lineno"> 1446</span>        <span class="keywordflow">if</span> (error_of&lt;tag::mean&gt;(e_eu) / discount &gt; eom_tol[ii]) {</div>
<div class="line"><span class="lineno"> 1447</span>            BOOST_ERROR(<span class="stringliteral">&quot;estimated error of mean for shifted mc simulation with shift &quot;</span></div>
<div class="line"><span class="lineno"> 1448</span>                        &lt;&lt; T_shift[ii] &lt;&lt; <span class="stringliteral">&quot; can not be verified (&quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(e_eu) / discount</div>
<div class="line"><span class="lineno"> 1449</span>                        &lt;&lt; <span class="stringliteral">&quot;), tolerance is 1E-8&quot;</span>);</div>
<div class="line"><span class="lineno"> 1450</span>        }</div>
<div class="line"><span class="lineno"> 1451</span> </div>
<div class="line"><span class="lineno"> 1452</span>        <span class="keywordflow">if</span> (std::fabs(mean(e_eu) / discount - 1.0) &gt; eom_tol[ii]) {</div>
<div class="line"><span class="lineno"> 1453</span>            BOOST_ERROR(<span class="stringliteral">&quot;estimated error for shifted mc simulation with shift &quot;</span> &lt;&lt; T_shift[ii]</div>
<div class="line"><span class="lineno"> 1454</span>                                                                                &lt;&lt; <span class="stringliteral">&quot; can not &quot;</span></div>
<div class="line"><span class="lineno"> 1455</span>                                                                                   <span class="stringliteral">&quot;be verified (&quot;</span></div>
<div class="line"><span class="lineno"> 1456</span>                                                                                &lt;&lt; mean(e_eu) / discount - 1.0</div>
<div class="line"><span class="lineno"> 1457</span>                                                                                &lt;&lt; <span class="stringliteral">&quot;), tolerance is 1E-8&quot;</span>);</div>
<div class="line"><span class="lineno"> 1458</span>        }</div>
<div class="line"><span class="lineno"> 1459</span>    }</div>
<div class="line"><span class="lineno"> 1460</span> </div>
<div class="line"><span class="lineno"> 1461</span>} <span class="comment">// testLgmMcWithShift</span></div>
<div class="ttc" id="anamespace_quant_ext_html_a11171c842d01ffacc4ec522e398070a9"><div class="ttname"><a href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9">QuantExt::exp</a></div><div class="ttdeci">RandomVariable exp(RandomVariable x)</div><div class="ttdef"><b>Definition:</b> <a href="qle_2math_2randomvariable_8cpp_source.html#l00445">randomvariable.cpp:445</a></div></div>
</div><!-- fragment --><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="test_2crossassetmodel_8cpp_a4be9b6573285ff076d712d27f3cf5b99_cgraph.png" border="0" usemap="#atest_2crossassetmodel_8cpp_a4be9b6573285ff076d712d27f3cf5b99_cgraph" alt=""/></div>
<map name="atest_2crossassetmodel_8cpp_a4be9b6573285ff076d712d27f3cf5b99_cgraph" id="atest_2crossassetmodel_8cpp_a4be9b6573285ff076d712d27f3cf5b99_cgraph">
<area shape="rect" title=" " alt="" coords="5,35,196,60"/>
<area shape="rect" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9" title=" " alt="" coords="289,5,396,31"/>
<area shape="rect" href="class_quant_ext_1_1_multi_path_generator_mersenne_twister.html#ad8f5a33568da4f97b76944e9621547e2" title=" " alt="" coords="244,55,441,95"/>
</map>
</div>

</div>
</div>
<a id="a27aa91f8a54f4e16c2108c81069baad0" name="a27aa91f8a54f4e16c2108c81069baad0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27aa91f8a54f4e16c2108c81069baad0">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[11/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testIrFxCrCirppMartingaleProperty&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l01463">1463</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1463</span>                                                        {</div>
<div class="line"><span class="lineno"> 1464</span> </div>
<div class="line"><span class="lineno"> 1465</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing martingale property in ir-fx-cr(lgm)-cf(cir++) model for &quot;</span></div>
<div class="line"><span class="lineno"> 1466</span>                       <span class="stringliteral">&quot;Euler and exact discretizations...&quot;</span>);</div>
<div class="line"><span class="lineno"> 1467</span> </div>
<div class="line"><span class="lineno"> 1468</span>    IrFxCrModelTestData d(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1469</span>    IrFxCrModelTestData d_cirpp(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1470</span> </div>
<div class="line"><span class="lineno"> 1471</span>    boost::shared_ptr&lt;StochasticProcess&gt; process1 = d.modelExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 1472</span>    boost::shared_ptr&lt;StochasticProcess&gt; process2 = d_cirpp.modelEuler-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 1473</span> </div>
<div class="line"><span class="lineno"> 1474</span>    Size n = 10000;                         <span class="comment">// number of paths</span></div>
<div class="line"><span class="lineno"> 1475</span>    Size seed = 18;                         <span class="comment">// rng seed</span></div>
<div class="line"><span class="lineno"> 1476</span>    Time T = 2.0;                          <span class="comment">// maturity of payoff</span></div>
<div class="line"><span class="lineno"> 1477</span>    Time T2 = 20.0;                         <span class="comment">// zerobond maturity</span></div>
<div class="line"><span class="lineno"> 1478</span>    Size <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a> = <span class="keyword">static_cast&lt;</span>Size<span class="keyword">&gt;</span>(T * 24); <span class="comment">// number of steps taken (euler / Brigo-Alfonsi)</span></div>
<div class="line"><span class="lineno"> 1479</span> </div>
<div class="line"><span class="lineno"> 1480</span>    LowDiscrepancy::rsg_type sg1 = LowDiscrepancy::make_sequence_generator(process1-&gt;factors() * 1, seed);</div>
<div class="line"><span class="lineno"> 1481</span>    LowDiscrepancy::rsg_type sg2 = LowDiscrepancy::make_sequence_generator(process2-&gt;factors() * <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>, seed);</div>
<div class="line"><span class="lineno"> 1482</span> </div>
<div class="line"><span class="lineno"> 1483</span>    TimeGrid grid1(T, 1);</div>
<div class="line"><span class="lineno"> 1484</span>    MultiPathGenerator&lt;LowDiscrepancy::rsg_type&gt; pg1(process1, grid1, sg1, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1485</span>    TimeGrid grid2(T, <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>);</div>
<div class="line"><span class="lineno"> 1486</span>    MultiPathGenerator&lt;LowDiscrepancy::rsg_type&gt; pg2(process2, grid2, sg2, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1487</span> </div>
<div class="line"><span class="lineno"> 1488</span>    accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; eurzb1, usdzb1, gbpzb1, n1eur1, n2usd1,</div>
<div class="line"><span class="lineno"> 1489</span>        n3gbp1;</div>
<div class="line"><span class="lineno"> 1490</span>    accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; eurzb2, usdzb2, gbpzb2, n1eur2, n2usd2,</div>
<div class="line"><span class="lineno"> 1491</span>        n3gbp2, n1cir2, n2cir2, n3cir2;</div>
<div class="line"><span class="lineno"> 1492</span> </div>
<div class="line"><span class="lineno"> 1493</span>    <span class="keywordflow">for</span> (Size j = 0; j &lt; n; ++j) {</div>
<div class="line"><span class="lineno"> 1494</span>        Sample&lt;MultiPath&gt; path1 = pg1.next();</div>
<div class="line"><span class="lineno"> 1495</span>        Sample&lt;MultiPath&gt; path2 = pg2.next();</div>
<div class="line"><span class="lineno"> 1496</span>        Size l1 = path1.value[0].length() - 1;</div>
<div class="line"><span class="lineno"> 1497</span>        Size l2 = path2.value[0].length() - 1;</div>
<div class="line"><span class="lineno"> 1498</span>        Real zeur1 = path1.value[0][l1];</div>
<div class="line"><span class="lineno"> 1499</span>        Real zusd1 = path1.value[1][l1];</div>
<div class="line"><span class="lineno"> 1500</span>        Real zgbp1 = path1.value[2][l1];</div>
<div class="line"><span class="lineno"> 1501</span>        Real fxusd1 = std::exp(path1.value[3][l1]);</div>
<div class="line"><span class="lineno"> 1502</span>        Real fxgbp1 = std::exp(path1.value[4][l1]);</div>
<div class="line"><span class="lineno"> 1503</span>        Real crzn11 = path1.value[5][l1];</div>
<div class="line"><span class="lineno"> 1504</span>        Real cryn11 = path1.value[6][l1];</div>
<div class="line"><span class="lineno"> 1505</span>        Real crzn21 = path1.value[7][l1];</div>
<div class="line"><span class="lineno"> 1506</span>        Real cryn21 = path1.value[8][l1];</div>
<div class="line"><span class="lineno"> 1507</span>        Real crzn31 = path1.value[9][l1];</div>
<div class="line"><span class="lineno"> 1508</span>        Real cryn31 = path1.value[10][l1];</div>
<div class="line"><span class="lineno"> 1509</span>        Real zeur2 = path2.value[0][l2];</div>
<div class="line"><span class="lineno"> 1510</span>        Real zusd2 = path2.value[1][l2];</div>
<div class="line"><span class="lineno"> 1511</span>        Real zgbp2 = path2.value[2][l2];</div>
<div class="line"><span class="lineno"> 1512</span>        Real fxusd2 = std::exp(path2.value[3][l2]);</div>
<div class="line"><span class="lineno"> 1513</span>        Real fxgbp2 = std::exp(path2.value[4][l2]);</div>
<div class="line"><span class="lineno"> 1514</span>        Real crzn12 = path2.value[5][l2]; <span class="comment">// CR LGM</span></div>
<div class="line"><span class="lineno"> 1515</span>        Real cryn12 = path2.value[6][l2];</div>
<div class="line"><span class="lineno"> 1516</span>        Real crzn22 = path2.value[7][l2];</div>
<div class="line"><span class="lineno"> 1517</span>        Real cryn22 = path2.value[8][l2];</div>
<div class="line"><span class="lineno"> 1518</span>        Real crzn32 = path2.value[9][l2];</div>
<div class="line"><span class="lineno"> 1519</span>        Real cryn32 = path2.value[10][l2];</div>
<div class="line"><span class="lineno"> 1520</span>        Real ciry12 = path2.value[11][l2]; <span class="comment">// CR CIR++</span></div>
<div class="line"><span class="lineno"> 1521</span>        Real cirn12 = path2.value[12][l2];</div>
<div class="line"><span class="lineno"> 1522</span>        Real ciry22 = path2.value[13][l2];</div>
<div class="line"><span class="lineno"> 1523</span>        Real cirn22 = path2.value[14][l2];</div>
<div class="line"><span class="lineno"> 1524</span>        Real ciry32 = path2.value[15][l2];</div>
<div class="line"><span class="lineno"> 1525</span>        Real cirn32 = path2.value[16][l2];</div>
<div class="line"><span class="lineno"> 1526</span> </div>
<div class="line"><span class="lineno"> 1527</span>        <span class="comment">// EUR zerobond</span></div>
<div class="line"><span class="lineno"> 1528</span>        eurzb1(d.modelExact-&gt;discountBond(0, T, T2, zeur1) / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 1529</span>        <span class="comment">// USD zerobond</span></div>
<div class="line"><span class="lineno"> 1530</span>        usdzb1(d.modelExact-&gt;discountBond(1, T, T2, zusd1) * fxusd1 / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 1531</span>        <span class="comment">// GBP zerobond</span></div>
<div class="line"><span class="lineno"> 1532</span>        gbpzb1(d.modelExact-&gt;discountBond(2, T, T2, zgbp1) * fxgbp1 / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 1533</span>        <span class="comment">// EUR defaultable zerobond for name 1</span></div>
<div class="line"><span class="lineno"> 1534</span>        std::pair&lt;Real, Real&gt; sn11 = d.modelExact-&gt;crlgm1fS(0, 0, T, T2, crzn11, cryn11);</div>
<div class="line"><span class="lineno"> 1535</span>        n1eur1(sn11.first * sn11.second * d.modelExact-&gt;discountBond(0, T, T2, zeur1) / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 1536</span>        <span class="comment">// USD defaultable zerobond for name 2</span></div>
<div class="line"><span class="lineno"> 1537</span>        std::pair&lt;Real, Real&gt; sn21 = d.modelExact-&gt;crlgm1fS(1, 1, T, T2, crzn21, cryn21);</div>
<div class="line"><span class="lineno"> 1538</span>        n2usd1(sn21.first * sn21.second * d.modelExact-&gt;discountBond(1, T, T2, zusd1) * fxusd1 /</div>
<div class="line"><span class="lineno"> 1539</span>               d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 1540</span>        <span class="comment">// GBP defaultable zerobond for name 3</span></div>
<div class="line"><span class="lineno"> 1541</span>        std::pair&lt;Real, Real&gt; sn31 = d.modelExact-&gt;crlgm1fS(2, 2, T, T2, crzn31, cryn31);</div>
<div class="line"><span class="lineno"> 1542</span>        n3gbp1(sn31.first * sn31.second * d.modelExact-&gt;discountBond(2, T, T2, zgbp1) * fxgbp1 /</div>
<div class="line"><span class="lineno"> 1543</span>               d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 1544</span> </div>
<div class="line"><span class="lineno"> 1545</span>        <span class="comment">// EUR zerobond</span></div>
<div class="line"><span class="lineno"> 1546</span>        eurzb2(d_cirpp.modelEuler-&gt;discountBond(0, T, T2, zeur2) / d_cirpp.modelEuler-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 1547</span>        <span class="comment">// USD zerobond</span></div>
<div class="line"><span class="lineno"> 1548</span>        usdzb2(d_cirpp.modelEuler-&gt;discountBond(1, T, T2, zusd2) * fxusd2 / d_cirpp.modelEuler-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 1549</span>        <span class="comment">// GBP zerobond</span></div>
<div class="line"><span class="lineno"> 1550</span>        gbpzb2(d_cirpp.modelEuler-&gt;discountBond(2, T, T2, zgbp2) * fxgbp2 / d_cirpp.modelEuler-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 1551</span>        <span class="comment">// EUR defaultable zerobond for name 1</span></div>
<div class="line"><span class="lineno"> 1552</span>        std::pair&lt;Real, Real&gt; sn12 = d_cirpp.modelEuler-&gt;crlgm1fS(0, 0, T, T2, crzn12, cryn12);</div>
<div class="line"><span class="lineno"> 1553</span>        n1eur2(sn12.first * sn12.second * d_cirpp.modelEuler-&gt;discountBond(0, T, T2, zeur2) / d_cirpp.modelEuler-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 1554</span>        <span class="comment">// USD defaultable zerobond for name 2</span></div>
<div class="line"><span class="lineno"> 1555</span>        std::pair&lt;Real, Real&gt; sn22 = d_cirpp.modelEuler-&gt;crlgm1fS(1, 1, T, T2, crzn22, cryn22);</div>
<div class="line"><span class="lineno"> 1556</span>        n2usd2(sn22.first * sn22.second * d_cirpp.modelEuler-&gt;discountBond(1, T, T2, zusd2) * fxusd2 /</div>
<div class="line"><span class="lineno"> 1557</span>               d_cirpp.modelEuler-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 1558</span>        <span class="comment">// GBP defaultable zerobond for name 3</span></div>
<div class="line"><span class="lineno"> 1559</span>        std::pair&lt;Real, Real&gt; sn32 = d_cirpp.modelEuler-&gt;crlgm1fS(2, 2, T, T2, crzn32, cryn32);</div>
<div class="line"><span class="lineno"> 1560</span>        n3gbp2(sn32.first * sn32.second * d_cirpp.modelEuler-&gt;discountBond(2, T, T2, zgbp2) * fxgbp2 /</div>
<div class="line"><span class="lineno"> 1561</span>               d_cirpp.modelEuler-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 1562</span>        <span class="comment">// EUR defaultable zerobond for name 1 (CIR++)</span></div>
<div class="line"><span class="lineno"> 1563</span>        std::pair&lt;Real, Real&gt; sc12 = d_cirpp.modelEuler-&gt;crcirppS(3, T, T2, ciry12, cirn12);</div>
<div class="line"><span class="lineno"> 1564</span>        n1cir2(sc12.first * sc12.second * d_cirpp.modelEuler-&gt;discountBond(0, T, T2, zeur2) / d_cirpp.modelEuler-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 1565</span>        <span class="comment">// USD defaultable zerobond for name 2 (CIR++)</span></div>
<div class="line"><span class="lineno"> 1566</span>        std::pair&lt;Real, Real&gt; sc22 = d_cirpp.modelEuler-&gt;crcirppS(4, T, T2, ciry22, cirn22);</div>
<div class="line"><span class="lineno"> 1567</span>        n2cir2(sc22.first * sc22.second * d_cirpp.modelEuler-&gt;discountBond(1, T, T2, zusd2) * fxusd2 /</div>
<div class="line"><span class="lineno"> 1568</span>               d_cirpp.modelEuler-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 1569</span>        <span class="comment">// GBP defaultable zerobond for name 3 (CIR++)</span></div>
<div class="line"><span class="lineno"> 1570</span>        std::pair&lt;Real, Real&gt; sc32 = d_cirpp.modelEuler-&gt;crcirppS(5, T, T2, ciry32, cirn32);</div>
<div class="line"><span class="lineno"> 1571</span>        n3cir2(sc32.first * sc32.second * d_cirpp.modelEuler-&gt;discountBond(2, T, T2, zgbp2) * fxgbp2 /</div>
<div class="line"><span class="lineno"> 1572</span>               d_cirpp.modelEuler-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 1573</span>    }</div>
<div class="line"><span class="lineno"> 1574</span> </div>
<div class="line"><span class="lineno"> 1575</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;EXACT:&quot;</span>);</div>
<div class="line"><span class="lineno"> 1576</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;EUR zb = &quot;</span> &lt;&lt; mean(eurzb1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(eurzb1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 1577</span>                                   &lt;&lt; d.eurYts-&gt;discount(T2));</div>
<div class="line"><span class="lineno"> 1578</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;USD zb = &quot;</span> &lt;&lt; mean(usdzb1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(usdzb1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 1579</span>                                   &lt;&lt; d.usdYts-&gt;discount(T2) * d.fxEurUsd-&gt;value());</div>
<div class="line"><span class="lineno"> 1580</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;GBP zb = &quot;</span> &lt;&lt; mean(gbpzb1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(gbpzb1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 1581</span>                                   &lt;&lt; d.gbpYts-&gt;discount(T2) * d.fxEurGbp-&gt;value());</div>
<div class="line"><span class="lineno"> 1582</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;N1 zb EUR = &quot;</span> &lt;&lt; mean(n1eur1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(n1eur1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 1583</span>                                      &lt;&lt; d.eurYts-&gt;discount(T2) * d.n1Ts-&gt;survivalProbability(T2));</div>
<div class="line"><span class="lineno"> 1584</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;N2 zb USD = &quot;</span> &lt;&lt; mean(n2usd1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(n2usd1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 1585</span>                                      &lt;&lt; d.fxEurUsd-&gt;value() * d.usdYts-&gt;discount(T2) *</div>
<div class="line"><span class="lineno"> 1586</span>                                             d.n2Ts-&gt;survivalProbability(T2));</div>
<div class="line"><span class="lineno"> 1587</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;N3 zb GBP = &quot;</span> &lt;&lt; mean(n3gbp1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(n3gbp1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 1588</span>                                      &lt;&lt; d.fxEurGbp-&gt;value() * d.gbpYts-&gt;discount(T2) *</div>
<div class="line"><span class="lineno"> 1589</span>                                             d.n3Ts-&gt;survivalProbability(T2));</div>
<div class="line"><span class="lineno"> 1590</span> </div>
<div class="line"><span class="lineno"> 1591</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;\nEULER:&quot;</span>);</div>
<div class="line"><span class="lineno"> 1592</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;EUR zb = &quot;</span> &lt;&lt; mean(eurzb2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(eurzb2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 1593</span>                                   &lt;&lt; d_cirpp.eurYts-&gt;discount(T2));</div>
<div class="line"><span class="lineno"> 1594</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;USD zb = &quot;</span> &lt;&lt; mean(usdzb2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(usdzb2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 1595</span>                                   &lt;&lt; d_cirpp.usdYts-&gt;discount(T2) * d_cirpp.fxEurUsd-&gt;value());</div>
<div class="line"><span class="lineno"> 1596</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;GBP zb = &quot;</span> &lt;&lt; mean(gbpzb2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(gbpzb2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 1597</span>                                   &lt;&lt; d_cirpp.gbpYts-&gt;discount(T2) * d_cirpp.fxEurGbp-&gt;value());</div>
<div class="line"><span class="lineno"> 1598</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;N1 zb EUR = &quot;</span> &lt;&lt; mean(n1eur2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(n1eur2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 1599</span>                                      &lt;&lt; d_cirpp.eurYts-&gt;discount(T2) * d_cirpp.n1Ts-&gt;survivalProbability(T2));</div>
<div class="line"><span class="lineno"> 1600</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;N2 zb USD = &quot;</span> &lt;&lt; mean(n2usd2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(n2usd2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 1601</span>                                      &lt;&lt; d_cirpp.fxEurUsd-&gt;value() * d_cirpp.usdYts-&gt;discount(T2) *</div>
<div class="line"><span class="lineno"> 1602</span>                                             d_cirpp.n2Ts-&gt;survivalProbability(T2));</div>
<div class="line"><span class="lineno"> 1603</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;N3 zb GBP = &quot;</span> &lt;&lt; mean(n3gbp2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(n3gbp2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 1604</span>                                      &lt;&lt; d_cirpp.fxEurGbp-&gt;value() * d_cirpp.gbpYts-&gt;discount(T2) *</div>
<div class="line"><span class="lineno"> 1605</span>                                             d_cirpp.n3Ts-&gt;survivalProbability(T2));</div>
<div class="line"><span class="lineno"> 1606</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;N1 zb EUR = &quot;</span> &lt;&lt; mean(n1cir2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(n1cir2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 1607</span>                                      &lt;&lt; d_cirpp.eurYts-&gt;discount(T2) * d_cirpp.n1Ts-&gt;survivalProbability(T2));</div>
<div class="line"><span class="lineno"> 1608</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;N2 zb USD = &quot;</span> &lt;&lt; mean(n2cir2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(n2cir2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 1609</span>                                      &lt;&lt; d_cirpp.fxEurUsd-&gt;value() * d_cirpp.usdYts-&gt;discount(T2) *</div>
<div class="line"><span class="lineno"> 1610</span>                                             d_cirpp.n2Ts-&gt;survivalProbability(T2));</div>
<div class="line"><span class="lineno"> 1611</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;N3 zb GBP = &quot;</span> &lt;&lt; mean(n3cir2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(n3cir2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 1612</span>                                      &lt;&lt; d_cirpp.fxEurGbp-&gt;value() * d_cirpp.gbpYts-&gt;discount(T2) *</div>
<div class="line"><span class="lineno"> 1613</span>                                             d_cirpp.n3Ts-&gt;survivalProbability(T2));</div>
<div class="line"><span class="lineno"> 1614</span> </div>
<div class="line"><span class="lineno"> 1615</span>    Real tol1 = 2.0E-4;  <span class="comment">// EXACT</span></div>
<div class="line"><span class="lineno"> 1616</span>    Real tol2 = 12.0E-4; <span class="comment">// EULER</span></div>
<div class="line"><span class="lineno"> 1617</span> </div>
<div class="line"><span class="lineno"> 1618</span>    Real ev = d.eurYts-&gt;discount(T2);</div>
<div class="line"><span class="lineno"> 1619</span>    <span class="keywordflow">if</span> (std::abs(mean(eurzb1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 1620</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for eurzb (exact discr.), expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(eurzb1)</div>
<div class="line"><span class="lineno"> 1621</span>                                                                                 &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 1622</span>    ev = d.usdYts-&gt;discount(T2) * d.fxEurUsd-&gt;value();</div>
<div class="line"><span class="lineno"> 1623</span>    <span class="keywordflow">if</span> (std::abs(mean(usdzb1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 1624</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for usdzb (exact discr.), expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(usdzb1)</div>
<div class="line"><span class="lineno"> 1625</span>                                                                                 &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 1626</span>    ev = d.gbpYts-&gt;discount(T2) * d.fxEurGbp-&gt;value();</div>
<div class="line"><span class="lineno"> 1627</span>    <span class="keywordflow">if</span> (std::abs(mean(gbpzb1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 1628</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for gbpzb (exact discr.), expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(gbpzb1)</div>
<div class="line"><span class="lineno"> 1629</span>                                                                                 &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 1630</span>    ev = d.eurYts-&gt;discount(T2) * d.n1Ts-&gt;survivalProbability(T2);</div>
<div class="line"><span class="lineno"> 1631</span>    <span class="keywordflow">if</span> (std::abs(mean(n1eur1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 1632</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for n1eur (exact discr.), expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(n1eur1)</div>
<div class="line"><span class="lineno"> 1633</span>                                                                                 &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 1634</span>    ev = d.fxEurUsd-&gt;value() * d.usdYts-&gt;discount(T2) * d.n2Ts-&gt;survivalProbability(T2);</div>
<div class="line"><span class="lineno"> 1635</span>    <span class="keywordflow">if</span> (std::abs(mean(n2usd1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 1636</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for n2usd (exact discr.), expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(n2usd1)</div>
<div class="line"><span class="lineno"> 1637</span>                                                                                 &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 1638</span>    ev = d.fxEurGbp-&gt;value() * d.gbpYts-&gt;discount(T2) * d.n3Ts-&gt;survivalProbability(T2);</div>
<div class="line"><span class="lineno"> 1639</span>    <span class="keywordflow">if</span> (std::abs(mean(n3gbp1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 1640</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for n3gbp (exact discr.), expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(n3gbp1)</div>
<div class="line"><span class="lineno"> 1641</span>                                                                                 &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 1642</span> </div>
<div class="line"><span class="lineno"> 1643</span>    ev = d_cirpp.eurYts-&gt;discount(T2);</div>
<div class="line"><span class="lineno"> 1644</span>    <span class="keywordflow">if</span> (std::abs(mean(eurzb2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 1645</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for eurzb (Euler discr.), expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(eurzb2)</div>
<div class="line"><span class="lineno"> 1646</span>                                                                                 &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2);</div>
<div class="line"><span class="lineno"> 1647</span>    ev = d_cirpp.usdYts-&gt;discount(T2) * d_cirpp.fxEurUsd-&gt;value();</div>
<div class="line"><span class="lineno"> 1648</span>    <span class="keywordflow">if</span> (std::abs(mean(usdzb2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 1649</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for usdzb (Euler discr.), expected &quot;</span></div>
<div class="line"><span class="lineno"> 1650</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(usdzb2) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2 * error_of&lt;tag::mean&gt;(usdzb2));</div>
<div class="line"><span class="lineno"> 1651</span>    ev = d_cirpp.gbpYts-&gt;discount(T2) * d_cirpp.fxEurGbp-&gt;value();</div>
<div class="line"><span class="lineno"> 1652</span>    <span class="keywordflow">if</span> (std::abs(mean(gbpzb2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 1653</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for gbpzb (Euler discr.), expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(gbpzb2)</div>
<div class="line"><span class="lineno"> 1654</span>                                                                                 &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2);</div>
<div class="line"><span class="lineno"> 1655</span> </div>
<div class="line"><span class="lineno"> 1656</span>    <span class="comment">// CR LGM</span></div>
<div class="line"><span class="lineno"> 1657</span>    ev = d_cirpp.eurYts-&gt;discount(T2) * d_cirpp.n1Ts-&gt;survivalProbability(T2);</div>
<div class="line"><span class="lineno"> 1658</span>    <span class="keywordflow">if</span> (std::abs(mean(n1eur2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 1659</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for n1eur (Euler discr.), expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(n1eur2)</div>
<div class="line"><span class="lineno"> 1660</span>                                                                                 &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2);</div>
<div class="line"><span class="lineno"> 1661</span>    ev = d_cirpp.fxEurUsd-&gt;value() * d_cirpp.usdYts-&gt;discount(T2) * d_cirpp.n2Ts-&gt;survivalProbability(T2);</div>
<div class="line"><span class="lineno"> 1662</span>    <span class="keywordflow">if</span> (std::abs(mean(n2usd2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 1663</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for n2usd (Euler discr.), expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(n2usd2)</div>
<div class="line"><span class="lineno"> 1664</span>                                                                                 &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2);</div>
<div class="line"><span class="lineno"> 1665</span>    ev = d_cirpp.fxEurGbp-&gt;value() * d_cirpp.gbpYts-&gt;discount(T2) * d_cirpp.n3Ts-&gt;survivalProbability(T2);</div>
<div class="line"><span class="lineno"> 1666</span>    <span class="keywordflow">if</span> (std::abs(mean(n3gbp2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 1667</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for n3gbp (Euler discr.), expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(n3gbp2)</div>
<div class="line"><span class="lineno"> 1668</span>                                                                                 &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2);</div>
<div class="line"><span class="lineno"> 1669</span> </div>
<div class="line"><span class="lineno"> 1670</span>    <span class="comment">// CR CIR</span></div>
<div class="line"><span class="lineno"> 1671</span>    ev = d_cirpp.eurYts-&gt;discount(T2) * d_cirpp.n1Ts-&gt;survivalProbability(T2);</div>
<div class="line"><span class="lineno"> 1672</span>    <span class="keywordflow">if</span> (std::abs(mean(n1cir2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 1673</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for n1cir (Euler discr.), expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(n1cir2)</div>
<div class="line"><span class="lineno"> 1674</span>                                                                                 &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2);</div>
<div class="line"><span class="lineno"> 1675</span>    ev = d_cirpp.fxEurUsd-&gt;value() * d_cirpp.usdYts-&gt;discount(T2) * d_cirpp.n2Ts-&gt;survivalProbability(T2);</div>
<div class="line"><span class="lineno"> 1676</span>    <span class="keywordflow">if</span> (std::abs(mean(n2cir2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 1677</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for n2cir2 (Euler discr.), expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(n2cir2)</div>
<div class="line"><span class="lineno"> 1678</span>                                                                                 &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2);</div>
<div class="line"><span class="lineno"> 1679</span>    ev = d_cirpp.fxEurGbp-&gt;value() * d_cirpp.gbpYts-&gt;discount(T2) * d_cirpp.n3Ts-&gt;survivalProbability(T2);</div>
<div class="line"><span class="lineno"> 1680</span>    <span class="keywordflow">if</span> (std::abs(mean(n3cir2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 1681</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for n3cir2 (Euler discr.), expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(n3cir2)</div>
<div class="line"><span class="lineno"> 1682</span>                                                                                 &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2);</div>
<div class="line"><span class="lineno"> 1683</span> </div>
<div class="line"><span class="lineno"> 1684</span>} <span class="comment">// testIrFxCrMartingaleProperty</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa5f98fe0b75d1c67826a58638cdc792f" name="aa5f98fe0b75d1c67826a58638cdc792f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5f98fe0b75d1c67826a58638cdc792f">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[12/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testIrFxCrMoments&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l01686">1686</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1686</span>                                        {</div>
<div class="line"><span class="lineno"> 1687</span> </div>
<div class="line"><span class="lineno"> 1688</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing analytic moments vs. Euler and exact discretization &quot;</span></div>
<div class="line"><span class="lineno"> 1689</span>                       <span class="stringliteral">&quot;in ir-fx-cr model...&quot;</span>);</div>
<div class="line"><span class="lineno"> 1690</span> </div>
<div class="line"><span class="lineno"> 1691</span>    IrFxCrModelTestData d;</div>
<div class="line"><span class="lineno"> 1692</span> </div>
<div class="line"><span class="lineno"> 1693</span>    boost::shared_ptr&lt;StochasticProcess&gt; p_exact = d.modelExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 1694</span>    boost::shared_ptr&lt;StochasticProcess&gt; p_euler = d.modelEuler-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 1695</span> </div>
<div class="line"><span class="lineno"> 1696</span>    Real T = 2.0;                           <span class="comment">// horizon at which we compare the moments</span></div>
<div class="line"><span class="lineno"> 1697</span>    Size <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a> = <span class="keyword">static_cast&lt;</span>Size<span class="keyword">&gt;</span>(T * 10); <span class="comment">// number of simulation steps (Euler and exact)</span></div>
<div class="line"><span class="lineno"> 1698</span>    Size paths = 50000;                     <span class="comment">// number of paths</span></div>
<div class="line"><span class="lineno"> 1699</span> </div>
<div class="line"><span class="lineno"> 1700</span>    Array e_an = p_exact-&gt;expectation(0.0, p_exact-&gt;initialValues(), T);</div>
<div class="line"><span class="lineno"> 1701</span>    Matrix v_an = p_exact-&gt;covariance(0.0, p_exact-&gt;initialValues(), T);</div>
<div class="line"><span class="lineno"> 1702</span> </div>
<div class="line"><span class="lineno"> 1703</span>    Size seed = 18;</div>
<div class="line"><span class="lineno"> 1704</span>    TimeGrid grid(T, <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>);</div>
<div class="line"><span class="lineno"> 1705</span> </div>
<div class="line"><span class="lineno"> 1706</span>    <a class="code hl_class" href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html">MultiPathGeneratorSobolBrownianBridge</a> pgen(p_euler, grid, SobolBrownianGenerator::Diagonal, seed,</div>
<div class="line"><span class="lineno"> 1707</span>                                               SobolRsg::JoeKuoD7);</div>
<div class="line"><span class="lineno"> 1708</span>    <a class="code hl_class" href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html">MultiPathGeneratorSobolBrownianBridge</a> pgen2(p_exact, grid, SobolBrownianGenerator::Diagonal, seed,</div>
<div class="line"><span class="lineno"> 1709</span>                                                SobolRsg::JoeKuoD7);</div>
<div class="line"><span class="lineno"> 1710</span> </div>
<div class="line"><span class="lineno"> 1711</span>    accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; e_eu[11], e_eu2[11];</div>
<div class="line"><span class="lineno"> 1712</span>    accumulator_set&lt;double, stats&lt;tag::covariance&lt;double, tag::covariate1&gt; &gt; &gt; v_eu[11][11], v_eu2[11][11];</div>
<div class="line"><span class="lineno"> 1713</span> </div>
<div class="line"><span class="lineno"> 1714</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; paths; ++i) {</div>
<div class="line"><span class="lineno"> 1715</span>        Sample&lt;MultiPath&gt; path = pgen.next();</div>
<div class="line"><span class="lineno"> 1716</span>        Sample&lt;MultiPath&gt; path2 = pgen2.next();</div>
<div class="line"><span class="lineno"> 1717</span>        <span class="keywordflow">for</span> (Size ii = 0; ii &lt; 11; ++ii) {</div>
<div class="line"><span class="lineno"> 1718</span>            Real cii = path.value[ii].back();</div>
<div class="line"><span class="lineno"> 1719</span>            Real cii2 = path2.value[ii].back();</div>
<div class="line"><span class="lineno"> 1720</span>            e_eu[ii](cii);</div>
<div class="line"><span class="lineno"> 1721</span>            e_eu2[ii](cii2);</div>
<div class="line"><span class="lineno"> 1722</span>            <span class="keywordflow">for</span> (Size jj = 0; jj &lt;= ii; ++jj) {</div>
<div class="line"><span class="lineno"> 1723</span>                Real cjj = path.value[jj].back();</div>
<div class="line"><span class="lineno"> 1724</span>                v_eu[ii][jj](cii, covariate1 = cjj);</div>
<div class="line"><span class="lineno"> 1725</span>                Real cjj2 = path2.value[jj].back();</div>
<div class="line"><span class="lineno"> 1726</span>                v_eu2[ii][jj](cii2, covariate1 = cjj2);</div>
<div class="line"><span class="lineno"> 1727</span>            }</div>
<div class="line"><span class="lineno"> 1728</span>        }</div>
<div class="line"><span class="lineno"> 1729</span>    }</div>
<div class="line"><span class="lineno"> 1730</span> </div>
<div class="line"><span class="lineno"> 1731</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; 11; ++i) {</div>
<div class="line"><span class="lineno"> 1732</span>        BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;E_&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; e_an[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; mean(e_eu[i]) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; mean(e_eu2[i]));</div>
<div class="line"><span class="lineno"> 1733</span>    }</div>
<div class="line"><span class="lineno"> 1734</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;==================&quot;</span>);</div>
<div class="line"><span class="lineno"> 1735</span> </div>
<div class="line"><span class="lineno"> 1736</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;one step analytical&quot;</span>);</div>
<div class="line"><span class="lineno"> 1737</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; 11; ++i) {</div>
<div class="line"><span class="lineno"> 1738</span>        std::ostringstream tmp;</div>
<div class="line"><span class="lineno"> 1739</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 1740</span>            tmp &lt;&lt; v_an[i][j] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><span class="lineno"> 1741</span>        }</div>
<div class="line"><span class="lineno"> 1742</span>        BOOST_TEST_MESSAGE(tmp.str());</div>
<div class="line"><span class="lineno"> 1743</span>    }</div>
<div class="line"><span class="lineno"> 1744</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;==================&quot;</span>);</div>
<div class="line"><span class="lineno"> 1745</span> </div>
<div class="line"><span class="lineno"> 1746</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;euler&quot;</span>);</div>
<div class="line"><span class="lineno"> 1747</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; 11; ++i) {</div>
<div class="line"><span class="lineno"> 1748</span>        std::ostringstream tmp;</div>
<div class="line"><span class="lineno"> 1749</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 1750</span>            tmp &lt;&lt; covariance(v_eu[i][j]) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><span class="lineno"> 1751</span>        }</div>
<div class="line"><span class="lineno"> 1752</span>        BOOST_TEST_MESSAGE(tmp.str());</div>
<div class="line"><span class="lineno"> 1753</span>    }</div>
<div class="line"><span class="lineno"> 1754</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;==================&quot;</span>);</div>
<div class="line"><span class="lineno"> 1755</span> </div>
<div class="line"><span class="lineno"> 1756</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;exact&quot;</span>);</div>
<div class="line"><span class="lineno"> 1757</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; 11; ++i) {</div>
<div class="line"><span class="lineno"> 1758</span>        std::ostringstream tmp;</div>
<div class="line"><span class="lineno"> 1759</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 1760</span>            tmp &lt;&lt; covariance(v_eu2[i][j]) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><span class="lineno"> 1761</span>        }</div>
<div class="line"><span class="lineno"> 1762</span>        BOOST_TEST_MESSAGE(tmp.str());</div>
<div class="line"><span class="lineno"> 1763</span>    }</div>
<div class="line"><span class="lineno"> 1764</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;==================&quot;</span>);</div>
<div class="line"><span class="lineno"> 1765</span> </div>
<div class="line"><span class="lineno"> 1766</span>    Real errTolLd[] = { 0.5E-4, 0.5E-4, 0.5E-4, 10.0E-4, 10.0E-4, 0.7E-4, 0.7E-4, 0.7E-4, 0.7E-4, 0.7E-4, 0.7E-4 };</div>
<div class="line"><span class="lineno"> 1767</span> </div>
<div class="line"><span class="lineno"> 1768</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; 11; ++i) {</div>
<div class="line"><span class="lineno"> 1769</span>        <span class="comment">// check expectation against analytical calculation (Euler)</span></div>
<div class="line"><span class="lineno"> 1770</span>        <span class="keywordflow">if</span> (std::fabs(mean(e_eu[i]) - e_an[i]) &gt; errTolLd[i]) {</div>
<div class="line"><span class="lineno"> 1771</span>            BOOST_ERROR(<span class="stringliteral">&quot;analytical expectation for component #&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; e_an[i]</div>
<div class="line"><span class="lineno"> 1772</span>                                                                 &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical value (Euler &quot;</span></div>
<div class="line"><span class="lineno"> 1773</span>                                                                    <span class="stringliteral">&quot;discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 1774</span>                                                                 &lt;&lt; mean(e_eu[i]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 1775</span>                                                                 &lt;&lt; e_an[i] - mean(e_eu[i]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 1776</span>                                                                 &lt;&lt; errTolLd[i]);</div>
<div class="line"><span class="lineno"> 1777</span>        }</div>
<div class="line"><span class="lineno"> 1778</span>        <span class="comment">// check expectation against analytical calculation (exact disc)</span></div>
<div class="line"><span class="lineno"> 1779</span>        <span class="keywordflow">if</span> (std::fabs(mean(e_eu2[i]) - e_an[i]) &gt; errTolLd[i]) {</div>
<div class="line"><span class="lineno"> 1780</span>            BOOST_ERROR(<span class="stringliteral">&quot;analytical expectation for component #&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; e_an[i]</div>
<div class="line"><span class="lineno"> 1781</span>                                                                 &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical value (exact &quot;</span></div>
<div class="line"><span class="lineno"> 1782</span>                                                                    <span class="stringliteral">&quot;discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 1783</span>                                                                 &lt;&lt; mean(e_eu2[i]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 1784</span>                                                                 &lt;&lt; e_an[i] - mean(e_eu2[i]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 1785</span>                                                                 &lt;&lt; errTolLd[i]);</div>
<div class="line"><span class="lineno"> 1786</span>        }</div>
<div class="line"><span class="lineno"> 1787</span>    }</div>
<div class="line"><span class="lineno"> 1788</span> </div>
<div class="line"><span class="lineno"> 1789</span>    <span class="comment">// this is a bit rough compared to the more differentiated test</span></div>
<div class="line"><span class="lineno"> 1790</span>    <span class="comment">// of the IR-FX model ...</span></div>
<div class="line"><span class="lineno"> 1791</span>    Real tol = 10.0E-4;</div>
<div class="line"><span class="lineno"> 1792</span> </div>
<div class="line"><span class="lineno"> 1793</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; 11; ++i) {</div>
<div class="line"><span class="lineno"> 1794</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 1795</span>            <span class="keywordflow">if</span> (std::fabs(covariance(v_eu[i][j]) - v_an[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 1796</span>                BOOST_ERROR(<span class="stringliteral">&quot;analytical covariance at (&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;) (&quot;</span> &lt;&lt; v_an[i][j]</div>
<div class="line"><span class="lineno"> 1797</span>                                                         &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical &quot;</span></div>
<div class="line"><span class="lineno"> 1798</span>                                                            <span class="stringliteral">&quot;value (Euler discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 1799</span>                                                         &lt;&lt; covariance(v_eu[i][j]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 1800</span>                                                         &lt;&lt; v_an[i][j] - covariance(v_eu[i][j]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 1801</span>                                                         &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 1802</span>            }</div>
<div class="line"><span class="lineno"> 1803</span>            <span class="keywordflow">if</span> (std::fabs(covariance(v_eu2[i][j]) - v_an[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 1804</span>                BOOST_ERROR(<span class="stringliteral">&quot;analytical covariance at (&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;) (&quot;</span> &lt;&lt; v_an[i][j]</div>
<div class="line"><span class="lineno"> 1805</span>                                                         &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical &quot;</span></div>
<div class="line"><span class="lineno"> 1806</span>                                                            <span class="stringliteral">&quot;value (exact discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 1807</span>                                                         &lt;&lt; covariance(v_eu2[i][j]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 1808</span>                                                         &lt;&lt; v_an[i][j] - covariance(v_eu2[i][j]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 1809</span>                                                         &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 1810</span>            }</div>
<div class="line"><span class="lineno"> 1811</span>        }</div>
<div class="line"><span class="lineno"> 1812</span>    }</div>
<div class="line"><span class="lineno"> 1813</span> </div>
<div class="line"><span class="lineno"> 1814</span>} <span class="comment">// testIrFxCrMoments</span></div>
</div><!-- fragment --><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="test_2crossassetmodel_8cpp_aa5f98fe0b75d1c67826a58638cdc792f_cgraph.png" border="0" usemap="#atest_2crossassetmodel_8cpp_aa5f98fe0b75d1c67826a58638cdc792f_cgraph" alt=""/></div>
<map name="atest_2crossassetmodel_8cpp_aa5f98fe0b75d1c67826a58638cdc792f_cgraph" id="atest_2crossassetmodel_8cpp_aa5f98fe0b75d1c67826a58638cdc792f_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,196,38"/>
<area shape="rect" href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html#ad8f5a33568da4f97b76944e9621547e2" title=" " alt="" coords="244,5,441,45"/>
</map>
</div>

</div>
</div>
<a id="a9c37030f2044afb608c297cfd4e7489a" name="a9c37030f2044afb608c297cfd4e7489a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c37030f2044afb608c297cfd4e7489a">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[13/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testIrFxCrCorrelationRecovery&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l01816">1816</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1816</span>                                                    {</div>
<div class="line"><span class="lineno"> 1817</span> </div>
<div class="line"><span class="lineno"> 1818</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Test if random correlation input is recovered for &quot;</span></div>
<div class="line"><span class="lineno"> 1819</span>                       <span class="stringliteral">&quot;small dt in ir-fx-cr model...&quot;</span>);</div>
<div class="line"><span class="lineno"> 1820</span> </div>
<div class="line"><span class="lineno"> 1821</span>    <span class="keyword">class </span>PseudoCurrency : <span class="keyword">public</span> Currency {</div>
<div class="line"><span class="lineno"> 1822</span>    <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno"> 1823</span>        PseudoCurrency(<span class="keyword">const</span> Size <span class="keywordtype">id</span>) {</div>
<div class="line"><span class="lineno"> 1824</span>            std::ostringstream ln, sn;</div>
<div class="line"><span class="lineno"> 1825</span>            ln &lt;&lt; <span class="stringliteral">&quot;Dummy &quot;</span> &lt;&lt; id;</div>
<div class="line"><span class="lineno"> 1826</span>            sn &lt;&lt; <span class="stringliteral">&quot;DUM &quot;</span> &lt;&lt; id;</div>
<div class="line"><span class="lineno"> 1827</span>            data_ = boost::make_shared&lt;Data&gt;(ln.str(), sn.str(), <span class="keywordtype">id</span>, sn.str(), <span class="stringliteral">&quot;&quot;</span>, 100, Rounding(), <span class="stringliteral">&quot;%3% %1$.2f&quot;</span>);</div>
<div class="line"><span class="lineno"> 1828</span>        }</div>
<div class="line"><span class="lineno"> 1829</span>    };</div>
<div class="line"><span class="lineno"> 1830</span> </div>
<div class="line"><span class="lineno"> 1831</span>    Real dt = 1.0E-6;</div>
<div class="line"><span class="lineno"> 1832</span>    Real tol = 1.0E-7;</div>
<div class="line"><span class="lineno"> 1833</span> </div>
<div class="line"><span class="lineno"> 1834</span>    <span class="comment">// for ir-fx this fully specifies the correlation matrix</span></div>
<div class="line"><span class="lineno"> 1835</span>    <span class="comment">// for new asset classes add other possible combinations as well</span></div>
<div class="line"><span class="lineno"> 1836</span>    Size currencies[] = { 1, 2, 3, 4, 5, 10, 20 };</div>
<div class="line"><span class="lineno"> 1837</span>    Size creditnames[] = { 0, 1, 5, 10 };</div>
<div class="line"><span class="lineno"> 1838</span> </div>
<div class="line"><span class="lineno"> 1839</span>    MersenneTwisterUniformRng mt(42);</div>
<div class="line"><span class="lineno"> 1840</span> </div>
<div class="line"><span class="lineno"> 1841</span>    Handle&lt;YieldTermStructure&gt; yts(boost::make_shared&lt;FlatForward&gt;(0, NullCalendar(), 0.01, Actual365Fixed()));</div>
<div class="line"><span class="lineno"> 1842</span> </div>
<div class="line"><span class="lineno"> 1843</span>    Handle&lt;DefaultProbabilityTermStructure&gt; hts(</div>
<div class="line"><span class="lineno"> 1844</span>        boost::make_shared&lt;FlatHazardRate&gt;(0, NullCalendar(), 0.01, Actual365Fixed()));</div>
<div class="line"><span class="lineno"> 1845</span> </div>
<div class="line"><span class="lineno"> 1846</span>    Handle&lt;Quote&gt; fxspot(boost::make_shared&lt;SimpleQuote&gt;(1.00));</div>
<div class="line"><span class="lineno"> 1847</span> </div>
<div class="line"><span class="lineno"> 1848</span>    Array notimes(0);</div>
<div class="line"><span class="lineno"> 1849</span>    Array fxsigma(1, 0.10);</div>
<div class="line"><span class="lineno"> 1850</span> </div>
<div class="line"><span class="lineno"> 1851</span>    <span class="keywordflow">for</span> (Size ii = 0; ii &lt; <a class="code hl_define" href="utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(currencies); ++ii) {</div>
<div class="line"><span class="lineno"> 1852</span>        <span class="keywordflow">for</span> (Size jj = 0; jj &lt; <a class="code hl_define" href="utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(creditnames); ++jj) {</div>
<div class="line"><span class="lineno"> 1853</span> </div>
<div class="line"><span class="lineno"> 1854</span>            std::vector&lt;Currency&gt; pseudoCcy;</div>
<div class="line"><span class="lineno"> 1855</span>            <span class="keywordflow">for</span> (Size i = 0; i &lt; currencies[ii]; ++i) {</div>
<div class="line"><span class="lineno"> 1856</span>                PseudoCurrency tmp(i);</div>
<div class="line"><span class="lineno"> 1857</span>                pseudoCcy.push_back(tmp);</div>
<div class="line"><span class="lineno"> 1858</span>            }</div>
<div class="line"><span class="lineno"> 1859</span> </div>
<div class="line"><span class="lineno"> 1860</span>            Size dim = 2 * currencies[ii] - 1 + creditnames[jj];</div>
<div class="line"><span class="lineno"> 1861</span> </div>
<div class="line"><span class="lineno"> 1862</span>            <span class="comment">// generate random correlation matrix</span></div>
<div class="line"><span class="lineno"> 1863</span>            Matrix b(dim, dim);</div>
<div class="line"><span class="lineno"> 1864</span>            Size maxTries = 100;</div>
<div class="line"><span class="lineno"> 1865</span>            <span class="keywordtype">bool</span> valid = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1866</span>            <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno"> 1867</span>                Matrix a(dim, dim);</div>
<div class="line"><span class="lineno"> 1868</span>                <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 1869</span>                    <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 1870</span>                        a[i][j] = a[j][i] = mt.nextReal() - 0.5;</div>
<div class="line"><span class="lineno"> 1871</span>                    }</div>
<div class="line"><span class="lineno"> 1872</span>                }</div>
<div class="line"><span class="lineno"> 1873</span>                b = a * transpose(a);</div>
<div class="line"><span class="lineno"> 1874</span>                <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 1875</span>                    <span class="keywordflow">if</span> (b[i][i] &lt; 1E-5)</div>
<div class="line"><span class="lineno"> 1876</span>                        valid = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1877</span>                }</div>
<div class="line"><span class="lineno"> 1878</span>            } <span class="keywordflow">while</span> (!valid &amp;&amp; --maxTries &gt; 0);</div>
<div class="line"><span class="lineno"> 1879</span> </div>
<div class="line"><span class="lineno"> 1880</span>            <span class="keywordflow">if</span> (maxTries == 0) {</div>
<div class="line"><span class="lineno"> 1881</span>                BOOST_ERROR(<span class="stringliteral">&quot;could no generate random matrix&quot;</span>);</div>
<div class="line"><span class="lineno"> 1882</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1883</span>            }</div>
<div class="line"><span class="lineno"> 1884</span> </div>
<div class="line"><span class="lineno"> 1885</span>            Matrix c(dim, dim);</div>
<div class="line"><span class="lineno"> 1886</span>            <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 1887</span>                <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 1888</span>                    c[i][j] = c[j][i] = b[i][j] / std::sqrt(b[i][i] * b[j][j]);</div>
<div class="line"><span class="lineno"> 1889</span>                }</div>
<div class="line"><span class="lineno"> 1890</span>            }</div>
<div class="line"><span class="lineno"> 1891</span> </div>
<div class="line"><span class="lineno"> 1892</span>            <span class="comment">// set up model</span></div>
<div class="line"><span class="lineno"> 1893</span> </div>
<div class="line"><span class="lineno"> 1894</span>            std::vector&lt;boost::shared_ptr&lt;Parametrization&gt; &gt; parametrizations;</div>
<div class="line"><span class="lineno"> 1895</span> </div>
<div class="line"><span class="lineno"> 1896</span>            <span class="comment">// IR</span></div>
<div class="line"><span class="lineno"> 1897</span>            <span class="keywordflow">for</span> (Size i = 0; i &lt; currencies[ii]; ++i) {</div>
<div class="line"><span class="lineno"> 1898</span>                parametrizations.push_back(</div>
<div class="line"><span class="lineno"> 1899</span>                    boost::make_shared&lt;IrLgm1fConstantParametrization&gt;(pseudoCcy[i], yts, 0.01, 0.01));</div>
<div class="line"><span class="lineno"> 1900</span>            }</div>
<div class="line"><span class="lineno"> 1901</span>            <span class="comment">// FX</span></div>
<div class="line"><span class="lineno"> 1902</span>            <span class="keywordflow">for</span> (Size i = 0; i &lt; currencies[ii] - 1; ++i) {</div>
<div class="line"><span class="lineno"> 1903</span>                parametrizations.push_back(boost::make_shared&lt;FxBsPiecewiseConstantParametrization&gt;(</div>
<div class="line"><span class="lineno"> 1904</span>                    pseudoCcy[i + 1], fxspot, notimes, fxsigma));</div>
<div class="line"><span class="lineno"> 1905</span>            }</div>
<div class="line"><span class="lineno"> 1906</span>            <span class="comment">// CR</span></div>
<div class="line"><span class="lineno"> 1907</span>            <span class="keywordflow">for</span> (Size i = 0; i &lt; creditnames[jj]; ++i) {</div>
<div class="line"><span class="lineno"> 1908</span>                parametrizations.push_back(</div>
<div class="line"><span class="lineno"> 1909</span>                    boost::make_shared&lt;CrLgm1fConstantParametrization&gt;(pseudoCcy[0], hts, 0.01, 0.01));</div>
<div class="line"><span class="lineno"> 1910</span>            }</div>
<div class="line"><span class="lineno"> 1911</span> </div>
<div class="line"><span class="lineno"> 1912</span>            <span class="comment">// get QuantLib::Error: negative eigenvalue(s) (-3.649315e-16) with SalvagingAlgorithm::None</span></div>
<div class="line"><span class="lineno"> 1913</span>            boost::shared_ptr&lt;CrossAssetModel&gt; modelExact =</div>
<div class="line"><span class="lineno"> 1914</span>                boost::make_shared&lt;CrossAssetModel&gt;(parametrizations, c, SalvagingAlgorithm::Spectral,</div>
<div class="line"><span class="lineno"> 1915</span>                                                    IrModel::Measure::LGM, CrossAssetModel::Discretization::Exact);</div>
<div class="line"><span class="lineno"> 1916</span>            boost::shared_ptr&lt;CrossAssetModel&gt; modelEuler =</div>
<div class="line"><span class="lineno"> 1917</span>                boost::make_shared&lt;CrossAssetModel&gt;(parametrizations, c, SalvagingAlgorithm::Spectral,</div>
<div class="line"><span class="lineno"> 1918</span>                                                    IrModel::Measure::LGM, CrossAssetModel::Discretization::Euler);</div>
<div class="line"><span class="lineno"> 1919</span> </div>
<div class="line"><span class="lineno"> 1920</span>            boost::shared_ptr&lt;StochasticProcess&gt; peuler = modelEuler-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 1921</span>            boost::shared_ptr&lt;StochasticProcess&gt; pexact = modelExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 1922</span> </div>
<div class="line"><span class="lineno"> 1923</span>            Matrix c1 = peuler-&gt;covariance(dt, peuler-&gt;initialValues(), dt);</div>
<div class="line"><span class="lineno"> 1924</span>            Matrix c2 = pexact-&gt;covariance(0.0, peuler-&gt;initialValues(), dt);</div>
<div class="line"><span class="lineno"> 1925</span> </div>
<div class="line"><span class="lineno"> 1926</span>            Matrix r1(dim, dim), r2(dim, dim);</div>
<div class="line"><span class="lineno"> 1927</span> </div>
<div class="line"><span class="lineno"> 1928</span>            <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 1929</span>                <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 1930</span>                    <span class="comment">// there are two state variables per credit name,</span></div>
<div class="line"><span class="lineno"> 1931</span>                    Size subi = i &lt; 2 * currencies[ii] - 1 ? 1 : 2;</div>
<div class="line"><span class="lineno"> 1932</span>                    Size subj = j &lt; 2 * currencies[ii] - 1 ? 1 : 2;</div>
<div class="line"><span class="lineno"> 1933</span>                    <span class="keywordflow">for</span> (Size k1 = 0; k1 &lt; subi; ++k1) {</div>
<div class="line"><span class="lineno"> 1934</span>                        <span class="keywordflow">for</span> (Size k2 = 0; k2 &lt; subj; ++k2) {</div>
<div class="line"><span class="lineno"> 1935</span>                            Size i0 = i &lt; 2 * currencies[ii] - 1</div>
<div class="line"><span class="lineno"> 1936</span>                                          ? i</div>
<div class="line"><span class="lineno"> 1937</span>                                          : 2 * currencies[ii] - 1 + 2 * (i - (2 * currencies[ii] - 1)) + k1;</div>
<div class="line"><span class="lineno"> 1938</span>                            Size j0 = j &lt; 2 * currencies[ii] - 1</div>
<div class="line"><span class="lineno"> 1939</span>                                          ? j</div>
<div class="line"><span class="lineno"> 1940</span>                                          : 2 * currencies[ii] - 1 + 2 * (j - (2 * currencies[ii] - 1)) + k2;</div>
<div class="line"><span class="lineno"> 1941</span>                            r1[i][j] = r1[j][i] = c1[i0][j0] / std::sqrt(c1[i0][i0] * c1[j0][j0]);</div>
<div class="line"><span class="lineno"> 1942</span>                            r2[i][j] = r2[j][i] = c2[i0][j0] / std::sqrt(c2[i0][i0] * c2[j0][j0]);</div>
<div class="line"><span class="lineno"> 1943</span>                            <span class="keywordflow">if</span> (std::fabs(r1[i][j] - c[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 1944</span>                                BOOST_ERROR(<span class="stringliteral">&quot;failed to recover correlation matrix from &quot;</span></div>
<div class="line"><span class="lineno"> 1945</span>                                            <span class="stringliteral">&quot;Euler state process (i,j)=(&quot;</span></div>
<div class="line"><span class="lineno"> 1946</span>                                            &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;), (i0,j0)=(&quot;</span> &lt;&lt; i0 &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j0</div>
<div class="line"><span class="lineno"> 1947</span>                                            &lt;&lt; <span class="stringliteral">&quot;), input correlation is &quot;</span> &lt;&lt; c[i][j] &lt;&lt; <span class="stringliteral">&quot;, output is &quot;</span> &lt;&lt; r1[i][j]</div>
<div class="line"><span class="lineno"> 1948</span>                                            &lt;&lt; <span class="stringliteral">&quot;, difference &quot;</span> &lt;&lt; (c[i][j] - r1[i][j]) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol</div>
<div class="line"><span class="lineno"> 1949</span>                                            &lt;&lt; <span class="stringliteral">&quot; test configuration is &quot;</span> &lt;&lt; currencies[ii] &lt;&lt; <span class="stringliteral">&quot; currencies and &quot;</span></div>
<div class="line"><span class="lineno"> 1950</span>                                            &lt;&lt; creditnames[jj] &lt;&lt; <span class="stringliteral">&quot; credit names&quot;</span>);</div>
<div class="line"><span class="lineno"> 1951</span>                            }</div>
<div class="line"><span class="lineno"> 1952</span>                            <span class="keywordflow">if</span> (k1 == k2) {</div>
<div class="line"><span class="lineno"> 1953</span>                                <span class="keywordflow">if</span> (std::fabs(r2[i][j] - c[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 1954</span>                                    BOOST_ERROR(<span class="stringliteral">&quot;failed to recover correlation matrix &quot;</span></div>
<div class="line"><span class="lineno"> 1955</span>                                                <span class="stringliteral">&quot;from &quot;</span></div>
<div class="line"><span class="lineno"> 1956</span>                                                <span class="stringliteral">&quot;exact state process (i,j)=(&quot;</span></div>
<div class="line"><span class="lineno"> 1957</span>                                                &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;), (i0,j0)=(&quot;</span> &lt;&lt; i0 &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j0</div>
<div class="line"><span class="lineno"> 1958</span>                                                &lt;&lt; <span class="stringliteral">&quot;), input correlation is &quot;</span> &lt;&lt; c[i][j] &lt;&lt; <span class="stringliteral">&quot;, output is &quot;</span> &lt;&lt; r2[i][j]</div>
<div class="line"><span class="lineno"> 1959</span>                                                &lt;&lt; <span class="stringliteral">&quot;, difference &quot;</span> &lt;&lt; (c[i][j] - r2[i][j]) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol</div>
<div class="line"><span class="lineno"> 1960</span>                                                &lt;&lt; <span class="stringliteral">&quot; test configuration is &quot;</span> &lt;&lt; currencies[ii] &lt;&lt; <span class="stringliteral">&quot; currencies and &quot;</span></div>
<div class="line"><span class="lineno"> 1961</span>                                                &lt;&lt; creditnames[jj] &lt;&lt; <span class="stringliteral">&quot; credit names&quot;</span>);</div>
<div class="line"><span class="lineno"> 1962</span>                                }</div>
<div class="line"><span class="lineno"> 1963</span>                            }</div>
<div class="line"><span class="lineno"> 1964</span>                        }</div>
<div class="line"><span class="lineno"> 1965</span>                    }</div>
<div class="line"><span class="lineno"> 1966</span>                }</div>
<div class="line"><span class="lineno"> 1967</span>            }</div>
<div class="line"><span class="lineno"> 1968</span>        } <span class="comment">// for creditnames</span></div>
<div class="line"><span class="lineno"> 1969</span>    }     <span class="comment">// for currencies</span></div>
<div class="line"><span class="lineno"> 1970</span> </div>
<div class="line"><span class="lineno"> 1971</span>} <span class="comment">// testIrFxCrCorrelationRecovery</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1fd0420762b02abebd65319a1db321a9" name="a1fd0420762b02abebd65319a1db321a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fd0420762b02abebd65319a1db321a9">&#9670;&#160;</a></span>BOOST_DATA_TEST_CASE() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_DATA_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testIrFxInfCrComMartingaleProperty&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bdata::make(<a class="el" href="test_2crossassetmodel_8cpp.html#aa848a14c24baafa9e714abd087d2062b">infEurFlags</a>) *bdata::make(<a class="el" href="test_2crossassetmodel_8cpp.html#aabb2919210687ea5ff99ba34f08dd185">infGbpFlags</a>) *bdata::make(<a class="el" href="test_2crossassetmodel_8cpp.html#a6cd3e0f20d5d2ffb978002d671c329dc">flatVolsFlags</a>) *bdata::make(<a class="el" href="test_2commodityschwartzmodel_8cpp.html#a391af7283d1ddfef2b73086f39b487dd">driftFreeState</a>)&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">infEurIsDk&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">infGbpIsDk&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">flatVols&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="test_2commodityschwartzmodel_8cpp.html#a391af7283d1ddfef2b73086f39b487dd">driftFreeState</a>&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l02260">2260</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2262</span>                                                                       {</div>
<div class="line"><span class="lineno"> 2263</span> </div>
<div class="line"><span class="lineno"> 2264</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing martingale property in ir-fx-inf-cr-com model for Euler and exact discretizations...&quot;</span>);</div>
<div class="line"><span class="lineno"> 2265</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;EUR inflation model is: &quot;</span> &lt;&lt; (infEurIsDk ? <span class="stringliteral">&quot;DK&quot;</span> : <span class="stringliteral">&quot;JY&quot;</span>));</div>
<div class="line"><span class="lineno"> 2266</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;GBP inflation model is: &quot;</span> &lt;&lt; (infGbpIsDk ? <span class="stringliteral">&quot;DK&quot;</span> : <span class="stringliteral">&quot;JY&quot;</span>));</div>
<div class="line"><span class="lineno"> 2267</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Using &quot;</span> &lt;&lt; (flatVols ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;non-&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;flat volatilities.&quot;</span>);</div>
<div class="line"><span class="lineno"> 2268</span> </div>
<div class="line"><span class="lineno"> 2269</span>    IrFxInfCrComModelTestData d(infEurIsDk, infGbpIsDk, flatVols, <a class="code hl_variable" href="test_2crossassetmodel_8cpp.html#a2c026c3769e1c51837f568ca6099e729">driftFreeState</a>);</div>
<div class="line"><span class="lineno"> 2270</span> </div>
<div class="line"><span class="lineno"> 2271</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;get exact state process&quot;</span>);</div>
<div class="line"><span class="lineno"> 2272</span>    boost::shared_ptr&lt;StochasticProcess&gt; process1 = d.modelExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 2273</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;get Euler state process&quot;</span>);</div>
<div class="line"><span class="lineno"> 2274</span>    boost::shared_ptr&lt;StochasticProcess&gt; process2 = d.modelEuler-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 2275</span> </div>
<div class="line"><span class="lineno"> 2276</span>    Size n = 50000;                         <span class="comment">// number of paths</span></div>
<div class="line"><span class="lineno"> 2277</span>    Size seed = 18;                         <span class="comment">// rng seed</span></div>
<div class="line"><span class="lineno"> 2278</span>    Time T = 2.0;                          <span class="comment">// maturity of payoff</span></div>
<div class="line"><span class="lineno"> 2279</span>    Time T2 = 20.0;                         <span class="comment">// zerobond maturity</span></div>
<div class="line"><span class="lineno"> 2280</span>    Size <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a> = <span class="keyword">static_cast&lt;</span>Size<span class="keyword">&gt;</span>(T * 40); <span class="comment">// number of steps taken (euler)</span></div>
<div class="line"><span class="lineno"> 2281</span> </div>
<div class="line"><span class="lineno"> 2282</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;build sequence generators&quot;</span>);</div>
<div class="line"><span class="lineno"> 2283</span>    LowDiscrepancy::rsg_type sg1 = LowDiscrepancy::make_sequence_generator(process1-&gt;factors() * 1, seed);</div>
<div class="line"><span class="lineno"> 2284</span>    LowDiscrepancy::rsg_type sg2 = LowDiscrepancy::make_sequence_generator(process2-&gt;factors() * <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>, seed);</div>
<div class="line"><span class="lineno"> 2285</span> </div>
<div class="line"><span class="lineno"> 2286</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;build multi path generator&quot;</span>);</div>
<div class="line"><span class="lineno"> 2287</span>    TimeGrid grid1(T, 1);</div>
<div class="line"><span class="lineno"> 2288</span>    MultiPathGenerator&lt;LowDiscrepancy::rsg_type&gt; pg1(process1, grid1, sg1, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 2289</span>    TimeGrid grid2(T, <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>);</div>
<div class="line"><span class="lineno"> 2290</span>    MultiPathGenerator&lt;LowDiscrepancy::rsg_type&gt; pg2(process2, grid2, sg2, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 2291</span> </div>
<div class="line"><span class="lineno"> 2292</span>    accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; eurzb1, usdzb1, gbpzb1, infeur1, infgbp1,</div>
<div class="line"><span class="lineno"> 2293</span>        n1eur1, commodityA_1, commodityB_1;</div>
<div class="line"><span class="lineno"> 2294</span>    accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; eurzb2, usdzb2, gbpzb2, infeur2, infgbp2,</div>
<div class="line"><span class="lineno"> 2295</span>        n1eur2, commodityA_2, commodityB_2;</div>
<div class="line"><span class="lineno"> 2296</span> </div>
<div class="line"><span class="lineno"> 2297</span>    <span class="keywordflow">for</span> (Size j = 0; j &lt; n; ++j) {</div>
<div class="line"><span class="lineno"> 2298</span>        Sample&lt;MultiPath&gt; path2 = pg2.next();</div>
<div class="line"><span class="lineno"> 2299</span>        Size l2 = path2.value[0].length() - 1;</div>
<div class="line"><span class="lineno"> 2300</span>        Sample&lt;MultiPath&gt; path1 = pg1.next();</div>
<div class="line"><span class="lineno"> 2301</span>        Size l1 = path1.value[0].length() - 1;</div>
<div class="line"><span class="lineno"> 2302</span>        Real zeur1 = path1.value[0][l1];</div>
<div class="line"><span class="lineno"> 2303</span>        Real zusd1 = path1.value[1][l1];</div>
<div class="line"><span class="lineno"> 2304</span>        Real zgbp1 = path1.value[2][l1];</div>
<div class="line"><span class="lineno"> 2305</span>        Real fxusd1 = std::exp(path1.value[3][l1]);</div>
<div class="line"><span class="lineno"> 2306</span>        Real fxgbp1 = std::exp(path1.value[4][l1]);</div>
<div class="line"><span class="lineno"> 2307</span>        Real infeurz1 = path1.value[5][l1];</div>
<div class="line"><span class="lineno"> 2308</span>        Real infeury1 = path1.value[6][l1];</div>
<div class="line"><span class="lineno"> 2309</span>        Real infgbpz1 = path1.value[7][l1];</div>
<div class="line"><span class="lineno"> 2310</span>        Real infgbpy1 = path1.value[8][l1];</div>
<div class="line"><span class="lineno"> 2311</span>        Real crzn11 = path1.value[9][l1];</div>
<div class="line"><span class="lineno"> 2312</span>        Real cryn11 = path1.value[10][l1];</div>
<div class="line"><span class="lineno"> 2313</span>        Real coma1 = path1.value[11][l1];</div>
<div class="line"><span class="lineno"> 2314</span>        Real comb1 = path1.value[12][l1];</div>
<div class="line"><span class="lineno"> 2315</span>        Real zeur2 = path2.value[0][l2];</div>
<div class="line"><span class="lineno"> 2316</span>        Real zusd2 = path2.value[1][l2];</div>
<div class="line"><span class="lineno"> 2317</span>        Real zgbp2 = path2.value[2][l2];</div>
<div class="line"><span class="lineno"> 2318</span>        Real fxusd2 = std::exp(path2.value[3][l2]);</div>
<div class="line"><span class="lineno"> 2319</span>        Real fxgbp2 = std::exp(path2.value[4][l2]);</div>
<div class="line"><span class="lineno"> 2320</span>        Real infeurz2 = path2.value[5][l2];</div>
<div class="line"><span class="lineno"> 2321</span>        Real infeury2 = path2.value[6][l2];</div>
<div class="line"><span class="lineno"> 2322</span>        Real infgbpz2 = path2.value[7][l2];</div>
<div class="line"><span class="lineno"> 2323</span>        Real infgbpy2 = path2.value[8][l2];</div>
<div class="line"><span class="lineno"> 2324</span>        Real crzn12 = path2.value[9][l2];</div>
<div class="line"><span class="lineno"> 2325</span>        Real cryn12 = path2.value[10][l2];</div>
<div class="line"><span class="lineno"> 2326</span>        Real coma2 = path2.value[11][l2];</div>
<div class="line"><span class="lineno"> 2327</span>        Real comb2 = path2.value[12][l2];</div>
<div class="line"><span class="lineno"> 2328</span>        <span class="comment">// EUR zerobond</span></div>
<div class="line"><span class="lineno"> 2329</span>        eurzb1(d.modelExact-&gt;discountBond(0, T, T2, zeur1) / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2330</span>        <span class="comment">// USD zerobond</span></div>
<div class="line"><span class="lineno"> 2331</span>        usdzb1(d.modelExact-&gt;discountBond(1, T, T2, zusd1) * fxusd1 / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2332</span>        <span class="comment">// GBP zerobond</span></div>
<div class="line"><span class="lineno"> 2333</span>        gbpzb1(d.modelExact-&gt;discountBond(2, T, T2, zgbp1) * fxgbp1 / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2334</span>        <span class="comment">// EUR CPI indexed bond</span></div>
<div class="line"><span class="lineno"> 2335</span>        <span class="keywordtype">bool</span> indexIsInterpolated = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 2336</span>        <span class="keywordflow">if</span> (infEurIsDk) {</div>
<div class="line"><span class="lineno"> 2337</span>            std::pair&lt;Real, Real&gt; sinfeur1 = d.modelExact-&gt;infdkI(0, T, T2, infeurz1, infeury1);</div>
<div class="line"><span class="lineno"> 2338</span>            infeur1(sinfeur1.first * sinfeur1.second * d.modelExact-&gt;discountBond(0, T, T2, zeur1) /</div>
<div class="line"><span class="lineno"> 2339</span>                d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2340</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2341</span>            infeur1(<a class="code hl_function" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9">exp</a>(infeury1) * <a class="code hl_function" href="namespace_quant_ext.html#a37304ba878095935ffcb4e582a095101">inflationGrowth</a>(d.modelExact, 0, T, T2, zeur1, infeurz1, indexIsInterpolated) *</div>
<div class="line"><span class="lineno"> 2342</span>                    d.modelExact-&gt;discountBond(0, T, T2, zeur1) / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2343</span>        }</div>
<div class="line"><span class="lineno"> 2344</span>        <span class="comment">// GBP CPI indexed bond</span></div>
<div class="line"><span class="lineno"> 2345</span>        <span class="keywordflow">if</span> (infGbpIsDk) {</div>
<div class="line"><span class="lineno"> 2346</span>            std::pair&lt;Real, Real&gt; sinfgbp1 = d.modelExact-&gt;infdkI(1, T, T2, infgbpz1, infgbpy1);</div>
<div class="line"><span class="lineno"> 2347</span>            infgbp1(sinfgbp1.first * sinfgbp1.second * d.modelExact-&gt;discountBond(2, T, T2, zgbp1) * fxgbp1 /</div>
<div class="line"><span class="lineno"> 2348</span>                d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2349</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2350</span>            infgbp1(<a class="code hl_function" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9">exp</a>(infgbpy1) * <a class="code hl_function" href="namespace_quant_ext.html#a37304ba878095935ffcb4e582a095101">inflationGrowth</a>(d.modelExact, 1, T, T2, zgbp1, infgbpz1, indexIsInterpolated) *</div>
<div class="line"><span class="lineno"> 2351</span>                d.modelExact-&gt;discountBond(2, T, T2, zgbp1) * fxgbp1 / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2352</span>        }</div>
<div class="line"><span class="lineno"> 2353</span>        <span class="comment">// EUR defaultable zerobond</span></div>
<div class="line"><span class="lineno"> 2354</span>        std::pair&lt;Real, Real&gt; sn11 = d.modelExact-&gt;crlgm1fS(0, 0, T, T2, crzn11, cryn11);</div>
<div class="line"><span class="lineno"> 2355</span>        n1eur1(sn11.first * sn11.second * d.modelExact-&gt;discountBond(0, T, T2, zeur1) / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2356</span> </div>
<div class="line"><span class="lineno"> 2357</span>        <span class="comment">// EUR zerobond</span></div>
<div class="line"><span class="lineno"> 2358</span>        eurzb2(d.modelExact-&gt;discountBond(0, T, T2, zeur2) / d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2359</span>        <span class="comment">// USD zerobond</span></div>
<div class="line"><span class="lineno"> 2360</span>        usdzb2(d.modelExact-&gt;discountBond(1, T, T2, zusd2) * fxusd2 / d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2361</span>        <span class="comment">// GBP zerobond</span></div>
<div class="line"><span class="lineno"> 2362</span>        gbpzb2(d.modelExact-&gt;discountBond(2, T, T2, zgbp2) * fxgbp2 / d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2363</span>        <span class="comment">// EUR CPI indexed bond</span></div>
<div class="line"><span class="lineno"> 2364</span>        <span class="keywordflow">if</span> (infEurIsDk) {</div>
<div class="line"><span class="lineno"> 2365</span>            std::pair&lt;Real, Real&gt; sinfeur2 = d.modelExact-&gt;infdkI(0, T, T2, infeurz2, infeury2);</div>
<div class="line"><span class="lineno"> 2366</span>            infeur2(sinfeur2.first * sinfeur2.second * d.modelExact-&gt;discountBond(0, T, T2, zeur2) /</div>
<div class="line"><span class="lineno"> 2367</span>                d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2368</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2369</span>            infeur2(<a class="code hl_function" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9">exp</a>(infeury2) * <a class="code hl_function" href="namespace_quant_ext.html#a37304ba878095935ffcb4e582a095101">inflationGrowth</a>(d.modelExact, 0, T, T2, zeur2, infeurz2, indexIsInterpolated) *</div>
<div class="line"><span class="lineno"> 2370</span>                    d.modelExact-&gt;discountBond(0, T, T2, zeur2) / d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2371</span>        }</div>
<div class="line"><span class="lineno"> 2372</span>        <span class="comment">// GBP CPI indexed bond</span></div>
<div class="line"><span class="lineno"> 2373</span>        <span class="keywordflow">if</span> (infGbpIsDk) {</div>
<div class="line"><span class="lineno"> 2374</span>            std::pair&lt;Real, Real&gt; sinfgbp2 = d.modelExact-&gt;infdkI(1, T, T2, infgbpz2, infgbpy2);</div>
<div class="line"><span class="lineno"> 2375</span>            infgbp2(sinfgbp2.first * sinfgbp2.second * d.modelExact-&gt;discountBond(2, T, T2, zgbp2) * fxgbp2 /</div>
<div class="line"><span class="lineno"> 2376</span>                d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2377</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2378</span>            infgbp2(<a class="code hl_function" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9">exp</a>(infgbpy2) * <a class="code hl_function" href="namespace_quant_ext.html#a37304ba878095935ffcb4e582a095101">inflationGrowth</a>(d.modelExact, 1, T, T2, zgbp2, infgbpz2, indexIsInterpolated) *</div>
<div class="line"><span class="lineno"> 2379</span>                    d.modelExact-&gt;discountBond(2, T, T2, zgbp2) * fxgbp2 / d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2380</span>        }</div>
<div class="line"><span class="lineno"> 2381</span>        <span class="comment">// EUR defaultable zerobond</span></div>
<div class="line"><span class="lineno"> 2382</span>        std::pair&lt;Real, Real&gt; sn12 = d.modelExact-&gt;crlgm1fS(0, 0, T, T2, crzn12, cryn12);</div>
<div class="line"><span class="lineno"> 2383</span>        n1eur2(sn12.first * sn12.second * d.modelExact-&gt;discountBond(0, T, T2, zeur2) / d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2384</span>        <span class="comment">// commodity forward prices</span></div>
<div class="line"><span class="lineno"> 2385</span>        commodityA_1(d.comModelA-&gt;forwardPrice(T, T2, Array(1, coma1)));</div>
<div class="line"><span class="lineno"> 2386</span>        commodityB_1(d.comModelB-&gt;forwardPrice(T, T2, Array(1, comb1)));</div>
<div class="line"><span class="lineno"> 2387</span>        commodityA_2(d.comModelA-&gt;forwardPrice(T, T2, Array(1, coma2)));</div>
<div class="line"><span class="lineno"> 2388</span>        commodityB_2(d.comModelB-&gt;forwardPrice(T, T2, Array(1, comb2)));</div>
<div class="line"><span class="lineno"> 2389</span>    }</div>
<div class="line"><span class="lineno"> 2390</span> </div>
<div class="line"><span class="lineno"> 2391</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;EXACT:&quot;</span>);</div>
<div class="line"><span class="lineno"> 2392</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;EUR zb = &quot;</span> &lt;&lt; mean(eurzb1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(eurzb1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2393</span>                                   &lt;&lt; d.eurYts-&gt;discount(T2));</div>
<div class="line"><span class="lineno"> 2394</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;USD zb = &quot;</span> &lt;&lt; mean(usdzb1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(usdzb1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2395</span>                                   &lt;&lt; d.usdYts-&gt;discount(T2) * d.fxEurUsd-&gt;value());</div>
<div class="line"><span class="lineno"> 2396</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;GBP zb = &quot;</span> &lt;&lt; mean(gbpzb1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(gbpzb1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2397</span>                                   &lt;&lt; d.gbpYts-&gt;discount(T2) * d.fxEurGbp-&gt;value());</div>
<div class="line"><span class="lineno"> 2398</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;IDX zb EUR = &quot;</span> &lt;&lt; mean(infeur1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(infeur1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2399</span>                                       &lt;&lt; d.eurYts-&gt;discount(T2) *</div>
<div class="line"><span class="lineno"> 2400</span>                                              std::pow(1.0 + d.infEurTs-&gt;zeroRate(T2 - d.infLag), T2));</div>
<div class="line"><span class="lineno"> 2401</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;IDX zb GBP = &quot;</span> &lt;&lt; mean(infgbp1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(infgbp1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2402</span>                                       &lt;&lt; d.gbpYts-&gt;discount(T2) *</div>
<div class="line"><span class="lineno"> 2403</span>                                              std::pow(1.0 + d.infGbpTs-&gt;zeroRate(T2 - d.infLag), T2) *</div>
<div class="line"><span class="lineno"> 2404</span>                                              d.fxEurGbp-&gt;value());</div>
<div class="line"><span class="lineno"> 2405</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;N1 zb EUR = &quot;</span> &lt;&lt; mean(n1eur1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(n1eur1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2406</span>                                      &lt;&lt; d.eurYts-&gt;discount(T2) * d.n1Ts-&gt;survivalProbability(T2));</div>
<div class="line"><span class="lineno"> 2407</span> </div>
<div class="line"><span class="lineno"> 2408</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;\nEULER:&quot;</span>);</div>
<div class="line"><span class="lineno"> 2409</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;EUR zb = &quot;</span> &lt;&lt; mean(eurzb2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(eurzb2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2410</span>                                   &lt;&lt; d.eurYts-&gt;discount(T2));</div>
<div class="line"><span class="lineno"> 2411</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;USD zb = &quot;</span> &lt;&lt; mean(usdzb2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(usdzb2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2412</span>                                   &lt;&lt; d.usdYts-&gt;discount(T2) * d.fxEurUsd-&gt;value());</div>
<div class="line"><span class="lineno"> 2413</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;GBP zb = &quot;</span> &lt;&lt; mean(gbpzb2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(gbpzb2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2414</span>                                   &lt;&lt; d.gbpYts-&gt;discount(T2) * d.fxEurGbp-&gt;value());</div>
<div class="line"><span class="lineno"> 2415</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;IDX zb EUR = &quot;</span> &lt;&lt; mean(infeur2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(infeur2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2416</span>                                       &lt;&lt; d.eurYts-&gt;discount(T2) *</div>
<div class="line"><span class="lineno"> 2417</span>                                              std::pow(1.0 + d.infEurTs-&gt;zeroRate(T2 - d.infLag), T2));</div>
<div class="line"><span class="lineno"> 2418</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;IDX zb GBP = &quot;</span> &lt;&lt; mean(infgbp2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(infgbp2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2419</span>                                       &lt;&lt; d.gbpYts-&gt;discount(T2) *</div>
<div class="line"><span class="lineno"> 2420</span>                                              std::pow(1.0 + d.infGbpTs-&gt;zeroRate(T2 - d.infLag), T2) *</div>
<div class="line"><span class="lineno"> 2421</span>                                              d.fxEurGbp-&gt;value());</div>
<div class="line"><span class="lineno"> 2422</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;N1 zb EUR = &quot;</span> &lt;&lt; mean(n1eur2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(n1eur2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2423</span>                                      &lt;&lt; d.eurYts-&gt;discount(T2) * d.n1Ts-&gt;survivalProbability(T2));</div>
<div class="line"><span class="lineno"> 2424</span> </div>
<div class="line"><span class="lineno"> 2425</span>    <span class="comment">// a bit higher than for plain zero bond , since we look at indexed zero</span></div>
<div class="line"><span class="lineno"> 2426</span>    <span class="comment">// bonds, too</span></div>
<div class="line"><span class="lineno"> 2427</span>    Real tol1 = 3.0E-4;  <span class="comment">// EXACT</span></div>
<div class="line"><span class="lineno"> 2428</span>    Real tol2 = 14.0E-4; <span class="comment">// EULER</span></div>
<div class="line"><span class="lineno"> 2429</span> </div>
<div class="line"><span class="lineno"> 2430</span>    Real ev = d.eurYts-&gt;discount(T2);</div>
<div class="line"><span class="lineno"> 2431</span>    <span class="keywordflow">if</span> (std::abs(mean(eurzb1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 2432</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for eurzb (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2433</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 2434</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(eurzb1) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 2435</span>    ev = d.usdYts-&gt;discount(T2) * d.fxEurUsd-&gt;value();</div>
<div class="line"><span class="lineno"> 2436</span>    <span class="keywordflow">if</span> (std::abs(mean(usdzb1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 2437</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for eurzb (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2438</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 2439</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(usdzb1) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 2440</span>    ev = d.gbpYts-&gt;discount(T2) * d.fxEurGbp-&gt;value();</div>
<div class="line"><span class="lineno"> 2441</span>    <span class="keywordflow">if</span> (std::abs(mean(gbpzb1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 2442</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for eurzb (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2443</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 2444</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(gbpzb1) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 2445</span>    ev = d.eurYts-&gt;discount(T2) * std::pow(1.0 + d.infEurTs-&gt;zeroRate(T2 - d.infLag), T2);</div>
<div class="line"><span class="lineno"> 2446</span>    <span class="keywordflow">if</span> (std::abs(mean(infeur1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 2447</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for idx eurzb (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2448</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 2449</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(infeur1) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 2450</span>    ev = d.gbpYts-&gt;discount(T2) * std::pow(1.0 + d.infGbpTs-&gt;zeroRate(T2 - d.infLag), T2) * d.fxEurGbp-&gt;value();</div>
<div class="line"><span class="lineno"> 2451</span>    <span class="keywordflow">if</span> (std::abs(mean(infgbp1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 2452</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for idx gbpzb (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2453</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 2454</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(infgbp1) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 2455</span>    ev = d.eurYts-&gt;discount(T2) * d.n1Ts-&gt;survivalProbability(T2);</div>
<div class="line"><span class="lineno"> 2456</span>    <span class="keywordflow">if</span> (std::abs(mean(n1eur1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 2457</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for def eurzb (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2458</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 2459</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(n1eur1) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 2460</span> </div>
<div class="line"><span class="lineno"> 2461</span>    ev = d.eurYts-&gt;discount(T2);</div>
<div class="line"><span class="lineno"> 2462</span>    <span class="keywordflow">if</span> (std::abs(mean(eurzb2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 2463</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for eurzb (Euler discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2464</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 2465</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(eurzb2) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2);</div>
<div class="line"><span class="lineno"> 2466</span>    ev = d.usdYts-&gt;discount(T2) * d.fxEurUsd-&gt;value();</div>
<div class="line"><span class="lineno"> 2467</span>    <span class="keywordflow">if</span> (std::abs(mean(usdzb2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 2468</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for usdzb (Euler discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2469</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 2470</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(usdzb2) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2 * error_of&lt;tag::mean&gt;(usdzb2));</div>
<div class="line"><span class="lineno"> 2471</span>    ev = d.gbpYts-&gt;discount(T2) * d.fxEurGbp-&gt;value();</div>
<div class="line"><span class="lineno"> 2472</span>    <span class="keywordflow">if</span> (std::abs(mean(gbpzb2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 2473</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for gbpzb (Euler discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2474</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 2475</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(gbpzb2) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2);</div>
<div class="line"><span class="lineno"> 2476</span>    ev = d.eurYts-&gt;discount(T2) * std::pow(1.0 + d.infEurTs-&gt;zeroRate(T2 - d.infLag), T2);</div>
<div class="line"><span class="lineno"> 2477</span>    <span class="keywordflow">if</span> (std::abs(mean(infeur2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 2478</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for idx eurzb (Euler discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2479</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 2480</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(infeur2) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 2481</span>    ev = d.gbpYts-&gt;discount(T2) * std::pow(1.0 + d.infGbpTs-&gt;zeroRate(T2 - d.infLag), T2) * d.fxEurGbp-&gt;value();</div>
<div class="line"><span class="lineno"> 2482</span>    <span class="keywordflow">if</span> (std::abs(mean(infgbp2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 2483</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for idx gbpzb (Euler discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2484</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 2485</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(infgbp2) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 2486</span>    ev = d.eurYts-&gt;discount(T2) * d.n1Ts-&gt;survivalProbability(T2);</div>
<div class="line"><span class="lineno"> 2487</span>    <span class="keywordflow">if</span> (std::abs(mean(n1eur2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 2488</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for def eurzb (Euler discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2489</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 2490</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(n1eur1) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 2491</span> </div>
<div class="line"><span class="lineno"> 2492</span>    <span class="comment">// commodity A forward prices</span></div>
<div class="line"><span class="lineno"> 2493</span>    Real tol;</div>
<div class="line"><span class="lineno"> 2494</span>    ev = d.comParametrizationA-&gt;priceCurve()-&gt;price(T2);</div>
<div class="line"><span class="lineno"> 2495</span>    tol = error_of&lt;tag::mean&gt;(commodityA_1);</div>
<div class="line"><span class="lineno"> 2496</span>    <span class="keywordflow">if</span> (std::abs(mean(commodityA_1) - ev) &gt; tol)</div>
<div class="line"><span class="lineno"> 2497</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for commodity A (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2498</span>                         <span class="stringliteral">&quot;expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(commodityA_1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 2499</span>    tol = error_of&lt;tag::mean&gt;(commodityA_2);</div>
<div class="line"><span class="lineno"> 2500</span>    <span class="keywordflow">if</span> (std::abs(mean(commodityA_2) - ev) &gt; tol)</div>
<div class="line"><span class="lineno"> 2501</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for commodity A (Euler discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2502</span>                         <span class="stringliteral">&quot;expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(commodityA_2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 2503</span> </div>
<div class="line"><span class="lineno"> 2504</span>    <span class="comment">// commodity B forward prices</span></div>
<div class="line"><span class="lineno"> 2505</span>    ev = d.comParametrizationB-&gt;priceCurve()-&gt;price(T2); </div>
<div class="line"><span class="lineno"> 2506</span>    tol = error_of&lt;tag::mean&gt;(commodityB_1);</div>
<div class="line"><span class="lineno"> 2507</span>    <span class="keywordflow">if</span> (std::abs(mean(commodityB_1) - ev) &gt; tol)</div>
<div class="line"><span class="lineno"> 2508</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for commodity B (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2509</span>                         <span class="stringliteral">&quot;expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(commodityB_1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 2510</span>    tol = error_of&lt;tag::mean&gt;(commodityB_2);</div>
<div class="line"><span class="lineno"> 2511</span>    <span class="keywordflow">if</span> (std::abs(mean(commodityB_2) - ev) &gt; tol)</div>
<div class="line"><span class="lineno"> 2512</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for commodity B (Euler discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 2513</span>                         <span class="stringliteral">&quot;expected &quot;</span> &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(commodityB_2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 2514</span> </div>
<div class="line"><span class="lineno"> 2515</span>    </div>
<div class="line"><span class="lineno"> 2516</span>} <span class="comment">// testIrFxInfCrMartingaleProperty</span></div>
<div class="ttc" id="anamespace_quant_ext_html_a37304ba878095935ffcb4e582a095101"><div class="ttname"><a href="namespace_quant_ext.html#a37304ba878095935ffcb4e582a095101">QuantExt::inflationGrowth</a></div><div class="ttdeci">Real inflationGrowth(const boost::shared_ptr&lt; CrossAssetModel &gt; &amp;model, Size index, Time S, Time T, Real irState, Real rrState, bool indexIsInterpolated)</div><div class="ttdef"><b>Definition:</b> <a href="jyimpliedzeroinflationtermstructure_8cpp_source.html#l00061">jyimpliedzeroinflationtermstructure.cpp:61</a></div></div>
<div class="ttc" id="atest_2crossassetmodel_8cpp_html_a2c026c3769e1c51837f568ca6099e729"><div class="ttname"><a href="test_2crossassetmodel_8cpp.html#a2c026c3769e1c51837f568ca6099e729">driftFreeState</a></div><div class="ttdeci">vector&lt; bool &gt; driftFreeState</div><div class="ttdef"><b>Definition:</b> <a href="test_2crossassetmodel_8cpp_source.html#l02258">crossassetmodel.cpp:2258</a></div></div>
</div><!-- fragment --><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="test_2crossassetmodel_8cpp_a1fd0420762b02abebd65319a1db321a9_cgraph.png" border="0" usemap="#atest_2crossassetmodel_8cpp_a1fd0420762b02abebd65319a1db321a9_cgraph" alt=""/></div>
<map name="atest_2crossassetmodel_8cpp_a1fd0420762b02abebd65319a1db321a9_cgraph" id="atest_2crossassetmodel_8cpp_a1fd0420762b02abebd65319a1db321a9_cgraph">
<area shape="rect" title=" " alt="" coords="5,43,196,68"/>
<area shape="rect" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9" title=" " alt="" coords="276,5,383,31"/>
<area shape="rect" href="namespace_quant_ext.html#a37304ba878095935ffcb4e582a095101" title=" " alt="" coords="244,79,415,104"/>
</map>
</div>

</div>
</div>
<a id="a845ff59e670b87ff4d3abec50e3273c9" name="a845ff59e670b87ff4d3abec50e3273c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a845ff59e670b87ff4d3abec50e3273c9">&#9670;&#160;</a></span>BOOST_DATA_TEST_CASE() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_DATA_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testIrFxInfCrComMoments&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bdata::make(<a class="el" href="test_2crossassetmodel_8cpp.html#aa848a14c24baafa9e714abd087d2062b">infEurFlags</a>) *bdata::make(<a class="el" href="test_2crossassetmodel_8cpp.html#aabb2919210687ea5ff99ba34f08dd185">infGbpFlags</a>) *bdata::make(<a class="el" href="test_2crossassetmodel_8cpp.html#a6cd3e0f20d5d2ffb978002d671c329dc">flatVolsFlags</a>) *bdata::make(<a class="el" href="test_2commodityschwartzmodel_8cpp.html#a391af7283d1ddfef2b73086f39b487dd">driftFreeState</a>)&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">infEurIsDk&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">infGbpIsDk&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">flatVols&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="test_2commodityschwartzmodel_8cpp.html#a391af7283d1ddfef2b73086f39b487dd">driftFreeState</a>&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l02518">2518</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2520</span>                                                                       {</div>
<div class="line"><span class="lineno"> 2521</span> </div>
<div class="line"><span class="lineno"> 2522</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing analytic moments vs. Euler and exact discretization in ir-fx-inf-cr-com model...&quot;</span>);</div>
<div class="line"><span class="lineno"> 2523</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;EUR inflation model is: &quot;</span> &lt;&lt; (infEurIsDk ? <span class="stringliteral">&quot;DK&quot;</span> : <span class="stringliteral">&quot;JY&quot;</span>));</div>
<div class="line"><span class="lineno"> 2524</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;GBP inflation model is: &quot;</span> &lt;&lt; (infGbpIsDk ? <span class="stringliteral">&quot;DK&quot;</span> : <span class="stringliteral">&quot;JY&quot;</span>));</div>
<div class="line"><span class="lineno"> 2525</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Using &quot;</span> &lt;&lt; (flatVols ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;non-&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;flat volatilities.&quot;</span>);</div>
<div class="line"><span class="lineno"> 2526</span> </div>
<div class="line"><span class="lineno"> 2527</span>    IrFxInfCrComModelTestData d(infEurIsDk, infGbpIsDk, flatVols, <a class="code hl_variable" href="test_2crossassetmodel_8cpp.html#a2c026c3769e1c51837f568ca6099e729">driftFreeState</a>);</div>
<div class="line"><span class="lineno"> 2528</span> </div>
<div class="line"><span class="lineno"> 2529</span>    Size n = d.modelExact-&gt;dimension();</div>
<div class="line"><span class="lineno"> 2530</span> </div>
<div class="line"><span class="lineno"> 2531</span>    boost::shared_ptr&lt;StochasticProcess&gt; p_exact = d.modelExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 2532</span>    boost::shared_ptr&lt;StochasticProcess&gt; p_euler = d.modelExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 2533</span> </div>
<div class="line"><span class="lineno"> 2534</span>    Real T = 2.0;                            <span class="comment">// horizon at which we compare the moments</span></div>
<div class="line"><span class="lineno"> 2535</span>    Size <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a> = <span class="keyword">static_cast&lt;</span>Size<span class="keyword">&gt;</span>(T * 10); <span class="comment">// number of simulation steps (Euler and exact)</span></div>
<div class="line"><span class="lineno"> 2536</span>    Size paths = 30000;                     <span class="comment">// number of paths</span></div>
<div class="line"><span class="lineno"> 2537</span> </div>
<div class="line"><span class="lineno"> 2538</span>    Array e_an = p_exact-&gt;expectation(0.0, p_exact-&gt;initialValues(), T);</div>
<div class="line"><span class="lineno"> 2539</span>    Matrix v_an = p_exact-&gt;covariance(0.0, p_exact-&gt;initialValues(), T);</div>
<div class="line"><span class="lineno"> 2540</span> </div>
<div class="line"><span class="lineno"> 2541</span>    Size seed = 18;</div>
<div class="line"><span class="lineno"> 2542</span>    TimeGrid grid(T, <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>);</div>
<div class="line"><span class="lineno"> 2543</span> </div>
<div class="line"><span class="lineno"> 2544</span>    <a class="code hl_class" href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html">MultiPathGeneratorSobolBrownianBridge</a> pgen(p_euler, grid, SobolBrownianGenerator::Diagonal, seed,</div>
<div class="line"><span class="lineno"> 2545</span>                                               SobolRsg::JoeKuoD7);</div>
<div class="line"><span class="lineno"> 2546</span>    <a class="code hl_class" href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html">MultiPathGeneratorSobolBrownianBridge</a> pgen2(p_exact, grid, SobolBrownianGenerator::Diagonal, seed,</div>
<div class="line"><span class="lineno"> 2547</span>                                                SobolRsg::JoeKuoD7);</div>
<div class="line"><span class="lineno"> 2548</span> </div>
<div class="line"><span class="lineno"> 2549</span>    vector&lt;accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; &gt; e_eu(n);</div>
<div class="line"><span class="lineno"> 2550</span>    vector&lt;accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; &gt; e_eu2(n);</div>
<div class="line"><span class="lineno"> 2551</span>    vector&lt;vector&lt;accumulator_set&lt;double, stats&lt;tag::covariance&lt;double, tag::covariate1&gt; &gt; &gt; &gt; &gt; v_eu(n);</div>
<div class="line"><span class="lineno"> 2552</span>    vector&lt;vector&lt;accumulator_set&lt;double, stats&lt;tag::covariance&lt;double, tag::covariate1&gt; &gt; &gt; &gt; &gt; v_eu2(n);</div>
<div class="line"><span class="lineno"> 2553</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 2554</span>        v_eu[i] = vector&lt;accumulator_set&lt;double, stats&lt;tag::covariance&lt;double, tag::covariate1&gt; &gt; &gt; &gt;(n);</div>
<div class="line"><span class="lineno"> 2555</span>        v_eu2[i] = vector&lt;accumulator_set&lt;double, stats&lt;tag::covariance&lt;double, tag::covariate1&gt; &gt; &gt; &gt;(n);</div>
<div class="line"><span class="lineno"> 2556</span>    }</div>
<div class="line"><span class="lineno"> 2557</span> </div>
<div class="line"><span class="lineno"> 2558</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; paths; ++i) {</div>
<div class="line"><span class="lineno"> 2559</span>        Sample&lt;MultiPath&gt; path = pgen.next();</div>
<div class="line"><span class="lineno"> 2560</span>        Sample&lt;MultiPath&gt; path2 = pgen2.next();</div>
<div class="line"><span class="lineno"> 2561</span>        <span class="keywordflow">for</span> (Size ii = 0; ii &lt; n; ++ii) {</div>
<div class="line"><span class="lineno"> 2562</span>            Real cii = path.value[ii].back();</div>
<div class="line"><span class="lineno"> 2563</span>            Real cii2 = path2.value[ii].back();</div>
<div class="line"><span class="lineno"> 2564</span>            e_eu[ii](cii);</div>
<div class="line"><span class="lineno"> 2565</span>            e_eu2[ii](cii2);</div>
<div class="line"><span class="lineno"> 2566</span>            <span class="keywordflow">for</span> (Size jj = 0; jj &lt;= ii; ++jj) {</div>
<div class="line"><span class="lineno"> 2567</span>                Real cjj = path.value[jj].back();</div>
<div class="line"><span class="lineno"> 2568</span>                v_eu[ii][jj](cii, covariate1 = cjj);</div>
<div class="line"><span class="lineno"> 2569</span>                Real cjj2 = path2.value[jj].back();</div>
<div class="line"><span class="lineno"> 2570</span>                v_eu2[ii][jj](cii2, covariate1 = cjj2);</div>
<div class="line"><span class="lineno"> 2571</span>            }</div>
<div class="line"><span class="lineno"> 2572</span>        }</div>
<div class="line"><span class="lineno"> 2573</span>    }</div>
<div class="line"><span class="lineno"> 2574</span> </div>
<div class="line"><span class="lineno"> 2575</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 2576</span>        BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;E_&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::fixed &lt;&lt; std::setprecision(12) &lt;&lt;</div>
<div class="line"><span class="lineno"> 2577</span>            e_an[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; mean(e_eu[i]) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; mean(e_eu2[i]));</div>
<div class="line"><span class="lineno"> 2578</span>    }</div>
<div class="line"><span class="lineno"> 2579</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;==================&quot;</span>);</div>
<div class="line"><span class="lineno"> 2580</span> </div>
<div class="line"><span class="lineno"> 2581</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;one step analytical&quot;</span>);</div>
<div class="line"><span class="lineno"> 2582</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 2583</span>        std::ostringstream tmp;</div>
<div class="line"><span class="lineno"> 2584</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 2585</span>            tmp &lt;&lt; v_an[i][j] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><span class="lineno"> 2586</span>        }</div>
<div class="line"><span class="lineno"> 2587</span>        BOOST_TEST_MESSAGE(tmp.str());</div>
<div class="line"><span class="lineno"> 2588</span>    }</div>
<div class="line"><span class="lineno"> 2589</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;==================&quot;</span>);</div>
<div class="line"><span class="lineno"> 2590</span> </div>
<div class="line"><span class="lineno"> 2591</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;euler&quot;</span>);</div>
<div class="line"><span class="lineno"> 2592</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 2593</span>        std::ostringstream tmp;</div>
<div class="line"><span class="lineno"> 2594</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 2595</span>            tmp &lt;&lt; covariance(v_eu[i][j]) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><span class="lineno"> 2596</span>        }</div>
<div class="line"><span class="lineno"> 2597</span>        BOOST_TEST_MESSAGE(tmp.str());</div>
<div class="line"><span class="lineno"> 2598</span>    }</div>
<div class="line"><span class="lineno"> 2599</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;==================&quot;</span>);</div>
<div class="line"><span class="lineno"> 2600</span> </div>
<div class="line"><span class="lineno"> 2601</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;exact&quot;</span>);</div>
<div class="line"><span class="lineno"> 2602</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 2603</span>        std::ostringstream tmp;</div>
<div class="line"><span class="lineno"> 2604</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 2605</span>            tmp &lt;&lt; covariance(v_eu2[i][j]) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><span class="lineno"> 2606</span>        }</div>
<div class="line"><span class="lineno"> 2607</span>        BOOST_TEST_MESSAGE(tmp.str());</div>
<div class="line"><span class="lineno"> 2608</span>    }</div>
<div class="line"><span class="lineno"> 2609</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;==================&quot;</span>);</div>
<div class="line"><span class="lineno"> 2610</span> </div>
<div class="line"><span class="lineno"> 2611</span>    Real errTolLd[] = { 0.5E-4, 0.5E-4, 0.5E-4, 10.0E-4, 10.0E-4, 0.9E-4, 0.8E-4, 0.7E-4, 0.7E-4, 0.7E-4, 0.7E-4, 0.7E-4, 0.7E-4 };</div>
<div class="line"><span class="lineno"> 2612</span> </div>
<div class="line"><span class="lineno"> 2613</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 2614</span>        <span class="comment">// check expectation against analytical calculation (Euler)</span></div>
<div class="line"><span class="lineno"> 2615</span>        <span class="keywordflow">if</span> (std::fabs(mean(e_eu[i]) - e_an[i]) &gt; errTolLd[i]) {</div>
<div class="line"><span class="lineno"> 2616</span>            BOOST_ERROR(<span class="stringliteral">&quot;analytical expectation for component #&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; e_an[i]</div>
<div class="line"><span class="lineno"> 2617</span>                                                                 &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical value (Euler &quot;</span></div>
<div class="line"><span class="lineno"> 2618</span>                                                                    <span class="stringliteral">&quot;discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 2619</span>                                                                 &lt;&lt; mean(e_eu[i]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 2620</span>                                                                 &lt;&lt; e_an[i] - mean(e_eu[i]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 2621</span>                                                                 &lt;&lt; errTolLd[i]);</div>
<div class="line"><span class="lineno"> 2622</span>        }</div>
<div class="line"><span class="lineno"> 2623</span>        <span class="comment">// check expectation against analytical calculation (exact disc)</span></div>
<div class="line"><span class="lineno"> 2624</span>        <span class="keywordflow">if</span> (std::fabs(mean(e_eu2[i]) - e_an[i]) &gt; errTolLd[i]) {</div>
<div class="line"><span class="lineno"> 2625</span>            BOOST_ERROR(<span class="stringliteral">&quot;analytical expectation for component #&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; e_an[i]</div>
<div class="line"><span class="lineno"> 2626</span>                                                                 &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical value (exact &quot;</span></div>
<div class="line"><span class="lineno"> 2627</span>                                                                    <span class="stringliteral">&quot;discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 2628</span>                                                                 &lt;&lt; mean(e_eu2[i]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 2629</span>                                                                 &lt;&lt; e_an[i] - mean(e_eu2[i]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 2630</span>                                                                 &lt;&lt; errTolLd[i]);</div>
<div class="line"><span class="lineno"> 2631</span>        }</div>
<div class="line"><span class="lineno"> 2632</span>    }</div>
<div class="line"><span class="lineno"> 2633</span> </div>
<div class="line"><span class="lineno"> 2634</span>    <span class="comment">// as above, this is a bit rough compared to the more differentiated</span></div>
<div class="line"><span class="lineno"> 2635</span>    <span class="comment">// test of the IR-FX model ...</span></div>
<div class="line"><span class="lineno"> 2636</span>    Real tol = 10.0E-4;</div>
<div class="line"><span class="lineno"> 2637</span> </div>
<div class="line"><span class="lineno"> 2638</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 2639</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 2640</span>            <span class="keywordflow">if</span> (std::fabs(covariance(v_eu[i][j]) - v_an[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 2641</span>                BOOST_ERROR(<span class="stringliteral">&quot;analytical covariance at (&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;) (&quot;</span> &lt;&lt; v_an[i][j]</div>
<div class="line"><span class="lineno"> 2642</span>                                                         &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical &quot;</span></div>
<div class="line"><span class="lineno"> 2643</span>                                                            <span class="stringliteral">&quot;value (Euler discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 2644</span>                                                         &lt;&lt; covariance(v_eu[i][j]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 2645</span>                                                         &lt;&lt; v_an[i][j] - covariance(v_eu[i][j]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 2646</span>                                                         &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 2647</span>            }</div>
<div class="line"><span class="lineno"> 2648</span>            <span class="keywordflow">if</span> (std::fabs(covariance(v_eu2[i][j]) - v_an[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 2649</span>                BOOST_ERROR(<span class="stringliteral">&quot;analytical covariance at (&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;) (&quot;</span> &lt;&lt; v_an[i][j]</div>
<div class="line"><span class="lineno"> 2650</span>                                                         &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical &quot;</span></div>
<div class="line"><span class="lineno"> 2651</span>                                                            <span class="stringliteral">&quot;value (exact discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 2652</span>                                                         &lt;&lt; covariance(v_eu2[i][j]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 2653</span>                                                         &lt;&lt; v_an[i][j] - covariance(v_eu2[i][j]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 2654</span>                                                         &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 2655</span>            }</div>
<div class="line"><span class="lineno"> 2656</span>        }</div>
<div class="line"><span class="lineno"> 2657</span>    }</div>
<div class="line"><span class="lineno"> 2658</span>    </div>
<div class="line"><span class="lineno"> 2659</span>} <span class="comment">// testIrFxInfCrMoments</span></div>
</div><!-- fragment --><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="test_2crossassetmodel_8cpp_a845ff59e670b87ff4d3abec50e3273c9_cgraph.png" border="0" usemap="#atest_2crossassetmodel_8cpp_a845ff59e670b87ff4d3abec50e3273c9_cgraph" alt=""/></div>
<map name="atest_2crossassetmodel_8cpp_a845ff59e670b87ff4d3abec50e3273c9_cgraph" id="atest_2crossassetmodel_8cpp_a845ff59e670b87ff4d3abec50e3273c9_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,196,38"/>
<area shape="rect" href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html#ad8f5a33568da4f97b76944e9621547e2" title=" " alt="" coords="244,5,441,45"/>
</map>
</div>

</div>
</div>
<a id="a0c092efee780e717bdbd58983cca33e8" name="a0c092efee780e717bdbd58983cca33e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c092efee780e717bdbd58983cca33e8">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[14/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testIrFxInfCrEqMartingaleProperty&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l02872">2872</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2872</span>                                                        {</div>
<div class="line"><span class="lineno"> 2873</span> </div>
<div class="line"><span class="lineno"> 2874</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing martingale property in ir-fx-inf-cr-eq model for &quot;</span></div>
<div class="line"><span class="lineno"> 2875</span>                       <span class="stringliteral">&quot;Euler and exact discretizations...&quot;</span>);</div>
<div class="line"><span class="lineno"> 2876</span> </div>
<div class="line"><span class="lineno"> 2877</span>    IrFxInfCrEqModelTestData d;</div>
<div class="line"><span class="lineno"> 2878</span> </div>
<div class="line"><span class="lineno"> 2879</span>    boost::shared_ptr&lt;StochasticProcess&gt; process1 = d.modelExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 2880</span>    boost::shared_ptr&lt;StochasticProcess&gt; process2 = d.modelExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 2881</span> </div>
<div class="line"><span class="lineno"> 2882</span>    Size n = 50000;                         <span class="comment">// number of paths</span></div>
<div class="line"><span class="lineno"> 2883</span>    Size seed = 18;                         <span class="comment">// rng seed</span></div>
<div class="line"><span class="lineno"> 2884</span>    Time T = 2.0;                          <span class="comment">// maturity of payoff</span></div>
<div class="line"><span class="lineno"> 2885</span>    Time T2 = 20.0;                         <span class="comment">// zerobond maturity</span></div>
<div class="line"><span class="lineno"> 2886</span>    Size <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a> = <span class="keyword">static_cast&lt;</span>Size<span class="keyword">&gt;</span>(T * 24); <span class="comment">// number of steps taken (euler)</span></div>
<div class="line"><span class="lineno"> 2887</span> </div>
<div class="line"><span class="lineno"> 2888</span>    <span class="comment">// this can be made more accurate by using LowDiscrepancy instead</span></div>
<div class="line"><span class="lineno"> 2889</span>    <span class="comment">// of PseudoRandom, but we use an error estimator for the check</span></div>
<div class="line"><span class="lineno"> 2890</span>    LowDiscrepancy::rsg_type sg1 = LowDiscrepancy::make_sequence_generator(process1-&gt;factors() * 1, seed);</div>
<div class="line"><span class="lineno"> 2891</span>    LowDiscrepancy::rsg_type sg2 = LowDiscrepancy::make_sequence_generator(process2-&gt;factors() * <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>, seed);</div>
<div class="line"><span class="lineno"> 2892</span> </div>
<div class="line"><span class="lineno"> 2893</span>    TimeGrid grid1(T, 1);</div>
<div class="line"><span class="lineno"> 2894</span>    MultiPathGenerator&lt;LowDiscrepancy::rsg_type&gt; pg1(process1, grid1, sg1, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 2895</span>    TimeGrid grid2(T, <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>);</div>
<div class="line"><span class="lineno"> 2896</span>    MultiPathGenerator&lt;LowDiscrepancy::rsg_type&gt; pg2(process2, grid2, sg2, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 2897</span> </div>
<div class="line"><span class="lineno"> 2898</span>    accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; eurzb1, usdzb1, gbpzb1, infeur1, infgbp1,</div>
<div class="line"><span class="lineno"> 2899</span>        n1eur1, eqsp1, eqlh1;</div>
<div class="line"><span class="lineno"> 2900</span>    accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; eurzb2, usdzb2, gbpzb2, infeur2, infgbp2,</div>
<div class="line"><span class="lineno"> 2901</span>        n1eur2, eqsp2, eqlh2;</div>
<div class="line"><span class="lineno"> 2902</span> </div>
<div class="line"><span class="lineno"> 2903</span>    <span class="keywordflow">for</span> (Size j = 0; j &lt; n; ++j) {</div>
<div class="line"><span class="lineno"> 2904</span>        Sample&lt;MultiPath&gt; path1 = pg1.next();</div>
<div class="line"><span class="lineno"> 2905</span>        Sample&lt;MultiPath&gt; path2 = pg2.next();</div>
<div class="line"><span class="lineno"> 2906</span>        Size l1 = path1.value[0].length() - 1;</div>
<div class="line"><span class="lineno"> 2907</span>        Size l2 = path2.value[0].length() - 1;</div>
<div class="line"><span class="lineno"> 2908</span>        Real zeur1 = path1.value[0][l1];</div>
<div class="line"><span class="lineno"> 2909</span>        Real zusd1 = path1.value[1][l1];</div>
<div class="line"><span class="lineno"> 2910</span>        Real zgbp1 = path1.value[2][l1];</div>
<div class="line"><span class="lineno"> 2911</span>        Real fxusd1 = std::exp(path1.value[3][l1]);</div>
<div class="line"><span class="lineno"> 2912</span>        Real fxgbp1 = std::exp(path1.value[4][l1]);</div>
<div class="line"><span class="lineno"> 2913</span>        Real infeurz1 = path1.value[5][l1];</div>
<div class="line"><span class="lineno"> 2914</span>        Real infeury1 = path1.value[6][l1];</div>
<div class="line"><span class="lineno"> 2915</span>        Real infgbpz1 = path1.value[7][l1];</div>
<div class="line"><span class="lineno"> 2916</span>        Real infgbpy1 = path1.value[8][l1];</div>
<div class="line"><span class="lineno"> 2917</span>        Real crzn11 = path1.value[9][l1];</div>
<div class="line"><span class="lineno"> 2918</span>        Real cryn11 = path1.value[10][l1];</div>
<div class="line"><span class="lineno"> 2919</span>        Real eq11 = path1.value[11][l1];</div>
<div class="line"><span class="lineno"> 2920</span>        Real eq21 = path1.value[12][l1];</div>
<div class="line"><span class="lineno"> 2921</span>        Real zeur2 = path2.value[0][l2];</div>
<div class="line"><span class="lineno"> 2922</span>        Real zusd2 = path2.value[1][l2];</div>
<div class="line"><span class="lineno"> 2923</span>        Real zgbp2 = path2.value[2][l2];</div>
<div class="line"><span class="lineno"> 2924</span>        Real fxusd2 = std::exp(path2.value[3][l2]);</div>
<div class="line"><span class="lineno"> 2925</span>        Real fxgbp2 = std::exp(path2.value[4][l2]);</div>
<div class="line"><span class="lineno"> 2926</span>        Real infeurz2 = path2.value[5][l2];</div>
<div class="line"><span class="lineno"> 2927</span>        Real infeury2 = path2.value[6][l2];</div>
<div class="line"><span class="lineno"> 2928</span>        Real infgbpz2 = path2.value[7][l2];</div>
<div class="line"><span class="lineno"> 2929</span>        Real infgbpy2 = path2.value[8][l2];</div>
<div class="line"><span class="lineno"> 2930</span>        Real crzn12 = path2.value[9][l2];</div>
<div class="line"><span class="lineno"> 2931</span>        Real cryn12 = path2.value[10][l2];</div>
<div class="line"><span class="lineno"> 2932</span>        Real eq12 = path2.value[11][l2];</div>
<div class="line"><span class="lineno"> 2933</span>        Real eq22 = path2.value[12][l2];</div>
<div class="line"><span class="lineno"> 2934</span> </div>
<div class="line"><span class="lineno"> 2935</span>        <span class="comment">// EUR zerobond</span></div>
<div class="line"><span class="lineno"> 2936</span>        eurzb1(d.modelExact-&gt;discountBond(0, T, T2, zeur1) / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2937</span>        <span class="comment">// USD zerobond</span></div>
<div class="line"><span class="lineno"> 2938</span>        usdzb1(d.modelExact-&gt;discountBond(1, T, T2, zusd1) * fxusd1 / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2939</span>        <span class="comment">// GBP zerobond</span></div>
<div class="line"><span class="lineno"> 2940</span>        gbpzb1(d.modelExact-&gt;discountBond(2, T, T2, zgbp1) * fxgbp1 / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2941</span>        <span class="comment">// EUR CPI indexed bond</span></div>
<div class="line"><span class="lineno"> 2942</span>        std::pair&lt;Real, Real&gt; sinfeur1 = d.modelExact-&gt;infdkI(0, T, T2, infeurz1, infeury1);</div>
<div class="line"><span class="lineno"> 2943</span>        infeur1(sinfeur1.first * sinfeur1.second * d.modelExact-&gt;discountBond(0, T, T2, zeur1) /</div>
<div class="line"><span class="lineno"> 2944</span>                d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2945</span>        <span class="comment">// GBP CPI indexed bond</span></div>
<div class="line"><span class="lineno"> 2946</span>        std::pair&lt;Real, Real&gt; sinfgbp1 = d.modelExact-&gt;infdkI(1, T, T2, infgbpz1, infgbpy1);</div>
<div class="line"><span class="lineno"> 2947</span>        infgbp1(sinfgbp1.first * sinfgbp1.second * d.modelExact-&gt;discountBond(2, T, T2, zgbp1) * fxgbp1 /</div>
<div class="line"><span class="lineno"> 2948</span>                d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2949</span>        <span class="comment">// EUR defaultable zerobond</span></div>
<div class="line"><span class="lineno"> 2950</span>        std::pair&lt;Real, Real&gt; sn11 = d.modelExact-&gt;crlgm1fS(0, 0, T, T2, crzn11, cryn11);</div>
<div class="line"><span class="lineno"> 2951</span>        n1eur1(sn11.first * sn11.second * d.modelExact-&gt;discountBond(0, T, T2, zeur1) / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2952</span>        <span class="comment">// EQ</span></div>
<div class="line"><span class="lineno"> 2953</span>        eqsp1(std::exp(eq11) * fxusd1 / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2954</span>        eqlh1(std::exp(eq21) / d.modelExact-&gt;numeraire(0, T, zeur1));</div>
<div class="line"><span class="lineno"> 2955</span> </div>
<div class="line"><span class="lineno"> 2956</span>        <span class="comment">// EUR zerobond</span></div>
<div class="line"><span class="lineno"> 2957</span>        eurzb2(d.modelExact-&gt;discountBond(0, T, T2, zeur2) / d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2958</span>        <span class="comment">// USD zerobond</span></div>
<div class="line"><span class="lineno"> 2959</span>        usdzb2(d.modelExact-&gt;discountBond(1, T, T2, zusd2) * fxusd2 / d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2960</span>        <span class="comment">// GBP zerobond</span></div>
<div class="line"><span class="lineno"> 2961</span>        gbpzb2(d.modelExact-&gt;discountBond(2, T, T2, zgbp2) * fxgbp2 / d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2962</span>        <span class="comment">// EUR CPI indexed bond</span></div>
<div class="line"><span class="lineno"> 2963</span>        std::pair&lt;Real, Real&gt; sinfeur2 = d.modelExact-&gt;infdkI(0, T, T2, infeurz2, infeury2);</div>
<div class="line"><span class="lineno"> 2964</span>        infeur2(sinfeur2.first * sinfeur2.second * d.modelExact-&gt;discountBond(0, T, T2, zeur2) /</div>
<div class="line"><span class="lineno"> 2965</span>                d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2966</span>        <span class="comment">// GBP CPI indexed bond</span></div>
<div class="line"><span class="lineno"> 2967</span>        std::pair&lt;Real, Real&gt; sinfgbp2 = d.modelExact-&gt;infdkI(1, T, T2, infgbpz2, infgbpy2);</div>
<div class="line"><span class="lineno"> 2968</span>        infgbp2(sinfgbp2.first * sinfgbp2.second * d.modelExact-&gt;discountBond(2, T, T2, zgbp2) * fxgbp2 /</div>
<div class="line"><span class="lineno"> 2969</span>                d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2970</span>        <span class="comment">// EUR defaultable zerobond</span></div>
<div class="line"><span class="lineno"> 2971</span>        std::pair&lt;Real, Real&gt; sn12 = d.modelExact-&gt;crlgm1fS(0, 0, T, T2, crzn12, cryn12);</div>
<div class="line"><span class="lineno"> 2972</span>        n1eur2(sn12.first * sn12.second * d.modelExact-&gt;discountBond(0, T, T2, zeur2) / d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2973</span>        <span class="comment">// EQ</span></div>
<div class="line"><span class="lineno"> 2974</span>        eqsp2(std::exp(eq12) * fxusd2 / d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2975</span>        eqlh2(std::exp(eq22) / d.modelExact-&gt;numeraire(0, T, zeur2));</div>
<div class="line"><span class="lineno"> 2976</span>    }</div>
<div class="line"><span class="lineno"> 2977</span> </div>
<div class="line"><span class="lineno"> 2978</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;EXACT:&quot;</span>);</div>
<div class="line"><span class="lineno"> 2979</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;EUR zb = &quot;</span> &lt;&lt; mean(eurzb1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(eurzb1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2980</span>                                   &lt;&lt; d.eurYts-&gt;discount(T2));</div>
<div class="line"><span class="lineno"> 2981</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;USD zb = &quot;</span> &lt;&lt; mean(usdzb1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(usdzb1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2982</span>                                   &lt;&lt; d.usdYts-&gt;discount(T2) * d.fxEurUsd-&gt;value());</div>
<div class="line"><span class="lineno"> 2983</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;GBP zb = &quot;</span> &lt;&lt; mean(gbpzb1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(gbpzb1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2984</span>                                   &lt;&lt; d.gbpYts-&gt;discount(T2) * d.fxEurGbp-&gt;value());</div>
<div class="line"><span class="lineno"> 2985</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;IDX zb EUR = &quot;</span> &lt;&lt; mean(infeur1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(infeur1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2986</span>                                       &lt;&lt; d.eurYts-&gt;discount(T2) *</div>
<div class="line"><span class="lineno"> 2987</span>                                              std::pow(1.0 + d.infEurTs-&gt;zeroRate(T2 - d.infLag), T2));</div>
<div class="line"><span class="lineno"> 2988</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;IDX zb GBP = &quot;</span> &lt;&lt; mean(infgbp1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(infgbp1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2989</span>                                       &lt;&lt; d.gbpYts-&gt;discount(T2) *</div>
<div class="line"><span class="lineno"> 2990</span>                                              std::pow(1.0 + d.infGbpTs-&gt;zeroRate(T2 - d.infLag), T2) *</div>
<div class="line"><span class="lineno"> 2991</span>                                              d.fxEurGbp-&gt;value());</div>
<div class="line"><span class="lineno"> 2992</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;N1 zb EUR = &quot;</span> &lt;&lt; mean(n1eur1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(n1eur1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2993</span>                                      &lt;&lt; d.eurYts-&gt;discount(T2) * d.n1Ts-&gt;survivalProbability(T2));</div>
<div class="line"><span class="lineno"> 2994</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;EQSP USD = &quot;</span> &lt;&lt; mean(eqsp1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(eqsp1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2995</span>                                     &lt;&lt; d.spSpotToday-&gt;value() * d.eqDivSp-&gt;discount(T) * d.fxEurUsd-&gt;value());</div>
<div class="line"><span class="lineno"> 2996</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;EQLH EUR = &quot;</span> &lt;&lt; mean(eqlh1) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(eqlh1) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 2997</span>                                     &lt;&lt; d.lhSpotToday-&gt;value() * d.eqDivLh-&gt;discount(T));</div>
<div class="line"><span class="lineno"> 2998</span> </div>
<div class="line"><span class="lineno"> 2999</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;\nEULER:&quot;</span>);</div>
<div class="line"><span class="lineno"> 3000</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;EUR zb = &quot;</span> &lt;&lt; mean(eurzb2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(eurzb2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 3001</span>                                   &lt;&lt; d.eurYts-&gt;discount(T2));</div>
<div class="line"><span class="lineno"> 3002</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;USD zb = &quot;</span> &lt;&lt; mean(usdzb2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(usdzb2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 3003</span>                                   &lt;&lt; d.usdYts-&gt;discount(T2) * d.fxEurUsd-&gt;value());</div>
<div class="line"><span class="lineno"> 3004</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;GBP zb = &quot;</span> &lt;&lt; mean(gbpzb2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(gbpzb2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 3005</span>                                   &lt;&lt; d.gbpYts-&gt;discount(T2) * d.fxEurGbp-&gt;value());</div>
<div class="line"><span class="lineno"> 3006</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;IDX zb EUR = &quot;</span> &lt;&lt; mean(infeur2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(infeur2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 3007</span>                                       &lt;&lt; d.eurYts-&gt;discount(T2) *</div>
<div class="line"><span class="lineno"> 3008</span>                                              std::pow(1.0 + d.infEurTs-&gt;zeroRate(T2 - d.infLag), T2));</div>
<div class="line"><span class="lineno"> 3009</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;IDX zb GBP = &quot;</span> &lt;&lt; mean(infgbp2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(infgbp2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 3010</span>                                       &lt;&lt; d.gbpYts-&gt;discount(T2) *</div>
<div class="line"><span class="lineno"> 3011</span>                                              std::pow(1.0 + d.infGbpTs-&gt;zeroRate(T2 - d.infLag), T2) *</div>
<div class="line"><span class="lineno"> 3012</span>                                              d.fxEurGbp-&gt;value());</div>
<div class="line"><span class="lineno"> 3013</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;N1 zb EUR = &quot;</span> &lt;&lt; mean(n1eur2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(n1eur2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 3014</span>                                      &lt;&lt; d.eurYts-&gt;discount(T2) * d.n1Ts-&gt;survivalProbability(T2));</div>
<div class="line"><span class="lineno"> 3015</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;EQSP USD = &quot;</span> &lt;&lt; mean(eqsp2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(eqsp2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 3016</span>                                     &lt;&lt; d.spSpotToday-&gt;value() * d.eqDivSp-&gt;discount(T) * d.fxEurUsd-&gt;value());</div>
<div class="line"><span class="lineno"> 3017</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;EQLH EUR = &quot;</span> &lt;&lt; mean(eqlh2) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(eqlh2) &lt;&lt; <span class="stringliteral">&quot; vs analytical &quot;</span></div>
<div class="line"><span class="lineno"> 3018</span>                                     &lt;&lt; d.lhSpotToday-&gt;value() * d.eqDivLh-&gt;discount(T));</div>
<div class="line"><span class="lineno"> 3019</span> </div>
<div class="line"><span class="lineno"> 3020</span>    <span class="comment">// a bit higher than for plain zero bond , since we look at indexed zero</span></div>
<div class="line"><span class="lineno"> 3021</span>    <span class="comment">// bonds, too</span></div>
<div class="line"><span class="lineno"> 3022</span>    Real tol1 = 3.0E-4, tol1r = 0.001; <span class="comment">// EXACT</span></div>
<div class="line"><span class="lineno"> 3023</span>    Real tol2 = 14.0E-4, tol2r = 0.01; <span class="comment">// EULER</span></div>
<div class="line"><span class="lineno"> 3024</span> </div>
<div class="line"><span class="lineno"> 3025</span>    Real ev = d.eurYts-&gt;discount(T2);</div>
<div class="line"><span class="lineno"> 3026</span>    <span class="keywordflow">if</span> (std::abs(mean(eurzb1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 3027</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for eurzb (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3028</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3029</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(eurzb1) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 3030</span>    ev = d.usdYts-&gt;discount(T2) * d.fxEurUsd-&gt;value();</div>
<div class="line"><span class="lineno"> 3031</span>    <span class="keywordflow">if</span> (std::abs(mean(usdzb1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 3032</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for eurzb (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3033</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3034</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(usdzb1) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 3035</span>    ev = d.gbpYts-&gt;discount(T2) * d.fxEurGbp-&gt;value();</div>
<div class="line"><span class="lineno"> 3036</span>    <span class="keywordflow">if</span> (std::abs(mean(gbpzb1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 3037</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for eurzb (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3038</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3039</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(gbpzb1) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 3040</span>    ev = d.eurYts-&gt;discount(T2) * std::pow(1.0 + d.infEurTs-&gt;zeroRate(T2 - d.infLag), T2);</div>
<div class="line"><span class="lineno"> 3041</span>    <span class="keywordflow">if</span> (std::abs(mean(infeur1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 3042</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for idx eurzb (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3043</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3044</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(infeur1) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 3045</span>    ev = d.gbpYts-&gt;discount(T2) * std::pow(1.0 + d.infGbpTs-&gt;zeroRate(T2 - d.infLag), T2) * d.fxEurGbp-&gt;value();</div>
<div class="line"><span class="lineno"> 3046</span>    <span class="keywordflow">if</span> (std::abs(mean(infgbp1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 3047</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for idx gbpzb (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3048</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3049</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(infgbp1) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 3050</span>    ev = d.eurYts-&gt;discount(T2) * d.n1Ts-&gt;survivalProbability(T2);</div>
<div class="line"><span class="lineno"> 3051</span>    <span class="keywordflow">if</span> (std::abs(mean(n1eur1) - ev) &gt; tol1)</div>
<div class="line"><span class="lineno"> 3052</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for def eurzb (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3053</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3054</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(n1eur1) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol1);</div>
<div class="line"><span class="lineno"> 3055</span>    ev = d.spSpotToday-&gt;value() * d.eqDivSp-&gt;discount(T) * d.fxEurUsd-&gt;value();</div>
<div class="line"><span class="lineno"> 3056</span>    <span class="keywordflow">if</span> (std::abs(mean(eqsp1) - ev) / ev &gt; tol1r)</div>
<div class="line"><span class="lineno"> 3057</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for eq sp (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3058</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3059</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(eqsp1) &lt;&lt; <span class="stringliteral">&quot;, rel tolerance &quot;</span> &lt;&lt; tol1r);</div>
<div class="line"><span class="lineno"> 3060</span>    ev = d.lhSpotToday-&gt;value() * d.eqDivLh-&gt;discount(T);</div>
<div class="line"><span class="lineno"> 3061</span>    <span class="keywordflow">if</span> (std::abs(mean(eqlh1) - ev) / ev &gt; tol1r)</div>
<div class="line"><span class="lineno"> 3062</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for eq lh (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3063</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3064</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(eqlh1) &lt;&lt; <span class="stringliteral">&quot;, rel tolerance &quot;</span> &lt;&lt; tol1r);</div>
<div class="line"><span class="lineno"> 3065</span> </div>
<div class="line"><span class="lineno"> 3066</span>    ev = d.eurYts-&gt;discount(T2);</div>
<div class="line"><span class="lineno"> 3067</span>    <span class="keywordflow">if</span> (std::abs(mean(eurzb2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 3068</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for eurzb (Euler discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3069</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3070</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(eurzb2) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2);</div>
<div class="line"><span class="lineno"> 3071</span>    ev = d.usdYts-&gt;discount(T2) * d.fxEurUsd-&gt;value();</div>
<div class="line"><span class="lineno"> 3072</span>    <span class="keywordflow">if</span> (std::abs(mean(usdzb2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 3073</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for usdzb (Euler discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3074</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3075</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(usdzb2) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2 * error_of&lt;tag::mean&gt;(usdzb2));</div>
<div class="line"><span class="lineno"> 3076</span>    ev = d.gbpYts-&gt;discount(T2) * d.fxEurGbp-&gt;value();</div>
<div class="line"><span class="lineno"> 3077</span>    <span class="keywordflow">if</span> (std::abs(mean(gbpzb2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 3078</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for gbpzb (Euler discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3079</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3080</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(gbpzb2) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2);</div>
<div class="line"><span class="lineno"> 3081</span>    ev = d.eurYts-&gt;discount(T2) * std::pow(1.0 + d.infEurTs-&gt;zeroRate(T2 - d.infLag), T2);</div>
<div class="line"><span class="lineno"> 3082</span>    <span class="keywordflow">if</span> (std::abs(mean(infeur2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 3083</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for idx eurzb (Euler discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3084</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3085</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(infeur2) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2);</div>
<div class="line"><span class="lineno"> 3086</span>    ev = d.gbpYts-&gt;discount(T2) * std::pow(1.0 + d.infGbpTs-&gt;zeroRate(T2 - d.infLag), T2) * d.fxEurGbp-&gt;value();</div>
<div class="line"><span class="lineno"> 3087</span>    <span class="keywordflow">if</span> (std::abs(mean(infgbp2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 3088</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for idx gbpzb (Euler discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3089</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3090</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(infgbp2) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2);</div>
<div class="line"><span class="lineno"> 3091</span>    ev = d.eurYts-&gt;discount(T2) * d.n1Ts-&gt;survivalProbability(T2);</div>
<div class="line"><span class="lineno"> 3092</span>    <span class="keywordflow">if</span> (std::abs(mean(n1eur2) - ev) &gt; tol2)</div>
<div class="line"><span class="lineno"> 3093</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for def eurzb (Euler discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3094</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3095</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(n1eur1) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol2);</div>
<div class="line"><span class="lineno"> 3096</span>    ev = d.spSpotToday-&gt;value() * d.eqDivSp-&gt;discount(T) * d.fxEurUsd-&gt;value();</div>
<div class="line"><span class="lineno"> 3097</span>    <span class="keywordflow">if</span> (std::abs(mean(eqsp2) - ev) / ev &gt; tol2r)</div>
<div class="line"><span class="lineno"> 3098</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for eq sp (Euler discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3099</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3100</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(eqsp2) &lt;&lt; <span class="stringliteral">&quot;, rel tolerance &quot;</span> &lt;&lt; tol2r);</div>
<div class="line"><span class="lineno"> 3101</span>    ev = d.lhSpotToday-&gt;value() * d.eqDivLh-&gt;discount(T);</div>
<div class="line"><span class="lineno"> 3102</span>    <span class="keywordflow">if</span> (std::abs(mean(eqlh2) - ev) / ev &gt; tol2r)</div>
<div class="line"><span class="lineno"> 3103</span>        BOOST_TEST_ERROR(<span class="stringliteral">&quot;Martingale test failed for eq lh (exact discr.),&quot;</span></div>
<div class="line"><span class="lineno"> 3104</span>                   <span class="stringliteral">&quot;expected &quot;</span></div>
<div class="line"><span class="lineno"> 3105</span>                   &lt;&lt; ev &lt;&lt; <span class="stringliteral">&quot;, got &quot;</span> &lt;&lt; mean(eqlh2) &lt;&lt; <span class="stringliteral">&quot;, rel tolerance &quot;</span> &lt;&lt; tol2r);</div>
<div class="line"><span class="lineno"> 3106</span> </div>
<div class="line"><span class="lineno"> 3107</span>} <span class="comment">// testIrFxInfCrEqMartingaleProperty</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="abc08cf7dcff36d548c38261b7358fa70" name="abc08cf7dcff36d548c38261b7358fa70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc08cf7dcff36d548c38261b7358fa70">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[15/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testIrFxInfCrEqMoments&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l03109">3109</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3109</span>                                             {</div>
<div class="line"><span class="lineno"> 3110</span> </div>
<div class="line"><span class="lineno"> 3111</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing analytic moments vs. Euler and exact discretization &quot;</span></div>
<div class="line"><span class="lineno"> 3112</span>                       <span class="stringliteral">&quot;in ir-fx-inf-cr-eq model...&quot;</span>);</div>
<div class="line"><span class="lineno"> 3113</span> </div>
<div class="line"><span class="lineno"> 3114</span>    IrFxInfCrEqModelTestData d;</div>
<div class="line"><span class="lineno"> 3115</span> </div>
<div class="line"><span class="lineno"> 3116</span>    <span class="keyword">const</span> Size n = 13; <span class="comment">// d.modelExact-&gt;dimension();</span></div>
<div class="line"><span class="lineno"> 3117</span> </div>
<div class="line"><span class="lineno"> 3118</span>    boost::shared_ptr&lt;StochasticProcess&gt; p_exact = d.modelExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 3119</span>    boost::shared_ptr&lt;StochasticProcess&gt; p_euler = d.modelExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 3120</span> </div>
<div class="line"><span class="lineno"> 3121</span>    Real T = 2.0;                           <span class="comment">// horizon at which we compare the moments</span></div>
<div class="line"><span class="lineno"> 3122</span>    Size <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a> = <span class="keyword">static_cast&lt;</span>Size<span class="keyword">&gt;</span>(T * 10); <span class="comment">// number of simulation steps (Euler and exact)</span></div>
<div class="line"><span class="lineno"> 3123</span>    Size paths = 60000;                     <span class="comment">// number of paths</span></div>
<div class="line"><span class="lineno"> 3124</span> </div>
<div class="line"><span class="lineno"> 3125</span>    Array e_an = p_exact-&gt;expectation(0.0, p_exact-&gt;initialValues(), T);</div>
<div class="line"><span class="lineno"> 3126</span>    Matrix v_an = p_exact-&gt;covariance(0.0, p_exact-&gt;initialValues(), T);</div>
<div class="line"><span class="lineno"> 3127</span> </div>
<div class="line"><span class="lineno"> 3128</span>    Size seed = 18;</div>
<div class="line"><span class="lineno"> 3129</span>    TimeGrid grid(T, <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>);</div>
<div class="line"><span class="lineno"> 3130</span> </div>
<div class="line"><span class="lineno"> 3131</span>    <a class="code hl_class" href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html">MultiPathGeneratorSobolBrownianBridge</a> pgen(p_euler, grid, SobolBrownianGenerator::Diagonal, seed,</div>
<div class="line"><span class="lineno"> 3132</span>                                               SobolRsg::JoeKuoD7);</div>
<div class="line"><span class="lineno"> 3133</span>    <a class="code hl_class" href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html">MultiPathGeneratorSobolBrownianBridge</a> pgen2(p_exact, grid, SobolBrownianGenerator::Diagonal, seed,</div>
<div class="line"><span class="lineno"> 3134</span>                                                SobolRsg::JoeKuoD7);</div>
<div class="line"><span class="lineno"> 3135</span> </div>
<div class="line"><span class="lineno"> 3136</span>    accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; e_eu[n], e_eu2[n];</div>
<div class="line"><span class="lineno"> 3137</span>    accumulator_set&lt;double, stats&lt;tag::covariance&lt;double, tag::covariate1&gt; &gt; &gt; v_eu[n][n], v_eu2[n][n];</div>
<div class="line"><span class="lineno"> 3138</span> </div>
<div class="line"><span class="lineno"> 3139</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; paths; ++i) {</div>
<div class="line"><span class="lineno"> 3140</span>        Sample&lt;MultiPath&gt; path = pgen.next();</div>
<div class="line"><span class="lineno"> 3141</span>        Sample&lt;MultiPath&gt; path2 = pgen2.next();</div>
<div class="line"><span class="lineno"> 3142</span>        <span class="keywordflow">for</span> (Size ii = 0; ii &lt; n; ++ii) {</div>
<div class="line"><span class="lineno"> 3143</span>            Real cii = path.value[ii].back();</div>
<div class="line"><span class="lineno"> 3144</span>            Real cii2 = path2.value[ii].back();</div>
<div class="line"><span class="lineno"> 3145</span>            e_eu[ii](cii);</div>
<div class="line"><span class="lineno"> 3146</span>            e_eu2[ii](cii2);</div>
<div class="line"><span class="lineno"> 3147</span>            <span class="keywordflow">for</span> (Size jj = 0; jj &lt;= ii; ++jj) {</div>
<div class="line"><span class="lineno"> 3148</span>                Real cjj = path.value[jj].back();</div>
<div class="line"><span class="lineno"> 3149</span>                v_eu[ii][jj](cii, covariate1 = cjj);</div>
<div class="line"><span class="lineno"> 3150</span>                Real cjj2 = path2.value[jj].back();</div>
<div class="line"><span class="lineno"> 3151</span>                v_eu2[ii][jj](cii2, covariate1 = cjj2);</div>
<div class="line"><span class="lineno"> 3152</span>            }</div>
<div class="line"><span class="lineno"> 3153</span>        }</div>
<div class="line"><span class="lineno"> 3154</span>    }</div>
<div class="line"><span class="lineno"> 3155</span> </div>
<div class="line"><span class="lineno"> 3156</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 3157</span>        BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;E_&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; e_an[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; mean(e_eu[i]) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; mean(e_eu2[i]));</div>
<div class="line"><span class="lineno"> 3158</span>    }</div>
<div class="line"><span class="lineno"> 3159</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;==================&quot;</span>);</div>
<div class="line"><span class="lineno"> 3160</span> </div>
<div class="line"><span class="lineno"> 3161</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;one step analytical&quot;</span>);</div>
<div class="line"><span class="lineno"> 3162</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 3163</span>        std::ostringstream tmp;</div>
<div class="line"><span class="lineno"> 3164</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 3165</span>            tmp &lt;&lt; v_an[i][j] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><span class="lineno"> 3166</span>        }</div>
<div class="line"><span class="lineno"> 3167</span>        BOOST_TEST_MESSAGE(tmp.str());</div>
<div class="line"><span class="lineno"> 3168</span>    }</div>
<div class="line"><span class="lineno"> 3169</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;==================&quot;</span>);</div>
<div class="line"><span class="lineno"> 3170</span> </div>
<div class="line"><span class="lineno"> 3171</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;euler&quot;</span>);</div>
<div class="line"><span class="lineno"> 3172</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 3173</span>        std::ostringstream tmp;</div>
<div class="line"><span class="lineno"> 3174</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 3175</span>            tmp &lt;&lt; covariance(v_eu[i][j]) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><span class="lineno"> 3176</span>        }</div>
<div class="line"><span class="lineno"> 3177</span>        BOOST_TEST_MESSAGE(tmp.str());</div>
<div class="line"><span class="lineno"> 3178</span>    }</div>
<div class="line"><span class="lineno"> 3179</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;==================&quot;</span>);</div>
<div class="line"><span class="lineno"> 3180</span> </div>
<div class="line"><span class="lineno"> 3181</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;exact&quot;</span>);</div>
<div class="line"><span class="lineno"> 3182</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 3183</span>        std::ostringstream tmp;</div>
<div class="line"><span class="lineno"> 3184</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 3185</span>            tmp &lt;&lt; covariance(v_eu2[i][j]) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><span class="lineno"> 3186</span>        }</div>
<div class="line"><span class="lineno"> 3187</span>        BOOST_TEST_MESSAGE(tmp.str());</div>
<div class="line"><span class="lineno"> 3188</span>    }</div>
<div class="line"><span class="lineno"> 3189</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;==================&quot;</span>);</div>
<div class="line"><span class="lineno"> 3190</span> </div>
<div class="line"><span class="lineno"> 3191</span>    Real errTolLd[] = { 0.5E-4, 0.5E-4, 0.5E-4, 10.0E-4, 10.0E-4, 0.7E-4, 0.7E-4,</div>
<div class="line"><span class="lineno"> 3192</span>                        0.7E-4, 0.7E-4, 0.7E-4, 0.7E-4,  10.0E-4, 10.0E-4 };</div>
<div class="line"><span class="lineno"> 3193</span>    Real errTolLdEuler[] = { 0.5E-4, 0.5E-4, 0.5E-4, 10.0E-4, 10.0E-4, 0.7E-4, 0.7E-4,</div>
<div class="line"><span class="lineno"> 3194</span>                             0.7E-4, 0.7E-4, 0.7E-4, 0.7E-4,  40.0E-4, 40.0E-4 };</div>
<div class="line"><span class="lineno"> 3195</span> </div>
<div class="line"><span class="lineno"> 3196</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 3197</span>        <span class="comment">// check expectation against analytical calculation (Euler)</span></div>
<div class="line"><span class="lineno"> 3198</span>        <span class="keywordflow">if</span> (std::fabs(mean(e_eu[i]) - e_an[i]) &gt; errTolLdEuler[i]) {</div>
<div class="line"><span class="lineno"> 3199</span>            BOOST_ERROR(<span class="stringliteral">&quot;analytical expectation for component #&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; e_an[i]</div>
<div class="line"><span class="lineno"> 3200</span>                                                                 &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical value (Euler &quot;</span></div>
<div class="line"><span class="lineno"> 3201</span>                                                                    <span class="stringliteral">&quot;discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 3202</span>                                                                 &lt;&lt; mean(e_eu[i]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 3203</span>                                                                 &lt;&lt; e_an[i] - mean(e_eu[i]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 3204</span>                                                                 &lt;&lt; errTolLdEuler[i]);</div>
<div class="line"><span class="lineno"> 3205</span>        }</div>
<div class="line"><span class="lineno"> 3206</span>        <span class="comment">// check expectation against analytical calculation (exact disc)</span></div>
<div class="line"><span class="lineno"> 3207</span>        <span class="keywordflow">if</span> (std::fabs(mean(e_eu2[i]) - e_an[i]) &gt; errTolLd[i]) {</div>
<div class="line"><span class="lineno"> 3208</span>            BOOST_ERROR(<span class="stringliteral">&quot;analytical expectation for component #&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; e_an[i]</div>
<div class="line"><span class="lineno"> 3209</span>                                                                 &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical value (exact &quot;</span></div>
<div class="line"><span class="lineno"> 3210</span>                                                                    <span class="stringliteral">&quot;discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 3211</span>                                                                 &lt;&lt; mean(e_eu2[i]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 3212</span>                                                                 &lt;&lt; e_an[i] - mean(e_eu2[i]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 3213</span>                                                                 &lt;&lt; errTolLd[i]);</div>
<div class="line"><span class="lineno"> 3214</span>        }</div>
<div class="line"><span class="lineno"> 3215</span>    }</div>
<div class="line"><span class="lineno"> 3216</span> </div>
<div class="line"><span class="lineno"> 3217</span>    <span class="comment">// as above, this is a bit rough compared to the more differentiated</span></div>
<div class="line"><span class="lineno"> 3218</span>    <span class="comment">// test of the IR-FX model ...</span></div>
<div class="line"><span class="lineno"> 3219</span>    Real tol = 10.0E-4, tolEuler = 65.0E-4;</div>
<div class="line"><span class="lineno"> 3220</span> </div>
<div class="line"><span class="lineno"> 3221</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 3222</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 3223</span>            <span class="keywordflow">if</span> (std::fabs(covariance(v_eu[i][j]) - v_an[i][j]) &gt; tolEuler) {</div>
<div class="line"><span class="lineno"> 3224</span>                BOOST_ERROR(<span class="stringliteral">&quot;analytical covariance at (&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;) (&quot;</span> &lt;&lt; v_an[i][j]</div>
<div class="line"><span class="lineno"> 3225</span>                                                         &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical &quot;</span></div>
<div class="line"><span class="lineno"> 3226</span>                                                            <span class="stringliteral">&quot;value (Euler discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 3227</span>                                                         &lt;&lt; covariance(v_eu[i][j]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 3228</span>                                                         &lt;&lt; v_an[i][j] - covariance(v_eu[i][j]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 3229</span>                                                         &lt;&lt; tolEuler);</div>
<div class="line"><span class="lineno"> 3230</span>            }</div>
<div class="line"><span class="lineno"> 3231</span>            <span class="keywordflow">if</span> (std::fabs(covariance(v_eu2[i][j]) - v_an[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 3232</span>                BOOST_ERROR(<span class="stringliteral">&quot;analytical covariance at (&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;) (&quot;</span> &lt;&lt; v_an[i][j]</div>
<div class="line"><span class="lineno"> 3233</span>                                                         &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical &quot;</span></div>
<div class="line"><span class="lineno"> 3234</span>                                                            <span class="stringliteral">&quot;value (exact discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 3235</span>                                                         &lt;&lt; covariance(v_eu2[i][j]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 3236</span>                                                         &lt;&lt; v_an[i][j] - covariance(v_eu2[i][j]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 3237</span>                                                         &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 3238</span>            }</div>
<div class="line"><span class="lineno"> 3239</span>        }</div>
<div class="line"><span class="lineno"> 3240</span>    }</div>
<div class="line"><span class="lineno"> 3241</span> </div>
<div class="line"><span class="lineno"> 3242</span>} <span class="comment">// testIrFxInfCrEqMoments</span></div>
</div><!-- fragment --><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="test_2crossassetmodel_8cpp_abc08cf7dcff36d548c38261b7358fa70_cgraph.png" border="0" usemap="#atest_2crossassetmodel_8cpp_abc08cf7dcff36d548c38261b7358fa70_cgraph" alt=""/></div>
<map name="atest_2crossassetmodel_8cpp_abc08cf7dcff36d548c38261b7358fa70_cgraph" id="atest_2crossassetmodel_8cpp_abc08cf7dcff36d548c38261b7358fa70_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,196,38"/>
<area shape="rect" href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html#ad8f5a33568da4f97b76944e9621547e2" title=" " alt="" coords="244,5,441,45"/>
</map>
</div>

</div>
</div>
<a id="a92aed2cebb3cd1f9dbb26f6faadd6ed5" name="a92aed2cebb3cd1f9dbb26f6faadd6ed5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92aed2cebb3cd1f9dbb26f6faadd6ed5">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[16/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testEqLgm5fPayouts&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l03408">3408</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3408</span>                                         {</div>
<div class="line"><span class="lineno"> 3409</span> </div>
<div class="line"><span class="lineno"> 3410</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing pricing of equity payouts under domestic &quot;</span></div>
<div class="line"><span class="lineno"> 3411</span>                       <span class="stringliteral">&quot;measure in CrossAsset LGM model...&quot;</span>);</div>
<div class="line"><span class="lineno"> 3412</span> </div>
<div class="line"><span class="lineno"> 3413</span>    IrFxEqModelTestData d;</div>
<div class="line"><span class="lineno"> 3414</span>    Settings::instance().evaluationDate() = d.referenceDate;</div>
<div class="line"><span class="lineno"> 3415</span> </div>
<div class="line"><span class="lineno"> 3416</span>    boost::shared_ptr&lt;StochasticProcess&gt; process = d.ccLgmExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 3417</span>    boost::shared_ptr&lt;StochasticProcess&gt; process2 = d.ccLgmEuler-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 3418</span> </div>
<div class="line"><span class="lineno"> 3419</span>    <span class="comment">// path generation</span></div>
<div class="line"><span class="lineno"> 3420</span> </div>
<div class="line"><span class="lineno"> 3421</span>    Size n = 500000; <span class="comment">// number of paths</span></div>
<div class="line"><span class="lineno"> 3422</span>    Size seed = 121; <span class="comment">// seed</span></div>
<div class="line"><span class="lineno"> 3423</span>    <span class="comment">// maturity of test payoffs</span></div>
<div class="line"><span class="lineno"> 3424</span>    Time T = 5.0;</div>
<div class="line"><span class="lineno"> 3425</span>    <span class="comment">// take large steps, but not only one (since we are testing)</span></div>
<div class="line"><span class="lineno"> 3426</span>    Size <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a> = <span class="keyword">static_cast&lt;</span>Size<span class="keyword">&gt;</span>(T * 2.0);</div>
<div class="line"><span class="lineno"> 3427</span>    Size steps_euler = <span class="keyword">static_cast&lt;</span>Size<span class="keyword">&gt;</span>(T * 52.0);</div>
<div class="line"><span class="lineno"> 3428</span>    TimeGrid grid(T, <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>);</div>
<div class="line"><span class="lineno"> 3429</span>    TimeGrid grid_euler(T, steps_euler);</div>
<div class="line"><span class="lineno"> 3430</span>    PseudoRandom::rsg_type sg2 = PseudoRandom::make_sequence_generator(<a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>, seed);</div>
<div class="line"><span class="lineno"> 3431</span> </div>
<div class="line"><span class="lineno"> 3432</span>    <a class="code hl_class" href="class_quant_ext_1_1_multi_path_generator_mersenne_twister.html">MultiPathGeneratorMersenneTwister</a> pg(process, grid, seed, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 3433</span>    <a class="code hl_class" href="class_quant_ext_1_1_multi_path_generator_mersenne_twister.html">MultiPathGeneratorMersenneTwister</a> pg2(process2, grid_euler, seed, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 3434</span> </div>
<div class="line"><span class="lineno"> 3435</span>    <span class="comment">// test</span></div>
<div class="line"><span class="lineno"> 3436</span>    <span class="comment">// 1 LH (EUR) forward under CrossAsset numeraire vs. analytic pricing engine</span></div>
<div class="line"><span class="lineno"> 3437</span>    <span class="comment">// 2 SP (USD) forward (converted to EUR) under CrossAsset numeraire vs. analytic pricing engine</span></div>
<div class="line"><span class="lineno"> 3438</span>    <span class="comment">// 3 LH (EUR) EQ option under CrossAsset numeraire vs. analytic pricing engine</span></div>
<div class="line"><span class="lineno"> 3439</span>    <span class="comment">// 4 SP (USD) EQ option under CrossAsset numeraire vs. analytic pricing engine</span></div>
<div class="line"><span class="lineno"> 3440</span> </div>
<div class="line"><span class="lineno"> 3441</span>    accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; stat1, stat2, stat3a, stat3b, stat4a, stat4b;</div>
<div class="line"><span class="lineno"> 3442</span> </div>
<div class="line"><span class="lineno"> 3443</span>    Real strikeLh = 12.7;</div>
<div class="line"><span class="lineno"> 3444</span>    Real strikeSp = 2150.0;</div>
<div class="line"><span class="lineno"> 3445</span> </div>
<div class="line"><span class="lineno"> 3446</span>    <span class="comment">// same for paths2 since shared time grid</span></div>
<div class="line"><span class="lineno"> 3447</span>    <span class="keywordflow">for</span> (Size j = 0; j &lt; n; ++j) {</div>
<div class="line"><span class="lineno"> 3448</span>        Sample&lt;MultiPath&gt; path = pg.next();</div>
<div class="line"><span class="lineno"> 3449</span>        <span class="comment">// Sample&lt;MultiPath&gt; path = pg2.next();</span></div>
<div class="line"><span class="lineno"> 3450</span>        Size l = path.value[0].length() - 1;</div>
<div class="line"><span class="lineno"> 3451</span>        Real eurusdfx = std::exp(path.value[2][l]);</div>
<div class="line"><span class="lineno"> 3452</span>        Real zeur = path.value[0][l];</div>
<div class="line"><span class="lineno"> 3453</span>        Real eqsp = std::exp(path.value[3][l]);</div>
<div class="line"><span class="lineno"> 3454</span>        Real eqlh = std::exp(path.value[4][l]);</div>
<div class="line"><span class="lineno"> 3455</span>        Real ccnum = d.ccLgmExact-&gt;numeraire(0, T, zeur);</div>
<div class="line"><span class="lineno"> 3456</span> </div>
<div class="line"><span class="lineno"> 3457</span>        <span class="comment">// 1 LH forward settled at T deflated with numeraire</span></div>
<div class="line"><span class="lineno"> 3458</span>        Real lhFwd = eqlh - strikeLh;</div>
<div class="line"><span class="lineno"> 3459</span>        stat1(lhFwd / ccnum);</div>
<div class="line"><span class="lineno"> 3460</span> </div>
<div class="line"><span class="lineno"> 3461</span>        <span class="comment">// 2 SP forward settled at T (converted to base) deflated with numeraire</span></div>
<div class="line"><span class="lineno"> 3462</span>        Real spFwd = eurusdfx * (eqsp - strikeSp);</div>
<div class="line"><span class="lineno"> 3463</span>        stat2(spFwd / ccnum);</div>
<div class="line"><span class="lineno"> 3464</span> </div>
<div class="line"><span class="lineno"> 3465</span>        <span class="comment">// 3 LH option exercise at T deflated with numeraire</span></div>
<div class="line"><span class="lineno"> 3466</span>        Real lhCall = std::max(lhFwd, 0.0);</div>
<div class="line"><span class="lineno"> 3467</span>        Real lhPut = std::max(-1.0 * lhFwd, 0.0);</div>
<div class="line"><span class="lineno"> 3468</span>        stat3a(lhCall / ccnum);</div>
<div class="line"><span class="lineno"> 3469</span>        stat3b(lhPut / ccnum);</div>
<div class="line"><span class="lineno"> 3470</span> </div>
<div class="line"><span class="lineno"> 3471</span>        <span class="comment">// 4 SP option exercise at T (converted to base) deflated with numeraire</span></div>
<div class="line"><span class="lineno"> 3472</span>        Real spCall = std::max(spFwd, 0.0);</div>
<div class="line"><span class="lineno"> 3473</span>        Real spPut = std::max(-1.0 * spFwd, 0.0);</div>
<div class="line"><span class="lineno"> 3474</span>        stat4a(spCall / ccnum);</div>
<div class="line"><span class="lineno"> 3475</span>        stat4b(spPut / ccnum);</div>
<div class="line"><span class="lineno"> 3476</span>    }</div>
<div class="line"><span class="lineno"> 3477</span> </div>
<div class="line"><span class="lineno"> 3478</span>    Date tradeMaturity = d.referenceDate + 5 * 365;</div>
<div class="line"><span class="lineno"> 3479</span> </div>
<div class="line"><span class="lineno"> 3480</span>    boost::shared_ptr&lt;EquityForward&gt; lhFwdTrade =</div>
<div class="line"><span class="lineno"> 3481</span>        boost::make_shared&lt;EquityForward&gt;(<span class="stringliteral">&quot;LH&quot;</span>, EURCurrency(), Position::Long, 1, tradeMaturity, strikeLh);</div>
<div class="line"><span class="lineno"> 3482</span>    boost::shared_ptr&lt;EquityForward&gt; spFwdTrade =</div>
<div class="line"><span class="lineno"> 3483</span>        boost::make_shared&lt;EquityForward&gt;(<span class="stringliteral">&quot;SP&quot;</span>, USDCurrency(), Position::Long, 1, tradeMaturity, strikeSp);</div>
<div class="line"><span class="lineno"> 3484</span> </div>
<div class="line"><span class="lineno"> 3485</span>    boost::shared_ptr&lt;VanillaOption&gt; lhCall =</div>
<div class="line"><span class="lineno"> 3486</span>        boost::make_shared&lt;VanillaOption&gt;(boost::make_shared&lt;PlainVanillaPayoff&gt;(Option::Call, strikeLh),</div>
<div class="line"><span class="lineno"> 3487</span>                                          boost::make_shared&lt;EuropeanExercise&gt;(d.referenceDate + 5 * 365));</div>
<div class="line"><span class="lineno"> 3488</span>    boost::shared_ptr&lt;VanillaOption&gt; lhPut =</div>
<div class="line"><span class="lineno"> 3489</span>        boost::make_shared&lt;VanillaOption&gt;(boost::make_shared&lt;PlainVanillaPayoff&gt;(Option::Put, strikeLh),</div>
<div class="line"><span class="lineno"> 3490</span>                                          boost::make_shared&lt;EuropeanExercise&gt;(d.referenceDate + 5 * 365));</div>
<div class="line"><span class="lineno"> 3491</span>    boost::shared_ptr&lt;VanillaOption&gt; spCall =</div>
<div class="line"><span class="lineno"> 3492</span>        boost::make_shared&lt;VanillaOption&gt;(boost::make_shared&lt;PlainVanillaPayoff&gt;(Option::Call, strikeSp),</div>
<div class="line"><span class="lineno"> 3493</span>                                          boost::make_shared&lt;EuropeanExercise&gt;(d.referenceDate + 5 * 365));</div>
<div class="line"><span class="lineno"> 3494</span>    boost::shared_ptr&lt;VanillaOption&gt; spPut =</div>
<div class="line"><span class="lineno"> 3495</span>        boost::make_shared&lt;VanillaOption&gt;(boost::make_shared&lt;PlainVanillaPayoff&gt;(Option::Put, strikeSp),</div>
<div class="line"><span class="lineno"> 3496</span>                                          boost::make_shared&lt;EuropeanExercise&gt;(d.referenceDate + 5 * 365));</div>
<div class="line"><span class="lineno"> 3497</span> </div>
<div class="line"><span class="lineno"> 3498</span>    boost::shared_ptr&lt;DiscountingEquityForwardEngine&gt; lhFwdEngine =</div>
<div class="line"><span class="lineno"> 3499</span>        boost::make_shared&lt;DiscountingEquityForwardEngine&gt;(d.eurYts, d.eqDivLh, d.lhSpotToday, d.eurYts);</div>
<div class="line"><span class="lineno"> 3500</span>    boost::shared_ptr&lt;DiscountingEquityForwardEngine&gt; spFwdEngine =</div>
<div class="line"><span class="lineno"> 3501</span>        boost::make_shared&lt;DiscountingEquityForwardEngine&gt;(d.usdYts, d.eqDivSp, d.spSpotToday, d.usdYts);</div>
<div class="line"><span class="lineno"> 3502</span> </div>
<div class="line"><span class="lineno"> 3503</span>    lhFwdTrade-&gt;setPricingEngine(lhFwdEngine);</div>
<div class="line"><span class="lineno"> 3504</span>    spFwdTrade-&gt;setPricingEngine(spFwdEngine);</div>
<div class="line"><span class="lineno"> 3505</span> </div>
<div class="line"><span class="lineno"> 3506</span>    boost::shared_ptr&lt;AnalyticXAssetLgmEquityOptionEngine&gt; spEqOptionEngine =</div>
<div class="line"><span class="lineno"> 3507</span>        boost::make_shared&lt;AnalyticXAssetLgmEquityOptionEngine&gt;(</div>
<div class="line"><span class="lineno"> 3508</span>            d.ccLgmExact, d.eqSpIdx, d.ccLgmExact-&gt;ccyIndex(d.ccLgmExact-&gt;eqbs(d.eqSpIdx)-&gt;currency()));</div>
<div class="line"><span class="lineno"> 3509</span>    boost::shared_ptr&lt;AnalyticXAssetLgmEquityOptionEngine&gt; lhEqOptionEngine =</div>
<div class="line"><span class="lineno"> 3510</span>        boost::make_shared&lt;AnalyticXAssetLgmEquityOptionEngine&gt;(</div>
<div class="line"><span class="lineno"> 3511</span>            d.ccLgmExact, d.eqLhIdx, d.ccLgmExact-&gt;ccyIndex(d.ccLgmExact-&gt;eqbs(d.eqLhIdx)-&gt;currency()));</div>
<div class="line"><span class="lineno"> 3512</span> </div>
<div class="line"><span class="lineno"> 3513</span>    lhCall-&gt;setPricingEngine(lhEqOptionEngine);</div>
<div class="line"><span class="lineno"> 3514</span>    lhPut-&gt;setPricingEngine(lhEqOptionEngine);</div>
<div class="line"><span class="lineno"> 3515</span>    spCall-&gt;setPricingEngine(spEqOptionEngine);</div>
<div class="line"><span class="lineno"> 3516</span>    spPut-&gt;setPricingEngine(spEqOptionEngine);</div>
<div class="line"><span class="lineno"> 3517</span> </div>
<div class="line"><span class="lineno"> 3518</span>    Real npv1 = mean(stat1);</div>
<div class="line"><span class="lineno"> 3519</span>    Real error1 = error_of&lt;tag::mean&gt;(stat1);</div>
<div class="line"><span class="lineno"> 3520</span>    Real expected1 = lhFwdTrade-&gt;NPV();</div>
<div class="line"><span class="lineno"> 3521</span> </div>
<div class="line"><span class="lineno"> 3522</span>    Real npv2 = mean(stat2);</div>
<div class="line"><span class="lineno"> 3523</span>    Real error2 = error_of&lt;tag::mean&gt;(stat2);</div>
<div class="line"><span class="lineno"> 3524</span>    Real expected2 = d.usdEurSpotToday-&gt;value() * spFwdTrade-&gt;NPV();</div>
<div class="line"><span class="lineno"> 3525</span> </div>
<div class="line"><span class="lineno"> 3526</span>    Real npv3a = mean(stat3a);</div>
<div class="line"><span class="lineno"> 3527</span>    Real error3a = error_of&lt;tag::mean&gt;(stat3a);</div>
<div class="line"><span class="lineno"> 3528</span>    Real expected3a = lhCall-&gt;NPV();</div>
<div class="line"><span class="lineno"> 3529</span>    Real npv3b = mean(stat3b);</div>
<div class="line"><span class="lineno"> 3530</span>    Real error3b = error_of&lt;tag::mean&gt;(stat3b);</div>
<div class="line"><span class="lineno"> 3531</span>    Real expected3b = lhPut-&gt;NPV();</div>
<div class="line"><span class="lineno"> 3532</span> </div>
<div class="line"><span class="lineno"> 3533</span>    Real npv4a = mean(stat4a);</div>
<div class="line"><span class="lineno"> 3534</span>    Real error4a = error_of&lt;tag::mean&gt;(stat4a);</div>
<div class="line"><span class="lineno"> 3535</span>    Real expected4a = d.usdEurSpotToday-&gt;value() * spCall-&gt;NPV();</div>
<div class="line"><span class="lineno"> 3536</span>    Real npv4b = mean(stat4b);</div>
<div class="line"><span class="lineno"> 3537</span>    Real error4b = error_of&lt;tag::mean&gt;(stat4b);</div>
<div class="line"><span class="lineno"> 3538</span>    Real expected4b = d.usdEurSpotToday-&gt;value() * spPut-&gt;NPV();</div>
<div class="line"><span class="lineno"> 3539</span> </div>
<div class="line"><span class="lineno"> 3540</span>    Real tolErrEst = 1.5; <span class="comment">// allow absolute diffs to be within 1.5 standard errors</span></div>
<div class="line"><span class="lineno"> 3541</span>    <span class="comment">// TODO : IS THIS STRICT ENOUGH?</span></div>
<div class="line"><span class="lineno"> 3542</span>    BOOST_CHECK_LE(std::fabs(npv1 - expected1), tolErrEst * error1);</div>
<div class="line"><span class="lineno"> 3543</span>    BOOST_CHECK_LE(std::fabs(npv2 - expected2), tolErrEst * error2);</div>
<div class="line"><span class="lineno"> 3544</span>    BOOST_CHECK_LE(std::fabs(npv3a - expected3a), tolErrEst * error3a);</div>
<div class="line"><span class="lineno"> 3545</span>    BOOST_CHECK_LE(std::fabs(npv3b - expected3b), tolErrEst * error3b);</div>
<div class="line"><span class="lineno"> 3546</span>    BOOST_CHECK_LE(std::fabs(npv4a - expected4a), tolErrEst * error4a);</div>
<div class="line"><span class="lineno"> 3547</span>    BOOST_CHECK_LE(std::fabs(npv4b - expected4b), tolErrEst * error4b);</div>
<div class="line"><span class="lineno"> 3548</span> </div>
<div class="line"><span class="lineno"> 3549</span>} <span class="comment">// testEqLgm5fPayouts</span></div>
</div><!-- fragment --><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="test_2crossassetmodel_8cpp_a92aed2cebb3cd1f9dbb26f6faadd6ed5_cgraph.png" border="0" usemap="#atest_2crossassetmodel_8cpp_a92aed2cebb3cd1f9dbb26f6faadd6ed5_cgraph" alt=""/></div>
<map name="atest_2crossassetmodel_8cpp_a92aed2cebb3cd1f9dbb26f6faadd6ed5_cgraph" id="atest_2crossassetmodel_8cpp_a92aed2cebb3cd1f9dbb26f6faadd6ed5_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,196,38"/>
<area shape="rect" href="class_quant_ext_1_1_multi_path_generator_mersenne_twister.html#ad8f5a33568da4f97b76944e9621547e2" title=" " alt="" coords="244,5,441,45"/>
</map>
</div>

</div>
</div>
<a id="aa89ea3d346617cd549d68c8d53d75bb2" name="aa89ea3d346617cd549d68c8d53d75bb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa89ea3d346617cd549d68c8d53d75bb2">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[17/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testEqLgm5fCalibration&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l03551">3551</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3551</span>                                             {</div>
<div class="line"><span class="lineno"> 3552</span> </div>
<div class="line"><span class="lineno"> 3553</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing EQ calibration of IR-FX-EQ LGM 5F model...&quot;</span>);</div>
<div class="line"><span class="lineno"> 3554</span> </div>
<div class="line"><span class="lineno"> 3555</span>    IrFxEqModelTestData d;</div>
<div class="line"><span class="lineno"> 3556</span>    Settings::instance().evaluationDate() = d.referenceDate;</div>
<div class="line"><span class="lineno"> 3557</span> </div>
<div class="line"><span class="lineno"> 3558</span>    <span class="comment">// calibration baskets</span></div>
<div class="line"><span class="lineno"> 3559</span>    std::vector&lt;boost::shared_ptr&lt;BlackCalibrationHelper&gt; &gt; basketSp, basketLh;</div>
<div class="line"><span class="lineno"> 3560</span> </div>
<div class="line"><span class="lineno"> 3561</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; d.volstepdatesEqSp.size(); ++i) {</div>
<div class="line"><span class="lineno"> 3562</span>        Date tmp = i &lt; d.volstepdatesEqSp.size() ? d.volstepdatesEqSp[i] : d.volstepdatesEqSp.back() + 365;</div>
<div class="line"><span class="lineno"> 3563</span>        basketSp.push_back(boost::make_shared&lt;FxEqOptionHelper&gt;(</div>
<div class="line"><span class="lineno"> 3564</span>            tmp, Null&lt;Real&gt;(), d.spSpotToday, Handle&lt;Quote&gt;(boost::make_shared&lt;SimpleQuote&gt;(0.20)), d.usdYts, d.eqDivSp,</div>
<div class="line"><span class="lineno"> 3565</span>            BlackCalibrationHelper::RelativePriceError));</div>
<div class="line"><span class="lineno"> 3566</span>    }</div>
<div class="line"><span class="lineno"> 3567</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; d.volstepdatesEqLh.size(); ++i) {</div>
<div class="line"><span class="lineno"> 3568</span>        Date tmp = i &lt; d.volstepdatesEqLh.size() ? d.volstepdatesEqLh[i] : d.volstepdatesEqLh.back() + 365;</div>
<div class="line"><span class="lineno"> 3569</span>        basketLh.push_back(boost::make_shared&lt;FxEqOptionHelper&gt;(</div>
<div class="line"><span class="lineno"> 3570</span>            tmp, Null&lt;Real&gt;(), d.lhSpotToday, Handle&lt;Quote&gt;(boost::make_shared&lt;SimpleQuote&gt;(0.20)), d.eurYts, d.eqDivLh,</div>
<div class="line"><span class="lineno"> 3571</span>            BlackCalibrationHelper::RelativePriceError));</div>
<div class="line"><span class="lineno"> 3572</span>    }</div>
<div class="line"><span class="lineno"> 3573</span> </div>
<div class="line"><span class="lineno"> 3574</span>    <span class="comment">// pricing engines</span></div>
<div class="line"><span class="lineno"> 3575</span>    boost::shared_ptr&lt;AnalyticXAssetLgmEquityOptionEngine&gt; spEqOptionEngine =</div>
<div class="line"><span class="lineno"> 3576</span>        boost::make_shared&lt;AnalyticXAssetLgmEquityOptionEngine&gt;(</div>
<div class="line"><span class="lineno"> 3577</span>            d.ccLgmExact, d.eqSpIdx, d.ccLgmExact-&gt;ccyIndex(d.ccLgmExact-&gt;eqbs(d.eqSpIdx)-&gt;currency()));</div>
<div class="line"><span class="lineno"> 3578</span>    boost::shared_ptr&lt;AnalyticXAssetLgmEquityOptionEngine&gt; lhEqOptionEngine =</div>
<div class="line"><span class="lineno"> 3579</span>        boost::make_shared&lt;AnalyticXAssetLgmEquityOptionEngine&gt;(</div>
<div class="line"><span class="lineno"> 3580</span>            d.ccLgmExact, d.eqLhIdx, d.ccLgmExact-&gt;ccyIndex(d.ccLgmExact-&gt;eqbs(d.eqLhIdx)-&gt;currency()));</div>
<div class="line"><span class="lineno"> 3581</span> </div>
<div class="line"><span class="lineno"> 3582</span>    <span class="comment">// assign engines to calibration instruments</span></div>
<div class="line"><span class="lineno"> 3583</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basketSp.size(); ++i) {</div>
<div class="line"><span class="lineno"> 3584</span>        basketSp[i]-&gt;setPricingEngine(spEqOptionEngine);</div>
<div class="line"><span class="lineno"> 3585</span>    }</div>
<div class="line"><span class="lineno"> 3586</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basketLh.size(); ++i) {</div>
<div class="line"><span class="lineno"> 3587</span>        basketLh[i]-&gt;setPricingEngine(lhEqOptionEngine);</div>
<div class="line"><span class="lineno"> 3588</span>    }</div>
<div class="line"><span class="lineno"> 3589</span> </div>
<div class="line"><span class="lineno"> 3590</span>    <span class="comment">// calibrate the model</span></div>
<div class="line"><span class="lineno"> 3591</span>    LevenbergMarquardt lm(1E-8, 1E-8, 1E-8);</div>
<div class="line"><span class="lineno"> 3592</span>    EndCriteria ec(1000, 500, 1E-8, 1E-8, 1E-8);</div>
<div class="line"><span class="lineno"> 3593</span> </div>
<div class="line"><span class="lineno"> 3594</span>    d.ccLgmExact-&gt;calibrateBsVolatilitiesIterative(CrossAssetModel::AssetType::EQ, d.eqSpIdx, basketSp, lm, ec);</div>
<div class="line"><span class="lineno"> 3595</span>    d.ccLgmExact-&gt;calibrateBsVolatilitiesIterative(CrossAssetModel::AssetType::EQ, d.eqLhIdx, basketLh, lm, ec);</div>
<div class="line"><span class="lineno"> 3596</span> </div>
<div class="line"><span class="lineno"> 3597</span>    <span class="comment">// check the results</span></div>
<div class="line"><span class="lineno"> 3598</span>    Real tol = 1E-6;</div>
<div class="line"><span class="lineno"> 3599</span> </div>
<div class="line"><span class="lineno"> 3600</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basketSp.size(); ++i) {</div>
<div class="line"><span class="lineno"> 3601</span>        Real model = basketSp[i]-&gt;modelValue();</div>
<div class="line"><span class="lineno"> 3602</span>        Real market = basketSp[i]-&gt;marketValue();</div>
<div class="line"><span class="lineno"> 3603</span>        <span class="keywordflow">if</span> (std::abs((model - market) / market) &gt; tol)</div>
<div class="line"><span class="lineno"> 3604</span>            BOOST_ERROR(<span class="stringliteral">&quot;calibration failed for instrument #&quot;</span></div>
<div class="line"><span class="lineno"> 3605</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; in SP basket, model value is &quot;</span> &lt;&lt; model &lt;&lt; <span class="stringliteral">&quot; market value is &quot;</span> &lt;&lt; market</div>
<div class="line"><span class="lineno"> 3606</span>                        &lt;&lt; <span class="stringliteral">&quot; relative error &quot;</span> &lt;&lt; std::abs((model - market) / market) &lt;&lt; <span class="stringliteral">&quot; tolerance &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 3607</span>    }</div>
<div class="line"><span class="lineno"> 3608</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; basketLh.size(); ++i) {</div>
<div class="line"><span class="lineno"> 3609</span>        Real model = basketLh[i]-&gt;modelValue();</div>
<div class="line"><span class="lineno"> 3610</span>        Real market = basketLh[i]-&gt;marketValue();</div>
<div class="line"><span class="lineno"> 3611</span>        <span class="keywordflow">if</span> (std::abs((model - market) / market) &gt; tol)</div>
<div class="line"><span class="lineno"> 3612</span>            BOOST_ERROR(<span class="stringliteral">&quot;calibration failed for instrument #&quot;</span></div>
<div class="line"><span class="lineno"> 3613</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; in LH basket, model value is &quot;</span> &lt;&lt; model &lt;&lt; <span class="stringliteral">&quot; market value is &quot;</span> &lt;&lt; market</div>
<div class="line"><span class="lineno"> 3614</span>                        &lt;&lt; <span class="stringliteral">&quot; relative error &quot;</span> &lt;&lt; std::abs((model - market) / market) &lt;&lt; <span class="stringliteral">&quot; tolerance &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 3615</span>    }</div>
<div class="line"><span class="lineno"> 3616</span>} <span class="comment">// testEqLgm5fCalibration</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a230062c157e987f941fead5bf5501c45" name="a230062c157e987f941fead5bf5501c45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a230062c157e987f941fead5bf5501c45">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[18/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testEqLgm5fMoments&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l03618">3618</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3618</span>                                         {</div>
<div class="line"><span class="lineno"> 3619</span> </div>
<div class="line"><span class="lineno"> 3620</span>    <span class="comment">// TODO : REVIEW TOLERANCES</span></div>
<div class="line"><span class="lineno"> 3621</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing analytic moments vs. Euler and exact discretization &quot;</span></div>
<div class="line"><span class="lineno"> 3622</span>                       <span class="stringliteral">&quot;in IR-FX-EQ LGM 5F model...&quot;</span>);</div>
<div class="line"><span class="lineno"> 3623</span> </div>
<div class="line"><span class="lineno"> 3624</span>    IrFxEqModelTestData d;</div>
<div class="line"><span class="lineno"> 3625</span>    Settings::instance().evaluationDate() = d.referenceDate;</div>
<div class="line"><span class="lineno"> 3626</span> </div>
<div class="line"><span class="lineno"> 3627</span>    boost::shared_ptr&lt;StochasticProcess&gt; p_exact = d.ccLgmExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 3628</span>    boost::shared_ptr&lt;StochasticProcess&gt; p_euler = d.ccLgmEuler-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 3629</span> </div>
<div class="line"><span class="lineno"> 3630</span>    Real T = 2.0;                                   <span class="comment">// horizon at which we compare the moments</span></div>
<div class="line"><span class="lineno"> 3631</span>    Size steps_euler = <span class="keyword">static_cast&lt;</span>Size<span class="keyword">&gt;</span>(T * 50.0); <span class="comment">// number of simulation steps</span></div>
<div class="line"><span class="lineno"> 3632</span>    Size steps_exact = 1;</div>
<div class="line"><span class="lineno"> 3633</span>    Size paths = 25000; <span class="comment">// number of paths</span></div>
<div class="line"><span class="lineno"> 3634</span> </div>
<div class="line"><span class="lineno"> 3635</span>    Array e_an = p_exact-&gt;expectation(0.0, p_exact-&gt;initialValues(), T);</div>
<div class="line"><span class="lineno"> 3636</span>    Matrix v_an = p_exact-&gt;covariance(0.0, p_exact-&gt;initialValues(), T);</div>
<div class="line"><span class="lineno"> 3637</span>    Matrix v_an_eu = p_euler-&gt;covariance(0.0, p_euler-&gt;initialValues(), T);</div>
<div class="line"><span class="lineno"> 3638</span> </div>
<div class="line"><span class="lineno"> 3639</span>    TimeGrid grid_euler(T, steps_euler);</div>
<div class="line"><span class="lineno"> 3640</span>    TimeGrid grid_exact(T, steps_exact);</div>
<div class="line"><span class="lineno"> 3641</span> </div>
<div class="line"><span class="lineno"> 3642</span>    <a class="code hl_class" href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html">MultiPathGeneratorSobolBrownianBridge</a> pgen(p_euler, grid_euler);</div>
<div class="line"><span class="lineno"> 3643</span>    <a class="code hl_class" href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html">MultiPathGeneratorSobolBrownianBridge</a> pgen2(p_exact, grid_exact);</div>
<div class="line"><span class="lineno"> 3644</span> </div>
<div class="line"><span class="lineno"> 3645</span>    accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; e_eu[5], e_eu2[5];</div>
<div class="line"><span class="lineno"> 3646</span>    accumulator_set&lt;double, stats&lt;tag::covariance&lt;double, tag::covariate1&gt; &gt; &gt; v_eu[5][5], v_eu2[5][5];</div>
<div class="line"><span class="lineno"> 3647</span> </div>
<div class="line"><span class="lineno"> 3648</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; paths; ++i) {</div>
<div class="line"><span class="lineno"> 3649</span>        Sample&lt;MultiPath&gt; path = pgen.next();</div>
<div class="line"><span class="lineno"> 3650</span>        Sample&lt;MultiPath&gt; path2 = pgen2.next();</div>
<div class="line"><span class="lineno"> 3651</span>        <span class="keywordflow">for</span> (Size ii = 0; ii &lt; 5; ++ii) {</div>
<div class="line"><span class="lineno"> 3652</span>            Real cii = path.value[ii].back();</div>
<div class="line"><span class="lineno"> 3653</span>            Real cii2 = path2.value[ii].back();</div>
<div class="line"><span class="lineno"> 3654</span>            e_eu[ii](cii);</div>
<div class="line"><span class="lineno"> 3655</span>            e_eu2[ii](cii2);</div>
<div class="line"><span class="lineno"> 3656</span>            <span class="keywordflow">for</span> (Size jj = 0; jj &lt;= ii; ++jj) {</div>
<div class="line"><span class="lineno"> 3657</span>                Real cjj = path.value[jj].back();</div>
<div class="line"><span class="lineno"> 3658</span>                v_eu[ii][jj](cii, covariate1 = cjj);</div>
<div class="line"><span class="lineno"> 3659</span>                Real cjj2 = path2.value[jj].back();</div>
<div class="line"><span class="lineno"> 3660</span>                v_eu2[ii][jj](cii2, covariate1 = cjj2);</div>
<div class="line"><span class="lineno"> 3661</span>            }</div>
<div class="line"><span class="lineno"> 3662</span>        }</div>
<div class="line"><span class="lineno"> 3663</span>    }</div>
<div class="line"><span class="lineno"> 3664</span> </div>
<div class="line"><span class="lineno"> 3665</span>    Real errTol[] = { 0.2E-4, 0.2E-4, 10.0E-4, 10.0E-4, 10.0E-4 };</div>
<div class="line"><span class="lineno"> 3666</span> </div>
<div class="line"><span class="lineno"> 3667</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; 5; ++i) {</div>
<div class="line"><span class="lineno"> 3668</span>        <span class="comment">// check expectation against analytical calculation (Euler)</span></div>
<div class="line"><span class="lineno"> 3669</span>        <span class="keywordflow">if</span> (std::fabs(mean(e_eu[i]) - e_an[i]) &gt; errTol[i]) {</div>
<div class="line"><span class="lineno"> 3670</span>            BOOST_ERROR(<span class="stringliteral">&quot;analytical expectation for component #&quot;</span></div>
<div class="line"><span class="lineno"> 3671</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; e_an[i]</div>
<div class="line"><span class="lineno"> 3672</span>                        &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical value (Euler &quot;</span></div>
<div class="line"><span class="lineno"> 3673</span>                           <span class="stringliteral">&quot;discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 3674</span>                        &lt;&lt; mean(e_eu[i]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span> &lt;&lt; e_an[i] - mean(e_eu[i]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span> &lt;&lt; errTol[i]);</div>
<div class="line"><span class="lineno"> 3675</span>        }</div>
<div class="line"><span class="lineno"> 3676</span>        <span class="comment">// check expectation against analytical calculation (exact disc)</span></div>
<div class="line"><span class="lineno"> 3677</span>        <span class="keywordflow">if</span> (std::fabs(mean(e_eu2[i]) - e_an[i]) &gt; errTol[i]) {</div>
<div class="line"><span class="lineno"> 3678</span>            BOOST_ERROR(<span class="stringliteral">&quot;analytical expectation for component #&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; e_an[i]</div>
<div class="line"><span class="lineno"> 3679</span>                                                                 &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical value (Exact &quot;</span></div>
<div class="line"><span class="lineno"> 3680</span>                                                                    <span class="stringliteral">&quot;discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 3681</span>                                                                 &lt;&lt; mean(e_eu2[i]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 3682</span>                                                                 &lt;&lt; e_an[i] - mean(e_eu2[i]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 3683</span>                                                                 &lt;&lt; errTol[i]);</div>
<div class="line"><span class="lineno"> 3684</span>        }</div>
<div class="line"><span class="lineno"> 3685</span>    }</div>
<div class="line"><span class="lineno"> 3686</span> </div>
<div class="line"><span class="lineno"> 3687</span>    <span class="comment">// we have to deal with different natures of volatility</span></div>
<div class="line"><span class="lineno"> 3688</span>    <span class="comment">// for ir (normal) and fx (ln) so different error</span></div>
<div class="line"><span class="lineno"> 3689</span>    <span class="comment">// tolerances apply</span></div>
<div class="line"><span class="lineno"> 3690</span>    Real tollNormal = 0.1E-4; <span class="comment">// ir-ir</span></div>
<div class="line"><span class="lineno"> 3691</span>    Real tolMixed = 0.25E-4;  <span class="comment">// ir-fx, ir-eq</span></div>
<div class="line"><span class="lineno"> 3692</span>    Real tolLn = 8.0E-4;      <span class="comment">// fx-fx, fx-eq</span></div>
<div class="line"><span class="lineno"> 3693</span>    Real tolEq = 12.0E-4;     <span class="comment">// eq-eq (to account for higher eq vols)</span></div>
<div class="line"><span class="lineno"> 3694</span>    Real tol;                 <span class="comment">// set below</span></div>
<div class="line"><span class="lineno"> 3695</span> </div>
<div class="line"><span class="lineno"> 3696</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; 5; ++i) {</div>
<div class="line"><span class="lineno"> 3697</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 3698</span>            <span class="keywordflow">if</span> (i &lt; 2) {</div>
<div class="line"><span class="lineno"> 3699</span>                tol = tollNormal;</div>
<div class="line"><span class="lineno"> 3700</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i &gt;= 3) &amp;&amp; (j &gt;= 3)) {</div>
<div class="line"><span class="lineno"> 3701</span>                tol = tolEq;</div>
<div class="line"><span class="lineno"> 3702</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3703</span>                <span class="keywordflow">if</span> (j &lt; 2) {</div>
<div class="line"><span class="lineno"> 3704</span>                    tol = tolMixed;</div>
<div class="line"><span class="lineno"> 3705</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 3706</span>                    tol = tolLn;</div>
<div class="line"><span class="lineno"> 3707</span>                }</div>
<div class="line"><span class="lineno"> 3708</span>            }</div>
<div class="line"><span class="lineno"> 3709</span>            <span class="keywordflow">if</span> (std::fabs(covariance(v_eu[i][j]) - v_an[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 3710</span>                BOOST_ERROR(<span class="stringliteral">&quot;analytical covariance at (&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;) (&quot;</span> &lt;&lt; v_an[i][j]</div>
<div class="line"><span class="lineno"> 3711</span>                                                         &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical &quot;</span></div>
<div class="line"><span class="lineno"> 3712</span>                                                            <span class="stringliteral">&quot;value (Euler discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 3713</span>                                                         &lt;&lt; covariance(v_eu[i][j]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 3714</span>                                                         &lt;&lt; v_an[i][j] - covariance(v_eu[i][j]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 3715</span>                                                         &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 3716</span>            }</div>
<div class="line"><span class="lineno"> 3717</span>            <span class="keywordflow">if</span> (std::fabs(covariance(v_eu2[i][j]) - v_an[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 3718</span>                BOOST_ERROR(<span class="stringliteral">&quot;analytical covariance at (&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;) (&quot;</span> &lt;&lt; v_an[i][j]</div>
<div class="line"><span class="lineno"> 3719</span>                                                         &lt;&lt; <span class="stringliteral">&quot;) is inconsistent with numerical &quot;</span></div>
<div class="line"><span class="lineno"> 3720</span>                                                            <span class="stringliteral">&quot;value (Exact discretization, &quot;</span></div>
<div class="line"><span class="lineno"> 3721</span>                                                         &lt;&lt; covariance(v_eu2[i][j]) &lt;&lt; <span class="stringliteral">&quot;), error is &quot;</span></div>
<div class="line"><span class="lineno"> 3722</span>                                                         &lt;&lt; v_an[i][j] - covariance(v_eu2[i][j]) &lt;&lt; <span class="stringliteral">&quot; tolerance is &quot;</span></div>
<div class="line"><span class="lineno"> 3723</span>                                                         &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 3724</span>            }</div>
<div class="line"><span class="lineno"> 3725</span>        }</div>
<div class="line"><span class="lineno"> 3726</span>    }</div>
<div class="line"><span class="lineno"> 3727</span> </div>
<div class="line"><span class="lineno"> 3728</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing correlation matrix recovery in presence of equity simulation&quot;</span>);</div>
<div class="line"><span class="lineno"> 3729</span>    Matrix corr_input = d.ccLgmExact-&gt;correlation();</div>
<div class="line"><span class="lineno"> 3730</span>    BOOST_CHECK(corr_input.rows() == corr_input.columns());</div>
<div class="line"><span class="lineno"> 3731</span>    Size dim = corr_input.rows();</div>
<div class="line"><span class="lineno"> 3732</span>    BOOST_CHECK(corr_input.rows() == 5);</div>
<div class="line"><span class="lineno"> 3733</span>    Matrix r1(dim, dim), r2(dim, dim);</div>
<div class="line"><span class="lineno"> 3734</span>    Real dt = 1.0E-6;</div>
<div class="line"><span class="lineno"> 3735</span>    Real tol_corr = 1.0E-7;</div>
<div class="line"><span class="lineno"> 3736</span>    Matrix v_an_dt = p_exact-&gt;covariance(0.0, p_exact-&gt;initialValues(), dt);</div>
<div class="line"><span class="lineno"> 3737</span>    Matrix v_an_eu_dt = p_euler-&gt;covariance(0.0, p_euler-&gt;initialValues(), dt);</div>
<div class="line"><span class="lineno"> 3738</span>    BOOST_CHECK(v_an_dt.rows() == v_an_eu_dt.rows());</div>
<div class="line"><span class="lineno"> 3739</span>    BOOST_CHECK(v_an_dt.columns() == v_an_eu_dt.columns());</div>
<div class="line"><span class="lineno"> 3740</span>    BOOST_CHECK(corr_input.rows() == v_an_dt.rows());</div>
<div class="line"><span class="lineno"> 3741</span>    BOOST_CHECK(corr_input.columns() == corr_input.columns());</div>
<div class="line"><span class="lineno"> 3742</span> </div>
<div class="line"><span class="lineno"> 3743</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 3744</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 3745</span>            r1[i][j] = r1[j][i] = v_an_dt[i][j] / std::sqrt(v_an_dt[i][i] * v_an_dt[j][j]);</div>
<div class="line"><span class="lineno"> 3746</span>            r2[i][j] = r2[j][i] = v_an_eu_dt[i][j] / std::sqrt(v_an_eu_dt[i][i] * v_an_eu_dt[j][j]);</div>
<div class="line"><span class="lineno"> 3747</span>            BOOST_CHECK_MESSAGE(std::fabs(r1[i][j] - corr_input[i][j]) &lt; tol_corr,</div>
<div class="line"><span class="lineno"> 3748</span>                                <span class="stringliteral">&quot;failed to recover correlation matrix from &quot;</span></div>
<div class="line"><span class="lineno"> 3749</span>                                <span class="stringliteral">&quot;exact state process (i,j)=(&quot;</span></div>
<div class="line"><span class="lineno"> 3750</span>                                    &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;), input correlation is &quot;</span> &lt;&lt; corr_input[i][j] &lt;&lt; <span class="stringliteral">&quot;, output is &quot;</span></div>
<div class="line"><span class="lineno"> 3751</span>                                    &lt;&lt; r1[i][j] &lt;&lt; <span class="stringliteral">&quot;, difference &quot;</span> &lt;&lt; (corr_input[i][j] - r1[i][j]) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span></div>
<div class="line"><span class="lineno"> 3752</span>                                    &lt;&lt; tol_corr);</div>
<div class="line"><span class="lineno"> 3753</span>            BOOST_CHECK_MESSAGE(std::fabs(r2[i][j] - corr_input[i][j]) &lt; tol_corr,</div>
<div class="line"><span class="lineno"> 3754</span>                                <span class="stringliteral">&quot;failed to recover correlation matrix from &quot;</span></div>
<div class="line"><span class="lineno"> 3755</span>                                <span class="stringliteral">&quot;Euler state process (i,j)=(&quot;</span></div>
<div class="line"><span class="lineno"> 3756</span>                                    &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;), input correlation is &quot;</span> &lt;&lt; corr_input[i][j] &lt;&lt; <span class="stringliteral">&quot;, output is &quot;</span></div>
<div class="line"><span class="lineno"> 3757</span>                                    &lt;&lt; r2[i][j] &lt;&lt; <span class="stringliteral">&quot;, difference &quot;</span> &lt;&lt; (corr_input[i][j] - r2[i][j]) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span></div>
<div class="line"><span class="lineno"> 3758</span>                                    &lt;&lt; tol_corr);</div>
<div class="line"><span class="lineno"> 3759</span>        }</div>
<div class="line"><span class="lineno"> 3760</span>    }</div>
<div class="line"><span class="lineno"> 3761</span> </div>
<div class="line"><span class="lineno"> 3762</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; 5; ++i) {</div>
<div class="line"><span class="lineno"> 3763</span>        Real meu = mean(e_eu[i]);</div>
<div class="line"><span class="lineno"> 3764</span>        Real s_meu = error_of&lt;tag::mean&gt;(e_eu[i]);</div>
<div class="line"><span class="lineno"> 3765</span>        BOOST_TEST_MESSAGE(i &lt;&lt; <span class="stringliteral">&quot;;EULER;&quot;</span> &lt;&lt; e_an[i] &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; meu &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; s_meu);</div>
<div class="line"><span class="lineno"> 3766</span>        Real meu2 = mean(e_eu2[i]);</div>
<div class="line"><span class="lineno"> 3767</span>        Real s_meu2 = error_of&lt;tag::mean&gt;(e_eu2[i]);</div>
<div class="line"><span class="lineno"> 3768</span>        BOOST_TEST_MESSAGE(i &lt;&lt; <span class="stringliteral">&quot;;EXACT;&quot;</span> &lt;&lt; e_an[i] &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; meu2 &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; s_meu2);</div>
<div class="line"><span class="lineno"> 3769</span>    }</div>
<div class="line"><span class="lineno"> 3770</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; 5; ++i) {</div>
<div class="line"><span class="lineno"> 3771</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 3772</span>            Real cov = covariance(v_eu[i][j]);</div>
<div class="line"><span class="lineno"> 3773</span>            BOOST_TEST_MESSAGE(i &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;;&quot;</span></div>
<div class="line"><span class="lineno"> 3774</span>                                 &lt;&lt; <span class="stringliteral">&quot;EULER;&quot;</span> &lt;&lt; v_an[i][j] &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; cov);</div>
<div class="line"><span class="lineno"> 3775</span>            Real cov2 = covariance(v_eu2[i][j]);</div>
<div class="line"><span class="lineno"> 3776</span>            BOOST_TEST_MESSAGE(i &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;;&quot;</span></div>
<div class="line"><span class="lineno"> 3777</span>                                 &lt;&lt; <span class="stringliteral">&quot;EXACT;&quot;</span> &lt;&lt; v_an[i][j] &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; cov2);</div>
<div class="line"><span class="lineno"> 3778</span>        }</div>
<div class="line"><span class="lineno"> 3779</span>    }</div>
<div class="line"><span class="lineno"> 3780</span>} <span class="comment">// testEqLgm5fMoments</span></div>
</div><!-- fragment --><div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><img src="test_2crossassetmodel_8cpp_a230062c157e987f941fead5bf5501c45_cgraph.png" border="0" usemap="#atest_2crossassetmodel_8cpp_a230062c157e987f941fead5bf5501c45_cgraph" alt=""/></div>
<map name="atest_2crossassetmodel_8cpp_a230062c157e987f941fead5bf5501c45_cgraph" id="atest_2crossassetmodel_8cpp_a230062c157e987f941fead5bf5501c45_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,196,38"/>
<area shape="rect" href="class_quant_ext_1_1_multi_path_generator_sobol_brownian_bridge.html#ad8f5a33568da4f97b76944e9621547e2" title=" " alt="" coords="244,5,441,45"/>
</map>
</div>

</div>
</div>
<a id="a8ff435d86fb0d97d317f68db7db2057a" name="a8ff435d86fb0d97d317f68db7db2057a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ff435d86fb0d97d317f68db7db2057a">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[19/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCorrelationRecovery&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l03782">3782</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3782</span>                                              {</div>
<div class="line"><span class="lineno"> 3783</span> </div>
<div class="line"><span class="lineno"> 3784</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Test if random correlation input is recovered for &quot;</span></div>
<div class="line"><span class="lineno"> 3785</span>                       <span class="stringliteral">&quot;small dt in Ccy LGM model...&quot;</span>);</div>
<div class="line"><span class="lineno"> 3786</span> </div>
<div class="line"><span class="lineno"> 3787</span>    <span class="keyword">class </span>PseudoCurrency : <span class="keyword">public</span> Currency {</div>
<div class="line"><span class="lineno"> 3788</span>    <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno"> 3789</span>        PseudoCurrency(<span class="keyword">const</span> Size <span class="keywordtype">id</span>) {</div>
<div class="line"><span class="lineno"> 3790</span>            std::ostringstream ln, sn;</div>
<div class="line"><span class="lineno"> 3791</span>            ln &lt;&lt; <span class="stringliteral">&quot;Dummy &quot;</span> &lt;&lt; id;</div>
<div class="line"><span class="lineno"> 3792</span>            sn &lt;&lt; <span class="stringliteral">&quot;DUM &quot;</span> &lt;&lt; id;</div>
<div class="line"><span class="lineno"> 3793</span>            data_ = boost::make_shared&lt;Data&gt;(ln.str(), sn.str(), <span class="keywordtype">id</span>, sn.str(), <span class="stringliteral">&quot;&quot;</span>, 100, Rounding(), <span class="stringliteral">&quot;%3% %1$.2f&quot;</span>);</div>
<div class="line"><span class="lineno"> 3794</span>        }</div>
<div class="line"><span class="lineno"> 3795</span>    };</div>
<div class="line"><span class="lineno"> 3796</span> </div>
<div class="line"><span class="lineno"> 3797</span>    Real dt = 1.0E-6;</div>
<div class="line"><span class="lineno"> 3798</span>    Real tol = 1.0E-7;</div>
<div class="line"><span class="lineno"> 3799</span> </div>
<div class="line"><span class="lineno"> 3800</span>    <span class="comment">// for ir-fx this fully specifies the correlation matrix</span></div>
<div class="line"><span class="lineno"> 3801</span>    <span class="comment">// for new asset classes add other possible combinations as well</span></div>
<div class="line"><span class="lineno"> 3802</span>    Size currencies[] = { 1, 2, 3, 4, 5, 10, 20, 50, 100 };</div>
<div class="line"><span class="lineno"> 3803</span> </div>
<div class="line"><span class="lineno"> 3804</span>    MersenneTwisterUniformRng mt(42);</div>
<div class="line"><span class="lineno"> 3805</span> </div>
<div class="line"><span class="lineno"> 3806</span>    Handle&lt;YieldTermStructure&gt; yts(boost::make_shared&lt;FlatForward&gt;(0, NullCalendar(), 0.01, Actual365Fixed()));</div>
<div class="line"><span class="lineno"> 3807</span> </div>
<div class="line"><span class="lineno"> 3808</span>    Handle&lt;Quote&gt; fxspot(boost::make_shared&lt;SimpleQuote&gt;(1.00));</div>
<div class="line"><span class="lineno"> 3809</span> </div>
<div class="line"><span class="lineno"> 3810</span>    Array notimes(0);</div>
<div class="line"><span class="lineno"> 3811</span>    Array fxsigma(1, 0.10);</div>
<div class="line"><span class="lineno"> 3812</span> </div>
<div class="line"><span class="lineno"> 3813</span>    <span class="keywordflow">for</span> (Size ii = 0; ii &lt; <a class="code hl_define" href="utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(currencies); ++ii) {</div>
<div class="line"><span class="lineno"> 3814</span> </div>
<div class="line"><span class="lineno"> 3815</span>        std::vector&lt;Currency&gt; pseudoCcy;</div>
<div class="line"><span class="lineno"> 3816</span>        <span class="keywordflow">for</span> (Size i = 0; i &lt; currencies[ii]; ++i) {</div>
<div class="line"><span class="lineno"> 3817</span>            PseudoCurrency tmp(i);</div>
<div class="line"><span class="lineno"> 3818</span>            pseudoCcy.push_back(tmp);</div>
<div class="line"><span class="lineno"> 3819</span>        }</div>
<div class="line"><span class="lineno"> 3820</span> </div>
<div class="line"><span class="lineno"> 3821</span>        Size dim = 2 * currencies[ii] - 1;</div>
<div class="line"><span class="lineno"> 3822</span> </div>
<div class="line"><span class="lineno"> 3823</span>        <span class="comment">// generate random correlation matrix</span></div>
<div class="line"><span class="lineno"> 3824</span>        Matrix b(dim, dim);</div>
<div class="line"><span class="lineno"> 3825</span>        Size maxTries = 100;</div>
<div class="line"><span class="lineno"> 3826</span>        <span class="keywordtype">bool</span> valid = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 3827</span>        <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno"> 3828</span>            Matrix a(dim, dim);</div>
<div class="line"><span class="lineno"> 3829</span>            <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 3830</span>                <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 3831</span>                    a[i][j] = a[j][i] = mt.nextReal() - 0.5;</div>
<div class="line"><span class="lineno"> 3832</span>                }</div>
<div class="line"><span class="lineno"> 3833</span>            }</div>
<div class="line"><span class="lineno"> 3834</span>            b = a * transpose(a);</div>
<div class="line"><span class="lineno"> 3835</span>            <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 3836</span>                <span class="keywordflow">if</span> (b[i][i] &lt; 1E-5)</div>
<div class="line"><span class="lineno"> 3837</span>                    valid = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 3838</span>            }</div>
<div class="line"><span class="lineno"> 3839</span>        } <span class="keywordflow">while</span> (!valid &amp;&amp; --maxTries &gt; 0);</div>
<div class="line"><span class="lineno"> 3840</span> </div>
<div class="line"><span class="lineno"> 3841</span>        <span class="keywordflow">if</span> (maxTries == 0) {</div>
<div class="line"><span class="lineno"> 3842</span>            BOOST_ERROR(<span class="stringliteral">&quot;could no generate random matrix&quot;</span>);</div>
<div class="line"><span class="lineno"> 3843</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 3844</span>        }</div>
<div class="line"><span class="lineno"> 3845</span> </div>
<div class="line"><span class="lineno"> 3846</span>        Matrix c(dim, dim);</div>
<div class="line"><span class="lineno"> 3847</span>        <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 3848</span>            <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 3849</span>                c[i][j] = c[j][i] = b[i][j] / std::sqrt(b[i][i] * b[j][j]);</div>
<div class="line"><span class="lineno"> 3850</span>            }</div>
<div class="line"><span class="lineno"> 3851</span>        }</div>
<div class="line"><span class="lineno"> 3852</span> </div>
<div class="line"><span class="lineno"> 3853</span>        <span class="comment">// set up model</span></div>
<div class="line"><span class="lineno"> 3854</span> </div>
<div class="line"><span class="lineno"> 3855</span>        std::vector&lt;boost::shared_ptr&lt;Parametrization&gt; &gt; parametrizations;</div>
<div class="line"><span class="lineno"> 3856</span> </div>
<div class="line"><span class="lineno"> 3857</span>        <span class="comment">// IR</span></div>
<div class="line"><span class="lineno"> 3858</span>        <span class="keywordflow">for</span> (Size i = 0; i &lt; currencies[ii]; ++i) {</div>
<div class="line"><span class="lineno"> 3859</span>            parametrizations.push_back(</div>
<div class="line"><span class="lineno"> 3860</span>                boost::make_shared&lt;IrLgm1fConstantParametrization&gt;(pseudoCcy[i], yts, 0.01, 0.01));</div>
<div class="line"><span class="lineno"> 3861</span>        }</div>
<div class="line"><span class="lineno"> 3862</span>        <span class="comment">// FX</span></div>
<div class="line"><span class="lineno"> 3863</span>        <span class="keywordflow">for</span> (Size i = 0; i &lt; currencies[ii] - 1; ++i) {</div>
<div class="line"><span class="lineno"> 3864</span>            parametrizations.push_back(</div>
<div class="line"><span class="lineno"> 3865</span>                boost::make_shared&lt;FxBsPiecewiseConstantParametrization&gt;(pseudoCcy[i + 1], fxspot, notimes, fxsigma));</div>
<div class="line"><span class="lineno"> 3866</span>        }</div>
<div class="line"><span class="lineno"> 3867</span> </div>
<div class="line"><span class="lineno"> 3868</span>        boost::shared_ptr&lt;CrossAssetModel&gt; modelExact =</div>
<div class="line"><span class="lineno"> 3869</span>            boost::make_shared&lt;CrossAssetModel&gt;(parametrizations, c, SalvagingAlgorithm::None, IrModel::Measure::LGM,</div>
<div class="line"><span class="lineno"> 3870</span>                                                CrossAssetModel::Discretization::Exact);</div>
<div class="line"><span class="lineno"> 3871</span>        boost::shared_ptr&lt;CrossAssetModel&gt; modelEuler =</div>
<div class="line"><span class="lineno"> 3872</span>            boost::make_shared&lt;CrossAssetModel&gt;(parametrizations, c, SalvagingAlgorithm::None, IrModel::Measure::LGM,</div>
<div class="line"><span class="lineno"> 3873</span>                                                CrossAssetModel::Discretization::Euler);</div>
<div class="line"><span class="lineno"> 3874</span> </div>
<div class="line"><span class="lineno"> 3875</span>        boost::shared_ptr&lt;StochasticProcess&gt; peuler = modelExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 3876</span>        boost::shared_ptr&lt;StochasticProcess&gt; pexact = modelEuler-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 3877</span> </div>
<div class="line"><span class="lineno"> 3878</span>        Matrix c1 = peuler-&gt;covariance(dt, peuler-&gt;initialValues(), dt);</div>
<div class="line"><span class="lineno"> 3879</span>        Matrix c2 = pexact-&gt;covariance(0.0, peuler-&gt;initialValues(), dt);</div>
<div class="line"><span class="lineno"> 3880</span> </div>
<div class="line"><span class="lineno"> 3881</span>        Matrix r1(dim, dim), r2(dim, dim);</div>
<div class="line"><span class="lineno"> 3882</span> </div>
<div class="line"><span class="lineno"> 3883</span>        <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 3884</span>            <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 3885</span>                r1[i][j] = r1[j][i] = c1[i][j] / std::sqrt(c1[i][i] * c1[j][j]);</div>
<div class="line"><span class="lineno"> 3886</span>                r2[i][j] = r2[j][i] = c2[i][j] / std::sqrt(c2[i][i] * c2[j][j]);</div>
<div class="line"><span class="lineno"> 3887</span>                <span class="keywordflow">if</span> (std::fabs(r1[i][j] - c[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 3888</span>                    BOOST_ERROR(<span class="stringliteral">&quot;failed to recover correlation matrix from &quot;</span></div>
<div class="line"><span class="lineno"> 3889</span>                                <span class="stringliteral">&quot;Euler state process (i,j)=(&quot;</span></div>
<div class="line"><span class="lineno"> 3890</span>                                &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;), input correlation is &quot;</span> &lt;&lt; c[i][j] &lt;&lt; <span class="stringliteral">&quot;, output is &quot;</span> &lt;&lt; r1[i][j]</div>
<div class="line"><span class="lineno"> 3891</span>                                &lt;&lt; <span class="stringliteral">&quot;, difference &quot;</span> &lt;&lt; (c[i][j] - r1[i][j]) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 3892</span>                }</div>
<div class="line"><span class="lineno"> 3893</span>                <span class="keywordflow">if</span> (std::fabs(r2[i][j] - c[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 3894</span>                    BOOST_ERROR(<span class="stringliteral">&quot;failed to recover correlation matrix from &quot;</span></div>
<div class="line"><span class="lineno"> 3895</span>                                <span class="stringliteral">&quot;exact state process (i,j)=(&quot;</span></div>
<div class="line"><span class="lineno"> 3896</span>                                &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;), input correlation is &quot;</span> &lt;&lt; c[i][j] &lt;&lt; <span class="stringliteral">&quot;, output is &quot;</span> &lt;&lt; r2[i][j]</div>
<div class="line"><span class="lineno"> 3897</span>                                &lt;&lt; <span class="stringliteral">&quot;, difference &quot;</span> &lt;&lt; (c[i][j] - r2[i][j]) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 3898</span>                }</div>
<div class="line"><span class="lineno"> 3899</span>            }</div>
<div class="line"><span class="lineno"> 3900</span>        }</div>
<div class="line"><span class="lineno"> 3901</span> </div>
<div class="line"><span class="lineno"> 3902</span>    } <span class="comment">// for currencies</span></div>
<div class="line"><span class="lineno"> 3903</span> </div>
<div class="line"><span class="lineno"> 3904</span>} <span class="comment">// test correlation recovery</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a132847111b22b5a9cc8124b290fc9d1d" name="a132847111b22b5a9cc8124b290fc9d1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a132847111b22b5a9cc8124b290fc9d1d">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[20/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testIrFxInfCrCorrelationRecovery&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l03906">3906</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 3906</span>                                                       {</div>
<div class="line"><span class="lineno"> 3907</span> </div>
<div class="line"><span class="lineno"> 3908</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Test if random correlation input is recovered for &quot;</span></div>
<div class="line"><span class="lineno"> 3909</span>                       <span class="stringliteral">&quot;small dt in ir-fx-inf-cr model...&quot;</span>);</div>
<div class="line"><span class="lineno"> 3910</span> </div>
<div class="line"><span class="lineno"> 3911</span>    SavedSettings backup;</div>
<div class="line"><span class="lineno"> 3912</span>    Settings::instance().evaluationDate() = Date(30, July, 2015);</div>
<div class="line"><span class="lineno"> 3913</span> </div>
<div class="line"><span class="lineno"> 3914</span>    <span class="keyword">class </span>PseudoCurrency : <span class="keyword">public</span> Currency {</div>
<div class="line"><span class="lineno"> 3915</span>    <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno"> 3916</span>        PseudoCurrency(<span class="keyword">const</span> Size <span class="keywordtype">id</span>) {</div>
<div class="line"><span class="lineno"> 3917</span>            std::ostringstream ln, sn;</div>
<div class="line"><span class="lineno"> 3918</span>            ln &lt;&lt; <span class="stringliteral">&quot;Dummy &quot;</span> &lt;&lt; id;</div>
<div class="line"><span class="lineno"> 3919</span>            sn &lt;&lt; <span class="stringliteral">&quot;DUM &quot;</span> &lt;&lt; id;</div>
<div class="line"><span class="lineno"> 3920</span>            data_ = boost::make_shared&lt;Data&gt;(ln.str(), sn.str(), <span class="keywordtype">id</span>, sn.str(), <span class="stringliteral">&quot;&quot;</span>, 100, Rounding(), <span class="stringliteral">&quot;%3% %1$.2f&quot;</span>);</div>
<div class="line"><span class="lineno"> 3921</span>        }</div>
<div class="line"><span class="lineno"> 3922</span>    };</div>
<div class="line"><span class="lineno"> 3923</span> </div>
<div class="line"><span class="lineno"> 3924</span>    Real dt = 1.0E-6;</div>
<div class="line"><span class="lineno"> 3925</span>    Real tol = 1.0E-7;</div>
<div class="line"><span class="lineno"> 3926</span> </div>
<div class="line"><span class="lineno"> 3927</span>    <span class="comment">// for ir-fx this fully specifies the correlation matrix</span></div>
<div class="line"><span class="lineno"> 3928</span>    <span class="comment">// for new asset classes add other possible combinations as well</span></div>
<div class="line"><span class="lineno"> 3929</span>    Size currencies[] = { 1, 2, 3, 4, 5, 10, 20 };</div>
<div class="line"><span class="lineno"> 3930</span>    Size cpiindexes[] = { 0, 1, 10 };</div>
<div class="line"><span class="lineno"> 3931</span>    Size creditnames[] = { 0, 1, 5 };</div>
<div class="line"><span class="lineno"> 3932</span> </div>
<div class="line"><span class="lineno"> 3933</span>    MersenneTwisterUniformRng mt(42);</div>
<div class="line"><span class="lineno"> 3934</span> </div>
<div class="line"><span class="lineno"> 3935</span>    Handle&lt;YieldTermStructure&gt; yts(boost::make_shared&lt;FlatForward&gt;(0, NullCalendar(), 0.01, Actual365Fixed()));</div>
<div class="line"><span class="lineno"> 3936</span> </div>
<div class="line"><span class="lineno"> 3937</span>    std::vector&lt;Date&gt; infDates;</div>
<div class="line"><span class="lineno"> 3938</span>    std::vector&lt;Real&gt; infRates;</div>
<div class="line"><span class="lineno"> 3939</span>    infDates.push_back(Date(30, April, 2015));</div>
<div class="line"><span class="lineno"> 3940</span>    infDates.push_back(Date(30, July, 2015));</div>
<div class="line"><span class="lineno"> 3941</span>    infRates.push_back(0.01);</div>
<div class="line"><span class="lineno"> 3942</span>    infRates.push_back(0.01);</div>
<div class="line"><span class="lineno"> 3943</span>    Handle&lt;ZeroInflationTermStructure&gt; its(</div>
<div class="line"><span class="lineno"> 3944</span>        boost::make_shared&lt;ZeroInflationCurve&gt;(Settings::instance().evaluationDate(), NullCalendar(), Actual365Fixed(),</div>
<div class="line"><span class="lineno"> 3945</span>                                               3 * Months, Monthly, infDates, infRates));</div>
<div class="line"><span class="lineno"> 3946</span> </div>
<div class="line"><span class="lineno"> 3947</span>    Handle&lt;DefaultProbabilityTermStructure&gt; hts(</div>
<div class="line"><span class="lineno"> 3948</span>        boost::make_shared&lt;FlatHazardRate&gt;(0, NullCalendar(), 0.01, Actual365Fixed()));</div>
<div class="line"><span class="lineno"> 3949</span> </div>
<div class="line"><span class="lineno"> 3950</span>    Handle&lt;Quote&gt; fxspot(boost::make_shared&lt;SimpleQuote&gt;(1.00));</div>
<div class="line"><span class="lineno"> 3951</span> </div>
<div class="line"><span class="lineno"> 3952</span>    Array notimes(0);</div>
<div class="line"><span class="lineno"> 3953</span>    Array fxsigma(1, 0.10);</div>
<div class="line"><span class="lineno"> 3954</span> </div>
<div class="line"><span class="lineno"> 3955</span>    <span class="keywordflow">for</span> (Size ii = 0; ii &lt; <a class="code hl_define" href="utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(currencies); ++ii) {</div>
<div class="line"><span class="lineno"> 3956</span>        <span class="keywordflow">for</span> (Size kk = 0; kk &lt; <a class="code hl_define" href="utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(cpiindexes); ++kk) {</div>
<div class="line"><span class="lineno"> 3957</span>            <span class="keywordflow">for</span> (Size jj = 0; jj &lt; <a class="code hl_define" href="utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(creditnames); ++jj) {</div>
<div class="line"><span class="lineno"> 3958</span> </div>
<div class="line"><span class="lineno"> 3959</span>                std::vector&lt;Currency&gt; pseudoCcy;</div>
<div class="line"><span class="lineno"> 3960</span>                <span class="keywordflow">for</span> (Size i = 0; i &lt; currencies[ii]; ++i) {</div>
<div class="line"><span class="lineno"> 3961</span>                    PseudoCurrency tmp(i);</div>
<div class="line"><span class="lineno"> 3962</span>                    pseudoCcy.push_back(tmp);</div>
<div class="line"><span class="lineno"> 3963</span>                }</div>
<div class="line"><span class="lineno"> 3964</span> </div>
<div class="line"><span class="lineno"> 3965</span>                Size dim = 2 * currencies[ii] - 1 + cpiindexes[kk] + creditnames[jj];</div>
<div class="line"><span class="lineno"> 3966</span> </div>
<div class="line"><span class="lineno"> 3967</span>                <span class="comment">// generate random correlation matrix</span></div>
<div class="line"><span class="lineno"> 3968</span>                Matrix b(dim, dim);</div>
<div class="line"><span class="lineno"> 3969</span>                Size maxTries = 100;</div>
<div class="line"><span class="lineno"> 3970</span>                <span class="keywordtype">bool</span> valid = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 3971</span>                <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno"> 3972</span>                    Matrix a(dim, dim);</div>
<div class="line"><span class="lineno"> 3973</span>                    <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 3974</span>                        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 3975</span>                            a[i][j] = a[j][i] = mt.nextReal() - 0.5;</div>
<div class="line"><span class="lineno"> 3976</span>                        }</div>
<div class="line"><span class="lineno"> 3977</span>                    }</div>
<div class="line"><span class="lineno"> 3978</span>                    b = a * transpose(a);</div>
<div class="line"><span class="lineno"> 3979</span>                    <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 3980</span>                        <span class="keywordflow">if</span> (b[i][i] &lt; 1E-5)</div>
<div class="line"><span class="lineno"> 3981</span>                            valid = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 3982</span>                    }</div>
<div class="line"><span class="lineno"> 3983</span>                } <span class="keywordflow">while</span> (!valid &amp;&amp; --maxTries &gt; 0);</div>
<div class="line"><span class="lineno"> 3984</span> </div>
<div class="line"><span class="lineno"> 3985</span>                <span class="keywordflow">if</span> (maxTries == 0) {</div>
<div class="line"><span class="lineno"> 3986</span>                    BOOST_ERROR(<span class="stringliteral">&quot;could no generate random matrix&quot;</span>);</div>
<div class="line"><span class="lineno"> 3987</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 3988</span>                }</div>
<div class="line"><span class="lineno"> 3989</span> </div>
<div class="line"><span class="lineno"> 3990</span>                Matrix c(dim, dim);</div>
<div class="line"><span class="lineno"> 3991</span>                <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 3992</span>                    <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 3993</span>                        c[i][j] = c[j][i] = b[i][j] / std::sqrt(b[i][i] * b[j][j]);</div>
<div class="line"><span class="lineno"> 3994</span>                    }</div>
<div class="line"><span class="lineno"> 3995</span>                }</div>
<div class="line"><span class="lineno"> 3996</span> </div>
<div class="line"><span class="lineno"> 3997</span>                <span class="comment">// set up model</span></div>
<div class="line"><span class="lineno"> 3998</span> </div>
<div class="line"><span class="lineno"> 3999</span>                std::vector&lt;boost::shared_ptr&lt;Parametrization&gt; &gt; parametrizations;</div>
<div class="line"><span class="lineno"> 4000</span> </div>
<div class="line"><span class="lineno"> 4001</span>                <span class="comment">// IR</span></div>
<div class="line"><span class="lineno"> 4002</span>                <span class="keywordflow">for</span> (Size i = 0; i &lt; currencies[ii]; ++i) {</div>
<div class="line"><span class="lineno"> 4003</span>                    parametrizations.push_back(</div>
<div class="line"><span class="lineno"> 4004</span>                        boost::make_shared&lt;IrLgm1fConstantParametrization&gt;(pseudoCcy[i], yts, 0.01, 0.01));</div>
<div class="line"><span class="lineno"> 4005</span>                }</div>
<div class="line"><span class="lineno"> 4006</span>                <span class="comment">// FX</span></div>
<div class="line"><span class="lineno"> 4007</span>                <span class="keywordflow">for</span> (Size i = 0; i &lt; currencies[ii] - 1; ++i) {</div>
<div class="line"><span class="lineno"> 4008</span>                    parametrizations.push_back(boost::make_shared&lt;FxBsPiecewiseConstantParametrization&gt;(</div>
<div class="line"><span class="lineno"> 4009</span>                        pseudoCcy[i + 1], fxspot, notimes, fxsigma));</div>
<div class="line"><span class="lineno"> 4010</span>                }</div>
<div class="line"><span class="lineno"> 4011</span>                <span class="comment">// INF</span></div>
<div class="line"><span class="lineno"> 4012</span>                <span class="keywordflow">for</span> (Size i = 0; i &lt; cpiindexes[kk]; ++i) {</div>
<div class="line"><span class="lineno"> 4013</span>                    parametrizations.push_back(</div>
<div class="line"><span class="lineno"> 4014</span>                        boost::make_shared&lt;InfDkConstantParametrization&gt;(pseudoCcy[0], its, 0.01, 0.01));</div>
<div class="line"><span class="lineno"> 4015</span>                }</div>
<div class="line"><span class="lineno"> 4016</span>                <span class="comment">// CR</span></div>
<div class="line"><span class="lineno"> 4017</span>                <span class="keywordflow">for</span> (Size i = 0; i &lt; creditnames[jj]; ++i) {</div>
<div class="line"><span class="lineno"> 4018</span>                    parametrizations.push_back(</div>
<div class="line"><span class="lineno"> 4019</span>                        boost::make_shared&lt;CrLgm1fConstantParametrization&gt;(pseudoCcy[0], hts, 0.01, 0.01));</div>
<div class="line"><span class="lineno"> 4020</span>                }</div>
<div class="line"><span class="lineno"> 4021</span> </div>
<div class="line"><span class="lineno"> 4022</span>                <span class="comment">// get QuantLib::Error: negative eigenvalue(s) (-3.649315e-16) with SalvagingAlgorithm::None</span></div>
<div class="line"><span class="lineno"> 4023</span>                boost::shared_ptr&lt;CrossAssetModel&gt; modelEuler =</div>
<div class="line"><span class="lineno"> 4024</span>                    boost::make_shared&lt;CrossAssetModel&gt;(parametrizations, c, SalvagingAlgorithm::Spectral,</div>
<div class="line"><span class="lineno"> 4025</span>                                                        IrModel::Measure::LGM, CrossAssetModel::Discretization::Euler);</div>
<div class="line"><span class="lineno"> 4026</span>                boost::shared_ptr&lt;CrossAssetModel&gt; modelExact =</div>
<div class="line"><span class="lineno"> 4027</span>                    boost::make_shared&lt;CrossAssetModel&gt;(parametrizations, c, SalvagingAlgorithm::Spectral,</div>
<div class="line"><span class="lineno"> 4028</span>                                                        IrModel::Measure::LGM, CrossAssetModel::Discretization::Exact);</div>
<div class="line"><span class="lineno"> 4029</span> </div>
<div class="line"><span class="lineno"> 4030</span>                boost::shared_ptr&lt;StochasticProcess&gt; peuler = modelEuler-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 4031</span>                boost::shared_ptr&lt;StochasticProcess&gt; pexact = modelExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 4032</span> </div>
<div class="line"><span class="lineno"> 4033</span>                Matrix c1 = peuler-&gt;covariance(dt, peuler-&gt;initialValues(), dt);</div>
<div class="line"><span class="lineno"> 4034</span>                Matrix c2 = pexact-&gt;covariance(0.0, peuler-&gt;initialValues(), dt);</div>
<div class="line"><span class="lineno"> 4035</span> </div>
<div class="line"><span class="lineno"> 4036</span>                Matrix r1(dim, dim), r2(dim, dim);</div>
<div class="line"><span class="lineno"> 4037</span> </div>
<div class="line"><span class="lineno"> 4038</span>                <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 4039</span>                    <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 4040</span>                        <span class="comment">// there are two state variables per credit name,</span></div>
<div class="line"><span class="lineno"> 4041</span>                        <span class="comment">// and per inflation index</span></div>
<div class="line"><span class="lineno"> 4042</span>                        Size subi = i &lt; 2 * currencies[ii] - 1 ? 1 : 2;</div>
<div class="line"><span class="lineno"> 4043</span>                        Size subj = j &lt; 2 * currencies[ii] - 1 ? 1 : 2;</div>
<div class="line"><span class="lineno"> 4044</span>                        <span class="keywordflow">for</span> (Size k1 = 0; k1 &lt; subi; ++k1) {</div>
<div class="line"><span class="lineno"> 4045</span>                            <span class="keywordflow">for</span> (Size k2 = 0; k2 &lt; subj; ++k2) {</div>
<div class="line"><span class="lineno"> 4046</span>                                Size i0 = i &lt; 2 * currencies[ii] - 1</div>
<div class="line"><span class="lineno"> 4047</span>                                              ? i</div>
<div class="line"><span class="lineno"> 4048</span>                                              : 2 * currencies[ii] - 1 + 2 * (i - (2 * currencies[ii] - 1)) + k1;</div>
<div class="line"><span class="lineno"> 4049</span>                                Size j0 = j &lt; 2 * currencies[ii] - 1</div>
<div class="line"><span class="lineno"> 4050</span>                                              ? j</div>
<div class="line"><span class="lineno"> 4051</span>                                              : 2 * currencies[ii] - 1 + 2 * (j - (2 * currencies[ii] - 1)) + k2;</div>
<div class="line"><span class="lineno"> 4052</span>                                r1[i][j] = r1[j][i] = c1[i0][j0] / std::sqrt(c1[i0][i0] * c1[j0][j0]);</div>
<div class="line"><span class="lineno"> 4053</span>                                r2[i][j] = r2[j][i] = c2[i0][j0] / std::sqrt(c2[i0][i0] * c2[j0][j0]);</div>
<div class="line"><span class="lineno"> 4054</span>                                <span class="keywordflow">if</span> (std::fabs(r1[i][j] - c[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 4055</span>                                    BOOST_ERROR(<span class="stringliteral">&quot;failed to recover correlation matrix &quot;</span></div>
<div class="line"><span class="lineno"> 4056</span>                                                <span class="stringliteral">&quot;from &quot;</span></div>
<div class="line"><span class="lineno"> 4057</span>                                                <span class="stringliteral">&quot;Euler state process (i,j)=(&quot;</span></div>
<div class="line"><span class="lineno"> 4058</span>                                                &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;), (i0,j0)=(&quot;</span> &lt;&lt; i0 &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j0</div>
<div class="line"><span class="lineno"> 4059</span>                                                &lt;&lt; <span class="stringliteral">&quot;), input correlation is &quot;</span> &lt;&lt; c[i][j] &lt;&lt; <span class="stringliteral">&quot;, output is &quot;</span> &lt;&lt; r1[i][j]</div>
<div class="line"><span class="lineno"> 4060</span>                                                &lt;&lt; <span class="stringliteral">&quot;, difference &quot;</span> &lt;&lt; (c[i][j] - r1[i][j]) &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol</div>
<div class="line"><span class="lineno"> 4061</span>                                                &lt;&lt; <span class="stringliteral">&quot; test configuration is &quot;</span> &lt;&lt; currencies[ii] &lt;&lt; <span class="stringliteral">&quot; currencies and &quot;</span></div>
<div class="line"><span class="lineno"> 4062</span>                                                &lt;&lt; cpiindexes[kk] &lt;&lt; <span class="stringliteral">&quot; cpi indexes and &quot;</span> &lt;&lt; creditnames[jj]</div>
<div class="line"><span class="lineno"> 4063</span>                                                &lt;&lt; <span class="stringliteral">&quot; credit names&quot;</span>);</div>
<div class="line"><span class="lineno"> 4064</span>                                }</div>
<div class="line"><span class="lineno"> 4065</span>                                <span class="keywordflow">if</span> (k1 == k2) {</div>
<div class="line"><span class="lineno"> 4066</span>                                    <span class="keywordflow">if</span> (std::fabs(r2[i][j] - c[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 4067</span>                                        BOOST_ERROR(<span class="stringliteral">&quot;failed to recover correlation &quot;</span></div>
<div class="line"><span class="lineno"> 4068</span>                                                    <span class="stringliteral">&quot;matrix &quot;</span></div>
<div class="line"><span class="lineno"> 4069</span>                                                    <span class="stringliteral">&quot;from &quot;</span></div>
<div class="line"><span class="lineno"> 4070</span>                                                    <span class="stringliteral">&quot;exact state process (i,j)=(&quot;</span></div>
<div class="line"><span class="lineno"> 4071</span>                                                    &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;), (i0,j0)=(&quot;</span> &lt;&lt; i0 &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j0</div>
<div class="line"><span class="lineno"> 4072</span>                                                    &lt;&lt; <span class="stringliteral">&quot;), input correlation is &quot;</span> &lt;&lt; c[i][j] &lt;&lt; <span class="stringliteral">&quot;, output is &quot;</span></div>
<div class="line"><span class="lineno"> 4073</span>                                                    &lt;&lt; r2[i][j] &lt;&lt; <span class="stringliteral">&quot;, difference &quot;</span> &lt;&lt; (c[i][j] - r2[i][j])</div>
<div class="line"><span class="lineno"> 4074</span>                                                    &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol &lt;&lt; <span class="stringliteral">&quot; test configuration is &quot;</span></div>
<div class="line"><span class="lineno"> 4075</span>                                                    &lt;&lt; currencies[ii] &lt;&lt; <span class="stringliteral">&quot; currencies and &quot;</span> &lt;&lt; cpiindexes[kk]</div>
<div class="line"><span class="lineno"> 4076</span>                                                    &lt;&lt; <span class="stringliteral">&quot; cpi indexes and &quot;</span> &lt;&lt; creditnames[jj] &lt;&lt; <span class="stringliteral">&quot; credit names&quot;</span>);</div>
<div class="line"><span class="lineno"> 4077</span>                                    }</div>
<div class="line"><span class="lineno"> 4078</span>                                }</div>
<div class="line"><span class="lineno"> 4079</span>                            }</div>
<div class="line"><span class="lineno"> 4080</span>                        }</div>
<div class="line"><span class="lineno"> 4081</span>                    }</div>
<div class="line"><span class="lineno"> 4082</span>                }</div>
<div class="line"><span class="lineno"> 4083</span>            } <span class="comment">// for creditnames</span></div>
<div class="line"><span class="lineno"> 4084</span>        }     <span class="comment">// for cpiindexes</span></div>
<div class="line"><span class="lineno"> 4085</span>    }         <span class="comment">// for currencies</span></div>
<div class="line"><span class="lineno"> 4086</span>} <span class="comment">// testIrFxInfCrCorrelationRecovery</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad195f8f6efc789deda39f76a1a4a21e9" name="ad195f8f6efc789deda39f76a1a4a21e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad195f8f6efc789deda39f76a1a4a21e9">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[21/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testIrFxInfCrEqCorrelationRecovery&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l04088">4088</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4088</span>                                                         {</div>
<div class="line"><span class="lineno"> 4089</span> </div>
<div class="line"><span class="lineno"> 4090</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Test if random correlation input is recovered for &quot;</span></div>
<div class="line"><span class="lineno"> 4091</span>                       <span class="stringliteral">&quot;small dt in ir-fx-inf-cr-eq model...&quot;</span>);</div>
<div class="line"><span class="lineno"> 4092</span> </div>
<div class="line"><span class="lineno"> 4093</span>    SavedSettings backup;</div>
<div class="line"><span class="lineno"> 4094</span>    Settings::instance().evaluationDate() = Date(30, July, 2015);</div>
<div class="line"><span class="lineno"> 4095</span> </div>
<div class="line"><span class="lineno"> 4096</span>    <span class="keyword">class </span>PseudoCurrency : <span class="keyword">public</span> Currency {</div>
<div class="line"><span class="lineno"> 4097</span>    <span class="keyword">public</span>:</div>
<div class="line"><span class="lineno"> 4098</span>        PseudoCurrency(<span class="keyword">const</span> Size <span class="keywordtype">id</span>) {</div>
<div class="line"><span class="lineno"> 4099</span>            std::ostringstream ln, sn;</div>
<div class="line"><span class="lineno"> 4100</span>            ln &lt;&lt; <span class="stringliteral">&quot;Dummy &quot;</span> &lt;&lt; id;</div>
<div class="line"><span class="lineno"> 4101</span>            sn &lt;&lt; <span class="stringliteral">&quot;DUM &quot;</span> &lt;&lt; id;</div>
<div class="line"><span class="lineno"> 4102</span>            data_ = boost::make_shared&lt;Data&gt;(ln.str(), sn.str(), <span class="keywordtype">id</span>, sn.str(), <span class="stringliteral">&quot;&quot;</span>, 100, Rounding(), <span class="stringliteral">&quot;%3% %1$.2f&quot;</span>);</div>
<div class="line"><span class="lineno"> 4103</span>        }</div>
<div class="line"><span class="lineno"> 4104</span>    };</div>
<div class="line"><span class="lineno"> 4105</span> </div>
<div class="line"><span class="lineno"> 4106</span>    Real dt = 1.0E-6;</div>
<div class="line"><span class="lineno"> 4107</span>    Real tol = 1.0E-7;</div>
<div class="line"><span class="lineno"> 4108</span> </div>
<div class="line"><span class="lineno"> 4109</span>    <span class="comment">// for ir-fx this fully specifies the correlation matrix</span></div>
<div class="line"><span class="lineno"> 4110</span>    <span class="comment">// for new asset classes add other possible combinations as well</span></div>
<div class="line"><span class="lineno"> 4111</span>    Size currencies[] = { 1, 2, 3, 4, 5, 10, 20 };</div>
<div class="line"><span class="lineno"> 4112</span>    Size cpiindexes[] = { 0, 1, 10 };</div>
<div class="line"><span class="lineno"> 4113</span>    Size creditnames[] = { 0, 1, 5 };</div>
<div class="line"><span class="lineno"> 4114</span>    Size eqs[] = { 0, 1, 5 };</div>
<div class="line"><span class="lineno"> 4115</span> </div>
<div class="line"><span class="lineno"> 4116</span>    MersenneTwisterUniformRng mt(42);</div>
<div class="line"><span class="lineno"> 4117</span> </div>
<div class="line"><span class="lineno"> 4118</span>    Handle&lt;YieldTermStructure&gt; yts(boost::make_shared&lt;FlatForward&gt;(0, NullCalendar(), 0.01, Actual365Fixed()));</div>
<div class="line"><span class="lineno"> 4119</span> </div>
<div class="line"><span class="lineno"> 4120</span>    std::vector&lt;Date&gt; infDates;</div>
<div class="line"><span class="lineno"> 4121</span>    std::vector&lt;Real&gt; infRates;</div>
<div class="line"><span class="lineno"> 4122</span>    infDates.push_back(Date(30, April, 2015));</div>
<div class="line"><span class="lineno"> 4123</span>    infDates.push_back(Date(30, July, 2015));</div>
<div class="line"><span class="lineno"> 4124</span>    infRates.push_back(0.01);</div>
<div class="line"><span class="lineno"> 4125</span>    infRates.push_back(0.01);</div>
<div class="line"><span class="lineno"> 4126</span>    Handle&lt;ZeroInflationTermStructure&gt; its(</div>
<div class="line"><span class="lineno"> 4127</span>        boost::make_shared&lt;ZeroInflationCurve&gt;(Settings::instance().evaluationDate(), NullCalendar(), Actual365Fixed(),</div>
<div class="line"><span class="lineno"> 4128</span>                                               3 * Months, Monthly, infDates, infRates));</div>
<div class="line"><span class="lineno"> 4129</span> </div>
<div class="line"><span class="lineno"> 4130</span>    Handle&lt;DefaultProbabilityTermStructure&gt; hts(</div>
<div class="line"><span class="lineno"> 4131</span>        boost::make_shared&lt;FlatHazardRate&gt;(0, NullCalendar(), 0.01, Actual365Fixed()));</div>
<div class="line"><span class="lineno"> 4132</span> </div>
<div class="line"><span class="lineno"> 4133</span>    Handle&lt;Quote&gt; fxspot(boost::make_shared&lt;SimpleQuote&gt;(1.00)), eqspot(boost::make_shared&lt;SimpleQuote&gt;(1.00));</div>
<div class="line"><span class="lineno"> 4134</span> </div>
<div class="line"><span class="lineno"> 4135</span>    Array notimes(0);</div>
<div class="line"><span class="lineno"> 4136</span>    Array fxsigma(1, 0.10), eqsigma(1, 0.10);</div>
<div class="line"><span class="lineno"> 4137</span> </div>
<div class="line"><span class="lineno"> 4138</span>    <span class="keywordflow">for</span> (Size ii = 0; ii &lt; <a class="code hl_define" href="utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(currencies); ++ii) {</div>
<div class="line"><span class="lineno"> 4139</span>        <span class="keywordflow">for</span> (Size kk = 0; kk &lt; <a class="code hl_define" href="utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(cpiindexes); ++kk) {</div>
<div class="line"><span class="lineno"> 4140</span>            <span class="keywordflow">for</span> (Size jj = 0; jj &lt; <a class="code hl_define" href="utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(creditnames); ++jj) {</div>
<div class="line"><span class="lineno"> 4141</span>                <span class="keywordflow">for</span> (Size ee = 0; ee &lt; <a class="code hl_define" href="utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(eqs); ++ee) {</div>
<div class="line"><span class="lineno"> 4142</span> </div>
<div class="line"><span class="lineno"> 4143</span>                    std::vector&lt;Currency&gt; pseudoCcy;</div>
<div class="line"><span class="lineno"> 4144</span>                    <span class="keywordflow">for</span> (Size i = 0; i &lt; currencies[ii]; ++i) {</div>
<div class="line"><span class="lineno"> 4145</span>                        PseudoCurrency tmp(i);</div>
<div class="line"><span class="lineno"> 4146</span>                        pseudoCcy.push_back(tmp);</div>
<div class="line"><span class="lineno"> 4147</span>                    }</div>
<div class="line"><span class="lineno"> 4148</span> </div>
<div class="line"><span class="lineno"> 4149</span>                    Size dim = 2 * currencies[ii] - 1 + cpiindexes[kk] + creditnames[jj] + eqs[ee];</div>
<div class="line"><span class="lineno"> 4150</span> </div>
<div class="line"><span class="lineno"> 4151</span>                    <span class="comment">// generate random correlation matrix</span></div>
<div class="line"><span class="lineno"> 4152</span>                    Matrix b(dim, dim);</div>
<div class="line"><span class="lineno"> 4153</span>                    Size maxTries = 100;</div>
<div class="line"><span class="lineno"> 4154</span>                    <span class="keywordtype">bool</span> valid = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 4155</span>                    <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno"> 4156</span>                        Matrix a(dim, dim);</div>
<div class="line"><span class="lineno"> 4157</span>                        <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 4158</span>                            <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 4159</span>                                a[i][j] = a[j][i] = mt.nextReal() - 0.5;</div>
<div class="line"><span class="lineno"> 4160</span>                            }</div>
<div class="line"><span class="lineno"> 4161</span>                        }</div>
<div class="line"><span class="lineno"> 4162</span>                        b = a * transpose(a);</div>
<div class="line"><span class="lineno"> 4163</span>                        <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 4164</span>                            <span class="keywordflow">if</span> (b[i][i] &lt; 1E-5)</div>
<div class="line"><span class="lineno"> 4165</span>                                valid = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 4166</span>                        }</div>
<div class="line"><span class="lineno"> 4167</span>                    } <span class="keywordflow">while</span> (!valid &amp;&amp; --maxTries &gt; 0);</div>
<div class="line"><span class="lineno"> 4168</span> </div>
<div class="line"><span class="lineno"> 4169</span>                    <span class="keywordflow">if</span> (maxTries == 0) {</div>
<div class="line"><span class="lineno"> 4170</span>                        BOOST_ERROR(<span class="stringliteral">&quot;could no generate random matrix&quot;</span>);</div>
<div class="line"><span class="lineno"> 4171</span>                        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 4172</span>                    }</div>
<div class="line"><span class="lineno"> 4173</span> </div>
<div class="line"><span class="lineno"> 4174</span>                    Matrix c(dim, dim);</div>
<div class="line"><span class="lineno"> 4175</span>                    <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 4176</span>                        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 4177</span>                            c[i][j] = c[j][i] = b[i][j] / std::sqrt(b[i][i] * b[j][j]);</div>
<div class="line"><span class="lineno"> 4178</span>                        }</div>
<div class="line"><span class="lineno"> 4179</span>                    }</div>
<div class="line"><span class="lineno"> 4180</span> </div>
<div class="line"><span class="lineno"> 4181</span>                    <span class="comment">// set up model</span></div>
<div class="line"><span class="lineno"> 4182</span> </div>
<div class="line"><span class="lineno"> 4183</span>                    std::vector&lt;boost::shared_ptr&lt;Parametrization&gt; &gt; parametrizations;</div>
<div class="line"><span class="lineno"> 4184</span> </div>
<div class="line"><span class="lineno"> 4185</span>                    <span class="comment">// IR</span></div>
<div class="line"><span class="lineno"> 4186</span>                    <span class="keywordflow">for</span> (Size i = 0; i &lt; currencies[ii]; ++i) {</div>
<div class="line"><span class="lineno"> 4187</span>                        parametrizations.push_back(</div>
<div class="line"><span class="lineno"> 4188</span>                            boost::make_shared&lt;IrLgm1fConstantParametrization&gt;(pseudoCcy[i], yts, 0.01, 0.01));</div>
<div class="line"><span class="lineno"> 4189</span>                    }</div>
<div class="line"><span class="lineno"> 4190</span>                    <span class="comment">// FX</span></div>
<div class="line"><span class="lineno"> 4191</span>                    <span class="keywordflow">for</span> (Size i = 0; i &lt; currencies[ii] - 1; ++i) {</div>
<div class="line"><span class="lineno"> 4192</span>                        parametrizations.push_back(boost::make_shared&lt;FxBsPiecewiseConstantParametrization&gt;(</div>
<div class="line"><span class="lineno"> 4193</span>                            pseudoCcy[i + 1], fxspot, notimes, fxsigma));</div>
<div class="line"><span class="lineno"> 4194</span>                    }</div>
<div class="line"><span class="lineno"> 4195</span>                    <span class="comment">// INF</span></div>
<div class="line"><span class="lineno"> 4196</span>                    <span class="keywordflow">for</span> (Size i = 0; i &lt; cpiindexes[kk]; ++i) {</div>
<div class="line"><span class="lineno"> 4197</span>                        parametrizations.push_back(</div>
<div class="line"><span class="lineno"> 4198</span>                            boost::make_shared&lt;InfDkConstantParametrization&gt;(pseudoCcy[0], its, 0.01, 0.01));</div>
<div class="line"><span class="lineno"> 4199</span>                    }</div>
<div class="line"><span class="lineno"> 4200</span>                    <span class="comment">// CR</span></div>
<div class="line"><span class="lineno"> 4201</span>                    <span class="keywordflow">for</span> (Size i = 0; i &lt; creditnames[jj]; ++i) {</div>
<div class="line"><span class="lineno"> 4202</span>                        parametrizations.push_back(</div>
<div class="line"><span class="lineno"> 4203</span>                            boost::make_shared&lt;CrLgm1fConstantParametrization&gt;(pseudoCcy[0], hts, 0.01, 0.01));</div>
<div class="line"><span class="lineno"> 4204</span>                    }</div>
<div class="line"><span class="lineno"> 4205</span>                    <span class="comment">// EQ</span></div>
<div class="line"><span class="lineno"> 4206</span>                    <span class="keywordflow">for</span> (Size i = 0; i &lt; eqs[ee]; ++i) {</div>
<div class="line"><span class="lineno"> 4207</span>                        parametrizations.push_back(boost::make_shared&lt;EqBsPiecewiseConstantParametrization&gt;(</div>
<div class="line"><span class="lineno"> 4208</span>                            pseudoCcy[0], <span class="stringliteral">&quot;dummy&quot;</span>, eqspot, fxspot, notimes, eqsigma, yts, yts));</div>
<div class="line"><span class="lineno"> 4209</span>                    }</div>
<div class="line"><span class="lineno"> 4210</span> </div>
<div class="line"><span class="lineno"> 4211</span>                    <span class="comment">// get QuantLib::Error: negative eigenvalue(s) (-3.649315e-16) with SalvagingAlgorithm::None</span></div>
<div class="line"><span class="lineno"> 4212</span>                    boost::shared_ptr&lt;CrossAssetModel&gt; modelEuler = boost::make_shared&lt;CrossAssetModel&gt;(</div>
<div class="line"><span class="lineno"> 4213</span>                        parametrizations, c, SalvagingAlgorithm::Spectral, IrModel::Measure::LGM,</div>
<div class="line"><span class="lineno"> 4214</span>                        CrossAssetModel::Discretization::Euler);</div>
<div class="line"><span class="lineno"> 4215</span>                    boost::shared_ptr&lt;CrossAssetModel&gt; modelExact = boost::make_shared&lt;CrossAssetModel&gt;(</div>
<div class="line"><span class="lineno"> 4216</span>                        parametrizations, c, SalvagingAlgorithm::Spectral, IrModel::Measure::LGM,</div>
<div class="line"><span class="lineno"> 4217</span>                        CrossAssetModel::Discretization::Exact);</div>
<div class="line"><span class="lineno"> 4218</span> </div>
<div class="line"><span class="lineno"> 4219</span>                    boost::shared_ptr&lt;StochasticProcess&gt; peuler = modelEuler-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 4220</span>                    boost::shared_ptr&lt;StochasticProcess&gt; pexact = modelExact-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 4221</span> </div>
<div class="line"><span class="lineno"> 4222</span>                    Matrix c1 = peuler-&gt;covariance(dt, peuler-&gt;initialValues(), dt);</div>
<div class="line"><span class="lineno"> 4223</span>                    Matrix c2 = pexact-&gt;covariance(0.0, peuler-&gt;initialValues(), dt);</div>
<div class="line"><span class="lineno"> 4224</span> </div>
<div class="line"><span class="lineno"> 4225</span>                    Matrix r1(dim, dim), r2(dim, dim);</div>
<div class="line"><span class="lineno"> 4226</span> </div>
<div class="line"><span class="lineno"> 4227</span>                    Size sizeIrFx = 2 * currencies[ii] - 1;</div>
<div class="line"><span class="lineno"> 4228</span> </div>
<div class="line"><span class="lineno"> 4229</span>                    <span class="keywordflow">for</span> (Size i = 0; i &lt; dim; ++i) {</div>
<div class="line"><span class="lineno"> 4230</span>                        <span class="keywordflow">for</span> (Size j = 0; j &lt;= i; ++j) {</div>
<div class="line"><span class="lineno"> 4231</span>                            <span class="comment">// there are two state variables per credit name,</span></div>
<div class="line"><span class="lineno"> 4232</span>                            <span class="comment">// and per inflation index</span></div>
<div class="line"><span class="lineno"> 4233</span>                            Size subi = i &lt; sizeIrFx || i &gt;= sizeIrFx + cpiindexes[kk] + creditnames[jj] ? 1 : 2;</div>
<div class="line"><span class="lineno"> 4234</span>                            Size subj = j &lt; sizeIrFx || i &gt;= sizeIrFx + cpiindexes[kk] + creditnames[jj] ? 1 : 2;</div>
<div class="line"><span class="lineno"> 4235</span>                            <span class="keywordflow">for</span> (Size k1 = 0; k1 &lt; subi; ++k1) {</div>
<div class="line"><span class="lineno"> 4236</span>                                <span class="keywordflow">for</span> (Size k2 = 0; k2 &lt; subj; ++k2) {</div>
<div class="line"><span class="lineno"> 4237</span>                                    Size i0 = i &lt; sizeIrFx</div>
<div class="line"><span class="lineno"> 4238</span>                                                  ? i</div>
<div class="line"><span class="lineno"> 4239</span>                                                  : (i &lt; sizeIrFx + cpiindexes[kk] + creditnames[jj]</div>
<div class="line"><span class="lineno"> 4240</span>                                                         ? sizeIrFx + 2 * (i - sizeIrFx) + k1</div>
<div class="line"><span class="lineno"> 4241</span>                                                         : sizeIrFx + 2 * cpiindexes[kk] + 2 * creditnames[jj] +</div>
<div class="line"><span class="lineno"> 4242</span>                                                               (i - sizeIrFx - cpiindexes[kk] - creditnames[jj]));</div>
<div class="line"><span class="lineno"> 4243</span>                                    Size j0 = j &lt; sizeIrFx</div>
<div class="line"><span class="lineno"> 4244</span>                                                  ? j</div>
<div class="line"><span class="lineno"> 4245</span>                                                  : (j &lt; sizeIrFx + cpiindexes[kk] + creditnames[jj]</div>
<div class="line"><span class="lineno"> 4246</span>                                                         ? sizeIrFx + 2 * (j - sizeIrFx) + k2</div>
<div class="line"><span class="lineno"> 4247</span>                                                         : sizeIrFx + 2 * cpiindexes[kk] + 2 * creditnames[jj] +</div>
<div class="line"><span class="lineno"> 4248</span>                                                               (j - sizeIrFx - cpiindexes[kk] - creditnames[jj]));</div>
<div class="line"><span class="lineno"> 4249</span>                                    r1[i][j] = r1[j][i] = c1[i0][j0] / std::sqrt(c1[i0][i0] * c1[j0][j0]);</div>
<div class="line"><span class="lineno"> 4250</span>                                    r2[i][j] = r2[j][i] = c2[i0][j0] / std::sqrt(c2[i0][i0] * c2[j0][j0]);</div>
<div class="line"><span class="lineno"> 4251</span>                                    <span class="keywordflow">if</span> (std::fabs(r1[i][j] - c[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 4252</span>                                        BOOST_ERROR(<span class="stringliteral">&quot;failed to recover correlation matrix &quot;</span></div>
<div class="line"><span class="lineno"> 4253</span>                                                    <span class="stringliteral">&quot;from &quot;</span></div>
<div class="line"><span class="lineno"> 4254</span>                                                    <span class="stringliteral">&quot;Euler state process (i,j)=(&quot;</span></div>
<div class="line"><span class="lineno"> 4255</span>                                                    &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;), (i0,j0)=(&quot;</span> &lt;&lt; i0 &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j0</div>
<div class="line"><span class="lineno"> 4256</span>                                                    &lt;&lt; <span class="stringliteral">&quot;), input correlation is &quot;</span> &lt;&lt; c[i][j] &lt;&lt; <span class="stringliteral">&quot;, output is &quot;</span></div>
<div class="line"><span class="lineno"> 4257</span>                                                    &lt;&lt; r1[i][j] &lt;&lt; <span class="stringliteral">&quot;, difference &quot;</span> &lt;&lt; (c[i][j] - r1[i][j])</div>
<div class="line"><span class="lineno"> 4258</span>                                                    &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol &lt;&lt; <span class="stringliteral">&quot; test configuration is &quot;</span></div>
<div class="line"><span class="lineno"> 4259</span>                                                    &lt;&lt; currencies[ii] &lt;&lt; <span class="stringliteral">&quot; currencies and &quot;</span> &lt;&lt; cpiindexes[kk]</div>
<div class="line"><span class="lineno"> 4260</span>                                                    &lt;&lt; <span class="stringliteral">&quot; cpi indexes and &quot;</span> &lt;&lt; creditnames[jj] &lt;&lt; <span class="stringliteral">&quot; credit names&quot;</span></div>
<div class="line"><span class="lineno"> 4261</span>                                                    &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; eqs[ee] &lt;&lt; <span class="stringliteral">&quot; equities&quot;</span>);</div>
<div class="line"><span class="lineno"> 4262</span>                                    }</div>
<div class="line"><span class="lineno"> 4263</span>                                    <span class="keywordflow">if</span> (k1 == k2) {</div>
<div class="line"><span class="lineno"> 4264</span>                                        <span class="keywordflow">if</span> (std::fabs(r2[i][j] - c[i][j]) &gt; tol) {</div>
<div class="line"><span class="lineno"> 4265</span>                                            BOOST_ERROR(<span class="stringliteral">&quot;failed to recover correlation &quot;</span></div>
<div class="line"><span class="lineno"> 4266</span>                                                        <span class="stringliteral">&quot;matrix &quot;</span></div>
<div class="line"><span class="lineno"> 4267</span>                                                        <span class="stringliteral">&quot;from &quot;</span></div>
<div class="line"><span class="lineno"> 4268</span>                                                        <span class="stringliteral">&quot;exact state process (i,j)=(&quot;</span></div>
<div class="line"><span class="lineno"> 4269</span>                                                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;), (i0,j0)=(&quot;</span> &lt;&lt; i0 &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; j0</div>
<div class="line"><span class="lineno"> 4270</span>                                                        &lt;&lt; <span class="stringliteral">&quot;), input correlation is &quot;</span> &lt;&lt; c[i][j] &lt;&lt; <span class="stringliteral">&quot;, output is &quot;</span></div>
<div class="line"><span class="lineno"> 4271</span>                                                        &lt;&lt; r2[i][j] &lt;&lt; <span class="stringliteral">&quot;, difference &quot;</span> &lt;&lt; (c[i][j] - r2[i][j])</div>
<div class="line"><span class="lineno"> 4272</span>                                                        &lt;&lt; <span class="stringliteral">&quot;, tolerance &quot;</span> &lt;&lt; tol &lt;&lt; <span class="stringliteral">&quot; test configuration is &quot;</span></div>
<div class="line"><span class="lineno"> 4273</span>                                                        &lt;&lt; currencies[ii] &lt;&lt; <span class="stringliteral">&quot; currencies and &quot;</span> &lt;&lt; cpiindexes[kk]</div>
<div class="line"><span class="lineno"> 4274</span>                                                        &lt;&lt; <span class="stringliteral">&quot; cpi indexes and &quot;</span> &lt;&lt; creditnames[jj] &lt;&lt; <span class="stringliteral">&quot; credit names&quot;</span></div>
<div class="line"><span class="lineno"> 4275</span>                                                        &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; eqs[ee] &lt;&lt; <span class="stringliteral">&quot; equities&quot;</span>);</div>
<div class="line"><span class="lineno"> 4276</span>                                        }</div>
<div class="line"><span class="lineno"> 4277</span>                                    }</div>
<div class="line"><span class="lineno"> 4278</span>                                }</div>
<div class="line"><span class="lineno"> 4279</span>                            }</div>
<div class="line"><span class="lineno"> 4280</span>                        }</div>
<div class="line"><span class="lineno"> 4281</span>                    }</div>
<div class="line"><span class="lineno"> 4282</span>                } <span class="comment">// for equity</span></div>
<div class="line"><span class="lineno"> 4283</span>            }     <span class="comment">// for creditnames</span></div>
<div class="line"><span class="lineno"> 4284</span>        }         <span class="comment">// for cpiindexes</span></div>
<div class="line"><span class="lineno"> 4285</span>    }             <span class="comment">// for currencies</span></div>
<div class="line"><span class="lineno"> 4286</span>} <span class="comment">// testIrFxInfCrEqCorrelationRecovery</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5bcc91c2f009e439388195393beed77e" name="a5bcc91c2f009e439388195393beed77e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5bcc91c2f009e439388195393beed77e">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[22/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCpiCalibrationByAlpha&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l04288">4288</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4288</span>                                                {</div>
<div class="line"><span class="lineno"> 4289</span> </div>
<div class="line"><span class="lineno"> 4290</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing calibration to ZC CPI Floors (using alpha) and repricing via MC...&quot;</span>);</div>
<div class="line"><span class="lineno"> 4291</span> </div>
<div class="line"><span class="lineno"> 4292</span>    <span class="comment">// set up IR-INF model, calibrate to given premiums and check</span></div>
<div class="line"><span class="lineno"> 4293</span>    <span class="comment">// the result with a MC simulation</span></div>
<div class="line"><span class="lineno"> 4294</span> </div>
<div class="line"><span class="lineno"> 4295</span>    SavedSettings backup;</div>
<div class="line"><span class="lineno"> 4296</span>    Date refDate(30, July, 2015);</div>
<div class="line"><span class="lineno"> 4297</span>    Settings::instance().evaluationDate() = Date(30, July, 2015);</div>
<div class="line"><span class="lineno"> 4298</span> </div>
<div class="line"><span class="lineno"> 4299</span>    <span class="comment">// IR</span></div>
<div class="line"><span class="lineno"> 4300</span>    Handle&lt;YieldTermStructure&gt; eurYts(boost::make_shared&lt;FlatForward&gt;(refDate, 0.01, Actual365Fixed()));</div>
<div class="line"><span class="lineno"> 4301</span>    boost::shared_ptr&lt;Parametrization&gt; ireur_p =</div>
<div class="line"><span class="lineno"> 4302</span>        boost::make_shared&lt;IrLgm1fConstantParametrization&gt;(EURCurrency(), eurYts, 0.01, 0.01);</div>
<div class="line"><span class="lineno"> 4303</span> </div>
<div class="line"><span class="lineno"> 4304</span>    <span class="comment">// INF</span></div>
<div class="line"><span class="lineno"> 4305</span>    Real baseCPI = 100.0;</div>
<div class="line"><span class="lineno"> 4306</span>    std::vector&lt;Date&gt; infDates;</div>
<div class="line"><span class="lineno"> 4307</span>    std::vector&lt;Real&gt; infRates;</div>
<div class="line"><span class="lineno"> 4308</span>    infDates.push_back(Date(30, April, 2015));</div>
<div class="line"><span class="lineno"> 4309</span>    infDates.push_back(Date(30, July, 2015));</div>
<div class="line"><span class="lineno"> 4310</span>    infRates.push_back(0.0075);</div>
<div class="line"><span class="lineno"> 4311</span>    infRates.push_back(0.0075);</div>
<div class="line"><span class="lineno"> 4312</span>    Handle&lt;ZeroInflationTermStructure&gt; infEurTs(boost::make_shared&lt;ZeroInflationCurve&gt;(</div>
<div class="line"><span class="lineno"> 4313</span>        refDate, TARGET(), Actual365Fixed(), 3 * Months, Monthly, infDates, infRates));</div>
<div class="line"><span class="lineno"> 4314</span>    infEurTs-&gt;enableExtrapolation();</div>
<div class="line"><span class="lineno"> 4315</span>    Handle&lt;ZeroInflationIndex&gt; infIndex(boost::make_shared&lt;EUHICPXT&gt;(<span class="keyword">false</span>, infEurTs));</div>
<div class="line"><span class="lineno"> 4316</span>    </div>
<div class="line"><span class="lineno"> 4317</span>    infIndex-&gt;addFixing(Date(1, April, 2015), 100);</div>
<div class="line"><span class="lineno"> 4318</span> </div>
<div class="line"><span class="lineno"> 4319</span>    Real premium[] = { 0.0044, 0.0085, 0.0127, 0.0160, 0.0186 };</div>
<div class="line"><span class="lineno"> 4320</span> </div>
<div class="line"><span class="lineno"> 4321</span>    std::vector&lt;boost::shared_ptr&lt;BlackCalibrationHelper&gt; &gt; cpiHelpers;</div>
<div class="line"><span class="lineno"> 4322</span>    Array volStepTimes(4), noTimes(0);</div>
<div class="line"><span class="lineno"> 4323</span>    Array infVols(5, 0.01), infRev(1, 1.5); <span class="comment">// !!</span></div>
<div class="line"><span class="lineno"> 4324</span> </div>
<div class="line"><span class="lineno"> 4325</span>    Time T;</div>
<div class="line"><span class="lineno"> 4326</span>    <span class="keywordflow">for</span> (Size i = 1; i &lt;= 5; ++i) {</div>
<div class="line"><span class="lineno"> 4327</span>        Date maturity = refDate + i * Years;</div>
<div class="line"><span class="lineno"> 4328</span>        boost::shared_ptr&lt;CpiCapFloorHelper&gt; h(<span class="keyword">new</span> <a class="code hl_class" href="class_quant_ext_1_1_cpi_cap_floor_helper.html">CpiCapFloorHelper</a>(Option::Put, baseCPI, maturity, TARGET(),</div>
<div class="line"><span class="lineno"> 4329</span>                                                                     ModifiedFollowing, TARGET(), ModifiedFollowing,</div>
<div class="line"><span class="lineno"> 4330</span>                                                                     0.01, infIndex, 3 * Months, premium[i - 1]));</div>
<div class="line"><span class="lineno"> 4331</span>        Real t = inflationYearFraction(Monthly, <span class="keyword">false</span>, Actual365Fixed(), infEurTs-&gt;baseDate(),</div>
<div class="line"><span class="lineno"> 4332</span>                                       h-&gt;instrument()-&gt;fixingDate());</div>
<div class="line"><span class="lineno"> 4333</span>        cpiHelpers.push_back(h);</div>
<div class="line"><span class="lineno"> 4334</span>        <span class="keywordflow">if</span> (i &lt;= 4)</div>
<div class="line"><span class="lineno"> 4335</span>            volStepTimes[i - 1] = t;</div>
<div class="line"><span class="lineno"> 4336</span>        T = t;</div>
<div class="line"><span class="lineno"> 4337</span>    }</div>
<div class="line"><span class="lineno"> 4338</span> </div>
<div class="line"><span class="lineno"> 4339</span>    boost::shared_ptr&lt;InfDkPiecewiseConstantParametrization&gt; infeur_p =</div>
<div class="line"><span class="lineno"> 4340</span>        boost::make_shared&lt;InfDkPiecewiseConstantParametrization&gt;(EURCurrency(), infEurTs, volStepTimes, infVols,</div>
<div class="line"><span class="lineno"> 4341</span>                                                                  noTimes, infRev);</div>
<div class="line"><span class="lineno"> 4342</span> </div>
<div class="line"><span class="lineno"> 4343</span>    std::vector&lt;boost::shared_ptr&lt;Parametrization&gt; &gt; parametrizations;</div>
<div class="line"><span class="lineno"> 4344</span>    parametrizations.push_back(ireur_p);</div>
<div class="line"><span class="lineno"> 4345</span>    parametrizations.push_back(infeur_p);</div>
<div class="line"><span class="lineno"> 4346</span> </div>
<div class="line"><span class="lineno"> 4347</span>    boost::shared_ptr&lt;CrossAssetModel&gt; model =</div>
<div class="line"><span class="lineno"> 4348</span>        boost::make_shared&lt;CrossAssetModel&gt;(parametrizations, Matrix(), SalvagingAlgorithm::None);</div>
<div class="line"><span class="lineno"> 4349</span> </div>
<div class="line"><span class="lineno"> 4350</span>    model-&gt;correlation(CrossAssetModel::AssetType::IR, 0, CrossAssetModel::AssetType::INF, 0, 0.33);</div>
<div class="line"><span class="lineno"> 4351</span> </div>
<div class="line"><span class="lineno"> 4352</span>    <span class="comment">// pricing engine</span></div>
<div class="line"><span class="lineno"> 4353</span>    boost::shared_ptr&lt;AnalyticDkCpiCapFloorEngine&gt; engine =</div>
<div class="line"><span class="lineno"> 4354</span>        boost::make_shared&lt;AnalyticDkCpiCapFloorEngine&gt;(model, 0, baseCPI);</div>
<div class="line"><span class="lineno"> 4355</span> </div>
<div class="line"><span class="lineno"> 4356</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; cpiHelpers.size(); ++i) {</div>
<div class="line"><span class="lineno"> 4357</span>        cpiHelpers[i]-&gt;setPricingEngine(engine);</div>
<div class="line"><span class="lineno"> 4358</span>    }</div>
<div class="line"><span class="lineno"> 4359</span> </div>
<div class="line"><span class="lineno"> 4360</span>    <span class="comment">// calibration</span></div>
<div class="line"><span class="lineno"> 4361</span>    LevenbergMarquardt lm;</div>
<div class="line"><span class="lineno"> 4362</span>    EndCriteria ec(1000, 500, 1E-8, 1E-8, 1E-8);</div>
<div class="line"><span class="lineno"> 4363</span>    model-&gt;calibrateInfDkVolatilitiesIterative(0, cpiHelpers, lm, ec);</div>
<div class="line"><span class="lineno"> 4364</span> </div>
<div class="line"><span class="lineno"> 4365</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; cpiHelpers.size(); ++i) {</div>
<div class="line"><span class="lineno"> 4366</span>        BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;i=&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; modelvol=&quot;</span> &lt;&lt; model-&gt;infdk(0)-&gt;parameterValues(0)[i] &lt;&lt; <span class="stringliteral">&quot; market=&quot;</span></div>
<div class="line"><span class="lineno"> 4367</span>                                &lt;&lt; cpiHelpers[i]-&gt;marketValue() &lt;&lt; <span class="stringliteral">&quot; model=&quot;</span> &lt;&lt; cpiHelpers[i]-&gt;modelValue()</div>
<div class="line"><span class="lineno"> 4368</span>                                &lt;&lt; <span class="stringliteral">&quot; diff=&quot;</span> &lt;&lt; (cpiHelpers[i]-&gt;marketValue() - cpiHelpers[i]-&gt;modelValue()));</div>
<div class="line"><span class="lineno"> 4369</span>    }</div>
<div class="line"><span class="lineno"> 4370</span> </div>
<div class="line"><span class="lineno"> 4371</span>    <span class="comment">// reprice last ZC floor with Monte Carlo</span></div>
<div class="line"><span class="lineno"> 4372</span>    Size n = 50000; <span class="comment">// number of paths</span></div>
<div class="line"><span class="lineno"> 4373</span>    Size seed = 18; <span class="comment">// rng seed</span></div>
<div class="line"><span class="lineno"> 4374</span>    Size <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a> = 1; <span class="comment">// number of discretization steps</span></div>
<div class="line"><span class="lineno"> 4375</span> </div>
<div class="line"><span class="lineno"> 4376</span>    boost::shared_ptr&lt;StochasticProcess&gt; process = model-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 4377</span>    LowDiscrepancy::rsg_type sg = LowDiscrepancy::make_sequence_generator(process-&gt;factors() * <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>, seed);</div>
<div class="line"><span class="lineno"> 4378</span>    TimeGrid grid(T, <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>);</div>
<div class="line"><span class="lineno"> 4379</span>    MultiPathGenerator&lt;LowDiscrepancy::rsg_type&gt; pg(process, grid, sg, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 4380</span> </div>
<div class="line"><span class="lineno"> 4381</span>    accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; floor;</div>
<div class="line"><span class="lineno"> 4382</span> </div>
<div class="line"><span class="lineno"> 4383</span>    Real K = std::pow(1.0 + 0.01, T);</div>
<div class="line"><span class="lineno"> 4384</span> </div>
<div class="line"><span class="lineno"> 4385</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 4386</span>        Sample&lt;MultiPath&gt; path = pg.next();</div>
<div class="line"><span class="lineno"> 4387</span>        Size l = path.value[0].length() - 1;</div>
<div class="line"><span class="lineno"> 4388</span>        Real irz = path.value[0][l];</div>
<div class="line"><span class="lineno"> 4389</span>        Real infz = path.value[1][l];</div>
<div class="line"><span class="lineno"> 4390</span>        Real infy = path.value[2][l];</div>
<div class="line"><span class="lineno"> 4391</span>        Real I = model-&gt;infdkI(0, T, T, infz, infy).first;</div>
<div class="line"><span class="lineno"> 4392</span>        floor(std::max(-(I - K), 0.0) / model-&gt;numeraire(0, T, irz));</div>
<div class="line"><span class="lineno"> 4393</span>    }</div>
<div class="line"><span class="lineno"> 4394</span> </div>
<div class="line"><span class="lineno"> 4395</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;mc floor 5y = &quot;</span> &lt;&lt; mean(floor) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span>);</div>
<div class="line"><span class="lineno"> 4396</span> </div>
<div class="line"><span class="lineno"> 4397</span>    <span class="comment">// check model calibration</span></div>
<div class="line"><span class="lineno"> 4398</span>    Real tol = 1.0E-12;</div>
<div class="line"><span class="lineno"> 4399</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; cpiHelpers.size(); ++i) {</div>
<div class="line"><span class="lineno"> 4400</span>        <span class="keywordflow">if</span> (std::abs(cpiHelpers[i]-&gt;modelValue() - cpiHelpers[i]-&gt;marketValue()) &gt; tol) {</div>
<div class="line"><span class="lineno"> 4401</span>            BOOST_ERROR(<span class="stringliteral">&quot;Model calibration for ZC CPI Floor #&quot;</span></div>
<div class="line"><span class="lineno"> 4402</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; failed, market premium is &quot;</span> &lt;&lt; cpiHelpers[i]-&gt;marketValue() &lt;&lt; <span class="stringliteral">&quot;, model value is &quot;</span></div>
<div class="line"><span class="lineno"> 4403</span>                        &lt;&lt; cpiHelpers[i]-&gt;modelValue() &lt;&lt; <span class="stringliteral">&quot;, difference is &quot;</span></div>
<div class="line"><span class="lineno"> 4404</span>                        &lt;&lt; (cpiHelpers[i]-&gt;marketValue() - cpiHelpers[i]-&gt;modelValue()) &lt;&lt; <span class="stringliteral">&quot;, tolerance is &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 4405</span>        }</div>
<div class="line"><span class="lineno"> 4406</span>    }</div>
<div class="line"><span class="lineno"> 4407</span>    <span class="comment">// check repricing with MC</span></div>
<div class="line"><span class="lineno"> 4408</span>    tol = 1.0E-5;</div>
<div class="line"><span class="lineno"> 4409</span>    Real mcPrice = mean(floor);</div>
<div class="line"><span class="lineno"> 4410</span>    <span class="keywordflow">if</span> (std::abs(mcPrice - cpiHelpers[4]-&gt;modelValue()) &gt; tol) {</div>
<div class="line"><span class="lineno"> 4411</span>        BOOST_ERROR(<span class="stringliteral">&quot;Failed to reprice 5y ZC CPI Floor with MC (&quot;</span></div>
<div class="line"><span class="lineno"> 4412</span>                    &lt;&lt; mcPrice &lt;&lt; <span class="stringliteral">&quot;), analytical model price is &quot;</span> &lt;&lt; cpiHelpers[4]-&gt;modelValue() &lt;&lt; <span class="stringliteral">&quot;, difference is &quot;</span></div>
<div class="line"><span class="lineno"> 4413</span>                    &lt;&lt; mcPrice - cpiHelpers[4]-&gt;modelValue() &lt;&lt; <span class="stringliteral">&quot;, tolerance is &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 4414</span>    }</div>
<div class="line"><span class="lineno"> 4415</span>} <span class="comment">// testCpiCalibrationByAlpha</span></div>
<div class="ttc" id="aclass_quant_ext_1_1_cpi_cap_floor_helper_html"><div class="ttname"><a href="class_quant_ext_1_1_cpi_cap_floor_helper.html">QuantExt::CpiCapFloorHelper</a></div><div class="ttdoc">CPI cap floor helper.</div><div class="ttdef"><b>Definition:</b> <a href="cpicapfloorhelper_8hpp_source.html#l00039">cpicapfloorhelper.hpp:39</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7d42876af41cfdd820f76db826b25e15" name="a7d42876af41cfdd820f76db826b25e15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d42876af41cfdd820f76db826b25e15">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[23/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCpiCalibrationByH&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l04417">4417</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4417</span>                                            {</div>
<div class="line"><span class="lineno"> 4418</span> </div>
<div class="line"><span class="lineno"> 4419</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing calibration to ZC CPI Floors (using H) and repricing via MC...&quot;</span>);</div>
<div class="line"><span class="lineno"> 4420</span> </div>
<div class="line"><span class="lineno"> 4421</span>    <span class="comment">// set up IR-INF model, calibrate to given premiums and check</span></div>
<div class="line"><span class="lineno"> 4422</span>    <span class="comment">// the result with a MC simulation</span></div>
<div class="line"><span class="lineno"> 4423</span> </div>
<div class="line"><span class="lineno"> 4424</span>    SavedSettings backup;</div>
<div class="line"><span class="lineno"> 4425</span>    Date refDate(30, July, 2015);</div>
<div class="line"><span class="lineno"> 4426</span>    Settings::instance().evaluationDate() = Date(30, July, 2015);</div>
<div class="line"><span class="lineno"> 4427</span> </div>
<div class="line"><span class="lineno"> 4428</span>    <span class="comment">// IR</span></div>
<div class="line"><span class="lineno"> 4429</span>    Handle&lt;YieldTermStructure&gt; eurYts(boost::make_shared&lt;FlatForward&gt;(refDate, 0.01, Actual365Fixed()));</div>
<div class="line"><span class="lineno"> 4430</span>    boost::shared_ptr&lt;Parametrization&gt; ireur_p =</div>
<div class="line"><span class="lineno"> 4431</span>        boost::make_shared&lt;IrLgm1fConstantParametrization&gt;(EURCurrency(), eurYts, 0.01, 0.01);</div>
<div class="line"><span class="lineno"> 4432</span> </div>
<div class="line"><span class="lineno"> 4433</span>    <span class="comment">// INF</span></div>
<div class="line"><span class="lineno"> 4434</span>    Real baseCPI = 100.0;</div>
<div class="line"><span class="lineno"> 4435</span>    std::vector&lt;Date&gt; infDates;</div>
<div class="line"><span class="lineno"> 4436</span>    std::vector&lt;Real&gt; infRates;</div>
<div class="line"><span class="lineno"> 4437</span>    infDates.push_back(Date(30, April, 2015));</div>
<div class="line"><span class="lineno"> 4438</span>    infDates.push_back(Date(30, July, 2015));</div>
<div class="line"><span class="lineno"> 4439</span>    infRates.push_back(0.0075);</div>
<div class="line"><span class="lineno"> 4440</span>    infRates.push_back(0.0075);</div>
<div class="line"><span class="lineno"> 4441</span>    Handle&lt;ZeroInflationTermStructure&gt; infEurTs(boost::make_shared&lt;ZeroInflationCurve&gt;(</div>
<div class="line"><span class="lineno"> 4442</span>        refDate, TARGET(), Actual365Fixed(), 3 * Months, Monthly, infDates, infRates));</div>
<div class="line"><span class="lineno"> 4443</span>    infEurTs-&gt;enableExtrapolation();</div>
<div class="line"><span class="lineno"> 4444</span>    Handle&lt;ZeroInflationIndex&gt; infIndex(boost::make_shared&lt;EUHICPXT&gt;(<span class="keyword">false</span>, infEurTs));</div>
<div class="line"><span class="lineno"> 4445</span>    infIndex-&gt;addFixing(Date(1, April, 2015), 100);</div>
<div class="line"><span class="lineno"> 4446</span>    Size nMat = 14;</div>
<div class="line"><span class="lineno"> 4447</span>    Real premium[] = { 0.000555, 0.000813, 0.000928, 0.00127, 0.001616, 0.0019, 0.0023,</div>
<div class="line"><span class="lineno"> 4448</span>                       0.0026,   0.0029,   0.0032,   0.0032,  0.0033,   0.0038, 0.0067 };</div>
<div class="line"><span class="lineno"> 4449</span>    Period maturity[] = { 1 * Years, 2 * Years, 3 * Years,  4 * Years,  5 * Years,  6 * Years,  7 * Years,</div>
<div class="line"><span class="lineno"> 4450</span>                          8 * Years, 9 * Years, 10 * Years, 12 * Years, 15 * Years, 20 * Years, 30 * Years };</div>
<div class="line"><span class="lineno"> 4451</span> </div>
<div class="line"><span class="lineno"> 4452</span>    std::vector&lt;boost::shared_ptr&lt;BlackCalibrationHelper&gt; &gt; cpiHelpers;</div>
<div class="line"><span class="lineno"> 4453</span>    Array volStepTimes(13), noTimes(0);</div>
<div class="line"><span class="lineno"> 4454</span>    Array infVols(14, 0.0030), infRev(14, 1.0); <span class="comment">// init vol and rev !!</span></div>
<div class="line"><span class="lineno"> 4455</span>    Real strike = 0.00;                         <span class="comment">// strike !!</span></div>
<div class="line"><span class="lineno"> 4456</span> </div>
<div class="line"><span class="lineno"> 4457</span>    Time T = Null&lt;Time&gt;();</div>
<div class="line"><span class="lineno"> 4458</span>    <span class="keywordflow">for</span> (Size i = 1; i &lt;= nMat; ++i) {</div>
<div class="line"><span class="lineno"> 4459</span>        Date mat = refDate + maturity[i - 1];</div>
<div class="line"><span class="lineno"> 4460</span>        boost::shared_ptr&lt;CpiCapFloorHelper&gt; h(<span class="keyword">new</span> <a class="code hl_class" href="class_quant_ext_1_1_cpi_cap_floor_helper.html">CpiCapFloorHelper</a>(Option::Put, baseCPI, mat, TARGET(),</div>
<div class="line"><span class="lineno"> 4461</span>                                                                     ModifiedFollowing, TARGET(), ModifiedFollowing,</div>
<div class="line"><span class="lineno"> 4462</span>                                                                     strike, infIndex, 3 * Months, premium[i - 1]));</div>
<div class="line"><span class="lineno"> 4463</span>        Real t = inflationYearFraction(Monthly, <span class="keyword">false</span>, Actual365Fixed(), infEurTs-&gt;baseDate(),</div>
<div class="line"><span class="lineno"> 4464</span>                                       h-&gt;instrument()-&gt;fixingDate());</div>
<div class="line"><span class="lineno"> 4465</span>        cpiHelpers.push_back(h);</div>
<div class="line"><span class="lineno"> 4466</span>        <span class="keywordflow">if</span> (i &lt;= nMat - 1)</div>
<div class="line"><span class="lineno"> 4467</span>            volStepTimes[i - 1] = t;</div>
<div class="line"><span class="lineno"> 4468</span>        T = t;</div>
<div class="line"><span class="lineno"> 4469</span>    }</div>
<div class="line"><span class="lineno"> 4470</span> </div>
<div class="line"><span class="lineno"> 4471</span>    boost::shared_ptr&lt;InfDkPiecewiseLinearParametrization&gt; infeur_p =</div>
<div class="line"><span class="lineno"> 4472</span>        boost::make_shared&lt;InfDkPiecewiseLinearParametrization&gt;(EURCurrency(), infEurTs, volStepTimes, infVols,</div>
<div class="line"><span class="lineno"> 4473</span>                                                                volStepTimes, infRev);</div>
<div class="line"><span class="lineno"> 4474</span> </div>
<div class="line"><span class="lineno"> 4475</span>    std::vector&lt;boost::shared_ptr&lt;Parametrization&gt; &gt; parametrizations;</div>
<div class="line"><span class="lineno"> 4476</span>    parametrizations.push_back(ireur_p);</div>
<div class="line"><span class="lineno"> 4477</span>    parametrizations.push_back(infeur_p);</div>
<div class="line"><span class="lineno"> 4478</span> </div>
<div class="line"><span class="lineno"> 4479</span>    boost::shared_ptr&lt;CrossAssetModel&gt; model =</div>
<div class="line"><span class="lineno"> 4480</span>        boost::make_shared&lt;CrossAssetModel&gt;(parametrizations, Matrix(), SalvagingAlgorithm::None);</div>
<div class="line"><span class="lineno"> 4481</span> </div>
<div class="line"><span class="lineno"> 4482</span>    model-&gt;correlation(CrossAssetModel::AssetType::IR, 0, CrossAssetModel::AssetType::INF, 0, 0.33);</div>
<div class="line"><span class="lineno"> 4483</span> </div>
<div class="line"><span class="lineno"> 4484</span>    <span class="comment">// pricing engine</span></div>
<div class="line"><span class="lineno"> 4485</span>    boost::shared_ptr&lt;AnalyticDkCpiCapFloorEngine&gt; engine =</div>
<div class="line"><span class="lineno"> 4486</span>        boost::make_shared&lt;AnalyticDkCpiCapFloorEngine&gt;(model, 0, baseCPI);</div>
<div class="line"><span class="lineno"> 4487</span> </div>
<div class="line"><span class="lineno"> 4488</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; cpiHelpers.size(); ++i) {</div>
<div class="line"><span class="lineno"> 4489</span>        cpiHelpers[i]-&gt;setPricingEngine(engine);</div>
<div class="line"><span class="lineno"> 4490</span>    }</div>
<div class="line"><span class="lineno"> 4491</span> </div>
<div class="line"><span class="lineno"> 4492</span>    <span class="comment">// calibration</span></div>
<div class="line"><span class="lineno"> 4493</span>    LevenbergMarquardt lm;</div>
<div class="line"><span class="lineno"> 4494</span>    EndCriteria ec(1000, 500, 1E-8, 1E-8, 1E-8);</div>
<div class="line"><span class="lineno"> 4495</span>    <span class="comment">// model-&gt;calibrateInfDkVolatilitiesIterative(0, cpiHelpers, lm, ec);</span></div>
<div class="line"><span class="lineno"> 4496</span>    model-&gt;calibrateInfDkReversionsIterative(0, cpiHelpers, lm, ec);</div>
<div class="line"><span class="lineno"> 4497</span> </div>
<div class="line"><span class="lineno"> 4498</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; cpiHelpers.size(); ++i) {</div>
<div class="line"><span class="lineno"> 4499</span>        BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;i=&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; modelvol=&quot;</span> &lt;&lt; model-&gt;infdk(0)-&gt;parameterValues(0)[i] &lt;&lt; <span class="stringliteral">&quot; modelrev=&quot;</span></div>
<div class="line"><span class="lineno"> 4500</span>                                &lt;&lt; model-&gt;infdk(0)-&gt;parameterValues(1)[i] &lt;&lt; <span class="stringliteral">&quot; market=&quot;</span> &lt;&lt; cpiHelpers[i]-&gt;marketValue()</div>
<div class="line"><span class="lineno"> 4501</span>                                &lt;&lt; <span class="stringliteral">&quot; model=&quot;</span> &lt;&lt; cpiHelpers[i]-&gt;modelValue()</div>
<div class="line"><span class="lineno"> 4502</span>                                &lt;&lt; <span class="stringliteral">&quot; diff=&quot;</span> &lt;&lt; (cpiHelpers[i]-&gt;marketValue() - cpiHelpers[i]-&gt;modelValue()));</div>
<div class="line"><span class="lineno"> 4503</span>    }</div>
<div class="line"><span class="lineno"> 4504</span> </div>
<div class="line"><span class="lineno"> 4505</span>    <span class="comment">// reprice last ZC floor with Monte Carlo</span></div>
<div class="line"><span class="lineno"> 4506</span>    Size n = 100000; <span class="comment">// number of paths</span></div>
<div class="line"><span class="lineno"> 4507</span>    Size seed = 18;  <span class="comment">// rng seed</span></div>
<div class="line"><span class="lineno"> 4508</span>    Size <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a> = 1;  <span class="comment">// number of discretization steps</span></div>
<div class="line"><span class="lineno"> 4509</span> </div>
<div class="line"><span class="lineno"> 4510</span>    boost::shared_ptr&lt;StochasticProcess&gt; process = model-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 4511</span>    LowDiscrepancy::rsg_type sg = LowDiscrepancy::make_sequence_generator(process-&gt;factors() * <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>, seed);</div>
<div class="line"><span class="lineno"> 4512</span>    TimeGrid grid(T, <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>);</div>
<div class="line"><span class="lineno"> 4513</span>    MultiPathGenerator&lt;LowDiscrepancy::rsg_type&gt; pg(process, grid, sg, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 4514</span> </div>
<div class="line"><span class="lineno"> 4515</span>    accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; floor;</div>
<div class="line"><span class="lineno"> 4516</span> </div>
<div class="line"><span class="lineno"> 4517</span>    Real K = std::pow(1.0 + strike, T);</div>
<div class="line"><span class="lineno"> 4518</span> </div>
<div class="line"><span class="lineno"> 4519</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 4520</span>        Sample&lt;MultiPath&gt; path = pg.next();</div>
<div class="line"><span class="lineno"> 4521</span>        Size l = path.value[0].length() - 1;</div>
<div class="line"><span class="lineno"> 4522</span>        Real irz = path.value[0][l];</div>
<div class="line"><span class="lineno"> 4523</span>        Real infz = path.value[1][l];</div>
<div class="line"><span class="lineno"> 4524</span>        Real infy = path.value[2][l];</div>
<div class="line"><span class="lineno"> 4525</span>        Real I = model-&gt;infdkI(0, T, T, infz, infy).first;</div>
<div class="line"><span class="lineno"> 4526</span>        floor(std::max(-(I - K), 0.0) / model-&gt;numeraire(0, T, irz));</div>
<div class="line"><span class="lineno"> 4527</span>    }</div>
<div class="line"><span class="lineno"> 4528</span> </div>
<div class="line"><span class="lineno"> 4529</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;mc (low disc) floor last = &quot;</span> &lt;&lt; mean(floor) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(floor));</div>
<div class="line"><span class="lineno"> 4530</span> </div>
<div class="line"><span class="lineno"> 4531</span>    <span class="comment">// check model calibration</span></div>
<div class="line"><span class="lineno"> 4532</span>    Real tol = 1.0E-12;</div>
<div class="line"><span class="lineno"> 4533</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; cpiHelpers.size(); ++i) {</div>
<div class="line"><span class="lineno"> 4534</span>        <span class="keywordflow">if</span> (std::abs(cpiHelpers[i]-&gt;modelValue() - cpiHelpers[i]-&gt;marketValue()) &gt; tol) {</div>
<div class="line"><span class="lineno"> 4535</span>            BOOST_ERROR(<span class="stringliteral">&quot;Model calibration for ZC CPI Floor #&quot;</span></div>
<div class="line"><span class="lineno"> 4536</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; failed, market premium is &quot;</span> &lt;&lt; cpiHelpers[i]-&gt;marketValue() &lt;&lt; <span class="stringliteral">&quot;, model value is &quot;</span></div>
<div class="line"><span class="lineno"> 4537</span>                        &lt;&lt; cpiHelpers[i]-&gt;modelValue() &lt;&lt; <span class="stringliteral">&quot;, difference is &quot;</span></div>
<div class="line"><span class="lineno"> 4538</span>                        &lt;&lt; (cpiHelpers[i]-&gt;marketValue() - cpiHelpers[i]-&gt;modelValue()) &lt;&lt; <span class="stringliteral">&quot;, tolerance is &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 4539</span>        }</div>
<div class="line"><span class="lineno"> 4540</span>    }</div>
<div class="line"><span class="lineno"> 4541</span>    <span class="comment">// check repricing with MC</span></div>
<div class="line"><span class="lineno"> 4542</span>    tol = 2.0E-4;</div>
<div class="line"><span class="lineno"> 4543</span>    Real mcPrice = mean(floor);</div>
<div class="line"><span class="lineno"> 4544</span>    <span class="keywordflow">if</span> (std::abs(mcPrice - cpiHelpers[nMat - 1]-&gt;modelValue()) &gt; tol) {</div>
<div class="line"><span class="lineno"> 4545</span>        BOOST_ERROR(<span class="stringliteral">&quot;Failed to reprice last ZC CPI Floor with MC (&quot;</span></div>
<div class="line"><span class="lineno"> 4546</span>                    &lt;&lt; mcPrice &lt;&lt; <span class="stringliteral">&quot;), analytical model price is &quot;</span> &lt;&lt; cpiHelpers[nMat - 1]-&gt;modelValue()</div>
<div class="line"><span class="lineno"> 4547</span>                    &lt;&lt; <span class="stringliteral">&quot;, difference is &quot;</span> &lt;&lt; mcPrice - cpiHelpers[nMat - 1]-&gt;modelValue() &lt;&lt; <span class="stringliteral">&quot;, tolerance is &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 4548</span>    }</div>
<div class="line"><span class="lineno"> 4549</span>} <span class="comment">// testCpiCalibrationByH</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a36e1a4d58e785be16c1670dad9566928" name="a36e1a4d58e785be16c1670dad9566928"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36e1a4d58e785be16c1670dad9566928">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[24/24]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCrCalibration&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l04551">4551</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 4551</span>                                        {</div>
<div class="line"><span class="lineno"> 4552</span> </div>
<div class="line"><span class="lineno"> 4553</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing calibration to CDS Options and repricing via MC...&quot;</span>);</div>
<div class="line"><span class="lineno"> 4554</span> </div>
<div class="line"><span class="lineno"> 4555</span>    <span class="comment">// set up IR-CR model, calibrate to given CDS Options and check</span></div>
<div class="line"><span class="lineno"> 4556</span>    <span class="comment">// the result with a MC simulation</span></div>
<div class="line"><span class="lineno"> 4557</span> </div>
<div class="line"><span class="lineno"> 4558</span>    SavedSettings backup;</div>
<div class="line"><span class="lineno"> 4559</span>    Date refDate(30, July, 2015);</div>
<div class="line"><span class="lineno"> 4560</span>    Settings::instance().evaluationDate() = Date(30, July, 2015);</div>
<div class="line"><span class="lineno"> 4561</span> </div>
<div class="line"><span class="lineno"> 4562</span>    <span class="comment">// IR (zero vol)</span></div>
<div class="line"><span class="lineno"> 4563</span>    Handle&lt;YieldTermStructure&gt; eurYts(boost::make_shared&lt;FlatForward&gt;(refDate, 0.01, Actual365Fixed()));</div>
<div class="line"><span class="lineno"> 4564</span>    boost::shared_ptr&lt;Parametrization&gt; ireur_p =</div>
<div class="line"><span class="lineno"> 4565</span>        boost::make_shared&lt;IrLgm1fConstantParametrization&gt;(EURCurrency(), eurYts, 0.00, 0.01);</div>
<div class="line"><span class="lineno"> 4566</span> </div>
<div class="line"><span class="lineno"> 4567</span>    <span class="comment">// CR</span></div>
<div class="line"><span class="lineno"> 4568</span>    Handle&lt;DefaultProbabilityTermStructure&gt; prob(boost::make_shared&lt;FlatHazardRate&gt;(refDate, 0.01, Actual365Fixed()));</div>
<div class="line"><span class="lineno"> 4569</span> </div>
<div class="line"><span class="lineno"> 4570</span>    Size nMat = 10;</div>
<div class="line"><span class="lineno"> 4571</span>    Real impliedVols[] = { 0.10, 0.12, 0.14, 0.16, 0.18, 0.2, 0.21, 0.215, 0.22, 0.225 };</div>
<div class="line"><span class="lineno"> 4572</span>    Period maturity[] = { 1 * Years, 2 * Years, 3 * Years, 4 * Years, 5 * Years,</div>
<div class="line"><span class="lineno"> 4573</span>                          6 * Years, 7 * Years, 8 * Years, 9 * Years, 10 * Years };</div>
<div class="line"><span class="lineno"> 4574</span> </div>
<div class="line"><span class="lineno"> 4575</span>    std::vector&lt;boost::shared_ptr&lt;BlackCalibrationHelper&gt; &gt; cdsoHelpers;</div>
<div class="line"><span class="lineno"> 4576</span>    Array volStepTimes(nMat - 1), noTimes(0);</div>
<div class="line"><span class="lineno"> 4577</span>    Array crVols(nMat, 0.0030), crRev(nMat, 0.01); <span class="comment">// init vol and rev</span></div>
<div class="line"><span class="lineno"> 4578</span> </div>
<div class="line"><span class="lineno"> 4579</span>    Time T = Null&lt;Time&gt;();</div>
<div class="line"><span class="lineno"> 4580</span>    Date lastMat;</div>
<div class="line"><span class="lineno"> 4581</span>    <span class="keywordflow">for</span> (Size i = 1; i &lt;= nMat; ++i) {</div>
<div class="line"><span class="lineno"> 4582</span>        Date mat = refDate + maturity[i - 1];</div>
<div class="line"><span class="lineno"> 4583</span>        Schedule schedule(mat, mat + 10 * Years, 3 * Months, TARGET(), Following, Following, DateGeneration::CDS,</div>
<div class="line"><span class="lineno"> 4584</span>                          <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 4585</span>        <span class="comment">// ensure that cds starts after option expiry</span></div>
<div class="line"><span class="lineno"> 4586</span>        <span class="keywordflow">if</span> (schedule.date(0) &lt; mat)</div>
<div class="line"><span class="lineno"> 4587</span>            schedule = Schedule(schedule.date(1), mat + 10 * Years, 3 * Months, TARGET(), Following, Following,</div>
<div class="line"><span class="lineno"> 4588</span>                                DateGeneration::CDS, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 4589</span>        QL_REQUIRE(schedule.date(0) &gt;= mat,</div>
<div class="line"><span class="lineno"> 4590</span>                   <span class="stringliteral">&quot;CDS start (&quot;</span> &lt;&lt; schedule.date(0) &lt;&lt; <span class="stringliteral">&quot;) should be on or after option maturity (&quot;</span> &lt;&lt; mat &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno"> 4591</span>        boost::shared_ptr&lt;CdsOptionHelper&gt; h(</div>
<div class="line"><span class="lineno"> 4592</span>            <span class="keyword">new</span> <a class="code hl_class" href="class_quant_ext_1_1_cds_option_helper.html">CdsOptionHelper</a>(mat, Handle&lt;Quote&gt;(boost::make_shared&lt;SimpleQuote&gt;(impliedVols[i - 1])),</div>
<div class="line"><span class="lineno"> 4593</span>                                Protection::Buyer, schedule, Following, Actual360(), prob, 0.4, eurYts));</div>
<div class="line"><span class="lineno"> 4594</span>        Real t = eurYts-&gt;timeFromReference(mat);</div>
<div class="line"><span class="lineno"> 4595</span>        cdsoHelpers.push_back(h);</div>
<div class="line"><span class="lineno"> 4596</span>        <span class="keywordflow">if</span> (i &lt;= nMat - 1)</div>
<div class="line"><span class="lineno"> 4597</span>            volStepTimes[i - 1] = t;</div>
<div class="line"><span class="lineno"> 4598</span>        T = t;</div>
<div class="line"><span class="lineno"> 4599</span>        lastMat = mat;</div>
<div class="line"><span class="lineno"> 4600</span>    }</div>
<div class="line"><span class="lineno"> 4601</span> </div>
<div class="line"><span class="lineno"> 4602</span>    boost::shared_ptr&lt;CrLgm1fPiecewiseConstantParametrization&gt; creur_p =</div>
<div class="line"><span class="lineno"> 4603</span>        boost::make_shared&lt;CrLgm1fPiecewiseConstantParametrization&gt;(EURCurrency(), prob, volStepTimes, crVols,</div>
<div class="line"><span class="lineno"> 4604</span>                                                                    volStepTimes, crRev);</div>
<div class="line"><span class="lineno"> 4605</span> </div>
<div class="line"><span class="lineno"> 4606</span>    std::vector&lt;boost::shared_ptr&lt;Parametrization&gt; &gt; parametrizations;</div>
<div class="line"><span class="lineno"> 4607</span>    parametrizations.push_back(ireur_p);</div>
<div class="line"><span class="lineno"> 4608</span>    parametrizations.push_back(creur_p);</div>
<div class="line"><span class="lineno"> 4609</span> </div>
<div class="line"><span class="lineno"> 4610</span>    boost::shared_ptr&lt;CrossAssetModel&gt; model =</div>
<div class="line"><span class="lineno"> 4611</span>        boost::make_shared&lt;CrossAssetModel&gt;(parametrizations, Matrix(), SalvagingAlgorithm::None);</div>
<div class="line"><span class="lineno"> 4612</span> </div>
<div class="line"><span class="lineno"> 4613</span>    model-&gt;correlation(CrossAssetModel::AssetType::IR, 0, CrossAssetModel::AssetType::CR, 0, 0.33);</div>
<div class="line"><span class="lineno"> 4614</span> </div>
<div class="line"><span class="lineno"> 4615</span>    <span class="comment">// pricing engine</span></div>
<div class="line"><span class="lineno"> 4616</span>    boost::shared_ptr&lt;AnalyticLgmCdsOptionEngine&gt; engine =</div>
<div class="line"><span class="lineno"> 4617</span>        boost::make_shared&lt;AnalyticLgmCdsOptionEngine&gt;(model, 0, 0, 0.4);</div>
<div class="line"><span class="lineno"> 4618</span> </div>
<div class="line"><span class="lineno"> 4619</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; cdsoHelpers.size(); ++i) {</div>
<div class="line"><span class="lineno"> 4620</span>        cdsoHelpers[i]-&gt;setPricingEngine(engine);</div>
<div class="line"><span class="lineno"> 4621</span>    }</div>
<div class="line"><span class="lineno"> 4622</span> </div>
<div class="line"><span class="lineno"> 4623</span>    <span class="comment">// calibration</span></div>
<div class="line"><span class="lineno"> 4624</span>    LevenbergMarquardt lm;</div>
<div class="line"><span class="lineno"> 4625</span>    EndCriteria ec(1000, 500, 1E-8, 1E-8, 1E-8);</div>
<div class="line"><span class="lineno"> 4626</span>    model-&gt;calibrateCrLgm1fVolatilitiesIterative(0, cdsoHelpers, lm, ec);</div>
<div class="line"><span class="lineno"> 4627</span> </div>
<div class="line"><span class="lineno"> 4628</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; cdsoHelpers.size(); ++i) {</div>
<div class="line"><span class="lineno"> 4629</span>        BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;i=&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; modelvol=&quot;</span> &lt;&lt; model-&gt;crlgm1f(0)-&gt;parameterValues(0)[i]</div>
<div class="line"><span class="lineno"> 4630</span>                                &lt;&lt; <span class="stringliteral">&quot; modelrev=&quot;</span> &lt;&lt; model-&gt;crlgm1f(0)-&gt;parameterValues(1)[i] &lt;&lt; <span class="stringliteral">&quot; market=&quot;</span></div>
<div class="line"><span class="lineno"> 4631</span>                                &lt;&lt; cdsoHelpers[i]-&gt;marketValue() &lt;&lt; <span class="stringliteral">&quot; model=&quot;</span> &lt;&lt; cdsoHelpers[i]-&gt;modelValue()</div>
<div class="line"><span class="lineno"> 4632</span>                                &lt;&lt; <span class="stringliteral">&quot; diff=&quot;</span> &lt;&lt; (cdsoHelpers[i]-&gt;marketValue() - cdsoHelpers[i]-&gt;modelValue()));</div>
<div class="line"><span class="lineno"> 4633</span>    }</div>
<div class="line"><span class="lineno"> 4634</span> </div>
<div class="line"><span class="lineno"> 4635</span>    <span class="comment">// check model calibration</span></div>
<div class="line"><span class="lineno"> 4636</span>    Real tol = 1.0E-12;</div>
<div class="line"><span class="lineno"> 4637</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; cdsoHelpers.size(); ++i) {</div>
<div class="line"><span class="lineno"> 4638</span>        <span class="keywordflow">if</span> (std::abs(cdsoHelpers[i]-&gt;modelValue() - cdsoHelpers[i]-&gt;marketValue()) &gt; tol) {</div>
<div class="line"><span class="lineno"> 4639</span>            BOOST_ERROR(<span class="stringliteral">&quot;Model calibration for CDSO #&quot;</span></div>
<div class="line"><span class="lineno"> 4640</span>                        &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; failed, market premium is &quot;</span> &lt;&lt; cdsoHelpers[i]-&gt;marketValue() &lt;&lt; <span class="stringliteral">&quot;, model value is &quot;</span></div>
<div class="line"><span class="lineno"> 4641</span>                        &lt;&lt; cdsoHelpers[i]-&gt;modelValue() &lt;&lt; <span class="stringliteral">&quot;, difference is &quot;</span></div>
<div class="line"><span class="lineno"> 4642</span>                        &lt;&lt; (cdsoHelpers[i]-&gt;marketValue() - cdsoHelpers[i]-&gt;modelValue()) &lt;&lt; <span class="stringliteral">&quot;, tolerance is &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 4643</span>        }</div>
<div class="line"><span class="lineno"> 4644</span>    }</div>
<div class="line"><span class="lineno"> 4645</span> </div>
<div class="line"><span class="lineno"> 4646</span>    Real lastModelValue = cdsoHelpers[nMat - 1]-&gt;modelValue();</div>
<div class="line"><span class="lineno"> 4647</span> </div>
<div class="line"><span class="lineno"> 4648</span>    <span class="comment">// reprice last CDSO with Monte Carlo</span></div>
<div class="line"><span class="lineno"> 4649</span>    <span class="comment">// note that the IR vol is zero (same as assumption in CDSO analytic engine)</span></div>
<div class="line"><span class="lineno"> 4650</span>    Size n = 10000; <span class="comment">// number of paths</span></div>
<div class="line"><span class="lineno"> 4651</span>    Size seed = 18;  <span class="comment">// rng seed</span></div>
<div class="line"><span class="lineno"> 4652</span>    Size <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a> = 1;  <span class="comment">// number of discretization steps</span></div>
<div class="line"><span class="lineno"> 4653</span> </div>
<div class="line"><span class="lineno"> 4654</span>    boost::shared_ptr&lt;StochasticProcess&gt; process = model-&gt;stateProcess();</div>
<div class="line"><span class="lineno"> 4655</span>    LowDiscrepancy::rsg_type sg = LowDiscrepancy::make_sequence_generator(process-&gt;factors() * <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>, seed);</div>
<div class="line"><span class="lineno"> 4656</span>    TimeGrid grid(T, <a class="code hl_variable" href="test_2commodityschwartzmodel_8cpp.html#a84e1cc7fe4440301cfe72e7c64be988b">steps</a>);</div>
<div class="line"><span class="lineno"> 4657</span>    MultiPathGenerator&lt;LowDiscrepancy::rsg_type&gt; pg(process, grid, sg, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 4658</span> </div>
<div class="line"><span class="lineno"> 4659</span>    accumulator_set&lt;double, stats&lt;tag::mean, tag::error_of&lt;tag::mean&gt; &gt; &gt; cdso;</div>
<div class="line"><span class="lineno"> 4660</span> </div>
<div class="line"><span class="lineno"> 4661</span>    boost::shared_ptr&lt;CreditDefaultSwap&gt; underlying =</div>
<div class="line"><span class="lineno"> 4662</span>        boost::static_pointer_cast&lt;CdsOptionHelper&gt;(cdsoHelpers.back())-&gt;underlying();</div>
<div class="line"><span class="lineno"> 4663</span>    Real K = underlying-&gt;fairSpreadClean();</div>
<div class="line"><span class="lineno"> 4664</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Last CDSO fair spread is &quot;</span> &lt;&lt; K);</div>
<div class="line"><span class="lineno"> 4665</span> </div>
<div class="line"><span class="lineno"> 4666</span>    Settings::instance().evaluationDate() = lastMat;</div>
<div class="line"><span class="lineno"> 4667</span>    boost::shared_ptr&lt;LgmImpliedDefaultTermStructure&gt; probMc =</div>
<div class="line"><span class="lineno"> 4668</span>        boost::make_shared&lt;LgmImpliedDefaultTermStructure&gt;(model, 0, 0);</div>
<div class="line"><span class="lineno"> 4669</span>    boost::shared_ptr&lt;LgmImpliedYieldTermStructure&gt; ytsMc =</div>
<div class="line"><span class="lineno"> 4670</span>        boost::make_shared&lt;LgmImpliedYieldTermStructure&gt;(model-&gt;lgm(0));</div>
<div class="line"><span class="lineno"> 4671</span>    boost::shared_ptr&lt;QuantExt::MidPointCdsEngine&gt; dynamicEngine = boost::make_shared&lt;QuantExt::MidPointCdsEngine&gt;(</div>
<div class="line"><span class="lineno"> 4672</span>        Handle&lt;DefaultProbabilityTermStructure&gt;(probMc), 0.4, Handle&lt;YieldTermStructure&gt;(ytsMc));</div>
<div class="line"><span class="lineno"> 4673</span>    underlying-&gt;setPricingEngine(dynamicEngine);</div>
<div class="line"><span class="lineno"> 4674</span> </div>
<div class="line"><span class="lineno"> 4675</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 4676</span>        Sample&lt;MultiPath&gt; path = pg.next();</div>
<div class="line"><span class="lineno"> 4677</span>        Size l = path.value[0].length() - 1;</div>
<div class="line"><span class="lineno"> 4678</span>        Real irz = path.value[0][l];</div>
<div class="line"><span class="lineno"> 4679</span>        Real crz = path.value[1][l];</div>
<div class="line"><span class="lineno"> 4680</span>        Real cry = path.value[2][l];</div>
<div class="line"><span class="lineno"> 4681</span>        probMc-&gt;move(lastMat, crz, cry);</div>
<div class="line"><span class="lineno"> 4682</span>        ytsMc-&gt;move(lastMat, irz);</div>
<div class="line"><span class="lineno"> 4683</span>        Real surv = model-&gt;crlgm1fS(0, 0, T, T, crz, cry).first;</div>
<div class="line"><span class="lineno"> 4684</span>        Real npv = surv * std::max(underlying-&gt;NPV(), 0.0) / model-&gt;numeraire(0, T, irz);</div>
<div class="line"><span class="lineno"> 4685</span>        cdso(npv);</div>
<div class="line"><span class="lineno"> 4686</span>    }</div>
<div class="line"><span class="lineno"> 4687</span> </div>
<div class="line"><span class="lineno"> 4688</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;mc (low disc) cdso last = &quot;</span> &lt;&lt; mean(cdso) &lt;&lt; <span class="stringliteral">&quot; +- &quot;</span> &lt;&lt; error_of&lt;tag::mean&gt;(cdso));</div>
<div class="line"><span class="lineno"> 4689</span> </div>
<div class="line"><span class="lineno"> 4690</span>    <span class="comment">// check repricing with MC</span></div>
<div class="line"><span class="lineno"> 4691</span>    tol = 3.0E-4;</div>
<div class="line"><span class="lineno"> 4692</span>    Real mcPrice = mean(cdso);</div>
<div class="line"><span class="lineno"> 4693</span>    <span class="keywordflow">if</span> (std::abs(mcPrice - lastModelValue) &gt; tol) {</div>
<div class="line"><span class="lineno"> 4694</span>        BOOST_ERROR(<span class="stringliteral">&quot;Failed to reprice last CDSO with MC (&quot;</span> &lt;&lt; mcPrice &lt;&lt; <span class="stringliteral">&quot;), analytical model price is &quot;</span></div>
<div class="line"><span class="lineno"> 4695</span>                                                            &lt;&lt; lastModelValue &lt;&lt; <span class="stringliteral">&quot;, difference is &quot;</span></div>
<div class="line"><span class="lineno"> 4696</span>                                                            &lt;&lt; mcPrice - lastModelValue &lt;&lt; <span class="stringliteral">&quot;, tolerance is &quot;</span> &lt;&lt; tol);</div>
<div class="line"><span class="lineno"> 4697</span>    }</div>
<div class="line"><span class="lineno"> 4698</span>} <span class="comment">// testCrCalibration</span></div>
<div class="ttc" id="aclass_quant_ext_1_1_cds_option_helper_html"><div class="ttname"><a href="class_quant_ext_1_1_cds_option_helper.html">QuantExt::CdsOptionHelper</a></div><div class="ttdoc">CDS option helper.</div><div class="ttdef"><b>Definition:</b> <a href="cdsoptionhelper_8hpp_source.html#l00039">cdsoptionhelper.hpp:39</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="aa848a14c24baafa9e714abd087d2062b" name="aa848a14c24baafa9e714abd087d2062b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa848a14c24baafa9e714abd087d2062b">&#9670;&#160;</a></span>infEurFlags</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt;<a class="el" href="classbool.html">bool</a>&gt; infEurFlags { true, false }</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l02255">2255</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>

</div>
</div>
<a id="aabb2919210687ea5ff99ba34f08dd185" name="aabb2919210687ea5ff99ba34f08dd185"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabb2919210687ea5ff99ba34f08dd185">&#9670;&#160;</a></span>infGbpFlags</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt;<a class="el" href="classbool.html">bool</a>&gt; infGbpFlags { true, false }</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l02256">2256</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>

</div>
</div>
<a id="a6cd3e0f20d5d2ffb978002d671c329dc" name="a6cd3e0f20d5d2ffb978002d671c329dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6cd3e0f20d5d2ffb978002d671c329dc">&#9670;&#160;</a></span>flatVolsFlags</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt;<a class="el" href="classbool.html">bool</a>&gt; flatVolsFlags { true, false }</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l02257">2257</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>

</div>
</div>
<a id="a2c026c3769e1c51837f568ca6099e729" name="a2c026c3769e1c51837f568ca6099e729"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c026c3769e1c51837f568ca6099e729">&#9670;&#160;</a></span>driftFreeState</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt;<a class="el" href="classbool.html">bool</a>&gt; driftFreeState { true, false }</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2crossassetmodel_8cpp_source.html#l02258">2258</a> of file <a class="el" href="test_2crossassetmodel_8cpp_source.html">crossassetmodel.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.9.5
</small></address>
</body>
</html>
