<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<title>QuantExt: CommodityAveragePriceOptionMonteCarloEngine Class Reference</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="quantextextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-qle@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.8.11</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_quant_ext.html">QuantExt</a></li><li class="navelem"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html">CommodityAveragePriceOptionMonteCarloEngine</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">CommodityAveragePriceOptionMonteCarloEngine Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="commodityapoengine_8hpp_source.html">qle/pricingengines/commodityapoengine.hpp</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for CommodityAveragePriceOptionMonteCarloEngine:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine__inherit__graph.png" border="0" usemap="#a_commodity_average_price_option_monte_carlo_engine_inherit__map" alt="Inheritance graph"/></div>
<map name="a_commodity_average_price_option_monte_carlo_engine_inherit__map" id="a_commodity_average_price_option_monte_carlo_engine_inherit__map">
<area shape="rect" title=" " alt="" coords="5,504,223,720"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html" title=" " alt="" coords="5,225,223,456"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_1_1engine.html" title="base class for APO engines" alt="" coords="82,137,146,177"/>
<area shape="rect" title=" " alt="" coords="9,5,219,89"/>
</map>
</div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for CommodityAveragePriceOptionMonteCarloEngine:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine__coll__graph.png" border="0" usemap="#a_commodity_average_price_option_monte_carlo_engine_coll__map" alt="Collaboration graph"/></div>
<map name="a_commodity_average_price_option_monte_carlo_engine_coll__map" id="a_commodity_average_price_option_monte_carlo_engine_coll__map">
<area shape="rect" title=" " alt="" coords="383,520,603,707"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html" title=" " alt="" coords="263,271,483,443"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_1_1engine.html" title="base class for APO engines" alt="" coords="78,146,142,186"/>
<area shape="rect" title=" " alt="" coords="5,5,215,89"/>
<area shape="rect" title=" " alt="" coords="167,139,363,193"/>
<area shape="rect" title=" " alt="" coords="387,139,577,193"/>
<area shape="rect" title=" " alt="" coords="601,146,653,186"/>
<area shape="rect" title=" " alt="" coords="507,337,559,377"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a10e31a0ff05960d4a7cc6e4bcbff9c8c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a10e31a0ff05960d4a7cc6e4bcbff9c8c">CommodityAveragePriceOptionMonteCarloEngine</a> (const QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt; &amp;discountCurve, const QuantLib::Handle&lt; <a class="el" href="class_quant_ext_1_1_black_scholes_model_wrapper.html">QuantExt::BlackScholesModelWrapper</a> &gt; &amp;model, QuantLib::Size samples, QuantLib::Real beta=0.0, const QuantLib::Size seed=42)</td></tr>
<tr class="separator:a10e31a0ff05960d4a7cc6e4bcbff9c8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b639708cc64e74e13f28897f1227911"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a0b639708cc64e74e13f28897f1227911">CommodityAveragePriceOptionMonteCarloEngine</a> (const QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt; &amp;discountCurve, const QuantLib::Handle&lt; QuantLib::BlackVolTermStructure &gt; &amp;vol, QuantLib::Size samples, QuantLib::Real beta=0.0, const QuantLib::Size seed=42)</td></tr>
<tr class="separator:a0b639708cc64e74e13f28897f1227911"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61eb1a24e5329ccc296715a40dc3a19a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a61eb1a24e5329ccc296715a40dc3a19a">calculate</a> () const override</td></tr>
<tr class="separator:a61eb1a24e5329ccc296715a40dc3a19a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html">CommodityAveragePriceOptionBaseEngine</a></td></tr>
<tr class="memitem:a204e4b5c298bad11ebb42de2997dbd9f inherit pub_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a204e4b5c298bad11ebb42de2997dbd9f">CommodityAveragePriceOptionBaseEngine</a> (const QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt; &amp;discountCurve, const QuantLib::Handle&lt; <a class="el" href="class_quant_ext_1_1_black_scholes_model_wrapper.html">QuantExt::BlackScholesModelWrapper</a> &gt; &amp;model, QuantLib::Real beta=0.0)</td></tr>
<tr class="separator:a204e4b5c298bad11ebb42de2997dbd9f inherit pub_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad538d3e8ae3424117e213abca0c6ce1e inherit pub_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#ad538d3e8ae3424117e213abca0c6ce1e">CommodityAveragePriceOptionBaseEngine</a> (const QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt; &amp;discountCurve, const QuantLib::Handle&lt; QuantLib::BlackVolTermStructure &gt; &amp;vol, QuantLib::Real beta=0.0)</td></tr>
<tr class="separator:ad538d3e8ae3424117e213abca0c6ce1e inherit pub_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:afd5666b0370fc81ce72c0833645eead1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#afd5666b0370fc81ce72c0833645eead1">calculateSpot</a> () const</td></tr>
<tr class="memdesc:afd5666b0370fc81ce72c0833645eead1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculations when underlying swap references a commodity spot price.  <a href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#afd5666b0370fc81ce72c0833645eead1">More...</a><br /></td></tr>
<tr class="separator:afd5666b0370fc81ce72c0833645eead1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87188b37db1d513cc5eb95e27fd348bb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a87188b37db1d513cc5eb95e27fd348bb">calculateFuture</a> () const</td></tr>
<tr class="memdesc:a87188b37db1d513cc5eb95e27fd348bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculations when underlying swap references a commodity spot price.  <a href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a87188b37db1d513cc5eb95e27fd348bb">More...</a><br /></td></tr>
<tr class="separator:a87188b37db1d513cc5eb95e27fd348bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4b7be615b2ca6035e9cfcc485f70913"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#ac4b7be615b2ca6035e9cfcc485f70913">setupFuture</a> (std::vector&lt; QuantLib::Real &gt; &amp;outVolatilities, QuantLib::Matrix &amp;outSqrtCorr, std::vector&lt; QuantLib::Real &gt; &amp;outPrices, std::vector&lt; QuantLib::Size &gt; &amp;futureIndex, QuantLib::Real strike) const</td></tr>
<tr class="separator:ac4b7be615b2ca6035e9cfcc485f70913"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7421c745f6f3e419cda0b2f0f774c12"><td class="memItemLeft" align="right" valign="top">std::vector&lt; QuantLib::Real &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#af7421c745f6f3e419cda0b2f0f774c12">timegrid</a> (std::vector&lt; QuantLib::Date &gt; &amp;outDates) const</td></tr>
<tr class="separator:af7421c745f6f3e419cda0b2f0f774c12"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a0564940427ebccf4e19dc86088a087e3"><td class="memItemLeft" align="right" valign="top">QuantLib::Size&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a0564940427ebccf4e19dc86088a087e3">samples_</a></td></tr>
<tr class="separator:a0564940427ebccf4e19dc86088a087e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11ea88b3264366c5ad0da53341c6e4eb"><td class="memItemLeft" align="right" valign="top">QuantLib::Size&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a11ea88b3264366c5ad0da53341c6e4eb">seed_</a></td></tr>
<tr class="separator:a11ea88b3264366c5ad0da53341c6e4eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="inherited" name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pro_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine')"><img src="closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html">CommodityAveragePriceOptionBaseEngine</a></td></tr>
<tr class="memitem:a15d4531a1671fa50a37a7a1e4a813131 inherit pro_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memItemLeft" align="right" valign="top">QuantLib::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a15d4531a1671fa50a37a7a1e4a813131">rho</a> (const QuantLib::Date &amp;ed_1, const QuantLib::Date &amp;ed_2) const</td></tr>
<tr class="memdesc:a15d4531a1671fa50a37a7a1e4a813131 inherit pro_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the correlation between two future expiry dates <code>ed_1</code> and <code>ed_2</code>.  <a href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a15d4531a1671fa50a37a7a1e4a813131">More...</a><br /></td></tr>
<tr class="separator:a15d4531a1671fa50a37a7a1e4a813131 inherit pro_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a630a65e63c0b64e74235e40aaf4ca363 inherit pro_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a630a65e63c0b64e74235e40aaf4ca363">isModelDependent</a> () const</td></tr>
<tr class="separator:a630a65e63c0b64e74235e40aaf4ca363 inherit pro_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03d74db999034464e3c0882f231cd0de inherit pro_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a> (const Real price, const <a class="el" href="classbool.html">bool</a> logPrice) const</td></tr>
<tr class="separator:a03d74db999034464e3c0882f231cd0de inherit pro_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e22d4fdcfa7ae24723755165c4d0b2f inherit pro_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a9e22d4fdcfa7ae24723755165c4d0b2f">alive</a> (const <a class="el" href="classbool.html">bool</a> <a class="el" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a>) const</td></tr>
<tr class="separator:a9e22d4fdcfa7ae24723755165c4d0b2f inherit pro_methods_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_attribs_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_class_quant_ext_1_1_commodity_average_price_option_base_engine')"><img src="closed.png" alt="-"/>&#160;Protected Attributes inherited from <a class="el" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html">CommodityAveragePriceOptionBaseEngine</a></td></tr>
<tr class="memitem:a633a2f63e35f5d5b6ec5b92ea38709ae inherit pro_attribs_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memItemLeft" align="right" valign="top">QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a633a2f63e35f5d5b6ec5b92ea38709ae">discountCurve_</a></td></tr>
<tr class="separator:a633a2f63e35f5d5b6ec5b92ea38709ae inherit pro_attribs_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7bb1cfe348f1597abca4cf086bf907b1 inherit pro_attribs_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memItemLeft" align="right" valign="top">QuantLib::Handle&lt; QuantLib::BlackVolTermStructure &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a7bb1cfe348f1597abca4cf086bf907b1">volStructure_</a></td></tr>
<tr class="separator:a7bb1cfe348f1597abca4cf086bf907b1 inherit pro_attribs_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae10f34142aa6043ea12e0445fa2cf304 inherit pro_attribs_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memItemLeft" align="right" valign="top">QuantLib::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#ae10f34142aa6043ea12e0445fa2cf304">beta_</a></td></tr>
<tr class="separator:ae10f34142aa6043ea12e0445fa2cf304 inherit pro_attribs_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75be6235d3655680eb1ded11061299a7 inherit pro_attribs_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memItemLeft" align="right" valign="top">QuantLib::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a75be6235d3655680eb1ded11061299a7">logBarrier_</a></td></tr>
<tr class="separator:a75be6235d3655680eb1ded11061299a7 inherit pro_attribs_class_quant_ext_1_1_commodity_average_price_option_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Commodity APO Monte Carlo Engine Monte Carlo implementation of the APO payoff Reference: Iain Clark, Commodity Option Pricing, Wiley, section 2.7.4, equations (2.118) and (2.126) </p>

<p class="definition">Definition at line <a class="el" href="commodityapoengine_8hpp_source.html#l00124">124</a> of file <a class="el" href="commodityapoengine_8hpp_source.html">commodityapoengine.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a10e31a0ff05960d4a7cc6e4bcbff9c8c" name="a10e31a0ff05960d4a7cc6e4bcbff9c8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10e31a0ff05960d4a7cc6e4bcbff9c8c">&#9670;&#160;</a></span>CommodityAveragePriceOptionMonteCarloEngine() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html">CommodityAveragePriceOptionMonteCarloEngine</a> </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt; &amp;&#160;</td>
          <td class="paramname"><em>discountCurve</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const QuantLib::Handle&lt; <a class="el" href="class_quant_ext_1_1_black_scholes_model_wrapper.html">QuantExt::BlackScholesModelWrapper</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Size&#160;</td>
          <td class="paramname"><em>samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Real&#160;</td>
          <td class="paramname"><em>beta</em> = <code>0.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const QuantLib::Size&#160;</td>
          <td class="paramname"><em>seed</em> = <code>42</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityapoengine_8hpp_source.html#l00126">126</a> of file <a class="el" href="commodityapoengine_8hpp_source.html">commodityapoengine.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  130</span>        : <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a204e4b5c298bad11ebb42de2997dbd9f">CommodityAveragePriceOptionBaseEngine</a>(discountCurve, model, beta), <a class="code hl_variable" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a0564940427ebccf4e19dc86088a087e3">samples_</a>(samples), <a class="code hl_variable" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a11ea88b3264366c5ad0da53341c6e4eb">seed_</a>(seed) {}</div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_average_price_option_base_engine_html_a204e4b5c298bad11ebb42de2997dbd9f"><div class="ttname"><a href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a204e4b5c298bad11ebb42de2997dbd9f">QuantExt::CommodityAveragePriceOptionBaseEngine::CommodityAveragePriceOptionBaseEngine</a></div><div class="ttdeci">CommodityAveragePriceOptionBaseEngine(const QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt; &amp;discountCurve, const QuantLib::Handle&lt; QuantExt::BlackScholesModelWrapper &gt; &amp;model, QuantLib::Real beta=0.0)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_html_a0564940427ebccf4e19dc86088a087e3"><div class="ttname"><a href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a0564940427ebccf4e19dc86088a087e3">QuantExt::CommodityAveragePriceOptionMonteCarloEngine::samples_</a></div><div class="ttdeci">QuantLib::Size samples_</div><div class="ttdef"><b>Definition:</b> <a href="commodityapoengine_8hpp_source.html#l00166">commodityapoengine.hpp:166</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_html_a11ea88b3264366c5ad0da53341c6e4eb"><div class="ttname"><a href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a11ea88b3264366c5ad0da53341c6e4eb">QuantExt::CommodityAveragePriceOptionMonteCarloEngine::seed_</a></div><div class="ttdeci">QuantLib::Size seed_</div><div class="ttdef"><b>Definition:</b> <a href="commodityapoengine_8hpp_source.html#l00167">commodityapoengine.hpp:167</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0b639708cc64e74e13f28897f1227911" name="a0b639708cc64e74e13f28897f1227911"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b639708cc64e74e13f28897f1227911">&#9670;&#160;</a></span>CommodityAveragePriceOptionMonteCarloEngine() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html">CommodityAveragePriceOptionMonteCarloEngine</a> </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt; &amp;&#160;</td>
          <td class="paramname"><em>discountCurve</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const QuantLib::Handle&lt; QuantLib::BlackVolTermStructure &gt; &amp;&#160;</td>
          <td class="paramname"><em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Size&#160;</td>
          <td class="paramname"><em>samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Real&#160;</td>
          <td class="paramname"><em>beta</em> = <code>0.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const QuantLib::Size&#160;</td>
          <td class="paramname"><em>seed</em> = <code>42</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityapoengine_8hpp_source.html#l00133">133</a> of file <a class="el" href="commodityapoengine_8hpp_source.html">commodityapoengine.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  137</span>        : <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a204e4b5c298bad11ebb42de2997dbd9f">CommodityAveragePriceOptionBaseEngine</a>(discountCurve, vol, beta), <a class="code hl_variable" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a0564940427ebccf4e19dc86088a087e3">samples_</a>(samples), <a class="code hl_variable" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a11ea88b3264366c5ad0da53341c6e4eb">seed_</a>(seed) {}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a61eb1a24e5329ccc296715a40dc3a19a" name="a61eb1a24e5329ccc296715a40dc3a19a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61eb1a24e5329ccc296715a40dc3a19a">&#9670;&#160;</a></span>calculate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calculate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityapoengine_8cpp_source.html#l00312">312</a> of file <a class="el" href="commodityapoengine_8cpp_source.html">commodityapoengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  312</span>                                                                  {</div>
<div class="line"><span class="lineno">  313</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a630a65e63c0b64e74235e40aaf4ca363">isModelDependent</a>()) {</div>
<div class="line"><span class="lineno">  314</span>        <span class="comment">// Switch implementation depending on whether underlying swap references a spot or future price</span></div>
<div class="line"><span class="lineno">  315</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;useFuturePrice()) {</div>
<div class="line"><span class="lineno">  316</span>            <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a87188b37db1d513cc5eb95e27fd348bb">calculateFuture</a>();</div>
<div class="line"><span class="lineno">  317</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  318</span>            <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#afd5666b0370fc81ce72c0833645eead1">calculateSpot</a>();</div>
<div class="line"><span class="lineno">  319</span>        }</div>
<div class="line"><span class="lineno">  320</span>    }</div>
<div class="line"><span class="lineno">  321</span>}</div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_average_price_option_base_engine_html_a630a65e63c0b64e74235e40aaf4ca363"><div class="ttname"><a href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a630a65e63c0b64e74235e40aaf4ca363">QuantExt::CommodityAveragePriceOptionBaseEngine::isModelDependent</a></div><div class="ttdeci">bool isModelDependent() const</div><div class="ttdef"><b>Definition:</b> <a href="commodityapoengine_8cpp_source.html#l00165">commodityapoengine.cpp:165</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_html_a87188b37db1d513cc5eb95e27fd348bb"><div class="ttname"><a href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a87188b37db1d513cc5eb95e27fd348bb">QuantExt::CommodityAveragePriceOptionMonteCarloEngine::calculateFuture</a></div><div class="ttdeci">void calculateFuture() const</div><div class="ttdoc">Calculations when underlying swap references a commodity spot price.</div><div class="ttdef"><b>Definition:</b> <a href="commodityapoengine_8cpp_source.html#l00421">commodityapoengine.cpp:421</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_html_afd5666b0370fc81ce72c0833645eead1"><div class="ttname"><a href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#afd5666b0370fc81ce72c0833645eead1">QuantExt::CommodityAveragePriceOptionMonteCarloEngine::calculateSpot</a></div><div class="ttdeci">void calculateSpot() const</div><div class="ttdoc">Calculations when underlying swap references a commodity spot price.</div><div class="ttdef"><b>Definition:</b> <a href="commodityapoengine_8cpp_source.html#l00323">commodityapoengine.cpp:323</a></div></div>
<div class="ttc" id="atenorbasisswap_8cpp_html_a71b2ce0e52885aca4ce15e1d128b9f56"><div class="ttname"><a href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a></div><div class="ttdeci">Swap::arguments * arguments_</div><div class="ttdef"><b>Definition:</b> <a href="tenorbasisswap_8cpp_source.html#l00059">tenorbasisswap.cpp:59</a></div></div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_a61eb1a24e5329ccc296715a40dc3a19a_cgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_a61eb1a24e5329ccc296715a40dc3a19a_cgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_a61eb1a24e5329ccc296715a40dc3a19a_cgraph" id="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_a61eb1a24e5329ccc296715a40dc3a19a_cgraph">
<area shape="rect" title=" " alt="" coords="5,132,80,157"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a87188b37db1d513cc5eb95e27fd348bb" title="Calculations when underlying swap references a commodity spot price." alt="" coords="171,200,282,225"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#afd5666b0370fc81ce72c0833645eead1" title="Calculations when underlying swap references a commodity spot price." alt="" coords="176,132,277,157"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a630a65e63c0b64e74235e40aaf4ca363" title=" " alt="" coords="128,34,325,89"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a9e22d4fdcfa7ae24723755165c4d0b2f" title=" " alt="" coords="373,250,571,290"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de" title=" " alt="" coords="619,164,816,218"/>
<area shape="rect" href="namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1" title=" " alt="" coords="417,49,527,74"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#ac4b7be615b2ca6035e9cfcc485f70913" title=" " alt="" coords="427,365,517,390"/>
<area shape="rect" href="namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2" title=" " alt="" coords="419,200,525,225"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#af7421c745f6f3e419cda0b2f0f774c12" title=" " alt="" coords="438,150,506,176"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a15d4531a1671fa50a37a7a1e4a813131" title="Return the correlation between two future expiry dates ed_1 and ed_2." alt="" coords="619,260,816,300"/>
<area shape="rect" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9" title=" " alt="" coords="864,133,971,158"/>
</map>
</div>

</div>
</div>
<a id="afd5666b0370fc81ce72c0833645eead1" name="afd5666b0370fc81ce72c0833645eead1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd5666b0370fc81ce72c0833645eead1">&#9670;&#160;</a></span>calculateSpot()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calculateSpot </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculations when underlying swap references a commodity spot price. </p>

<p class="definition">Definition at line <a class="el" href="commodityapoengine_8cpp_source.html#l00323">323</a> of file <a class="el" href="commodityapoengine_8cpp_source.html">commodityapoengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  323</span>                                                                      {</div>
<div class="line"><span class="lineno">  324</span> </div>
<div class="line"><span class="lineno">  325</span>    <span class="comment">// Discount factor to the APO payment date</span></div>
<div class="line"><span class="lineno">  326</span>    Real discount = <a class="code hl_variable" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a633a2f63e35f5d5b6ec5b92ea38709ae">discountCurve_</a>-&gt;discount(<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;date());</div>
<div class="line"><span class="lineno">  327</span> </div>
<div class="line"><span class="lineno">  328</span>    <span class="comment">// Put call indicator</span></div>
<div class="line"><span class="lineno">  329</span>    Real omega = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.type == Option::Call ? 1.0 : -1.0;</div>
<div class="line"><span class="lineno">  330</span> </div>
<div class="line"><span class="lineno">  331</span>    <span class="comment">// Variable to hold the payoff</span></div>
<div class="line"><span class="lineno">  332</span>    Real payoff = 0.0;</div>
<div class="line"><span class="lineno">  333</span> </div>
<div class="line"><span class="lineno">  334</span>    <span class="comment">// Vector of timesteps from today = t_0 out to last pricing date t_n</span></div>
<div class="line"><span class="lineno">  335</span>    <span class="comment">// i.e. {t_1 - t_0, t_2 - t_1,..., t_n - t_{n-1}}</span></div>
<div class="line"><span class="lineno">  336</span>    vector&lt;Date&gt; dates;</div>
<div class="line"><span class="lineno">  337</span>    vector&lt;Real&gt; dt = <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#af7421c745f6f3e419cda0b2f0f774c12">timegrid</a>(dates);</div>
<div class="line"><span class="lineno">  338</span> </div>
<div class="line"><span class="lineno">  339</span>    <span class="comment">// On each Monte Carlo sample, we must generate the spot price process path over n time steps.</span></div>
<div class="line"><span class="lineno">  340</span>    LowDiscrepancy::rsg_type rsg = LowDiscrepancy::make_sequence_generator(dt.size(), <a class="code hl_variable" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a11ea88b3264366c5ad0da53341c6e4eb">seed_</a>);</div>
<div class="line"><span class="lineno">  341</span> </div>
<div class="line"><span class="lineno">  342</span>    <span class="comment">// We will read the volatility off the surface at the effective strike</span></div>
<div class="line"><span class="lineno">  343</span>    <span class="comment">// We will only call this method when the effectiveStrike &gt; 0 but will check anyway</span></div>
<div class="line"><span class="lineno">  344</span>    Real effectiveStrike = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.effectiveStrike - <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.accrued;</div>
<div class="line"><span class="lineno">  345</span>    QL_REQUIRE(effectiveStrike &gt; 0.0, <span class="stringliteral">&quot;calculateSpot: expected effectiveStrike to be positive&quot;</span>);</div>
<div class="line"><span class="lineno">  346</span> </div>
<div class="line"><span class="lineno">  347</span>    <span class="comment">// Precalculate:</span></div>
<div class="line"><span class="lineno">  348</span>    <span class="comment">// exp(-1/2 forward variance over dt): \exp \left(-\frac{1}{2} \int_{t_{i-1}}^{t_i} \sigma^2(u) du \right)</span></div>
<div class="line"><span class="lineno">  349</span>    <span class="comment">// forward std dev over dt: \exp \left(\sqrt{\int_{t_{i-1}}^{t_i} \sigma^2(u) du} \right)</span></div>
<div class="line"><span class="lineno">  350</span>    <span class="comment">// forward ratio: \exp \left(\int_{t_{i-1}}^{t_i} r(u) - r_f(u) \, du \right) = \frac{F(0, t_i)}{F(0, t_{i-1})}</span></div>
<div class="line"><span class="lineno">  351</span>    <span class="comment">//                first period is multiplied by S(0)</span></div>
<div class="line"><span class="lineno">  352</span>    <span class="comment">// factors array is exp(-1/2 forward variance over dt) x forward ratio</span></div>
<div class="line"><span class="lineno">  353</span>    Array expHalfFwdVar(dt.size(), 0.0);</div>
<div class="line"><span class="lineno">  354</span>    Array fwdStdDev(dt.size(), 0.0);</div>
<div class="line"><span class="lineno">  355</span>    Array fwdRatio(dt.size(), 0.0);</div>
<div class="line"><span class="lineno">  356</span>    Time t = 0.0;</div>
<div class="line"><span class="lineno">  357</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; dt.size(); i++) {</div>
<div class="line"><span class="lineno">  358</span>        t += dt[i];</div>
<div class="line"><span class="lineno">  359</span>        expHalfFwdVar[i] = <a class="code hl_variable" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a7bb1cfe348f1597abca4cf086bf907b1">volStructure_</a>-&gt;blackForwardVariance(t - dt[i], t, effectiveStrike);</div>
<div class="line"><span class="lineno">  360</span>        fwdStdDev[i] = <a class="code hl_function" href="namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(expHalfFwdVar[i]);</div>
<div class="line"><span class="lineno">  361</span>        expHalfFwdVar[i] = <a class="code hl_function" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9">exp</a>(-expHalfFwdVar[i] / 2.0);</div>
<div class="line"><span class="lineno">  362</span>        Real fxRate{1.};</div>
<div class="line"><span class="lineno">  363</span>        <span class="keywordflow">if</span>(<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;fxIndex())</div>
<div class="line"><span class="lineno">  364</span>            fxRate = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;fxIndex()-&gt;fixing(dates[i+1]);</div>
<div class="line"><span class="lineno">  365</span>        fwdRatio[i] = fxRate * <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;index()-&gt;fixing(dates[i + 1]);</div>
<div class="line"><span class="lineno">  366</span>        <span class="keywordflow">if</span> (i &gt; 0) {</div>
<div class="line"><span class="lineno">  367</span>            <span class="keywordflow">if</span>(<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;fxIndex())</div>
<div class="line"><span class="lineno">  368</span>                fxRate = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;fxIndex()-&gt;fixing(dates[i]);</div>
<div class="line"><span class="lineno">  369</span>            fwdRatio[i] /= (fxRate * <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;index()-&gt;fixing(dates[i]));</div>
<div class="line"><span class="lineno">  370</span>        }</div>
<div class="line"><span class="lineno">  371</span>    }</div>
<div class="line"><span class="lineno">  372</span>    Array factors = expHalfFwdVar * fwdRatio;</div>
<div class="line"><span class="lineno">  373</span> </div>
<div class="line"><span class="lineno">  374</span>    <span class="comment">// Loop over each sample</span></div>
<div class="line"><span class="lineno">  375</span>    <span class="keyword">auto</span> m = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;indices().size();</div>
<div class="line"><span class="lineno">  376</span>    <span class="keywordflow">for</span> (Size k = 0; k &lt; <a class="code hl_variable" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a0564940427ebccf4e19dc86088a087e3">samples_</a>; k++) {</div>
<div class="line"><span class="lineno">  377</span> </div>
<div class="line"><span class="lineno">  378</span>        <span class="comment">// Sequence is n independent standard normal random variables</span></div>
<div class="line"><span class="lineno">  379</span>        vector&lt;Real&gt; sequence = rsg.nextSequence().value;</div>
<div class="line"><span class="lineno">  380</span> </div>
<div class="line"><span class="lineno">  381</span>        <span class="comment">// Calculate payoff on this sample - price holds the evolved price</span></div>
<div class="line"><span class="lineno">  382</span>        Real price = 0.0;</div>
<div class="line"><span class="lineno">  383</span>        Real samplePayoff = 0.0;</div>
<div class="line"><span class="lineno">  384</span>        Array path(sequence.begin(), sequence.end());</div>
<div class="line"><span class="lineno">  385</span>        path = Exp(path * fwdStdDev) * factors;</div>
<div class="line"><span class="lineno">  386</span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  387</span>        <span class="keywordflow">for</span> (Size i = 0; i &lt; dt.size(); i++) {</div>
<div class="line"><span class="lineno">  388</span> </div>
<div class="line"><span class="lineno">  389</span>            <span class="comment">// Update price</span></div>
<div class="line"><span class="lineno">  390</span>            price = i == 0 ? path[i] : price * path[i];</div>
<div class="line"><span class="lineno">  391</span> </div>
<div class="line"><span class="lineno">  392</span>            <span class="comment">// Update sum of the spot prices on the pricing dates after today</span></div>
<div class="line"><span class="lineno">  393</span>            samplePayoff += price;</div>
<div class="line"><span class="lineno">  394</span> </div>
<div class="line"><span class="lineno">  395</span>            <span class="comment">// check barrier</span></div>
<div class="line"><span class="lineno">  396</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.barrierStyle == Exercise::American)</div>
<div class="line"><span class="lineno">  397</span>                <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a> = <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a> || this-&gt;<a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a>(price, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  398</span>        }</div>
<div class="line"><span class="lineno">  399</span>        <span class="comment">// Average price on this sample</span></div>
<div class="line"><span class="lineno">  400</span>        samplePayoff /= m;</div>
<div class="line"><span class="lineno">  401</span> </div>
<div class="line"><span class="lineno">  402</span>        <span class="comment">// Finally, the payoff on this sample</span></div>
<div class="line"><span class="lineno">  403</span>        samplePayoff = <a class="code hl_function" href="namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(omega * (samplePayoff - effectiveStrike), 0.0);</div>
<div class="line"><span class="lineno">  404</span> </div>
<div class="line"><span class="lineno">  405</span>        <span class="comment">// account for barrier</span></div>
<div class="line"><span class="lineno">  406</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.barrierStyle == Exercise::European)</div>
<div class="line"><span class="lineno">  407</span>            <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a> = this-&gt;<a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a>(price, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  408</span> </div>
<div class="line"><span class="lineno">  409</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a9e22d4fdcfa7ae24723755165c4d0b2f">alive</a>(<a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a>))</div>
<div class="line"><span class="lineno">  410</span>            samplePayoff = 0.0;</div>
<div class="line"><span class="lineno">  411</span> </div>
<div class="line"><span class="lineno">  412</span>        <span class="comment">// Update the final average</span></div>
<div class="line"><span class="lineno">  413</span>        <span class="comment">// Note: payoff * k / (k + 1) - left to right precedence =&gt; double division.</span></div>
<div class="line"><span class="lineno">  414</span>        payoff = k == 0 ? samplePayoff : payoff * k / (k + 1) + samplePayoff / (k + 1);</div>
<div class="line"><span class="lineno">  415</span>    }</div>
<div class="line"><span class="lineno">  416</span> </div>
<div class="line"><span class="lineno">  417</span>    <span class="comment">// Populate the result value</span></div>
<div class="line"><span class="lineno">  418</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.value = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.quantity * <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;gearing() * payoff * discount;</div>
<div class="line"><span class="lineno">  419</span>}</div>
<div class="ttc" id="acdsoption_8cpp_html_afeb3e8b4e6ab6604c185b2ea55bbc728"><div class="ttname"><a href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a></div><div class="ttdeci">const Instrument::results * results_</div><div class="ttdef"><b>Definition:</b> <a href="cdsoption_8cpp_source.html#l00081">cdsoption.cpp:81</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_average_price_option_base_engine_html_a03d74db999034464e3c0882f231cd0de"><div class="ttname"><a href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">QuantExt::CommodityAveragePriceOptionBaseEngine::barrierTriggered</a></div><div class="ttdeci">bool barrierTriggered(const Real price, const bool logPrice) const</div><div class="ttdef"><b>Definition:</b> <a href="commodityapoengine_8cpp_source.html#l00232">commodityapoengine.cpp:232</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_average_price_option_base_engine_html_a633a2f63e35f5d5b6ec5b92ea38709ae"><div class="ttname"><a href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a633a2f63e35f5d5b6ec5b92ea38709ae">QuantExt::CommodityAveragePriceOptionBaseEngine::discountCurve_</a></div><div class="ttdeci">QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt; discountCurve_</div><div class="ttdef"><b>Definition:</b> <a href="commodityapoengine_8hpp_source.html#l00102">commodityapoengine.hpp:102</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_average_price_option_base_engine_html_a7bb1cfe348f1597abca4cf086bf907b1"><div class="ttname"><a href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a7bb1cfe348f1597abca4cf086bf907b1">QuantExt::CommodityAveragePriceOptionBaseEngine::volStructure_</a></div><div class="ttdeci">QuantLib::Handle&lt; QuantLib::BlackVolTermStructure &gt; volStructure_</div><div class="ttdef"><b>Definition:</b> <a href="commodityapoengine_8hpp_source.html#l00103">commodityapoengine.hpp:103</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_average_price_option_base_engine_html_a9e22d4fdcfa7ae24723755165c4d0b2f"><div class="ttname"><a href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a9e22d4fdcfa7ae24723755165c4d0b2f">QuantExt::CommodityAveragePriceOptionBaseEngine::alive</a></div><div class="ttdeci">bool alive(const bool barrierTriggered) const</div><div class="ttdef"><b>Definition:</b> <a href="commodityapoengine_8cpp_source.html#l00243">commodityapoengine.cpp:243</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_html_af7421c745f6f3e419cda0b2f0f774c12"><div class="ttname"><a href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#af7421c745f6f3e419cda0b2f0f774c12">QuantExt::CommodityAveragePriceOptionMonteCarloEngine::timegrid</a></div><div class="ttdeci">std::vector&lt; QuantLib::Real &gt; timegrid(std::vector&lt; QuantLib::Date &gt; &amp;outDates) const</div><div class="ttdef"><b>Definition:</b> <a href="commodityapoengine_8cpp_source.html#l00574">commodityapoengine.cpp:574</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_a0780e43df89be3d7f7671eca2418cdd1"><div class="ttname"><a href="namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">QuantExt::max</a></div><div class="ttdeci">RandomVariable max(RandomVariable x, const RandomVariable &amp;y)</div><div class="ttdef"><b>Definition:</b> <a href="qle_2math_2randomvariable_8cpp_source.html#l00387">randomvariable.cpp:387</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_a11171c842d01ffacc4ec522e398070a9"><div class="ttname"><a href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9">QuantExt::exp</a></div><div class="ttdeci">RandomVariable exp(RandomVariable x)</div><div class="ttdef"><b>Definition:</b> <a href="qle_2math_2randomvariable_8cpp_source.html#l00445">randomvariable.cpp:445</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_a1b4a64a3620f987e65fec4ccf7cadcf2"><div class="ttname"><a href="namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">QuantExt::sqrt</a></div><div class="ttdeci">RandomVariable sqrt(RandomVariable x)</div><div class="ttdef"><b>Definition:</b> <a href="qle_2math_2randomvariable_8cpp_source.html#l00459">randomvariable.cpp:459</a></div></div>
</div><!-- fragment --><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_afd5666b0370fc81ce72c0833645eead1_cgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_afd5666b0370fc81ce72c0833645eead1_cgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_afd5666b0370fc81ce72c0833645eead1_cgraph" id="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_afd5666b0370fc81ce72c0833645eead1_cgraph">
<area shape="rect" title="Calculations when underlying swap references a commodity spot price." alt="" coords="5,146,107,171"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a9e22d4fdcfa7ae24723755165c4d0b2f" title=" " alt="" coords="155,5,352,45"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de" title=" " alt="" coords="400,27,597,82"/>
<area shape="rect" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9" title=" " alt="" coords="200,121,307,146"/>
<area shape="rect" href="namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1" title=" " alt="" coords="198,170,309,195"/>
<area shape="rect" href="namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2" title=" " alt="" coords="200,219,307,245"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#af7421c745f6f3e419cda0b2f0f774c12" title=" " alt="" coords="219,269,287,294"/>
</map>
</div>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_afd5666b0370fc81ce72c0833645eead1_icgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_afd5666b0370fc81ce72c0833645eead1_icgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_afd5666b0370fc81ce72c0833645eead1_icgraph" id="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_afd5666b0370fc81ce72c0833645eead1_icgraph">
<area shape="rect" title="Calculations when underlying swap references a commodity spot price." alt="" coords="128,5,229,31"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,5,80,31"/>
</map>
</div>

</div>
</div>
<a id="a87188b37db1d513cc5eb95e27fd348bb" name="a87188b37db1d513cc5eb95e27fd348bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87188b37db1d513cc5eb95e27fd348bb">&#9670;&#160;</a></span>calculateFuture()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calculateFuture </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculations when underlying swap references a commodity spot price. </p>

<p class="definition">Definition at line <a class="el" href="commodityapoengine_8cpp_source.html#l00421">421</a> of file <a class="el" href="commodityapoengine_8cpp_source.html">commodityapoengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  421</span>                                                                        {</div>
<div class="line"><span class="lineno">  422</span> </div>
<div class="line"><span class="lineno">  423</span>    <span class="comment">// this method uses checkBarrier() on log prices, therefore we have to init the log barrier level</span></div>
<div class="line"><span class="lineno">  424</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.barrierLevel != Null&lt;Real&gt;())</div>
<div class="line"><span class="lineno">  425</span>        <a class="code hl_variable" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a75be6235d3655680eb1ded11061299a7">logBarrier_</a> = std::log(<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.barrierLevel);</div>
<div class="line"><span class="lineno">  426</span> </div>
<div class="line"><span class="lineno">  427</span>    <span class="comment">// Discount factor to the APO payment date</span></div>
<div class="line"><span class="lineno">  428</span>    Real discount = <a class="code hl_variable" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a633a2f63e35f5d5b6ec5b92ea38709ae">discountCurve_</a>-&gt;discount(<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;date());</div>
<div class="line"><span class="lineno">  429</span> </div>
<div class="line"><span class="lineno">  430</span>    <span class="comment">// Put call indicator</span></div>
<div class="line"><span class="lineno">  431</span>    Real omega = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.type == Option::Call ? 1.0 : -1.0;</div>
<div class="line"><span class="lineno">  432</span> </div>
<div class="line"><span class="lineno">  433</span>    <span class="comment">// Variable to hold the payoff</span></div>
<div class="line"><span class="lineno">  434</span>    Real payoff = 0.0;</div>
<div class="line"><span class="lineno">  435</span> </div>
<div class="line"><span class="lineno">  436</span>    <span class="comment">// We will read the volatility off the surface the effective strike</span></div>
<div class="line"><span class="lineno">  437</span>    <span class="comment">// We will only call this method when the effectiveStrike &gt; 0 but will check anyway</span></div>
<div class="line"><span class="lineno">  438</span>    Real effectiveStrike = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.effectiveStrike - <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.accrued;</div>
<div class="line"><span class="lineno">  439</span>    QL_REQUIRE(effectiveStrike &gt; 0.0, <span class="stringliteral">&quot;calculateFuture: expected effectiveStrike to be positive&quot;</span>);</div>
<div class="line"><span class="lineno">  440</span> </div>
<div class="line"><span class="lineno">  441</span>    <span class="comment">// Unique future expiry dates i.e. contracts, their volatilities and the correlation matrix between them</span></div>
<div class="line"><span class="lineno">  442</span>    Matrix sqrtCorr;</div>
<div class="line"><span class="lineno">  443</span>    vector&lt;Real&gt; vols;</div>
<div class="line"><span class="lineno">  444</span>    vector&lt;Real&gt; prices;</div>
<div class="line"><span class="lineno">  445</span>    vector&lt;Size&gt; futureIndex;</div>
<div class="line"><span class="lineno">  446</span>    <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#ac4b7be615b2ca6035e9cfcc485f70913">setupFuture</a>(vols, sqrtCorr, prices, futureIndex, effectiveStrike);</div>
<div class="line"><span class="lineno">  447</span> </div>
<div class="line"><span class="lineno">  448</span>    <span class="comment">// Vector of timesteps from today = t_0 out to last pricing date t_n</span></div>
<div class="line"><span class="lineno">  449</span>    <span class="comment">// i.e. {t_1 - t_0, t_2 - t_1,..., t_n - t_{n-1}}. Don&#39;t need the dates here.</span></div>
<div class="line"><span class="lineno">  450</span>    vector&lt;Date&gt; dates;</div>
<div class="line"><span class="lineno">  451</span>    vector&lt;Real&gt; dt = <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#af7421c745f6f3e419cda0b2f0f774c12">timegrid</a>(dates);</div>
<div class="line"><span class="lineno">  452</span> </div>
<div class="line"><span class="lineno">  453</span>    <span class="comment">// On each Monte Carlo sample, we must generate the paths for N (size of vols) future contracts where</span></div>
<div class="line"><span class="lineno">  454</span>    <span class="comment">// each path has n time steps. We will represent the paths with an N x n matrix. First step is to fill the</span></div>
<div class="line"><span class="lineno">  455</span>    <span class="comment">// matrix with N x n _independent_ standard normal variables. Then correlate the N variables in each column</span></div>
<div class="line"><span class="lineno">  456</span>    <span class="comment">// using the sqrtCorr matrix and then fill each entry F_{i, j} in the matrix with the value of the i-th</span></div>
<div class="line"><span class="lineno">  457</span>    <span class="comment">// future price process at timestep j. Note, we will possibly simulate contracts past their expiries but not</span></div>
<div class="line"><span class="lineno">  458</span>    <span class="comment">// use the price in the APO rate averaging.</span></div>
<div class="line"><span class="lineno">  459</span>    LowDiscrepancy::rsg_type rsg = LowDiscrepancy::make_sequence_generator(vols.size() * dt.size(), <a class="code hl_variable" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a11ea88b3264366c5ad0da53341c6e4eb">seed_</a>);</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>    <span class="comment">// Precalculate exp(-0.5 \sigma_i^2 \delta t_j) and std dev = sqrt(\delta t_j) \sigma_i</span></div>
<div class="line"><span class="lineno">  462</span>    Matrix drifts(vols.size(), dt.size(), 0.0);</div>
<div class="line"><span class="lineno">  463</span>    Matrix stdDev(vols.size(), dt.size(), 0.0);</div>
<div class="line"><span class="lineno">  464</span>    Array logPrices(vols.size());</div>
<div class="line"><span class="lineno">  465</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; drifts.rows(); i++) {</div>
<div class="line"><span class="lineno">  466</span>        logPrices[i] = std::log(prices[i]);</div>
<div class="line"><span class="lineno">  467</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt; drifts.columns(); j++) {</div>
<div class="line"><span class="lineno">  468</span>            drifts[i][j] = -vols[i] * vols[i] * dt[j] / 2.0;</div>
<div class="line"><span class="lineno">  469</span>            stdDev[i][j] = vols[i] * <a class="code hl_function" href="namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(dt[j]);</div>
<div class="line"><span class="lineno">  470</span>        }</div>
<div class="line"><span class="lineno">  471</span>    }</div>
<div class="line"><span class="lineno">  472</span> </div>
<div class="line"><span class="lineno">  473</span>    <span class="comment">// Loop over each sample</span></div>
<div class="line"><span class="lineno">  474</span>    <span class="keyword">auto</span> m = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;indices().size();</div>
<div class="line"><span class="lineno">  475</span>    Matrix paths(vols.size(), dt.size());</div>
<div class="line"><span class="lineno">  476</span>    <span class="keywordflow">for</span> (Size k = 0; k &lt; <a class="code hl_variable" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a0564940427ebccf4e19dc86088a087e3">samples_</a>; ++k) {</div>
<div class="line"><span class="lineno">  477</span> </div>
<div class="line"><span class="lineno">  478</span>        <span class="comment">// Sequence is N x n independent standard normal random variables</span></div>
<div class="line"><span class="lineno">  479</span>        <span class="keyword">const</span> vector&lt;Real&gt;&amp; sequence = rsg.nextSequence().value;</div>
<div class="line"><span class="lineno">  480</span> </div>
<div class="line"><span class="lineno">  481</span>        <span class="comment">// paths initially holds independent standard normal random variables</span></div>
<div class="line"><span class="lineno">  482</span>        std::copy(sequence.begin(), sequence.end(), paths.begin());</div>
<div class="line"><span class="lineno">  483</span> </div>
<div class="line"><span class="lineno">  484</span>        <span class="comment">// Correlate the random variables in each column</span></div>
<div class="line"><span class="lineno">  485</span>        paths = sqrtCorr * paths;</div>
<div class="line"><span class="lineno">  486</span> </div>
<div class="line"><span class="lineno">  487</span>        <span class="comment">// Fill the paths</span></div>
<div class="line"><span class="lineno">  488</span>        <span class="keywordflow">for</span> (Size i = 0; i &lt; paths.rows(); ++i) {</div>
<div class="line"><span class="lineno">  489</span>            <span class="keywordflow">for</span> (Size j = 0; j &lt; paths.columns(); ++j) {</div>
<div class="line"><span class="lineno">  490</span>                paths[i][j] = (j == 0 ? logPrices[i] : paths[i][j - 1]) + drifts[i][j] + stdDev[i][j] * paths[i][j];</div>
<div class="line"><span class="lineno">  491</span>            }</div>
<div class="line"><span class="lineno">  492</span>        }</div>
<div class="line"><span class="lineno">  493</span> </div>
<div class="line"><span class="lineno">  494</span>        <span class="comment">// Calculate the sum of the commodity future prices on the pricing dates after today</span></div>
<div class="line"><span class="lineno">  495</span>        Real samplePayoff = 0.0;</div>
<div class="line"><span class="lineno">  496</span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  497</span>        Real price = 0.0;</div>
<div class="line"><span class="lineno">  498</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt; dt.size(); ++j) {</div>
<div class="line"><span class="lineno">  499</span>            price = paths[futureIndex[j]][j];</div>
<div class="line"><span class="lineno">  500</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.barrierStyle == Exercise::American)</div>
<div class="line"><span class="lineno">  501</span>                <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a> = <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a> || this-&gt;<a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a>(price, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  502</span>            samplePayoff += std::exp(price);</div>
<div class="line"><span class="lineno">  503</span>        }</div>
<div class="line"><span class="lineno">  504</span> </div>
<div class="line"><span class="lineno">  505</span>        <span class="comment">// Average price on this sample</span></div>
<div class="line"><span class="lineno">  506</span>        samplePayoff /= m;</div>
<div class="line"><span class="lineno">  507</span> </div>
<div class="line"><span class="lineno">  508</span>        <span class="comment">// Finally, the payoff on this sample</span></div>
<div class="line"><span class="lineno">  509</span>        samplePayoff = <a class="code hl_function" href="namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(omega * (samplePayoff - effectiveStrike), 0.0);</div>
<div class="line"><span class="lineno">  510</span> </div>
<div class="line"><span class="lineno">  511</span>        <span class="comment">// account for barrier</span></div>
<div class="line"><span class="lineno">  512</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.barrierStyle == Exercise::European)</div>
<div class="line"><span class="lineno">  513</span>            <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a> = this-&gt;<a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a>(price, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  514</span> </div>
<div class="line"><span class="lineno">  515</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a9e22d4fdcfa7ae24723755165c4d0b2f">alive</a>(<a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de">barrierTriggered</a>))</div>
<div class="line"><span class="lineno">  516</span>            samplePayoff = 0.0;</div>
<div class="line"><span class="lineno">  517</span> </div>
<div class="line"><span class="lineno">  518</span>        <span class="comment">// Update the final average</span></div>
<div class="line"><span class="lineno">  519</span>        <span class="comment">// Note: payoff * k / (k + 1) - left to right precedence =&gt; double division.</span></div>
<div class="line"><span class="lineno">  520</span>        payoff = k == 0 ? samplePayoff : payoff * k / (k + 1) + samplePayoff / (k + 1);</div>
<div class="line"><span class="lineno">  521</span>    }</div>
<div class="line"><span class="lineno">  522</span> </div>
<div class="line"><span class="lineno">  523</span>    <span class="comment">// Populate the result value</span></div>
<div class="line"><span class="lineno">  524</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.value = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.quantity * <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;gearing() * payoff * discount;</div>
<div class="line"><span class="lineno">  525</span>}</div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_average_price_option_base_engine_html_a75be6235d3655680eb1ded11061299a7"><div class="ttname"><a href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a75be6235d3655680eb1ded11061299a7">QuantExt::CommodityAveragePriceOptionBaseEngine::logBarrier_</a></div><div class="ttdeci">QuantLib::Real logBarrier_</div><div class="ttdef"><b>Definition:</b> <a href="commodityapoengine_8hpp_source.html#l00106">commodityapoengine.hpp:106</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_html_ac4b7be615b2ca6035e9cfcc485f70913"><div class="ttname"><a href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#ac4b7be615b2ca6035e9cfcc485f70913">QuantExt::CommodityAveragePriceOptionMonteCarloEngine::setupFuture</a></div><div class="ttdeci">void setupFuture(std::vector&lt; QuantLib::Real &gt; &amp;outVolatilities, QuantLib::Matrix &amp;outSqrtCorr, std::vector&lt; QuantLib::Real &gt; &amp;outPrices, std::vector&lt; QuantLib::Size &gt; &amp;futureIndex, QuantLib::Real strike) const</div><div class="ttdef"><b>Definition:</b> <a href="commodityapoengine_8cpp_source.html#l00527">commodityapoengine.cpp:527</a></div></div>
</div><!-- fragment --><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_a87188b37db1d513cc5eb95e27fd348bb_cgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_a87188b37db1d513cc5eb95e27fd348bb_cgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_a87188b37db1d513cc5eb95e27fd348bb_cgraph" id="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_a87188b37db1d513cc5eb95e27fd348bb_cgraph">
<area shape="rect" title="Calculations when underlying swap references a commodity spot price." alt="" coords="5,146,116,171"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a9e22d4fdcfa7ae24723755165c4d0b2f" title=" " alt="" coords="164,5,361,45"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a03d74db999034464e3c0882f231cd0de" title=" " alt="" coords="409,27,607,82"/>
<area shape="rect" href="namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1" title=" " alt="" coords="207,121,318,146"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#ac4b7be615b2ca6035e9cfcc485f70913" title=" " alt="" coords="217,170,308,195"/>
<area shape="rect" href="namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2" title=" " alt="" coords="209,219,316,245"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#af7421c745f6f3e419cda0b2f0f774c12" title=" " alt="" coords="229,269,297,294"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a15d4531a1671fa50a37a7a1e4a813131" title="Return the correlation between two future expiry dates ed_1 and ed_2." alt="" coords="409,163,607,203"/>
<area shape="rect" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9" title=" " alt="" coords="655,170,761,195"/>
</map>
</div>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_a87188b37db1d513cc5eb95e27fd348bb_icgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_a87188b37db1d513cc5eb95e27fd348bb_icgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_a87188b37db1d513cc5eb95e27fd348bb_icgraph" id="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_a87188b37db1d513cc5eb95e27fd348bb_icgraph">
<area shape="rect" title="Calculations when underlying swap references a commodity spot price." alt="" coords="128,5,239,31"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,5,80,31"/>
</map>
</div>

</div>
</div>
<a id="ac4b7be615b2ca6035e9cfcc485f70913" name="ac4b7be615b2ca6035e9cfcc485f70913"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4b7be615b2ca6035e9cfcc485f70913">&#9670;&#160;</a></span>setupFuture()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void setupFuture </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; QuantLib::Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>outVolatilities</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Matrix &amp;&#160;</td>
          <td class="paramname"><em>outSqrtCorr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; QuantLib::Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>outPrices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; QuantLib::Size &gt; &amp;&#160;</td>
          <td class="paramname"><em>futureIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Real&#160;</td>
          <td class="paramname"><em>strike</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Prepare data for APO calculation. The <code>outVolatilities</code> parameter will be populated with separate future contract volatilities taking into account the <code>strike</code> level. The number of elements of <code>outVolatilities</code> gives the number, N, of future contracts involved in the non-accrued portion of the APO. The matrix <code>outSqrtCorr</code> is populated with the square root of the correlation matrix between the future contracts. The <code>outPrices</code> vector will be populated with the current future price values. The <code>futureIndex</code> is populated with the index of the future to be used on each timestep in the simulation. </p>

<p class="definition">Definition at line <a class="el" href="commodityapoengine_8cpp_source.html#l00527">527</a> of file <a class="el" href="commodityapoengine_8cpp_source.html">commodityapoengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  529</span>                                                                                 {</div>
<div class="line"><span class="lineno">  530</span> </div>
<div class="line"><span class="lineno">  531</span>    <span class="comment">// Ensure that vectors are empty</span></div>
<div class="line"><span class="lineno">  532</span>    outVolatilities.clear();</div>
<div class="line"><span class="lineno">  533</span>    prices.clear();</div>
<div class="line"><span class="lineno">  534</span>    futureIndex.clear();</div>
<div class="line"><span class="lineno">  535</span> </div>
<div class="line"><span class="lineno">  536</span>    <span class="comment">// Will hold the result</span></div>
<div class="line"><span class="lineno">  537</span>    map&lt;Date, Real&gt; result;</div>
<div class="line"><span class="lineno">  538</span> </div>
<div class="line"><span class="lineno">  539</span>    <span class="comment">// Note that here we make the simplifying assumption that the volatility can be read from the volatility</span></div>
<div class="line"><span class="lineno">  540</span>    <span class="comment">// term structure at the future contract&#39;s expiry date. In most cases, if the volatility term structure is built</span></div>
<div class="line"><span class="lineno">  541</span>    <span class="comment">// from options on futures, the option contract expiry will be a number of days before the future contract expiry</span></div>
<div class="line"><span class="lineno">  542</span>    <span class="comment">// and we should really read off the term structure at that date. Also populate a temp vector containing the key</span></div>
<div class="line"><span class="lineno">  543</span>    <span class="comment">// dates for use in the loop below where we populate the sqrt correlation matrix.</span></div>
<div class="line"><span class="lineno">  544</span> </div>
<div class="line"><span class="lineno">  545</span>    <span class="comment">// Initialise result with expiry date keys that are still live in the APO</span></div>
<div class="line"><span class="lineno">  546</span>    Date today = Settings::instance().evaluationDate();</div>
<div class="line"><span class="lineno">  547</span>    set&lt;Date&gt; expiryDates;</div>
<div class="line"><span class="lineno">  548</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;indices()) {</div>
<div class="line"><span class="lineno">  549</span>        <span class="keywordflow">if</span> (p.first &gt; today) {</div>
<div class="line"><span class="lineno">  550</span>            Date expiry = p.second-&gt;expiryDate();</div>
<div class="line"><span class="lineno">  551</span>            <span class="comment">// If expiry has not been encountered yet</span></div>
<div class="line"><span class="lineno">  552</span>            <span class="keywordflow">if</span> (expiryDates.insert(expiry).second) {</div>
<div class="line"><span class="lineno">  553</span>                outVolatilities.push_back(<a class="code hl_variable" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a7bb1cfe348f1597abca4cf086bf907b1">volStructure_</a>-&gt;blackVol(expiry, strike));</div>
<div class="line"><span class="lineno">  554</span>                Real fxRate{1.};</div>
<div class="line"><span class="lineno">  555</span>                <span class="keywordflow">if</span>(<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;fxIndex())</div>
<div class="line"><span class="lineno">  556</span>                    fxRate = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;fxIndex()-&gt;fixing(expiry);</div>
<div class="line"><span class="lineno">  557</span>                prices.push_back(fxRate*p.second-&gt;fixing(today));<span class="comment">//check if today should not be p.first</span></div>
<div class="line"><span class="lineno">  558</span>            }</div>
<div class="line"><span class="lineno">  559</span>            futureIndex.push_back(expiryDates.size() - 1);</div>
<div class="line"><span class="lineno">  560</span>        }</div>
<div class="line"><span class="lineno">  561</span>    }</div>
<div class="line"><span class="lineno">  562</span> </div>
<div class="line"><span class="lineno">  563</span>    <span class="comment">// Populate the outSqrtCorr matrix</span></div>
<div class="line"><span class="lineno">  564</span>    vector&lt;Date&gt; vExpiryDates(expiryDates.begin(), expiryDates.end());</div>
<div class="line"><span class="lineno">  565</span>    outSqrtCorr = Matrix(vExpiryDates.size(), vExpiryDates.size(), 1.0);</div>
<div class="line"><span class="lineno">  566</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; vExpiryDates.size(); i++) {</div>
<div class="line"><span class="lineno">  567</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt; i; j++) {</div>
<div class="line"><span class="lineno">  568</span>            outSqrtCorr[i][j] = outSqrtCorr[j][i] = <a class="code hl_function" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a15d4531a1671fa50a37a7a1e4a813131">rho</a>(vExpiryDates[i], vExpiryDates[j]);</div>
<div class="line"><span class="lineno">  569</span>        }</div>
<div class="line"><span class="lineno">  570</span>    }</div>
<div class="line"><span class="lineno">  571</span>    outSqrtCorr = pseudoSqrt(outSqrtCorr, SalvagingAlgorithm::None);</div>
<div class="line"><span class="lineno">  572</span>}</div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_average_price_option_base_engine_html_a15d4531a1671fa50a37a7a1e4a813131"><div class="ttname"><a href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a15d4531a1671fa50a37a7a1e4a813131">QuantExt::CommodityAveragePriceOptionBaseEngine::rho</a></div><div class="ttdeci">QuantLib::Real rho(const QuantLib::Date &amp;ed_1, const QuantLib::Date &amp;ed_2) const</div><div class="ttdoc">Return the correlation between two future expiry dates ed_1 and ed_2.</div><div class="ttdef"><b>Definition:</b> <a href="commodityapoengine_8cpp_source.html#l00155">commodityapoengine.cpp:155</a></div></div>
</div><!-- fragment --><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_ac4b7be615b2ca6035e9cfcc485f70913_cgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_ac4b7be615b2ca6035e9cfcc485f70913_cgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_ac4b7be615b2ca6035e9cfcc485f70913_cgraph" id="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_ac4b7be615b2ca6035e9cfcc485f70913_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,96,38"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a15d4531a1671fa50a37a7a1e4a813131" title="Return the correlation between two future expiry dates ed_1 and ed_2." alt="" coords="144,5,341,45"/>
<area shape="rect" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9" title=" " alt="" coords="389,13,496,38"/>
</map>
</div>
<div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_ac4b7be615b2ca6035e9cfcc485f70913_icgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_ac4b7be615b2ca6035e9cfcc485f70913_icgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_ac4b7be615b2ca6035e9cfcc485f70913_icgraph" id="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_ac4b7be615b2ca6035e9cfcc485f70913_icgraph">
<area shape="rect" title=" " alt="" coords="287,5,377,31"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a87188b37db1d513cc5eb95e27fd348bb" title="Calculations when underlying swap references a commodity spot price." alt="" coords="128,5,239,31"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,5,80,31"/>
</map>
</div>

</div>
</div>
<a id="af7421c745f6f3e419cda0b2f0f774c12" name="af7421c745f6f3e419cda0b2f0f774c12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7421c745f6f3e419cda0b2f0f774c12">&#9670;&#160;</a></span>timegrid()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt; Real &gt; timegrid </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; QuantLib::Date &gt; &amp;&#160;</td>
          <td class="paramname"><em>outDates</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Return the \(n\) timesteps from today, \(t_0\), up to \(t_n\) where \(n &gt; 0\). Note that each \(t_i\) corresponds to a pricing date \(d_i\) that is after today. The method returns the vector of time deltas \(t_i - t_{i-1}\) for \(i=1,\ldots,n\) and populates the vector <code>outDates</code> with the dates \(d_0, d_1,...,d_n\). Note that the size of <code>outDates</code> is one larger than the size of the return vector. </p>

<p class="definition">Definition at line <a class="el" href="commodityapoengine_8cpp_source.html#l00574">574</a> of file <a class="el" href="commodityapoengine_8cpp_source.html">commodityapoengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  574</span>                                                                                               {</div>
<div class="line"><span class="lineno">  575</span> </div>
<div class="line"><span class="lineno">  576</span>    <span class="comment">// Initialise result with expiry date keys that are still live in the APO</span></div>
<div class="line"><span class="lineno">  577</span>    <span class="comment">// i.e. {t_1 - t_0, t_2 - t_0,..., t_n - t_0} where t_0 corresponds to today</span></div>
<div class="line"><span class="lineno">  578</span>    vector&lt;Real&gt; times;</div>
<div class="line"><span class="lineno">  579</span>    outDates.clear();</div>
<div class="line"><span class="lineno">  580</span>    Date today = Settings::instance().evaluationDate();</div>
<div class="line"><span class="lineno">  581</span>    outDates.push_back(today);</div>
<div class="line"><span class="lineno">  582</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.flow-&gt;indices()) {</div>
<div class="line"><span class="lineno">  583</span>        <span class="keywordflow">if</span> (p.first &gt; today) {</div>
<div class="line"><span class="lineno">  584</span>            outDates.push_back(p.first);</div>
<div class="line"><span class="lineno">  585</span>            times.push_back(<a class="code hl_variable" href="class_quant_ext_1_1_commodity_average_price_option_base_engine.html#a7bb1cfe348f1597abca4cf086bf907b1">volStructure_</a>-&gt;timeFromReference(p.first));</div>
<div class="line"><span class="lineno">  586</span>        }</div>
<div class="line"><span class="lineno">  587</span>    }</div>
<div class="line"><span class="lineno">  588</span> </div>
<div class="line"><span class="lineno">  589</span>    <span class="comment">// Populate time deltas i.e. {t_1 - t_0, t_2 - t_1,..., t_n - t_{n-1}}</span></div>
<div class="line"><span class="lineno">  590</span>    vector&lt;Real&gt; dt(times.size());</div>
<div class="line"><span class="lineno">  591</span>    adjacent_difference(times.begin(), times.end(), dt.begin());</div>
<div class="line"><span class="lineno">  592</span> </div>
<div class="line"><span class="lineno">  593</span>    <span class="keywordflow">return</span> dt;</div>
<div class="line"><span class="lineno">  594</span>}</div>
</div><!-- fragment --><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_af7421c745f6f3e419cda0b2f0f774c12_icgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_af7421c745f6f3e419cda0b2f0f774c12_icgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_af7421c745f6f3e419cda0b2f0f774c12_icgraph" id="aclass_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine_af7421c745f6f3e419cda0b2f0f774c12_icgraph">
<area shape="rect" title=" " alt="" coords="287,31,355,56"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a87188b37db1d513cc5eb95e27fd348bb" title="Calculations when underlying swap references a commodity spot price." alt="" coords="128,5,239,31"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#afd5666b0370fc81ce72c0833645eead1" title="Calculations when underlying swap references a commodity spot price." alt="" coords="133,55,234,80"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_average_price_option_monte_carlo_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,31,80,56"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a0564940427ebccf4e19dc86088a087e3" name="a0564940427ebccf4e19dc86088a087e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0564940427ebccf4e19dc86088a087e3">&#9670;&#160;</a></span>samples_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::Size samples_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityapoengine_8hpp_source.html#l00166">166</a> of file <a class="el" href="commodityapoengine_8hpp_source.html">commodityapoengine.hpp</a>.</p>

</div>
</div>
<a id="a11ea88b3264366c5ad0da53341c6e4eb" name="a11ea88b3264366c5ad0da53341c6e4eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a11ea88b3264366c5ad0da53341c6e4eb">&#9670;&#160;</a></span>seed_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::Size seed_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityapoengine_8hpp_source.html#l00167">167</a> of file <a class="el" href="commodityapoengine_8hpp_source.html">commodityapoengine.hpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.9.5
</small></address>
</body>
</html>
