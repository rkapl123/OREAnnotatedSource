<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<title>QuantExt: McMultiLegBaseEngine Class Reference</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="quantextextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-qle@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.8.12</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_quant_ext.html">QuantExt</a></li><li class="navelem"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html">McMultiLegBaseEngine</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="class_quant_ext_1_1_mc_multi_leg_base_engine-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">McMultiLegBaseEngine Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="mcmultilegbaseengine_8hpp_source.html">qle/pricingengines/mcmultilegbaseengine.hpp</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for McMultiLegBaseEngine:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_mc_multi_leg_base_engine__inherit__graph.png" border="0" usemap="#a_mc_multi_leg_base_engine_inherit__map" alt="Inheritance graph"/></div>
<map name="a_mc_multi_leg_base_engine_inherit__map" id="a_mc_multi_leg_base_engine_inherit__map">
<area shape="rect" title=" " alt="" coords="667,5,873,573"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_currency_swap_engine.html" title=" " alt="" coords="5,629,220,742"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_fx_forward_engine.html" title=" " alt="" coords="244,621,435,749"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_fx_option_engine.html" title=" " alt="" coords="459,621,641,749"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_nonstandard_swaption_engine.html" title=" " alt="" coords="665,636,875,735"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_swap_engine.html" title=" " alt="" coords="899,651,1062,720"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_swaption_engine.html" title=" " alt="" coords="1086,651,1270,720"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_option_engine.html" title=" " alt="" coords="1295,636,1488,735"/>
</map>
</div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for McMultiLegBaseEngine:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_mc_multi_leg_base_engine__coll__graph.png" border="0" usemap="#a_mc_multi_leg_base_engine_coll__map" alt="Collaboration graph"/></div>
<map name="a_mc_multi_leg_base_engine_coll__map" id="a_mc_multi_leg_base_engine_coll__map">
<area shape="rect" title=" " alt="" coords="1491,709,1675,852"/>
<area shape="rect" title=" " alt="" coords="221,487,326,527"/>
<area shape="rect" title=" " alt="" coords="250,211,297,251"/>
<area shape="rect" title=" " alt="" coords="1107,211,1198,251"/>
<area shape="rect" title=" " alt="" coords="483,487,619,527"/>
<area shape="rect" title=" " alt="" coords="350,487,458,527"/>
<area shape="rect" title=" " alt="" coords="1829,480,2012,535"/>
<area shape="rect" title=" " alt="" coords="2036,487,2146,527"/>
<area shape="rect" title=" " alt="" coords="1305,487,1416,527"/>
<area shape="rect" title=" " alt="" coords="910,487,1144,527"/>
<area shape="rect" title=" " alt="" coords="1133,13,1172,53"/>
<area shape="rect" title=" " alt="" coords="512,211,590,251"/>
<area shape="rect" href="classbool.html" title=" " alt="" coords="84,211,135,251"/>
<area shape="rect" title=" " alt="" coords="643,487,806,527"/>
<area shape="rect" title=" " alt="" coords="830,487,885,527"/>
<area shape="rect" title=" " alt="" coords="2570,363,2780,417"/>
<area shape="rect" title=" " alt="" coords="2327,13,2394,53"/>
<area shape="rect" title=" " alt="" coords="1789,211,1990,251"/>
<area shape="rect" title=" " alt="" coords="1168,487,1280,527"/>
<area shape="rect" title=" " alt="" coords="2074,211,2126,251"/>
<area shape="rect" title=" " alt="" coords="1440,487,1558,527"/>
<area shape="rect" title=" " alt="" coords="1583,487,1658,527"/>
<area shape="rect" title=" " alt="" coords="1682,487,1804,527"/>
<area shape="rect" title=" " alt="" coords="2176,211,2230,251"/>
<area shape="rect" title=" " alt="" coords="2436,487,2556,527"/>
<area shape="rect" title=" " alt="" coords="2581,487,2633,527"/>
<area shape="rect" title=" " alt="" coords="2658,480,2812,535"/>
<area shape="rect" href="class_quant_ext_1_1_lgm_vectorised.html" title=" " alt="" coords="913,123,1082,339"/>
<area shape="rect" title=" " alt="" coords="914,5,1082,60"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_quant_ext_1_1_mc_multi_leg_base_engine_1_1_cashflow_info.html">CashflowInfo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine_1_1_multi_leg_base_amc_calculator.html">MultiLegBaseAmcCalculator</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine_1_1_regression_model.html">RegressionModel</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a78bd0862d58f98e93a00728336188608"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a78bd0862d58f98e93a00728336188608">RegressorModel</a> { <a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a78bd0862d58f98e93a00728336188608aebfbf7dc5cde0772efb1aa49712bd76b">Simple</a>
, <a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a78bd0862d58f98e93a00728336188608a06391628dc43192f126469211ac574e2">LaggedFX</a>
 }</td></tr>
<tr class="separator:a78bd0862d58f98e93a00728336188608"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a7fa45c34daf2e3642bbdf10d35e2acd7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7fa45c34daf2e3642bbdf10d35e2acd7">McMultiLegBaseEngine</a> (const Handle&lt; <a class="el" href="class_quant_ext_1_1_cross_asset_model.html">CrossAssetModel</a> &gt; &amp;model, const <a class="el" href="namespace_quant_ext.html#a214062620719990c86bcb3c13c7f51b0">SequenceType</a> calibrationPathGenerator, const <a class="el" href="namespace_quant_ext.html#a214062620719990c86bcb3c13c7f51b0">SequenceType</a> pricingPathGenerator, const Size calibrationSamples, const Size pricingSamples, const Size calibrationSeed, const Size pricingSeed, const Size polynomOrder, const LsmBasisSystem::PolynomialType polynomType, const SobolBrownianGenerator::Ordering ordering, const SobolRsg::DirectionIntegers directionIntegers, const std::vector&lt; Handle&lt; YieldTermStructure &gt; &gt; &amp;discountCurves=std::vector&lt; Handle&lt; YieldTermStructure &gt; &gt;(), const std::vector&lt; Date &gt; &amp;simulationDates=std::vector&lt; Date &gt;(), const std::vector&lt; Size &gt; &amp;externalModelIndices=std::vector&lt; Size &gt;(), const <a class="el" href="classbool.html">bool</a> minimalObsDate=true, const <a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a78bd0862d58f98e93a00728336188608">RegressorModel</a> regressorModel=<a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a78bd0862d58f98e93a00728336188608aebfbf7dc5cde0772efb1aa49712bd76b">RegressorModel::Simple</a>, const Real regressionVarianceCutoff=Null&lt; Real &gt;())</td></tr>
<tr class="separator:a7fa45c34daf2e3642bbdf10d35e2acd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a082ff96da379d5e17436372ccb3c0972"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a082ff96da379d5e17436372ccb3c0972">calculate</a> () const</td></tr>
<tr class="separator:a082ff96da379d5e17436372ccb3c0972"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc69a9dc670afb47dfa4293ba960f981"><td class="memItemLeft" align="right" valign="top">QuantLib::ext::shared_ptr&lt; <a class="el" href="class_quant_ext_1_1_amc_calculator.html">AmcCalculator</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#abc69a9dc670afb47dfa4293ba960f981">amcCalculator</a> () const</td></tr>
<tr class="separator:abc69a9dc670afb47dfa4293ba960f981"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-attribs" name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:ade1327900ed6bd5963ee61818948c515"><td class="memItemLeft" align="right" valign="top">std::vector&lt; Leg &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ade1327900ed6bd5963ee61818948c515">leg_</a></td></tr>
<tr class="separator:ade1327900ed6bd5963ee61818948c515"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2998ea0dd746f75f1d83fe1d7cd3c6ab"><td class="memItemLeft" align="right" valign="top">std::vector&lt; Currency &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a2998ea0dd746f75f1d83fe1d7cd3c6ab">currency_</a></td></tr>
<tr class="separator:a2998ea0dd746f75f1d83fe1d7cd3c6ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcc5672032f5d39d092b5339abb3e464"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classbool.html">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#abcc5672032f5d39d092b5339abb3e464">payer_</a></td></tr>
<tr class="separator:abcc5672032f5d39d092b5339abb3e464"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3753e6fd374bc155f6c3eaaec71d6441"><td class="memItemLeft" align="right" valign="top">QuantLib::ext::shared_ptr&lt; Exercise &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3753e6fd374bc155f6c3eaaec71d6441">exercise_</a></td></tr>
<tr class="separator:a3753e6fd374bc155f6c3eaaec71d6441"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2805e91fa95c78b11a135d5fe7df516e"><td class="memItemLeft" align="right" valign="top">Settlement::Type&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a2805e91fa95c78b11a135d5fe7df516e">optionSettlement_</a> = Settlement::Physical</td></tr>
<tr class="separator:a2805e91fa95c78b11a135d5fe7df516e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9543729c4f91803553a520d5f62f488"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ad9543729c4f91803553a520d5f62f488">includeSettlementDateFlows_</a> = false</td></tr>
<tr class="separator:ad9543729c4f91803553a520d5f62f488"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7c622fbe8bbab6688f5a39b8fe89978"><td class="memItemLeft" align="right" valign="top">Handle&lt; <a class="el" href="class_quant_ext_1_1_cross_asset_model.html">CrossAssetModel</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a></td></tr>
<tr class="separator:aa7c622fbe8bbab6688f5a39b8fe89978"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f94f9aa9913a46b1fb84634b6058b86"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespace_quant_ext.html#a214062620719990c86bcb3c13c7f51b0">SequenceType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1f94f9aa9913a46b1fb84634b6058b86">calibrationPathGenerator_</a></td></tr>
<tr class="separator:a1f94f9aa9913a46b1fb84634b6058b86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf4f47dc3e1168c894294843e8efc3f4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespace_quant_ext.html#a214062620719990c86bcb3c13c7f51b0">SequenceType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#adf4f47dc3e1168c894294843e8efc3f4">pricingPathGenerator_</a></td></tr>
<tr class="separator:adf4f47dc3e1168c894294843e8efc3f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ff206b890b8b59edb2a71e34f6836ac"><td class="memItemLeft" align="right" valign="top">Size&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7ff206b890b8b59edb2a71e34f6836ac">calibrationSamples_</a></td></tr>
<tr class="separator:a7ff206b890b8b59edb2a71e34f6836ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a793853507aa9e434e1845b51b5b8f015"><td class="memItemLeft" align="right" valign="top">Size&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a793853507aa9e434e1845b51b5b8f015">pricingSamples_</a></td></tr>
<tr class="separator:a793853507aa9e434e1845b51b5b8f015"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97e4afcc630ce1c1ee377a693f2c4e06"><td class="memItemLeft" align="right" valign="top">Size&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a97e4afcc630ce1c1ee377a693f2c4e06">calibrationSeed_</a></td></tr>
<tr class="separator:a97e4afcc630ce1c1ee377a693f2c4e06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5ab96e720572f85ff9f04367b8d88e3"><td class="memItemLeft" align="right" valign="top">Size&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ae5ab96e720572f85ff9f04367b8d88e3">pricingSeed_</a></td></tr>
<tr class="separator:ae5ab96e720572f85ff9f04367b8d88e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72b1f12993111e76ce1324e1cda416b3"><td class="memItemLeft" align="right" valign="top">Size&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a72b1f12993111e76ce1324e1cda416b3">polynomOrder_</a></td></tr>
<tr class="separator:a72b1f12993111e76ce1324e1cda416b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4eb8330d156ae243b17254734beea361"><td class="memItemLeft" align="right" valign="top">LsmBasisSystem::PolynomialType&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4eb8330d156ae243b17254734beea361">polynomType_</a></td></tr>
<tr class="separator:a4eb8330d156ae243b17254734beea361"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ff8c5348202c0fb10ebd058513cefc9"><td class="memItemLeft" align="right" valign="top">SobolBrownianGenerator::Ordering&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3ff8c5348202c0fb10ebd058513cefc9">ordering_</a></td></tr>
<tr class="separator:a3ff8c5348202c0fb10ebd058513cefc9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44bcbd366a24b9989a3295b7202ec3fa"><td class="memItemLeft" align="right" valign="top">SobolRsg::DirectionIntegers&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a44bcbd366a24b9989a3295b7202ec3fa">directionIntegers_</a></td></tr>
<tr class="separator:a44bcbd366a24b9989a3295b7202ec3fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f5cc25da87a57e846f4601d9e86f7d9"><td class="memItemLeft" align="right" valign="top">std::vector&lt; Handle&lt; YieldTermStructure &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9f5cc25da87a57e846f4601d9e86f7d9">discountCurves_</a></td></tr>
<tr class="separator:a9f5cc25da87a57e846f4601d9e86f7d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fadadb77ba64c262103d204df7dc7cf"><td class="memItemLeft" align="right" valign="top">std::vector&lt; Date &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4fadadb77ba64c262103d204df7dc7cf">simulationDates_</a></td></tr>
<tr class="separator:a4fadadb77ba64c262103d204df7dc7cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae26491a56f9b83c6d0b5a8716029d95b"><td class="memItemLeft" align="right" valign="top">std::vector&lt; Size &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ae26491a56f9b83c6d0b5a8716029d95b">externalModelIndices_</a></td></tr>
<tr class="separator:ae26491a56f9b83c6d0b5a8716029d95b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e3951457698bb33afa00b094ee49860"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a2e3951457698bb33afa00b094ee49860">minimalObsDate_</a></td></tr>
<tr class="separator:a2e3951457698bb33afa00b094ee49860"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0963458f7890a5310185715c50f45512"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a78bd0862d58f98e93a00728336188608">RegressorModel</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a0963458f7890a5310185715c50f45512">regressorModel_</a></td></tr>
<tr class="separator:a0963458f7890a5310185715c50f45512"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29309ad290a75bf279f34e60c84bed59"><td class="memItemLeft" align="right" valign="top">Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a29309ad290a75bf279f34e60c84bed59">regressionVarianceCutoff_</a></td></tr>
<tr class="separator:a29309ad290a75bf279f34e60c84bed59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b390954ac7a2dc37c37d361a3218aaf"><td class="memItemLeft" align="right" valign="top">QuantLib::ext::shared_ptr&lt; <a class="el" href="class_quant_ext_1_1_amc_calculator.html">AmcCalculator</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a6b390954ac7a2dc37c37d361a3218aaf">amcCalculator_</a></td></tr>
<tr class="separator:a6b390954ac7a2dc37c37d361a3218aaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4735af14c02f445241b8222ff6fedf25"><td class="memItemLeft" align="right" valign="top">Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4735af14c02f445241b8222ff6fedf25">resultUnderlyingNpv_</a></td></tr>
<tr class="separator:a4735af14c02f445241b8222ff6fedf25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae97465b2b8e93dcb73303587635ff486"><td class="memItemLeft" align="right" valign="top">Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ae97465b2b8e93dcb73303587635ff486">resultValue_</a></td></tr>
<tr class="separator:ae97465b2b8e93dcb73303587635ff486"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a9616e98344f1aaf32238783d4d9a1e8e"><td class="memItemLeft" align="right" valign="top">Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a> (const Date &amp;d) const</td></tr>
<tr class="separator:a9616e98344f1aaf32238783d4d9a1e8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f75cec33506ad7f47bce5f6908750bc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_quant_ext_1_1_mc_multi_leg_base_engine_1_1_cashflow_info.html">CashflowInfo</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7f75cec33506ad7f47bce5f6908750bc">createCashflowInfo</a> (QuantLib::ext::shared_ptr&lt; CashFlow &gt; flow, const Currency &amp;payCcy, <a class="el" href="classbool.html">bool</a> payer, Size legNo, Size cfNo) const</td></tr>
<tr class="separator:a7f75cec33506ad7f47bce5f6908750bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83cea99ba49a654e2a8db95962e4c768"><td class="memItemLeft" align="right" valign="top">Size&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a83cea99ba49a654e2a8db95962e4c768">timeIndex</a> (const Time t, const std::set&lt; Real &gt; &amp;simulationTimes) const</td></tr>
<tr class="separator:a83cea99ba49a654e2a8db95962e4c768"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e8a0b968ffaadf758f6af955da9ce5b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_quant_ext_1_1_random_variable.html">RandomVariable</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3e8a0b968ffaadf758f6af955da9ce5b">cashflowPathValue</a> (const <a class="el" href="struct_quant_ext_1_1_mc_multi_leg_base_engine_1_1_cashflow_info.html">CashflowInfo</a> &amp;cf, const std::vector&lt; std::vector&lt; <a class="el" href="struct_quant_ext_1_1_random_variable.html">RandomVariable</a> &gt; &gt; &amp;pathValues, const std::set&lt; Real &gt; &amp;simulationTimes) const</td></tr>
<tr class="separator:a3e8a0b968ffaadf758f6af955da9ce5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:aedc6b4c263e4e87835f8fa59891ccd70"><td class="memItemLeft" align="right" valign="top">Date&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aedc6b4c263e4e87835f8fa59891ccd70">today_</a></td></tr>
<tr class="separator:aedc6b4c263e4e87835f8fa59891ccd70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1951be97f2884589014cdbfcfff3ed9e"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="class_quant_ext_1_1_lgm_vectorised.html">LgmVectorised</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1951be97f2884589014cdbfcfff3ed9e">lgmVectorised_</a></td></tr>
<tr class="separator:a1951be97f2884589014cdbfcfff3ed9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-static-attribs" name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:a66e090204366fe36e30053934bca5e44"><td class="memItemLeft" align="right" valign="top">static constexpr Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a66e090204366fe36e30053934bca5e44">tinyTime</a> = 1E-10</td></tr>
<tr class="separator:a66e090204366fe36e30053934bca5e44"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00061">61</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a id="a78bd0862d58f98e93a00728336188608" name="a78bd0862d58f98e93a00728336188608"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78bd0862d58f98e93a00728336188608">&#9670;&#160;</a></span>RegressorModel</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a78bd0862d58f98e93a00728336188608">RegressorModel</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a78bd0862d58f98e93a00728336188608aebfbf7dc5cde0772efb1aa49712bd76b" name="a78bd0862d58f98e93a00728336188608aebfbf7dc5cde0772efb1aa49712bd76b"></a>Simple&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a78bd0862d58f98e93a00728336188608a06391628dc43192f126469211ac574e2" name="a78bd0862d58f98e93a00728336188608a06391628dc43192f126469211ac574e2"></a>LaggedFX&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00063">63</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   63</span>{ <a class="code hl_enumvalue" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a78bd0862d58f98e93a00728336188608aebfbf7dc5cde0772efb1aa49712bd76b">Simple</a>, <a class="code hl_enumvalue" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a78bd0862d58f98e93a00728336188608a06391628dc43192f126469211ac574e2">LaggedFX</a> };</div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a78bd0862d58f98e93a00728336188608a06391628dc43192f126469211ac574e2"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a78bd0862d58f98e93a00728336188608a06391628dc43192f126469211ac574e2">QuantExt::McMultiLegBaseEngine::LaggedFX</a></div><div class="ttdeci">@ LaggedFX</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00063">mcmultilegbaseengine.hpp:63</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a78bd0862d58f98e93a00728336188608aebfbf7dc5cde0772efb1aa49712bd76b"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a78bd0862d58f98e93a00728336188608aebfbf7dc5cde0772efb1aa49712bd76b">QuantExt::McMultiLegBaseEngine::Simple</a></div><div class="ttdeci">@ Simple</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00063">mcmultilegbaseengine.hpp:63</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a7fa45c34daf2e3642bbdf10d35e2acd7" name="a7fa45c34daf2e3642bbdf10d35e2acd7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7fa45c34daf2e3642bbdf10d35e2acd7">&#9670;&#160;</a></span>McMultiLegBaseEngine()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html">McMultiLegBaseEngine</a> </td>
          <td>(</td>
          <td class="paramtype">const Handle&lt; <a class="el" href="class_quant_ext_1_1_cross_asset_model.html">CrossAssetModel</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespace_quant_ext.html#a214062620719990c86bcb3c13c7f51b0">SequenceType</a>&#160;</td>
          <td class="paramname"><em>calibrationPathGenerator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespace_quant_ext.html#a214062620719990c86bcb3c13c7f51b0">SequenceType</a>&#160;</td>
          <td class="paramname"><em>pricingPathGenerator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Size&#160;</td>
          <td class="paramname"><em>calibrationSamples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Size&#160;</td>
          <td class="paramname"><em>pricingSamples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Size&#160;</td>
          <td class="paramname"><em>calibrationSeed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Size&#160;</td>
          <td class="paramname"><em>pricingSeed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Size&#160;</td>
          <td class="paramname"><em>polynomOrder</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const LsmBasisSystem::PolynomialType&#160;</td>
          <td class="paramname"><em>polynomType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const SobolBrownianGenerator::Ordering&#160;</td>
          <td class="paramname"><em>ordering</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const SobolRsg::DirectionIntegers&#160;</td>
          <td class="paramname"><em>directionIntegers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; Handle&lt; YieldTermStructure &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>discountCurves</em> = <code>std::vector&lt;Handle&lt;YieldTermStructure&gt;&gt;()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; Date &gt; &amp;&#160;</td>
          <td class="paramname"><em>simulationDates</em> = <code>std::vector&lt;Date&gt;()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; Size &gt; &amp;&#160;</td>
          <td class="paramname"><em>externalModelIndices</em> = <code>std::vector&lt;Size&gt;()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>minimalObsDate</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a78bd0862d58f98e93a00728336188608">RegressorModel</a>&#160;</td>
          <td class="paramname"><em>regressorModel</em> = <code><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a78bd0862d58f98e93a00728336188608aebfbf7dc5cde0772efb1aa49712bd76b">RegressorModel::Simple</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Real&#160;</td>
          <td class="paramname"><em>regressionVarianceCutoff</em> = <code>Null&lt;Real&gt;()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >The npv is computed in the model's base currency, discounting curves are taken from the model. simulationDates are additional simulation dates. The cross asset model here must be consistent with the multi path that is the input to <a class="el" href="class_quant_ext_1_1_amc_calculator.html#a293f6f8bc0e87f5e6a452b4c0a0fd5aa">AmcCalculator::simulatePath()</a>.</p>
<p >Current limitations:</p><ul>
<li>the parameter minimalObsDate is ignored, the corresponding optimization is not implemented yet</li>
<li>pricingSamples are ignored, the npv from the training phase is used alway </li>
</ul>

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8cpp_source.html#l00043">43</a> of file <a class="el" href="mcmultilegbaseengine_8cpp_source.html">mcmultilegbaseengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   51</span>    : <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>(model), <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1f94f9aa9913a46b1fb84634b6058b86">calibrationPathGenerator_</a>(calibrationPathGenerator), <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#adf4f47dc3e1168c894294843e8efc3f4">pricingPathGenerator_</a>(pricingPathGenerator),</div>
<div class="line"><span class="lineno">   52</span>      <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7ff206b890b8b59edb2a71e34f6836ac">calibrationSamples_</a>(calibrationSamples), <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a793853507aa9e434e1845b51b5b8f015">pricingSamples_</a>(pricingSamples), <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a97e4afcc630ce1c1ee377a693f2c4e06">calibrationSeed_</a>(calibrationSeed),</div>
<div class="line"><span class="lineno">   53</span>      <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ae5ab96e720572f85ff9f04367b8d88e3">pricingSeed_</a>(pricingSeed), <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a72b1f12993111e76ce1324e1cda416b3">polynomOrder_</a>(polynomOrder), <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4eb8330d156ae243b17254734beea361">polynomType_</a>(polynomType), <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3ff8c5348202c0fb10ebd058513cefc9">ordering_</a>(ordering),</div>
<div class="line"><span class="lineno">   54</span>      <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a44bcbd366a24b9989a3295b7202ec3fa">directionIntegers_</a>(directionIntegers), <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9f5cc25da87a57e846f4601d9e86f7d9">discountCurves_</a>(discountCurves), <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4fadadb77ba64c262103d204df7dc7cf">simulationDates_</a>(simulationDates),</div>
<div class="line"><span class="lineno">   55</span>      <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ae26491a56f9b83c6d0b5a8716029d95b">externalModelIndices_</a>(externalModelIndices), <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a2e3951457698bb33afa00b094ee49860">minimalObsDate_</a>(minimalObsDate), <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a0963458f7890a5310185715c50f45512">regressorModel_</a>(regressorModel),</div>
<div class="line"><span class="lineno">   56</span>      <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a29309ad290a75bf279f34e60c84bed59">regressionVarianceCutoff_</a>(regressionVarianceCutoff) {</div>
<div class="line"><span class="lineno">   57</span> </div>
<div class="line"><span class="lineno">   58</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9f5cc25da87a57e846f4601d9e86f7d9">discountCurves_</a>.empty())</div>
<div class="line"><span class="lineno">   59</span>        <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9f5cc25da87a57e846f4601d9e86f7d9">discountCurves_</a>.resize(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;components(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704">CrossAssetModel::AssetType::IR</a>));</div>
<div class="line"><span class="lineno">   60</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   61</span>        QL_REQUIRE(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9f5cc25da87a57e846f4601d9e86f7d9">discountCurves_</a>.size() == <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;components(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704">CrossAssetModel::AssetType::IR</a>),</div>
<div class="line"><span class="lineno">   62</span>                   <span class="stringliteral">&quot;McMultiLegBaseEngine: &quot;</span> &lt;&lt; <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9f5cc25da87a57e846f4601d9e86f7d9">discountCurves_</a>.size() &lt;&lt; <span class="stringliteral">&quot; discount curves given, but model has &quot;</span></div>
<div class="line"><span class="lineno">   63</span>                                            &lt;&lt; <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;components(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704">CrossAssetModel::AssetType::IR</a>) &lt;&lt; <span class="stringliteral">&quot; IR components.&quot;</span>);</div>
<div class="line"><span class="lineno">   64</span>    }</div>
<div class="line"><span class="lineno">   65</span>}</div>
<div class="ttc" id="aclass_quant_ext_1_1_cross_asset_model_html_a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704"><div class="ttname"><a href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704">QuantExt::CrossAssetModel::AssetType::IR</a></div><div class="ttdeci">@ IR</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a0963458f7890a5310185715c50f45512"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a0963458f7890a5310185715c50f45512">QuantExt::McMultiLegBaseEngine::regressorModel_</a></div><div class="ttdeci">RegressorModel regressorModel_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00112">mcmultilegbaseengine.hpp:112</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a1f94f9aa9913a46b1fb84634b6058b86"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1f94f9aa9913a46b1fb84634b6058b86">QuantExt::McMultiLegBaseEngine::calibrationPathGenerator_</a></div><div class="ttdeci">SequenceType calibrationPathGenerator_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00102">mcmultilegbaseengine.hpp:102</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a29309ad290a75bf279f34e60c84bed59"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a29309ad290a75bf279f34e60c84bed59">QuantExt::McMultiLegBaseEngine::regressionVarianceCutoff_</a></div><div class="ttdeci">Real regressionVarianceCutoff_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00113">mcmultilegbaseengine.hpp:113</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a2e3951457698bb33afa00b094ee49860"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a2e3951457698bb33afa00b094ee49860">QuantExt::McMultiLegBaseEngine::minimalObsDate_</a></div><div class="ttdeci">bool minimalObsDate_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00111">mcmultilegbaseengine.hpp:111</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a3ff8c5348202c0fb10ebd058513cefc9"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3ff8c5348202c0fb10ebd058513cefc9">QuantExt::McMultiLegBaseEngine::ordering_</a></div><div class="ttdeci">SobolBrownianGenerator::Ordering ordering_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00106">mcmultilegbaseengine.hpp:106</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a44bcbd366a24b9989a3295b7202ec3fa"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a44bcbd366a24b9989a3295b7202ec3fa">QuantExt::McMultiLegBaseEngine::directionIntegers_</a></div><div class="ttdeci">SobolRsg::DirectionIntegers directionIntegers_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00107">mcmultilegbaseengine.hpp:107</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a4eb8330d156ae243b17254734beea361"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4eb8330d156ae243b17254734beea361">QuantExt::McMultiLegBaseEngine::polynomType_</a></div><div class="ttdeci">LsmBasisSystem::PolynomialType polynomType_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00105">mcmultilegbaseengine.hpp:105</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a4fadadb77ba64c262103d204df7dc7cf"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4fadadb77ba64c262103d204df7dc7cf">QuantExt::McMultiLegBaseEngine::simulationDates_</a></div><div class="ttdeci">std::vector&lt; Date &gt; simulationDates_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00109">mcmultilegbaseengine.hpp:109</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a72b1f12993111e76ce1324e1cda416b3"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a72b1f12993111e76ce1324e1cda416b3">QuantExt::McMultiLegBaseEngine::polynomOrder_</a></div><div class="ttdeci">Size polynomOrder_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00104">mcmultilegbaseengine.hpp:104</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a793853507aa9e434e1845b51b5b8f015"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a793853507aa9e434e1845b51b5b8f015">QuantExt::McMultiLegBaseEngine::pricingSamples_</a></div><div class="ttdeci">Size pricingSamples_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00103">mcmultilegbaseengine.hpp:103</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a7ff206b890b8b59edb2a71e34f6836ac"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7ff206b890b8b59edb2a71e34f6836ac">QuantExt::McMultiLegBaseEngine::calibrationSamples_</a></div><div class="ttdeci">Size calibrationSamples_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00103">mcmultilegbaseengine.hpp:103</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a97e4afcc630ce1c1ee377a693f2c4e06"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a97e4afcc630ce1c1ee377a693f2c4e06">QuantExt::McMultiLegBaseEngine::calibrationSeed_</a></div><div class="ttdeci">Size calibrationSeed_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00103">mcmultilegbaseengine.hpp:103</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a9f5cc25da87a57e846f4601d9e86f7d9"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9f5cc25da87a57e846f4601d9e86f7d9">QuantExt::McMultiLegBaseEngine::discountCurves_</a></div><div class="ttdeci">std::vector&lt; Handle&lt; YieldTermStructure &gt; &gt; discountCurves_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00108">mcmultilegbaseengine.hpp:108</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_aa7c622fbe8bbab6688f5a39b8fe89978"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">QuantExt::McMultiLegBaseEngine::model_</a></div><div class="ttdeci">Handle&lt; CrossAssetModel &gt; model_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00101">mcmultilegbaseengine.hpp:101</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_adf4f47dc3e1168c894294843e8efc3f4"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#adf4f47dc3e1168c894294843e8efc3f4">QuantExt::McMultiLegBaseEngine::pricingPathGenerator_</a></div><div class="ttdeci">SequenceType pricingPathGenerator_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00102">mcmultilegbaseengine.hpp:102</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_ae26491a56f9b83c6d0b5a8716029d95b"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ae26491a56f9b83c6d0b5a8716029d95b">QuantExt::McMultiLegBaseEngine::externalModelIndices_</a></div><div class="ttdeci">std::vector&lt; Size &gt; externalModelIndices_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00110">mcmultilegbaseengine.hpp:110</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_ae5ab96e720572f85ff9f04367b8d88e3"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ae5ab96e720572f85ff9f04367b8d88e3">QuantExt::McMultiLegBaseEngine::pricingSeed_</a></div><div class="ttdeci">Size pricingSeed_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00103">mcmultilegbaseengine.hpp:103</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a082ff96da379d5e17436372ccb3c0972" name="a082ff96da379d5e17436372ccb3c0972"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a082ff96da379d5e17436372ccb3c0972">&#9670;&#160;</a></span>calculate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calculate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8cpp_source.html#l00686">686</a> of file <a class="el" href="mcmultilegbaseengine_8cpp_source.html">mcmultilegbaseengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  686</span>                                           {</div>
<div class="line"><span class="lineno">  687</span> </div>
<div class="line"><span class="lineno">  688</span>    McEngineStats::instance().other_timer.resume();</div>
<div class="line"><span class="lineno">  689</span> </div>
<div class="line"><span class="lineno">  690</span>    <span class="comment">// check data set by derived engines</span></div>
<div class="line"><span class="lineno">  691</span> </div>
<div class="line"><span class="lineno">  692</span>    QL_REQUIRE(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a2998ea0dd746f75f1d83fe1d7cd3c6ab">currency_</a>.size() == <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ade1327900ed6bd5963ee61818948c515">leg_</a>.size(), <span class="stringliteral">&quot;McMultiLegBaseEngine: number of legs (&quot;</span></div>
<div class="line"><span class="lineno">  693</span>                                                    &lt;&lt; <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ade1327900ed6bd5963ee61818948c515">leg_</a>.size() &lt;&lt; <span class="stringliteral">&quot;) does not match currencies (&quot;</span></div>
<div class="line"><span class="lineno">  694</span>                                                    &lt;&lt; <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a2998ea0dd746f75f1d83fe1d7cd3c6ab">currency_</a>.size() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno">  695</span>    QL_REQUIRE(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#abcc5672032f5d39d092b5339abb3e464">payer_</a>.size() == <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ade1327900ed6bd5963ee61818948c515">leg_</a>.size(), <span class="stringliteral">&quot;McMultiLegBaseEngine: number of legs (&quot;</span></div>
<div class="line"><span class="lineno">  696</span>                                                 &lt;&lt; <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ade1327900ed6bd5963ee61818948c515">leg_</a>.size() &lt;&lt; <span class="stringliteral">&quot;) does not match payer flag (&quot;</span> &lt;&lt; <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#abcc5672032f5d39d092b5339abb3e464">payer_</a>.size()</div>
<div class="line"><span class="lineno">  697</span>                                                 &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno">  698</span> </div>
<div class="line"><span class="lineno">  699</span>    <span class="comment">// set today&#39;s date</span></div>
<div class="line"><span class="lineno">  700</span> </div>
<div class="line"><span class="lineno">  701</span>    <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aedc6b4c263e4e87835f8fa59891ccd70">today_</a> = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;irlgm1f(0)-&gt;termStructure()-&gt;referenceDate();</div>
<div class="line"><span class="lineno">  702</span> </div>
<div class="line"><span class="lineno">  703</span>    <span class="comment">// set up lgm vectorized instances for each currency</span></div>
<div class="line"><span class="lineno">  704</span> </div>
<div class="line"><span class="lineno">  705</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1951be97f2884589014cdbfcfff3ed9e">lgmVectorised_</a>.empty()) {</div>
<div class="line"><span class="lineno">  706</span>        <span class="keywordflow">for</span> (Size i = 0; i &lt; <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;components(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704">CrossAssetModel::AssetType::IR</a>); ++i) {</div>
<div class="line"><span class="lineno">  707</span>            <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1951be97f2884589014cdbfcfff3ed9e">lgmVectorised_</a>.push_back(LgmVectorised(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;irlgm1f(i)));</div>
<div class="line"><span class="lineno">  708</span>        }</div>
<div class="line"><span class="lineno">  709</span>    }</div>
<div class="line"><span class="lineno">  710</span> </div>
<div class="line"><span class="lineno">  711</span>    <span class="comment">// populate the info to generate the (alive) cashflow amounts</span></div>
<div class="line"><span class="lineno">  712</span> </div>
<div class="line"><span class="lineno">  713</span>    std::vector&lt;CashflowInfo&gt; cashflowInfo;</div>
<div class="line"><span class="lineno">  714</span> </div>
<div class="line"><span class="lineno">  715</span>    Size legNo = 0;</div>
<div class="line"><span class="lineno">  716</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; leg : <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ade1327900ed6bd5963ee61818948c515">leg_</a>) {</div>
<div class="line"><span class="lineno">  717</span>        Currency currency = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a2998ea0dd746f75f1d83fe1d7cd3c6ab">currency_</a>[legNo];</div>
<div class="line"><span class="lineno">  718</span>        <span class="keywordtype">bool</span> payer = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#abcc5672032f5d39d092b5339abb3e464">payer_</a>[legNo];</div>
<div class="line"><span class="lineno">  719</span>        Size cashflowNo = 0;</div>
<div class="line"><span class="lineno">  720</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; cashflow : leg) {</div>
<div class="line"><span class="lineno">  721</span>            <span class="comment">// we can skip cashflows that are paid</span></div>
<div class="line"><span class="lineno">  722</span>            <span class="keywordflow">if</span> (cashflow-&gt;date() &lt; <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aedc6b4c263e4e87835f8fa59891ccd70">today_</a> || (!<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ad9543729c4f91803553a520d5f62f488">includeSettlementDateFlows_</a> &amp;&amp; cashflow-&gt;date() == <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aedc6b4c263e4e87835f8fa59891ccd70">today_</a>))</div>
<div class="line"><span class="lineno">  723</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  724</span>            <span class="comment">// for an alive cashflow, populate the data</span></div>
<div class="line"><span class="lineno">  725</span>            cashflowInfo.push_back(<a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7f75cec33506ad7f47bce5f6908750bc">createCashflowInfo</a>(cashflow, currency, payer, legNo, cashflowNo));</div>
<div class="line"><span class="lineno">  726</span>            <span class="comment">// increment counter</span></div>
<div class="line"><span class="lineno">  727</span>            ++cashflowNo;</div>
<div class="line"><span class="lineno">  728</span>        }</div>
<div class="line"><span class="lineno">  729</span>        ++legNo;</div>
<div class="line"><span class="lineno">  730</span>    }</div>
<div class="line"><span class="lineno">  731</span> </div>
<div class="line"><span class="lineno">  732</span>    <span class="comment">/* build exercise times and xva times */</span></div>
<div class="line"><span class="lineno">  733</span> </div>
<div class="line"><span class="lineno">  734</span>    std::set&lt;Real&gt; exerciseTimes;</div>
<div class="line"><span class="lineno">  735</span>    std::set&lt;Real&gt; xvaTimes;</div>
<div class="line"><span class="lineno">  736</span> </div>
<div class="line"><span class="lineno">  737</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3753e6fd374bc155f6c3eaaec71d6441">exercise_</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  738</span> </div>
<div class="line"><span class="lineno">  739</span>        QL_REQUIRE(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3753e6fd374bc155f6c3eaaec71d6441">exercise_</a>-&gt;type() != Exercise::American,</div>
<div class="line"><span class="lineno">  740</span>                   <span class="stringliteral">&quot;McMultiLegBaseEngine::calculate(): exercise style American is not supported yet.&quot;</span>);</div>
<div class="line"><span class="lineno">  741</span> </div>
<div class="line"><span class="lineno">  742</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; d : <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3753e6fd374bc155f6c3eaaec71d6441">exercise_</a>-&gt;dates()) {</div>
<div class="line"><span class="lineno">  743</span>            <span class="keywordflow">if</span> (d &lt;= <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aedc6b4c263e4e87835f8fa59891ccd70">today_</a>)</div>
<div class="line"><span class="lineno">  744</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  745</span>            exerciseTimes.insert(<a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(d));</div>
<div class="line"><span class="lineno">  746</span>        }</div>
<div class="line"><span class="lineno">  747</span>    }</div>
<div class="line"><span class="lineno">  748</span> </div>
<div class="line"><span class="lineno">  749</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; d : <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4fadadb77ba64c262103d204df7dc7cf">simulationDates_</a>) {</div>
<div class="line"><span class="lineno">  750</span>        xvaTimes.insert(<a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(d));</div>
<div class="line"><span class="lineno">  751</span>    }</div>
<div class="line"><span class="lineno">  752</span> </div>
<div class="line"><span class="lineno">  753</span>    <span class="comment">/* build cashflow generation times */</span></div>
<div class="line"><span class="lineno">  754</span> </div>
<div class="line"><span class="lineno">  755</span>    std::set&lt;Real&gt; cashflowGenTimes;</div>
<div class="line"><span class="lineno">  756</span> </div>
<div class="line"><span class="lineno">  757</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; info : cashflowInfo) {</div>
<div class="line"><span class="lineno">  758</span>        cashflowGenTimes.insert(info.simulationTimes.begin(), info.simulationTimes.end());</div>
<div class="line"><span class="lineno">  759</span>        cashflowGenTimes.insert(info.payTime);</div>
<div class="line"><span class="lineno">  760</span>    }</div>
<div class="line"><span class="lineno">  761</span> </div>
<div class="line"><span class="lineno">  762</span>    cashflowGenTimes.erase(0.0); <span class="comment">// handled separately, if it is set by a cashflow</span></div>
<div class="line"><span class="lineno">  763</span> </div>
<div class="line"><span class="lineno">  764</span>    <span class="comment">/* build combined time sets */</span></div>
<div class="line"><span class="lineno">  765</span> </div>
<div class="line"><span class="lineno">  766</span>    std::set&lt;Real&gt; exerciseXvaTimes; <span class="comment">// = exercise + xva times</span></div>
<div class="line"><span class="lineno">  767</span>    std::set&lt;Real&gt; simulationTimes;  <span class="comment">// = cashflowGen + exercise + xva times</span></div>
<div class="line"><span class="lineno">  768</span> </div>
<div class="line"><span class="lineno">  769</span>    exerciseXvaTimes.insert(exerciseTimes.begin(), exerciseTimes.end());</div>
<div class="line"><span class="lineno">  770</span>    exerciseXvaTimes.insert(xvaTimes.begin(), xvaTimes.end());</div>
<div class="line"><span class="lineno">  771</span> </div>
<div class="line"><span class="lineno">  772</span>    simulationTimes.insert(cashflowGenTimes.begin(), cashflowGenTimes.end());</div>
<div class="line"><span class="lineno">  773</span>    simulationTimes.insert(exerciseTimes.begin(), exerciseTimes.end());</div>
<div class="line"><span class="lineno">  774</span>    simulationTimes.insert(xvaTimes.begin(), xvaTimes.end());</div>
<div class="line"><span class="lineno">  775</span> </div>
<div class="line"><span class="lineno">  776</span>    McEngineStats::instance().other_timer.stop();</div>
<div class="line"><span class="lineno">  777</span> </div>
<div class="line"><span class="lineno">  778</span>    <span class="comment">// simulate the paths for the calibration</span></div>
<div class="line"><span class="lineno">  779</span> </div>
<div class="line"><span class="lineno">  780</span>    McEngineStats::instance().path_timer.resume();</div>
<div class="line"><span class="lineno">  781</span> </div>
<div class="line"><span class="lineno">  782</span>    QL_REQUIRE(!simulationTimes.empty(),</div>
<div class="line"><span class="lineno">  783</span>               <span class="stringliteral">&quot;McMultiLegBaseEngine::calculate(): no simulation times, this is not expected.&quot;</span>);</div>
<div class="line"><span class="lineno">  784</span>    std::vector&lt;std::vector&lt;RandomVariable&gt;&gt; pathValues(</div>
<div class="line"><span class="lineno">  785</span>        simulationTimes.size(),</div>
<div class="line"><span class="lineno">  786</span>        std::vector&lt;RandomVariable&gt;(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;stateProcess()-&gt;size(), RandomVariable(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7ff206b890b8b59edb2a71e34f6836ac">calibrationSamples_</a>)));</div>
<div class="line"><span class="lineno">  787</span>    std::vector&lt;std::vector&lt;const RandomVariable*&gt;&gt; pathValuesRef(</div>
<div class="line"><span class="lineno">  788</span>        simulationTimes.size(), std::vector&lt;const RandomVariable*&gt;(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;stateProcess()-&gt;size()));</div>
<div class="line"><span class="lineno">  789</span> </div>
<div class="line"><span class="lineno">  790</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; pathValues.size(); ++i) {</div>
<div class="line"><span class="lineno">  791</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt; pathValues[i].size(); ++j) {</div>
<div class="line"><span class="lineno">  792</span>            pathValues[i][j].expand();</div>
<div class="line"><span class="lineno">  793</span>            pathValuesRef[i][j] = &amp;pathValues[i][j];</div>
<div class="line"><span class="lineno">  794</span>        }</div>
<div class="line"><span class="lineno">  795</span>    }</div>
<div class="line"><span class="lineno">  796</span> </div>
<div class="line"><span class="lineno">  797</span>    TimeGrid timeGrid(simulationTimes.begin(), simulationTimes.end());</div>
<div class="line"><span class="lineno">  798</span> </div>
<div class="line"><span class="lineno">  799</span>    QuantLib::ext::shared_ptr&lt;StochasticProcess&gt; process = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;stateProcess();</div>
<div class="line"><span class="lineno">  800</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;dimension() == 1) {</div>
<div class="line"><span class="lineno">  801</span>        <span class="comment">// use lgm process if possible for better performance</span></div>
<div class="line"><span class="lineno">  802</span>        <span class="keyword">auto</span> tmp = QuantLib::ext::make_shared&lt;IrLgm1fStateProcess&gt;(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;irlgm1f(0));</div>
<div class="line"><span class="lineno">  803</span>        tmp-&gt;resetCache(timeGrid.size() - 1);</div>
<div class="line"><span class="lineno">  804</span>        process = tmp;</div>
<div class="line"><span class="lineno">  805</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> tmp = QuantLib::ext::dynamic_pointer_cast&lt;CrossAssetStateProcess&gt;(process)) {</div>
<div class="line"><span class="lineno">  806</span>        <span class="comment">// enable cache</span></div>
<div class="line"><span class="lineno">  807</span>        tmp-&gt;resetCache(timeGrid.size() - 1);</div>
<div class="line"><span class="lineno">  808</span>    }</div>
<div class="line"><span class="lineno">  809</span> </div>
<div class="line"><span class="lineno">  810</span>    <span class="keyword">auto</span> pathGenerator = <a class="code hl_function" href="namespace_quant_ext.html#a40a2a35ee5788c5149fcae698162f5c5">makeMultiPathGenerator</a>(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1f94f9aa9913a46b1fb84634b6058b86">calibrationPathGenerator_</a>, process, timeGrid, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a97e4afcc630ce1c1ee377a693f2c4e06">calibrationSeed_</a>,</div>
<div class="line"><span class="lineno">  811</span>                                                <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3ff8c5348202c0fb10ebd058513cefc9">ordering_</a>, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a44bcbd366a24b9989a3295b7202ec3fa">directionIntegers_</a>);</div>
<div class="line"><span class="lineno">  812</span> </div>
<div class="line"><span class="lineno">  813</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7ff206b890b8b59edb2a71e34f6836ac">calibrationSamples_</a>; ++i) {</div>
<div class="line"><span class="lineno">  814</span>        <span class="keyword">const</span> MultiPath&amp; path = pathGenerator-&gt;next().value;</div>
<div class="line"><span class="lineno">  815</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt; simulationTimes.size(); ++j) {</div>
<div class="line"><span class="lineno">  816</span>            <span class="keywordflow">for</span> (Size k = 0; k &lt; <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;stateProcess()-&gt;size(); ++k) {</div>
<div class="line"><span class="lineno">  817</span>                pathValues[j][k].data()[i] = path[k][j + 1];</div>
<div class="line"><span class="lineno">  818</span>            }</div>
<div class="line"><span class="lineno">  819</span>        }</div>
<div class="line"><span class="lineno">  820</span>    }</div>
<div class="line"><span class="lineno">  821</span> </div>
<div class="line"><span class="lineno">  822</span>    McEngineStats::instance().path_timer.stop();</div>
<div class="line"><span class="lineno">  823</span> </div>
<div class="line"><span class="lineno">  824</span>    McEngineStats::instance().calc_timer.resume();</div>
<div class="line"><span class="lineno">  825</span> </div>
<div class="line"><span class="lineno">  826</span>    <span class="comment">// for each xva and exercise time collect the relevant cashflow amounts and train a model on them</span></div>
<div class="line"><span class="lineno">  827</span> </div>
<div class="line"><span class="lineno">  828</span>    std::vector&lt;RegressionModel&gt; regModelUndDirty(exerciseXvaTimes.size());          <span class="comment">// available on xva times</span></div>
<div class="line"><span class="lineno">  829</span>    std::vector&lt;RegressionModel&gt; regModelUndExInto(exerciseXvaTimes.size());         <span class="comment">// available on xva and ex times</span></div>
<div class="line"><span class="lineno">  830</span>    std::vector&lt;RegressionModel&gt; regModelContinuationValue(exerciseXvaTimes.size()); <span class="comment">// available on ex times</span></div>
<div class="line"><span class="lineno">  831</span>    std::vector&lt;RegressionModel&gt; regModelOption(exerciseXvaTimes.size());            <span class="comment">// available on xva and ex times</span></div>
<div class="line"><span class="lineno">  832</span> </div>
<div class="line"><span class="lineno">  833</span>    <span class="keyword">enum class</span> CfStatus { open, cached, done };</div>
<div class="line"><span class="lineno">  834</span>    std::vector&lt;CfStatus&gt; cfStatus(cashflowInfo.size(), CfStatus::open);</div>
<div class="line"><span class="lineno">  835</span> </div>
<div class="line"><span class="lineno">  836</span>    RandomVariable pathValueUndDirty(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7ff206b890b8b59edb2a71e34f6836ac">calibrationSamples_</a>);</div>
<div class="line"><span class="lineno">  837</span>    RandomVariable pathValueUndExInto(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7ff206b890b8b59edb2a71e34f6836ac">calibrationSamples_</a>);</div>
<div class="line"><span class="lineno">  838</span>    RandomVariable pathValueOption(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7ff206b890b8b59edb2a71e34f6836ac">calibrationSamples_</a>);</div>
<div class="line"><span class="lineno">  839</span> </div>
<div class="line"><span class="lineno">  840</span>    std::vector&lt;RandomVariable&gt; amountCache(cashflowInfo.size());</div>
<div class="line"><span class="lineno">  841</span> </div>
<div class="line"><span class="lineno">  842</span>    Size counter = exerciseXvaTimes.size() - 1;</div>
<div class="line"><span class="lineno">  843</span> </div>
<div class="line"><span class="lineno">  844</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> t = exerciseXvaTimes.rbegin(); t != exerciseXvaTimes.rend(); ++t) {</div>
<div class="line"><span class="lineno">  845</span> </div>
<div class="line"><span class="lineno">  846</span>        <span class="keywordtype">bool</span> isExerciseTime = exerciseTimes.find(*t) != exerciseTimes.end();</div>
<div class="line"><span class="lineno">  847</span>        <span class="keywordtype">bool</span> isXvaTime = xvaTimes.find(*t) != xvaTimes.end();</div>
<div class="line"><span class="lineno">  848</span> </div>
<div class="line"><span class="lineno">  849</span>        <span class="keywordflow">for</span> (Size i = 0; i &lt; cashflowInfo.size(); ++i) {</div>
<div class="line"><span class="lineno">  850</span> </div>
<div class="line"><span class="lineno">  851</span>            <span class="comment">/* we assume here that exIntoCriterionTime &gt; t implies payTime &gt; t, this must be ensured by the</span></div>
<div class="line"><span class="lineno">  852</span><span class="comment">               createCashflowInfo method */</span></div>
<div class="line"><span class="lineno">  853</span> </div>
<div class="line"><span class="lineno">  854</span>            <span class="keywordflow">if</span> (cfStatus[i] == CfStatus::open) {</div>
<div class="line"><span class="lineno">  855</span>                <span class="keywordflow">if</span> (cashflowInfo[i].exIntoCriterionTime &gt; *t) {</div>
<div class="line"><span class="lineno">  856</span>                    <span class="keyword">auto</span> tmp = <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3e8a0b968ffaadf758f6af955da9ce5b">cashflowPathValue</a>(cashflowInfo[i], pathValues, simulationTimes);</div>
<div class="line"><span class="lineno">  857</span>                    pathValueUndDirty += tmp;</div>
<div class="line"><span class="lineno">  858</span>                    pathValueUndExInto += tmp;</div>
<div class="line"><span class="lineno">  859</span>                    cfStatus[i] = CfStatus::done;</div>
<div class="line"><span class="lineno">  860</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cashflowInfo[i].payTime &gt; *t - (<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ad9543729c4f91803553a520d5f62f488">includeSettlementDateFlows_</a> ? <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a66e090204366fe36e30053934bca5e44">tinyTime</a> : 0.0)) {</div>
<div class="line"><span class="lineno">  861</span>                    <span class="keyword">auto</span> tmp = <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3e8a0b968ffaadf758f6af955da9ce5b">cashflowPathValue</a>(cashflowInfo[i], pathValues, simulationTimes);</div>
<div class="line"><span class="lineno">  862</span>                    pathValueUndDirty += tmp;</div>
<div class="line"><span class="lineno">  863</span>                    amountCache[i] = tmp;</div>
<div class="line"><span class="lineno">  864</span>                    cfStatus[i] = CfStatus::cached;</div>
<div class="line"><span class="lineno">  865</span>                }</div>
<div class="line"><span class="lineno">  866</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfStatus[i] == CfStatus::cached) {</div>
<div class="line"><span class="lineno">  867</span>                <span class="keywordflow">if</span> (cashflowInfo[i].exIntoCriterionTime &gt; *t) {</div>
<div class="line"><span class="lineno">  868</span>                    pathValueUndExInto += amountCache[i];</div>
<div class="line"><span class="lineno">  869</span>                    cfStatus[i] = CfStatus::done;</div>
<div class="line"><span class="lineno">  870</span>                    amountCache[i].clear();</div>
<div class="line"><span class="lineno">  871</span>                }</div>
<div class="line"><span class="lineno">  872</span>            }</div>
<div class="line"><span class="lineno">  873</span>        }</div>
<div class="line"><span class="lineno">  874</span> </div>
<div class="line"><span class="lineno">  875</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3753e6fd374bc155f6c3eaaec71d6441">exercise_</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  876</span>            regModelUndExInto[counter] = RegressionModel(</div>
<div class="line"><span class="lineno">  877</span>                *t, cashflowInfo, [&amp;cfStatus](std::size_t i) { <span class="keywordflow">return</span> cfStatus[i] == CfStatus::done; }, **<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>,</div>
<div class="line"><span class="lineno">  878</span>                <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a0963458f7890a5310185715c50f45512">regressorModel_</a>, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a29309ad290a75bf279f34e60c84bed59">regressionVarianceCutoff_</a>);</div>
<div class="line"><span class="lineno">  879</span>            regModelUndExInto[counter].train(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a72b1f12993111e76ce1324e1cda416b3">polynomOrder_</a>, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4eb8330d156ae243b17254734beea361">polynomType_</a>, pathValueUndExInto, pathValuesRef,</div>
<div class="line"><span class="lineno">  880</span>                                             simulationTimes);</div>
<div class="line"><span class="lineno">  881</span>        }</div>
<div class="line"><span class="lineno">  882</span> </div>
<div class="line"><span class="lineno">  883</span>        <span class="keywordflow">if</span> (isExerciseTime) {</div>
<div class="line"><span class="lineno">  884</span>            <span class="keyword">auto</span> exerciseValue = regModelUndExInto[counter].apply(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;stateProcess()-&gt;initialValues(),</div>
<div class="line"><span class="lineno">  885</span>                                                                  pathValuesRef, simulationTimes);</div>
<div class="line"><span class="lineno">  886</span>            regModelContinuationValue[counter] = RegressionModel(</div>
<div class="line"><span class="lineno">  887</span>                *t, cashflowInfo, [&amp;cfStatus](std::size_t i) { <span class="keywordflow">return</span> cfStatus[i] == CfStatus::done; }, **<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>,</div>
<div class="line"><span class="lineno">  888</span>                <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a0963458f7890a5310185715c50f45512">regressorModel_</a>, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a29309ad290a75bf279f34e60c84bed59">regressionVarianceCutoff_</a>);</div>
<div class="line"><span class="lineno">  889</span>            regModelContinuationValue[counter].train(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a72b1f12993111e76ce1324e1cda416b3">polynomOrder_</a>, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4eb8330d156ae243b17254734beea361">polynomType_</a>, pathValueOption, pathValuesRef,</div>
<div class="line"><span class="lineno">  890</span>                                                     simulationTimes,</div>
<div class="line"><span class="lineno">  891</span>                                                     exerciseValue &gt; RandomVariable(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7ff206b890b8b59edb2a71e34f6836ac">calibrationSamples_</a>, 0.0));</div>
<div class="line"><span class="lineno">  892</span>            <span class="keyword">auto</span> continuationValue = regModelContinuationValue[counter].apply(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;stateProcess()-&gt;initialValues(),</div>
<div class="line"><span class="lineno">  893</span>                                                                              pathValuesRef, simulationTimes);</div>
<div class="line"><span class="lineno">  894</span>            pathValueOption = <a class="code hl_function" href="namespace_quant_ext.html#a5eef0019503200ce1a6623788e33064d">conditionalResult</a>(exerciseValue &gt; continuationValue &amp;&amp;</div>
<div class="line"><span class="lineno">  895</span>                                                    exerciseValue &gt; RandomVariable(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7ff206b890b8b59edb2a71e34f6836ac">calibrationSamples_</a>, 0.0),</div>
<div class="line"><span class="lineno">  896</span>                                                pathValueUndExInto, pathValueOption);</div>
<div class="line"><span class="lineno">  897</span>            regModelOption[counter] = RegressionModel(</div>
<div class="line"><span class="lineno">  898</span>                *t, cashflowInfo, [&amp;cfStatus](std::size_t i) { <span class="keywordflow">return</span> cfStatus[i] == CfStatus::done; }, **<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>,</div>
<div class="line"><span class="lineno">  899</span>                <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a0963458f7890a5310185715c50f45512">regressorModel_</a>, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a29309ad290a75bf279f34e60c84bed59">regressionVarianceCutoff_</a>);</div>
<div class="line"><span class="lineno">  900</span>            regModelOption[counter].train(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a72b1f12993111e76ce1324e1cda416b3">polynomOrder_</a>, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4eb8330d156ae243b17254734beea361">polynomType_</a>, pathValueOption, pathValuesRef, simulationTimes);</div>
<div class="line"><span class="lineno">  901</span>        }</div>
<div class="line"><span class="lineno">  902</span> </div>
<div class="line"><span class="lineno">  903</span>        <span class="keywordflow">if</span> (isXvaTime) {</div>
<div class="line"><span class="lineno">  904</span>            regModelUndDirty[counter] = RegressionModel(</div>
<div class="line"><span class="lineno">  905</span>                *t, cashflowInfo, [&amp;cfStatus](std::size_t i) { <span class="keywordflow">return</span> cfStatus[i] != CfStatus::open; }, **<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>,</div>
<div class="line"><span class="lineno">  906</span>                <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a0963458f7890a5310185715c50f45512">regressorModel_</a>, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a29309ad290a75bf279f34e60c84bed59">regressionVarianceCutoff_</a>);</div>
<div class="line"><span class="lineno">  907</span>            regModelUndDirty[counter].train(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a72b1f12993111e76ce1324e1cda416b3">polynomOrder_</a>, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4eb8330d156ae243b17254734beea361">polynomType_</a>, pathValueUndDirty, pathValuesRef,</div>
<div class="line"><span class="lineno">  908</span>                                            simulationTimes);</div>
<div class="line"><span class="lineno">  909</span>        }</div>
<div class="line"><span class="lineno">  910</span> </div>
<div class="line"><span class="lineno">  911</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3753e6fd374bc155f6c3eaaec71d6441">exercise_</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  912</span>            regModelOption[counter] = RegressionModel(</div>
<div class="line"><span class="lineno">  913</span>                *t, cashflowInfo, [&amp;cfStatus](std::size_t i) { <span class="keywordflow">return</span> cfStatus[i] == CfStatus::done; }, **<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>,</div>
<div class="line"><span class="lineno">  914</span>                <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a0963458f7890a5310185715c50f45512">regressorModel_</a>, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a29309ad290a75bf279f34e60c84bed59">regressionVarianceCutoff_</a>);</div>
<div class="line"><span class="lineno">  915</span>            regModelOption[counter].train(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a72b1f12993111e76ce1324e1cda416b3">polynomOrder_</a>, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4eb8330d156ae243b17254734beea361">polynomType_</a>, pathValueOption, pathValuesRef, simulationTimes);</div>
<div class="line"><span class="lineno">  916</span>        }</div>
<div class="line"><span class="lineno">  917</span> </div>
<div class="line"><span class="lineno">  918</span>        --counter;</div>
<div class="line"><span class="lineno">  919</span>    }</div>
<div class="line"><span class="lineno">  920</span> </div>
<div class="line"><span class="lineno">  921</span>    <span class="comment">// add the remaining live cashflows to get the underlying value</span></div>
<div class="line"><span class="lineno">  922</span> </div>
<div class="line"><span class="lineno">  923</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; cashflowInfo.size(); ++i) {</div>
<div class="line"><span class="lineno">  924</span>        <span class="keywordflow">if</span> (cfStatus[i] == CfStatus::open)</div>
<div class="line"><span class="lineno">  925</span>            pathValueUndDirty += <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3e8a0b968ffaadf758f6af955da9ce5b">cashflowPathValue</a>(cashflowInfo[i], pathValues, simulationTimes);</div>
<div class="line"><span class="lineno">  926</span>    }</div>
<div class="line"><span class="lineno">  927</span> </div>
<div class="line"><span class="lineno">  928</span>    <span class="comment">// set the result value (= underlying value if no exercise is given, otherwise option value)</span></div>
<div class="line"><span class="lineno">  929</span> </div>
<div class="line"><span class="lineno">  930</span>    <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4735af14c02f445241b8222ff6fedf25">resultUnderlyingNpv_</a> = <a class="code hl_function" href="namespace_quant_ext.html#a8c7149e5256e71f377e1810576ac6b4c">expectation</a>(pathValueUndDirty).<a class="code hl_function" href="struct_quant_ext_1_1_random_variable.html#a52b7b894964a2a061ce79c386c3e3e8f">at</a>(0) * <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;numeraire(0, 0.0, 0.0, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9f5cc25da87a57e846f4601d9e86f7d9">discountCurves_</a>[0]);</div>
<div class="line"><span class="lineno">  931</span>    <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ae97465b2b8e93dcb73303587635ff486">resultValue_</a> = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3753e6fd374bc155f6c3eaaec71d6441">exercise_</a> == <span class="keyword">nullptr</span></div>
<div class="line"><span class="lineno">  932</span>                       ? <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4735af14c02f445241b8222ff6fedf25">resultUnderlyingNpv_</a></div>
<div class="line"><span class="lineno">  933</span>                       : <a class="code hl_function" href="namespace_quant_ext.html#a8c7149e5256e71f377e1810576ac6b4c">expectation</a>(pathValueOption).<a class="code hl_function" href="struct_quant_ext_1_1_random_variable.html#a52b7b894964a2a061ce79c386c3e3e8f">at</a>(0) * <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;numeraire(0, 0.0, 0.0, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9f5cc25da87a57e846f4601d9e86f7d9">discountCurves_</a>[0]);</div>
<div class="line"><span class="lineno">  934</span> </div>
<div class="line"><span class="lineno">  935</span>    McEngineStats::instance().calc_timer.stop();</div>
<div class="line"><span class="lineno">  936</span> </div>
<div class="line"><span class="lineno">  937</span>    <span class="comment">// construct the amc calculator</span></div>
<div class="line"><span class="lineno">  938</span> </div>
<div class="line"><span class="lineno">  939</span>    <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a6b390954ac7a2dc37c37d361a3218aaf">amcCalculator_</a> = QuantLib::ext::make_shared&lt;MultiLegBaseAmcCalculator&gt;(</div>
<div class="line"><span class="lineno">  940</span>        <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ae26491a56f9b83c6d0b5a8716029d95b">externalModelIndices_</a>, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a2805e91fa95c78b11a135d5fe7df516e">optionSettlement_</a>, exerciseXvaTimes, exerciseTimes, xvaTimes, regModelUndDirty,</div>
<div class="line"><span class="lineno">  941</span>        regModelUndExInto, regModelContinuationValue, regModelOption, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ae97465b2b8e93dcb73303587635ff486">resultValue_</a>,</div>
<div class="line"><span class="lineno">  942</span>        <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;stateProcess()-&gt;initialValues(), <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;irlgm1f(0)-&gt;currency());</div>
<div class="line"><span class="lineno">  943</span>}</div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a1951be97f2884589014cdbfcfff3ed9e"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1951be97f2884589014cdbfcfff3ed9e">QuantExt::McMultiLegBaseEngine::lgmVectorised_</a></div><div class="ttdeci">std::vector&lt; LgmVectorised &gt; lgmVectorised_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00215">mcmultilegbaseengine.hpp:215</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a2805e91fa95c78b11a135d5fe7df516e"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a2805e91fa95c78b11a135d5fe7df516e">QuantExt::McMultiLegBaseEngine::optionSettlement_</a></div><div class="ttdeci">Settlement::Type optionSettlement_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00097">mcmultilegbaseengine.hpp:97</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a2998ea0dd746f75f1d83fe1d7cd3c6ab"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a2998ea0dd746f75f1d83fe1d7cd3c6ab">QuantExt::McMultiLegBaseEngine::currency_</a></div><div class="ttdeci">std::vector&lt; Currency &gt; currency_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00094">mcmultilegbaseengine.hpp:94</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a3753e6fd374bc155f6c3eaaec71d6441"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3753e6fd374bc155f6c3eaaec71d6441">QuantExt::McMultiLegBaseEngine::exercise_</a></div><div class="ttdeci">QuantLib::ext::shared_ptr&lt; Exercise &gt; exercise_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00096">mcmultilegbaseengine.hpp:96</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a3e8a0b968ffaadf758f6af955da9ce5b"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3e8a0b968ffaadf758f6af955da9ce5b">QuantExt::McMultiLegBaseEngine::cashflowPathValue</a></div><div class="ttdeci">RandomVariable cashflowPathValue(const CashflowInfo &amp;cf, const std::vector&lt; std::vector&lt; RandomVariable &gt; &gt; &amp;pathValues, const std::set&lt; Real &gt; &amp;simulationTimes) const</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8cpp_source.html#l00647">mcmultilegbaseengine.cpp:647</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a4735af14c02f445241b8222ff6fedf25"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a4735af14c02f445241b8222ff6fedf25">QuantExt::McMultiLegBaseEngine::resultUnderlyingNpv_</a></div><div class="ttdeci">Real resultUnderlyingNpv_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00119">mcmultilegbaseengine.hpp:119</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a66e090204366fe36e30053934bca5e44"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a66e090204366fe36e30053934bca5e44">QuantExt::McMultiLegBaseEngine::tinyTime</a></div><div class="ttdeci">static constexpr Real tinyTime</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00122">mcmultilegbaseengine.hpp:122</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a6b390954ac7a2dc37c37d361a3218aaf"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a6b390954ac7a2dc37c37d361a3218aaf">QuantExt::McMultiLegBaseEngine::amcCalculator_</a></div><div class="ttdeci">QuantLib::ext::shared_ptr&lt; AmcCalculator &gt; amcCalculator_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00116">mcmultilegbaseengine.hpp:116</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a7f75cec33506ad7f47bce5f6908750bc"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7f75cec33506ad7f47bce5f6908750bc">QuantExt::McMultiLegBaseEngine::createCashflowInfo</a></div><div class="ttdeci">CashflowInfo createCashflowInfo(QuantLib::ext::shared_ptr&lt; CashFlow &gt; flow, const Currency &amp;payCcy, bool payer, Size legNo, Size cfNo) const</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8cpp_source.html#l00071">mcmultilegbaseengine.cpp:71</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a9616e98344f1aaf32238783d4d9a1e8e"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">QuantExt::McMultiLegBaseEngine::time</a></div><div class="ttdeci">Real time(const Date &amp;d) const</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8cpp_source.html#l00067">mcmultilegbaseengine.cpp:67</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_abcc5672032f5d39d092b5339abb3e464"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#abcc5672032f5d39d092b5339abb3e464">QuantExt::McMultiLegBaseEngine::payer_</a></div><div class="ttdeci">std::vector&lt; bool &gt; payer_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00095">mcmultilegbaseengine.hpp:95</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_ad9543729c4f91803553a520d5f62f488"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ad9543729c4f91803553a520d5f62f488">QuantExt::McMultiLegBaseEngine::includeSettlementDateFlows_</a></div><div class="ttdeci">bool includeSettlementDateFlows_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00098">mcmultilegbaseengine.hpp:98</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_ade1327900ed6bd5963ee61818948c515"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ade1327900ed6bd5963ee61818948c515">QuantExt::McMultiLegBaseEngine::leg_</a></div><div class="ttdeci">std::vector&lt; Leg &gt; leg_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00093">mcmultilegbaseengine.hpp:93</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_ae97465b2b8e93dcb73303587635ff486"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#ae97465b2b8e93dcb73303587635ff486">QuantExt::McMultiLegBaseEngine::resultValue_</a></div><div class="ttdeci">Real resultValue_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00119">mcmultilegbaseengine.hpp:119</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_aedc6b4c263e4e87835f8fa59891ccd70"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aedc6b4c263e4e87835f8fa59891ccd70">QuantExt::McMultiLegBaseEngine::today_</a></div><div class="ttdeci">Date today_</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8hpp_source.html#l00212">mcmultilegbaseengine.hpp:212</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_a40a2a35ee5788c5149fcae698162f5c5"><div class="ttname"><a href="namespace_quant_ext.html#a40a2a35ee5788c5149fcae698162f5c5">QuantExt::makeMultiPathGenerator</a></div><div class="ttdeci">QuantLib::ext::shared_ptr&lt; MultiPathGeneratorBase &gt; makeMultiPathGenerator(const SequenceType s, const QuantLib::ext::shared_ptr&lt; StochasticProcess &gt; &amp;process, const TimeGrid &amp;timeGrid, const BigNatural seed, const SobolBrownianGenerator::Ordering ordering, const SobolRsg::DirectionIntegers directionIntegers)</div><div class="ttdoc">Make function for path generators.</div><div class="ttdef"><b>Definition:</b> <a href="multipathgeneratorbase_8cpp_source.html#l00190">multipathgeneratorbase.cpp:190</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_a5eef0019503200ce1a6623788e33064d"><div class="ttname"><a href="namespace_quant_ext.html#a5eef0019503200ce1a6623788e33064d">QuantExt::conditionalResult</a></div><div class="ttdeci">RandomVariable conditionalResult(const Filter &amp;f, RandomVariable x, const RandomVariable &amp;y)</div><div class="ttdef"><b>Definition:</b> <a href="qle_2math_2randomvariable_8cpp_source.html#l00872">randomvariable.cpp:872</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_a8c7149e5256e71f377e1810576ac6b4c"><div class="ttname"><a href="namespace_quant_ext.html#a8c7149e5256e71f377e1810576ac6b4c">QuantExt::expectation</a></div><div class="ttdeci">RandomVariable expectation(const RandomVariable &amp;r)</div><div class="ttdef"><b>Definition:</b> <a href="qle_2math_2randomvariable_8cpp_source.html#l01271">randomvariable.cpp:1271</a></div></div>
<div class="ttc" id="astruct_quant_ext_1_1_random_variable_html_a52b7b894964a2a061ce79c386c3e3e8f"><div class="ttname"><a href="struct_quant_ext_1_1_random_variable.html#a52b7b894964a2a061ce79c386c3e3e8f">QuantExt::RandomVariable::at</a></div><div class="ttdeci">Real at(const Size i) const</div><div class="ttdef"><b>Definition:</b> <a href="randomvariable_8hpp_source.html#l00365">randomvariable.hpp:365</a></div></div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_mc_multi_leg_base_engine_a082ff96da379d5e17436372ccb3c0972_cgraph.png" border="0" usemap="#aclass_quant_ext_1_1_mc_multi_leg_base_engine_a082ff96da379d5e17436372ccb3c0972_cgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a082ff96da379d5e17436372ccb3c0972_cgraph" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a082ff96da379d5e17436372ccb3c0972_cgraph">
<area shape="rect" title=" " alt="" coords="5,289,80,315"/>
<area shape="rect" href="struct_quant_ext_1_1_random_variable.html#a52b7b894964a2a061ce79c386c3e3e8f" title=" " alt="" coords="690,19,889,44"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3e8a0b968ffaadf758f6af955da9ce5b" title=" " alt="" coords="177,125,309,151"/>
<area shape="rect" href="struct_quant_ext_1_1_random_variable.html#ac8bb3912a3ce86b15842e79d0b421204" title=" " alt="" coords="153,175,333,215"/>
<area shape="rect" href="namespace_quant_ext.html#a5eef0019503200ce1a6623788e33064d" title=" " alt="" coords="151,240,335,265"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7f75cec33506ad7f47bce5f6908750bc" title=" " alt="" coords="177,289,308,315"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e" title=" " alt="" coords="495,289,541,315"/>
<area shape="rect" href="namespace_quant_ext.html#a8c7149e5256e71f377e1810576ac6b4c" title=" " alt="" coords="713,624,865,649"/>
<area shape="rect" href="namespace_quant_ext.html#a40a2a35ee5788c5149fcae698162f5c5" title="Make function for path generators." alt="" coords="128,525,357,551"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_base_engine_1_1_regression_model.html#a764ca841f3168fcbc859f86f82610cff" title=" " alt="" coords="151,447,334,501"/>
<area shape="rect" href="struct_quant_ext_1_1_random_variable.html#ab17ca9201257d4ffe0a02fef0500ea93" title=" " alt="" coords="976,11,1156,51"/>
<area shape="rect" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f" title=" " alt="" coords="465,191,571,216"/>
<area shape="rect" href="struct_quant_ext_1_1_random_variable.html#acce0ab2cacc475b2434f24c65c91685a" title=" " alt="" coords="976,518,1156,558"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a83cea99ba49a654e2a8db95962e4c768" title=" " alt="" coords="479,89,557,115"/>
<area shape="rect" href="namespace_quant_ext.html#ac0bb3279caaa02e9f9dd6e85a687cba8" title=" " alt="" coords="463,240,573,265"/>
<area shape="rect" href="struct_quant_ext_1_1_random_variable.html#a6e0fdc031c26ed1d1a956019d2cee4a1" title=" " alt="" coords="976,582,1156,622"/>
<area shape="rect" href="namespace_quant_ext.html#afd07a4600ac3a637b23a9856e5ae8550" title=" " alt="" coords="429,454,607,494"/>
<area shape="rect" href="namespace_quant_ext.html#a46878f982fe1527b9ae08c6242467ab6" title=" " alt="" coords="425,519,611,544"/>
<area shape="rect" href="namespace_quant_ext.html#a0a2b3f313047ac1448c08512830e4ff1" title=" " alt="" coords="431,339,605,379"/>
<area shape="rect" href="namespace_quant_ext.html#adaa3926f46b7aa49adf717313b57fa6a" title=" " alt="" coords="405,568,631,593"/>
<area shape="rect" href="namespace_quant_ext.html#ae798e9c60d2b43edc743d6d97b750858" title=" " alt="" coords="683,704,895,729"/>
<area shape="rect" href="namespace_quant_ext.html#a8643e370bba986ab461dfa44c68024af" title=" " alt="" coords="445,617,591,643"/>
<area shape="rect" href="class_quant_ext_1_1_random_variable_lsm_basis_system.html#afda64cfa2cd7fc1e3687b0b960048c70" title=" " alt="" coords="679,68,900,123"/>
<area shape="rect" href="class_quant_ext_1_1_random_variable_lsm_basis_system.html#ad716230a0629423ed1ce9b369d5ec302" title=" " alt="" coords="699,339,879,379"/>
<area shape="rect" href="class_quant_ext_1_1_random_variable_lsm_basis_system.html#a94040e7a7194f8fbdfbbaf939c999deb" title=" " alt="" coords="948,75,1184,115"/>
<area shape="rect" href="namespace_quant_ext.html#a756bd6e509451ebf3e45cdb41df38eb5" title=" " alt="" coords="716,575,863,600"/>
<area shape="rect" href="namespace_quant_ext.html#a249dd19ff90e20ad4b64b0be1665b5c0" title=" " alt="" coords="723,525,855,551"/>
<area shape="rect" href="namespace_quant_ext.html#ac2c9fc833a3c248658a83c6236b30f2d" title=" " alt="" coords="993,696,1139,721"/>
<area shape="rect" href="struct_quant_ext_1_1_random_variable.html#a9d395fe67d6ce574f9fe50c93d9ed697" title=" " alt="" coords="976,746,1156,786"/>
<area shape="rect" href="struct_quant_ext_1_1_random_variable.html#a1817d0ea2dfb347d98710c98de38abb6" title=" " alt="" coords="976,810,1156,850"/>
<area shape="rect" href="struct_quant_ext_1_1_filter.html#adaeda39d7b8cc716a40c4da65b00ba77" title=" " alt="" coords="978,875,1154,900"/>
<area shape="rect" href="struct_quant_ext_1_1_filter.html#acce0ab2cacc475b2434f24c65c91685a" title=" " alt="" coords="993,647,1139,672"/>
</map>
</div>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_mc_multi_leg_base_engine_a082ff96da379d5e17436372ccb3c0972_icgraph.png" border="0" usemap="#aclass_quant_ext_1_1_mc_multi_leg_base_engine_a082ff96da379d5e17436372ccb3c0972_icgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a082ff96da379d5e17436372ccb3c0972_icgraph" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a082ff96da379d5e17436372ccb3c0972_icgraph">
<area shape="rect" title=" " alt="" coords="276,205,351,230"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_currency_swap_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="9,5,224,45"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_fx_forward_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="21,69,212,109"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_fx_option_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,133,228,173"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_swap_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="17,197,217,237"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_swaption_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="6,261,227,301"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_nonstandard_swaption_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="16,325,217,365"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_option_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="21,389,212,429"/>
</map>
</div>

</div>
</div>
<a id="abc69a9dc670afb47dfa4293ba960f981" name="abc69a9dc670afb47dfa4293ba960f981"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc69a9dc670afb47dfa4293ba960f981">&#9670;&#160;</a></span>amcCalculator()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::ext::shared_ptr&lt; <a class="el" href="class_quant_ext_1_1_amc_calculator.html">AmcCalculator</a> &gt; amcCalculator </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8cpp_source.html#l00945">945</a> of file <a class="el" href="mcmultilegbaseengine_8cpp_source.html">mcmultilegbaseengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  945</span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a6b390954ac7a2dc37c37d361a3218aaf">amcCalculator_</a>; }</div>
</div><!-- fragment --><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_mc_multi_leg_base_engine_abc69a9dc670afb47dfa4293ba960f981_icgraph.png" border="0" usemap="#aclass_quant_ext_1_1_mc_multi_leg_base_engine_abc69a9dc670afb47dfa4293ba960f981_icgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_mc_multi_leg_base_engine_abc69a9dc670afb47dfa4293ba960f981_icgraph" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_abc69a9dc670afb47dfa4293ba960f981_icgraph">
<area shape="rect" title=" " alt="" coords="276,205,381,230"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_currency_swap_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="9,5,224,45"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_fx_forward_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="21,69,212,109"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_fx_option_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,133,228,173"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_swap_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="17,197,217,237"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_swaption_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="6,261,227,301"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_nonstandard_swaption_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="16,325,217,365"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_option_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="21,389,212,429"/>
</map>
</div>

</div>
</div>
<a id="a9616e98344f1aaf32238783d4d9a1e8e" name="a9616e98344f1aaf32238783d4d9a1e8e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9616e98344f1aaf32238783d4d9a1e8e">&#9670;&#160;</a></span>time()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Real time </td>
          <td>(</td>
          <td class="paramtype">const Date &amp;&#160;</td>
          <td class="paramname"><em>d</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8cpp_source.html#l00067">67</a> of file <a class="el" href="mcmultilegbaseengine_8cpp_source.html">mcmultilegbaseengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   67</span>                                                   {</div>
<div class="line"><span class="lineno">   68</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;irlgm1f(0)-&gt;termStructure()-&gt;timeFromReference(d);</div>
<div class="line"><span class="lineno">   69</span>}</div>
</div><!-- fragment --><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_mc_multi_leg_base_engine_a9616e98344f1aaf32238783d4d9a1e8e_icgraph.png" border="0" usemap="#aclass_quant_ext_1_1_mc_multi_leg_base_engine_a9616e98344f1aaf32238783d4d9a1e8e_icgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a9616e98344f1aaf32238783d4d9a1e8e_icgraph" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a9616e98344f1aaf32238783d4d9a1e8e_icgraph">
<area shape="rect" title=" " alt="" coords="577,205,624,230"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a082ff96da379d5e17436372ccb3c0972" title=" " alt="" coords="276,205,351,230"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a7f75cec33506ad7f47bce5f6908750bc" title=" " alt="" coords="399,230,529,255"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_currency_swap_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="9,5,224,45"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_fx_forward_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="21,69,212,109"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_fx_option_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,133,228,173"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_swap_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="17,197,217,237"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_swaption_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="6,261,227,301"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_nonstandard_swaption_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="16,325,217,365"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_option_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="21,389,212,429"/>
</map>
</div>

</div>
</div>
<a id="a7f75cec33506ad7f47bce5f6908750bc" name="a7f75cec33506ad7f47bce5f6908750bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f75cec33506ad7f47bce5f6908750bc">&#9670;&#160;</a></span>createCashflowInfo()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_quant_ext_1_1_mc_multi_leg_base_engine_1_1_cashflow_info.html">McMultiLegBaseEngine::CashflowInfo</a> createCashflowInfo </td>
          <td>(</td>
          <td class="paramtype">QuantLib::ext::shared_ptr&lt; CashFlow &gt;&#160;</td>
          <td class="paramname"><em>flow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Currency &amp;&#160;</td>
          <td class="paramname"><em>payCcy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>payer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Size&#160;</td>
          <td class="paramname"><em>legNo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Size&#160;</td>
          <td class="paramname"><em>cfNo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8cpp_source.html#l00071">71</a> of file <a class="el" href="mcmultilegbaseengine_8cpp_source.html">mcmultilegbaseengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   73</span>                                                                                                         {</div>
<div class="line"><span class="lineno">   74</span>    CashflowInfo info;</div>
<div class="line"><span class="lineno">   75</span> </div>
<div class="line"><span class="lineno">   76</span>    <span class="comment">// set some common info: pay time, pay ccy index in the model, payer, exercise into decision time</span></div>
<div class="line"><span class="lineno">   77</span> </div>
<div class="line"><span class="lineno">   78</span>    info.legNo = legNo;</div>
<div class="line"><span class="lineno">   79</span>    info.cfNo = cfNo;</div>
<div class="line"><span class="lineno">   80</span>    info.payTime = <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(flow-&gt;date());</div>
<div class="line"><span class="lineno">   81</span>    info.payCcyIndex = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(payCcy);</div>
<div class="line"><span class="lineno">   82</span>    info.payer = payer;</div>
<div class="line"><span class="lineno">   83</span> </div>
<div class="line"><span class="lineno">   84</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> cpn = QuantLib::ext::dynamic_pointer_cast&lt;Coupon&gt;(flow)) {</div>
<div class="line"><span class="lineno">   85</span>        QL_REQUIRE(cpn-&gt;accrualStartDate() &lt; flow-&gt;date(),</div>
<div class="line"><span class="lineno">   86</span>                   <span class="stringliteral">&quot;McMultiLegBaseEngine::createCashflowInfo(): coupon leg &quot;</span></div>
<div class="line"><span class="lineno">   87</span>                       &lt;&lt; legNo &lt;&lt; <span class="stringliteral">&quot; cashflow &quot;</span> &lt;&lt; cfNo &lt;&lt; <span class="stringliteral">&quot; has accrual start date (&quot;</span> &lt;&lt; cpn-&gt;accrualStartDate()</div>
<div class="line"><span class="lineno">   88</span>                       &lt;&lt; <span class="stringliteral">&quot;) &gt;= pay date (&quot;</span> &lt;&lt; flow-&gt;date()</div>
<div class="line"><span class="lineno">   89</span>                       &lt;&lt; <span class="stringliteral">&quot;), which breaks an assumption in the engine. This situation is unexpected.&quot;</span>);</div>
<div class="line"><span class="lineno">   90</span>        info.exIntoCriterionTime = <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(cpn-&gt;accrualStartDate()) + <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a66e090204366fe36e30053934bca5e44">tinyTime</a>;</div>
<div class="line"><span class="lineno">   91</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   92</span>        info.exIntoCriterionTime = info.payTime;</div>
<div class="line"><span class="lineno">   93</span>    }</div>
<div class="line"><span class="lineno">   94</span> </div>
<div class="line"><span class="lineno">   95</span>    <span class="comment">// Handle SimpleCashflow</span></div>
<div class="line"><span class="lineno">   96</span>    <span class="keywordflow">if</span> (QuantLib::ext::dynamic_pointer_cast&lt;SimpleCashFlow&gt;(flow) != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">   97</span>        info.amountCalculator = [flow](<span class="keyword">const</span> Size n, <span class="keyword">const</span> std::vector&lt;std::vector&lt;const RandomVariable*&gt;&gt;&amp; states) {</div>
<div class="line"><span class="lineno">   98</span>            <span class="keywordflow">return</span> RandomVariable(n, flow-&gt;amount());</div>
<div class="line"><span class="lineno">   99</span>        };</div>
<div class="line"><span class="lineno">  100</span>        <span class="keywordflow">return</span> info;</div>
<div class="line"><span class="lineno">  101</span>    }</div>
<div class="line"><span class="lineno">  102</span> </div>
<div class="line"><span class="lineno">  103</span>    <span class="comment">// handle fx linked fixed cashflow</span></div>
<div class="line"><span class="lineno">  104</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> fxl = QuantLib::ext::dynamic_pointer_cast&lt;FXLinkedCashFlow&gt;(flow)) {</div>
<div class="line"><span class="lineno">  105</span>        Date fxLinkedFixingDate = fxl-&gt;fxFixingDate();</div>
<div class="line"><span class="lineno">  106</span>        Size fxLinkedSourceCcyIdx = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(fxl-&gt;fxIndex()-&gt;sourceCurrency());</div>
<div class="line"><span class="lineno">  107</span>        Size fxLinkedTargetCcyIdx = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(fxl-&gt;fxIndex()-&gt;targetCurrency());</div>
<div class="line"><span class="lineno">  108</span>        <span class="keywordflow">if</span> (fxLinkedFixingDate &gt; <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aedc6b4c263e4e87835f8fa59891ccd70">today_</a>) {</div>
<div class="line"><span class="lineno">  109</span>            Real fxSimTime = <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(fxLinkedFixingDate);</div>
<div class="line"><span class="lineno">  110</span>            info.simulationTimes.push_back(fxSimTime);</div>
<div class="line"><span class="lineno">  111</span>            info.modelIndices.push_back({});</div>
<div class="line"><span class="lineno">  112</span>            <span class="keywordflow">if</span> (fxLinkedSourceCcyIdx &gt; 0) {</div>
<div class="line"><span class="lineno">  113</span>                info.modelIndices.front().push_back(</div>
<div class="line"><span class="lineno">  114</span>                    <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfeab8b5089c70ae62534970e2d8aa67e96d">CrossAssetModel::AssetType::FX</a>, fxLinkedSourceCcyIdx - 1));</div>
<div class="line"><span class="lineno">  115</span>            }</div>
<div class="line"><span class="lineno">  116</span>            <span class="keywordflow">if</span> (fxLinkedTargetCcyIdx &gt; 0) {</div>
<div class="line"><span class="lineno">  117</span>                info.modelIndices.front().push_back(</div>
<div class="line"><span class="lineno">  118</span>                    <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfeab8b5089c70ae62534970e2d8aa67e96d">CrossAssetModel::AssetType::FX</a>, fxLinkedTargetCcyIdx - 1));</div>
<div class="line"><span class="lineno">  119</span>            }</div>
<div class="line"><span class="lineno">  120</span>        }</div>
<div class="line"><span class="lineno">  121</span>        info.amountCalculator = [<span class="keyword">this</span>, fxLinkedSourceCcyIdx, fxLinkedTargetCcyIdx, fxLinkedFixingDate,</div>
<div class="line"><span class="lineno">  122</span>                                 fxl](<span class="keyword">const</span> Size n, <span class="keyword">const</span> std::vector&lt;std::vector&lt;const RandomVariable*&gt;&gt;&amp; states) {</div>
<div class="line"><span class="lineno">  123</span>            <span class="keywordflow">if</span> (fxLinkedFixingDate &lt;= <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aedc6b4c263e4e87835f8fa59891ccd70">today_</a>)</div>
<div class="line"><span class="lineno">  124</span>                <span class="keywordflow">return</span> RandomVariable(n, fxl-&gt;amount());</div>
<div class="line"><span class="lineno">  125</span>            RandomVariable fxSource(n, 1.0), fxTarget(n, 1.0);</div>
<div class="line"><span class="lineno">  126</span>            Size fxIdx = 0;</div>
<div class="line"><span class="lineno">  127</span>            <span class="keywordflow">if</span> (fxLinkedSourceCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  128</span>                fxSource = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(0).at(fxIdx++));</div>
<div class="line"><span class="lineno">  129</span>            <span class="keywordflow">if</span> (fxLinkedTargetCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  130</span>                fxTarget = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(0).at(fxIdx));</div>
<div class="line"><span class="lineno">  131</span>            <span class="keywordflow">return</span> RandomVariable(n, fxl-&gt;foreignAmount()) * fxSource / fxTarget;</div>
<div class="line"><span class="lineno">  132</span>        };</div>
<div class="line"><span class="lineno">  133</span> </div>
<div class="line"><span class="lineno">  134</span>        <span class="keywordflow">return</span> info;</div>
<div class="line"><span class="lineno">  135</span>    }</div>
<div class="line"><span class="lineno">  136</span> </div>
<div class="line"><span class="lineno">  137</span>    <span class="comment">// handle some wrapped coupon types: extract the wrapper info and continue with underlying flow</span></div>
<div class="line"><span class="lineno">  138</span>    <span class="keywordtype">bool</span> isFxLinked = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  139</span>    <span class="keywordtype">bool</span> isFxIndexed = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  140</span>    Size fxLinkedSourceCcyIdx = Null&lt;Size&gt;();</div>
<div class="line"><span class="lineno">  141</span>    Size fxLinkedTargetCcyIdx = Null&lt;Size&gt;();</div>
<div class="line"><span class="lineno">  142</span>    Real fxLinkedFixedFxRate = Null&lt;Real&gt;();</div>
<div class="line"><span class="lineno">  143</span>    Real fxLinkedSimTime = Null&lt;Real&gt;();     <span class="comment">// if fx fixing date &gt; today</span></div>
<div class="line"><span class="lineno">  144</span>    Real fxLinkedForeignNominal = Null&lt;Real&gt;();</div>
<div class="line"><span class="lineno">  145</span>    std::vector&lt;Size&gt; fxLinkedModelIndices;</div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>    <span class="comment">// A Coupon could be wrapped in a FxLinkedCoupon or IndexedCoupon but not both at the same time</span></div>
<div class="line"><span class="lineno">  148</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> indexCpn = QuantLib::ext::dynamic_pointer_cast&lt;IndexedCoupon&gt;(flow)) {</div>
<div class="line"><span class="lineno">  149</span>        <span class="keywordflow">if</span> (<span class="keyword">auto</span> fxIndex = QuantLib::ext::dynamic_pointer_cast&lt;FxIndex&gt;(indexCpn-&gt;index())) {</div>
<div class="line"><span class="lineno">  150</span>            isFxIndexed = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  151</span>            <span class="keyword">auto</span> <a class="code hl_function" href="namespace_quant_ext_1_1_zero_inflation.html#a57de786c1c8988b6da9d354282b4b370">fixingDate</a> = indexCpn-&gt;fixingDate();</div>
<div class="line"><span class="lineno">  152</span>            fxLinkedSourceCcyIdx = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(fxIndex-&gt;sourceCurrency());</div>
<div class="line"><span class="lineno">  153</span>            fxLinkedTargetCcyIdx = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(fxIndex-&gt;targetCurrency());</div>
<div class="line"><span class="lineno">  154</span>            <span class="keywordflow">if</span> (fixingDate &lt;= <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aedc6b4c263e4e87835f8fa59891ccd70">today_</a>) {</div>
<div class="line"><span class="lineno">  155</span>                fxLinkedFixedFxRate = fxIndex-&gt;fixing(fixingDate);</div>
<div class="line"><span class="lineno">  156</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  157</span>                fxLinkedSimTime = <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(fixingDate);</div>
<div class="line"><span class="lineno">  158</span>                <span class="keywordflow">if</span> (fxLinkedSourceCcyIdx &gt; 0) {</div>
<div class="line"><span class="lineno">  159</span>                    fxLinkedModelIndices.push_back(</div>
<div class="line"><span class="lineno">  160</span>                        <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfeab8b5089c70ae62534970e2d8aa67e96d">CrossAssetModel::AssetType::FX</a>, fxLinkedSourceCcyIdx - 1));</div>
<div class="line"><span class="lineno">  161</span>                }</div>
<div class="line"><span class="lineno">  162</span>                <span class="keywordflow">if</span> (fxLinkedTargetCcyIdx &gt; 0) {</div>
<div class="line"><span class="lineno">  163</span>                    fxLinkedModelIndices.push_back(</div>
<div class="line"><span class="lineno">  164</span>                        <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfeab8b5089c70ae62534970e2d8aa67e96d">CrossAssetModel::AssetType::FX</a>, fxLinkedTargetCcyIdx - 1));</div>
<div class="line"><span class="lineno">  165</span>                }</div>
<div class="line"><span class="lineno">  166</span>            }</div>
<div class="line"><span class="lineno">  167</span>            flow = indexCpn-&gt;underlying();</div>
<div class="line"><span class="lineno">  168</span>        }</div>
<div class="line"><span class="lineno">  169</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> fxl = QuantLib::ext::dynamic_pointer_cast&lt;FloatingRateFXLinkedNotionalCoupon&gt;(flow)) {</div>
<div class="line"><span class="lineno">  170</span>        isFxLinked = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  171</span>        <span class="keyword">auto</span> <a class="code hl_function" href="namespace_quant_ext_1_1_zero_inflation.html#a57de786c1c8988b6da9d354282b4b370">fixingDate</a> = fxl-&gt;fxFixingDate();</div>
<div class="line"><span class="lineno">  172</span>        fxLinkedSourceCcyIdx = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(fxl-&gt;fxIndex()-&gt;sourceCurrency());</div>
<div class="line"><span class="lineno">  173</span>        fxLinkedTargetCcyIdx = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(fxl-&gt;fxIndex()-&gt;targetCurrency());</div>
<div class="line"><span class="lineno">  174</span>        <span class="keywordflow">if</span> (fixingDate &lt;= <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aedc6b4c263e4e87835f8fa59891ccd70">today_</a>) {</div>
<div class="line"><span class="lineno">  175</span>            fxLinkedFixedFxRate = fxl-&gt;fxIndex()-&gt;fixing(fixingDate);</div>
<div class="line"><span class="lineno">  176</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  177</span>            fxLinkedSimTime = <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(fixingDate);</div>
<div class="line"><span class="lineno">  178</span>            <span class="keywordflow">if</span> (fxLinkedSourceCcyIdx &gt; 0) {</div>
<div class="line"><span class="lineno">  179</span>                fxLinkedModelIndices.push_back(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfeab8b5089c70ae62534970e2d8aa67e96d">CrossAssetModel::AssetType::FX</a>, fxLinkedSourceCcyIdx - 1));</div>
<div class="line"><span class="lineno">  180</span>            }</div>
<div class="line"><span class="lineno">  181</span>            <span class="keywordflow">if</span> (fxLinkedTargetCcyIdx &gt; 0) {</div>
<div class="line"><span class="lineno">  182</span>                fxLinkedModelIndices.push_back(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfeab8b5089c70ae62534970e2d8aa67e96d">CrossAssetModel::AssetType::FX</a>, fxLinkedTargetCcyIdx - 1));</div>
<div class="line"><span class="lineno">  183</span>            }</div>
<div class="line"><span class="lineno">  184</span>        }</div>
<div class="line"><span class="lineno">  185</span>        flow = fxl-&gt;underlying();</div>
<div class="line"><span class="lineno">  186</span>        fxLinkedForeignNominal = fxl-&gt;foreignAmount();</div>
<div class="line"><span class="lineno">  187</span>    }</div>
<div class="line"><span class="lineno">  188</span> </div>
<div class="line"><span class="lineno">  189</span>    <span class="keywordtype">bool</span> isCapFloored = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  190</span>    <span class="keywordtype">bool</span> isNakedOption = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  191</span>    Real effCap = Null&lt;Real&gt;(), effFloor = Null&lt;Real&gt;();</div>
<div class="line"><span class="lineno">  192</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> stripped = QuantLib::ext::dynamic_pointer_cast&lt;StrippedCappedFlooredCoupon&gt;(flow)) {</div>
<div class="line"><span class="lineno">  193</span>        isNakedOption = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  194</span>        flow = stripped-&gt;underlying(); <span class="comment">// this is a CappedFlooredCoupon, handled below</span></div>
<div class="line"><span class="lineno">  195</span>    }</div>
<div class="line"><span class="lineno">  196</span> </div>
<div class="line"><span class="lineno">  197</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> cf = QuantLib::ext::dynamic_pointer_cast&lt;CappedFlooredCoupon&gt;(flow)) {</div>
<div class="line"><span class="lineno">  198</span>        isCapFloored = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  199</span>        effCap = cf-&gt;effectiveCap();</div>
<div class="line"><span class="lineno">  200</span>        effFloor = cf-&gt;effectiveFloor();</div>
<div class="line"><span class="lineno">  201</span>        flow = cf-&gt;underlying();</div>
<div class="line"><span class="lineno">  202</span>    }</div>
<div class="line"><span class="lineno">  203</span> </div>
<div class="line"><span class="lineno">  204</span>    <span class="comment">// handle the coupon types</span></div>
<div class="line"><span class="lineno">  205</span>    </div>
<div class="line"><span class="lineno">  206</span>    <span class="keywordflow">if</span> (QuantLib::ext::dynamic_pointer_cast&lt;FixedRateCoupon&gt;(flow) != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  207</span>        </div>
<div class="line"><span class="lineno">  208</span>        <span class="keywordflow">if</span> (fxLinkedSimTime != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  209</span>            info.simulationTimes.push_back(fxLinkedSimTime);</div>
<div class="line"><span class="lineno">  210</span>            info.modelIndices.push_back(fxLinkedModelIndices);</div>
<div class="line"><span class="lineno">  211</span>        }</div>
<div class="line"><span class="lineno">  212</span>        </div>
<div class="line"><span class="lineno">  213</span>        info.amountCalculator = [flow, isFxLinked, isFxIndexed, fxLinkedFixedFxRate,</div>
<div class="line"><span class="lineno">  214</span>                                 fxLinkedSourceCcyIdx, fxLinkedTargetCcyIdx](<span class="keyword">const</span> Size n, <span class="keyword">const</span> std::vector&lt;std::vector&lt;const RandomVariable*&gt;&gt;&amp; states) {</div>
<div class="line"><span class="lineno">  215</span>            RandomVariable fxFixing(n, 1.0);</div>
<div class="line"><span class="lineno">  216</span>            <span class="keywordflow">if</span> (isFxLinked || isFxIndexed) {</div>
<div class="line"><span class="lineno">  217</span>                <span class="keywordflow">if</span> (fxLinkedFixedFxRate != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  218</span>                    fxFixing = RandomVariable(n, fxLinkedFixedFxRate);</div>
<div class="line"><span class="lineno">  219</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  220</span>                    RandomVariable fxSource(n, 1.0), fxTarget(n, 1.0);</div>
<div class="line"><span class="lineno">  221</span>                    Size fxIdx = 0;</div>
<div class="line"><span class="lineno">  222</span>                    <span class="keywordflow">if</span> (fxLinkedSourceCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  223</span>                        fxSource = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(0).at(fxIdx++));</div>
<div class="line"><span class="lineno">  224</span>                    <span class="keywordflow">if</span> (fxLinkedTargetCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  225</span>                        fxTarget = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(0).at(fxIdx));</div>
<div class="line"><span class="lineno">  226</span>                    fxFixing = fxSource / fxTarget;</div>
<div class="line"><span class="lineno">  227</span>                }</div>
<div class="line"><span class="lineno">  228</span>            } </div>
<div class="line"><span class="lineno">  229</span>            <span class="keywordflow">return</span> fxFixing * RandomVariable(n, flow-&gt;amount());</div>
<div class="line"><span class="lineno">  230</span>        };</div>
<div class="line"><span class="lineno">  231</span>        <span class="keywordflow">return</span> info;</div>
<div class="line"><span class="lineno">  232</span>    }</div>
<div class="line"><span class="lineno">  233</span> </div>
<div class="line"><span class="lineno">  234</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> ibor = QuantLib::ext::dynamic_pointer_cast&lt;IborCoupon&gt;(flow)) {</div>
<div class="line"><span class="lineno">  235</span>        Real fixedRate =</div>
<div class="line"><span class="lineno">  236</span>            ibor-&gt;fixingDate() &lt;= <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aedc6b4c263e4e87835f8fa59891ccd70">today_</a> ? (ibor-&gt;rate() - ibor-&gt;spread()) / ibor-&gt;gearing() : Null&lt;Real&gt;();</div>
<div class="line"><span class="lineno">  237</span>        Size indexCcyIdx = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(ibor-&gt;index()-&gt;currency());</div>
<div class="line"><span class="lineno">  238</span>        Real simTime = <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(ibor-&gt;fixingDate());</div>
<div class="line"><span class="lineno">  239</span>        <span class="keywordflow">if</span> (ibor-&gt;fixingDate() &gt; <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aedc6b4c263e4e87835f8fa59891ccd70">today_</a>) {</div>
<div class="line"><span class="lineno">  240</span>            info.simulationTimes.push_back(simTime);</div>
<div class="line"><span class="lineno">  241</span>            info.modelIndices.push_back({<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704">CrossAssetModel::AssetType::IR</a>, indexCcyIdx)});</div>
<div class="line"><span class="lineno">  242</span>        }</div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span>        <span class="keywordflow">if</span> (fxLinkedSimTime != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  245</span>            info.simulationTimes.push_back(fxLinkedSimTime);</div>
<div class="line"><span class="lineno">  246</span>            info.modelIndices.push_back(fxLinkedModelIndices);</div>
<div class="line"><span class="lineno">  247</span>        } </div>
<div class="line"><span class="lineno">  248</span> </div>
<div class="line"><span class="lineno">  249</span>        info.amountCalculator = [<span class="keyword">this</span>, indexCcyIdx, ibor, simTime, fixedRate, isFxLinked, fxLinkedForeignNominal,</div>
<div class="line"><span class="lineno">  250</span>                                 fxLinkedSourceCcyIdx, fxLinkedTargetCcyIdx, fxLinkedFixedFxRate, isCapFloored,</div>
<div class="line"><span class="lineno">  251</span>                                 isNakedOption, effFloor, effCap, isFxIndexed](<span class="keyword">const</span> Size n, <span class="keyword">const</span> std::vector&lt;std::vector&lt;const RandomVariable*&gt;&gt;&amp; states) {</div>
<div class="line"><span class="lineno">  252</span>            RandomVariable fixing = fixedRate != Null&lt;Real&gt;()</div>
<div class="line"><span class="lineno">  253</span>                                        ? RandomVariable(n, fixedRate)</div>
<div class="line"><span class="lineno">  254</span>                                        : <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1951be97f2884589014cdbfcfff3ed9e">lgmVectorised_</a>[indexCcyIdx].fixing(ibor-&gt;index(), ibor-&gt;<a class="code hl_function" href="namespace_quant_ext_1_1_zero_inflation.html#a57de786c1c8988b6da9d354282b4b370">fixingDate</a>(), simTime,</div>
<div class="line"><span class="lineno">  255</span>                                                                             *states.at(0).at(0));</div>
<div class="line"><span class="lineno">  256</span>            RandomVariable fxFixing(n, 1.0);</div>
<div class="line"><span class="lineno">  257</span>            <span class="keywordflow">if</span> (isFxLinked || isFxIndexed) {</div>
<div class="line"><span class="lineno">  258</span>                <span class="keywordflow">if</span> (fxLinkedFixedFxRate != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  259</span>                    fxFixing = RandomVariable(n, fxLinkedFixedFxRate);</div>
<div class="line"><span class="lineno">  260</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  261</span>                    RandomVariable fxSource(n, 1.0), fxTarget(n, 1.0);</div>
<div class="line"><span class="lineno">  262</span>                    Size fxIdx = 0;</div>
<div class="line"><span class="lineno">  263</span>                    <span class="keywordflow">if</span> (fxLinkedSourceCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  264</span>                        fxSource = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx++));</div>
<div class="line"><span class="lineno">  265</span>                    <span class="keywordflow">if</span> (fxLinkedTargetCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  266</span>                        fxTarget = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx));</div>
<div class="line"><span class="lineno">  267</span>                    fxFixing = fxSource / fxTarget;</div>
<div class="line"><span class="lineno">  268</span>                }</div>
<div class="line"><span class="lineno">  269</span>            } </div>
<div class="line"><span class="lineno">  270</span> </div>
<div class="line"><span class="lineno">  271</span>            RandomVariable effectiveRate;</div>
<div class="line"><span class="lineno">  272</span>            <span class="keywordflow">if</span> (isCapFloored) {</div>
<div class="line"><span class="lineno">  273</span>                RandomVariable swapletRate(n, 0.0);</div>
<div class="line"><span class="lineno">  274</span>                RandomVariable floorletRate(n, 0.0);</div>
<div class="line"><span class="lineno">  275</span>                RandomVariable capletRate(n, 0.0);</div>
<div class="line"><span class="lineno">  276</span>                <span class="keywordflow">if</span> (!isNakedOption)</div>
<div class="line"><span class="lineno">  277</span>                    swapletRate = RandomVariable(n, ibor-&gt;gearing()) * fixing + RandomVariable(n, ibor-&gt;spread());</div>
<div class="line"><span class="lineno">  278</span>                <span class="keywordflow">if</span> (effFloor != Null&lt;Real&gt;())</div>
<div class="line"><span class="lineno">  279</span>                    floorletRate = RandomVariable(n, ibor-&gt;gearing()) *</div>
<div class="line"><span class="lineno">  280</span>                                   <a class="code hl_function" href="namespace_quant_ext.html#ac0bb3279caaa02e9f9dd6e85a687cba8">max</a>(RandomVariable(n, effFloor) - fixing, RandomVariable(n, 0.0));</div>
<div class="line"><span class="lineno">  281</span>                <span class="keywordflow">if</span> (effCap != Null&lt;Real&gt;())</div>
<div class="line"><span class="lineno">  282</span>                    capletRate = RandomVariable(n, ibor-&gt;gearing()) *</div>
<div class="line"><span class="lineno">  283</span>                                 <a class="code hl_function" href="namespace_quant_ext.html#ac0bb3279caaa02e9f9dd6e85a687cba8">max</a>(fixing - RandomVariable(n, effCap), RandomVariable(n, 0.0)) *</div>
<div class="line"><span class="lineno">  284</span>                                 RandomVariable(n, isNakedOption &amp;&amp; effFloor == Null&lt;Real&gt;() ? -1.0 : 1.0);</div>
<div class="line"><span class="lineno">  285</span>                effectiveRate = swapletRate + floorletRate - capletRate;</div>
<div class="line"><span class="lineno">  286</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  287</span>                effectiveRate = RandomVariable(n, ibor-&gt;gearing()) * fixing + RandomVariable(n, ibor-&gt;spread());</div>
<div class="line"><span class="lineno">  288</span>            }</div>
<div class="line"><span class="lineno">  289</span>            <span class="keywordflow">return</span> RandomVariable(n, (isFxLinked ? fxLinkedForeignNominal : ibor-&gt;nominal()) * ibor-&gt;accrualPeriod()) *</div>
<div class="line"><span class="lineno">  290</span>                   effectiveRate * fxFixing;</div>
<div class="line"><span class="lineno">  291</span>        };</div>
<div class="line"><span class="lineno">  292</span> </div>
<div class="line"><span class="lineno">  293</span>        <span class="keywordflow">return</span> info;</div>
<div class="line"><span class="lineno">  294</span>    }</div>
<div class="line"><span class="lineno">  295</span> </div>
<div class="line"><span class="lineno">  296</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> cms = QuantLib::ext::dynamic_pointer_cast&lt;CmsCoupon&gt;(flow)) {</div>
<div class="line"><span class="lineno">  297</span>        Real fixedRate = cms-&gt;fixingDate() &lt;= <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aedc6b4c263e4e87835f8fa59891ccd70">today_</a> ? (cms-&gt;rate() - cms-&gt;spread()) / cms-&gt;gearing() : Null&lt;Real&gt;();</div>
<div class="line"><span class="lineno">  298</span>        Size indexCcyIdx = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(cms-&gt;index()-&gt;currency());</div>
<div class="line"><span class="lineno">  299</span>        Real simTime = <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(cms-&gt;fixingDate());</div>
<div class="line"><span class="lineno">  300</span>        <span class="keywordflow">if</span> (cms-&gt;fixingDate() &gt; <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aedc6b4c263e4e87835f8fa59891ccd70">today_</a>) {</div>
<div class="line"><span class="lineno">  301</span>            info.simulationTimes.push_back(simTime);</div>
<div class="line"><span class="lineno">  302</span>            info.modelIndices.push_back({<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704">CrossAssetModel::AssetType::IR</a>, indexCcyIdx)});</div>
<div class="line"><span class="lineno">  303</span>        }</div>
<div class="line"><span class="lineno">  304</span> </div>
<div class="line"><span class="lineno">  305</span>        <span class="keywordflow">if</span> (fxLinkedSimTime != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  306</span>            info.simulationTimes.push_back(fxLinkedSimTime);</div>
<div class="line"><span class="lineno">  307</span>            info.modelIndices.push_back(fxLinkedModelIndices);</div>
<div class="line"><span class="lineno">  308</span>        }</div>
<div class="line"><span class="lineno">  309</span>      </div>
<div class="line"><span class="lineno">  310</span>        info.amountCalculator = [<span class="keyword">this</span>, indexCcyIdx, cms, simTime, fixedRate, isFxLinked, fxLinkedForeignNominal,</div>
<div class="line"><span class="lineno">  311</span>                                 fxLinkedSourceCcyIdx, fxLinkedTargetCcyIdx, fxLinkedFixedFxRate, isCapFloored,</div>
<div class="line"><span class="lineno">  312</span>                                 isNakedOption, effFloor,</div>
<div class="line"><span class="lineno">  313</span>                                 effCap, isFxIndexed](<span class="keyword">const</span> Size n, <span class="keyword">const</span> std::vector&lt;std::vector&lt;const RandomVariable*&gt;&gt;&amp; states) {</div>
<div class="line"><span class="lineno">  314</span>            RandomVariable fixing =</div>
<div class="line"><span class="lineno">  315</span>                fixedRate != Null&lt;Real&gt;()</div>
<div class="line"><span class="lineno">  316</span>                    ? RandomVariable(n, fixedRate)</div>
<div class="line"><span class="lineno">  317</span>                    : <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1951be97f2884589014cdbfcfff3ed9e">lgmVectorised_</a>[indexCcyIdx].fixing(cms-&gt;index(), cms-&gt;<a class="code hl_function" href="namespace_quant_ext_1_1_zero_inflation.html#a57de786c1c8988b6da9d354282b4b370">fixingDate</a>(), simTime, *states.at(0).at(0));</div>
<div class="line"><span class="lineno">  318</span>            RandomVariable fxFixing(n, 1.0);</div>
<div class="line"><span class="lineno">  319</span>            <span class="keywordflow">if</span> (isFxLinked || isFxIndexed) {</div>
<div class="line"><span class="lineno">  320</span>                <span class="keywordflow">if</span> (fxLinkedFixedFxRate != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  321</span>                    fxFixing = RandomVariable(n, fxLinkedFixedFxRate);</div>
<div class="line"><span class="lineno">  322</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  323</span>                    RandomVariable fxSource(n, 1.0), fxTarget(n, 1.0);</div>
<div class="line"><span class="lineno">  324</span>                    Size fxIdx = 0;</div>
<div class="line"><span class="lineno">  325</span>                    <span class="keywordflow">if</span> (fxLinkedSourceCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  326</span>                        fxSource = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx++));</div>
<div class="line"><span class="lineno">  327</span>                    <span class="keywordflow">if</span> (fxLinkedTargetCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  328</span>                        fxTarget = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx));</div>
<div class="line"><span class="lineno">  329</span>                    fxFixing = fxSource / fxTarget;</div>
<div class="line"><span class="lineno">  330</span>                }</div>
<div class="line"><span class="lineno">  331</span>            }</div>
<div class="line"><span class="lineno">  332</span> </div>
<div class="line"><span class="lineno">  333</span>            RandomVariable effectiveRate;</div>
<div class="line"><span class="lineno">  334</span>            <span class="keywordflow">if</span> (isCapFloored) {</div>
<div class="line"><span class="lineno">  335</span>                RandomVariable swapletRate(n, 0.0);</div>
<div class="line"><span class="lineno">  336</span>                RandomVariable floorletRate(n, 0.0);</div>
<div class="line"><span class="lineno">  337</span>                RandomVariable capletRate(n, 0.0);</div>
<div class="line"><span class="lineno">  338</span>                <span class="keywordflow">if</span> (!isNakedOption)</div>
<div class="line"><span class="lineno">  339</span>                    swapletRate = RandomVariable(n, cms-&gt;gearing()) * fixing + RandomVariable(n, cms-&gt;spread());</div>
<div class="line"><span class="lineno">  340</span>                <span class="keywordflow">if</span> (effFloor != Null&lt;Real&gt;())</div>
<div class="line"><span class="lineno">  341</span>                    floorletRate = RandomVariable(n, cms-&gt;gearing()) *</div>
<div class="line"><span class="lineno">  342</span>                                   <a class="code hl_function" href="namespace_quant_ext.html#ac0bb3279caaa02e9f9dd6e85a687cba8">max</a>(RandomVariable(n, effFloor) - fixing, RandomVariable(n, 0.0));</div>
<div class="line"><span class="lineno">  343</span>                <span class="keywordflow">if</span> (effCap != Null&lt;Real&gt;())</div>
<div class="line"><span class="lineno">  344</span>                    capletRate = RandomVariable(n, cms-&gt;gearing()) *</div>
<div class="line"><span class="lineno">  345</span>                                 <a class="code hl_function" href="namespace_quant_ext.html#ac0bb3279caaa02e9f9dd6e85a687cba8">max</a>(fixing - RandomVariable(n, effCap), RandomVariable(n, 0.0)) *</div>
<div class="line"><span class="lineno">  346</span>                                 RandomVariable(n, isNakedOption &amp;&amp; effFloor == Null&lt;Real&gt;() ? -1.0 : 1.0);</div>
<div class="line"><span class="lineno">  347</span>                effectiveRate = swapletRate + floorletRate - capletRate;</div>
<div class="line"><span class="lineno">  348</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  349</span>                effectiveRate = RandomVariable(n, cms-&gt;gearing()) * fixing + RandomVariable(n, cms-&gt;spread());</div>
<div class="line"><span class="lineno">  350</span>            }</div>
<div class="line"><span class="lineno">  351</span> </div>
<div class="line"><span class="lineno">  352</span>            <span class="keywordflow">return</span> RandomVariable(n, (isFxLinked ? fxLinkedForeignNominal : cms-&gt;nominal()) * cms-&gt;accrualPeriod()) *</div>
<div class="line"><span class="lineno">  353</span>                   effectiveRate * fxFixing;</div>
<div class="line"><span class="lineno">  354</span>        };</div>
<div class="line"><span class="lineno">  355</span> </div>
<div class="line"><span class="lineno">  356</span>        <span class="keywordflow">return</span> info;</div>
<div class="line"><span class="lineno">  357</span>    }</div>
<div class="line"><span class="lineno">  358</span> </div>
<div class="line"><span class="lineno">  359</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> on = QuantLib::ext::dynamic_pointer_cast&lt;OvernightIndexedCoupon&gt;(flow)) {</div>
<div class="line"><span class="lineno">  360</span>        Real simTime = std::max(0.0, <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(on-&gt;valueDates().front()));</div>
<div class="line"><span class="lineno">  361</span>        Size indexCcyIdx = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(on-&gt;index()-&gt;currency());</div>
<div class="line"><span class="lineno">  362</span>        info.simulationTimes.push_back(simTime);</div>
<div class="line"><span class="lineno">  363</span>        info.modelIndices.push_back({<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704">CrossAssetModel::AssetType::IR</a>, indexCcyIdx)});</div>
<div class="line"><span class="lineno">  364</span> </div>
<div class="line"><span class="lineno">  365</span>        <span class="keywordflow">if</span> (fxLinkedSimTime != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  366</span>            info.simulationTimes.push_back(fxLinkedSimTime);</div>
<div class="line"><span class="lineno">  367</span>            info.modelIndices.push_back(fxLinkedModelIndices);</div>
<div class="line"><span class="lineno">  368</span>        }</div>
<div class="line"><span class="lineno">  369</span> </div>
<div class="line"><span class="lineno">  370</span>        info.amountCalculator = [<span class="keyword">this</span>, indexCcyIdx, on, simTime, isFxLinked, fxLinkedForeignNominal,</div>
<div class="line"><span class="lineno">  371</span>                                 fxLinkedSourceCcyIdx, fxLinkedTargetCcyIdx, fxLinkedFixedFxRate, isFxIndexed](</div>
<div class="line"><span class="lineno">  372</span>                                    <span class="keyword">const</span> Size n, <span class="keyword">const</span> std::vector&lt;std::vector&lt;const RandomVariable*&gt;&gt;&amp; states) {</div>
<div class="line"><span class="lineno">  373</span>            RandomVariable effectiveRate = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1951be97f2884589014cdbfcfff3ed9e">lgmVectorised_</a>[indexCcyIdx].compoundedOnRate(</div>
<div class="line"><span class="lineno">  374</span>                on-&gt;overnightIndex(), on-&gt;fixingDates(), on-&gt;valueDates(), on-&gt;dt(), on-&gt;rateCutoff(),</div>
<div class="line"><span class="lineno">  375</span>                on-&gt;includeSpread(), on-&gt;spread(), on-&gt;gearing(), on-&gt;lookback(), Null&lt;Real&gt;(), Null&lt;Real&gt;(), <span class="keyword">false</span>,</div>
<div class="line"><span class="lineno">  376</span>                <span class="keyword">false</span>, simTime, *states.at(0).at(0));</div>
<div class="line"><span class="lineno">  377</span>            RandomVariable fxFixing(n, 1.0);</div>
<div class="line"><span class="lineno">  378</span>            <span class="keywordflow">if</span> (isFxLinked || isFxIndexed) {</div>
<div class="line"><span class="lineno">  379</span>                <span class="keywordflow">if</span> (fxLinkedFixedFxRate != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  380</span>                    fxFixing = RandomVariable(n, fxLinkedFixedFxRate);</div>
<div class="line"><span class="lineno">  381</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  382</span>                    RandomVariable fxSource(n, 1.0), fxTarget(n, 1.0);</div>
<div class="line"><span class="lineno">  383</span>                    Size fxIdx = 0;</div>
<div class="line"><span class="lineno">  384</span>                    <span class="keywordflow">if</span> (fxLinkedSourceCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  385</span>                        fxSource = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx++));</div>
<div class="line"><span class="lineno">  386</span>                    <span class="keywordflow">if</span> (fxLinkedTargetCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  387</span>                        fxTarget = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx));</div>
<div class="line"><span class="lineno">  388</span>                    fxFixing = fxSource / fxTarget;</div>
<div class="line"><span class="lineno">  389</span>                }</div>
<div class="line"><span class="lineno">  390</span>            }</div>
<div class="line"><span class="lineno">  391</span> </div>
<div class="line"><span class="lineno">  392</span>            <span class="keywordflow">return</span> RandomVariable(n, (isFxLinked ? fxLinkedForeignNominal : on-&gt;nominal()) * on-&gt;accrualPeriod()) *</div>
<div class="line"><span class="lineno">  393</span>                   effectiveRate * fxFixing;</div>
<div class="line"><span class="lineno">  394</span>        };</div>
<div class="line"><span class="lineno">  395</span> </div>
<div class="line"><span class="lineno">  396</span>        <span class="keywordflow">return</span> info;</div>
<div class="line"><span class="lineno">  397</span>    }</div>
<div class="line"><span class="lineno">  398</span> </div>
<div class="line"><span class="lineno">  399</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> cfon = QuantLib::ext::dynamic_pointer_cast&lt;CappedFlooredOvernightIndexedCoupon&gt;(flow)) {</div>
<div class="line"><span class="lineno">  400</span>        Real simTime = std::max(0.0, <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(cfon-&gt;underlying()-&gt;valueDates().front()));</div>
<div class="line"><span class="lineno">  401</span>        Size indexCcyIdx = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(cfon-&gt;underlying()-&gt;index()-&gt;currency());</div>
<div class="line"><span class="lineno">  402</span>        info.simulationTimes.push_back(simTime);</div>
<div class="line"><span class="lineno">  403</span>        info.modelIndices.push_back({<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704">CrossAssetModel::AssetType::IR</a>, indexCcyIdx)});</div>
<div class="line"><span class="lineno">  404</span> </div>
<div class="line"><span class="lineno">  405</span>        <span class="keywordflow">if</span> (fxLinkedSimTime != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  406</span>            info.simulationTimes.push_back(fxLinkedSimTime);</div>
<div class="line"><span class="lineno">  407</span>            info.modelIndices.push_back(fxLinkedModelIndices);</div>
<div class="line"><span class="lineno">  408</span>        }</div>
<div class="line"><span class="lineno">  409</span>        </div>
<div class="line"><span class="lineno">  410</span>        info.amountCalculator = [<span class="keyword">this</span>, indexCcyIdx, cfon, simTime, isFxLinked, fxLinkedForeignNominal,</div>
<div class="line"><span class="lineno">  411</span>                                 fxLinkedSourceCcyIdx, fxLinkedTargetCcyIdx, fxLinkedFixedFxRate, isFxIndexed](</div>
<div class="line"><span class="lineno">  412</span>                                    <span class="keyword">const</span> Size n, <span class="keyword">const</span> std::vector&lt;std::vector&lt;const RandomVariable*&gt;&gt;&amp; states) {</div>
<div class="line"><span class="lineno">  413</span>            RandomVariable effectiveRate = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1951be97f2884589014cdbfcfff3ed9e">lgmVectorised_</a>[indexCcyIdx].compoundedOnRate(</div>
<div class="line"><span class="lineno">  414</span>                cfon-&gt;underlying()-&gt;overnightIndex(), cfon-&gt;underlying()-&gt;fixingDates(),</div>
<div class="line"><span class="lineno">  415</span>                cfon-&gt;underlying()-&gt;valueDates(), cfon-&gt;underlying()-&gt;dt(), cfon-&gt;underlying()-&gt;rateCutoff(),</div>
<div class="line"><span class="lineno">  416</span>                cfon-&gt;underlying()-&gt;includeSpread(), cfon-&gt;underlying()-&gt;spread(), cfon-&gt;underlying()-&gt;gearing(),</div>
<div class="line"><span class="lineno">  417</span>                cfon-&gt;underlying()-&gt;lookback(), cfon-&gt;cap(), cfon-&gt;floor(), cfon-&gt;localCapFloor(), cfon-&gt;nakedOption(),</div>
<div class="line"><span class="lineno">  418</span>                simTime, *states.at(0).at(0));</div>
<div class="line"><span class="lineno">  419</span>            RandomVariable fxFixing(n, 1.0);</div>
<div class="line"><span class="lineno">  420</span>            <span class="keywordflow">if</span> (isFxLinked || isFxIndexed) {</div>
<div class="line"><span class="lineno">  421</span>                <span class="keywordflow">if</span> (fxLinkedFixedFxRate != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  422</span>                    fxFixing = RandomVariable(n, fxLinkedFixedFxRate);</div>
<div class="line"><span class="lineno">  423</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  424</span>                    RandomVariable fxSource(n, 1.0), fxTarget(n, 1.0);</div>
<div class="line"><span class="lineno">  425</span>                    Size fxIdx = 0;</div>
<div class="line"><span class="lineno">  426</span>                    <span class="keywordflow">if</span> (fxLinkedSourceCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  427</span>                        fxSource = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx++));</div>
<div class="line"><span class="lineno">  428</span>                    <span class="keywordflow">if</span> (fxLinkedTargetCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  429</span>                        fxTarget = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx));</div>
<div class="line"><span class="lineno">  430</span>                    fxFixing = fxSource / fxTarget;</div>
<div class="line"><span class="lineno">  431</span>                }</div>
<div class="line"><span class="lineno">  432</span>            }</div>
<div class="line"><span class="lineno">  433</span>            <span class="keywordflow">return</span> RandomVariable(n, (isFxLinked ? fxLinkedForeignNominal : cfon-&gt;nominal()) * cfon-&gt;accrualPeriod()) *</div>
<div class="line"><span class="lineno">  434</span>                   effectiveRate * fxFixing;</div>
<div class="line"><span class="lineno">  435</span>        };</div>
<div class="line"><span class="lineno">  436</span> </div>
<div class="line"><span class="lineno">  437</span>        <span class="keywordflow">return</span> info;</div>
<div class="line"><span class="lineno">  438</span>    }</div>
<div class="line"><span class="lineno">  439</span> </div>
<div class="line"><span class="lineno">  440</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> av = QuantLib::ext::dynamic_pointer_cast&lt;AverageONIndexedCoupon&gt;(flow)) {</div>
<div class="line"><span class="lineno">  441</span>        Real simTime = std::max(0.0, <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(av-&gt;valueDates().front()));</div>
<div class="line"><span class="lineno">  442</span>        Size indexCcyIdx = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(av-&gt;index()-&gt;currency());</div>
<div class="line"><span class="lineno">  443</span>        info.simulationTimes.push_back(simTime);</div>
<div class="line"><span class="lineno">  444</span>        info.modelIndices.push_back({<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704">CrossAssetModel::AssetType::IR</a>, indexCcyIdx)});</div>
<div class="line"><span class="lineno">  445</span> </div>
<div class="line"><span class="lineno">  446</span>        <span class="keywordflow">if</span> (fxLinkedSimTime != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  447</span>            info.simulationTimes.push_back(fxLinkedSimTime);</div>
<div class="line"><span class="lineno">  448</span>            info.modelIndices.push_back(fxLinkedModelIndices);</div>
<div class="line"><span class="lineno">  449</span>        }</div>
<div class="line"><span class="lineno">  450</span>        </div>
<div class="line"><span class="lineno">  451</span>        info.amountCalculator = [<span class="keyword">this</span>, indexCcyIdx, av, simTime, isFxLinked, fxLinkedForeignNominal,</div>
<div class="line"><span class="lineno">  452</span>                                 fxLinkedSourceCcyIdx, fxLinkedTargetCcyIdx, fxLinkedFixedFxRate, isFxIndexed](</div>
<div class="line"><span class="lineno">  453</span>                                    <span class="keyword">const</span> Size n, <span class="keyword">const</span> std::vector&lt;std::vector&lt;const RandomVariable*&gt;&gt;&amp; states) {</div>
<div class="line"><span class="lineno">  454</span>            RandomVariable effectiveRate = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1951be97f2884589014cdbfcfff3ed9e">lgmVectorised_</a>[indexCcyIdx].averagedOnRate(</div>
<div class="line"><span class="lineno">  455</span>                av-&gt;overnightIndex(), av-&gt;fixingDates(), av-&gt;valueDates(), av-&gt;dt(), av-&gt;rateCutoff(), <span class="keyword">false</span>,</div>
<div class="line"><span class="lineno">  456</span>                av-&gt;spread(), av-&gt;gearing(), av-&gt;lookback(), Null&lt;Real&gt;(), Null&lt;Real&gt;(), <span class="keyword">false</span>, <span class="keyword">false</span>, simTime,</div>
<div class="line"><span class="lineno">  457</span>                *states.at(0).at(0));</div>
<div class="line"><span class="lineno">  458</span>            RandomVariable fxFixing(n, 1.0);</div>
<div class="line"><span class="lineno">  459</span>            <span class="keywordflow">if</span> (isFxLinked || isFxIndexed) {</div>
<div class="line"><span class="lineno">  460</span>                <span class="keywordflow">if</span> (fxLinkedFixedFxRate != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  461</span>                    fxFixing = RandomVariable(n, fxLinkedFixedFxRate);</div>
<div class="line"><span class="lineno">  462</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  463</span>                    RandomVariable fxSource(n, 1.0), fxTarget(n, 1.0);</div>
<div class="line"><span class="lineno">  464</span>                    Size fxIdx = 0;</div>
<div class="line"><span class="lineno">  465</span>                    <span class="keywordflow">if</span> (fxLinkedSourceCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  466</span>                        fxSource = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx++));</div>
<div class="line"><span class="lineno">  467</span>                    <span class="keywordflow">if</span> (fxLinkedTargetCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  468</span>                        fxTarget = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx));</div>
<div class="line"><span class="lineno">  469</span>                    fxFixing = fxSource / fxTarget;</div>
<div class="line"><span class="lineno">  470</span>                }</div>
<div class="line"><span class="lineno">  471</span>            }</div>
<div class="line"><span class="lineno">  472</span>            <span class="keywordflow">return</span> RandomVariable(n, (isFxLinked ? fxLinkedForeignNominal : av-&gt;nominal()) * av-&gt;accrualPeriod()) *</div>
<div class="line"><span class="lineno">  473</span>                   effectiveRate * fxFixing;</div>
<div class="line"><span class="lineno">  474</span>        };</div>
<div class="line"><span class="lineno">  475</span> </div>
<div class="line"><span class="lineno">  476</span>        <span class="keywordflow">return</span> info;</div>
<div class="line"><span class="lineno">  477</span>    }</div>
<div class="line"><span class="lineno">  478</span> </div>
<div class="line"><span class="lineno">  479</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> cfav = QuantLib::ext::dynamic_pointer_cast&lt;CappedFlooredAverageONIndexedCoupon&gt;(flow)) {</div>
<div class="line"><span class="lineno">  480</span>        Real simTime = std::max(0.0, <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(cfav-&gt;underlying()-&gt;valueDates().front()));</div>
<div class="line"><span class="lineno">  481</span>        Size indexCcyIdx = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(cfav-&gt;underlying()-&gt;index()-&gt;currency());</div>
<div class="line"><span class="lineno">  482</span>        info.simulationTimes.push_back(simTime);</div>
<div class="line"><span class="lineno">  483</span>        info.modelIndices.push_back({<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704">CrossAssetModel::AssetType::IR</a>, indexCcyIdx)});</div>
<div class="line"><span class="lineno">  484</span> </div>
<div class="line"><span class="lineno">  485</span>        <span class="keywordflow">if</span> (fxLinkedSimTime != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  486</span>            info.simulationTimes.push_back(fxLinkedSimTime);</div>
<div class="line"><span class="lineno">  487</span>            info.modelIndices.push_back(fxLinkedModelIndices);</div>
<div class="line"><span class="lineno">  488</span>        }</div>
<div class="line"><span class="lineno">  489</span>      </div>
<div class="line"><span class="lineno">  490</span>        info.amountCalculator = [<span class="keyword">this</span>, indexCcyIdx, cfav, simTime, isFxLinked, fxLinkedForeignNominal,</div>
<div class="line"><span class="lineno">  491</span>                                 fxLinkedSourceCcyIdx, fxLinkedTargetCcyIdx, fxLinkedFixedFxRate, isFxIndexed](</div>
<div class="line"><span class="lineno">  492</span>                                    <span class="keyword">const</span> Size n, <span class="keyword">const</span> std::vector&lt;std::vector&lt;const RandomVariable*&gt;&gt;&amp; states) {</div>
<div class="line"><span class="lineno">  493</span>            RandomVariable effectiveRate = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1951be97f2884589014cdbfcfff3ed9e">lgmVectorised_</a>[indexCcyIdx].averagedOnRate(</div>
<div class="line"><span class="lineno">  494</span>                cfav-&gt;underlying()-&gt;overnightIndex(), cfav-&gt;underlying()-&gt;fixingDates(),</div>
<div class="line"><span class="lineno">  495</span>                cfav-&gt;underlying()-&gt;valueDates(), cfav-&gt;underlying()-&gt;dt(), cfav-&gt;underlying()-&gt;rateCutoff(),</div>
<div class="line"><span class="lineno">  496</span>                cfav-&gt;includeSpread(), cfav-&gt;underlying()-&gt;spread(), cfav-&gt;underlying()-&gt;gearing(),</div>
<div class="line"><span class="lineno">  497</span>                cfav-&gt;underlying()-&gt;lookback(), cfav-&gt;cap(), cfav-&gt;floor(), cfav-&gt;localCapFloor(), cfav-&gt;nakedOption(),</div>
<div class="line"><span class="lineno">  498</span>                simTime, *states.at(0).at(0));</div>
<div class="line"><span class="lineno">  499</span>            RandomVariable fxFixing(n, 1.0);</div>
<div class="line"><span class="lineno">  500</span>            <span class="keywordflow">if</span> (isFxLinked || isFxIndexed) {</div>
<div class="line"><span class="lineno">  501</span>                <span class="keywordflow">if</span> (fxLinkedFixedFxRate != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  502</span>                    fxFixing = RandomVariable(n, fxLinkedFixedFxRate);</div>
<div class="line"><span class="lineno">  503</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  504</span>                    RandomVariable fxSource(n, 1.0), fxTarget(n, 1.0);</div>
<div class="line"><span class="lineno">  505</span>                    Size fxIdx = 0;</div>
<div class="line"><span class="lineno">  506</span>                    <span class="keywordflow">if</span> (fxLinkedSourceCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  507</span>                        fxSource = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx++));</div>
<div class="line"><span class="lineno">  508</span>                    <span class="keywordflow">if</span> (fxLinkedTargetCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  509</span>                        fxTarget = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx));</div>
<div class="line"><span class="lineno">  510</span>                    fxFixing = fxSource / fxTarget;</div>
<div class="line"><span class="lineno">  511</span>                }</div>
<div class="line"><span class="lineno">  512</span>            }</div>
<div class="line"><span class="lineno">  513</span>            <span class="keywordflow">return</span> RandomVariable(n, (isFxLinked ? fxLinkedForeignNominal : cfav-&gt;nominal()) * cfav-&gt;accrualPeriod()) *</div>
<div class="line"><span class="lineno">  514</span>                   effectiveRate * fxFixing;</div>
<div class="line"><span class="lineno">  515</span>        };</div>
<div class="line"><span class="lineno">  516</span> </div>
<div class="line"><span class="lineno">  517</span>        <span class="keywordflow">return</span> info;</div>
<div class="line"><span class="lineno">  518</span>    }</div>
<div class="line"><span class="lineno">  519</span> </div>
<div class="line"><span class="lineno">  520</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> bma = QuantLib::ext::dynamic_pointer_cast&lt;AverageBMACoupon&gt;(flow)) {</div>
<div class="line"><span class="lineno">  521</span>        Real simTime = std::max(0.0, <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(bma-&gt;fixingDates().front()));</div>
<div class="line"><span class="lineno">  522</span>        Size indexCcyIdx = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(bma-&gt;index()-&gt;currency());</div>
<div class="line"><span class="lineno">  523</span>        info.simulationTimes.push_back(simTime);</div>
<div class="line"><span class="lineno">  524</span>        info.modelIndices.push_back({<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704">CrossAssetModel::AssetType::IR</a>, indexCcyIdx)});</div>
<div class="line"><span class="lineno">  525</span> </div>
<div class="line"><span class="lineno">  526</span>        <span class="keywordflow">if</span> (fxLinkedSimTime != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  527</span>            info.simulationTimes.push_back(fxLinkedSimTime);</div>
<div class="line"><span class="lineno">  528</span>            info.modelIndices.push_back(fxLinkedModelIndices);</div>
<div class="line"><span class="lineno">  529</span>        }</div>
<div class="line"><span class="lineno">  530</span>        info.amountCalculator = [<span class="keyword">this</span>, indexCcyIdx, bma, simTime, isFxLinked, fxLinkedForeignNominal,</div>
<div class="line"><span class="lineno">  531</span>                                 fxLinkedSourceCcyIdx, fxLinkedTargetCcyIdx, fxLinkedFixedFxRate, isFxIndexed](</div>
<div class="line"><span class="lineno">  532</span>                                    <span class="keyword">const</span> Size n, <span class="keyword">const</span> std::vector&lt;std::vector&lt;const RandomVariable*&gt;&gt;&amp; states) {</div>
<div class="line"><span class="lineno">  533</span>            RandomVariable effectiveRate = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1951be97f2884589014cdbfcfff3ed9e">lgmVectorised_</a>[indexCcyIdx].averagedBmaRate(</div>
<div class="line"><span class="lineno">  534</span>                QuantLib::ext::dynamic_pointer_cast&lt;BMAIndex&gt;(bma-&gt;index()), bma-&gt;fixingDates(), bma-&gt;accrualStartDate(),</div>
<div class="line"><span class="lineno">  535</span>                bma-&gt;accrualEndDate(), <span class="keyword">false</span>, bma-&gt;spread(), bma-&gt;gearing(), Null&lt;Real&gt;(), Null&lt;Real&gt;(), <span class="keyword">false</span>, simTime,</div>
<div class="line"><span class="lineno">  536</span>                *states.at(0).at(0));</div>
<div class="line"><span class="lineno">  537</span>            RandomVariable fxFixing(n, 1.0);</div>
<div class="line"><span class="lineno">  538</span>            <span class="keywordflow">if</span> (isFxLinked || isFxIndexed) {</div>
<div class="line"><span class="lineno">  539</span>                <span class="keywordflow">if</span> (fxLinkedFixedFxRate != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  540</span>                    fxFixing = RandomVariable(n, fxLinkedFixedFxRate);</div>
<div class="line"><span class="lineno">  541</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  542</span>                    RandomVariable fxSource(n, 1.0), fxTarget(n, 1.0);</div>
<div class="line"><span class="lineno">  543</span>                    Size fxIdx = 0;</div>
<div class="line"><span class="lineno">  544</span>                    <span class="keywordflow">if</span> (fxLinkedSourceCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  545</span>                        fxSource = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx++));</div>
<div class="line"><span class="lineno">  546</span>                    <span class="keywordflow">if</span> (fxLinkedTargetCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  547</span>                        fxTarget = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx));</div>
<div class="line"><span class="lineno">  548</span>                    fxFixing = fxSource / fxTarget;</div>
<div class="line"><span class="lineno">  549</span>                }</div>
<div class="line"><span class="lineno">  550</span>            }</div>
<div class="line"><span class="lineno">  551</span>            <span class="keywordflow">return</span> RandomVariable(n, (isFxLinked ? fxLinkedForeignNominal : bma-&gt;nominal()) * bma-&gt;accrualPeriod()) *</div>
<div class="line"><span class="lineno">  552</span>                   effectiveRate * fxFixing;</div>
<div class="line"><span class="lineno">  553</span>        };</div>
<div class="line"><span class="lineno">  554</span> </div>
<div class="line"><span class="lineno">  555</span>        <span class="keywordflow">return</span> info;</div>
<div class="line"><span class="lineno">  556</span>    }</div>
<div class="line"><span class="lineno">  557</span> </div>
<div class="line"><span class="lineno">  558</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> cfbma = QuantLib::ext::dynamic_pointer_cast&lt;CappedFlooredAverageBMACoupon&gt;(flow)) {</div>
<div class="line"><span class="lineno">  559</span>        Real simTime = std::max(0.0, <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(cfbma-&gt;underlying()-&gt;fixingDates().front()));</div>
<div class="line"><span class="lineno">  560</span>        Size indexCcyIdx = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(cfbma-&gt;underlying()-&gt;index()-&gt;currency());</div>
<div class="line"><span class="lineno">  561</span>        info.simulationTimes.push_back(simTime);</div>
<div class="line"><span class="lineno">  562</span>        info.modelIndices.push_back({<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704">CrossAssetModel::AssetType::IR</a>, indexCcyIdx)});</div>
<div class="line"><span class="lineno">  563</span> </div>
<div class="line"><span class="lineno">  564</span>        <span class="keywordflow">if</span> (fxLinkedSimTime != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  565</span>            info.simulationTimes.push_back(fxLinkedSimTime);</div>
<div class="line"><span class="lineno">  566</span>            info.modelIndices.push_back(fxLinkedModelIndices);</div>
<div class="line"><span class="lineno">  567</span>        }</div>
<div class="line"><span class="lineno">  568</span>        info.amountCalculator = [<span class="keyword">this</span>, indexCcyIdx, cfbma, simTime, isFxLinked, fxLinkedForeignNominal,</div>
<div class="line"><span class="lineno">  569</span>                                 fxLinkedSourceCcyIdx, fxLinkedTargetCcyIdx, fxLinkedFixedFxRate, isFxIndexed](</div>
<div class="line"><span class="lineno">  570</span>                                    <span class="keyword">const</span> Size n, <span class="keyword">const</span> std::vector&lt;std::vector&lt;const RandomVariable*&gt;&gt;&amp; states) {</div>
<div class="line"><span class="lineno">  571</span>            RandomVariable effectiveRate = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1951be97f2884589014cdbfcfff3ed9e">lgmVectorised_</a>[indexCcyIdx].averagedBmaRate(</div>
<div class="line"><span class="lineno">  572</span>                QuantLib::ext::dynamic_pointer_cast&lt;BMAIndex&gt;(cfbma-&gt;underlying()-&gt;index()), cfbma-&gt;underlying()-&gt;fixingDates(),</div>
<div class="line"><span class="lineno">  573</span>                cfbma-&gt;underlying()-&gt;accrualStartDate(), cfbma-&gt;underlying()-&gt;accrualEndDate(), cfbma-&gt;includeSpread(),</div>
<div class="line"><span class="lineno">  574</span>                cfbma-&gt;underlying()-&gt;spread(), cfbma-&gt;underlying()-&gt;gearing(), cfbma-&gt;cap(), cfbma-&gt;floor(),</div>
<div class="line"><span class="lineno">  575</span>                cfbma-&gt;nakedOption(), simTime, *states.at(0).at(0));</div>
<div class="line"><span class="lineno">  576</span>            RandomVariable fxFixing(n, 1.0);</div>
<div class="line"><span class="lineno">  577</span>            <span class="keywordflow">if</span> (isFxLinked || isFxIndexed) {</div>
<div class="line"><span class="lineno">  578</span>                <span class="keywordflow">if</span> (fxLinkedFixedFxRate != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  579</span>                    fxFixing = RandomVariable(n, fxLinkedFixedFxRate);</div>
<div class="line"><span class="lineno">  580</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  581</span>                    RandomVariable fxSource(n, 1.0), fxTarget(n, 1.0);</div>
<div class="line"><span class="lineno">  582</span>                    Size fxIdx = 0;</div>
<div class="line"><span class="lineno">  583</span>                    <span class="keywordflow">if</span> (fxLinkedSourceCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  584</span>                        fxSource = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx++));</div>
<div class="line"><span class="lineno">  585</span>                    <span class="keywordflow">if</span> (fxLinkedTargetCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  586</span>                        fxTarget = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx));</div>
<div class="line"><span class="lineno">  587</span>                    fxFixing = fxSource / fxTarget;</div>
<div class="line"><span class="lineno">  588</span>                }</div>
<div class="line"><span class="lineno">  589</span>            }</div>
<div class="line"><span class="lineno">  590</span>            <span class="keywordflow">return</span> RandomVariable(n, (isFxLinked ? fxLinkedForeignNominal : cfbma-&gt;underlying()-&gt;nominal()) *</div>
<div class="line"><span class="lineno">  591</span>                                         cfbma-&gt;underlying()-&gt;accrualPeriod()) *</div>
<div class="line"><span class="lineno">  592</span>                   effectiveRate * fxFixing;</div>
<div class="line"><span class="lineno">  593</span>        };</div>
<div class="line"><span class="lineno">  594</span> </div>
<div class="line"><span class="lineno">  595</span>        <span class="keywordflow">return</span> info;</div>
<div class="line"><span class="lineno">  596</span>    }</div>
<div class="line"><span class="lineno">  597</span> </div>
<div class="line"><span class="lineno">  598</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> sub = QuantLib::ext::dynamic_pointer_cast&lt;SubPeriodsCoupon1&gt;(flow)) {</div>
<div class="line"><span class="lineno">  599</span>        Real simTime = std::max(0.0, <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e">time</a>(sub-&gt;fixingDates().front()));</div>
<div class="line"><span class="lineno">  600</span>        Size indexCcyIdx = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;ccyIndex(sub-&gt;index()-&gt;currency());</div>
<div class="line"><span class="lineno">  601</span>        info.simulationTimes.push_back(simTime);</div>
<div class="line"><span class="lineno">  602</span>        info.modelIndices.push_back({<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704">CrossAssetModel::AssetType::IR</a>, indexCcyIdx)});</div>
<div class="line"><span class="lineno">  603</span> </div>
<div class="line"><span class="lineno">  604</span>        <span class="keywordflow">if</span> (fxLinkedSimTime != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  605</span>            info.simulationTimes.push_back(fxLinkedSimTime);</div>
<div class="line"><span class="lineno">  606</span>            info.modelIndices.push_back(fxLinkedModelIndices);</div>
<div class="line"><span class="lineno">  607</span>        }</div>
<div class="line"><span class="lineno">  608</span>       </div>
<div class="line"><span class="lineno">  609</span>        info.amountCalculator = [<span class="keyword">this</span>, indexCcyIdx, sub, simTime, isFxLinked, fxLinkedForeignNominal,</div>
<div class="line"><span class="lineno">  610</span>                                 fxLinkedSourceCcyIdx, fxLinkedTargetCcyIdx, fxLinkedFixedFxRate, isFxIndexed](</div>
<div class="line"><span class="lineno">  611</span>                                    <span class="keyword">const</span> Size n, <span class="keyword">const</span> std::vector&lt;std::vector&lt;const RandomVariable*&gt;&gt;&amp; states) {</div>
<div class="line"><span class="lineno">  612</span>            RandomVariable fixing = <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1951be97f2884589014cdbfcfff3ed9e">lgmVectorised_</a>[indexCcyIdx].subPeriodsRate(sub-&gt;index(), sub-&gt;fixingDates(),</div>
<div class="line"><span class="lineno">  613</span>                                                                               simTime, *states.at(0).at(0));</div>
<div class="line"><span class="lineno">  614</span>            RandomVariable fxFixing(n, 1.0);</div>
<div class="line"><span class="lineno">  615</span>            <span class="keywordflow">if</span> (isFxLinked || isFxIndexed) {</div>
<div class="line"><span class="lineno">  616</span>                <span class="keywordflow">if</span> (fxLinkedFixedFxRate != Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  617</span>                    fxFixing = RandomVariable(n, fxLinkedFixedFxRate);</div>
<div class="line"><span class="lineno">  618</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  619</span>                    RandomVariable fxSource(n, 1.0), fxTarget(n, 1.0);</div>
<div class="line"><span class="lineno">  620</span>                    Size fxIdx = 0;</div>
<div class="line"><span class="lineno">  621</span>                    <span class="keywordflow">if</span> (fxLinkedSourceCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  622</span>                        fxSource = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx++));</div>
<div class="line"><span class="lineno">  623</span>                    <span class="keywordflow">if</span> (fxLinkedTargetCcyIdx &gt; 0)</div>
<div class="line"><span class="lineno">  624</span>                        fxTarget = <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(*states.at(1).at(fxIdx));</div>
<div class="line"><span class="lineno">  625</span>                    fxFixing = fxSource / fxTarget;</div>
<div class="line"><span class="lineno">  626</span>                }</div>
<div class="line"><span class="lineno">  627</span>            }</div>
<div class="line"><span class="lineno">  628</span>            RandomVariable effectiveRate = RandomVariable(n, sub-&gt;gearing()) * fixing + RandomVariable(n, sub-&gt;spread());</div>
<div class="line"><span class="lineno">  629</span>            <span class="keywordflow">return</span> RandomVariable(n, (isFxLinked ? fxLinkedForeignNominal : sub-&gt;nominal()) * sub-&gt;accrualPeriod()) *</div>
<div class="line"><span class="lineno">  630</span>                   effectiveRate * fxFixing;</div>
<div class="line"><span class="lineno">  631</span>        };</div>
<div class="line"><span class="lineno">  632</span> </div>
<div class="line"><span class="lineno">  633</span>        <span class="keywordflow">return</span> info;</div>
<div class="line"><span class="lineno">  634</span>    }</div>
<div class="line"><span class="lineno">  635</span> </div>
<div class="line"><span class="lineno">  636</span>    QL_FAIL(<span class="stringliteral">&quot;McMultiLegBaseEngine::createCashflowInfo(): unhandled coupon leg &quot;</span> &lt;&lt; legNo &lt;&lt; <span class="stringliteral">&quot; cashflow &quot;</span> &lt;&lt; cfNo);</div>
<div class="line"><span class="lineno">  637</span>} <span class="comment">// createCashflowInfo()</span></div>
<div class="ttc" id="aclass_quant_ext_1_1_cross_asset_model_html_a6d42c1075c37e4e5e67aa861c5a51dfeab8b5089c70ae62534970e2d8aa67e96d"><div class="ttname"><a href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfeab8b5089c70ae62534970e2d8aa67e96d">QuantExt::CrossAssetModel::AssetType::FX</a></div><div class="ttdeci">@ FX</div></div>
<div class="ttc" id="anamespace_quant_ext_1_1_zero_inflation_html_a57de786c1c8988b6da9d354282b4b370"><div class="ttname"><a href="namespace_quant_ext_1_1_zero_inflation.html#a57de786c1c8988b6da9d354282b4b370">QuantExt::ZeroInflation::fixingDate</a></div><div class="ttdeci">QuantLib::Date fixingDate(const QuantLib::Date &amp;d, const QuantLib::Period obsLag, const QuantLib::Frequency freq, bool interpolated)</div><div class="ttdef"><b>Definition:</b> <a href="inflation_8cpp_source.html#l00183">inflation.cpp:183</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_a346be0ea720c31fdc928ba2bdb67826f"><div class="ttname"><a href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">QuantExt::exp</a></div><div class="ttdeci">CompiledFormula exp(CompiledFormula x)</div><div class="ttdef"><b>Definition:</b> <a href="compiledformula_8cpp_source.html#l00151">compiledformula.cpp:151</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_ac0bb3279caaa02e9f9dd6e85a687cba8"><div class="ttname"><a href="namespace_quant_ext.html#ac0bb3279caaa02e9f9dd6e85a687cba8">QuantExt::max</a></div><div class="ttdeci">CompiledFormula max(CompiledFormula x, const CompiledFormula &amp;y)</div><div class="ttdef"><b>Definition:</b> <a href="compiledformula_8cpp_source.html#l00159">compiledformula.cpp:159</a></div></div>
</div><!-- fragment --><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_mc_multi_leg_base_engine_a7f75cec33506ad7f47bce5f6908750bc_cgraph.png" border="0" usemap="#aclass_quant_ext_1_1_mc_multi_leg_base_engine_a7f75cec33506ad7f47bce5f6908750bc_cgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a7f75cec33506ad7f47bce5f6908750bc_cgraph" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a7f75cec33506ad7f47bce5f6908750bc_cgraph">
<area shape="rect" title=" " alt="" coords="5,55,136,80"/>
<area shape="rect" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f" title=" " alt="" coords="186,5,293,31"/>
<area shape="rect" href="namespace_quant_ext.html#ac0bb3279caaa02e9f9dd6e85a687cba8" title=" " alt="" coords="184,55,295,80"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9616e98344f1aaf32238783d4d9a1e8e" title=" " alt="" coords="216,104,263,129"/>
</map>
</div>
<div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_mc_multi_leg_base_engine_a7f75cec33506ad7f47bce5f6908750bc_icgraph.png" border="0" usemap="#aclass_quant_ext_1_1_mc_multi_leg_base_engine_a7f75cec33506ad7f47bce5f6908750bc_icgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a7f75cec33506ad7f47bce5f6908750bc_icgraph" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a7f75cec33506ad7f47bce5f6908750bc_icgraph">
<area shape="rect" title=" " alt="" coords="399,205,529,230"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a082ff96da379d5e17436372ccb3c0972" title=" " alt="" coords="276,205,351,230"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_currency_swap_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="9,5,224,45"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_fx_forward_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="21,69,212,109"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_fx_option_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,133,228,173"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_swap_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="17,197,217,237"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_swaption_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="6,261,227,301"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_nonstandard_swaption_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="16,325,217,365"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_option_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="21,389,212,429"/>
</map>
</div>

</div>
</div>
<a id="a83cea99ba49a654e2a8db95962e4c768" name="a83cea99ba49a654e2a8db95962e4c768"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83cea99ba49a654e2a8db95962e4c768">&#9670;&#160;</a></span>timeIndex()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Size timeIndex </td>
          <td>(</td>
          <td class="paramtype">const Time&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::set&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>simulationTimes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8cpp_source.html#l00639">639</a> of file <a class="el" href="mcmultilegbaseengine_8cpp_source.html">mcmultilegbaseengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  639</span>                                                                                  {</div>
<div class="line"><span class="lineno">  640</span>    <span class="keyword">auto</span> it = times.find(t);</div>
<div class="line"><span class="lineno">  641</span>    QL_REQUIRE(it != times.end(), <span class="stringliteral">&quot;McMultiLegBaseEngine::cashflowPathValue(): time (&quot;</span></div>
<div class="line"><span class="lineno">  642</span>                                      &lt;&lt; t</div>
<div class="line"><span class="lineno">  643</span>                                      &lt;&lt; <span class="stringliteral">&quot;) not found in simulation times. This is an internal error. Contact dev.&quot;</span>);</div>
<div class="line"><span class="lineno">  644</span>    <span class="keywordflow">return</span> std::distance(times.begin(), it);</div>
<div class="line"><span class="lineno">  645</span>}</div>
</div><!-- fragment --><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_mc_multi_leg_base_engine_a83cea99ba49a654e2a8db95962e4c768_icgraph.png" border="0" usemap="#aclass_quant_ext_1_1_mc_multi_leg_base_engine_a83cea99ba49a654e2a8db95962e4c768_icgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a83cea99ba49a654e2a8db95962e4c768_icgraph" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a83cea99ba49a654e2a8db95962e4c768_icgraph">
<area shape="rect" title=" " alt="" coords="681,237,760,262"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a3e8a0b968ffaadf758f6af955da9ce5b" title=" " alt="" coords="450,205,582,230"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_base_engine_1_1_multi_leg_base_amc_calculator.html#a533c38ca6ccefbc695a8f80f3ef67251" title=" " alt="" coords="399,254,633,309"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a082ff96da379d5e17436372ccb3c0972" title=" " alt="" coords="276,205,351,230"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_currency_swap_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="9,5,224,45"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_fx_forward_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="21,69,212,109"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_fx_option_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,133,228,173"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_swap_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="17,197,217,237"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_swaption_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="6,261,227,301"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_nonstandard_swaption_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="16,325,217,365"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_option_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="21,389,212,429"/>
</map>
</div>

</div>
</div>
<a id="a3e8a0b968ffaadf758f6af955da9ce5b" name="a3e8a0b968ffaadf758f6af955da9ce5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e8a0b968ffaadf758f6af955da9ce5b">&#9670;&#160;</a></span>cashflowPathValue()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_quant_ext_1_1_random_variable.html">RandomVariable</a> cashflowPathValue </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_quant_ext_1_1_mc_multi_leg_base_engine_1_1_cashflow_info.html">CashflowInfo</a> &amp;&#160;</td>
          <td class="paramname"><em>cf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; <a class="el" href="struct_quant_ext_1_1_random_variable.html">RandomVariable</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>pathValues</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::set&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>simulationTimes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8cpp_source.html#l00647">647</a> of file <a class="el" href="mcmultilegbaseengine_8cpp_source.html">mcmultilegbaseengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  649</span>                                                                                                  {</div>
<div class="line"><span class="lineno">  650</span> </div>
<div class="line"><span class="lineno">  651</span>    Size n = pathValues[0][0].size();</div>
<div class="line"><span class="lineno">  652</span>    <span class="keyword">auto</span> simTimesPayIdx = <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a83cea99ba49a654e2a8db95962e4c768">timeIndex</a>(cf.payTime, simulationTimes);</div>
<div class="line"><span class="lineno">  653</span> </div>
<div class="line"><span class="lineno">  654</span>    std::vector&lt;RandomVariable&gt; initialValues(<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;stateProcess()-&gt;initialValues().size());</div>
<div class="line"><span class="lineno">  655</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;stateProcess()-&gt;initialValues().size(); ++i)</div>
<div class="line"><span class="lineno">  656</span>        initialValues[i] = RandomVariable(n, <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;stateProcess()-&gt;initialValues()[i]);</div>
<div class="line"><span class="lineno">  657</span> </div>
<div class="line"><span class="lineno">  658</span>    std::vector&lt;std::vector&lt;const RandomVariable*&gt;&gt; states(cf.simulationTimes.size());</div>
<div class="line"><span class="lineno">  659</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; cf.simulationTimes.size(); ++i) {</div>
<div class="line"><span class="lineno">  660</span>        std::vector&lt;const RandomVariable*&gt; tmp(cf.modelIndices[i].size());</div>
<div class="line"><span class="lineno">  661</span>        <span class="keywordflow">if</span> (cf.simulationTimes[i] == 0.0) {</div>
<div class="line"><span class="lineno">  662</span>            <span class="keywordflow">for</span> (Size j = 0; j &lt; cf.modelIndices[i].size(); ++j) {</div>
<div class="line"><span class="lineno">  663</span>                tmp[j] = &amp;initialValues[cf.modelIndices[i][j]];</div>
<div class="line"><span class="lineno">  664</span>            }</div>
<div class="line"><span class="lineno">  665</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  666</span>            <span class="keyword">auto</span> simTimesIdx = <a class="code hl_function" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a83cea99ba49a654e2a8db95962e4c768">timeIndex</a>(cf.simulationTimes[i], simulationTimes);</div>
<div class="line"><span class="lineno">  667</span>            <span class="keywordflow">for</span> (Size j = 0; j &lt; cf.modelIndices[i].size(); ++j) {</div>
<div class="line"><span class="lineno">  668</span>                tmp[j] = &amp;pathValues[simTimesIdx][cf.modelIndices[i][j]];</div>
<div class="line"><span class="lineno">  669</span>            }</div>
<div class="line"><span class="lineno">  670</span>        }</div>
<div class="line"><span class="lineno">  671</span>        states[i] = tmp;</div>
<div class="line"><span class="lineno">  672</span>    }</div>
<div class="line"><span class="lineno">  673</span> </div>
<div class="line"><span class="lineno">  674</span>    <span class="keyword">auto</span> amount = cf.amountCalculator(n, states) /</div>
<div class="line"><span class="lineno">  675</span>                  <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a1951be97f2884589014cdbfcfff3ed9e">lgmVectorised_</a>[0].numeraire(</div>
<div class="line"><span class="lineno">  676</span>                      cf.payTime, pathValues[simTimesPayIdx][<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfea4f74d343f26bbd58a8cbbad2cab6a704">CrossAssetModel::AssetType::IR</a>, 0)],</div>
<div class="line"><span class="lineno">  677</span>                      <a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a9f5cc25da87a57e846f4601d9e86f7d9">discountCurves_</a>[0]);</div>
<div class="line"><span class="lineno">  678</span> </div>
<div class="line"><span class="lineno">  679</span>    <span class="keywordflow">if</span> (cf.payCcyIndex &gt; 0) {</div>
<div class="line"><span class="lineno">  680</span>        amount *= <a class="code hl_function" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f">exp</a>(pathValues[simTimesPayIdx][<a class="code hl_variable" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#aa7c622fbe8bbab6688f5a39b8fe89978">model_</a>-&gt;pIdx(<a class="code hl_enumvalue" href="class_quant_ext_1_1_cross_asset_model.html#a6d42c1075c37e4e5e67aa861c5a51dfeab8b5089c70ae62534970e2d8aa67e96d">CrossAssetModel::AssetType::FX</a>, cf.payCcyIndex - 1)]);</div>
<div class="line"><span class="lineno">  681</span>    }</div>
<div class="line"><span class="lineno">  682</span> </div>
<div class="line"><span class="lineno">  683</span>    <span class="keywordflow">return</span> amount * RandomVariable(n, cf.payer ? -1.0 : 1.0);</div>
<div class="line"><span class="lineno">  684</span>}</div>
<div class="ttc" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_html_a83cea99ba49a654e2a8db95962e4c768"><div class="ttname"><a href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a83cea99ba49a654e2a8db95962e4c768">QuantExt::McMultiLegBaseEngine::timeIndex</a></div><div class="ttdeci">Size timeIndex(const Time t, const std::set&lt; Real &gt; &amp;simulationTimes) const</div><div class="ttdef"><b>Definition:</b> <a href="mcmultilegbaseengine_8cpp_source.html#l00639">mcmultilegbaseengine.cpp:639</a></div></div>
</div><!-- fragment --><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_mc_multi_leg_base_engine_a3e8a0b968ffaadf758f6af955da9ce5b_cgraph.png" border="0" usemap="#aclass_quant_ext_1_1_mc_multi_leg_base_engine_a3e8a0b968ffaadf758f6af955da9ce5b_cgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a3e8a0b968ffaadf758f6af955da9ce5b_cgraph" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a3e8a0b968ffaadf758f6af955da9ce5b_cgraph">
<area shape="rect" title=" " alt="" coords="5,63,137,88"/>
<area shape="rect" href="namespace_quant_ext.html#a346be0ea720c31fdc928ba2bdb67826f" title=" " alt="" coords="222,5,329,31"/>
<area shape="rect" href="struct_quant_ext_1_1_random_variable.html#acce0ab2cacc475b2434f24c65c91685a" title=" " alt="" coords="185,55,365,95"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a83cea99ba49a654e2a8db95962e4c768" title=" " alt="" coords="236,120,315,145"/>
</map>
</div>
<div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_mc_multi_leg_base_engine_a3e8a0b968ffaadf758f6af955da9ce5b_icgraph.png" border="0" usemap="#aclass_quant_ext_1_1_mc_multi_leg_base_engine_a3e8a0b968ffaadf758f6af955da9ce5b_icgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a3e8a0b968ffaadf758f6af955da9ce5b_icgraph" id="aclass_quant_ext_1_1_mc_multi_leg_base_engine_a3e8a0b968ffaadf758f6af955da9ce5b_icgraph">
<area shape="rect" title=" " alt="" coords="399,205,531,230"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a082ff96da379d5e17436372ccb3c0972" title=" " alt="" coords="276,205,351,230"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_currency_swap_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="9,5,224,45"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_fx_forward_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="21,69,212,109"/>
<area shape="rect" href="class_quant_ext_1_1_mc_cam_fx_option_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,133,228,173"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_swap_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="17,197,217,237"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_swaption_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="6,261,227,301"/>
<area shape="rect" href="class_quant_ext_1_1_mc_lgm_nonstandard_swaption_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="16,325,217,365"/>
<area shape="rect" href="class_quant_ext_1_1_mc_multi_leg_option_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="21,389,212,429"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="ade1327900ed6bd5963ee61818948c515" name="ade1327900ed6bd5963ee61818948c515"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade1327900ed6bd5963ee61818948c515">&#9670;&#160;</a></span>leg_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;Leg&gt; leg_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00093">93</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a2998ea0dd746f75f1d83fe1d7cd3c6ab" name="a2998ea0dd746f75f1d83fe1d7cd3c6ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2998ea0dd746f75f1d83fe1d7cd3c6ab">&#9670;&#160;</a></span>currency_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;Currency&gt; currency_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00094">94</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="abcc5672032f5d39d092b5339abb3e464" name="abcc5672032f5d39d092b5339abb3e464"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abcc5672032f5d39d092b5339abb3e464">&#9670;&#160;</a></span>payer_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="classbool.html">bool</a>&gt; payer_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00095">95</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a3753e6fd374bc155f6c3eaaec71d6441" name="a3753e6fd374bc155f6c3eaaec71d6441"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3753e6fd374bc155f6c3eaaec71d6441">&#9670;&#160;</a></span>exercise_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::ext::shared_ptr&lt;Exercise&gt; exercise_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00096">96</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a2805e91fa95c78b11a135d5fe7df516e" name="a2805e91fa95c78b11a135d5fe7df516e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2805e91fa95c78b11a135d5fe7df516e">&#9670;&#160;</a></span>optionSettlement_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Settlement::Type optionSettlement_ = Settlement::Physical</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00097">97</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="ad9543729c4f91803553a520d5f62f488" name="ad9543729c4f91803553a520d5f62f488"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9543729c4f91803553a520d5f62f488">&#9670;&#160;</a></span>includeSettlementDateFlows_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> includeSettlementDateFlows_ = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00098">98</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="aa7c622fbe8bbab6688f5a39b8fe89978" name="aa7c622fbe8bbab6688f5a39b8fe89978"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7c622fbe8bbab6688f5a39b8fe89978">&#9670;&#160;</a></span>model_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Handle&lt;<a class="el" href="class_quant_ext_1_1_cross_asset_model.html">CrossAssetModel</a>&gt; model_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00101">101</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a1f94f9aa9913a46b1fb84634b6058b86" name="a1f94f9aa9913a46b1fb84634b6058b86"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f94f9aa9913a46b1fb84634b6058b86">&#9670;&#160;</a></span>calibrationPathGenerator_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespace_quant_ext.html#a214062620719990c86bcb3c13c7f51b0">SequenceType</a> calibrationPathGenerator_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00102">102</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="adf4f47dc3e1168c894294843e8efc3f4" name="adf4f47dc3e1168c894294843e8efc3f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf4f47dc3e1168c894294843e8efc3f4">&#9670;&#160;</a></span>pricingPathGenerator_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespace_quant_ext.html#a214062620719990c86bcb3c13c7f51b0">SequenceType</a> pricingPathGenerator_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00102">102</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a7ff206b890b8b59edb2a71e34f6836ac" name="a7ff206b890b8b59edb2a71e34f6836ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ff206b890b8b59edb2a71e34f6836ac">&#9670;&#160;</a></span>calibrationSamples_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Size calibrationSamples_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00103">103</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a793853507aa9e434e1845b51b5b8f015" name="a793853507aa9e434e1845b51b5b8f015"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a793853507aa9e434e1845b51b5b8f015">&#9670;&#160;</a></span>pricingSamples_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Size pricingSamples_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00103">103</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a97e4afcc630ce1c1ee377a693f2c4e06" name="a97e4afcc630ce1c1ee377a693f2c4e06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97e4afcc630ce1c1ee377a693f2c4e06">&#9670;&#160;</a></span>calibrationSeed_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Size calibrationSeed_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00103">103</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="ae5ab96e720572f85ff9f04367b8d88e3" name="ae5ab96e720572f85ff9f04367b8d88e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5ab96e720572f85ff9f04367b8d88e3">&#9670;&#160;</a></span>pricingSeed_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Size pricingSeed_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00103">103</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a72b1f12993111e76ce1324e1cda416b3" name="a72b1f12993111e76ce1324e1cda416b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72b1f12993111e76ce1324e1cda416b3">&#9670;&#160;</a></span>polynomOrder_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Size polynomOrder_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00104">104</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a4eb8330d156ae243b17254734beea361" name="a4eb8330d156ae243b17254734beea361"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4eb8330d156ae243b17254734beea361">&#9670;&#160;</a></span>polynomType_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">LsmBasisSystem::PolynomialType polynomType_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00105">105</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a3ff8c5348202c0fb10ebd058513cefc9" name="a3ff8c5348202c0fb10ebd058513cefc9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ff8c5348202c0fb10ebd058513cefc9">&#9670;&#160;</a></span>ordering_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">SobolBrownianGenerator::Ordering ordering_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00106">106</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a44bcbd366a24b9989a3295b7202ec3fa" name="a44bcbd366a24b9989a3295b7202ec3fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44bcbd366a24b9989a3295b7202ec3fa">&#9670;&#160;</a></span>directionIntegers_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">SobolRsg::DirectionIntegers directionIntegers_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00107">107</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a9f5cc25da87a57e846f4601d9e86f7d9" name="a9f5cc25da87a57e846f4601d9e86f7d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f5cc25da87a57e846f4601d9e86f7d9">&#9670;&#160;</a></span>discountCurves_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;Handle&lt;YieldTermStructure&gt; &gt; discountCurves_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00108">108</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a4fadadb77ba64c262103d204df7dc7cf" name="a4fadadb77ba64c262103d204df7dc7cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fadadb77ba64c262103d204df7dc7cf">&#9670;&#160;</a></span>simulationDates_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;Date&gt; simulationDates_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00109">109</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="ae26491a56f9b83c6d0b5a8716029d95b" name="ae26491a56f9b83c6d0b5a8716029d95b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae26491a56f9b83c6d0b5a8716029d95b">&#9670;&#160;</a></span>externalModelIndices_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;Size&gt; externalModelIndices_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00110">110</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a2e3951457698bb33afa00b094ee49860" name="a2e3951457698bb33afa00b094ee49860"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e3951457698bb33afa00b094ee49860">&#9670;&#160;</a></span>minimalObsDate_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> minimalObsDate_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00111">111</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a0963458f7890a5310185715c50f45512" name="a0963458f7890a5310185715c50f45512"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0963458f7890a5310185715c50f45512">&#9670;&#160;</a></span>regressorModel_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_quant_ext_1_1_mc_multi_leg_base_engine.html#a78bd0862d58f98e93a00728336188608">RegressorModel</a> regressorModel_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00112">112</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a29309ad290a75bf279f34e60c84bed59" name="a29309ad290a75bf279f34e60c84bed59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29309ad290a75bf279f34e60c84bed59">&#9670;&#160;</a></span>regressionVarianceCutoff_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Real regressionVarianceCutoff_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00113">113</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a6b390954ac7a2dc37c37d361a3218aaf" name="a6b390954ac7a2dc37c37d361a3218aaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b390954ac7a2dc37c37d361a3218aaf">&#9670;&#160;</a></span>amcCalculator_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::ext::shared_ptr&lt;<a class="el" href="class_quant_ext_1_1_amc_calculator.html">AmcCalculator</a>&gt; amcCalculator_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00116">116</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a4735af14c02f445241b8222ff6fedf25" name="a4735af14c02f445241b8222ff6fedf25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4735af14c02f445241b8222ff6fedf25">&#9670;&#160;</a></span>resultUnderlyingNpv_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Real resultUnderlyingNpv_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00119">119</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="ae97465b2b8e93dcb73303587635ff486" name="ae97465b2b8e93dcb73303587635ff486"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae97465b2b8e93dcb73303587635ff486">&#9670;&#160;</a></span>resultValue_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Real resultValue_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00119">119</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a66e090204366fe36e30053934bca5e44" name="a66e090204366fe36e30053934bca5e44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66e090204366fe36e30053934bca5e44">&#9670;&#160;</a></span>tinyTime</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr Real tinyTime = 1E-10</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">constexpr</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00122">122</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="aedc6b4c263e4e87835f8fa59891ccd70" name="aedc6b4c263e4e87835f8fa59891ccd70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aedc6b4c263e4e87835f8fa59891ccd70">&#9670;&#160;</a></span>today_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Date today_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00212">212</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a1951be97f2884589014cdbfcfff3ed9e" name="a1951be97f2884589014cdbfcfff3ed9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1951be97f2884589014cdbfcfff3ed9e">&#9670;&#160;</a></span>lgmVectorised_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="class_quant_ext_1_1_lgm_vectorised.html">LgmVectorised</a>&gt; lgmVectorised_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcmultilegbaseengine_8hpp_source.html#l00215">215</a> of file <a class="el" href="mcmultilegbaseengine_8hpp_source.html">mcmultilegbaseengine.hpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.9.5
</small></address>
</body>
</html>
