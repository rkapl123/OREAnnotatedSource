<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<title>QuantExt: IndexCdsTrancheEngine Class Reference</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="quantextextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-qle@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.8.11</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_quant_ext.html">QuantExt</a></li><li class="navelem"><a class="el" href="class_quant_ext_1_1_index_cds_tranche_engine.html">IndexCdsTrancheEngine</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="class_quant_ext_1_1_index_cds_tranche_engine-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">IndexCdsTrancheEngine Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="indexcdstrancheengine_8hpp_source.html">qle/pricingengines/indexcdstrancheengine.hpp</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for IndexCdsTrancheEngine:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_index_cds_tranche_engine__inherit__graph.png" border="0" usemap="#a_index_cds_tranche_engine_inherit__map" alt="Inheritance graph"/></div>
<map name="a_index_cds_tranche_engine_inherit__map" id="a_index_cds_tranche_engine_inherit__map">
<area shape="rect" title=" " alt="" coords="8,211,213,309"/>
<area shape="rect" href="class_quant_ext_1_1_synthetic_c_d_o_1_1engine.html" title="CDO base engine." alt="" coords="79,123,143,163"/>
<area shape="rect" title=" " alt="" coords="5,5,216,75"/>
</map>
</div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for IndexCdsTrancheEngine:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_index_cds_tranche_engine__coll__graph.png" border="0" usemap="#a_index_cds_tranche_engine_coll__map" alt="Collaboration graph"/></div>
<map name="a_index_cds_tranche_engine_coll__map" id="a_index_cds_tranche_engine_coll__map">
<area shape="rect" title=" " alt="" coords="171,241,359,311"/>
<area shape="rect" href="class_quant_ext_1_1_synthetic_c_d_o_1_1engine.html" title="CDO base engine." alt="" coords="79,131,143,171"/>
<area shape="rect" title=" " alt="" coords="5,5,216,75"/>
<area shape="rect" title=" " alt="" coords="167,124,363,179"/>
<area shape="rect" title=" " alt="" coords="387,131,506,171"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a10f13424860c3e2878e85b67b8b9611e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a10f13424860c3e2878e85b67b8b9611e">IndexCdsTrancheEngine</a> (const QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt; &amp;discountCurve, boost::optional&lt; <a class="el" href="classbool.html">bool</a> &gt; includeSettlementDateFlows=boost::none)</td></tr>
<tr class="separator:a10f13424860c3e2878e85b67b8b9611e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61eb1a24e5329ccc296715a40dc3a19a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a61eb1a24e5329ccc296715a40dc3a19a">calculate</a> () const override</td></tr>
<tr class="separator:a61eb1a24e5329ccc296715a40dc3a19a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-attribs" name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:a633a2f63e35f5d5b6ec5b92ea38709ae"><td class="memItemLeft" align="right" valign="top">QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a633a2f63e35f5d5b6ec5b92ea38709ae">discountCurve_</a></td></tr>
<tr class="separator:a633a2f63e35f5d5b6ec5b92ea38709ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c03bc11ff086bfab1c39eb1409e968a"><td class="memItemLeft" align="right" valign="top">boost::optional&lt; <a class="el" href="classbool.html">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a4c03bc11ff086bfab1c39eb1409e968a">includeSettlementDateFlows_</a></td></tr>
<tr class="separator:a4c03bc11ff086bfab1c39eb1409e968a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Index tranche pricing engine</p>
<p >The engine obtains the index CDS reference basket from its arguments and it is expecting it to have a default model assigned.</p>
<p >This engine prices standard index CDS tranches. The mechanics of such tranches is outlined in <em>Markit Credit Indices A Primer, 2014</em> for example available on the Markit website.</p>
<dl class="caveats"><dt><b><a class="el" href="caveats.html#_caveats000040">Warning:</a></b></dt><dd>We do not cover the possibility that recovery amounts decrease the tranche notional on which the premium is paid. For tranche detachment points met in practice, it is rare that recovery amounts exceed the notional of the super-senior tranche and thus erode the notional of the other tranches. If we want to cover this possibility we would need to extend the basket loss model algorithms so that they account for losses on a tranche notional due to recovery amounts in addition to the losses due to default. In summary, do not expect this pricing engine to work well for tranches with high detachment points which are likely to be breached by the sum of recovered amounts as the premium leg will be over-estimated in those situations. </dd></dl>

<p class="definition">Definition at line <a class="el" href="indexcdstrancheengine_8hpp_source.html#l00052">52</a> of file <a class="el" href="indexcdstrancheengine_8hpp_source.html">indexcdstrancheengine.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a10f13424860c3e2878e85b67b8b9611e" name="a10f13424860c3e2878e85b67b8b9611e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10f13424860c3e2878e85b67b8b9611e">&#9670;&#160;</a></span>IndexCdsTrancheEngine()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_quant_ext_1_1_index_cds_tranche_engine.html">IndexCdsTrancheEngine</a> </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt; &amp;&#160;</td>
          <td class="paramname"><em>discountCurve</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boost::optional&lt; <a class="el" href="classbool.html">bool</a> &gt;&#160;</td>
          <td class="paramname"><em>includeSettlementDateFlows</em> = <code>boost::none</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="indexcdstrancheengine_8cpp_source.html#l00033">33</a> of file <a class="el" href="indexcdstrancheengine_8cpp_source.html">indexcdstrancheengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   35</span>    : <a class="code hl_variable" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a633a2f63e35f5d5b6ec5b92ea38709ae">discountCurve_</a>(discountCurve),</div>
<div class="line"><span class="lineno">   36</span>      <a class="code hl_variable" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a4c03bc11ff086bfab1c39eb1409e968a">includeSettlementDateFlows_</a>(includeSettlementDateFlows) {</div>
<div class="line"><span class="lineno">   37</span>    registerWith(discountCurve);</div>
<div class="line"><span class="lineno">   38</span>}</div>
<div class="ttc" id="aclass_quant_ext_1_1_index_cds_tranche_engine_html_a4c03bc11ff086bfab1c39eb1409e968a"><div class="ttname"><a href="class_quant_ext_1_1_index_cds_tranche_engine.html#a4c03bc11ff086bfab1c39eb1409e968a">QuantExt::IndexCdsTrancheEngine::includeSettlementDateFlows_</a></div><div class="ttdeci">boost::optional&lt; bool &gt; includeSettlementDateFlows_</div><div class="ttdef"><b>Definition:</b> <a href="indexcdstrancheengine_8hpp_source.html#l00061">indexcdstrancheengine.hpp:61</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_index_cds_tranche_engine_html_a633a2f63e35f5d5b6ec5b92ea38709ae"><div class="ttname"><a href="class_quant_ext_1_1_index_cds_tranche_engine.html#a633a2f63e35f5d5b6ec5b92ea38709ae">QuantExt::IndexCdsTrancheEngine::discountCurve_</a></div><div class="ttdeci">QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt; discountCurve_</div><div class="ttdef"><b>Definition:</b> <a href="indexcdstrancheengine_8hpp_source.html#l00060">indexcdstrancheengine.hpp:60</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a61eb1a24e5329ccc296715a40dc3a19a" name="a61eb1a24e5329ccc296715a40dc3a19a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61eb1a24e5329ccc296715a40dc3a19a">&#9670;&#160;</a></span>calculate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calculate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="indexcdstrancheengine_8cpp_source.html#l00040">40</a> of file <a class="el" href="indexcdstrancheengine_8cpp_source.html">indexcdstrancheengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   40</span>                                            {</div>
<div class="line"><span class="lineno">   41</span> </div>
<div class="line"><span class="lineno">   42</span>    cpu_timer timer;</div>
<div class="line"><span class="lineno">   43</span>    timer.start();</div>
<div class="line"><span class="lineno">   44</span> </div>
<div class="line"><span class="lineno">   45</span>    <span class="comment">// Upfront premium</span></div>
<div class="line"><span class="lineno">   46</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.upfrontPremiumValue = 0.0;</div>
<div class="line"><span class="lineno">   47</span>    Real upfrontPremiumAmount = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.upfrontPayment-&gt;amount();</div>
<div class="line"><span class="lineno">   48</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.upfrontPayment &amp;&amp; !<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.upfrontPayment-&gt;hasOccurred(</div>
<div class="line"><span class="lineno">   49</span>        <a class="code hl_variable" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a633a2f63e35f5d5b6ec5b92ea38709ae">discountCurve_</a>-&gt;referenceDate(), <a class="code hl_variable" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a4c03bc11ff086bfab1c39eb1409e968a">includeSettlementDateFlows_</a>)) {</div>
<div class="line"><span class="lineno">   50</span>        <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.upfrontPremiumValue = upfrontPremiumAmount *</div>
<div class="line"><span class="lineno">   51</span>            <a class="code hl_variable" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a633a2f63e35f5d5b6ec5b92ea38709ae">discountCurve_</a>-&gt;discount(<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.upfrontPayment-&gt;date());</div>
<div class="line"><span class="lineno">   52</span>    }</div>
<div class="line"><span class="lineno">   53</span> </div>
<div class="line"><span class="lineno">   54</span>    <span class="comment">// Accrual rebate</span></div>
<div class="line"><span class="lineno">   55</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.accrualRebateValue = 0.0;</div>
<div class="line"><span class="lineno">   56</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.accrualRebate &amp;&amp; !<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.accrualRebate-&gt;hasOccurred(</div>
<div class="line"><span class="lineno">   57</span>        <a class="code hl_variable" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a633a2f63e35f5d5b6ec5b92ea38709ae">discountCurve_</a>-&gt;referenceDate(), <a class="code hl_variable" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a4c03bc11ff086bfab1c39eb1409e968a">includeSettlementDateFlows_</a>)) {</div>
<div class="line"><span class="lineno">   58</span>        <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.accrualRebateValue = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.accrualRebate-&gt;amount() *</div>
<div class="line"><span class="lineno">   59</span>            <a class="code hl_variable" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a633a2f63e35f5d5b6ec5b92ea38709ae">discountCurve_</a>-&gt;discount(<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.accrualRebate-&gt;date());</div>
<div class="line"><span class="lineno">   60</span>    }</div>
<div class="line"><span class="lineno">   61</span> </div>
<div class="line"><span class="lineno">   62</span>    <span class="comment">// Accrual rebate current</span></div>
<div class="line"><span class="lineno">   63</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.accrualRebateCurrentValue = 0.0;</div>
<div class="line"><span class="lineno">   64</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.accrualRebateCurrent &amp;&amp;</div>
<div class="line"><span class="lineno">   65</span>        !<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.accrualRebateCurrent-&gt;hasOccurred(<a class="code hl_variable" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a633a2f63e35f5d5b6ec5b92ea38709ae">discountCurve_</a>-&gt;referenceDate(), <a class="code hl_variable" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a4c03bc11ff086bfab1c39eb1409e968a">includeSettlementDateFlows_</a>)) {</div>
<div class="line"><span class="lineno">   66</span>        <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.accrualRebateCurrentValue =</div>
<div class="line"><span class="lineno">   67</span>            <a class="code hl_variable" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a633a2f63e35f5d5b6ec5b92ea38709ae">discountCurve_</a>-&gt;discount(<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.accrualRebateCurrent-&gt;date()) * <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.accrualRebateCurrent-&gt;amount();</div>
<div class="line"><span class="lineno">   68</span>    }</div>
<div class="line"><span class="lineno">   69</span> </div>
<div class="line"><span class="lineno">   70</span>    <span class="comment">// Final results, not updated below.</span></div>
<div class="line"><span class="lineno">   71</span>    <span class="comment">// FD TODO: check again when testing tranches with existing losses.</span></div>
<div class="line"><span class="lineno">   72</span>    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; basket = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.basket;</div>
<div class="line"><span class="lineno">   73</span>    QL_REQUIRE(basket, <span class="stringliteral">&quot;IndexCdsTrancheEngine expects a non-null basket.&quot;</span>);</div>
<div class="line"><span class="lineno">   74</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.xMin = basket-&gt;attachmentAmount();</div>
<div class="line"><span class="lineno">   75</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.xMax = basket-&gt;detachmentAmount();</div>
<div class="line"><span class="lineno">   76</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.remainingNotional = <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.xMax - <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.xMin;</div>
<div class="line"><span class="lineno">   77</span> </div>
<div class="line"><span class="lineno">   78</span>    <span class="comment">// Record the expected tranche loss up to inception and up to the end of each coupon period.</span></div>
<div class="line"><span class="lineno">   79</span>    <span class="comment">// FD TODO: Recheck 0&#39;s for past coupons when testing tranches with existing losses. The loss model gives </span></div>
<div class="line"><span class="lineno">   80</span>    <span class="comment">//          accumulated losses so we should in theory be able to use these.</span></div>
<div class="line"><span class="lineno">   81</span>    vector&lt;Real&gt;&amp; etls = <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.expectedTrancheLoss;</div>
<div class="line"><span class="lineno">   82</span>    etls.push_back(0.0);</div>
<div class="line"><span class="lineno">   83</span> </div>
<div class="line"><span class="lineno">   84</span>    <span class="comment">// Variables used in the loop below.</span></div>
<div class="line"><span class="lineno">   85</span>    Date today = Settings::instance().evaluationDate();</div>
<div class="line"><span class="lineno">   86</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.premiumValue = 0.0;</div>
<div class="line"><span class="lineno">   87</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.protectionValue = 0.0;</div>
<div class="line"><span class="lineno">   88</span>    Real inceptionTrancheNotional = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.basket-&gt;trancheNotional();</div>
<div class="line"><span class="lineno">   89</span> </div>
<div class="line"><span class="lineno">   90</span>    <span class="comment">// Value the premium and protection leg.</span></div>
<div class="line"><span class="lineno">   91</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.normalizedLeg.size(); i++) {</div>
<div class="line"><span class="lineno">   92</span> </div>
<div class="line"><span class="lineno">   93</span>        <span class="comment">// Zero expected loss on coupon end dates that have already occured.</span></div>
<div class="line"><span class="lineno">   94</span>        <span class="comment">// FD TODO: check again when testing tranches with existing losses.</span></div>
<div class="line"><span class="lineno">   95</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.normalizedLeg[i]-&gt;hasOccurred(today)) {</div>
<div class="line"><span class="lineno">   96</span>            etls.push_back(0.0);</div>
<div class="line"><span class="lineno">   97</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">   98</span>        }</div>
<div class="line"><span class="lineno">   99</span> </div>
<div class="line"><span class="lineno">  100</span>        boost::shared_ptr&lt;Coupon&gt; coupon = boost::dynamic_pointer_cast&lt;Coupon&gt;(<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.normalizedLeg[i]);</div>
<div class="line"><span class="lineno">  101</span>        QL_REQUIRE(coupon, <span class="stringliteral">&quot;IndexCdsTrancheEngine expects leg to have Coupon cashflow type.&quot;</span>);</div>
<div class="line"><span class="lineno">  102</span> </div>
<div class="line"><span class="lineno">  103</span>        <span class="comment">// Relevant dates with assumption that future defaults occur at midpoint of (remaining) coupon period.</span></div>
<div class="line"><span class="lineno">  104</span>        Date paymentDate = coupon-&gt;date();</div>
<div class="line"><span class="lineno">  105</span>        Date startDate = std::max(coupon-&gt;accrualStartDate(), today);</div>
<div class="line"><span class="lineno">  106</span>        Date endDate = coupon-&gt;accrualEndDate();</div>
<div class="line"><span class="lineno">  107</span>        Date defaultDate = startDate + (endDate - startDate) / 2;</div>
<div class="line"><span class="lineno">  108</span> </div>
<div class="line"><span class="lineno">  109</span>        <span class="comment">// Expected loss on the tranche up to the end of the current period.</span></div>
<div class="line"><span class="lineno">  110</span>        Real etl = basket-&gt;expectedTrancheLoss(endDate, <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.recoveryRate);</div>
<div class="line"><span class="lineno">  111</span> </div>
<div class="line"><span class="lineno">  112</span>        <span class="comment">// Update protection leg value</span></div>
<div class="line"><span class="lineno">  113</span>        <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.protectionValue += <a class="code hl_variable" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a633a2f63e35f5d5b6ec5b92ea38709ae">discountCurve_</a>-&gt;discount(defaultDate) * (etl - etls.back());</div>
<div class="line"><span class="lineno">  114</span> </div>
<div class="line"><span class="lineno">  115</span>        <span class="comment">// Update the premium leg value. If settling accruals, which is standard, assume that losses are evenly </span></div>
<div class="line"><span class="lineno">  116</span>        <span class="comment">// distributed over the coupon period, as per Andersen, Sidenius, Basu Nov 2003 paper for example. If not </span></div>
<div class="line"><span class="lineno">  117</span>        <span class="comment">// settling accruals, just use the tranche notional at period end.</span></div>
<div class="line"><span class="lineno">  118</span>        Real effNtl = 0.0;</div>
<div class="line"><span class="lineno">  119</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.settlesAccrual) {</div>
<div class="line"><span class="lineno">  120</span>            effNtl = inceptionTrancheNotional - (etl + etls.back()) / 2.0;</div>
<div class="line"><span class="lineno">  121</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  122</span>            effNtl = inceptionTrancheNotional - etl;</div>
<div class="line"><span class="lineno">  123</span>        }</div>
<div class="line"><span class="lineno">  124</span>        <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.premiumValue += (coupon-&gt;amount() / inceptionTrancheNotional) *</div>
<div class="line"><span class="lineno">  125</span>            effNtl * <a class="code hl_variable" href="class_quant_ext_1_1_index_cds_tranche_engine.html#a633a2f63e35f5d5b6ec5b92ea38709ae">discountCurve_</a>-&gt;discount(paymentDate);</div>
<div class="line"><span class="lineno">  126</span> </div>
<div class="line"><span class="lineno">  127</span>        <span class="comment">// Update the expected tranche loss results vector.</span></div>
<div class="line"><span class="lineno">  128</span>        etls.push_back(etl);</div>
<div class="line"><span class="lineno">  129</span>    }</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>    <span class="comment">// Apply correct sign to each PV&#39;ed quantity depending on whether buying or selling protection on the tranche.</span></div>
<div class="line"><span class="lineno">  132</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.side == Protection::Buyer) {</div>
<div class="line"><span class="lineno">  133</span>        <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.premiumValue *= -1;</div>
<div class="line"><span class="lineno">  134</span>        <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.upfrontPremiumValue *= -1;</div>
<div class="line"><span class="lineno">  135</span>        upfrontPremiumAmount *= -1;</div>
<div class="line"><span class="lineno">  136</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  137</span>        <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.protectionValue *= -1;</div>
<div class="line"><span class="lineno">  138</span>        <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.accrualRebateValue *= -1;</div>
<div class="line"><span class="lineno">  139</span>        <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.accrualRebateCurrentValue *= -1;</div>
<div class="line"><span class="lineno">  140</span>    }</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>    <span class="comment">// Final tranche NPV.</span></div>
<div class="line"><span class="lineno">  143</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.value = <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.premiumValue + <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.protectionValue +</div>
<div class="line"><span class="lineno">  144</span>        <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.upfrontPremiumValue + <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.accrualRebateValue;</div>
<div class="line"><span class="lineno">  145</span> </div>
<div class="line"><span class="lineno">  146</span>    <span class="comment">// Fair tranche spread.</span></div>
<div class="line"><span class="lineno">  147</span>    Real fairSpread = 0.0;</div>
<div class="line"><span class="lineno">  148</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.premiumValue != 0.0) {</div>
<div class="line"><span class="lineno">  149</span>        fairSpread = -(<a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.protectionValue + <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.upfrontPremiumValue) *</div>
<div class="line"><span class="lineno">  150</span>                     <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.runningRate / (<a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.premiumValue + <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.accrualRebateValue);</div>
<div class="line"><span class="lineno">  151</span>    }</div>
<div class="line"><span class="lineno">  152</span> </div>
<div class="line"><span class="lineno">  153</span>    timer.stop();</div>
<div class="line"><span class="lineno">  154</span> </div>
<div class="line"><span class="lineno">  155</span>    <span class="comment">// Populate the additional results.</span></div>
<div class="line"><span class="lineno">  156</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;attachment&quot;</span>] = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.basket-&gt;attachmentRatio();</div>
<div class="line"><span class="lineno">  157</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;detachment&quot;</span>] = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.basket-&gt;detachmentRatio();</div>
<div class="line"><span class="lineno">  158</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;fixedRate&quot;</span>] = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.runningRate;</div>
<div class="line"><span class="lineno">  159</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;fairSpread&quot;</span>] = fairSpread;</div>
<div class="line"><span class="lineno">  160</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;upfrontPremium&quot;</span>] = upfrontPremiumAmount;</div>
<div class="line"><span class="lineno">  161</span>    Real correlation = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.basket-&gt;correlation();</div>
<div class="line"><span class="lineno">  162</span>    <span class="keywordflow">if</span> (correlation != Null&lt;Real&gt;())</div>
<div class="line"><span class="lineno">  163</span>        <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;correlation&quot;</span>] = correlation;</div>
<div class="line"><span class="lineno">  164</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;upfrontPremiumNPV&quot;</span>] = <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.upfrontPremiumValue;</div>
<div class="line"><span class="lineno">  165</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;premiumLegNPV&quot;</span>] = <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.premiumValue;</div>
<div class="line"><span class="lineno">  166</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;accrualRebateNPV&quot;</span>] = <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.accrualRebateValue;</div>
<div class="line"><span class="lineno">  167</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;accrualRebateCurrentNPV&quot;</span>] = <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.accrualRebateCurrentValue;</div>
<div class="line"><span class="lineno">  168</span> </div>
<div class="line"><span class="lineno">  169</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;protectionLegNPV&quot;</span>] = <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.protectionValue;</div>
<div class="line"><span class="lineno">  170</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;calculationTime&quot;</span>] = timer.elapsed().wall * 1e-9;</div>
<div class="line"><span class="lineno">  171</span>}</div>
<div class="ttc" id="acdsoption_8cpp_html_afeb3e8b4e6ab6604c185b2ea55bbc728"><div class="ttname"><a href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a></div><div class="ttdeci">const Instrument::results * results_</div><div class="ttdef"><b>Definition:</b> <a href="cdsoption_8cpp_source.html#l00081">cdsoption.cpp:81</a></div></div>
<div class="ttc" id="atenorbasisswap_8cpp_html_a71b2ce0e52885aca4ce15e1d128b9f56"><div class="ttname"><a href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a></div><div class="ttdeci">Swap::arguments * arguments_</div><div class="ttdef"><b>Definition:</b> <a href="tenorbasisswap_8cpp_source.html#l00059">tenorbasisswap.cpp:59</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a633a2f63e35f5d5b6ec5b92ea38709ae" name="a633a2f63e35f5d5b6ec5b92ea38709ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a633a2f63e35f5d5b6ec5b92ea38709ae">&#9670;&#160;</a></span>discountCurve_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::Handle&lt;QuantLib::YieldTermStructure&gt; discountCurve_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="indexcdstrancheengine_8hpp_source.html#l00060">60</a> of file <a class="el" href="indexcdstrancheengine_8hpp_source.html">indexcdstrancheengine.hpp</a>.</p>

</div>
</div>
<a id="a4c03bc11ff086bfab1c39eb1409e968a" name="a4c03bc11ff086bfab1c39eb1409e968a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c03bc11ff086bfab1c39eb1409e968a">&#9670;&#160;</a></span>includeSettlementDateFlows_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::optional&lt;<a class="el" href="classbool.html">bool</a>&gt; includeSettlementDateFlows_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="indexcdstrancheengine_8hpp_source.html#l00061">61</a> of file <a class="el" href="indexcdstrancheengine_8hpp_source.html">indexcdstrancheengine.hpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.9.5
</small></address>
</body>
</html>
