<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<title>QuantExt: CommoditySwaptionMonteCarloEngine Class Reference</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="quantextextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-qle@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.8</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_quant_ext.html">QuantExt</a></li><li class="navelem"><a class="el" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html">CommoditySwaptionMonteCarloEngine</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">CommoditySwaptionMonteCarloEngine Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Commodity Swaption Monte Carlo Engine.  
 <a href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="commodityswaptionengine_8hpp_source.html">qle/pricingengines/commodityswaptionengine.hpp</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for CommoditySwaptionMonteCarloEngine:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine__inherit__graph.png" border="0" usemap="#a_commodity_swaption_monte_carlo_engine_inherit__map" alt="Inheritance graph"/></div>
<map name="a_commodity_swaption_monte_carlo_engine_inherit__map" id="a_commodity_swaption_monte_carlo_engine_inherit__map">
<area shape="rect" title="Commodity Swaption Monte Carlo Engine." alt="" coords="11,431,234,632"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html" title="Commodity Swaption Engine base class." alt="" coords="5,211,240,383"/>
<area shape="rect" href="class_quant_ext_1_1_generic_swaption_1_1engine.html" title="base class for swaption engines" alt="" coords="91,123,155,163"/>
<area shape="rect" title=" " alt="" coords="12,5,233,75"/>
</map>
</div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for CommoditySwaptionMonteCarloEngine:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine__coll__graph.png" border="0" usemap="#a_commodity_swaption_monte_carlo_engine_coll__map" alt="Collaboration graph"/></div>
<map name="a_commodity_swaption_monte_carlo_engine_coll__map" id="a_commodity_swaption_monte_carlo_engine_coll__map">
<area shape="rect" title="Commodity Swaption Monte Carlo Engine." alt="" coords="429,460,654,632"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html" title="Commodity Swaption Engine base class." alt="" coords="253,269,491,397"/>
<area shape="rect" href="class_quant_ext_1_1_generic_swaption_1_1engine.html" title="base class for swaption engines" alt="" coords="84,159,148,199"/>
<area shape="rect" title=" " alt="" coords="5,5,227,75"/>
<area shape="rect" title=" " alt="" coords="173,159,374,199"/>
<area shape="rect" title=" " alt="" coords="345,20,412,60"/>
<area shape="rect" title=" " alt="" coords="398,152,589,207"/>
<area shape="rect" title=" " alt="" coords="613,159,665,199"/>
<area shape="rect" title=" " alt="" coords="515,313,567,353"/>
<area shape="rect" title=" " alt="" coords="612,313,663,353"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:af5aa29212b436af49088fab2c11e2dd2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#af5aa29212b436af49088fab2c11e2dd2">CommoditySwaptionMonteCarloEngine</a> (const Handle&lt; YieldTermStructure &gt; &amp;discountCurve, const Handle&lt; QuantLib::BlackVolTermStructure &gt; &amp;vol, Size samples, Real beta=0.0, const Size seed=42)</td></tr>
<tr class="separator:af5aa29212b436af49088fab2c11e2dd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61eb1a24e5329ccc296715a40dc3a19a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a61eb1a24e5329ccc296715a40dc3a19a">calculate</a> () const override</td></tr>
<tr class="separator:a61eb1a24e5329ccc296715a40dc3a19a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_class_quant_ext_1_1_commodity_swaption_base_engine"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_class_quant_ext_1_1_commodity_swaption_base_engine')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html">CommoditySwaptionBaseEngine</a></td></tr>
<tr class="memitem:a478a8a738d51e1f58b35185670f594af inherit pub_methods_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a478a8a738d51e1f58b35185670f594af">CommoditySwaptionBaseEngine</a> (const Handle&lt; YieldTermStructure &gt; &amp;discountCurve, const Handle&lt; QuantLib::BlackVolTermStructure &gt; &amp;vol, Real beta=0.0)</td></tr>
<tr class="separator:a478a8a738d51e1f58b35185670f594af inherit pub_methods_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a429dc3ef9bdf678e9e7bcc9ae905abc7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a429dc3ef9bdf678e9e7bcc9ae905abc7">calculateSpot</a> (QuantLib::Size idxFixed, QuantLib::Size idxFloat, QuantLib::Real <a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#add35fc148fad63203443a6a80e62b52c">strike</a>) const</td></tr>
<tr class="memdesc:a429dc3ef9bdf678e9e7bcc9ae905abc7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculations when underlying swap references a commodity spot price.  <a href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a429dc3ef9bdf678e9e7bcc9ae905abc7">More...</a><br /></td></tr>
<tr class="separator:a429dc3ef9bdf678e9e7bcc9ae905abc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac89647ddeb0a4b07e97fb6842a1f5c92"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#ac89647ddeb0a4b07e97fb6842a1f5c92">calculateFuture</a> (QuantLib::Size idxFixed, QuantLib::Size idxFloat, QuantLib::Real <a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#add35fc148fad63203443a6a80e62b52c">strike</a>) const</td></tr>
<tr class="memdesc:ac89647ddeb0a4b07e97fb6842a1f5c92"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculations when underlying swap references a commodity spot price.  <a href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#ac89647ddeb0a4b07e97fb6842a1f5c92">More...</a><br /></td></tr>
<tr class="separator:ac89647ddeb0a4b07e97fb6842a1f5c92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7a428699a75a8f5613f980348923683"><td class="memItemLeft" align="right" valign="top">QuantLib::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#ad7a428699a75a8f5613f980348923683">spotFloatLegFactor</a> (QuantLib::Size idxFloat, QuantLib::Real discountExercise) const</td></tr>
<tr class="separator:ad7a428699a75a8f5613f980348923683"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1f32e8b21b4f9e2a46339a059b50612"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#aa1f32e8b21b4f9e2a46339a059b50612">futureFloatLegFactors</a> (QuantLib::Size idxFloat, QuantLib::Real discountExercise, const std::vector&lt; QuantLib::Date &gt; &amp;expiries, QuantLib::Matrix &amp;floatLegFactors, QuantLib::Array &amp;discounts, QuantLib::Array &amp;amounts) const</td></tr>
<tr class="separator:aa1f32e8b21b4f9e2a46339a059b50612"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc261e525034ef40d86028e768cec629"><td class="memItemLeft" align="right" valign="top">std::map&lt; QuantLib::Date, QuantLib::Real &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#acc261e525034ef40d86028e768cec629">futureExpiries</a> (QuantLib::Size idxFloat, QuantLib::Matrix &amp;outSqrtCorr, QuantLib::Real <a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#add35fc148fad63203443a6a80e62b52c">strike</a>) const</td></tr>
<tr class="separator:acc261e525034ef40d86028e768cec629"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a6ca6ca73af9920c0423b5e6c682ffb78"><td class="memItemLeft" align="right" valign="top">Size&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a6ca6ca73af9920c0423b5e6c682ffb78">samples_</a></td></tr>
<tr class="separator:a6ca6ca73af9920c0423b5e6c682ffb78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ad21b943e0b26e7e635844cb88707ae"><td class="memItemLeft" align="right" valign="top">long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a9ad21b943e0b26e7e635844cb88707ae">seed_</a></td></tr>
<tr class="separator:a9ad21b943e0b26e7e635844cb88707ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="inherited" name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pro_methods_class_quant_ext_1_1_commodity_swaption_base_engine"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_class_quant_ext_1_1_commodity_swaption_base_engine')"><img src="closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html">CommoditySwaptionBaseEngine</a></td></tr>
<tr class="memitem:aea36c4e4272e7df5899ad72848c5fe9f inherit pro_methods_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memItemLeft" align="right" valign="top">QuantLib::Size&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#aea36c4e4272e7df5899ad72848c5fe9f">fixedLegIndex</a> () const</td></tr>
<tr class="separator:aea36c4e4272e7df5899ad72848c5fe9f inherit pro_methods_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6703de3908f802246c0d5a3c7a0f9ef5 inherit pro_methods_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memItemLeft" align="right" valign="top">QuantLib::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a6703de3908f802246c0d5a3c7a0f9ef5">fixedLegValue</a> (QuantLib::Size <a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#aea36c4e4272e7df5899ad72848c5fe9f">fixedLegIndex</a>) const</td></tr>
<tr class="memdesc:a6703de3908f802246c0d5a3c7a0f9ef5 inherit pro_methods_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="mdescLeft">&#160;</td><td class="mdescRight">Give back the fixed leg price at the swaption expiry time.  <a href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a6703de3908f802246c0d5a3c7a0f9ef5">More...</a><br /></td></tr>
<tr class="separator:a6703de3908f802246c0d5a3c7a0f9ef5 inherit pro_methods_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add35fc148fad63203443a6a80e62b52c inherit pro_methods_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memItemLeft" align="right" valign="top">QuantLib::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#add35fc148fad63203443a6a80e62b52c">strike</a> (QuantLib::Size <a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#aea36c4e4272e7df5899ad72848c5fe9f">fixedLegIndex</a>) const</td></tr>
<tr class="separator:add35fc148fad63203443a6a80e62b52c inherit pro_methods_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15d4531a1671fa50a37a7a1e4a813131 inherit pro_methods_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memItemLeft" align="right" valign="top">QuantLib::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a15d4531a1671fa50a37a7a1e4a813131">rho</a> (const QuantLib::Date &amp;ed_1, const QuantLib::Date &amp;ed_2) const</td></tr>
<tr class="separator:a15d4531a1671fa50a37a7a1e4a813131 inherit pro_methods_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acac0f5c8feb6122c58a2e070365cbe2c inherit pro_methods_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#acac0f5c8feb6122c58a2e070365cbe2c">averaging</a> (QuantLib::Size floatLegIndex) const</td></tr>
<tr class="separator:acac0f5c8feb6122c58a2e070365cbe2c inherit pro_methods_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_attribs_class_quant_ext_1_1_commodity_swaption_base_engine"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_class_quant_ext_1_1_commodity_swaption_base_engine')"><img src="closed.png" alt="-"/>&#160;Protected Attributes inherited from <a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html">CommoditySwaptionBaseEngine</a></td></tr>
<tr class="memitem:a188f6df4c42679c1c133919254e351c5 inherit pro_attribs_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memItemLeft" align="right" valign="top">Handle&lt; YieldTermStructure &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a188f6df4c42679c1c133919254e351c5">discountCurve_</a></td></tr>
<tr class="separator:a188f6df4c42679c1c133919254e351c5 inherit pro_attribs_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a123a04063be0178e9eb8a912b357528d inherit pro_attribs_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memItemLeft" align="right" valign="top">Handle&lt; QuantLib::BlackVolTermStructure &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a123a04063be0178e9eb8a912b357528d">volStructure_</a></td></tr>
<tr class="separator:a123a04063be0178e9eb8a912b357528d inherit pro_attribs_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6483291df5e2a5a0d80b22cf68a96750 inherit pro_attribs_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memItemLeft" align="right" valign="top">Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a6483291df5e2a5a0d80b22cf68a96750">beta_</a></td></tr>
<tr class="separator:a6483291df5e2a5a0d80b22cf68a96750 inherit pro_attribs_class_quant_ext_1_1_commodity_swaption_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Commodity Swaption Monte Carlo Engine. </p>
<p >Monte Carlo implementation of the Swaption payoff for as documented in ORE+ Product Catalogue. Reference: Iain Clark, Commodity Option Pricing, Wiley, section 2.8 </p>

<p class="definition">Definition at line <a class="el" href="commodityswaptionengine_8hpp_source.html#l00116">116</a> of file <a class="el" href="commodityswaptionengine_8hpp_source.html">commodityswaptionengine.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="af5aa29212b436af49088fab2c11e2dd2" name="af5aa29212b436af49088fab2c11e2dd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5aa29212b436af49088fab2c11e2dd2">&#9670;&#160;</a></span>CommoditySwaptionMonteCarloEngine()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html">CommoditySwaptionMonteCarloEngine</a> </td>
          <td>(</td>
          <td class="paramtype">const Handle&lt; YieldTermStructure &gt; &amp;&#160;</td>
          <td class="paramname"><em>discountCurve</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Handle&lt; QuantLib::BlackVolTermStructure &gt; &amp;&#160;</td>
          <td class="paramname"><em>vol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Size&#160;</td>
          <td class="paramname"><em>samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Real&#160;</td>
          <td class="paramname"><em>beta</em> = <code>0.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Size&#160;</td>
          <td class="paramname"><em>seed</em> = <code>42</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityswaptionengine_8hpp_source.html#l00118">118</a> of file <a class="el" href="commodityswaptionengine_8hpp_source.html">commodityswaptionengine.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  121</span>        : <a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a478a8a738d51e1f58b35185670f594af">CommoditySwaptionBaseEngine</a>(discountCurve, vol, beta), <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a6ca6ca73af9920c0423b5e6c682ffb78">samples_</a>(samples), <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a9ad21b943e0b26e7e635844cb88707ae">seed_</a>(seed) {}</div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_swaption_base_engine_html_a478a8a738d51e1f58b35185670f594af"><div class="ttname"><a href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a478a8a738d51e1f58b35185670f594af">QuantExt::CommoditySwaptionBaseEngine::CommoditySwaptionBaseEngine</a></div><div class="ttdeci">CommoditySwaptionBaseEngine(const Handle&lt; YieldTermStructure &gt; &amp;discountCurve, const Handle&lt; QuantLib::BlackVolTermStructure &gt; &amp;vol, Real beta=0.0)</div><div class="ttdef"><b>Definition:</b> <a href="commodityswaptionengine_8cpp_source.html#l00077">commodityswaptionengine.cpp:77</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_html_a6ca6ca73af9920c0423b5e6c682ffb78"><div class="ttname"><a href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a6ca6ca73af9920c0423b5e6c682ffb78">QuantExt::CommoditySwaptionMonteCarloEngine::samples_</a></div><div class="ttdeci">Size samples_</div><div class="ttdef"><b>Definition:</b> <a href="commodityswaptionengine_8hpp_source.html#l00153">commodityswaptionengine.hpp:153</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_html_a9ad21b943e0b26e7e635844cb88707ae"><div class="ttname"><a href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a9ad21b943e0b26e7e635844cb88707ae">QuantExt::CommoditySwaptionMonteCarloEngine::seed_</a></div><div class="ttdeci">long seed_</div><div class="ttdef"><b>Definition:</b> <a href="commodityswaptionengine_8hpp_source.html#l00154">commodityswaptionengine.hpp:154</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a61eb1a24e5329ccc296715a40dc3a19a" name="a61eb1a24e5329ccc296715a40dc3a19a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61eb1a24e5329ccc296715a40dc3a19a">&#9670;&#160;</a></span>calculate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calculate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityswaptionengine_8cpp_source.html#l00394">394</a> of file <a class="el" href="commodityswaptionengine_8cpp_source.html">commodityswaptionengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  394</span>                                                        {</div>
<div class="line"><span class="lineno">  395</span> </div>
<div class="line"><span class="lineno">  396</span>    <span class="comment">// Get the index of the fixed and floating leg</span></div>
<div class="line"><span class="lineno">  397</span>    Size idxFixed = <a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#aea36c4e4272e7df5899ad72848c5fe9f">fixedLegIndex</a>();</div>
<div class="line"><span class="lineno">  398</span>    Size idxFloat = idxFixed == 0 ? 1 : 0;</div>
<div class="line"><span class="lineno">  399</span> </div>
<div class="line"><span class="lineno">  400</span>    <span class="comment">// Determines the strike at which we read values from the vol surface.</span></div>
<div class="line"><span class="lineno">  401</span>    Real strikePrice = <a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#add35fc148fad63203443a6a80e62b52c">strike</a>(idxFixed);</div>
<div class="line"><span class="lineno">  402</span> </div>
<div class="line"><span class="lineno">  403</span>    <span class="comment">// Switch implementation depending on whether underlying swap references a spot or future price</span></div>
<div class="line"><span class="lineno">  404</span>    <span class="keywordflow">if</span> (referencesFuturePrice(<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.legs[idxFloat])) {</div>
<div class="line"><span class="lineno">  405</span>        <a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#ac89647ddeb0a4b07e97fb6842a1f5c92">calculateFuture</a>(idxFixed, idxFloat, strikePrice);</div>
<div class="line"><span class="lineno">  406</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  407</span>        <a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a429dc3ef9bdf678e9e7bcc9ae905abc7">calculateSpot</a>(idxFixed, idxFloat, strikePrice);</div>
<div class="line"><span class="lineno">  408</span>    }</div>
<div class="line"><span class="lineno">  409</span>}</div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_swaption_base_engine_html_add35fc148fad63203443a6a80e62b52c"><div class="ttname"><a href="class_quant_ext_1_1_commodity_swaption_base_engine.html#add35fc148fad63203443a6a80e62b52c">QuantExt::CommoditySwaptionBaseEngine::strike</a></div><div class="ttdeci">QuantLib::Real strike(QuantLib::Size fixedLegIndex) const</div><div class="ttdef"><b>Definition:</b> <a href="commodityswaptionengine_8cpp_source.html#l00131">commodityswaptionengine.cpp:131</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_swaption_base_engine_html_aea36c4e4272e7df5899ad72848c5fe9f"><div class="ttname"><a href="class_quant_ext_1_1_commodity_swaption_base_engine.html#aea36c4e4272e7df5899ad72848c5fe9f">QuantExt::CommoditySwaptionBaseEngine::fixedLegIndex</a></div><div class="ttdeci">QuantLib::Size fixedLegIndex() const</div><div class="ttdef"><b>Definition:</b> <a href="commodityswaptionengine_8cpp_source.html#l00085">commodityswaptionengine.cpp:85</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_html_a429dc3ef9bdf678e9e7bcc9ae905abc7"><div class="ttname"><a href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a429dc3ef9bdf678e9e7bcc9ae905abc7">QuantExt::CommoditySwaptionMonteCarloEngine::calculateSpot</a></div><div class="ttdeci">void calculateSpot(QuantLib::Size idxFixed, QuantLib::Size idxFloat, QuantLib::Real strike) const</div><div class="ttdoc">Calculations when underlying swap references a commodity spot price.</div><div class="ttdef"><b>Definition:</b> <a href="commodityswaptionengine_8cpp_source.html#l00411">commodityswaptionengine.cpp:411</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_html_ac89647ddeb0a4b07e97fb6842a1f5c92"><div class="ttname"><a href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#ac89647ddeb0a4b07e97fb6842a1f5c92">QuantExt::CommoditySwaptionMonteCarloEngine::calculateFuture</a></div><div class="ttdeci">void calculateFuture(QuantLib::Size idxFixed, QuantLib::Size idxFloat, QuantLib::Real strike) const</div><div class="ttdoc">Calculations when underlying swap references a commodity spot price.</div><div class="ttdef"><b>Definition:</b> <a href="commodityswaptionengine_8cpp_source.html#l00468">commodityswaptionengine.cpp:468</a></div></div>
<div class="ttc" id="atenorbasisswap_8cpp_html_a71b2ce0e52885aca4ce15e1d128b9f56"><div class="ttname"><a href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a></div><div class="ttdeci">Swap::arguments * arguments_</div><div class="ttdef"><b>Definition:</b> <a href="tenorbasisswap_8cpp_source.html#l00059">tenorbasisswap.cpp:59</a></div></div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine_a61eb1a24e5329ccc296715a40dc3a19a_cgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_a61eb1a24e5329ccc296715a40dc3a19a_cgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_a61eb1a24e5329ccc296715a40dc3a19a_cgraph" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_a61eb1a24e5329ccc296715a40dc3a19a_cgraph">
<area shape="rect" title=" " alt="" coords="5,82,80,107"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#ac89647ddeb0a4b07e97fb6842a1f5c92" title="Calculations when underlying swap references a commodity spot price." alt="" coords="128,170,239,195"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#aea36c4e4272e7df5899ad72848c5fe9f" title=" " alt="" coords="791,29,995,69"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#add35fc148fad63203443a6a80e62b52c" title=" " alt="" coords="539,29,743,69"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a429dc3ef9bdf678e9e7bcc9ae905abc7" title="Calculations when underlying swap references a commodity spot price." alt="" coords="133,358,234,383"/>
<area shape="rect" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9" title=" " alt="" coords="839,151,946,177"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a6703de3908f802246c0d5a3c7a0f9ef5" title="Give back the fixed leg price at the swaption expiry time." alt="" coords="287,293,491,333"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#acc261e525034ef40d86028e768cec629" title=" " alt="" coords="338,145,439,170"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#aa1f32e8b21b4f9e2a46339a059b50612" title=" " alt="" coords="315,194,463,219"/>
<area shape="rect" href="namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1" title=" " alt="" coords="333,243,444,269"/>
<area shape="rect" href="namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2" title=" " alt="" coords="335,358,442,383"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#acac0f5c8feb6122c58a2e070365cbe2c" title=" " alt="" coords="539,208,743,248"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a15d4531a1671fa50a37a7a1e4a813131" title=" " alt="" coords="539,144,743,184"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#ad7a428699a75a8f5613f980348923683" title=" " alt="" coords="321,459,456,485"/>
</map>
</div>

</div>
</div>
<a id="a429dc3ef9bdf678e9e7bcc9ae905abc7" name="a429dc3ef9bdf678e9e7bcc9ae905abc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a429dc3ef9bdf678e9e7bcc9ae905abc7">&#9670;&#160;</a></span>calculateSpot()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calculateSpot </td>
          <td>(</td>
          <td class="paramtype">QuantLib::Size&#160;</td>
          <td class="paramname"><em>idxFixed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Size&#160;</td>
          <td class="paramname"><em>idxFloat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Real&#160;</td>
          <td class="paramname"><em>strike</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculations when underlying swap references a commodity spot price. </p>

<p class="definition">Definition at line <a class="el" href="commodityswaptionengine_8cpp_source.html#l00411">411</a> of file <a class="el" href="commodityswaptionengine_8cpp_source.html">commodityswaptionengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  411</span>                                                                                                     {</div>
<div class="line"><span class="lineno">  412</span> </div>
<div class="line"><span class="lineno">  413</span>    <span class="comment">// Fixed leg value</span></div>
<div class="line"><span class="lineno">  414</span>    Real valueFixedLeg = <a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a6703de3908f802246c0d5a3c7a0f9ef5">fixedLegValue</a>(idxFixed);</div>
<div class="line"><span class="lineno">  415</span> </div>
<div class="line"><span class="lineno">  416</span>    <span class="comment">// If float leg payer flag is 1 (-1) =&gt; rec (pay) float and pay (rec) fixed =&gt; omega = 1 (-1) for payer (receiver).</span></div>
<div class="line"><span class="lineno">  417</span>    Real omega = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.payer[idxFloat];</div>
<div class="line"><span class="lineno">  418</span> </div>
<div class="line"><span class="lineno">  419</span>    <span class="comment">// Time to swaption expiry</span></div>
<div class="line"><span class="lineno">  420</span>    Date exercise = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.exercise-&gt;dateAt(0);</div>
<div class="line"><span class="lineno">  421</span>    Time t_e = <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a123a04063be0178e9eb8a912b357528d">volStructure_</a>-&gt;timeFromReference(exercise);</div>
<div class="line"><span class="lineno">  422</span> </div>
<div class="line"><span class="lineno">  423</span>    <span class="comment">// Discount to exercise</span></div>
<div class="line"><span class="lineno">  424</span>    Real discountExercise = <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a188f6df4c42679c1c133919254e351c5">discountCurve_</a>-&gt;discount(exercise);</div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>    <span class="comment">// Variance of spot process to expiry</span></div>
<div class="line"><span class="lineno">  427</span>    Real var = <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a123a04063be0178e9eb8a912b357528d">volStructure_</a>-&gt;blackVariance(t_e, <a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#add35fc148fad63203443a6a80e62b52c">strike</a>);</div>
<div class="line"><span class="lineno">  428</span>    Real stdDev = <a class="code hl_function" href="namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(var);</div>
<div class="line"><span class="lineno">  429</span> </div>
<div class="line"><span class="lineno">  430</span>    <span class="comment">// Sample spot is S_i(t_e) = F(0, t_e) exp(-var / 2) exp(stdDev z_i). factor is second two term here.</span></div>
<div class="line"><span class="lineno">  431</span>    Real factor = <a class="code hl_function" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9">exp</a>(-var / 2.0);</div>
<div class="line"><span class="lineno">  432</span> </div>
<div class="line"><span class="lineno">  433</span>    <span class="comment">// Populate these values below</span></div>
<div class="line"><span class="lineno">  434</span>    Real optionValue = 0.0;</div>
<div class="line"><span class="lineno">  435</span>    Real swapValue = 0.0;</div>
<div class="line"><span class="lineno">  436</span>    Real floatLegValue = 0.0;</div>
<div class="line"><span class="lineno">  437</span> </div>
<div class="line"><span class="lineno">  438</span>    <span class="comment">// Create the standard normal RNG</span></div>
<div class="line"><span class="lineno">  439</span>    LowDiscrepancy::rsg_type rsg = LowDiscrepancy::make_sequence_generator(1, <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a9ad21b943e0b26e7e635844cb88707ae">seed_</a>);</div>
<div class="line"><span class="lineno">  440</span> </div>
<div class="line"><span class="lineno">  441</span>    <span class="comment">// Get the value that when multiplied by the sample value gives the float leg value</span></div>
<div class="line"><span class="lineno">  442</span>    Real floatFactor = <a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#ad7a428699a75a8f5613f980348923683">spotFloatLegFactor</a>(idxFloat, discountExercise);</div>
<div class="line"><span class="lineno">  443</span> </div>
<div class="line"><span class="lineno">  444</span>    <span class="comment">// Value swap at swaption exercise date over a number, i = 1, ..., N of samples i.e. \hat{V}_i(t_e) from ORE+</span></div>
<div class="line"><span class="lineno">  445</span>    <span class="comment">// Product Catalogue. Value of the swaption at time 0 is then P(0, t_e) \sum_{i=1}^{N} \hat{V}^{+}_i(t_e) / N</span></div>
<div class="line"><span class="lineno">  446</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a6ca6ca73af9920c0423b5e6c682ffb78">samples_</a>; i++) {</div>
<div class="line"><span class="lineno">  447</span> </div>
<div class="line"><span class="lineno">  448</span>        <span class="comment">// Sample value is S_i(t_e) / F(0, t_e) = exp(-var / 2) exp(stdDev z_i).</span></div>
<div class="line"><span class="lineno">  449</span>        Real sample = factor * <a class="code hl_function" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9">exp</a>(stdDev * rsg.nextSequence().value[0]);</div>
<div class="line"><span class="lineno">  450</span> </div>
<div class="line"><span class="lineno">  451</span>        <span class="comment">// Calculate float leg value and swap value given sample</span></div>
<div class="line"><span class="lineno">  452</span>        Real sampleFloatLegValue = floatFactor * sample;</div>
<div class="line"><span class="lineno">  453</span>        Real sampleSwapValue = omega * (sampleFloatLegValue - valueFixedLeg);</div>
<div class="line"><span class="lineno">  454</span> </div>
<div class="line"><span class="lineno">  455</span>        <span class="comment">// Update values dividing by samples each time to guard against blow up.</span></div>
<div class="line"><span class="lineno">  456</span>        optionValue += <a class="code hl_function" href="namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(sampleSwapValue, 0.0) / <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a6ca6ca73af9920c0423b5e6c682ffb78">samples_</a>;</div>
<div class="line"><span class="lineno">  457</span>        swapValue += sampleSwapValue / <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a6ca6ca73af9920c0423b5e6c682ffb78">samples_</a>;</div>
<div class="line"><span class="lineno">  458</span>        floatLegValue += sampleFloatLegValue / <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a6ca6ca73af9920c0423b5e6c682ffb78">samples_</a>;</div>
<div class="line"><span class="lineno">  459</span>    }</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>    <span class="comment">// Populate the results remembering to multiply by P(0, t_e)</span></div>
<div class="line"><span class="lineno">  462</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.value = discountExercise * optionValue;</div>
<div class="line"><span class="lineno">  463</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;SwapNPV&quot;</span>] = discountExercise * swapValue;</div>
<div class="line"><span class="lineno">  464</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FixedLegNPV&quot;</span>] = discountExercise * valueFixedLeg;</div>
<div class="line"><span class="lineno">  465</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FloatingLegNPV&quot;</span>] = discountExercise * floatLegValue;</div>
<div class="line"><span class="lineno">  466</span>}</div>
<div class="ttc" id="acdsoption_8cpp_html_afeb3e8b4e6ab6604c185b2ea55bbc728"><div class="ttname"><a href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a></div><div class="ttdeci">const Instrument::results * results_</div><div class="ttdef"><b>Definition:</b> <a href="cdsoption_8cpp_source.html#l00081">cdsoption.cpp:81</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_swaption_base_engine_html_a123a04063be0178e9eb8a912b357528d"><div class="ttname"><a href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a123a04063be0178e9eb8a912b357528d">QuantExt::CommoditySwaptionBaseEngine::volStructure_</a></div><div class="ttdeci">Handle&lt; QuantLib::BlackVolTermStructure &gt; volStructure_</div><div class="ttdef"><b>Definition:</b> <a href="commodityswaptionengine_8hpp_source.html#l00070">commodityswaptionengine.hpp:70</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_swaption_base_engine_html_a188f6df4c42679c1c133919254e351c5"><div class="ttname"><a href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a188f6df4c42679c1c133919254e351c5">QuantExt::CommoditySwaptionBaseEngine::discountCurve_</a></div><div class="ttdeci">Handle&lt; YieldTermStructure &gt; discountCurve_</div><div class="ttdef"><b>Definition:</b> <a href="commodityswaptionengine_8hpp_source.html#l00069">commodityswaptionengine.hpp:69</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_swaption_base_engine_html_a6703de3908f802246c0d5a3c7a0f9ef5"><div class="ttname"><a href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a6703de3908f802246c0d5a3c7a0f9ef5">QuantExt::CommoditySwaptionBaseEngine::fixedLegValue</a></div><div class="ttdeci">QuantLib::Real fixedLegValue(QuantLib::Size fixedLegIndex) const</div><div class="ttdoc">Give back the fixed leg price at the swaption expiry time.</div><div class="ttdef"><b>Definition:</b> <a href="commodityswaptionengine_8cpp_source.html#l00114">commodityswaptionengine.cpp:114</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_html_ad7a428699a75a8f5613f980348923683"><div class="ttname"><a href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#ad7a428699a75a8f5613f980348923683">QuantExt::CommoditySwaptionMonteCarloEngine::spotFloatLegFactor</a></div><div class="ttdeci">QuantLib::Real spotFloatLegFactor(QuantLib::Size idxFloat, QuantLib::Real discountExercise) const</div><div class="ttdef"><b>Definition:</b> <a href="commodityswaptionengine_8cpp_source.html#l00554">commodityswaptionengine.cpp:554</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_a0780e43df89be3d7f7671eca2418cdd1"><div class="ttname"><a href="namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">QuantExt::max</a></div><div class="ttdeci">RandomVariable max(RandomVariable x, const RandomVariable &amp;y)</div><div class="ttdef"><b>Definition:</b> <a href="qle_2math_2randomvariable_8cpp_source.html#l00387">randomvariable.cpp:387</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_a11171c842d01ffacc4ec522e398070a9"><div class="ttname"><a href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9">QuantExt::exp</a></div><div class="ttdeci">RandomVariable exp(RandomVariable x)</div><div class="ttdef"><b>Definition:</b> <a href="qle_2math_2randomvariable_8cpp_source.html#l00445">randomvariable.cpp:445</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_a1b4a64a3620f987e65fec4ccf7cadcf2"><div class="ttname"><a href="namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">QuantExt::sqrt</a></div><div class="ttdeci">RandomVariable sqrt(RandomVariable x)</div><div class="ttdef"><b>Definition:</b> <a href="qle_2math_2randomvariable_8cpp_source.html#l00459">randomvariable.cpp:459</a></div></div>
</div><!-- fragment --><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine_a429dc3ef9bdf678e9e7bcc9ae905abc7_cgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_a429dc3ef9bdf678e9e7bcc9ae905abc7_cgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_a429dc3ef9bdf678e9e7bcc9ae905abc7_cgraph" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_a429dc3ef9bdf678e9e7bcc9ae905abc7_cgraph">
<area shape="rect" title="Calculations when underlying swap references a commodity spot price." alt="" coords="5,149,107,175"/>
<area shape="rect" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9" title=" " alt="" coords="203,5,310,31"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a6703de3908f802246c0d5a3c7a0f9ef5" title="Give back the fixed leg price at the swaption expiry time." alt="" coords="155,55,359,95"/>
<area shape="rect" href="namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1" title=" " alt="" coords="201,120,312,145"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#ad7a428699a75a8f5613f980348923683" title=" " alt="" coords="189,284,324,309"/>
<area shape="rect" href="namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2" title=" " alt="" coords="203,235,310,260"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#add35fc148fad63203443a6a80e62b52c" title=" " alt="" coords="155,170,359,210"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#aea36c4e4272e7df5899ad72848c5fe9f" title=" " alt="" coords="407,113,611,153"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#acac0f5c8feb6122c58a2e070365cbe2c" title=" " alt="" coords="407,277,611,317"/>
</map>
</div>
<div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine_a429dc3ef9bdf678e9e7bcc9ae905abc7_icgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_a429dc3ef9bdf678e9e7bcc9ae905abc7_icgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_a429dc3ef9bdf678e9e7bcc9ae905abc7_icgraph" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_a429dc3ef9bdf678e9e7bcc9ae905abc7_icgraph">
<area shape="rect" title="Calculations when underlying swap references a commodity spot price." alt="" coords="128,5,229,31"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,5,80,31"/>
</map>
</div>

</div>
</div>
<a id="ac89647ddeb0a4b07e97fb6842a1f5c92" name="ac89647ddeb0a4b07e97fb6842a1f5c92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac89647ddeb0a4b07e97fb6842a1f5c92">&#9670;&#160;</a></span>calculateFuture()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calculateFuture </td>
          <td>(</td>
          <td class="paramtype">QuantLib::Size&#160;</td>
          <td class="paramname"><em>idxFixed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Size&#160;</td>
          <td class="paramname"><em>idxFloat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Real&#160;</td>
          <td class="paramname"><em>strike</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculations when underlying swap references a commodity spot price. </p>

<p class="definition">Definition at line <a class="el" href="commodityswaptionengine_8cpp_source.html#l00468">468</a> of file <a class="el" href="commodityswaptionengine_8cpp_source.html">commodityswaptionengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  468</span>                                                                                                       {</div>
<div class="line"><span class="lineno">  469</span> </div>
<div class="line"><span class="lineno">  470</span>    <span class="comment">// Fixed leg value</span></div>
<div class="line"><span class="lineno">  471</span>    Real valueFixedLeg = <a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a6703de3908f802246c0d5a3c7a0f9ef5">fixedLegValue</a>(idxFixed);</div>
<div class="line"><span class="lineno">  472</span> </div>
<div class="line"><span class="lineno">  473</span>    <span class="comment">// Unique expiry dates</span></div>
<div class="line"><span class="lineno">  474</span>    Matrix sqrtCorr;</div>
<div class="line"><span class="lineno">  475</span>    map&lt;Date, Real&gt; expiries = <a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#acc261e525034ef40d86028e768cec629">futureExpiries</a>(idxFloat, sqrtCorr, <a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#add35fc148fad63203443a6a80e62b52c">strike</a>);</div>
<div class="line"><span class="lineno">  476</span> </div>
<div class="line"><span class="lineno">  477</span>    <span class="comment">// Generate n _independent_ standard normal variables {Z_{i,1}, ..., Z_{i,n}} where n is the number of future</span></div>
<div class="line"><span class="lineno">  478</span>    <span class="comment">// contracts that we are modelling and i = 1, ..., N is the number of samples. It is a speed-up to set n = 1 if</span></div>
<div class="line"><span class="lineno">  479</span>    <span class="comment">// correlation between all the future contracts is 1.0 i.e. beta_ = 0.0. We don&#39;t do this and prefer code clarity.</span></div>
<div class="line"><span class="lineno">  480</span>    LowDiscrepancy::rsg_type rsg = LowDiscrepancy::make_sequence_generator(expiries.size(), <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a9ad21b943e0b26e7e635844cb88707ae">seed_</a>);</div>
<div class="line"><span class="lineno">  481</span> </div>
<div class="line"><span class="lineno">  482</span>    <span class="comment">// If float leg payer flag is 1 (-1) =&gt; rec (pay) float and pay (rec) fixed =&gt; omega = 1 (-1) for payer (receiver).</span></div>
<div class="line"><span class="lineno">  483</span>    Real omega = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.payer[idxFloat];</div>
<div class="line"><span class="lineno">  484</span> </div>
<div class="line"><span class="lineno">  485</span>    <span class="comment">// Time to swaption expiry</span></div>
<div class="line"><span class="lineno">  486</span>    Date exercise = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.exercise-&gt;dateAt(0);</div>
<div class="line"><span class="lineno">  487</span>    Time t_e = <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a123a04063be0178e9eb8a912b357528d">volStructure_</a>-&gt;timeFromReference(exercise);</div>
<div class="line"><span class="lineno">  488</span> </div>
<div class="line"><span class="lineno">  489</span>    <span class="comment">// Discount to exercise</span></div>
<div class="line"><span class="lineno">  490</span>    Real discountExercise = <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a188f6df4c42679c1c133919254e351c5">discountCurve_</a>-&gt;discount(exercise);</div>
<div class="line"><span class="lineno">  491</span> </div>
<div class="line"><span class="lineno">  492</span>    <span class="comment">// Precalculate exp{-var_j / 2} and stdDev_j mentioned in comment above</span></div>
<div class="line"><span class="lineno">  493</span>    vector&lt;Real&gt; expVar;</div>
<div class="line"><span class="lineno">  494</span>    vector&lt;Real&gt; stdDev;</div>
<div class="line"><span class="lineno">  495</span>    vector&lt;Date&gt; expiryDates;</div>
<div class="line"><span class="lineno">  496</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : expiries) {</div>
<div class="line"><span class="lineno">  497</span>        Real var = p.second * p.second * t_e;</div>
<div class="line"><span class="lineno">  498</span>        expVar.push_back(<a class="code hl_function" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9">exp</a>(-var / 2.0));</div>
<div class="line"><span class="lineno">  499</span>        stdDev.push_back(<a class="code hl_function" href="namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(var));</div>
<div class="line"><span class="lineno">  500</span>        expiryDates.push_back(p.first);</div>
<div class="line"><span class="lineno">  501</span>    }</div>
<div class="line"><span class="lineno">  502</span> </div>
<div class="line"><span class="lineno">  503</span>    <span class="comment">// Populate these values below</span></div>
<div class="line"><span class="lineno">  504</span>    Real optionValue = 0.0;</div>
<div class="line"><span class="lineno">  505</span>    Real swapValue = 0.0;</div>
<div class="line"><span class="lineno">  506</span>    Real floatLegValue = 0.0;</div>
<div class="line"><span class="lineno">  507</span> </div>
<div class="line"><span class="lineno">  508</span>    <span class="comment">// Values that will be used to calculate floating leg value on each iteration. We precalculate as much as</span></div>
<div class="line"><span class="lineno">  509</span>    <span class="comment">// possible here to avoid calculation on each iteration.</span></div>
<div class="line"><span class="lineno">  510</span>    Size numCfs = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.legs[idxFloat].size();</div>
<div class="line"><span class="lineno">  511</span>    Matrix factors(numCfs, expiries.size(), 0.0);</div>
<div class="line"><span class="lineno">  512</span>    Array discounts(numCfs, 0.0);</div>
<div class="line"><span class="lineno">  513</span>    Array amounts(numCfs, 0.0);</div>
<div class="line"><span class="lineno">  514</span>    <a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#aa1f32e8b21b4f9e2a46339a059b50612">futureFloatLegFactors</a>(idxFloat, discountExercise, expiryDates, factors, discounts, amounts);</div>
<div class="line"><span class="lineno">  515</span>    Array factor = (discounts * amounts) * factors;</div>
<div class="line"><span class="lineno">  516</span> </div>
<div class="line"><span class="lineno">  517</span>    <span class="comment">// Value swap at swaption exercise date over a number, i = 1, ..., N of samples i.e. \hat{V}_i(t_e) from ORE+</span></div>
<div class="line"><span class="lineno">  518</span>    <span class="comment">// Product Catalogue. Value of the swaption at time 0 is then P(0, t_e) \sum_{i=1}^{N} \hat{V}^{+}_i(t_e) / N</span></div>
<div class="line"><span class="lineno">  519</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a6ca6ca73af9920c0423b5e6c682ffb78">samples_</a>; i++) {</div>
<div class="line"><span class="lineno">  520</span> </div>
<div class="line"><span class="lineno">  521</span>        <span class="comment">// sequence is n independent standard normal random variables</span></div>
<div class="line"><span class="lineno">  522</span>        vector&lt;Real&gt; sequence = rsg.nextSequence().value;</div>
<div class="line"><span class="lineno">  523</span> </div>
<div class="line"><span class="lineno">  524</span>        <span class="comment">// w holds n correlated standard normal variables</span></div>
<div class="line"><span class="lineno">  525</span>        Array w = sqrtCorr * Array(sequence.begin(), sequence.end());</div>
<div class="line"><span class="lineno">  526</span> </div>
<div class="line"><span class="lineno">  527</span>        <span class="comment">// Update w to hold the sample value that we want i.e.</span></div>
<div class="line"><span class="lineno">  528</span>        <span class="comment">//   F_{i,j}(t_e) / F_{i,j}(0) = exp{-var_j / 2} exp{stdDev_j w_{i,j}}</span></div>
<div class="line"><span class="lineno">  529</span>        <span class="comment">// where j = 1,..., n indexes the futures (i.e. date keys in the map)</span></div>
<div class="line"><span class="lineno">  530</span>        <span class="comment">// and i = 1,..., N indexes the number of Monte Carlo samples.</span></div>
<div class="line"><span class="lineno">  531</span>        <span class="keywordflow">for</span> (Size i = 0; i &lt; w.size(); i++) {</div>
<div class="line"><span class="lineno">  532</span>            w[i] = <a class="code hl_function" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9">exp</a>(stdDev[i] * w[i]) * expVar[i];</div>
<div class="line"><span class="lineno">  533</span>        }</div>
<div class="line"><span class="lineno">  534</span> </div>
<div class="line"><span class="lineno">  535</span>        <span class="comment">// Calculate float leg value on this iteration</span></div>
<div class="line"><span class="lineno">  536</span>        Real sampleFloatLegValue = DotProduct(factor, w);</div>
<div class="line"><span class="lineno">  537</span> </div>
<div class="line"><span class="lineno">  538</span>        <span class="comment">// Calculate the swap leg value on this iteration</span></div>
<div class="line"><span class="lineno">  539</span>        Real sampleSwapValue = omega * (sampleFloatLegValue - valueFixedLeg);</div>
<div class="line"><span class="lineno">  540</span> </div>
<div class="line"><span class="lineno">  541</span>        <span class="comment">// Update values dividing by samples each time to guard against blow up.</span></div>
<div class="line"><span class="lineno">  542</span>        optionValue += <a class="code hl_function" href="namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(sampleSwapValue, 0.0) / <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a6ca6ca73af9920c0423b5e6c682ffb78">samples_</a>;</div>
<div class="line"><span class="lineno">  543</span>        swapValue += sampleSwapValue / <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a6ca6ca73af9920c0423b5e6c682ffb78">samples_</a>;</div>
<div class="line"><span class="lineno">  544</span>        floatLegValue += sampleFloatLegValue / <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a6ca6ca73af9920c0423b5e6c682ffb78">samples_</a>;</div>
<div class="line"><span class="lineno">  545</span>    }</div>
<div class="line"><span class="lineno">  546</span> </div>
<div class="line"><span class="lineno">  547</span>    <span class="comment">// Populate the results remembering to multiply by P(0, t_e)</span></div>
<div class="line"><span class="lineno">  548</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.value = discountExercise * optionValue;</div>
<div class="line"><span class="lineno">  549</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;SwapNPV&quot;</span>] = discountExercise * swapValue;</div>
<div class="line"><span class="lineno">  550</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FixedLegNPV&quot;</span>] = discountExercise * valueFixedLeg;</div>
<div class="line"><span class="lineno">  551</span>    <a class="code hl_variable" href="cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FloatingLegNPV&quot;</span>] = discountExercise * floatLegValue;</div>
<div class="line"><span class="lineno">  552</span>}</div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_html_aa1f32e8b21b4f9e2a46339a059b50612"><div class="ttname"><a href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#aa1f32e8b21b4f9e2a46339a059b50612">QuantExt::CommoditySwaptionMonteCarloEngine::futureFloatLegFactors</a></div><div class="ttdeci">void futureFloatLegFactors(QuantLib::Size idxFloat, QuantLib::Real discountExercise, const std::vector&lt; QuantLib::Date &gt; &amp;expiries, QuantLib::Matrix &amp;floatLegFactors, QuantLib::Array &amp;discounts, QuantLib::Array &amp;amounts) const</div><div class="ttdef"><b>Definition:</b> <a href="commodityswaptionengine_8cpp_source.html#l00581">commodityswaptionengine.cpp:581</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_html_acc261e525034ef40d86028e768cec629"><div class="ttname"><a href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#acc261e525034ef40d86028e768cec629">QuantExt::CommoditySwaptionMonteCarloEngine::futureExpiries</a></div><div class="ttdeci">std::map&lt; QuantLib::Date, QuantLib::Real &gt; futureExpiries(QuantLib::Size idxFloat, QuantLib::Matrix &amp;outSqrtCorr, QuantLib::Real strike) const</div><div class="ttdef"><b>Definition:</b> <a href="commodityswaptionengine_8cpp_source.html#l00633">commodityswaptionengine.cpp:633</a></div></div>
</div><!-- fragment --><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ac89647ddeb0a4b07e97fb6842a1f5c92_cgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ac89647ddeb0a4b07e97fb6842a1f5c92_cgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ac89647ddeb0a4b07e97fb6842a1f5c92_cgraph" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ac89647ddeb0a4b07e97fb6842a1f5c92_cgraph">
<area shape="rect" title="Calculations when underlying swap references a commodity spot price." alt="" coords="5,180,116,206"/>
<area shape="rect" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9" title=" " alt="" coords="661,110,767,135"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a6703de3908f802246c0d5a3c7a0f9ef5" title="Give back the fixed leg price at the swaption expiry time." alt="" coords="360,250,564,290"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#acc261e525034ef40d86028e768cec629" title=" " alt="" coords="187,130,289,155"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#add35fc148fad63203443a6a80e62b52c" title=" " alt="" coords="360,186,564,226"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#aa1f32e8b21b4f9e2a46339a059b50612" title=" " alt="" coords="164,72,312,98"/>
<area shape="rect" href="namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1" title=" " alt="" coords="183,282,293,307"/>
<area shape="rect" href="namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2" title=" " alt="" coords="185,331,291,356"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#aea36c4e4272e7df5899ad72848c5fe9f" title=" " alt="" coords="612,206,816,246"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#acac0f5c8feb6122c58a2e070365cbe2c" title=" " alt="" coords="360,58,564,98"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a15d4531a1671fa50a37a7a1e4a813131" title=" " alt="" coords="360,122,564,162"/>
</map>
</div>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ac89647ddeb0a4b07e97fb6842a1f5c92_icgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ac89647ddeb0a4b07e97fb6842a1f5c92_icgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ac89647ddeb0a4b07e97fb6842a1f5c92_icgraph" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ac89647ddeb0a4b07e97fb6842a1f5c92_icgraph">
<area shape="rect" title="Calculations when underlying swap references a commodity spot price." alt="" coords="128,5,239,31"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,5,80,31"/>
</map>
</div>

</div>
</div>
<a id="ad7a428699a75a8f5613f980348923683" name="ad7a428699a75a8f5613f980348923683"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7a428699a75a8f5613f980348923683">&#9670;&#160;</a></span>spotFloatLegFactor()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Real spotFloatLegFactor </td>
          <td>(</td>
          <td class="paramtype">QuantLib::Size&#160;</td>
          <td class="paramname"><em>idxFloat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Real&#160;</td>
          <td class="paramname"><em>discountExercise</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Calculate the underlying spot float leg factor value at expiry time. This quantity will be multiplied by a sample value on each Monte Carlo iteration to give the swap float leg value. </p>

<p class="definition">Definition at line <a class="el" href="commodityswaptionengine_8cpp_source.html#l00554">554</a> of file <a class="el" href="commodityswaptionengine_8cpp_source.html">commodityswaptionengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  554</span>                                                                                                     {</div>
<div class="line"><span class="lineno">  555</span> </div>
<div class="line"><span class="lineno">  556</span>    <span class="comment">// Different float leg valuation depending on whether leg is averaging or not.</span></div>
<div class="line"><span class="lineno">  557</span>    Real floatLegValue = 0.0;</div>
<div class="line"><span class="lineno">  558</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#acac0f5c8feb6122c58a2e070365cbe2c">averaging</a>(idxFloat)) {</div>
<div class="line"><span class="lineno">  559</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cf : <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.legs[idxFloat]) {</div>
<div class="line"><span class="lineno">  560</span>            <span class="keyword">auto</span> ccf = boost::dynamic_pointer_cast&lt;CommodityIndexedAverageCashFlow&gt;(cf);</div>
<div class="line"><span class="lineno">  561</span>            QL_REQUIRE(ccf, <span class="stringliteral">&quot;spotSwapValue: expected a CommodityIndexedAverageCashFlow&quot;</span>);</div>
<div class="line"><span class="lineno">  562</span>            Real disc = <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a188f6df4c42679c1c133919254e351c5">discountCurve_</a>-&gt;discount(ccf-&gt;date());</div>
<div class="line"><span class="lineno">  563</span>            floatLegValue += disc * ccf-&gt;amount();</div>
<div class="line"><span class="lineno">  564</span>        }</div>
<div class="line"><span class="lineno">  565</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  566</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cf : <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.legs[idxFloat]) {</div>
<div class="line"><span class="lineno">  567</span>            <span class="keyword">auto</span> ccf = boost::dynamic_pointer_cast&lt;CommodityIndexedCashFlow&gt;(cf);</div>
<div class="line"><span class="lineno">  568</span>            QL_REQUIRE(ccf, <span class="stringliteral">&quot;spotSwapValue: expected a CommodityIndexedCashFlow&quot;</span>);</div>
<div class="line"><span class="lineno">  569</span>            Real disc = <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a188f6df4c42679c1c133919254e351c5">discountCurve_</a>-&gt;discount(ccf-&gt;date());</div>
<div class="line"><span class="lineno">  570</span>            floatLegValue += disc * ccf-&gt;amount();</div>
<div class="line"><span class="lineno">  571</span>        }</div>
<div class="line"><span class="lineno">  572</span>    }</div>
<div class="line"><span class="lineno">  573</span> </div>
<div class="line"><span class="lineno">  574</span>    <span class="comment">// Divide floating leg value by discount to swaption expiry</span></div>
<div class="line"><span class="lineno">  575</span>    floatLegValue /= discountExercise;</div>
<div class="line"><span class="lineno">  576</span> </div>
<div class="line"><span class="lineno">  577</span>    <span class="comment">// Return the swap value at the expiry date t_e</span></div>
<div class="line"><span class="lineno">  578</span>    <span class="keywordflow">return</span> floatLegValue;</div>
<div class="line"><span class="lineno">  579</span>}</div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_swaption_base_engine_html_acac0f5c8feb6122c58a2e070365cbe2c"><div class="ttname"><a href="class_quant_ext_1_1_commodity_swaption_base_engine.html#acac0f5c8feb6122c58a2e070365cbe2c">QuantExt::CommoditySwaptionBaseEngine::averaging</a></div><div class="ttdeci">bool averaging(QuantLib::Size floatLegIndex) const</div><div class="ttdef"><b>Definition:</b> <a href="commodityswaptionengine_8cpp_source.html#l00160">commodityswaptionengine.cpp:160</a></div></div>
</div><!-- fragment --><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ad7a428699a75a8f5613f980348923683_cgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ad7a428699a75a8f5613f980348923683_cgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ad7a428699a75a8f5613f980348923683_cgraph" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ad7a428699a75a8f5613f980348923683_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,140,38"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#acac0f5c8feb6122c58a2e070365cbe2c" title=" " alt="" coords="188,5,392,45"/>
</map>
</div>
<div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ad7a428699a75a8f5613f980348923683_icgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ad7a428699a75a8f5613f980348923683_icgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ad7a428699a75a8f5613f980348923683_icgraph" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_ad7a428699a75a8f5613f980348923683_icgraph">
<area shape="rect" title=" " alt="" coords="277,5,412,31"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a429dc3ef9bdf678e9e7bcc9ae905abc7" title="Calculations when underlying swap references a commodity spot price." alt="" coords="128,5,229,31"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,5,80,31"/>
</map>
</div>

</div>
</div>
<a id="aa1f32e8b21b4f9e2a46339a059b50612" name="aa1f32e8b21b4f9e2a46339a059b50612"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1f32e8b21b4f9e2a46339a059b50612">&#9670;&#160;</a></span>futureFloatLegFactors()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void futureFloatLegFactors </td>
          <td>(</td>
          <td class="paramtype">QuantLib::Size&#160;</td>
          <td class="paramname"><em>idxFloat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Real&#160;</td>
          <td class="paramname"><em>discountExercise</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; QuantLib::Date &gt; &amp;&#160;</td>
          <td class="paramname"><em>expiries</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Matrix &amp;&#160;</td>
          <td class="paramname"><em>floatLegFactors</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Array &amp;&#160;</td>
          <td class="paramname"><em>discounts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Array &amp;&#160;</td>
          <td class="paramname"><em>amounts</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Populate the factors that we need to value the floating leg of a swap referencing a future contract given a Monte Carlo sample. This is to avoid recalculation of these quantities on each iteration. </p>

<p class="definition">Definition at line <a class="el" href="commodityswaptionengine_8cpp_source.html#l00581">581</a> of file <a class="el" href="commodityswaptionengine_8cpp_source.html">commodityswaptionengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  583</span>                                                                                                      {</div>
<div class="line"><span class="lineno">  584</span> </div>
<div class="line"><span class="lineno">  585</span>    Size numCfs = <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.legs[idxFloat].size();</div>
<div class="line"><span class="lineno">  586</span> </div>
<div class="line"><span class="lineno">  587</span>    QL_REQUIRE(numCfs == floatLegFactors.rows(),</div>
<div class="line"><span class="lineno">  588</span>               <span class="stringliteral">&quot;Expected number of rows in floatLegFactors to equal number of cashflows&quot;</span>);</div>
<div class="line"><span class="lineno">  589</span>    QL_REQUIRE(numCfs == discounts.size(), <span class="stringliteral">&quot;Expected size of discounts to equal number of cashflows&quot;</span>);</div>
<div class="line"><span class="lineno">  590</span>    QL_REQUIRE(numCfs == amounts.size(), <span class="stringliteral">&quot;Expected size of amounts to equal number of cashflows&quot;</span>);</div>
<div class="line"><span class="lineno">  591</span>    QL_REQUIRE(expiries.size() == floatLegFactors.columns(),</div>
<div class="line"><span class="lineno">  592</span>               <span class="stringliteral">&quot;Expected number of columns in floatLegFactors to equal number of expiries&quot;</span>);</div>
<div class="line"><span class="lineno">  593</span> </div>
<div class="line"><span class="lineno">  594</span>    <span class="comment">// Different float leg valuation depending on whether leg is averaging or not.</span></div>
<div class="line"><span class="lineno">  595</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#acac0f5c8feb6122c58a2e070365cbe2c">averaging</a>(idxFloat)) {</div>
<div class="line"><span class="lineno">  596</span>        <span class="keywordflow">for</span> (Size i = 0; i &lt; numCfs; i++) {</div>
<div class="line"><span class="lineno">  597</span>            <span class="keyword">auto</span> ccf = boost::dynamic_pointer_cast&lt;CommodityIndexedAverageCashFlow&gt;(<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.legs[idxFloat][i]);</div>
<div class="line"><span class="lineno">  598</span>            QL_REQUIRE(ccf, <span class="stringliteral">&quot;futureFloatLegFactors: expected a CommodityIndexedAverageCashFlow&quot;</span>);</div>
<div class="line"><span class="lineno">  599</span>            Size numObs = ccf-&gt;indices().size();</div>
<div class="line"><span class="lineno">  600</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : ccf-&gt;indices()) {</div>
<div class="line"><span class="lineno">  601</span>                Date expiry = p.second-&gt;expiryDate();</div>
<div class="line"><span class="lineno">  602</span>                <span class="keyword">auto</span> it = find(expiries.begin(), expiries.end(), expiry);</div>
<div class="line"><span class="lineno">  603</span>                QL_REQUIRE(it != expiries.end(), <span class="stringliteral">&quot;futureFloatLegFactors: expected to find expiry in expiries vector&quot;</span>);</div>
<div class="line"><span class="lineno">  604</span>                <span class="keyword">auto</span> idx = distance(expiries.begin(), it);</div>
<div class="line"><span class="lineno">  605</span>                Real fxRate{1.};</div>
<div class="line"><span class="lineno">  606</span>                <span class="keywordflow">if</span>(ccf-&gt;fxIndex())</div>
<div class="line"><span class="lineno">  607</span>                    fxRate=ccf-&gt;fxIndex()-&gt;fixing(expiry);</div>
<div class="line"><span class="lineno">  608</span>                floatLegFactors[i][idx] += fxRate*p.second-&gt;fixing(expiry) / numObs;</div>
<div class="line"><span class="lineno">  609</span>            }</div>
<div class="line"><span class="lineno">  610</span>            discounts[i] = <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a188f6df4c42679c1c133919254e351c5">discountCurve_</a>-&gt;discount(ccf-&gt;date());</div>
<div class="line"><span class="lineno">  611</span>            amounts[i] = ccf-&gt;periodQuantity();</div>
<div class="line"><span class="lineno">  612</span>        }</div>
<div class="line"><span class="lineno">  613</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  614</span>        <span class="keywordflow">for</span> (Size i = 0; i &lt; numCfs; i++) {</div>
<div class="line"><span class="lineno">  615</span>            <span class="keyword">auto</span> ccf = boost::dynamic_pointer_cast&lt;CommodityIndexedCashFlow&gt;(<a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.legs[idxFloat][i]);</div>
<div class="line"><span class="lineno">  616</span>            QL_REQUIRE(ccf, <span class="stringliteral">&quot;futureFloatLegFactors: expected a CommodityIndexedCashFlow&quot;</span>);</div>
<div class="line"><span class="lineno">  617</span> </div>
<div class="line"><span class="lineno">  618</span>            <span class="keyword">auto</span> it = find(expiries.begin(), expiries.end(), ccf-&gt;index()-&gt;expiryDate());</div>
<div class="line"><span class="lineno">  619</span>            QL_REQUIRE(it != expiries.end(), <span class="stringliteral">&quot;futureFloatLegFactors: expected to find expiry in expiries vector&quot;</span>);</div>
<div class="line"><span class="lineno">  620</span>            <span class="keyword">auto</span> idx = distance(expiries.begin(), it);</div>
<div class="line"><span class="lineno">  621</span>            floatLegFactors[i][idx] = 1.0;</div>
<div class="line"><span class="lineno">  622</span>            discounts[i] = <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a188f6df4c42679c1c133919254e351c5">discountCurve_</a>-&gt;discount(ccf-&gt;date());</div>
<div class="line"><span class="lineno">  623</span>            amounts[i] = ccf-&gt;amount();</div>
<div class="line"><span class="lineno">  624</span>        }</div>
<div class="line"><span class="lineno">  625</span>    }</div>
<div class="line"><span class="lineno">  626</span> </div>
<div class="line"><span class="lineno">  627</span>    <span class="comment">// Divide discounts by discount to swaption expiry</span></div>
<div class="line"><span class="lineno">  628</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; discounts.size(); i++) {</div>
<div class="line"><span class="lineno">  629</span>        discounts[i] /= discountExercise;</div>
<div class="line"><span class="lineno">  630</span>    }</div>
<div class="line"><span class="lineno">  631</span>}</div>
</div><!-- fragment --><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine_aa1f32e8b21b4f9e2a46339a059b50612_cgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_aa1f32e8b21b4f9e2a46339a059b50612_cgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_aa1f32e8b21b4f9e2a46339a059b50612_cgraph" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_aa1f32e8b21b4f9e2a46339a059b50612_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,153,38"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#acac0f5c8feb6122c58a2e070365cbe2c" title=" " alt="" coords="201,5,405,45"/>
</map>
</div>
<div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine_aa1f32e8b21b4f9e2a46339a059b50612_icgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_aa1f32e8b21b4f9e2a46339a059b50612_icgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_aa1f32e8b21b4f9e2a46339a059b50612_icgraph" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_aa1f32e8b21b4f9e2a46339a059b50612_icgraph">
<area shape="rect" title=" " alt="" coords="287,5,435,31"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#ac89647ddeb0a4b07e97fb6842a1f5c92" title="Calculations when underlying swap references a commodity spot price." alt="" coords="128,5,239,31"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,5,80,31"/>
</map>
</div>

</div>
</div>
<a id="acc261e525034ef40d86028e768cec629" name="acc261e525034ef40d86028e768cec629"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc261e525034ef40d86028e768cec629">&#9670;&#160;</a></span>futureExpiries()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">map&lt; Date, Real &gt; futureExpiries </td>
          <td>(</td>
          <td class="paramtype">QuantLib::Size&#160;</td>
          <td class="paramname"><em>idxFloat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Matrix &amp;&#160;</td>
          <td class="paramname"><em>outSqrtCorr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Real&#160;</td>
          <td class="paramname"><em>strike</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Given the index of the floating leg <code>idxFloat</code>, populate a map where the keys are the unique expiry dates of the future contracts referenced in the floating leg and the values are the volatilities associated with the future contract. Also, the matrix <code>outSqrtCorr</code> is poulated with the square root of the correlation matrix between the expiries.</p>
<p >An exception is thrown if the floating leg is not referencing a commodity future price. </p>

<p class="definition">Definition at line <a class="el" href="commodityswaptionengine_8cpp_source.html#l00633">633</a> of file <a class="el" href="commodityswaptionengine_8cpp_source.html">commodityswaptionengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  634</span>                                                                                     {</div>
<div class="line"><span class="lineno">  635</span> </div>
<div class="line"><span class="lineno">  636</span>    <span class="comment">// Will hold the result</span></div>
<div class="line"><span class="lineno">  637</span>    map&lt;Date, Real&gt; result;</div>
<div class="line"><span class="lineno">  638</span> </div>
<div class="line"><span class="lineno">  639</span>    <span class="comment">// Populate the unique future expiry dates referenced on the floating leg</span></div>
<div class="line"><span class="lineno">  640</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#acac0f5c8feb6122c58a2e070365cbe2c">averaging</a>(idxFloat)) {</div>
<div class="line"><span class="lineno">  641</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cf : <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.legs[idxFloat]) {</div>
<div class="line"><span class="lineno">  642</span>            <span class="keyword">auto</span> ccf = boost::dynamic_pointer_cast&lt;CommodityIndexedAverageCashFlow&gt;(cf);</div>
<div class="line"><span class="lineno">  643</span>            QL_REQUIRE(ccf, <span class="stringliteral">&quot;futureExpiries: expected a CommodityIndexedAverageCashFlow&quot;</span>);</div>
<div class="line"><span class="lineno">  644</span>            QL_REQUIRE(ccf-&gt;useFuturePrice(), <span class="stringliteral">&quot;futureExpiries: expected the cashflow to reference a future price&quot;</span>);</div>
<div class="line"><span class="lineno">  645</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : ccf-&gt;indices()) {</div>
<div class="line"><span class="lineno">  646</span>                result[p.second-&gt;expiryDate()] = 0.0;</div>
<div class="line"><span class="lineno">  647</span>            }</div>
<div class="line"><span class="lineno">  648</span>        }</div>
<div class="line"><span class="lineno">  649</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  650</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cf : <a class="code hl_variable" href="tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.legs[idxFloat]) {</div>
<div class="line"><span class="lineno">  651</span>            <span class="keyword">auto</span> ccf = boost::dynamic_pointer_cast&lt;CommodityIndexedCashFlow&gt;(cf);</div>
<div class="line"><span class="lineno">  652</span>            QL_REQUIRE(ccf, <span class="stringliteral">&quot;futureExpiries: expected a CommodityIndexedCashFlow&quot;</span>);</div>
<div class="line"><span class="lineno">  653</span>            QL_REQUIRE(ccf-&gt;useFuturePrice(), <span class="stringliteral">&quot;futureExpiries: expected the cashflow to reference a future price&quot;</span>);</div>
<div class="line"><span class="lineno">  654</span>            result[ccf-&gt;index()-&gt;expiryDate()] = 0.0;</div>
<div class="line"><span class="lineno">  655</span>        }</div>
<div class="line"><span class="lineno">  656</span>    }</div>
<div class="line"><span class="lineno">  657</span> </div>
<div class="line"><span class="lineno">  658</span>    <span class="comment">// Populate the map values i.e. the instantaneous volatility associated with the future contract whose expiry date</span></div>
<div class="line"><span class="lineno">  659</span>    <span class="comment">// is the map key. Here, we make the simplifying assumption that the volatility can be read from the volatility</span></div>
<div class="line"><span class="lineno">  660</span>    <span class="comment">// term structure at the future contract&#39;s expiry date. In most cases, if the volatility term structure is built</span></div>
<div class="line"><span class="lineno">  661</span>    <span class="comment">// from options on futures, the option contract expiry will be a number of days before the future contract expiry</span></div>
<div class="line"><span class="lineno">  662</span>    <span class="comment">// and we should really read off the term structure at that date. Also populate a temp vector containing the key</span></div>
<div class="line"><span class="lineno">  663</span>    <span class="comment">// dates for use in the loop below where we populate the sqrt correlation matrix.</span></div>
<div class="line"><span class="lineno">  664</span>    vector&lt;Date&gt; expiryDates;</div>
<div class="line"><span class="lineno">  665</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; p : result) {</div>
<div class="line"><span class="lineno">  666</span>        p.second = <a class="code hl_variable" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a123a04063be0178e9eb8a912b357528d">volStructure_</a>-&gt;blackVol(p.first, <a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#add35fc148fad63203443a6a80e62b52c">strike</a>);</div>
<div class="line"><span class="lineno">  667</span>        expiryDates.push_back(p.first);</div>
<div class="line"><span class="lineno">  668</span>    }</div>
<div class="line"><span class="lineno">  669</span> </div>
<div class="line"><span class="lineno">  670</span>    <span class="comment">// Populate the outSqrtCorr matrix</span></div>
<div class="line"><span class="lineno">  671</span>    outSqrtCorr = Matrix(expiryDates.size(), expiryDates.size(), 1.0);</div>
<div class="line"><span class="lineno">  672</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; expiryDates.size(); i++) {</div>
<div class="line"><span class="lineno">  673</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt; i; j++) {</div>
<div class="line"><span class="lineno">  674</span>            outSqrtCorr[i][j] = outSqrtCorr[j][i] = <a class="code hl_function" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a15d4531a1671fa50a37a7a1e4a813131">rho</a>(expiryDates[i], expiryDates[j]);</div>
<div class="line"><span class="lineno">  675</span>        }</div>
<div class="line"><span class="lineno">  676</span>    }</div>
<div class="line"><span class="lineno">  677</span>    outSqrtCorr = pseudoSqrt(outSqrtCorr, SalvagingAlgorithm::None);</div>
<div class="line"><span class="lineno">  678</span> </div>
<div class="line"><span class="lineno">  679</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">  680</span>}</div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_swaption_base_engine_html_a15d4531a1671fa50a37a7a1e4a813131"><div class="ttname"><a href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a15d4531a1671fa50a37a7a1e4a813131">QuantExt::CommoditySwaptionBaseEngine::rho</a></div><div class="ttdeci">QuantLib::Real rho(const QuantLib::Date &amp;ed_1, const QuantLib::Date &amp;ed_2) const</div><div class="ttdef"><b>Definition:</b> <a href="commodityswaptionengine_8cpp_source.html#l00149">commodityswaptionengine.cpp:149</a></div></div>
</div><!-- fragment --><div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine_acc261e525034ef40d86028e768cec629_cgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_acc261e525034ef40d86028e768cec629_cgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_acc261e525034ef40d86028e768cec629_cgraph" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_acc261e525034ef40d86028e768cec629_cgraph">
<area shape="rect" title=" " alt="" coords="5,77,107,102"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#acac0f5c8feb6122c58a2e070365cbe2c" title=" " alt="" coords="155,5,359,45"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#a15d4531a1671fa50a37a7a1e4a813131" title=" " alt="" coords="155,69,359,109"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#add35fc148fad63203443a6a80e62b52c" title=" " alt="" coords="155,137,359,177"/>
<area shape="rect" href="namespace_quant_ext.html#a11171c842d01ffacc4ec522e398070a9" title=" " alt="" coords="455,71,562,97"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_base_engine.html#aea36c4e4272e7df5899ad72848c5fe9f" title=" " alt="" coords="407,145,611,185"/>
</map>
</div>
<div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine_acc261e525034ef40d86028e768cec629_icgraph.png" border="0" usemap="#aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_acc261e525034ef40d86028e768cec629_icgraph" alt=""/></div>
<map name="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_acc261e525034ef40d86028e768cec629_icgraph" id="aclass_quant_ext_1_1_commodity_swaption_monte_carlo_engine_acc261e525034ef40d86028e768cec629_icgraph">
<area shape="rect" title=" " alt="" coords="287,5,388,31"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#ac89647ddeb0a4b07e97fb6842a1f5c92" title="Calculations when underlying swap references a commodity spot price." alt="" coords="128,5,239,31"/>
<area shape="rect" href="class_quant_ext_1_1_commodity_swaption_monte_carlo_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,5,80,31"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a6ca6ca73af9920c0423b5e6c682ffb78" name="a6ca6ca73af9920c0423b5e6c682ffb78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ca6ca73af9920c0423b5e6c682ffb78">&#9670;&#160;</a></span>samples_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Size samples_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityswaptionengine_8hpp_source.html#l00153">153</a> of file <a class="el" href="commodityswaptionengine_8hpp_source.html">commodityswaptionengine.hpp</a>.</p>

</div>
</div>
<a id="a9ad21b943e0b26e7e635844cb88707ae" name="a9ad21b943e0b26e7e635844cb88707ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ad21b943e0b26e7e635844cb88707ae">&#9670;&#160;</a></span>seed_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">long seed_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityswaptionengine_8hpp_source.html#l00154">154</a> of file <a class="el" href="commodityswaptionengine_8hpp_source.html">commodityswaptionengine.hpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.9.5
</small></address>
</body>
</html>
