<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<title>OREAnalytics: SimmCalculator Class Reference</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="oreaextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-analytics@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.8.12</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceore.html">ore</a></li><li class="navelem"><a class="el" href="namespaceore_1_1analytics.html">analytics</a></li><li class="navelem"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html">SimmCalculator</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classore_1_1analytics_1_1_simm_calculator-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">SimmCalculator Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>A class to calculate SIMM given a set of aggregated CRIF results for one or more portfolios.  
 <a href="classore_1_1analytics_1_1_simm_calculator.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="simmcalculator_8hpp_source.html">orea/simm/simmcalculator.hpp</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for SimmCalculator:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator__coll__graph.png" border="0" usemap="#a_simm_calculator_coll__map" alt="Collaboration graph"/></div>
<map name="a_simm_calculator_coll__map" id="a_simm_calculator_coll__map">
<area shape="rect" title="A class to calculate SIMM given a set of aggregated CRIF results for one or more portfolios." alt="" coords="2211,2308,2401,2803"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html" title=" " alt="" coords="3183,1795,3394,2231"/>
<area shape="rect" title=" " alt="" coords="3919,1648,3992,1688"/>
<area shape="rect" title=" " alt="" coords="3073,1641,3208,1695"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html" title=" " alt="" coords="3249,1017,3451,1571"/>
<area shape="rect" title=" " alt="" coords="3237,1633,3447,1703"/>
<area shape="rect" title=" " alt="" coords="3714,108,3773,148"/>
<area shape="rect" title=" " alt="" coords="3479,709,3626,779"/>
<area shape="rect" title=" " alt="" coords="3407,262,3533,302"/>
<area shape="rect" title=" " alt="" coords="3283,262,3383,302"/>
<area shape="rect" title=" " alt="" coords="3670,5,3817,45"/>
<area shape="rect" title=" " alt="" coords="3181,724,3285,764"/>
<area shape="rect" title=" " alt="" coords="3650,724,3730,764"/>
<area shape="rect" title=" " alt="" coords="3755,724,3807,764"/>
<area shape="rect" target="_parent" href="../ored/classore_1_1data_1_1_netting_set_details.html" title=" " alt="" coords="2721,563,2883,925"/>
<area shape="rect" title=" " alt="" coords="2650,1267,2826,1321"/>
<area shape="rect" title=" " alt="" coords="2231,1267,2413,1321"/>
<area shape="rect" target="_parent" href="../ored/classore_1_1data_1_1_x_m_l_serializable.html" title=" " alt="" coords="2377,211,2525,353"/>
<area shape="rect" title=" " alt="" coords="2550,262,2609,302"/>
<area shape="rect" title=" " alt="" coords="3557,255,3695,309"/>
<area shape="rect" title=" " alt="" coords="2159,262,2258,302"/>
<area shape="rect" title=" " alt="" coords="517,702,711,786"/>
<area shape="rect" title=" " alt="" coords="2073,1633,2253,1703"/>
<area shape="rect" title=" " alt="" coords="306,709,493,779"/>
<area shape="rect" title=" " alt="" coords="735,702,962,786"/>
<area shape="rect" title=" " alt="" coords="1185,702,1448,786"/>
<area shape="rect" title=" " alt="" coords="1766,702,1961,786"/>
<area shape="rect" title=" " alt="" coords="2497,717,2646,771"/>
<area shape="rect" title=" " alt="" coords="2531,5,2569,45"/>
<area shape="rect" title=" " alt="" coords="3091,108,3169,148"/>
<area shape="rect" title=" " alt="" coords="2849,108,2888,148"/>
<area shape="rect" title=" " alt="" coords="3167,262,3258,302"/>
<area shape="rect" title=" " alt="" coords="3309,717,3455,771"/>
<area shape="rect" title=" " alt="" coords="3475,1274,3625,1314"/>
<area shape="rect" title=" " alt="" coords="659,262,745,302"/>
<area shape="rect" title=" " alt="" coords="212,240,395,324"/>
<area shape="rect" title=" " alt="" coords="4068,1985,4245,2040"/>
<area shape="rect" title=" " alt="" coords="4269,1985,4420,2040"/>
<area shape="rect" href="classbool.html" title=" " alt="" coords="2422,724,2473,764"/>
<area shape="rect" title=" " alt="" coords="5,255,188,309"/>
<area shape="rect" title=" " alt="" coords="452,240,635,324"/>
<area shape="rect" title=" " alt="" coords="1355,240,1537,324"/>
<area shape="rect" title=" " alt="" coords="1736,247,1919,317"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:afbff2a0e62c01d190bc46ff1461f7ddc"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmConfiguration::SimmSide</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#afbff2a0e62c01d190bc46ff1461f7ddc">SimmSide</a></td></tr>
<tr class="separator:afbff2a0e62c01d190bc46ff1461f7ddc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a7239a98428b9d2b50f6372ed1b3cb9e6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a7239a98428b9d2b50f6372ed1b3cb9e6">SimmCalculator</a> (const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;crif, const QuantLib::ext::shared_ptr&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html">SimmConfiguration</a> &gt; &amp;simmConfiguration, const std::string &amp;calculationCcyCall=&quot;USD&quot;, const std::string &amp;calculationCcyPost=&quot;USD&quot;, const std::string &amp;resultCcy=&quot;&quot;, const QuantLib::ext::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_market.html">ore::data::Market</a> &gt; market=nullptr, const <a class="el" href="classbool.html">bool</a> determineWinningRegulations=true, const <a class="el" href="classbool.html">bool</a> enforceIMRegulations=false, const <a class="el" href="classbool.html">bool</a> quiet=false, const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::set&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a> &gt; &gt; &amp;hasSEC=std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::set&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a> &gt; &gt;(), const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::set&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a> &gt; &gt; &amp;hasCFTC=std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::set&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a> &gt; &gt;())</td></tr>
<tr class="separator:a7239a98428b9d2b50f6372ed1b3cb9e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa017918b1c2efd004b2d39b3aa72cdd"><td class="memItemLeft" align="right" valign="top">const void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#afa017918b1c2efd004b2d39b3aa72cdd">calculateRegulationSimm</a> (const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;crif, const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;nsd, const string &amp;regulation, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side)</td></tr>
<tr class="memdesc:afa017918b1c2efd004b2d39b3aa72cdd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates SIMM for a given regulation under a given netting set.  <a href="classore_1_1analytics_1_1_simm_calculator.html#afa017918b1c2efd004b2d39b3aa72cdd">More...</a><br /></td></tr>
<tr class="separator:afa017918b1c2efd004b2d39b3aa72cdd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3644fe506caa0f144d28ff3f65ca1cb"><td class="memItemLeft" align="right" valign="top">const std::string &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#ad3644fe506caa0f144d28ff3f65ca1cb">winningRegulations</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;nettingSetDetails) const</td></tr>
<tr class="memdesc:ad3644fe506caa0f144d28ff3f65ca1cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the winning regulation for each netting set.  <a href="classore_1_1analytics_1_1_simm_calculator.html#ad3644fe506caa0f144d28ff3f65ca1cb">More...</a><br /></td></tr>
<tr class="separator:ad3644fe506caa0f144d28ff3f65ca1cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c411b3c186350a6cf759b4b6306baf6"><td class="memItemLeft" align="right" valign="top">const std::map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, string &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a7c411b3c186350a6cf759b4b6306baf6">winningRegulations</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side) const</td></tr>
<tr class="separator:a7c411b3c186350a6cf759b4b6306baf6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a766fc790a5e25235a2083f09f21011df"><td class="memItemLeft" align="right" valign="top">const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, string &gt; &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df">winningRegulations</a> () const</td></tr>
<tr class="separator:a766fc790a5e25235a2083f09f21011df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c484da72c93ba30b8fc72c6fd9d1592"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a0c484da72c93ba30b8fc72c6fd9d1592">simmResults</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;nettingSetDetails, const std::string &amp;regulation) const</td></tr>
<tr class="memdesc:a0c484da72c93ba30b8fc72c6fd9d1592"><td class="mdescLeft">&#160;</td><td class="mdescRight">Give back the SIMM results container for the given portfolioId and SIMM side.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a0c484da72c93ba30b8fc72c6fd9d1592">More...</a><br /></td></tr>
<tr class="separator:a0c484da72c93ba30b8fc72c6fd9d1592"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad065784b3b3ce4b3a6eb8c73b8a6ba76"><td class="memItemLeft" align="right" valign="top">const std::map&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#ad065784b3b3ce4b3a6eb8c73b8a6ba76">simmResults</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;nettingSetDetails) const</td></tr>
<tr class="separator:ad065784b3b3ce4b3a6eb8c73b8a6ba76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a043645c8f888e4793f5551c56cfda568"><td class="memItemLeft" align="right" valign="top">const std::map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::map&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a043645c8f888e4793f5551c56cfda568">simmResults</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side) const</td></tr>
<tr class="separator:a043645c8f888e4793f5551c56cfda568"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a009eb0a808f969304a75263fa81bb9bd"><td class="memItemLeft" align="right" valign="top">const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::map&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a009eb0a808f969304a75263fa81bb9bd">simmResults</a> () const</td></tr>
<tr class="separator:a009eb0a808f969304a75263fa81bb9bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7d138db5520d1b264060701b4dafed0"><td class="memItemLeft" align="right" valign="top">const std::pair&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#ab7d138db5520d1b264060701b4dafed0">finalSimmResults</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;nettingSetDetails) const</td></tr>
<tr class="memdesc:ab7d138db5520d1b264060701b4dafed0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Give back the SIMM results container for the given netting set and SIMM side.  <a href="classore_1_1analytics_1_1_simm_calculator.html#ab7d138db5520d1b264060701b4dafed0">More...</a><br /></td></tr>
<tr class="separator:ab7d138db5520d1b264060701b4dafed0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e3384043ef38de3c8a063d6bcb134f2"><td class="memItemLeft" align="right" valign="top">const std::map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::pair&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a1e3384043ef38de3c8a063d6bcb134f2">finalSimmResults</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side) const</td></tr>
<tr class="separator:a1e3384043ef38de3c8a063d6bcb134f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a892df1a5c65ab07fefdc01d5c057ad66"><td class="memItemLeft" align="right" valign="top">const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::pair&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a892df1a5c65ab07fefdc01d5c057ad66">finalSimmResults</a> () const</td></tr>
<tr class="separator:a892df1a5c65ab07fefdc01d5c057ad66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade8361772c3783f383ab208f3a9cd73f"><td class="memItemLeft" align="right" valign="top">const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::set&lt; std::string &gt; &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#ade8361772c3783f383ab208f3a9cd73f">finalTradeIds</a> () const</td></tr>
<tr class="separator:ade8361772c3783f383ab208f3a9cd73f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09beb8b7b0880f0fa8dad84d5f41f9f0"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classore_1_1analytics_1_1_crif.html">Crif</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a09beb8b7b0880f0fa8dad84d5f41f9f0">simmParameters</a> () const</td></tr>
<tr class="separator:a09beb8b7b0880f0fa8dad84d5f41f9f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aced20a99d69557420e807dd3d0a9b0d8"><td class="memItemLeft" align="right" valign="top">const std::string &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#aced20a99d69557420e807dd3d0a9b0d8">calculationCurrency</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side) const</td></tr>
<tr class="memdesc:aced20a99d69557420e807dd3d0a9b0d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the calculator's calculation currency.  <a href="classore_1_1analytics_1_1_simm_calculator.html#aced20a99d69557420e807dd3d0a9b0d8">More...</a><br /></td></tr>
<tr class="separator:aced20a99d69557420e807dd3d0a9b0d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a957d4a9347f400dc03534f2c4ae9975a"><td class="memItemLeft" align="right" valign="top">const std::string &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a957d4a9347f400dc03534f2c4ae9975a">resultCurrency</a> () const</td></tr>
<tr class="memdesc:a957d4a9347f400dc03534f2c4ae9975a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the calculator's result currency.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a957d4a9347f400dc03534f2c4ae9975a">More...</a><br /></td></tr>
<tr class="separator:a957d4a9347f400dc03534f2c4ae9975a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa936c119f6230d0eed00b790981bef02"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#aa936c119f6230d0eed00b790981bef02">populateFinalResults</a> (const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::string &gt; &gt; &amp;<a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#ad3644fe506caa0f144d28ff3f65ca1cb">winningRegulations</a>)</td></tr>
<tr class="separator:aa936c119f6230d0eed00b790981bef02"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a2f30844efa1be083cc9096e5eb411454"><td class="memItemLeft" align="right" valign="top">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, <a class="el" href="classbool.html">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a2f30844efa1be083cc9096e5eb411454">irDeltaMargin</a> (const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;nettingSetDetails, const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;pc, const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;netRecords, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side) const</td></tr>
<tr class="memdesc:a2f30844efa1be083cc9096e5eb411454"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the Interest Rate delta margin component for the given portfolio and product class.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a2f30844efa1be083cc9096e5eb411454">More...</a><br /></td></tr>
<tr class="separator:a2f30844efa1be083cc9096e5eb411454"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40608992cde449b98628de2df0eff046"><td class="memItemLeft" align="right" valign="top">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, <a class="el" href="classbool.html">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a40608992cde449b98628de2df0eff046">irVegaMargin</a> (const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;nettingSetDetails, const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;pc, const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;netRecords, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side) const</td></tr>
<tr class="memdesc:a40608992cde449b98628de2df0eff046"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the Interest Rate vega margin component for the given portfolio and product class.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a40608992cde449b98628de2df0eff046">More...</a><br /></td></tr>
<tr class="separator:a40608992cde449b98628de2df0eff046"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fc0d11995a333e0808c3c20f1f93fa4"><td class="memItemLeft" align="right" valign="top">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, <a class="el" href="classbool.html">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a4fc0d11995a333e0808c3c20f1f93fa4">irCurvatureMargin</a> (const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;nettingSetDetails, const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;pc, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;crif) const</td></tr>
<tr class="memdesc:a4fc0d11995a333e0808c3c20f1f93fa4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the Interest Rate curvature margin component for the given portfolio and product class.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a4fc0d11995a333e0808c3c20f1f93fa4">More...</a><br /></td></tr>
<tr class="separator:a4fc0d11995a333e0808c3c20f1f93fa4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12dd56db004e8584b643b1e8199137fa"><td class="memItemLeft" align="right" valign="top">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, <a class="el" href="classbool.html">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> (const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;nettingSetDetails, const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;pc, const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#a1c18a2eca0437452edb56ef0965d3ec2">CrifRecord::RiskType</a> &amp;rt, const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;netRecords, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side) const</td></tr>
<tr class="separator:a12dd56db004e8584b643b1e8199137fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a875f25ec95261673b6f1b6f12603ed5a"><td class="memItemLeft" align="right" valign="top">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, <a class="el" href="classbool.html">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a> (const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;nettingSetDetails, const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;pc, const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#a1c18a2eca0437452edb56ef0965d3ec2">CrifRecord::RiskType</a> &amp;rt, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;netRecords, <a class="el" href="classbool.html">bool</a> rfLabels=true) const</td></tr>
<tr class="separator:a875f25ec95261673b6f1b6f12603ed5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a962180a9c1082605962fd7e021892f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a4a962180a9c1082605962fd7e021892f">calcAddMargin</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;nsd, const string &amp;regulation, const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;netRecords)</td></tr>
<tr class="memdesc:a4a962180a9c1082605962fd7e021892f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the additional initial margin for the portfolio ID and regulation.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a4a962180a9c1082605962fd7e021892f">More...</a><br /></td></tr>
<tr class="separator:a4a962180a9c1082605962fd7e021892f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdab2245e5344cc15b7c0f2da447a59b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#acdab2245e5344cc15b7c0f2da447a59b">populateResults</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;nsd, const string &amp;regulation)</td></tr>
<tr class="separator:acdab2245e5344cc15b7c0f2da447a59b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a042350faccc6edc921037241553b2b47"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a042350faccc6edc921037241553b2b47">populateFinalResults</a> ()</td></tr>
<tr class="separator:a042350faccc6edc921037241553b2b47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab744e5a7cd40f8aa6042cc4c0165f191"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a> (const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;nettingSetDetails, const string &amp;regulation, const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;pc, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#add3dc62b3016ee40b1164ca8ac1f15b4">SimmConfiguration::RiskClass</a> &amp;rc, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a6a26f2b024f96bf0f329f403a135acea">SimmConfiguration::MarginType</a> &amp;mt, const std::string &amp;b, QuantLib::Real <a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>, <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> side, const <a class="el" href="classbool.html">bool</a> overwrite=true)</td></tr>
<tr class="separator:ab744e5a7cd40f8aa6042cc4c0165f191"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a223a2fcd44f12478d3bcf85650e1a71c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a223a2fcd44f12478d3bcf85650e1a71c">add</a> (const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;nettingSetDetails, const string &amp;regulation, const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;pc, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#add3dc62b3016ee40b1164ca8ac1f15b4">SimmConfiguration::RiskClass</a> &amp;rc, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a6a26f2b024f96bf0f329f403a135acea">SimmConfiguration::MarginType</a> &amp;mt, const std::map&lt; std::string, QuantLib::Real &gt; &amp;margins, <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> side, const <a class="el" href="classbool.html">bool</a> overwrite=true)</td></tr>
<tr class="separator:a223a2fcd44f12478d3bcf85650e1a71c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad795c008f1effc94d2dd140b3ba9bfe9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#ad795c008f1effc94d2dd140b3ba9bfe9">splitCrifByRegulationsAndPortfolios</a> (const <a class="el" href="classore_1_1analytics_1_1_crif.html">Crif</a> &amp;crif, const <a class="el" href="classbool.html">bool</a> enforceIMRegulations)</td></tr>
<tr class="memdesc:ad795c008f1effc94d2dd140b3ba9bfe9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add CRIF record to the CRIF records container that correspondsd to the given regulation/s and portfolio ID.  <a href="classore_1_1analytics_1_1_simm_calculator.html#ad795c008f1effc94d2dd140b3ba9bfe9">More...</a><br /></td></tr>
<tr class="separator:ad795c008f1effc94d2dd140b3ba9bfe9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fc9a75842580e08b25fca334bdeb9d5"><td class="memItemLeft" align="right" valign="top">QuantLib::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5">lambda</a> (QuantLib::Real theta) const</td></tr>
<tr class="memdesc:a3fc9a75842580e08b25fca334bdeb9d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Give the \(\lambda\) used in the curvature margin calculation.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5">More...</a><br /></td></tr>
<tr class="separator:a3fc9a75842580e08b25fca334bdeb9d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d2bc2fd582f6814002e27b00b6d4853"><td class="memItemLeft" align="right" valign="top">std::set&lt; std::string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a1d2bc2fd582f6814002e27b00b6d4853">getQualifiers</a> (const <a class="el" href="classore_1_1analytics_1_1_crif.html">Crif</a> &amp;crif, const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;nettingSetDetails, const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;pc, const std::vector&lt; <a class="el" href="structore_1_1analytics_1_1_crif_record.html#a1c18a2eca0437452edb56ef0965d3ec2">CrifRecord::RiskType</a> &gt; &amp;riskTypes) const</td></tr>
<tr class="separator:a1d2bc2fd582f6814002e27b00b6d4853"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:abf2dee0df927335cc4a8907e2c26bbbd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#abf2dee0df927335cc4a8907e2c26bbbd">crif_</a></td></tr>
<tr class="memdesc:abf2dee0df927335cc4a8907e2c26bbbd"><td class="mdescLeft">&#160;</td><td class="mdescRight">All the net sensitivities passed in for the calculation.  <a href="classore_1_1analytics_1_1_simm_calculator.html#abf2dee0df927335cc4a8907e2c26bbbd">More...</a><br /></td></tr>
<tr class="separator:abf2dee0df927335cc4a8907e2c26bbbd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf77b775af6d98a512e4e434839f7781"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::map&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_crif.html">Crif</a> &gt; &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#aaf77b775af6d98a512e4e434839f7781">regSensitivities_</a></td></tr>
<tr class="memdesc:aaf77b775af6d98a512e4e434839f7781"><td class="mdescLeft">&#160;</td><td class="mdescRight">Net sentivities at the regulation level within each netting set.  <a href="classore_1_1analytics_1_1_simm_calculator.html#aaf77b775af6d98a512e4e434839f7781">More...</a><br /></td></tr>
<tr class="separator:aaf77b775af6d98a512e4e434839f7781"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a827b948d9bcabe9d9f34d1e67edfd3ef"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a827b948d9bcabe9d9f34d1e67edfd3ef">simmParameters_</a></td></tr>
<tr class="memdesc:a827b948d9bcabe9d9f34d1e67edfd3ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Record of SIMM parameters that were used in the calculation.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a827b948d9bcabe9d9f34d1e67edfd3ef">More...</a><br /></td></tr>
<tr class="separator:a827b948d9bcabe9d9f34d1e67edfd3ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a39a158ea18a8a37f1db65a59f0048b"><td class="memItemLeft" align="right" valign="top">QuantLib::ext::shared_ptr&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html">SimmConfiguration</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a></td></tr>
<tr class="memdesc:a7a39a158ea18a8a37f1db65a59f0048b"><td class="mdescLeft">&#160;</td><td class="mdescRight">The SIMM configuration governing the calculation.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">More...</a><br /></td></tr>
<tr class="separator:a7a39a158ea18a8a37f1db65a59f0048b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c2fc9fbb2d2df2e4a97152bde680460"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a3c2fc9fbb2d2df2e4a97152bde680460">calculationCcyCall_</a></td></tr>
<tr class="memdesc:a3c2fc9fbb2d2df2e4a97152bde680460"><td class="mdescLeft">&#160;</td><td class="mdescRight">The SIMM exposure calculation currency i.e. the currency for which FX delta risk is ignored.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a3c2fc9fbb2d2df2e4a97152bde680460">More...</a><br /></td></tr>
<tr class="separator:a3c2fc9fbb2d2df2e4a97152bde680460"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc16565c54ac283038b1e2114635cd43"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#abc16565c54ac283038b1e2114635cd43">calculationCcyPost_</a></td></tr>
<tr class="separator:abc16565c54ac283038b1e2114635cd43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed547488155ddce90f75d9ade15d0764"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a></td></tr>
<tr class="memdesc:aed547488155ddce90f75d9ade15d0764"><td class="mdescLeft">&#160;</td><td class="mdescRight">The SIMM result currency i.e. the currency in which the main SIMM results are denominated.  <a href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">More...</a><br /></td></tr>
<tr class="separator:aed547488155ddce90f75d9ade15d0764"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa14f759693736cf0438f0e6ff1a792fe"><td class="memItemLeft" align="right" valign="top">QuantLib::ext::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_market.html">ore::data::Market</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#aa14f759693736cf0438f0e6ff1a792fe">market_</a></td></tr>
<tr class="memdesc:aa14f759693736cf0438f0e6ff1a792fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Market data for FX rates to use for converting amounts to USD.  <a href="classore_1_1analytics_1_1_simm_calculator.html#aa14f759693736cf0438f0e6ff1a792fe">More...</a><br /></td></tr>
<tr class="separator:aa14f759693736cf0438f0e6ff1a792fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2fedb3c02ffb092a6c19a0ee1e81a02"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a></td></tr>
<tr class="memdesc:aa2fedb3c02ffb092a6c19a0ee1e81a02"><td class="mdescLeft">&#160;</td><td class="mdescRight">If true, no logging is written out.  <a href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">More...</a><br /></td></tr>
<tr class="separator:aa2fedb3c02ffb092a6c19a0ee1e81a02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b0763dca4cfeddb14b14c992a4ec115"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::set&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a2b0763dca4cfeddb14b14c992a4ec115">hasSEC_</a></td></tr>
<tr class="separator:a2b0763dca4cfeddb14b14c992a4ec115"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a294f980933859f258720759c50392d25"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::set&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a294f980933859f258720759c50392d25">hasCFTC_</a></td></tr>
<tr class="separator:a294f980933859f258720759c50392d25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ec9383d15f514091d85cc7fd697abbb"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, <a class="el" href="classbool.html">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a5ec9383d15f514091d85cc7fd697abbb">collectRegsIsEmpty_</a></td></tr>
<tr class="memdesc:a5ec9383d15f514091d85cc7fd697abbb"><td class="mdescLeft">&#160;</td><td class="mdescRight">For each netting set, whether all CRIF records' collect regulations are empty.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a5ec9383d15f514091d85cc7fd697abbb">More...</a><br /></td></tr>
<tr class="separator:a5ec9383d15f514091d85cc7fd697abbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67f8ce8eaf3735d038f954742105a97d"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, <a class="el" href="classbool.html">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a67f8ce8eaf3735d038f954742105a97d">postRegsIsEmpty_</a></td></tr>
<tr class="memdesc:a67f8ce8eaf3735d038f954742105a97d"><td class="mdescLeft">&#160;</td><td class="mdescRight">For each netting set, whether all CRIF records' post regulations are empty.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a67f8ce8eaf3735d038f954742105a97d">More...</a><br /></td></tr>
<tr class="separator:a67f8ce8eaf3735d038f954742105a97d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b33acd9c41c58660a2f82e5f43963c4"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::string &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">winningRegulations_</a></td></tr>
<tr class="memdesc:a4b33acd9c41c58660a2f82e5f43963c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Regulation with highest initial margin for each given netting set.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">More...</a><br /></td></tr>
<tr class="separator:a4b33acd9c41c58660a2f82e5f43963c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66ce6144aef4f726c92ef4ddaf4afe64"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::map&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a></td></tr>
<tr class="separator:a66ce6144aef4f726c92ef4ddaf4afe64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa86bb7338b370ccfabfd1b6d218a5fb8"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::pair&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#aa86bb7338b370ccfabfd1b6d218a5fb8">finalSimmResults_</a></td></tr>
<tr class="separator:aa86bb7338b370ccfabfd1b6d218a5fb8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8588960e070f807177fb86c539c02bc"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::map&lt; std::string, set&lt; string &gt; &gt; &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#ad8588960e070f807177fb86c539c02bc">tradeIds_</a></td></tr>
<tr class="memdesc:ad8588960e070f807177fb86c539c02bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Container for keeping track of what trade IDs belong to each regulation.  <a href="classore_1_1analytics_1_1_simm_calculator.html#ad8588960e070f807177fb86c539c02bc">More...</a><br /></td></tr>
<tr class="separator:ad8588960e070f807177fb86c539c02bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf6d3f08c36da850265818577b6c5111"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, set&lt; string &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#acf6d3f08c36da850265818577b6c5111">finalTradeIds_</a></td></tr>
<tr class="separator:acf6d3f08c36da850265818577b6c5111"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >A class to calculate SIMM given a set of aggregated CRIF results for one or more portfolios. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00036">36</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a id="afbff2a0e62c01d190bc46ff1461f7ddc" name="afbff2a0e62c01d190bc46ff1461f7ddc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afbff2a0e62c01d190bc46ff1461f7ddc">&#9670;&#160;</a></span>SimmSide</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmConfiguration::SimmSide</a> <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00038">38</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a7239a98428b9d2b50f6372ed1b3cb9e6" name="a7239a98428b9d2b50f6372ed1b3cb9e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7239a98428b9d2b50f6372ed1b3cb9e6">&#9670;&#160;</a></span>SimmCalculator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html">SimmCalculator</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;&#160;</td>
          <td class="paramname"><em>crif</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const QuantLib::ext::shared_ptr&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html">SimmConfiguration</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>simmConfiguration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>calculationCcyCall</em> = <code>&quot;USD&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>calculationCcyPost</em> = <code>&quot;USD&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>resultCcy</em> = <code>&quot;&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const QuantLib::ext::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_market.html">ore::data::Market</a> &gt;&#160;</td>
          <td class="paramname"><em>market</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>determineWinningRegulations</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>enforceIMRegulations</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>quiet</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::set&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>hasSEC</em> = <code>std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>,&#160;std::set&lt;<a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a>&gt;&gt;()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::set&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>hasCFTC</em> = <code>std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>,&#160;std::set&lt;<a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a>&gt;&gt;()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Construct the <a class="el" href="classore_1_1analytics_1_1_simm_calculator.html" title="A class to calculate SIMM given a set of aggregated CRIF results for one or more portfolios.">SimmCalculator</a> from a container of netted CRIF records and a SIMM configuration. The SIMM number is initially calculated in USD using the AmountUSD column. It can optionally be converted to a calculation currency other than USD by using the <code>calculationCcy</code> parameter. If the <code>calculationCcy</code> is not USD then the <code>usdSpot</code> parameter must be used to give the FX spot rate between USD and the <code>calculationCcy</code>. This spot rate is interpreted as the number of USD per unit of <code>calculationCcy</code>. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00065">65</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   72</span>    : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>(simmConfiguration), <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a3c2fc9fbb2d2df2e4a97152bde680460">calculationCcyCall_</a>(calculationCcyCall),</div>
<div class="line"><span class="lineno">   73</span>      <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abc16565c54ac283038b1e2114635cd43">calculationCcyPost_</a>(calculationCcyPost), <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a>(resultCcy.empty() ? <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a3c2fc9fbb2d2df2e4a97152bde680460">calculationCcyCall_</a> : resultCcy),</div>
<div class="line"><span class="lineno">   74</span>      <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa14f759693736cf0438f0e6ff1a792fe">market_</a>(market), <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>(quiet), <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a2b0763dca4cfeddb14b14c992a4ec115">hasSEC_</a>(hasSEC), <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a294f980933859f258720759c50392d25">hasCFTC_</a>(hasCFTC) {</div>
<div class="line"><span class="lineno">   75</span> </div>
<div class="line"><span class="lineno">   76</span>    QL_REQUIRE(<a class="code hl_functionRef" href="../ored/group__utilities.html#gae6725a0931b419ec545f9abb0b6ede76">checkCurrency</a>(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a3c2fc9fbb2d2df2e4a97152bde680460">calculationCcyCall_</a>), <span class="stringliteral">&quot;SIMM Calculator: The Call side calculation currency (&quot;</span></div>
<div class="line"><span class="lineno">   77</span>                                                   &lt;&lt; <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a3c2fc9fbb2d2df2e4a97152bde680460">calculationCcyCall_</a> &lt;&lt; <span class="stringliteral">&quot;) must be a valid ISO currency code&quot;</span>);</div>
<div class="line"><span class="lineno">   78</span>    QL_REQUIRE(<a class="code hl_functionRef" href="../ored/group__utilities.html#gae6725a0931b419ec545f9abb0b6ede76">checkCurrency</a>(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abc16565c54ac283038b1e2114635cd43">calculationCcyPost_</a>), <span class="stringliteral">&quot;SIMM Calculator: The Post side calculation currency (&quot;</span></div>
<div class="line"><span class="lineno">   79</span>                                                   &lt;&lt; <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abc16565c54ac283038b1e2114635cd43">calculationCcyPost_</a> &lt;&lt; <span class="stringliteral">&quot;) must be a valid ISO currency code&quot;</span>);</div>
<div class="line"><span class="lineno">   80</span>    QL_REQUIRE(<a class="code hl_functionRef" href="../ored/group__utilities.html#gae6725a0931b419ec545f9abb0b6ede76">checkCurrency</a>(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a>),</div>
<div class="line"><span class="lineno">   81</span>               <span class="stringliteral">&quot;SIMM Calculator: The result currency (&quot;</span> &lt;&lt; <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a> &lt;&lt; <span class="stringliteral">&quot;) must be a valid ISO currency code&quot;</span>);</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> CrifRecord&amp; cr : crif) {</div>
<div class="line"><span class="lineno">   84</span>        <span class="comment">// Remove empty</span></div>
<div class="line"><span class="lineno">   85</span>        <span class="keywordflow">if</span> (cr.riskType == CrifRecord::RiskType::Empty) {</div>
<div class="line"><span class="lineno">   86</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">   87</span>        }</div>
<div class="line"><span class="lineno">   88</span>        <span class="comment">// Remove Schedule-only CRIF records</span></div>
<div class="line"><span class="lineno">   89</span>        <span class="keyword">const</span> <span class="keywordtype">bool</span> isSchedule = cr.imModel == <span class="stringliteral">&quot;Schedule&quot;</span>;</div>
<div class="line"><span class="lineno">   90</span>        <span class="keywordflow">if</span> (isSchedule) {</div>
<div class="line"><span class="lineno">   91</span>            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a> &amp;&amp; determineWinningRegulations) {</div>
<div class="line"><span class="lineno">   92</span>                <a class="code hl_classRef" href="../ored/classore_1_1data_1_1_structured_trade_warning_message.html">ore::data::StructuredTradeWarningMessage</a>(cr.tradeId, cr.tradeType, <span class="stringliteral">&quot;SIMM calculator&quot;</span>, <span class="stringliteral">&quot;Skipping over Schedule CRIF record&quot;</span>).<a class="code hl_functionRef" href="../ored/classore_1_1data_1_1_j_s_o_n_message.html#a5e21eca2668ed948bdc409b19a78e5bb">log</a>();</div>
<div class="line"><span class="lineno">   93</span>            } </div>
<div class="line"><span class="lineno">   94</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">   95</span>        }</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span> </div>
<div class="line"><span class="lineno">   98</span> </div>
<div class="line"><span class="lineno">   99</span>        <span class="comment">// Check for each netting set whether post/collect regs are populated at all</span></div>
<div class="line"><span class="lineno">  100</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a5ec9383d15f514091d85cc7fd697abbb">collectRegsIsEmpty_</a>.find(cr.nettingSetDetails) == <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a5ec9383d15f514091d85cc7fd697abbb">collectRegsIsEmpty_</a>.end()) {</div>
<div class="line"><span class="lineno">  101</span>            <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a5ec9383d15f514091d85cc7fd697abbb">collectRegsIsEmpty_</a>[cr.nettingSetDetails] = cr.collectRegulations.empty();</div>
<div class="line"><span class="lineno">  102</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a5ec9383d15f514091d85cc7fd697abbb">collectRegsIsEmpty_</a>.at(cr.nettingSetDetails) &amp;&amp; !cr.collectRegulations.empty()) {</div>
<div class="line"><span class="lineno">  103</span>            <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a5ec9383d15f514091d85cc7fd697abbb">collectRegsIsEmpty_</a>.at(cr.nettingSetDetails) = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  104</span>        }</div>
<div class="line"><span class="lineno">  105</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a67f8ce8eaf3735d038f954742105a97d">postRegsIsEmpty_</a>.find(cr.nettingSetDetails) == <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a67f8ce8eaf3735d038f954742105a97d">postRegsIsEmpty_</a>.end()) {</div>
<div class="line"><span class="lineno">  106</span>            <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a67f8ce8eaf3735d038f954742105a97d">postRegsIsEmpty_</a>[cr.nettingSetDetails] = cr.postRegulations.empty();</div>
<div class="line"><span class="lineno">  107</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a67f8ce8eaf3735d038f954742105a97d">postRegsIsEmpty_</a>.at(cr.nettingSetDetails) &amp;&amp; !cr.postRegulations.empty()) {</div>
<div class="line"><span class="lineno">  108</span>            <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a67f8ce8eaf3735d038f954742105a97d">postRegsIsEmpty_</a>.at(cr.nettingSetDetails) = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  109</span>        }</div>
<div class="line"><span class="lineno">  110</span> </div>
<div class="line"><span class="lineno">  111</span>        <span class="comment">// Make sure we have CRIF amount denominated in the result ccy</span></div>
<div class="line"><span class="lineno">  112</span>        CrifRecord newCrifRecord = cr;</div>
<div class="line"><span class="lineno">  113</span>        </div>
<div class="line"><span class="lineno">  114</span>        <span class="keywordflow">if</span> (cr.requiresAmountUsd() &amp;&amp; <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a> == <span class="stringliteral">&quot;USD&quot;</span> &amp;&amp; cr.hasAmountUsd()) {</div>
<div class="line"><span class="lineno">  115</span>            newCrifRecord.amountResultCcy = newCrifRecord.amountUsd;</div>
<div class="line"><span class="lineno">  116</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(cr.requiresAmountUsd()) {</div>
<div class="line"><span class="lineno">  117</span>            <span class="comment">// ProductClassMultiplier and AddOnNotionalFactor  don&#39;t have a currency and dont need to be converted,</span></div>
<div class="line"><span class="lineno">  118</span>            <span class="comment">// we use the amount</span></div>
<div class="line"><span class="lineno">  119</span>            <span class="keyword">const</span> Real fxSpot = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa14f759693736cf0438f0e6ff1a792fe">market_</a>-&gt;fxRate(newCrifRecord.amountCurrency + <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a>)-&gt;value();</div>
<div class="line"><span class="lineno">  120</span>            newCrifRecord.amountResultCcy = fxSpot * newCrifRecord.amount;</div>
<div class="line"><span class="lineno">  121</span>        }</div>
<div class="line"><span class="lineno">  122</span>        newCrifRecord.resultCurrency = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a>;</div>
<div class="line"><span class="lineno">  123</span> </div>
<div class="line"><span class="lineno">  124</span>        <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abf2dee0df927335cc4a8907e2c26bbbd">crif_</a>.<a class="code hl_function" href="classore_1_1analytics_1_1_crif.html#a7bb355daed08a7b228199a1c0b7bbee5">addRecord</a>(newCrifRecord);</div>
<div class="line"><span class="lineno">  125</span>    }</div>
<div class="line"><span class="lineno">  126</span> </div>
<div class="line"><span class="lineno">  127</span>    <span class="comment">// If there are no CRIF records to process</span></div>
<div class="line"><span class="lineno">  128</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abf2dee0df927335cc4a8907e2c26bbbd">crif_</a>.<a class="code hl_function" href="classore_1_1analytics_1_1_crif.html#a644718bb2fb240de962dc3c9a1fdf0dc">empty</a>())</div>
<div class="line"><span class="lineno">  129</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>    <span class="comment">// Add CRIF records to each regulation under each netting set</span></div>
<div class="line"><span class="lineno">  132</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno">  133</span>        <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;SimmCalculator: Splitting up original CRIF records into their respective collect/post regulations&quot;</span>);</div>
<div class="line"><span class="lineno">  134</span>    }</div>
<div class="line"><span class="lineno">  135</span>    </div>
<div class="line"><span class="lineno">  136</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ad795c008f1effc94d2dd140b3ba9bfe9">splitCrifByRegulationsAndPortfolios</a>(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abf2dee0df927335cc4a8907e2c26bbbd">crif_</a>, enforceIMRegulations);</div>
<div class="line"><span class="lineno">  137</span> </div>
<div class="line"><span class="lineno">  138</span>    <span class="comment">// Some additional processing depending on the regulations applicable to each netting set</span></div>
<div class="line"><span class="lineno">  139</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; [side, nettingsSetCrifMap] : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aaf77b775af6d98a512e4e434839f7781">regSensitivities_</a>) {</div>
<div class="line"><span class="lineno">  140</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; [nettingDetails, regulationCrifMap] : nettingsSetCrifMap) {</div>
<div class="line"><span class="lineno">  141</span>            <span class="comment">// Where there is SEC and CFTC in the portfolio, we add the CFTC trades to SEC,</span></div>
<div class="line"><span class="lineno">  142</span>            <span class="comment">// but still continue with CFTC calculations</span></div>
<div class="line"><span class="lineno">  143</span>            <span class="keyword">const</span> <span class="keywordtype">bool</span> hasCFTCGlobal = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a294f980933859f258720759c50392d25">hasCFTC_</a>[side].find(nettingDetails) != <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a294f980933859f258720759c50392d25">hasCFTC_</a>[side].end();</div>
<div class="line"><span class="lineno">  144</span>            <span class="keyword">const</span> <span class="keywordtype">bool</span> hasSECGlobal = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a2b0763dca4cfeddb14b14c992a4ec115">hasSEC_</a>[side].find(nettingDetails) != <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a2b0763dca4cfeddb14b14c992a4ec115">hasSEC_</a>[side].end();</div>
<div class="line"><span class="lineno">  145</span>            <span class="keyword">const</span> <span class="keywordtype">bool</span> hasSECLocal = regulationCrifMap.find(<span class="stringliteral">&quot;SEC&quot;</span>) != regulationCrifMap.end();</div>
<div class="line"><span class="lineno">  146</span>            <span class="keyword">const</span> <span class="keywordtype">bool</span> hasCFTCLocal = regulationCrifMap.find(<span class="stringliteral">&quot;CFTC&quot;</span>) != regulationCrifMap.end();</div>
<div class="line"><span class="lineno">  147</span> </div>
<div class="line"><span class="lineno">  148</span>            <span class="keywordflow">if</span> ((hasSECLocal &amp;&amp; hasCFTCLocal) || (hasCFTCGlobal &amp;&amp; hasSECGlobal)) {</div>
<div class="line"><span class="lineno">  149</span>                <span class="keywordflow">if</span> (!hasSECLocal) {</div>
<div class="line"><span class="lineno">  150</span>                    <span class="keywordflow">if</span> (!hasCFTCLocal) {</div>
<div class="line"><span class="lineno">  151</span>                        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  152</span>                    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  153</span>                        regulationCrifMap[<span class="stringliteral">&quot;SEC&quot;</span>] = Crif();</div>
<div class="line"><span class="lineno">  154</span>                    }</div>
<div class="line"><span class="lineno">  155</span>                }</div>
<div class="line"><span class="lineno">  156</span>                </div>
<div class="line"><span class="lineno">  157</span>                <span class="keywordflow">if</span> (hasCFTCLocal) {</div>
<div class="line"><span class="lineno">  158</span>                    <span class="comment">// At this point, we expect to have both SEC and CFTC sensitivities for the netting set</span></div>
<div class="line"><span class="lineno">  159</span>                    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; crifCFTC = regulationCrifMap[<span class="stringliteral">&quot;CFTC&quot;</span>];</div>
<div class="line"><span class="lineno">  160</span>                    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; crifSEC = regulationCrifMap[<span class="stringliteral">&quot;SEC&quot;</span>];</div>
<div class="line"><span class="lineno">  161</span>                    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cr :crifCFTC) {</div>
<div class="line"><span class="lineno">  162</span>                        <span class="comment">// Only add CFTC records to SEC if the record was not already in SEC,</span></div>
<div class="line"><span class="lineno">  163</span>                        <span class="comment">// i.e. we skip over CRIF records with regulations specified as e.g. &quot;..., CFTC, SEC, ...&quot;</span></div>
<div class="line"><span class="lineno">  164</span>                        <span class="keywordflow">if</span> (crifSEC.find(cr) == crifSEC.end()) {</div>
<div class="line"><span class="lineno">  165</span>                            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno">  166</span>                                <a class="code hl_defineRef" href="../ored/log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;SimmCalculator: Inserting CRIF record with CFTC &quot;</span></div>
<div class="line"><span class="lineno">  167</span>                                     &lt;&lt; nettingDetails &lt;&lt; <span class="stringliteral">&quot; regulation into SEC CRIF records: &quot;</span> &lt;&lt; cr);</div>
<div class="line"><span class="lineno">  168</span>                            }</div>
<div class="line"><span class="lineno">  169</span>                            regulationCrifMap[<span class="stringliteral">&quot;SEC&quot;</span>].addRecord(cr);</div>
<div class="line"><span class="lineno">  170</span>                        }</div>
<div class="line"><span class="lineno">  171</span>                    }</div>
<div class="line"><span class="lineno">  172</span>                }</div>
<div class="line"><span class="lineno">  173</span> </div>
<div class="line"><span class="lineno">  174</span>            }</div>
<div class="line"><span class="lineno">  175</span>            <span class="comment">// Aggreggate now all Crif Records</span></div>
<div class="line"><span class="lineno">  176</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; [regulation, crif] : regulationCrifMap) {</div>
<div class="line"><span class="lineno">  177</span>                crif = crif.aggregate();</div>
<div class="line"><span class="lineno">  178</span>            }</div>
<div class="line"><span class="lineno">  179</span> </div>
<div class="line"><span class="lineno">  180</span>            <span class="comment">// If netting set has &quot;Unspecified&quot; plus other regulations, the &quot;Unspecified&quot; sensis are to be excluded.</span></div>
<div class="line"><span class="lineno">  181</span>            <span class="comment">// If netting set only has &quot;Unspecified&quot;, then no regulations were ever specified, so all trades are</span></div>
<div class="line"><span class="lineno">  182</span>            <span class="comment">// included.</span></div>
<div class="line"><span class="lineno">  183</span>            <span class="keywordflow">if</span> (regulationCrifMap.count(<span class="stringliteral">&quot;Unspecified&quot;</span>) &gt; 0 &amp;&amp; regulationCrifMap.size() &gt; 1)</div>
<div class="line"><span class="lineno">  184</span>                regulationCrifMap.erase(<span class="stringliteral">&quot;Unspecified&quot;</span>);</div>
<div class="line"><span class="lineno">  185</span>        }</div>
<div class="line"><span class="lineno">  186</span>    }</div>
<div class="line"><span class="lineno">  187</span> </div>
<div class="line"><span class="lineno">  188</span>    <span class="comment">// Calculate SIMM call and post for each regulation under each netting set</span></div>
<div class="line"><span class="lineno">  189</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; [side, nettingSetRegulationCrifMap] : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aaf77b775af6d98a512e4e434839f7781">regSensitivities_</a>) {</div>
<div class="line"><span class="lineno">  190</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; [nsd, regulationCrifMap] : nettingSetRegulationCrifMap) {</div>
<div class="line"><span class="lineno">  191</span>            <span class="comment">// Calculate SIMM for particular side-nettingSet-regulation combination</span></div>
<div class="line"><span class="lineno">  192</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; [regulation, crif] : regulationCrifMap) {</div>
<div class="line"><span class="lineno">  193</span>                <span class="keywordtype">bool</span> hasFixedAddOn = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  194</span>                <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; sp : crif) {</div>
<div class="line"><span class="lineno">  195</span>                    <span class="keywordflow">if</span> (sp.riskType == RiskType::AddOnFixedAmount) {</div>
<div class="line"><span class="lineno">  196</span>                        hasFixedAddOn = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  197</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  198</span>                    }</div>
<div class="line"><span class="lineno">  199</span>                }</div>
<div class="line"><span class="lineno">  200</span>                <span class="keywordflow">if</span> (crif.hasCrifRecords() || hasFixedAddOn)</div>
<div class="line"><span class="lineno">  201</span>                    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#afa017918b1c2efd004b2d39b3aa72cdd">calculateRegulationSimm</a>(crif, nsd, regulation, side);</div>
<div class="line"><span class="lineno">  202</span>            }</div>
<div class="line"><span class="lineno">  203</span>        }</div>
<div class="line"><span class="lineno">  204</span>    }</div>
<div class="line"><span class="lineno">  205</span> </div>
<div class="line"><span class="lineno">  206</span>    <span class="comment">// Determine winning call and post regulations</span></div>
<div class="line"><span class="lineno">  207</span>    <span class="keywordflow">if</span> (determineWinningRegulations) {</div>
<div class="line"><span class="lineno">  208</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno">  209</span>            <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;SimmCalculator: Determining winning regulations&quot;</span>);</div>
<div class="line"><span class="lineno">  210</span>        }</div>
<div class="line"><span class="lineno">  211</span> </div>
<div class="line"><span class="lineno">  212</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> sv : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a>) {</div>
<div class="line"><span class="lineno">  213</span>            <span class="keyword">const</span> <a class="code hl_typedef" href="classore_1_1analytics_1_1_simm_calculator.html#afbff2a0e62c01d190bc46ff1461f7ddc">SimmSide</a> side = sv.first;</div>
<div class="line"><span class="lineno">  214</span> </div>
<div class="line"><span class="lineno">  215</span>            <span class="comment">// Determine winning (call and post) regulation for each netting set</span></div>
<div class="line"><span class="lineno">  216</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; kv : sv.second) {</div>
<div class="line"><span class="lineno">  217</span> </div>
<div class="line"><span class="lineno">  218</span>                <span class="comment">// Collect margin amounts and determine the highest margin amount</span></div>
<div class="line"><span class="lineno">  219</span>                Real winningMargin = std::numeric_limits&lt;Real&gt;::min();</div>
<div class="line"><span class="lineno">  220</span>                map&lt;string, Real&gt; nettingSetMargins;</div>
<div class="line"><span class="lineno">  221</span>                std::vector&lt;Real&gt; margins;</div>
<div class="line"><span class="lineno">  222</span>                <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; regSimmResults : kv.second) {</div>
<div class="line"><span class="lineno">  223</span>                    <span class="keyword">const</span> Real&amp; im = regSimmResults.second.get(ProductClass::All, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno">  224</span>                    nettingSetMargins[regSimmResults.first] = im;</div>
<div class="line"><span class="lineno">  225</span>                    <span class="keywordflow">if</span> (im &gt; winningMargin)</div>
<div class="line"><span class="lineno">  226</span>                        winningMargin = im;</div>
<div class="line"><span class="lineno">  227</span>                }</div>
<div class="line"><span class="lineno">  228</span> </div>
<div class="line"><span class="lineno">  229</span>                <span class="comment">// Determine winning regulations, i.e. regulations under which we find the highest margin amount</span></div>
<div class="line"><span class="lineno">  230</span>                std::vector&lt;string&gt; <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df">winningRegulations</a>;</div>
<div class="line"><span class="lineno">  231</span>                <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; kv : nettingSetMargins) {</div>
<div class="line"><span class="lineno">  232</span>                    <span class="keywordflow">if</span> (<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(kv.second, winningMargin))</div>
<div class="line"><span class="lineno">  233</span>                        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df">winningRegulations</a>.push_back(kv.first);</div>
<div class="line"><span class="lineno">  234</span>                }</div>
<div class="line"><span class="lineno">  235</span> </div>
<div class="line"><span class="lineno">  236</span>                <span class="comment">// In the case of multiple winning regulations, pick one based on the priority in the list</span></div>
<div class="line"><span class="lineno">  237</span>                <span class="comment">//const Regulation winningRegulation = oreplus::analytics::getWinningRegulation(winningRegulations);</span></div>
<div class="line"><span class="lineno">  238</span>                <span class="keywordtype">string</span> winningRegulation = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df">winningRegulations</a>.size() &gt; 1</div>
<div class="line"><span class="lineno">  239</span>                                               ? <a class="code hl_functionRef" href="../ored/namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">to_string</a>(<a class="code hl_function" href="namespaceore_1_1analytics.html#a35b7448b894b55dc772909ded32db916">getWinningRegulation</a>(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df">winningRegulations</a>))</div>
<div class="line"><span class="lineno">  240</span>                                               : <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df">winningRegulations</a>.at(0);</div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>                <span class="comment">// Populate internal list of winning regulators</span></div>
<div class="line"><span class="lineno">  243</span>                <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">winningRegulations_</a>[side][kv.first] = <a class="code hl_functionRef" href="../ored/namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">to_string</a>(winningRegulation);</div>
<div class="line"><span class="lineno">  244</span>            }</div>
<div class="line"><span class="lineno">  245</span>        }</div>
<div class="line"><span class="lineno">  246</span> </div>
<div class="line"><span class="lineno">  247</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a042350faccc6edc921037241553b2b47">populateFinalResults</a>();</div>
<div class="line"><span class="lineno">  248</span>    }</div>
<div class="line"><span class="lineno">  249</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_crif_html_a644718bb2fb240de962dc3c9a1fdf0dc"><div class="ttname"><a href="classore_1_1analytics_1_1_crif.html#a644718bb2fb240de962dc3c9a1fdf0dc">ore::analytics::Crif::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> <a href="crif_8hpp_source.html#l00055">crif.hpp:55</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_crif_html_a7bb355daed08a7b228199a1c0b7bbee5"><div class="ttname"><a href="classore_1_1analytics_1_1_crif.html#a7bb355daed08a7b228199a1c0b7bbee5">ore::analytics::Crif::addRecord</a></div><div class="ttdeci">void addRecord(const CrifRecord &amp;record, bool aggregateDifferentAmountCurrencies=false, bool sortFxVolQualifer=true)</div><div class="ttdef"><b>Definition:</b> <a href="crif_8cpp_source.html#l00041">crif.cpp:41</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a042350faccc6edc921037241553b2b47"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a042350faccc6edc921037241553b2b47">ore::analytics::SimmCalculator::populateFinalResults</a></div><div class="ttdeci">void populateFinalResults()</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l01595">simmcalculator.cpp:1595</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a294f980933859f258720759c50392d25"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a294f980933859f258720759c50392d25">ore::analytics::SimmCalculator::hasCFTC_</a></div><div class="ttdeci">std::map&lt; SimmSide, std::set&lt; NettingSetDetails &gt; &gt; hasCFTC_</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00135">simmcalculator.hpp:135</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a2b0763dca4cfeddb14b14c992a4ec115"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a2b0763dca4cfeddb14b14c992a4ec115">ore::analytics::SimmCalculator::hasSEC_</a></div><div class="ttdeci">std::map&lt; SimmSide, std::set&lt; NettingSetDetails &gt; &gt; hasSEC_</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00135">simmcalculator.hpp:135</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a3c2fc9fbb2d2df2e4a97152bde680460"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a3c2fc9fbb2d2df2e4a97152bde680460">ore::analytics::SimmCalculator::calculationCcyCall_</a></div><div class="ttdeci">std::string calculationCcyCall_</div><div class="ttdoc">The SIMM exposure calculation currency i.e. the currency for which FX delta risk is ignored.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00124">simmcalculator.hpp:124</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a4b33acd9c41c58660a2f82e5f43963c4"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">ore::analytics::SimmCalculator::winningRegulations_</a></div><div class="ttdeci">std::map&lt; SimmSide, std::map&lt; ore::data::NettingSetDetails, std::string &gt; &gt; winningRegulations_</div><div class="ttdoc">Regulation with highest initial margin for each given netting set.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00145">simmcalculator.hpp:145</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a5ec9383d15f514091d85cc7fd697abbb"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a5ec9383d15f514091d85cc7fd697abbb">ore::analytics::SimmCalculator::collectRegsIsEmpty_</a></div><div class="ttdeci">std::map&lt; ore::data::NettingSetDetails, bool &gt; collectRegsIsEmpty_</div><div class="ttdoc">For each netting set, whether all CRIF records' collect regulations are empty.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00138">simmcalculator.hpp:138</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a66ce6144aef4f726c92ef4ddaf4afe64"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">ore::analytics::SimmCalculator::simmResults_</a></div><div class="ttdeci">std::map&lt; SimmSide, std::map&lt; ore::data::NettingSetDetails, std::map&lt; std::string, SimmResults &gt; &gt; &gt; simmResults_</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00151">simmcalculator.hpp:151</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a67f8ce8eaf3735d038f954742105a97d"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a67f8ce8eaf3735d038f954742105a97d">ore::analytics::SimmCalculator::postRegsIsEmpty_</a></div><div class="ttdeci">std::map&lt; ore::data::NettingSetDetails, bool &gt; postRegsIsEmpty_</div><div class="ttdoc">For each netting set, whether all CRIF records' post regulations are empty.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00141">simmcalculator.hpp:141</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a766fc790a5e25235a2083f09f21011df"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df">ore::analytics::SimmCalculator::winningRegulations</a></div><div class="ttdeci">const std::map&lt; SimmSide, std::map&lt; ore::data::NettingSetDetails, string &gt; &gt; &amp; winningRegulations() const</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l00393">simmcalculator.cpp:393</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a7a39a158ea18a8a37f1db65a59f0048b"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">ore::analytics::SimmCalculator::simmConfiguration_</a></div><div class="ttdeci">QuantLib::ext::shared_ptr&lt; SimmConfiguration &gt; simmConfiguration_</div><div class="ttdoc">The SIMM configuration governing the calculation.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00121">simmcalculator.hpp:121</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_aa14f759693736cf0438f0e6ff1a792fe"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#aa14f759693736cf0438f0e6ff1a792fe">ore::analytics::SimmCalculator::market_</a></div><div class="ttdeci">QuantLib::ext::shared_ptr&lt; ore::data::Market &gt; market_</div><div class="ttdoc">Market data for FX rates to use for converting amounts to USD.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00130">simmcalculator.hpp:130</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_aa2fedb3c02ffb092a6c19a0ee1e81a02"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">ore::analytics::SimmCalculator::quiet_</a></div><div class="ttdeci">bool quiet_</div><div class="ttdoc">If true, no logging is written out.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00133">simmcalculator.hpp:133</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_aaf77b775af6d98a512e4e434839f7781"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#aaf77b775af6d98a512e4e434839f7781">ore::analytics::SimmCalculator::regSensitivities_</a></div><div class="ttdeci">std::map&lt; SimmSide, std::map&lt; ore::data::NettingSetDetails, std::map&lt; std::string, Crif &gt; &gt; &gt; regSensitivities_</div><div class="ttdoc">Net sentivities at the regulation level within each netting set.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00115">simmcalculator.hpp:115</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_abc16565c54ac283038b1e2114635cd43"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#abc16565c54ac283038b1e2114635cd43">ore::analytics::SimmCalculator::calculationCcyPost_</a></div><div class="ttdeci">std::string calculationCcyPost_</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00124">simmcalculator.hpp:124</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_abf2dee0df927335cc4a8907e2c26bbbd"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#abf2dee0df927335cc4a8907e2c26bbbd">ore::analytics::SimmCalculator::crif_</a></div><div class="ttdeci">ore::analytics::Crif crif_</div><div class="ttdoc">All the net sensitivities passed in for the calculation.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00112">simmcalculator.hpp:112</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_ad795c008f1effc94d2dd140b3ba9bfe9"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#ad795c008f1effc94d2dd140b3ba9bfe9">ore::analytics::SimmCalculator::splitCrifByRegulationsAndPortfolios</a></div><div class="ttdeci">void splitCrifByRegulationsAndPortfolios(const Crif &amp;crif, const bool enforceIMRegulations)</div><div class="ttdoc">Add CRIF record to the CRIF records container that correspondsd to the given regulation/s and portfol...</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l01620">simmcalculator.cpp:1620</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_aed547488155ddce90f75d9ade15d0764"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">ore::analytics::SimmCalculator::resultCcy_</a></div><div class="ttdeci">std::string resultCcy_</div><div class="ttdoc">The SIMM result currency i.e. the currency in which the main SIMM results are denominated.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00127">simmcalculator.hpp:127</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_afa017918b1c2efd004b2d39b3aa72cdd"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#afa017918b1c2efd004b2d39b3aa72cdd">ore::analytics::SimmCalculator::calculateRegulationSimm</a></div><div class="ttdeci">const void calculateRegulationSimm(const ore::analytics::Crif &amp;crif, const ore::data::NettingSetDetails &amp;nsd, const string &amp;regulation, const SimmSide &amp;side)</div><div class="ttdoc">Calculates SIMM for a given regulation under a given netting set.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l00251">simmcalculator.cpp:251</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_afbff2a0e62c01d190bc46ff1461f7ddc"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#afbff2a0e62c01d190bc46ff1461f7ddc">ore::analytics::SimmCalculator::SimmSide</a></div><div class="ttdeci">SimmConfiguration::SimmSide SimmSide</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00038">simmcalculator.hpp:38</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_j_s_o_n_message_html_a5e21eca2668ed948bdc409b19a78e5bb"><div class="ttname"><a href="../ored/classore_1_1data_1_1_j_s_o_n_message.html#a5e21eca2668ed948bdc409b19a78e5bb">ore::data::JSONMessage::log</a></div><div class="ttdeci">void log() const</div></div>
<div class="ttc" id="aclassore_1_1data_1_1_structured_trade_warning_message_html"><div class="ttname"><a href="../ored/classore_1_1data_1_1_structured_trade_warning_message.html">ore::data::StructuredTradeWarningMessage</a></div></div>
<div class="ttc" id="agroup__utilities_html_gae6725a0931b419ec545f9abb0b6ede76"><div class="ttname"><a href="../ored/group__utilities.html#gae6725a0931b419ec545f9abb0b6ede76">checkCurrency</a></div><div class="ttdeci">bool checkCurrency(const string &amp;code)</div></div>
<div class="ttc" id="alog_8hpp_html_a158e0f085ddedfe5c8ed069986039f50"><div class="ttname"><a href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a></div><div class="ttdeci">#define LOG(text)</div></div>
<div class="ttc" id="alog_8hpp_html_a34c7c8cde9b91d2eee82d7b9a0b66fd5"><div class="ttname"><a href="../ored/log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a></div><div class="ttdeci">#define DLOG(text)</div></div>
<div class="ttc" id="anamespace_quant_ext_html_a1cab4fb6a720eff245acb9f3a7a9e7c5"><div class="ttname"><a href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a></div><div class="ttdeci">Filter close_enough(const RandomVariable &amp;x, const RandomVariable &amp;y)</div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a35b7448b894b55dc772909ded32db916"><div class="ttname"><a href="namespaceore_1_1analytics.html#a35b7448b894b55dc772909ded32db916">ore::analytics::getWinningRegulation</a></div><div class="ttdeci">SimmConfiguration::Regulation getWinningRegulation(const std::vector&lt; string &gt; &amp;winningRegulations)</div><div class="ttdoc">From a vector of regulations, determine the winning regulation based on order of priority.</div><div class="ttdef"><b>Definition:</b> <a href="simmconfiguration_8cpp_source.html#l00385">simmconfiguration.cpp:385</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a86651dfeb5c18ee891f7a4734d8cf455"><div class="ttname"><a href="../ored/namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">to_string</a></div><div class="ttdeci">std::string to_string(const LocationInfo &amp;l)</div></div>
</div><!-- fragment --><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a7239a98428b9d2b50f6372ed1b3cb9e6_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a7239a98428b9d2b50f6372ed1b3cb9e6_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a7239a98428b9d2b50f6372ed1b3cb9e6_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a7239a98428b9d2b50f6372ed1b3cb9e6_cgraph">
<area shape="rect" title=" " alt="" coords="5,1254,120,1279"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a7bb355daed08a7b228199a1c0b7bbee5" title=" " alt="" coords="668,317,795,357"/>
<area shape="rect" target="_parent" href="../ored/classore_1_1data_1_1_j_s_o_n_message.html#a5e21eca2668ed948bdc409b19a78e5bb" title=" " alt="" coords="1107,7,1300,33"/>
<area shape="rect" target="_parent" href="../ored/namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455" title=" " alt="" coords="1138,86,1269,111"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a00ee36226aadba7958df315e6e33926f" title="Aggregate all existing records." alt="" coords="427,513,553,553"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#afa017918b1c2efd004b2d39b3aa72cdd" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="170,1075,339,1101"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5" title=" " alt="" coords="1152,1606,1255,1631"/>
<area shape="rect" target="_parent" href="../ored/group__utilities.html#gae6725a0931b419ec545f9abb0b6ede76" title=" " alt="" coords="200,1279,309,1305"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a644718bb2fb240de962dc3c9a1fdf0dc" title=" " alt="" coords="191,1329,318,1369"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a35b7448b894b55dc772909ded32db916" title="From a vector of regulations, determine the winning regulation based on order of priority." alt="" coords="168,1393,341,1433"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a042350faccc6edc921037241553b2b47" title=" " alt="" coords="183,1482,326,1507"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#ad795c008f1effc94d2dd140b3ba9bfe9" title="Add CRIF record to the CRIF records container that correspondsd to the given regulation/s and portfol..." alt="" coords="169,1532,341,1572"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df" title=" " alt="" coords="188,1597,321,1622"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a3fa77fcee599a6d59e6552d4de54f96d" title=" " alt="" coords="898,285,1033,325"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#af8e82ef448e1af321ea74e009daac384" title=" " alt="" coords="893,349,1038,389"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#af74e34d137c7461cb9b749825c09935f" title=" " alt="" coords="872,93,1059,133"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#ab402e2cf695460498ad220674bf5ef8f" title=" " alt="" coords="881,157,1049,197"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#a463e709fa1ea429189685b96fdfe7e09" title=" " alt="" coords="881,221,1049,261"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#aa108b23a011189ae8fac545736305e03" title=" " alt="" coords="1140,273,1267,313"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#a688854e414682c97a4bcfd3105a25463" title=" " alt="" coords="1363,156,1536,196"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a16b48209e840abcea676c240310b306b" title=" " alt="" coords="1348,239,1551,279"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#a5bb520e16d3d5631dbf3ba33986b15e7" title=" " alt="" coords="1599,111,1767,151"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#a2014d6737c363789a01e7a05d9acfe3e" title=" " alt="" coords="1599,175,1767,215"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#aff39b5ff2ca60d42f45031609b1c70ad" title=" " alt="" coords="1599,239,1767,279"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#ab2992493966a6434cfacf416e5a1bd3b" title=" " alt="" coords="1599,303,1767,343"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#aff4f62c8f81e353a2d4fd71d150df251" title=" " alt="" coords="1599,367,1767,407"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191" title=" " alt="" coords="710,809,753,834"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a4a962180a9c1082605962fd7e021892f" title="Calculate the additional initial margin for the portfolio ID and regulation." alt="" coords="436,730,544,755"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a" title=" " alt="" coords="675,1593,788,1618"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa" title=" " alt="" coords="935,1289,996,1314"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a4fc0d11995a333e0808c3c20f1f93fa4" title="Calculate the Interest Rate curvature margin component for the given portfolio and product class." alt="" coords="429,1290,551,1315"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a2f30844efa1be083cc9096e5eb411454" title="Calculate the Interest Rate delta margin component for the given portfolio and product class." alt="" coords="682,593,781,618"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a40608992cde449b98628de2df0eff046" title="Calculate the Interest Rate vega margin component for the given portfolio and product class." alt="" coords="682,961,781,986"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#acdab2245e5344cc15b7c0f2da447a59b" title=" " alt="" coords="433,1107,547,1133"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a59eeb8352513edf22addee1f51350dfb" title=" " alt="" coords="391,1029,589,1083"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#ae60c8d5d49613f14cf237899570ac854" title=" " alt="" coords="1140,1297,1267,1337"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a273f66b7ccd20b924ca6eef153e59a13" title=" " alt="" coords="902,744,1029,784"/>
<area shape="rect" href="namespaceore_1_1analytics.html#aed244f2f7562d5e7c86e0a3452117b9a" title=" " alt="" coords="639,693,824,733"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a424b2c96c8b5f13080141e499c282692" title=" " alt="" coords="902,1707,1029,1747"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5" title="Give the &#160;used in the curvature margin calculation." alt="" coords="933,1441,997,1466"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1" title=" " alt="" coords="1180,1062,1227,1087"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa" title=" " alt="" coords="1182,1198,1225,1223"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2" title=" " alt="" coords="1181,1247,1225,1273"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a715afb0219b3c338740f98cd349e0845" title=" " alt="" coords="878,1491,1053,1531"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a1d2bc2fd582f6814002e27b00b6d4853" title=" " alt="" coords="918,809,1013,834"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a19aa28193073c2c75dd9f1e214054d7d" title=" " alt="" coords="1140,801,1267,841"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a87a80f1c19e506a4f3fd3d219fdf55ea" title=" " alt="" coords="902,413,1029,453"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a6aafd64e5e9b14444d5afe3d18e968e1" title=" " alt="" coords="887,478,1043,503"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#ab0661abf78b45ccf5c665fbe16bcb4bd" title="Find first element." alt="" coords="902,528,1029,568"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a3041af85f923e8c333f16febd8e66147" title=" " alt="" coords="389,1442,591,1467"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a35d86bbe3c6d9f5c3de91441c206506e" title="Reads a string containing regulations applicable for a given CRIF record." alt="" coords="389,1532,591,1572"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="afa017918b1c2efd004b2d39b3aa72cdd" name="afa017918b1c2efd004b2d39b3aa72cdd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa017918b1c2efd004b2d39b3aa72cdd">&#9670;&#160;</a></span>calculateRegulationSimm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const void calculateRegulationSimm </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;&#160;</td>
          <td class="paramname"><em>crif</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;&#160;</td>
          <td class="paramname"><em>nsd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>regulation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates SIMM for a given regulation under a given netting set. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00251">251</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  253</span>                                                                         {</div>
<div class="line"><span class="lineno">  254</span> </div>
<div class="line"><span class="lineno">  255</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno">  256</span>        <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;SimmCalculator: Calculating SIMM &quot;</span> &lt;&lt; side &lt;&lt; <span class="stringliteral">&quot; for portfolio [&quot;</span> &lt;&lt; nettingSetDetails &lt;&lt; <span class="stringliteral">&quot;], regulation &quot;</span></div>
<div class="line"><span class="lineno">  257</span>                                                &lt;&lt; regulation);</div>
<div class="line"><span class="lineno">  258</span>    }</div>
<div class="line"><span class="lineno">  259</span>    <span class="comment">// Loop over portfolios and product classes</span></div>
<div class="line"><span class="lineno">  260</span>   <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>  productClass : crif.<a class="code hl_function" href="classore_1_1analytics_1_1_crif.html#a59eeb8352513edf22addee1f51350dfb">ProductClassesByNettingSetDetails</a>(nettingSetDetails)){</div>
<div class="line"><span class="lineno">  261</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno">  262</span>            <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;SimmCalculator: Calculating SIMM for product class &quot;</span> &lt;&lt; productClass);</div>
<div class="line"><span class="lineno">  263</span>        }</div>
<div class="line"><span class="lineno">  264</span> </div>
<div class="line"><span class="lineno">  265</span>        <span class="comment">// Delta margin components</span></div>
<div class="line"><span class="lineno">  266</span>        <a class="code hl_typedef" href="namespaceore_1_1analytics.html#a2e2b394182ab11afa96c27330a0a6fd3">RiskClass</a> rc = RiskClass::InterestRate;</div>
<div class="line"><span class="lineno">  267</span>        <a class="code hl_typedef" href="namespaceore_1_1analytics.html#a37f0476a64890aa4797db50095f787ec">MarginType</a> mt = MarginType::Delta;</div>
<div class="line"><span class="lineno">  268</span>        <span class="keyword">auto</span> p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a2f30844efa1be083cc9096e5eb411454">irDeltaMargin</a>(nettingSetDetails, productClass, crif, side);</div>
<div class="line"><span class="lineno">  269</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  270</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  271</span> </div>
<div class="line"><span class="lineno">  272</span>        rc = RiskClass::FX;</div>
<div class="line"><span class="lineno">  273</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>(nettingSetDetails, productClass, RiskType::FX, crif, side);</div>
<div class="line"><span class="lineno">  274</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  275</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  276</span> </div>
<div class="line"><span class="lineno">  277</span>        rc = RiskClass::CreditQualifying;</div>
<div class="line"><span class="lineno">  278</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>(nettingSetDetails, productClass, RiskType::CreditQ, crif, side);</div>
<div class="line"><span class="lineno">  279</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  280</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  281</span> </div>
<div class="line"><span class="lineno">  282</span>        rc = RiskClass::CreditNonQualifying;</div>
<div class="line"><span class="lineno">  283</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>(nettingSetDetails, productClass, RiskType::CreditNonQ, crif, side);</div>
<div class="line"><span class="lineno">  284</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  285</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  286</span> </div>
<div class="line"><span class="lineno">  287</span>        rc = RiskClass::Equity;</div>
<div class="line"><span class="lineno">  288</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>(nettingSetDetails, productClass, RiskType::Equity, crif, side);</div>
<div class="line"><span class="lineno">  289</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  290</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  291</span> </div>
<div class="line"><span class="lineno">  292</span>        rc = RiskClass::Commodity;</div>
<div class="line"><span class="lineno">  293</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>(nettingSetDetails, productClass, RiskType::Commodity, crif, side);</div>
<div class="line"><span class="lineno">  294</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  295</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  296</span> </div>
<div class="line"><span class="lineno">  297</span>        <span class="comment">// Vega margin components</span></div>
<div class="line"><span class="lineno">  298</span>        mt = MarginType::Vega;</div>
<div class="line"><span class="lineno">  299</span>        rc = RiskClass::InterestRate;</div>
<div class="line"><span class="lineno">  300</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a40608992cde449b98628de2df0eff046">irVegaMargin</a>(nettingSetDetails, productClass, crif, side);</div>
<div class="line"><span class="lineno">  301</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  302</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  303</span> </div>
<div class="line"><span class="lineno">  304</span>        rc = RiskClass::FX;</div>
<div class="line"><span class="lineno">  305</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>(nettingSetDetails, productClass, RiskType::FXVol, crif, side);</div>
<div class="line"><span class="lineno">  306</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  307</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  308</span> </div>
<div class="line"><span class="lineno">  309</span>        rc = RiskClass::CreditQualifying;</div>
<div class="line"><span class="lineno">  310</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>(nettingSetDetails, productClass, RiskType::CreditVol, crif, side);</div>
<div class="line"><span class="lineno">  311</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  312</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  313</span> </div>
<div class="line"><span class="lineno">  314</span>        rc = RiskClass::CreditNonQualifying;</div>
<div class="line"><span class="lineno">  315</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>(nettingSetDetails, productClass, RiskType::CreditVolNonQ, crif, side);</div>
<div class="line"><span class="lineno">  316</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  317</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  318</span> </div>
<div class="line"><span class="lineno">  319</span>        rc = RiskClass::Equity;</div>
<div class="line"><span class="lineno">  320</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>(nettingSetDetails, productClass, RiskType::EquityVol, crif, side);</div>
<div class="line"><span class="lineno">  321</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  322</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span>        rc = RiskClass::Commodity;</div>
<div class="line"><span class="lineno">  325</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>(nettingSetDetails, productClass, RiskType::CommodityVol, crif, side);</div>
<div class="line"><span class="lineno">  326</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  327</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  328</span> </div>
<div class="line"><span class="lineno">  329</span>        <span class="comment">// Curvature margin components for sides call and post</span></div>
<div class="line"><span class="lineno">  330</span>        mt = MarginType::Curvature;</div>
<div class="line"><span class="lineno">  331</span>        rc = RiskClass::InterestRate;</div>
<div class="line"><span class="lineno">  332</span> </div>
<div class="line"><span class="lineno">  333</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a4fc0d11995a333e0808c3c20f1f93fa4">irCurvatureMargin</a>(nettingSetDetails, productClass, side, crif);</div>
<div class="line"><span class="lineno">  334</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  335</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  336</span> </div>
<div class="line"><span class="lineno">  337</span>        rc = RiskClass::FX;</div>
<div class="line"><span class="lineno">  338</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>(nettingSetDetails, productClass, RiskType::FXVol, side, crif, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  339</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  340</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  341</span> </div>
<div class="line"><span class="lineno">  342</span>        rc = RiskClass::CreditQualifying;</div>
<div class="line"><span class="lineno">  343</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>(nettingSetDetails, productClass, RiskType::CreditVol, side, crif);</div>
<div class="line"><span class="lineno">  344</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  345</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  346</span> </div>
<div class="line"><span class="lineno">  347</span>        rc = RiskClass::CreditNonQualifying;</div>
<div class="line"><span class="lineno">  348</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>(nettingSetDetails, productClass, RiskType::CreditVolNonQ, side, crif);</div>
<div class="line"><span class="lineno">  349</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  350</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  351</span> </div>
<div class="line"><span class="lineno">  352</span>        rc = RiskClass::Equity;</div>
<div class="line"><span class="lineno">  353</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>(nettingSetDetails, productClass, RiskType::EquityVol, side, crif, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  354</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  355</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  356</span> </div>
<div class="line"><span class="lineno">  357</span>        rc = RiskClass::Commodity;</div>
<div class="line"><span class="lineno">  358</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>(nettingSetDetails, productClass, RiskType::CommodityVol, side, crif, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  359</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  360</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  361</span> </div>
<div class="line"><span class="lineno">  362</span>        <span class="comment">// Base correlation margin components. This risk type came later so need to check</span></div>
<div class="line"><span class="lineno">  363</span>        <span class="comment">// first if it is valid under the configuration</span></div>
<div class="line"><span class="lineno">  364</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;isValidRiskType(RiskType::BaseCorr)) {</div>
<div class="line"><span class="lineno">  365</span>            p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>(nettingSetDetails, productClass, RiskType::BaseCorr, crif, side);</div>
<div class="line"><span class="lineno">  366</span>            <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  367</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, productClass, RiskClass::CreditQualifying, MarginType::BaseCorr,</div>
<div class="line"><span class="lineno">  368</span>                    p.first, side);</div>
<div class="line"><span class="lineno">  369</span>        }</div>
<div class="line"><span class="lineno">  370</span>    }</div>
<div class="line"><span class="lineno">  371</span> </div>
<div class="line"><span class="lineno">  372</span>    <span class="comment">// Calculate the higher level margins</span></div>
<div class="line"><span class="lineno">  373</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#acdab2245e5344cc15b7c0f2da447a59b">populateResults</a>(side, nettingSetDetails, regulation);</div>
<div class="line"><span class="lineno">  374</span> </div>
<div class="line"><span class="lineno">  375</span>    <span class="comment">// For each portfolio, calculate the additional margin</span></div>
<div class="line"><span class="lineno">  376</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a4a962180a9c1082605962fd7e021892f">calcAddMargin</a>(side, nettingSetDetails, regulation, crif);</div>
<div class="line"><span class="lineno">  377</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_crif_html_a59eeb8352513edf22addee1f51350dfb"><div class="ttname"><a href="classore_1_1analytics_1_1_crif.html#a59eeb8352513edf22addee1f51350dfb">ore::analytics::Crif::ProductClassesByNettingSetDetails</a></div><div class="ttdeci">std::set&lt; CrifRecord::ProductClass &gt; ProductClassesByNettingSetDetails(const NettingSetDetails nsd) const</div><div class="ttdef"><b>Definition:</b> <a href="crif_8cpp_source.html#l00324">crif.cpp:324</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a12dd56db004e8584b643b1e8199137fa"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">ore::analytics::SimmCalculator::margin</a></div><div class="ttdeci">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, bool &gt; margin(const ore::data::NettingSetDetails &amp;nettingSetDetails, const CrifRecord::ProductClass &amp;pc, const CrifRecord::RiskType &amp;rt, const ore::analytics::Crif &amp;netRecords, const SimmSide &amp;side) const</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l00886">simmcalculator.cpp:886</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a2f30844efa1be083cc9096e5eb411454"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a2f30844efa1be083cc9096e5eb411454">ore::analytics::SimmCalculator::irDeltaMargin</a></div><div class="ttdeci">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, bool &gt; irDeltaMargin(const ore::data::NettingSetDetails &amp;nettingSetDetails, const CrifRecord::ProductClass &amp;pc, const ore::analytics::Crif &amp;netRecords, const SimmSide &amp;side) const</div><div class="ttdoc">Calculate the Interest Rate delta margin component for the given portfolio and product class.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l00444">simmcalculator.cpp:444</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a40608992cde449b98628de2df0eff046"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a40608992cde449b98628de2df0eff046">ore::analytics::SimmCalculator::irVegaMargin</a></div><div class="ttdeci">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, bool &gt; irVegaMargin(const ore::data::NettingSetDetails &amp;nettingSetDetails, const CrifRecord::ProductClass &amp;pc, const ore::analytics::Crif &amp;netRecords, const SimmSide &amp;side) const</div><div class="ttdoc">Calculate the Interest Rate vega margin component for the given portfolio and product class.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l00615">simmcalculator.cpp:615</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a4a962180a9c1082605962fd7e021892f"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a4a962180a9c1082605962fd7e021892f">ore::analytics::SimmCalculator::calcAddMargin</a></div><div class="ttdeci">void calcAddMargin(const SimmSide &amp;side, const ore::data::NettingSetDetails &amp;nsd, const string &amp;regulation, const ore::analytics::Crif &amp;netRecords)</div><div class="ttdoc">Calculate the additional initial margin for the portfolio ID and regulation.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l01236">simmcalculator.cpp:1236</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a4fc0d11995a333e0808c3c20f1f93fa4"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a4fc0d11995a333e0808c3c20f1f93fa4">ore::analytics::SimmCalculator::irCurvatureMargin</a></div><div class="ttdeci">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, bool &gt; irCurvatureMargin(const ore::data::NettingSetDetails &amp;nettingSetDetails, const CrifRecord::ProductClass &amp;pc, const SimmSide &amp;side, const ore::analytics::Crif &amp;crif) const</div><div class="ttdoc">Calculate the Interest Rate curvature margin component for the given portfolio and product class.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l00751">simmcalculator.cpp:751</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a875f25ec95261673b6f1b6f12603ed5a"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">ore::analytics::SimmCalculator::curvatureMargin</a></div><div class="ttdeci">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, bool &gt; curvatureMargin(const ore::data::NettingSetDetails &amp;nettingSetDetails, const CrifRecord::ProductClass &amp;pc, const CrifRecord::RiskType &amp;rt, const SimmSide &amp;side, const ore::analytics::Crif &amp;netRecords, bool rfLabels=true) const</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l01076">simmcalculator.cpp:1076</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_ab744e5a7cd40f8aa6042cc4c0165f191"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">ore::analytics::SimmCalculator::add</a></div><div class="ttdeci">void add(const ore::data::NettingSetDetails &amp;nettingSetDetails, const string &amp;regulation, const CrifRecord::ProductClass &amp;pc, const SimmConfiguration::RiskClass &amp;rc, const SimmConfiguration::MarginType &amp;mt, const std::string &amp;b, QuantLib::Real margin, SimmSide side, const bool overwrite=true)</div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_acdab2245e5344cc15b7c0f2da447a59b"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#acdab2245e5344cc15b7c0f2da447a59b">ore::analytics::SimmCalculator::populateResults</a></div><div class="ttdeci">void populateResults(const SimmSide &amp;side, const ore::data::NettingSetDetails &amp;nsd, const string &amp;regulation)</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l01351">simmcalculator.cpp:1351</a></div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a2e2b394182ab11afa96c27330a0a6fd3"><div class="ttname"><a href="namespaceore_1_1analytics.html#a2e2b394182ab11afa96c27330a0a6fd3">ore::analytics::RiskClass</a></div><div class="ttdeci">SimmConfiguration::RiskClass RiskClass</div><div class="ttdef"><b>Definition:</b> <a href="reportwriter_8cpp_source.html#l01566">reportwriter.cpp:1566</a></div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a37f0476a64890aa4797db50095f787ec"><div class="ttname"><a href="namespaceore_1_1analytics.html#a37f0476a64890aa4797db50095f787ec">ore::analytics::MarginType</a></div><div class="ttdeci">SimmConfiguration::MarginType MarginType</div><div class="ttdef"><b>Definition:</b> <a href="reportwriter_8cpp_source.html#l01567">reportwriter.cpp:1567</a></div></div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_afa017918b1c2efd004b2d39b3aa72cdd_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_afa017918b1c2efd004b2d39b3aa72cdd_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_afa017918b1c2efd004b2d39b3aa72cdd_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_afa017918b1c2efd004b2d39b3aa72cdd_cgraph">
<area shape="rect" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="5,1091,175,1117"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191" title=" " alt="" coords="703,406,746,431"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a4a962180a9c1082605962fd7e021892f" title="Calculate the additional initial margin for the portfolio ID and regulation." alt="" coords="473,381,581,406"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a" title=" " alt="" coords="470,723,583,749"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa" title=" " alt="" coords="694,1065,755,1090"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a4fc0d11995a333e0808c3c20f1f93fa4" title="Calculate the Interest Rate curvature margin component for the given portfolio and product class." alt="" coords="261,990,383,1015"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a2f30844efa1be083cc9096e5eb411454" title="Calculate the Interest Rate delta margin component for the given portfolio and product class." alt="" coords="477,1559,576,1585"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a40608992cde449b98628de2df0eff046" title="Calculate the Interest Rate vega margin component for the given portfolio and product class." alt="" coords="477,1331,576,1357"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#acdab2245e5344cc15b7c0f2da447a59b" title=" " alt="" coords="469,1142,584,1167"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a59eeb8352513edf22addee1f51350dfb" title=" " alt="" coords="223,1294,421,1349"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a7bb355daed08a7b228199a1c0b7bbee5" title=" " alt="" coords="661,227,788,267"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#ae60c8d5d49613f14cf237899570ac854" title=" " alt="" coords="886,449,1013,489"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a273f66b7ccd20b924ca6eef153e59a13" title=" " alt="" coords="661,1267,788,1307"/>
<area shape="rect" href="namespaceore_1_1analytics.html#aed244f2f7562d5e7c86e0a3452117b9a" title=" " alt="" coords="632,291,817,331"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a3fa77fcee599a6d59e6552d4de54f96d" title=" " alt="" coords="882,227,1017,267"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#af8e82ef448e1af321ea74e009daac384" title=" " alt="" coords="877,163,1022,203"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#af74e34d137c7461cb9b749825c09935f" title=" " alt="" coords="1081,105,1268,145"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#ab402e2cf695460498ad220674bf5ef8f" title=" " alt="" coords="865,291,1033,331"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#a463e709fa1ea429189685b96fdfe7e09" title=" " alt="" coords="865,355,1033,395"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#aa108b23a011189ae8fac545736305e03" title=" " alt="" coords="1111,169,1238,209"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#a688854e414682c97a4bcfd3105a25463" title=" " alt="" coords="1331,197,1504,237"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a16b48209e840abcea676c240310b306b" title=" " alt="" coords="1316,133,1519,173"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#a5bb520e16d3d5631dbf3ba33986b15e7" title=" " alt="" coords="1567,5,1735,45"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#a2014d6737c363789a01e7a05d9acfe3e" title=" " alt="" coords="1567,69,1735,109"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#aff39b5ff2ca60d42f45031609b1c70ad" title=" " alt="" coords="1567,133,1735,173"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#ab2992493966a6434cfacf416e5a1bd3b" title=" " alt="" coords="1567,197,1735,237"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#aff4f62c8f81e353a2d4fd71d150df251" title=" " alt="" coords="1567,261,1735,301"/>
<area shape="rect" target="_parent" href="../ored/classore_1_1data_1_1_j_s_o_n_message.html#a5e21eca2668ed948bdc409b19a78e5bb" title=" " alt="" coords="1321,34,1514,59"/>
<area shape="rect" target="_parent" href="../ored/namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455" title=" " alt="" coords="1352,83,1483,109"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5" title=" " alt="" coords="898,889,1001,914"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a424b2c96c8b5f13080141e499c282692" title=" " alt="" coords="661,557,788,597"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5" title="Give the &#160;used in the curvature margin calculation." alt="" coords="693,838,757,863"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1" title=" " alt="" coords="926,1115,973,1141"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa" title=" " alt="" coords="928,1065,971,1090"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2" title=" " alt="" coords="927,1191,971,1217"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a715afb0219b3c338740f98cd349e0845" title=" " alt="" coords="637,773,812,813"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a1d2bc2fd582f6814002e27b00b6d4853" title=" " alt="" coords="677,1483,772,1509"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a19aa28193073c2c75dd9f1e214054d7d" title=" " alt="" coords="886,1476,1013,1516"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a87a80f1c19e506a4f3fd3d219fdf55ea" title=" " alt="" coords="661,1800,788,1840"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a6aafd64e5e9b14444d5afe3d18e968e1" title=" " alt="" coords="647,1750,803,1775"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#ab0661abf78b45ccf5c665fbe16bcb4bd" title="Find first element." alt="" coords="661,1635,788,1675"/>
</map>
</div>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_afa017918b1c2efd004b2d39b3aa72cdd_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_afa017918b1c2efd004b2d39b3aa72cdd_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_afa017918b1c2efd004b2d39b3aa72cdd_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_afa017918b1c2efd004b2d39b3aa72cdd_icgraph">
<area shape="rect" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,5,337,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a7239a98428b9d2b50f6372ed1b3cb9e6" title=" " alt="" coords="5,5,120,31"/>
</map>
</div>

</div>
</div>
<a id="ad3644fe506caa0f144d28ff3f65ca1cb" name="ad3644fe506caa0f144d28ff3f65ca1cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3644fe506caa0f144d28ff3f65ca1cb">&#9670;&#160;</a></span>winningRegulations() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const string &amp; winningRegulations </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the winning regulation for each netting set. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00379">379</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  379</span>                                                                                                                       {</div>
<div class="line"><span class="lineno">  380</span>    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; subWinningRegs = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df">winningRegulations</a>(side);</div>
<div class="line"><span class="lineno">  381</span>    QL_REQUIRE(subWinningRegs.find(nettingSetDetails) != subWinningRegs.end(),</div>
<div class="line"><span class="lineno">  382</span>               <span class="stringliteral">&quot;SimmCalculator::winningRegulations(): Could not find netting set in the list of &quot;</span></div>
<div class="line"><span class="lineno">  383</span>                   &lt;&lt; side &lt;&lt; <span class="stringliteral">&quot; IM winning regulations: &quot;</span> &lt;&lt; nettingSetDetails);</div>
<div class="line"><span class="lineno">  384</span>    <span class="keywordflow">return</span> subWinningRegs.at(nettingSetDetails);</div>
<div class="line"><span class="lineno">  385</span>}</div>
</div><!-- fragment --><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_ad3644fe506caa0f144d28ff3f65ca1cb_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_ad3644fe506caa0f144d28ff3f65ca1cb_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_ad3644fe506caa0f144d28ff3f65ca1cb_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_ad3644fe506caa0f144d28ff3f65ca1cb_cgraph">
<area shape="rect" title="Return the winning regulation for each netting set." alt="" coords="5,5,139,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df" title=" " alt="" coords="187,5,320,31"/>
</map>
</div>

</div>
</div>
<a id="a7c411b3c186350a6cf759b4b6306baf6" name="a7c411b3c186350a6cf759b4b6306baf6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c411b3c186350a6cf759b4b6306baf6">&#9670;&#160;</a></span>winningRegulations() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a>, string &gt; &amp; winningRegulations </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00387">387</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  387</span>                                                                                                   {</div>
<div class="line"><span class="lineno">  388</span>    QL_REQUIRE(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">winningRegulations_</a>.find(side) != <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">winningRegulations_</a>.end(),</div>
<div class="line"><span class="lineno">  389</span>               <span class="stringliteral">&quot;SimmCalculator::winningRegulations(): Could not find list of&quot;</span> &lt;&lt; side &lt;&lt; <span class="stringliteral">&quot; IM winning regulations&quot;</span>);</div>
<div class="line"><span class="lineno">  390</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">winningRegulations_</a>.at(side);</div>
<div class="line"><span class="lineno">  391</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a766fc790a5e25235a2083f09f21011df" name="a766fc790a5e25235a2083f09f21011df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a766fc790a5e25235a2083f09f21011df">&#9670;&#160;</a></span>winningRegulations() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a>, string &gt; &gt; &amp; winningRegulations </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00393">393</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  393</span>                                                                                              {</div>
<div class="line"><span class="lineno">  394</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">winningRegulations_</a>;</div>
<div class="line"><span class="lineno">  395</span>}</div>
</div><!-- fragment --><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a766fc790a5e25235a2083f09f21011df_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a766fc790a5e25235a2083f09f21011df_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a766fc790a5e25235a2083f09f21011df_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a766fc790a5e25235a2083f09f21011df_icgraph">
<area shape="rect" title=" " alt="" coords="187,31,320,56"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a7239a98428b9d2b50f6372ed1b3cb9e6" title=" " alt="" coords="15,5,129,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#ad3644fe506caa0f144d28ff3f65ca1cb" title="Return the winning regulation for each netting set." alt="" coords="5,55,139,80"/>
</map>
</div>

</div>
</div>
<a id="a0c484da72c93ba30b8fc72c6fd9d1592" name="a0c484da72c93ba30b8fc72c6fd9d1592"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c484da72c93ba30b8fc72c6fd9d1592">&#9670;&#160;</a></span>simmResults() <span class="overload">[1/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &amp; simmResults </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>regulation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Give back the SIMM results container for the given portfolioId and SIMM side. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00397">397</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  398</span>                                                                               {</div>
<div class="line"><span class="lineno">  399</span>    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; subResults = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a009eb0a808f969304a75263fa81bb9bd">simmResults</a>(side, nettingSetDetails);</div>
<div class="line"><span class="lineno">  400</span>    QL_REQUIRE(subResults.find(regulation) != subResults.end(),</div>
<div class="line"><span class="lineno">  401</span>               <span class="stringliteral">&quot;SimmCalculator::simmResults(): Could not find regulation in the SIMM &quot;</span></div>
<div class="line"><span class="lineno">  402</span>                   &lt;&lt; side &lt;&lt; <span class="stringliteral">&quot; results for netting set [&quot;</span> &lt;&lt; nettingSetDetails &lt;&lt; <span class="stringliteral">&quot;]: &quot;</span> &lt;&lt; regulation);</div>
<div class="line"><span class="lineno">  403</span>    <span class="keywordflow">return</span> subResults.at(regulation);</div>
<div class="line"><span class="lineno">  404</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a009eb0a808f969304a75263fa81bb9bd"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a009eb0a808f969304a75263fa81bb9bd">ore::analytics::SimmCalculator::simmResults</a></div><div class="ttdeci">const std::map&lt; SimmSide, std::map&lt; ore::data::NettingSetDetails, std::map&lt; std::string, SimmResults &gt; &gt; &gt; &amp; simmResults() const</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l00421">simmcalculator.cpp:421</a></div></div>
</div><!-- fragment --><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a0c484da72c93ba30b8fc72c6fd9d1592_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a0c484da72c93ba30b8fc72c6fd9d1592_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a0c484da72c93ba30b8fc72c6fd9d1592_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a0c484da72c93ba30b8fc72c6fd9d1592_cgraph">
<area shape="rect" title="Give back the SIMM results container for the given portfolioId and SIMM side." alt="" coords="5,5,104,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a009eb0a808f969304a75263fa81bb9bd" title=" " alt="" coords="152,5,251,31"/>
</map>
</div>

</div>
</div>
<a id="ad065784b3b3ce4b3a6eb8c73b8a6ba76" name="ad065784b3b3ce4b3a6eb8c73b8a6ba76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad065784b3b3ce4b3a6eb8c73b8a6ba76">&#9670;&#160;</a></span>simmResults() <span class="overload">[2/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const map&lt; string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &amp; simmResults </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00406">406</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  407</span>                                                                                                              {</div>
<div class="line"><span class="lineno">  408</span>    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; subResults = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a009eb0a808f969304a75263fa81bb9bd">simmResults</a>(side);</div>
<div class="line"><span class="lineno">  409</span>    QL_REQUIRE(subResults.find(nettingSetDetails) != subResults.end(),</div>
<div class="line"><span class="lineno">  410</span>               <span class="stringliteral">&quot;SimmCalculator::simmResults(): Could not find netting set in the SIMM &quot;</span></div>
<div class="line"><span class="lineno">  411</span>                   &lt;&lt; side &lt;&lt; <span class="stringliteral">&quot; results: &quot;</span> &lt;&lt; nettingSetDetails);</div>
<div class="line"><span class="lineno">  412</span>    <span class="keywordflow">return</span> subResults.at(nettingSetDetails);</div>
<div class="line"><span class="lineno">  413</span>}</div>
</div><!-- fragment --><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_ad065784b3b3ce4b3a6eb8c73b8a6ba76_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_ad065784b3b3ce4b3a6eb8c73b8a6ba76_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_ad065784b3b3ce4b3a6eb8c73b8a6ba76_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_ad065784b3b3ce4b3a6eb8c73b8a6ba76_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,104,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a009eb0a808f969304a75263fa81bb9bd" title=" " alt="" coords="152,5,251,31"/>
</map>
</div>

</div>
</div>
<a id="a043645c8f888e4793f5551c56cfda568" name="a043645c8f888e4793f5551c56cfda568"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a043645c8f888e4793f5551c56cfda568">&#9670;&#160;</a></span>simmResults() <span class="overload">[3/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a>, map&lt; string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &amp; simmResults </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Give back a map containing the SIMM results containers for every portfolio for the given SIMM <code>side</code>. The key is the portfolio ID and the value is the SIMM results container for that portfolio. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00415">415</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  415</span>                                                                                                              {</div>
<div class="line"><span class="lineno">  416</span>    QL_REQUIRE(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a>.find(side) != <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a>.end(),</div>
<div class="line"><span class="lineno">  417</span>               <span class="stringliteral">&quot;SimmCalculator::simmResults(): Could not find &quot;</span> &lt;&lt; side &lt;&lt; <span class="stringliteral">&quot; IM in the SIMM results&quot;</span>);</div>
<div class="line"><span class="lineno">  418</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a>.at(side);</div>
<div class="line"><span class="lineno">  419</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a009eb0a808f969304a75263fa81bb9bd" name="a009eb0a808f969304a75263fa81bb9bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a009eb0a808f969304a75263fa81bb9bd">&#9670;&#160;</a></span>simmResults() <span class="overload">[4/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a>, map&lt; string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &gt; &amp; simmResults </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00421">421</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  421</span>                                                                                                         {</div>
<div class="line"><span class="lineno">  422</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a>;</div>
<div class="line"><span class="lineno">  423</span>}</div>
</div><!-- fragment --><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a009eb0a808f969304a75263fa81bb9bd_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a009eb0a808f969304a75263fa81bb9bd_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a009eb0a808f969304a75263fa81bb9bd_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a009eb0a808f969304a75263fa81bb9bd_icgraph">
<area shape="rect" title=" " alt="" coords="152,5,251,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a0c484da72c93ba30b8fc72c6fd9d1592" title="Give back the SIMM results container for the given portfolioId and SIMM side." alt="" coords="5,5,104,31"/>
</map>
</div>

</div>
</div>
<a id="ab7d138db5520d1b264060701b4dafed0" name="ab7d138db5520d1b264060701b4dafed0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7d138db5520d1b264060701b4dafed0">&#9670;&#160;</a></span>finalSimmResults() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const pair&lt; string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &amp; finalSimmResults </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Give back the SIMM results container for the given netting set and SIMM side. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00425">425</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  426</span>                                                                                                                    {</div>
<div class="line"><span class="lineno">  427</span>    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; subResults = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a892df1a5c65ab07fefdc01d5c057ad66">finalSimmResults</a>(side);</div>
<div class="line"><span class="lineno">  428</span>    QL_REQUIRE(subResults.find(nettingSetDetails) != subResults.end(),</div>
<div class="line"><span class="lineno">  429</span>               <span class="stringliteral">&quot;SimmCalculator::finalSimmResults(): Could not find netting set in the final SIMM &quot;</span></div>
<div class="line"><span class="lineno">  430</span>                   &lt;&lt; side &lt;&lt; <span class="stringliteral">&quot; results: &quot;</span> &lt;&lt; nettingSetDetails);</div>
<div class="line"><span class="lineno">  431</span>    <span class="keywordflow">return</span> subResults.at(nettingSetDetails);</div>
<div class="line"><span class="lineno">  432</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a892df1a5c65ab07fefdc01d5c057ad66"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a892df1a5c65ab07fefdc01d5c057ad66">ore::analytics::SimmCalculator::finalSimmResults</a></div><div class="ttdeci">const std::map&lt; SimmSide, std::map&lt; ore::data::NettingSetDetails, std::pair&lt; std::string, SimmResults &gt; &gt; &gt; &amp; finalSimmResults() const</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l00440">simmcalculator.cpp:440</a></div></div>
</div><!-- fragment --><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_ab7d138db5520d1b264060701b4dafed0_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_ab7d138db5520d1b264060701b4dafed0_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_ab7d138db5520d1b264060701b4dafed0_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_ab7d138db5520d1b264060701b4dafed0_cgraph">
<area shape="rect" title="Give back the SIMM results container for the given netting set and SIMM side." alt="" coords="5,5,128,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a892df1a5c65ab07fefdc01d5c057ad66" title=" " alt="" coords="176,5,299,31"/>
</map>
</div>

</div>
</div>
<a id="a1e3384043ef38de3c8a063d6bcb134f2" name="a1e3384043ef38de3c8a063d6bcb134f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e3384043ef38de3c8a063d6bcb134f2">&#9670;&#160;</a></span>finalSimmResults() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a>, pair&lt; string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &amp; finalSimmResults </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Give back a map containing the SIMM results containers for every portfolio for the given SIMM <code>side</code>. The key is the portfolio ID and the value is a map, with regulation as the key, and the value is the SIMM results container for that portfolioId-regulation combination. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00434">434</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  434</span>                                                                                                                    {</div>
<div class="line"><span class="lineno">  435</span>    QL_REQUIRE(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa86bb7338b370ccfabfd1b6d218a5fb8">finalSimmResults_</a>.find(side) != <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa86bb7338b370ccfabfd1b6d218a5fb8">finalSimmResults_</a>.end(),</div>
<div class="line"><span class="lineno">  436</span>               <span class="stringliteral">&quot;SimmCalculator::finalSimmResults(): Could not find &quot;</span> &lt;&lt; side &lt;&lt; <span class="stringliteral">&quot; IM in the final SIMM results&quot;</span>);</div>
<div class="line"><span class="lineno">  437</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa86bb7338b370ccfabfd1b6d218a5fb8">finalSimmResults_</a>.at(side);</div>
<div class="line"><span class="lineno">  438</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_aa86bb7338b370ccfabfd1b6d218a5fb8"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#aa86bb7338b370ccfabfd1b6d218a5fb8">ore::analytics::SimmCalculator::finalSimmResults_</a></div><div class="ttdeci">std::map&lt; SimmSide, std::map&lt; ore::data::NettingSetDetails, std::pair&lt; std::string, SimmResults &gt; &gt; &gt; finalSimmResults_</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00157">simmcalculator.hpp:157</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a892df1a5c65ab07fefdc01d5c057ad66" name="a892df1a5c65ab07fefdc01d5c057ad66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a892df1a5c65ab07fefdc01d5c057ad66">&#9670;&#160;</a></span>finalSimmResults() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a>, pair&lt; string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &gt; &amp; finalSimmResults </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00440">440</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  440</span>                                                                                                               {</div>
<div class="line"><span class="lineno">  441</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa86bb7338b370ccfabfd1b6d218a5fb8">finalSimmResults_</a>;</div>
<div class="line"><span class="lineno">  442</span>}</div>
</div><!-- fragment --><div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a892df1a5c65ab07fefdc01d5c057ad66_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a892df1a5c65ab07fefdc01d5c057ad66_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a892df1a5c65ab07fefdc01d5c057ad66_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a892df1a5c65ab07fefdc01d5c057ad66_icgraph">
<area shape="rect" title=" " alt="" coords="176,5,299,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#ab7d138db5520d1b264060701b4dafed0" title="Give back the SIMM results container for the given netting set and SIMM side." alt="" coords="5,5,128,31"/>
</map>
</div>

</div>
</div>
<a id="ade8361772c3783f383ab208f3a9cd73f" name="ade8361772c3783f383ab208f3a9cd73f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade8361772c3783f383ab208f3a9cd73f">&#9670;&#160;</a></span>finalTradeIds()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::set&lt; std::string &gt; &gt; &amp; finalTradeIds </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00093">93</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   93</span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#acf6d3f08c36da850265818577b6c5111">finalTradeIds_</a>; }</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_acf6d3f08c36da850265818577b6c5111"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#acf6d3f08c36da850265818577b6c5111">ore::analytics::SimmCalculator::finalTradeIds_</a></div><div class="ttdeci">std::map&lt; SimmSide, set&lt; string &gt; &gt; finalTradeIds_</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00163">simmcalculator.hpp:163</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a09beb8b7b0880f0fa8dad84d5f41f9f0" name="a09beb8b7b0880f0fa8dad84d5f41f9f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09beb8b7b0880f0fa8dad84d5f41f9f0">&#9670;&#160;</a></span>simmParameters()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classore_1_1analytics_1_1_crif.html">Crif</a> &amp; simmParameters </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00095">95</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   95</span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a827b948d9bcabe9d9f34d1e67edfd3ef">simmParameters_</a>; }</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a827b948d9bcabe9d9f34d1e67edfd3ef"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a827b948d9bcabe9d9f34d1e67edfd3ef">ore::analytics::SimmCalculator::simmParameters_</a></div><div class="ttdeci">ore::analytics::Crif simmParameters_</div><div class="ttdoc">Record of SIMM parameters that were used in the calculation.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00118">simmcalculator.hpp:118</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aced20a99d69557420e807dd3d0a9b0d8" name="aced20a99d69557420e807dd3d0a9b0d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aced20a99d69557420e807dd3d0a9b0d8">&#9670;&#160;</a></span>calculationCurrency()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::string &amp; calculationCurrency </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the calculator's calculation currency. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00098">98</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   98</span>                                                                     {</div>
<div class="line"><span class="lineno">   99</span>        <span class="keywordflow">return</span> side == SimmSide::Call ? <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a3c2fc9fbb2d2df2e4a97152bde680460">calculationCcyCall_</a> : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abc16565c54ac283038b1e2114635cd43">calculationCcyPost_</a>;</div>
<div class="line"><span class="lineno">  100</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a957d4a9347f400dc03534f2c4ae9975a" name="a957d4a9347f400dc03534f2c4ae9975a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a957d4a9347f400dc03534f2c4ae9975a">&#9670;&#160;</a></span>resultCurrency()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::string &amp; resultCurrency </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the calculator's result currency. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00103">103</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  103</span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa936c119f6230d0eed00b790981bef02" name="aa936c119f6230d0eed00b790981bef02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa936c119f6230d0eed00b790981bef02">&#9670;&#160;</a></span>populateFinalResults() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void populateFinalResults </td>
          <td>(</td>
          <td class="paramtype">const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::string &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>winningRegulations</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Populate the finalSimmResults_ and finalAddMargins_ containers using the provided map of winning call/post regulations. </p>

</div>
</div>
<a id="a2f30844efa1be083cc9096e5eb411454" name="a2f30844efa1be083cc9096e5eb411454"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f30844efa1be083cc9096e5eb411454">&#9670;&#160;</a></span>irDeltaMargin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pair&lt; map&lt; string, Real &gt;, <a class="el" href="classbool.html">bool</a> &gt; irDeltaMargin </td>
          <td>(</td>
          <td class="paramtype">const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;&#160;</td>
          <td class="paramname"><em>netRecords</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the Interest Rate delta margin component for the given portfolio and product class. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00444">444</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  446</span>                                                                                        {</div>
<div class="line"><span class="lineno">  447</span>    <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; calcCcy = side == SimmSide::Call ? <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a3c2fc9fbb2d2df2e4a97152bde680460">calculationCcyCall_</a> : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abc16565c54ac283038b1e2114635cd43">calculationCcyPost_</a>;</div>
<div class="line"><span class="lineno">  448</span> </div>
<div class="line"><span class="lineno">  449</span>    <span class="comment">// &quot;Bucket&quot; here referse to exposures under the CRIF qualifiers</span></div>
<div class="line"><span class="lineno">  450</span>    map&lt;string, Real&gt; bucketMargins;</div>
<div class="line"><span class="lineno">  451</span> </div>
<div class="line"><span class="lineno">  452</span>    <span class="comment">// Get alls IR qualifiers</span></div>
<div class="line"><span class="lineno">  453</span>    set&lt;string&gt; qualifiers =</div>
<div class="line"><span class="lineno">  454</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a1d2bc2fd582f6814002e27b00b6d4853">getQualifiers</a>(crif, nettingSetDetails, pc, {RiskType::IRCurve, RiskType::XCcyBasis, RiskType::Inflation});</div>
<div class="line"><span class="lineno">  455</span> </div>
<div class="line"><span class="lineno">  456</span>    <span class="comment">// If there are no qualifiers, return early and set bool to false to indicate margin does not apply</span></div>
<div class="line"><span class="lineno">  457</span>    <span class="keywordflow">if</span> (qualifiers.empty()) {</div>
<div class="line"><span class="lineno">  458</span>        bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = 0.0;</div>
<div class="line"><span class="lineno">  459</span>        <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  460</span>    }</div>
<div class="line"><span class="lineno">  461</span> </div>
<div class="line"><span class="lineno">  462</span>    <span class="comment">// Hold the concentration risk for each qualifier i.e. $CR_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  463</span>    map&lt;string, Real&gt; concentrationRisk;</div>
<div class="line"><span class="lineno">  464</span>    <span class="comment">// The delta margin for each currency i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  465</span>    map&lt;string, Real&gt; deltaMargin;</div>
<div class="line"><span class="lineno">  466</span>    <span class="comment">// The sum of the weighted sensitivities for each currency i.e. $\sum_{i,k} WS_{k,i}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  467</span>    map&lt;string, Real&gt; sumWeightedSensis;</div>
<div class="line"><span class="lineno">  468</span> </div>
<div class="line"><span class="lineno">  469</span>    <span class="comment">// Loop over the qualifiers i.e. currencies</span></div>
<div class="line"><span class="lineno">  470</span>    <span class="comment">// Loop over the qualifiers i.e. currencies</span></div>
<div class="line"><span class="lineno">  471</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; qualifier : qualifiers) {</div>
<div class="line"><span class="lineno">  472</span>        <span class="comment">// Pair of iterators to start and end of IRCurve sensitivities with current qualifier</span></div>
<div class="line"><span class="lineno">  473</span>        <span class="keyword">auto</span> pIrQualifier =</div>
<div class="line"><span class="lineno">  474</span>            crif.filterByQualifier(nettingSetDetails, pc, RiskType::IRCurve, qualifier);</div>
<div class="line"><span class="lineno">  475</span> </div>
<div class="line"><span class="lineno">  476</span>        <span class="comment">// Iterator to Xccy basis element with current qualifier (expect zero or one element)</span></div>
<div class="line"><span class="lineno">  477</span>        <span class="keyword">auto</span> XccyCount = crif.countMatching(nettingSetDetails, pc, RiskType::XCcyBasis, qualifier);</div>
<div class="line"><span class="lineno">  478</span>        QL_REQUIRE(XccyCount &lt; 2, <span class="stringliteral">&quot;SIMM Calcuator: Expected either 0 or 1 elements for risk type &quot;</span></div>
<div class="line"><span class="lineno">  479</span>                                      &lt;&lt; RiskType::XCcyBasis &lt;&lt; <span class="stringliteral">&quot; and qualifier &quot;</span> &lt;&lt; qualifier &lt;&lt; <span class="stringliteral">&quot; but got &quot;</span></div>
<div class="line"><span class="lineno">  480</span>                                      &lt;&lt; XccyCount);</div>
<div class="line"><span class="lineno">  481</span>        <span class="keyword">auto</span> itXccy = crif.findBy(nettingSetDetails, pc, RiskType::XCcyBasis, qualifier);</div>
<div class="line"><span class="lineno">  482</span> </div>
<div class="line"><span class="lineno">  483</span>        <span class="comment">// Iterator to inflation element with current qualifier (expect zero or one element)</span></div>
<div class="line"><span class="lineno">  484</span>        <span class="keyword">auto</span> inflationCount = crif.countMatching(nettingSetDetails, pc, RiskType::Inflation, qualifier);</div>
<div class="line"><span class="lineno">  485</span>        QL_REQUIRE(inflationCount &lt; 2, <span class="stringliteral">&quot;SIMM Calculator: Expected either 0 or 1 elements for risk type &quot;</span></div>
<div class="line"><span class="lineno">  486</span>                                           &lt;&lt; RiskType::Inflation &lt;&lt; <span class="stringliteral">&quot; and qualifier &quot;</span> &lt;&lt; qualifier &lt;&lt; <span class="stringliteral">&quot; but got &quot;</span></div>
<div class="line"><span class="lineno">  487</span>                                           &lt;&lt; inflationCount);</div>
<div class="line"><span class="lineno">  488</span>        <span class="keyword">auto</span> itInflation = crif.findBy(nettingSetDetails, pc, RiskType::Inflation, qualifier);</div>
<div class="line"><span class="lineno">  489</span> </div>
<div class="line"><span class="lineno">  490</span>        <span class="comment">// One pass to get the concentration risk for this qualifier</span></div>
<div class="line"><span class="lineno">  491</span>        <span class="comment">// Note: XccyBasis is not included in the calculation of concentration risk and the XccyBasis sensitivity</span></div>
<div class="line"><span class="lineno">  492</span>        <span class="comment">//       is not scaled by it</span></div>
<div class="line"><span class="lineno">  493</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; it : pIrQualifier) {</div>
<div class="line"><span class="lineno">  494</span>            concentrationRisk[qualifier] += it.amountResultCcy;</div>
<div class="line"><span class="lineno">  495</span>        }</div>
<div class="line"><span class="lineno">  496</span>        <span class="comment">// Add inflation sensitivity to the concentration risk</span></div>
<div class="line"><span class="lineno">  497</span>        <span class="keywordflow">if</span> (itInflation != crif.end()){</div>
<div class="line"><span class="lineno">  498</span>            concentrationRisk[qualifier] += itInflation-&gt;amountResultCcy;</div>
<div class="line"><span class="lineno">  499</span>        }</div>
<div class="line"><span class="lineno">  500</span>        <span class="comment">// Divide by the concentration risk threshold</span></div>
<div class="line"><span class="lineno">  501</span>        Real concThreshold = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;concentrationThreshold(RiskType::IRCurve, qualifier);</div>
<div class="line"><span class="lineno">  502</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a> != <span class="stringliteral">&quot;USD&quot;</span>)</div>
<div class="line"><span class="lineno">  503</span>            concThreshold *= <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa14f759693736cf0438f0e6ff1a792fe">market_</a>-&gt;fxRate(<span class="stringliteral">&quot;USD&quot;</span> + <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a>)-&gt;value();</div>
<div class="line"><span class="lineno">  504</span>        concentrationRisk[qualifier] /= concThreshold;</div>
<div class="line"><span class="lineno">  505</span>        <span class="comment">// Final concentration risk amount</span></div>
<div class="line"><span class="lineno">  506</span>        concentrationRisk[qualifier] = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(1.0, <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(std::abs(concentrationRisk[qualifier])));</div>
<div class="line"><span class="lineno">  507</span> </div>
<div class="line"><span class="lineno">  508</span>        <span class="comment">// Calculate the delta margin piece for this qualifier i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  509</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = pIrQualifier.begin(); itOuter != pIrQualifier.end(); ++itOuter) {</div>
<div class="line"><span class="lineno">  510</span>            <span class="comment">// Risk weight i.e. $RW_k$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  511</span>            Real rwOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;weight(RiskType::IRCurve, qualifier, itOuter-&gt;label1);</div>
<div class="line"><span class="lineno">  512</span>            <span class="comment">// Weighted sensitivity i.e. $WS_{k,i}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  513</span>            Real wsOuter = rwOuter * itOuter-&gt;amountResultCcy * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  514</span>            <span class="comment">// Update weighted sensitivity sum</span></div>
<div class="line"><span class="lineno">  515</span>            sumWeightedSensis[qualifier] += wsOuter;</div>
<div class="line"><span class="lineno">  516</span>            <span class="comment">// Add diagonal element to delta margin</span></div>
<div class="line"><span class="lineno">  517</span>            deltaMargin[qualifier] += wsOuter * wsOuter;</div>
<div class="line"><span class="lineno">  518</span>            <span class="comment">// Add the cross elements to the delta margin</span></div>
<div class="line"><span class="lineno">  519</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = pIrQualifier.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno">  520</span>                <span class="comment">// Label2 level correlation i.e. $\phi_{i,j}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  521</span>                Real subCurveCorr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(RiskType::IRCurve, qualifier, <span class="stringliteral">&quot;&quot;</span>, itOuter-&gt;label2,</div>
<div class="line"><span class="lineno">  522</span>                                                                    RiskType::IRCurve, qualifier, <span class="stringliteral">&quot;&quot;</span>, itInner-&gt;label2);</div>
<div class="line"><span class="lineno">  523</span>                <span class="comment">// Label1 level correlation i.e. $\rho_{k,l}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  524</span>                Real tenorCorr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(RiskType::IRCurve, qualifier, itOuter-&gt;label1, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">  525</span>                                                                 RiskType::IRCurve, qualifier, itInner-&gt;label1, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  526</span>                <span class="comment">// Add cross element to delta margin</span></div>
<div class="line"><span class="lineno">  527</span>                Real rwInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;weight(RiskType::IRCurve, qualifier, itInner-&gt;label1);</div>
<div class="line"><span class="lineno">  528</span>                Real wsInner = rwInner * itInner-&gt;amountResultCcy * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  529</span>                deltaMargin[qualifier] += 2 * subCurveCorr * tenorCorr * wsOuter * wsInner;</div>
<div class="line"><span class="lineno">  530</span>            }</div>
<div class="line"><span class="lineno">  531</span>        }</div>
<div class="line"><span class="lineno">  532</span> </div>
<div class="line"><span class="lineno">  533</span>        <span class="comment">// Add the Inflation component, if any</span></div>
<div class="line"><span class="lineno">  534</span>        Real wsInflation = 0.0;</div>
<div class="line"><span class="lineno">  535</span>        <span class="keywordflow">if</span> (itInflation != crif.end()) {</div>
<div class="line"><span class="lineno">  536</span>            <span class="comment">// Risk weight</span></div>
<div class="line"><span class="lineno">  537</span>            Real rwInflation = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;weight(RiskType::Inflation, qualifier, itInflation-&gt;label1);</div>
<div class="line"><span class="lineno">  538</span>            <span class="comment">// Weighted sensitivity</span></div>
<div class="line"><span class="lineno">  539</span>            wsInflation = rwInflation * itInflation-&gt;amountResultCcy * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  540</span>            <span class="comment">// Update weighted sensitivity sum</span></div>
<div class="line"><span class="lineno">  541</span>            sumWeightedSensis[qualifier] += wsInflation;</div>
<div class="line"><span class="lineno">  542</span>            <span class="comment">// Add diagonal element to delta margin</span></div>
<div class="line"><span class="lineno">  543</span>            deltaMargin[qualifier] += wsInflation * wsInflation;</div>
<div class="line"><span class="lineno">  544</span>            <span class="comment">// Add the cross elements (Inflation with IRCurve tenors) to the delta margin</span></div>
<div class="line"><span class="lineno">  545</span>            <span class="comment">// Correlation (know that Label1 and Label2 do not matter)</span></div>
<div class="line"><span class="lineno">  546</span>            Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(RiskType::IRCurve, qualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, RiskType::Inflation,</div>
<div class="line"><span class="lineno">  547</span>                                                        qualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  548</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = pIrQualifier.begin(); it != pIrQualifier.end(); ++it) {</div>
<div class="line"><span class="lineno">  549</span>                <span class="comment">// Add cross element to delta margin</span></div>
<div class="line"><span class="lineno">  550</span>                Real rw = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;weight(RiskType::IRCurve, qualifier, it-&gt;label1);</div>
<div class="line"><span class="lineno">  551</span>                Real ws = rw * it-&gt;amountResultCcy * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  552</span>                deltaMargin[qualifier] += 2 * corr * ws * wsInflation;</div>
<div class="line"><span class="lineno">  553</span>            }</div>
<div class="line"><span class="lineno">  554</span>        }</div>
<div class="line"><span class="lineno">  555</span> </div>
<div class="line"><span class="lineno">  556</span>        <span class="comment">// Add the XccyBasis component, if any</span></div>
<div class="line"><span class="lineno">  557</span>        <span class="keywordflow">if</span> (itXccy != crif.end()) {</div>
<div class="line"><span class="lineno">  558</span>            <span class="comment">// Risk weight</span></div>
<div class="line"><span class="lineno">  559</span>            Real rwXccy = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;weight(RiskType::XCcyBasis, qualifier, itXccy-&gt;label1);</div>
<div class="line"><span class="lineno">  560</span>            <span class="comment">// Weighted sensitivity (no concentration risk here)</span></div>
<div class="line"><span class="lineno">  561</span>            Real wsXccy = rwXccy * itXccy-&gt;amountResultCcy;</div>
<div class="line"><span class="lineno">  562</span>            <span class="comment">// Update weighted sensitivity sum</span></div>
<div class="line"><span class="lineno">  563</span>            sumWeightedSensis[qualifier] += wsXccy;</div>
<div class="line"><span class="lineno">  564</span>            <span class="comment">// Add diagonal element to delta margin</span></div>
<div class="line"><span class="lineno">  565</span>            deltaMargin[qualifier] += wsXccy * wsXccy;</div>
<div class="line"><span class="lineno">  566</span>            <span class="comment">// Add the cross elements (XccyBasis with IRCurve tenors) to the delta margin</span></div>
<div class="line"><span class="lineno">  567</span>            <span class="comment">// Correlation (know that Label1 and Label2 do not matter)</span></div>
<div class="line"><span class="lineno">  568</span>            Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(RiskType::IRCurve, qualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, RiskType::XCcyBasis,</div>
<div class="line"><span class="lineno">  569</span>                                                        qualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  570</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = pIrQualifier.begin(); it != pIrQualifier.end(); ++it) {</div>
<div class="line"><span class="lineno">  571</span>                <span class="comment">// Add cross element to delta margin</span></div>
<div class="line"><span class="lineno">  572</span>                Real rw = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;weight(RiskType::IRCurve, qualifier, it-&gt;label1, calcCcy);</div>
<div class="line"><span class="lineno">  573</span>                Real ws = rw * it-&gt;amountResultCcy * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  574</span>                deltaMargin[qualifier] += 2 * corr * ws * wsXccy;</div>
<div class="line"><span class="lineno">  575</span>            }</div>
<div class="line"><span class="lineno">  576</span> </div>
<div class="line"><span class="lineno">  577</span>            <span class="comment">// Inflation vs. XccyBasis cross component if any</span></div>
<div class="line"><span class="lineno">  578</span>            <span class="keywordflow">if</span> (itInflation != crif.end()) {</div>
<div class="line"><span class="lineno">  579</span>                <span class="comment">// Correlation (know that Label1 and Label2 do not matter)</span></div>
<div class="line"><span class="lineno">  580</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(RiskType::Inflation, qualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, RiskType::XCcyBasis,</div>
<div class="line"><span class="lineno">  581</span>                                                            qualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  582</span>                deltaMargin[qualifier] += 2 * corr * wsInflation * wsXccy;</div>
<div class="line"><span class="lineno">  583</span>            }</div>
<div class="line"><span class="lineno">  584</span>        }</div>
<div class="line"><span class="lineno">  585</span> </div>
<div class="line"><span class="lineno">  586</span>        <span class="comment">// Finally have the value of $K_b$</span></div>
<div class="line"><span class="lineno">  587</span>        deltaMargin[qualifier] = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(deltaMargin[qualifier], 0.0));</div>
<div class="line"><span class="lineno">  588</span>    }</div>
<div class="line"><span class="lineno">  589</span> </div>
<div class="line"><span class="lineno">  590</span>    <span class="comment">// Now calculate final IR delta margin by aggregating across currencies</span></div>
<div class="line"><span class="lineno">  591</span>    Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> = 0.0;</div>
<div class="line"><span class="lineno">  592</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = qualifiers.begin(); itOuter != qualifiers.end(); ++itOuter) {</div>
<div class="line"><span class="lineno">  593</span>        <span class="comment">// Diagonal term</span></div>
<div class="line"><span class="lineno">  594</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += deltaMargin.at(*itOuter) * deltaMargin.at(*itOuter);</div>
<div class="line"><span class="lineno">  595</span>        <span class="comment">// Cross terms</span></div>
<div class="line"><span class="lineno">  596</span>        Real sOuter = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(sumWeightedSensis.at(*itOuter), deltaMargin.at(*itOuter)), -deltaMargin.at(*itOuter));</div>
<div class="line"><span class="lineno">  597</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = qualifiers.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno">  598</span>            Real sInner = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(sumWeightedSensis.at(*itInner), deltaMargin.at(*itInner)), -deltaMargin.at(*itInner));</div>
<div class="line"><span class="lineno">  599</span>            Real g = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(concentrationRisk.at(*itOuter), concentrationRisk.at(*itInner)) /</div>
<div class="line"><span class="lineno">  600</span>                     <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(concentrationRisk.at(*itOuter), concentrationRisk.at(*itInner));</div>
<div class="line"><span class="lineno">  601</span>            Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(RiskType::IRCurve, *itOuter, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, RiskType::IRCurve,</div>
<div class="line"><span class="lineno">  602</span>                                                        *itInner, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  603</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += 2.0 * sOuter * sInner * corr * g;</div>
<div class="line"><span class="lineno">  604</span>        }</div>
<div class="line"><span class="lineno">  605</span>    }</div>
<div class="line"><span class="lineno">  606</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>, 0.0));</div>
<div class="line"><span class="lineno">  607</span> </div>
<div class="line"><span class="lineno">  608</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; m : deltaMargin)</div>
<div class="line"><span class="lineno">  609</span>        bucketMargins[m.first] = m.second;</div>
<div class="line"><span class="lineno">  610</span>    bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>;</div>
<div class="line"><span class="lineno">  611</span> </div>
<div class="line"><span class="lineno">  612</span>    <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  613</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a1d2bc2fd582f6814002e27b00b6d4853"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a1d2bc2fd582f6814002e27b00b6d4853">ore::analytics::SimmCalculator::getQualifiers</a></div><div class="ttdeci">std::set&lt; std::string &gt; getQualifiers(const Crif &amp;crif, const ore::data::NettingSetDetails &amp;nettingSetDetails, const CrifRecord::ProductClass &amp;pc, const std::vector&lt; CrifRecord::RiskType &gt; &amp;riskTypes) const</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l01667">simmcalculator.cpp:1667</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_a0780e43df89be3d7f7671eca2418cdd1"><div class="ttname"><a href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a></div><div class="ttdeci">RandomVariable max(RandomVariable x, const RandomVariable &amp;y)</div></div>
<div class="ttc" id="anamespace_quant_ext_html_a1b4a64a3620f987e65fec4ccf7cadcf2"><div class="ttname"><a href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a></div><div class="ttdeci">RandomVariable sqrt(RandomVariable x)</div></div>
<div class="ttc" id="anamespace_quant_ext_html_afe4df8f9c3657399dd532e1d3c895dfa"><div class="ttname"><a href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a></div><div class="ttdeci">RandomVariable min(RandomVariable x, const RandomVariable &amp;y)</div></div>
</div><!-- fragment --><div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a2f30844efa1be083cc9096e5eb411454_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a2f30844efa1be083cc9096e5eb411454_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a2f30844efa1be083cc9096e5eb411454_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a2f30844efa1be083cc9096e5eb411454_cgraph">
<area shape="rect" title="Calculate the Interest Rate delta margin component for the given portfolio and product class." alt="" coords="5,249,104,274"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a87a80f1c19e506a4f3fd3d219fdf55ea" title=" " alt="" coords="167,5,293,45"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a6aafd64e5e9b14444d5afe3d18e968e1" title=" " alt="" coords="152,70,308,95"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a273f66b7ccd20b924ca6eef153e59a13" title=" " alt="" coords="167,120,293,160"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#ab0661abf78b45ccf5c665fbe16bcb4bd" title="Find first element." alt="" coords="167,184,293,224"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a1d2bc2fd582f6814002e27b00b6d4853" title=" " alt="" coords="183,249,277,274"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa" title=" " alt="" coords="199,374,261,399"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1" title=" " alt="" coords="396,267,443,293"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa" title=" " alt="" coords="398,431,441,457"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2" title=" " alt="" coords="397,481,441,506"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a19aa28193073c2c75dd9f1e214054d7d" title=" " alt="" coords="356,203,483,243"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5" title=" " alt="" coords="368,317,471,342"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#ae60c8d5d49613f14cf237899570ac854" title=" " alt="" coords="356,367,483,407"/>
</map>
</div>
<div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a2f30844efa1be083cc9096e5eb411454_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a2f30844efa1be083cc9096e5eb411454_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a2f30844efa1be083cc9096e5eb411454_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a2f30844efa1be083cc9096e5eb411454_icgraph">
<area shape="rect" title="Calculate the Interest Rate delta margin component for the given portfolio and product class." alt="" coords="385,5,484,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#afa017918b1c2efd004b2d39b3aa72cdd" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,5,337,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a7239a98428b9d2b50f6372ed1b3cb9e6" title=" " alt="" coords="5,5,120,31"/>
</map>
</div>

</div>
</div>
<a id="a40608992cde449b98628de2df0eff046" name="a40608992cde449b98628de2df0eff046"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40608992cde449b98628de2df0eff046">&#9670;&#160;</a></span>irVegaMargin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pair&lt; map&lt; string, Real &gt;, <a class="el" href="classbool.html">bool</a> &gt; irVegaMargin </td>
          <td>(</td>
          <td class="paramtype">const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;&#160;</td>
          <td class="paramname"><em>netRecords</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the Interest Rate vega margin component for the given portfolio and product class. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00615">615</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  617</span>                                                                                       {</div>
<div class="line"><span class="lineno">  618</span> </div>
<div class="line"><span class="lineno">  619</span>    <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; calcCcy = side == SimmSide::Call ? <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a3c2fc9fbb2d2df2e4a97152bde680460">calculationCcyCall_</a> : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abc16565c54ac283038b1e2114635cd43">calculationCcyPost_</a>;</div>
<div class="line"><span class="lineno">  620</span> </div>
<div class="line"><span class="lineno">  621</span>    <span class="comment">// &quot;Bucket&quot; here refers to exposures under the CRIF qualifiers</span></div>
<div class="line"><span class="lineno">  622</span>    map&lt;string, Real&gt; bucketMargins;</div>
<div class="line"><span class="lineno">  623</span> </div>
<div class="line"><span class="lineno">  624</span>    <span class="comment">// Find the set of qualifiers, i.e. currencies, in the Simm sensitivities</span></div>
<div class="line"><span class="lineno">  625</span>    set&lt;string&gt; qualifiers = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a1d2bc2fd582f6814002e27b00b6d4853">getQualifiers</a>(crif, nettingSetDetails, pc, {RiskType::IRVol, RiskType::InflationVol});</div>
<div class="line"><span class="lineno">  626</span> </div>
<div class="line"><span class="lineno">  627</span>    <span class="comment">// If there are no qualifiers, return early and set bool to false to indicate margin does not apply</span></div>
<div class="line"><span class="lineno">  628</span>    <span class="keywordflow">if</span> (qualifiers.empty()) {</div>
<div class="line"><span class="lineno">  629</span>        bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = 0.0;</div>
<div class="line"><span class="lineno">  630</span>        <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  631</span>    }</div>
<div class="line"><span class="lineno">  632</span> </div>
<div class="line"><span class="lineno">  633</span>    <span class="comment">// Hold the concentration risk for each qualifier i.e. $VCR_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  634</span>    map&lt;string, Real&gt; concentrationRisk;</div>
<div class="line"><span class="lineno">  635</span>    <span class="comment">// The vega margin for each currency i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  636</span>    map&lt;string, Real&gt; vegaMargin;</div>
<div class="line"><span class="lineno">  637</span>    <span class="comment">// The sum of the weighted sensitivities for each currency i.e. $\sum_{k=1}^K VR_{k}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  638</span>    map&lt;string, Real&gt; sumWeightedSensis;</div>
<div class="line"><span class="lineno">  639</span> </div>
<div class="line"><span class="lineno">  640</span>    <span class="comment">// Loop over the qualifiers i.e. currencies</span></div>
<div class="line"><span class="lineno">  641</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; qualifier : qualifiers) {</div>
<div class="line"><span class="lineno">  642</span>        <span class="comment">// Pair of iterators to start and end of IRVol sensitivities with current qualifier</span></div>
<div class="line"><span class="lineno">  643</span>        <span class="keyword">auto</span> pIrQualifier = crif.filterByQualifier(nettingSetDetails, pc, RiskType::IRVol, qualifier);</div>
<div class="line"><span class="lineno">  644</span> </div>
<div class="line"><span class="lineno">  645</span>        <span class="comment">// Pair of iterators to start and end of InflationVol sensitivities with current qualifier</span></div>
<div class="line"><span class="lineno">  646</span>        <span class="keyword">auto</span> pInfQualifier = crif.filterByQualifier(nettingSetDetails, pc, RiskType::InflationVol, qualifier);</div>
<div class="line"><span class="lineno">  647</span> </div>
<div class="line"><span class="lineno">  648</span>        <span class="comment">// One pass to get the concentration risk for this qualifier</span></div>
<div class="line"><span class="lineno">  649</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; it : pIrQualifier) {</div>
<div class="line"><span class="lineno">  650</span>            concentrationRisk[qualifier] += it.amountResultCcy;</div>
<div class="line"><span class="lineno">  651</span>        }</div>
<div class="line"><span class="lineno">  652</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; it : pInfQualifier) {</div>
<div class="line"><span class="lineno">  653</span>            concentrationRisk[qualifier] += it.amountResultCcy;</div>
<div class="line"><span class="lineno">  654</span>        }</div>
<div class="line"><span class="lineno">  655</span>        <span class="comment">// Divide by the concentration risk threshold</span></div>
<div class="line"><span class="lineno">  656</span>        Real concThreshold = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;concentrationThreshold(RiskType::IRVol, qualifier);</div>
<div class="line"><span class="lineno">  657</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a> != <span class="stringliteral">&quot;USD&quot;</span>)</div>
<div class="line"><span class="lineno">  658</span>            concThreshold *= <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa14f759693736cf0438f0e6ff1a792fe">market_</a>-&gt;fxRate(<span class="stringliteral">&quot;USD&quot;</span> + <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a>)-&gt;value();</div>
<div class="line"><span class="lineno">  659</span>        concentrationRisk[qualifier] /= concThreshold;</div>
<div class="line"><span class="lineno">  660</span> </div>
<div class="line"><span class="lineno">  661</span>        <span class="comment">// Final concentration risk amount</span></div>
<div class="line"><span class="lineno">  662</span>        concentrationRisk[qualifier] = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(1.0, <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(std::abs(concentrationRisk[qualifier])));</div>
<div class="line"><span class="lineno">  663</span> </div>
<div class="line"><span class="lineno">  664</span>        <span class="comment">// Calculate the margin piece for this qualifier i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  665</span>        <span class="comment">// Start with IRVol vs. IRVol components</span></div>
<div class="line"><span class="lineno">  666</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = pIrQualifier.begin(); itOuter != pIrQualifier.end(); ++itOuter) {</div>
<div class="line"><span class="lineno">  667</span>            <span class="comment">// Risk weight i.e. $RW_k$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  668</span>            Real rwOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;weight(RiskType::IRVol, qualifier, itOuter-&gt;label1);</div>
<div class="line"><span class="lineno">  669</span>            <span class="comment">// Weighted sensitivity i.e. $WS_{k,i}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  670</span>            Real wsOuter = rwOuter * itOuter-&gt;amountResultCcy * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  671</span>            <span class="comment">// Update weighted sensitivity sum</span></div>
<div class="line"><span class="lineno">  672</span>            sumWeightedSensis[qualifier] += wsOuter;</div>
<div class="line"><span class="lineno">  673</span>            <span class="comment">// Add diagonal element to vega margin</span></div>
<div class="line"><span class="lineno">  674</span>            vegaMargin[qualifier] += wsOuter * wsOuter;</div>
<div class="line"><span class="lineno">  675</span>            <span class="comment">// Add the cross elements to the vega margin</span></div>
<div class="line"><span class="lineno">  676</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = pIrQualifier.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno">  677</span>                <span class="comment">// Label1 level correlation i.e. $\rho_{k,l}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  678</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(RiskType::IRVol, qualifier, itOuter-&gt;label1, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">  679</span>                                                            RiskType::IRVol, qualifier, itInner-&gt;label1, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  680</span>                <span class="comment">// Add cross element to vega margin</span></div>
<div class="line"><span class="lineno">  681</span>                Real rwInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;weight(RiskType::IRVol, qualifier, itInner-&gt;label1);</div>
<div class="line"><span class="lineno">  682</span>                Real wsInner = rwInner * itInner-&gt;amountResultCcy * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  683</span>                vegaMargin[qualifier] += 2 * corr * wsOuter * wsInner;</div>
<div class="line"><span class="lineno">  684</span>            }</div>
<div class="line"><span class="lineno">  685</span>        }</div>
<div class="line"><span class="lineno">  686</span> </div>
<div class="line"><span class="lineno">  687</span>        <span class="comment">// Now deal with inflation component</span></div>
<div class="line"><span class="lineno">  688</span>        <span class="comment">// To be generic/future-proof, assume that we don&#39;t know correlation structure. The way SIMM is</span></div>
<div class="line"><span class="lineno">  689</span>        <span class="comment">// currently, we could just sum over the InflationVol numbers within qualifier and use this.</span></div>
<div class="line"><span class="lineno">  690</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = pInfQualifier.begin(); itOuter != pInfQualifier.end(); ++itOuter) {</div>
<div class="line"><span class="lineno">  691</span>            <span class="comment">// Risk weight i.e. $RW_k$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  692</span>            Real rwOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;weight(RiskType::InflationVol, qualifier, itOuter-&gt;label1);</div>
<div class="line"><span class="lineno">  693</span>            <span class="comment">// Weighted sensitivity i.e. $WS_{k,i}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  694</span>            Real wsOuter = rwOuter * itOuter-&gt;amountResultCcy * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  695</span>            <span class="comment">// Update weighted sensitivity sum</span></div>
<div class="line"><span class="lineno">  696</span>            sumWeightedSensis[qualifier] += wsOuter;</div>
<div class="line"><span class="lineno">  697</span>            <span class="comment">// Add diagonal element to vega margin</span></div>
<div class="line"><span class="lineno">  698</span>            vegaMargin[qualifier] += wsOuter * wsOuter;</div>
<div class="line"><span class="lineno">  699</span>            <span class="comment">// Add the cross elements to the vega margin</span></div>
<div class="line"><span class="lineno">  700</span>            <span class="comment">// Firstly, against all IRVol components</span></div>
<div class="line"><span class="lineno">  701</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = pIrQualifier.begin(); itInner != pIrQualifier.end(); ++itInner) {</div>
<div class="line"><span class="lineno">  702</span>                <span class="comment">// Correlation i.e. $\rho_{k,l}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  703</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(RiskType::InflationVol, qualifier, itOuter-&gt;label1, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">  704</span>                                                            RiskType::IRVol, qualifier, itInner-&gt;label1, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  705</span>                <span class="comment">// Add cross element to vega margin</span></div>
<div class="line"><span class="lineno">  706</span>                Real rwInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;weight(RiskType::IRVol, qualifier, itInner-&gt;label1);</div>
<div class="line"><span class="lineno">  707</span>                Real wsInner = rwInner * itInner-&gt;amountResultCcy * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  708</span>                vegaMargin[qualifier] += 2 * corr * wsOuter * wsInner;</div>
<div class="line"><span class="lineno">  709</span>            }</div>
<div class="line"><span class="lineno">  710</span>            <span class="comment">// Secondly, against all previous InflationVol components</span></div>
<div class="line"><span class="lineno">  711</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = pInfQualifier.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno">  712</span>                <span class="comment">// Correlation i.e. $\rho_{k,l}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  713</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(RiskType::InflationVol, qualifier, itOuter-&gt;label1, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">  714</span>                                                            RiskType::InflationVol, qualifier, itInner-&gt;label1, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  715</span>                <span class="comment">// Add cross element to vega margin</span></div>
<div class="line"><span class="lineno">  716</span>                Real rwInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;weight(RiskType::InflationVol, qualifier, itInner-&gt;label1);</div>
<div class="line"><span class="lineno">  717</span>                Real wsInner = rwInner * itInner-&gt;amountResultCcy * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  718</span>                vegaMargin[qualifier] += 2 * corr * wsOuter * wsInner;</div>
<div class="line"><span class="lineno">  719</span>            }</div>
<div class="line"><span class="lineno">  720</span>        }</div>
<div class="line"><span class="lineno">  721</span> </div>
<div class="line"><span class="lineno">  722</span>        <span class="comment">// Finally have the value of $K_b$</span></div>
<div class="line"><span class="lineno">  723</span>        vegaMargin[qualifier] = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(vegaMargin[qualifier], 0.0));</div>
<div class="line"><span class="lineno">  724</span>    }</div>
<div class="line"><span class="lineno">  725</span> </div>
<div class="line"><span class="lineno">  726</span>    <span class="comment">// Now calculate final vega margin by aggregating across currencies</span></div>
<div class="line"><span class="lineno">  727</span>    Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> = 0.0;</div>
<div class="line"><span class="lineno">  728</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = qualifiers.begin(); itOuter != qualifiers.end(); ++itOuter) {</div>
<div class="line"><span class="lineno">  729</span>        <span class="comment">// Diagonal term</span></div>
<div class="line"><span class="lineno">  730</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += vegaMargin.at(*itOuter) * vegaMargin.at(*itOuter);</div>
<div class="line"><span class="lineno">  731</span>        <span class="comment">// Cross terms</span></div>
<div class="line"><span class="lineno">  732</span>        Real sOuter = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(sumWeightedSensis.at(*itOuter), vegaMargin.at(*itOuter)), -vegaMargin.at(*itOuter));</div>
<div class="line"><span class="lineno">  733</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = qualifiers.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno">  734</span>            Real sInner = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(sumWeightedSensis.at(*itInner), vegaMargin.at(*itInner)), -vegaMargin.at(*itInner));</div>
<div class="line"><span class="lineno">  735</span>            Real g = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(concentrationRisk.at(*itOuter), concentrationRisk.at(*itInner)) /</div>
<div class="line"><span class="lineno">  736</span>                     <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(concentrationRisk.at(*itOuter), concentrationRisk.at(*itInner));</div>
<div class="line"><span class="lineno">  737</span>            Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(RiskType::IRVol, *itOuter, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, RiskType::IRVol, *itInner,</div>
<div class="line"><span class="lineno">  738</span>                                                        <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, calcCcy);</div>
<div class="line"><span class="lineno">  739</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += 2.0 * sOuter * sInner * corr * g;</div>
<div class="line"><span class="lineno">  740</span>        }</div>
<div class="line"><span class="lineno">  741</span>    }</div>
<div class="line"><span class="lineno">  742</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>, 0.0));</div>
<div class="line"><span class="lineno">  743</span> </div>
<div class="line"><span class="lineno">  744</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; m : vegaMargin)</div>
<div class="line"><span class="lineno">  745</span>        bucketMargins[m.first] = m.second;</div>
<div class="line"><span class="lineno">  746</span>    bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>;</div>
<div class="line"><span class="lineno">  747</span> </div>
<div class="line"><span class="lineno">  748</span>    <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  749</span>}</div>
</div><!-- fragment --><div id="dynsection-13" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a40608992cde449b98628de2df0eff046_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a40608992cde449b98628de2df0eff046_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a40608992cde449b98628de2df0eff046_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a40608992cde449b98628de2df0eff046_cgraph">
<area shape="rect" title="Calculate the Interest Rate vega margin component for the given portfolio and product class." alt="" coords="5,158,104,183"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a273f66b7ccd20b924ca6eef153e59a13" title=" " alt="" coords="152,5,279,45"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a1d2bc2fd582f6814002e27b00b6d4853" title=" " alt="" coords="168,70,263,95"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa" title=" " alt="" coords="185,195,246,221"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1" title=" " alt="" coords="367,89,413,114"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa" title=" " alt="" coords="369,253,411,278"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2" title=" " alt="" coords="368,302,412,327"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a19aa28193073c2c75dd9f1e214054d7d" title=" " alt="" coords="327,24,453,64"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5" title=" " alt="" coords="339,138,441,163"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#ae60c8d5d49613f14cf237899570ac854" title=" " alt="" coords="327,188,453,228"/>
</map>
</div>
<div id="dynsection-14" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a40608992cde449b98628de2df0eff046_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a40608992cde449b98628de2df0eff046_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a40608992cde449b98628de2df0eff046_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a40608992cde449b98628de2df0eff046_icgraph">
<area shape="rect" title="Calculate the Interest Rate vega margin component for the given portfolio and product class." alt="" coords="385,5,484,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#afa017918b1c2efd004b2d39b3aa72cdd" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,5,337,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a7239a98428b9d2b50f6372ed1b3cb9e6" title=" " alt="" coords="5,5,120,31"/>
</map>
</div>

</div>
</div>
<a id="a4fc0d11995a333e0808c3c20f1f93fa4" name="a4fc0d11995a333e0808c3c20f1f93fa4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fc0d11995a333e0808c3c20f1f93fa4">&#9670;&#160;</a></span>irCurvatureMargin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pair&lt; map&lt; string, Real &gt;, <a class="el" href="classbool.html">bool</a> &gt; irCurvatureMargin </td>
          <td>(</td>
          <td class="paramtype">const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;&#160;</td>
          <td class="paramname"><em>crif</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the Interest Rate curvature margin component for the given portfolio and product class. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00751">751</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  753</span>                                                                                                              {</div>
<div class="line"><span class="lineno">  754</span> </div>
<div class="line"><span class="lineno">  755</span>    <span class="comment">// &quot;Bucket&quot; here refers to exposures under the CRIF qualifiers</span></div>
<div class="line"><span class="lineno">  756</span>    map&lt;string, Real&gt; bucketMargins;</div>
<div class="line"><span class="lineno">  757</span> </div>
<div class="line"><span class="lineno">  758</span>    <span class="comment">// Multiplier for sensitivities, -1 if SIMM side is Post</span></div>
<div class="line"><span class="lineno">  759</span>    Real multiplier = side == SimmSide::Call ? 1.0 : -1.0;</div>
<div class="line"><span class="lineno">  760</span> </div>
<div class="line"><span class="lineno">  761</span>    <span class="comment">// Find the set of qualifiers, i.e. currencies, in the Simm sensitivities</span></div>
<div class="line"><span class="lineno">  762</span>    set&lt;string&gt; qualifiers = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a1d2bc2fd582f6814002e27b00b6d4853">getQualifiers</a>(crif, nettingSetDetails, pc, {RiskType::IRVol, RiskType::InflationVol});</div>
<div class="line"><span class="lineno">  763</span> </div>
<div class="line"><span class="lineno">  764</span>    <span class="comment">// If there are no qualifiers, return early and set bool to false to indicate margin does not apply</span></div>
<div class="line"><span class="lineno">  765</span>    <span class="keywordflow">if</span> (qualifiers.empty()) {</div>
<div class="line"><span class="lineno">  766</span>        bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = 0.0;</div>
<div class="line"><span class="lineno">  767</span>        <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  768</span>    }</div>
<div class="line"><span class="lineno">  769</span> </div>
<div class="line"><span class="lineno">  770</span>    <span class="comment">// The curvature margin for each currency i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  771</span>    map&lt;string, Real&gt; <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>;</div>
<div class="line"><span class="lineno">  772</span>    <span class="comment">// The sum of the weighted sensitivities for each currency i.e. $\sum_{k}^K CVR_{b,k}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  773</span>    map&lt;string, Real&gt; sumWeightedSensis;</div>
<div class="line"><span class="lineno">  774</span>    <span class="comment">// The sum of all weighted sensitivities across currencies and risk factors</span></div>
<div class="line"><span class="lineno">  775</span>    Real sumWs = 0.0;</div>
<div class="line"><span class="lineno">  776</span>    <span class="comment">// The sum of the absolute value of weighted sensitivities across currencies and risk factors</span></div>
<div class="line"><span class="lineno">  777</span>    Real sumAbsWs = 0.0;</div>
<div class="line"><span class="lineno">  778</span> </div>
<div class="line"><span class="lineno">  779</span>    <span class="comment">// Loop over the qualifiers i.e. currencies</span></div>
<div class="line"><span class="lineno">  780</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; qualifier : qualifiers) {</div>
<div class="line"><span class="lineno">  781</span>        <span class="comment">// Pair of iterators to start and end of IRVol sensitivities with current qualifier</span></div>
<div class="line"><span class="lineno">  782</span>        <span class="keyword">auto</span> pIrQualifier = crif.<a class="code hl_function" href="classore_1_1analytics_1_1_crif.html#a273f66b7ccd20b924ca6eef153e59a13">filterByQualifier</a>(nettingSetDetails, pc, RiskType::IRVol, qualifier);</div>
<div class="line"><span class="lineno">  783</span> </div>
<div class="line"><span class="lineno">  784</span>        <span class="comment">// Pair of iterators to start and end of InflationVol sensitivities with current qualifier</span></div>
<div class="line"><span class="lineno">  785</span>        <span class="keyword">auto</span> pInfQualifier =</div>
<div class="line"><span class="lineno">  786</span>            crif.<a class="code hl_function" href="classore_1_1analytics_1_1_crif.html#a273f66b7ccd20b924ca6eef153e59a13">filterByQualifier</a>(nettingSetDetails, pc, RiskType::InflationVol, qualifier);</div>
<div class="line"><span class="lineno">  787</span> </div>
<div class="line"><span class="lineno">  788</span>        <span class="comment">// Calculate the margin piece for this qualifier i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  789</span>        <span class="comment">// Start with IRVol vs. IRVol components</span></div>
<div class="line"><span class="lineno">  790</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = pIrQualifier.begin(); itOuter != pIrQualifier.end(); ++itOuter) {</div>
<div class="line"><span class="lineno">  791</span>            <span class="comment">// Curvature weight i.e. $SF(t_{kj})$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  792</span>            Real sfOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;curvatureWeight(RiskType::IRVol, itOuter-&gt;label1);</div>
<div class="line"><span class="lineno">  793</span>            <span class="comment">// Curvature sensitivity i.e. $CVR_{ik}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  794</span>            Real wsOuter = sfOuter * (itOuter-&gt;amountResultCcy * multiplier);</div>
<div class="line"><span class="lineno">  795</span>            <span class="comment">// Update weighted sensitivity sums</span></div>
<div class="line"><span class="lineno">  796</span>            sumWeightedSensis[qualifier] += wsOuter;</div>
<div class="line"><span class="lineno">  797</span>            sumWs += wsOuter;</div>
<div class="line"><span class="lineno">  798</span>            sumAbsWs += std::abs(wsOuter);</div>
<div class="line"><span class="lineno">  799</span>            <span class="comment">// Add diagonal element to curvature margin</span></div>
<div class="line"><span class="lineno">  800</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>[qualifier] += wsOuter * wsOuter;</div>
<div class="line"><span class="lineno">  801</span>            <span class="comment">// Add the cross elements to the curvature margin</span></div>
<div class="line"><span class="lineno">  802</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = pIrQualifier.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno">  803</span>                <span class="comment">// Label1 level correlation i.e. $\rho_{k,l}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  804</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(RiskType::IRVol, qualifier, itOuter-&gt;label1, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">  805</span>                                                            RiskType::IRVol, qualifier, itInner-&gt;label1, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  806</span>                <span class="comment">// Add cross element to curvature margin</span></div>
<div class="line"><span class="lineno">  807</span>                Real sfInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;curvatureWeight(RiskType::IRVol, itInner-&gt;label1);</div>
<div class="line"><span class="lineno">  808</span>                Real wsInner = sfInner * (itInner-&gt;amountResultCcy * multiplier);</div>
<div class="line"><span class="lineno">  809</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>[qualifier] += 2 * corr * corr * wsOuter * wsInner;</div>
<div class="line"><span class="lineno">  810</span>            }</div>
<div class="line"><span class="lineno">  811</span>        }</div>
<div class="line"><span class="lineno">  812</span> </div>
<div class="line"><span class="lineno">  813</span>        <span class="comment">// Now deal with inflation component</span></div>
<div class="line"><span class="lineno">  814</span>        <span class="keyword">const</span> <span class="keywordtype">string</span> simmVersion = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;version();</div>
<div class="line"><span class="lineno">  815</span>        <a class="code hl_enumeration" href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477">SimmVersion</a> thresholdVersion = <a class="code hl_enumvalue" href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477a6ec11796ccdf73b5b5872c5b8a977832">SimmVersion::V1_0</a>;</div>
<div class="line"><span class="lineno">  816</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;isSimmConfigCalibration() || <a class="code hl_function" href="namespaceore_1_1analytics.html#a715afb0219b3c338740f98cd349e0845">parseSimmVersion</a>(simmVersion) &gt; thresholdVersion) {</div>
<div class="line"><span class="lineno">  817</span>            <span class="comment">// Weighted sensitivity i.e. $WS_{k,i}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  818</span>            Real infWs = 0.0;</div>
<div class="line"><span class="lineno">  819</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> infIt = pInfQualifier.begin(); infIt != pInfQualifier.end(); ++infIt) {</div>
<div class="line"><span class="lineno">  820</span>                <span class="comment">// Curvature weight i.e. $SF(t_{kj})$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  821</span>                Real infSf = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;curvatureWeight(RiskType::InflationVol, infIt-&gt;label1);</div>
<div class="line"><span class="lineno">  822</span>                infWs += infSf * (infIt-&gt;amountResultCcy * multiplier);</div>
<div class="line"><span class="lineno">  823</span>            }</div>
<div class="line"><span class="lineno">  824</span>            <span class="comment">// Update weighted sensitivity sums</span></div>
<div class="line"><span class="lineno">  825</span>            sumWeightedSensis[qualifier] += infWs;</div>
<div class="line"><span class="lineno">  826</span>            sumWs += infWs;</div>
<div class="line"><span class="lineno">  827</span>            sumAbsWs += std::abs(infWs);</div>
<div class="line"><span class="lineno">  828</span> </div>
<div class="line"><span class="lineno">  829</span>            <span class="comment">// Add diagonal element to curvature margin - there is only one element for inflationVol</span></div>
<div class="line"><span class="lineno">  830</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>[qualifier] += infWs * infWs;</div>
<div class="line"><span class="lineno">  831</span> </div>
<div class="line"><span class="lineno">  832</span>            <span class="comment">// Add the cross elements to the curvature margin against IRVol components.</span></div>
<div class="line"><span class="lineno">  833</span>            <span class="comment">// There are no cross elements against InflationVol since we only have one element.</span></div>
<div class="line"><span class="lineno">  834</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> irIt = pIrQualifier.begin(); irIt != pIrQualifier.end(); ++irIt) {</div>
<div class="line"><span class="lineno">  835</span>                <span class="comment">// Correlation i.e. $\rho_{k,l}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  836</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(RiskType::InflationVol, qualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, RiskType::IRVol,</div>
<div class="line"><span class="lineno">  837</span>                                                            qualifier, irIt-&gt;label1, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  838</span>                <span class="comment">// Add cross element to curvature margin</span></div>
<div class="line"><span class="lineno">  839</span>                Real irSf = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;curvatureWeight(RiskType::IRVol, irIt-&gt;label1);</div>
<div class="line"><span class="lineno">  840</span>                Real irWs = irSf * (irIt-&gt;amountResultCcy * multiplier);</div>
<div class="line"><span class="lineno">  841</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>[qualifier] += 2 * corr * corr * infWs * irWs;</div>
<div class="line"><span class="lineno">  842</span>            }</div>
<div class="line"><span class="lineno">  843</span>        }</div>
<div class="line"><span class="lineno">  844</span> </div>
<div class="line"><span class="lineno">  845</span>        <span class="comment">// Finally have the value of $K_b$</span></div>
<div class="line"><span class="lineno">  846</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>[qualifier] = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>[qualifier], 0.0));</div>
<div class="line"><span class="lineno">  847</span>    }</div>
<div class="line"><span class="lineno">  848</span> </div>
<div class="line"><span class="lineno">  849</span>    <span class="comment">// If sum of absolute value of all individual curvature risks is zero, we can return 0.0</span></div>
<div class="line"><span class="lineno">  850</span>    <span class="keywordflow">if</span> (<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(sumAbsWs, 0.0)) {</div>
<div class="line"><span class="lineno">  851</span>        bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = 0.0;</div>
<div class="line"><span class="lineno">  852</span>        <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  853</span>    }</div>
<div class="line"><span class="lineno">  854</span> </div>
<div class="line"><span class="lineno">  855</span>    <span class="comment">// Now calculate final curvature margin by aggregating across currencies</span></div>
<div class="line"><span class="lineno">  856</span>    Real theta = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(sumWs / sumAbsWs, 0.0);</div>
<div class="line"><span class="lineno">  857</span> </div>
<div class="line"><span class="lineno">  858</span>    Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> = 0.0;</div>
<div class="line"><span class="lineno">  859</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = qualifiers.begin(); itOuter != qualifiers.end(); ++itOuter) {</div>
<div class="line"><span class="lineno">  860</span>        <span class="comment">// Diagonal term</span></div>
<div class="line"><span class="lineno">  861</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>.at(*itOuter) * <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>.at(*itOuter);</div>
<div class="line"><span class="lineno">  862</span>        <span class="comment">// Cross terms</span></div>
<div class="line"><span class="lineno">  863</span>        Real sOuter =</div>
<div class="line"><span class="lineno">  864</span>            <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(sumWeightedSensis.at(*itOuter), <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>.at(*itOuter)), -<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>.at(*itOuter));</div>
<div class="line"><span class="lineno">  865</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = qualifiers.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno">  866</span>            Real sInner =</div>
<div class="line"><span class="lineno">  867</span>                <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(sumWeightedSensis.at(*itInner), <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>.at(*itInner)), -<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>.at(*itInner));</div>
<div class="line"><span class="lineno">  868</span>            Real corr =</div>
<div class="line"><span class="lineno">  869</span>                <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(RiskType::IRVol, *itOuter, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, RiskType::IRVol, *itInner, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  870</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += 2.0 * sOuter * sInner * corr * corr;</div>
<div class="line"><span class="lineno">  871</span>        }</div>
<div class="line"><span class="lineno">  872</span>    }</div>
<div class="line"><span class="lineno">  873</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> = sumWs + <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5">lambda</a>(theta) * <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>, 0.0));</div>
<div class="line"><span class="lineno">  874</span> </div>
<div class="line"><span class="lineno">  875</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; m : <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>)</div>
<div class="line"><span class="lineno">  876</span>        bucketMargins[m.first] = m.second;</div>
<div class="line"><span class="lineno">  877</span> </div>
<div class="line"><span class="lineno">  878</span>    Real scaling = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;curvatureMarginScaling();</div>
<div class="line"><span class="lineno">  879</span>    Real totalCurvatureMargin = scaling * <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>, 0.0);</div>
<div class="line"><span class="lineno">  880</span>    <span class="comment">// TODO: Review, should we return the pre-scaled value instead?</span></div>
<div class="line"><span class="lineno">  881</span>    bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = totalCurvatureMargin;</div>
<div class="line"><span class="lineno">  882</span> </div>
<div class="line"><span class="lineno">  883</span>    <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  884</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_crif_html_a273f66b7ccd20b924ca6eef153e59a13"><div class="ttname"><a href="classore_1_1analytics_1_1_crif.html#a273f66b7ccd20b924ca6eef153e59a13">ore::analytics::Crif::filterByQualifier</a></div><div class="ttdeci">std::vector&lt; CrifRecord &gt; filterByQualifier(const NettingSetDetails &amp;nsd, const CrifRecord::ProductClass pc, const CrifRecord::RiskType rt, const std::string &amp;qualifier) const</div><div class="ttdef"><b>Definition:</b> <a href="crif_8cpp_source.html#l00247">crif.cpp:247</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a3fc9a75842580e08b25fca334bdeb9d5"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5">ore::analytics::SimmCalculator::lambda</a></div><div class="ttdeci">QuantLib::Real lambda(QuantLib::Real theta) const</div><div class="ttdoc">Give the  used in the curvature margin calculation.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l01659">simmcalculator.cpp:1659</a></div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a5c1f8b37037e5cd698ccaae388982477"><div class="ttname"><a href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477">ore::analytics::SimmVersion</a></div><div class="ttdeci">SimmVersion</div><div class="ttdoc">Ordered SIMM versions.</div><div class="ttdef"><b>Definition:</b> <a href="utilities_8hpp_source.html#l00043">utilities.hpp:43</a></div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a5c1f8b37037e5cd698ccaae388982477a6ec11796ccdf73b5b5872c5b8a977832"><div class="ttname"><a href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477a6ec11796ccdf73b5b5872c5b8a977832">ore::analytics::SimmVersion::V1_0</a></div><div class="ttdeci">@ V1_0</div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a715afb0219b3c338740f98cd349e0845"><div class="ttname"><a href="namespaceore_1_1analytics.html#a715afb0219b3c338740f98cd349e0845">ore::analytics::parseSimmVersion</a></div><div class="ttdeci">SimmVersion parseSimmVersion(const string &amp;version)</div><div class="ttdef"><b>Definition:</b> <a href="utilities_8cpp_source.html#l00162">utilities.cpp:162</a></div></div>
</div><!-- fragment --><div id="dynsection-15" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-15-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a4fc0d11995a333e0808c3c20f1f93fa4_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a4fc0d11995a333e0808c3c20f1f93fa4_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a4fc0d11995a333e0808c3c20f1f93fa4_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a4fc0d11995a333e0808c3c20f1f93fa4_cgraph">
<area shape="rect" title="Calculate the Interest Rate curvature margin component for the given portfolio and product class." alt="" coords="5,425,128,451"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5" title=" " alt="" coords="585,56,688,81"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a" title=" " alt="" coords="183,273,296,299"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5" title="Give the &#160;used in the curvature margin calculation." alt="" coords="406,397,470,423"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa" title=" " alt="" coords="407,131,469,156"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1" title=" " alt="" coords="613,5,660,31"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa" title=" " alt="" coords="615,296,658,321"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2" title=" " alt="" coords="615,347,659,372"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a715afb0219b3c338740f98cd349e0845" title=" " alt="" coords="351,447,525,487"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a273f66b7ccd20b924ca6eef153e59a13" title=" " alt="" coords="176,613,303,653"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a1d2bc2fd582f6814002e27b00b6d4853" title=" " alt="" coords="192,677,287,703"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#ae60c8d5d49613f14cf237899570ac854" title=" " alt="" coords="573,177,700,217"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a424b2c96c8b5f13080141e499c282692" title=" " alt="" coords="375,181,501,221"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a19aa28193073c2c75dd9f1e214054d7d" title=" " alt="" coords="375,670,501,710"/>
</map>
</div>
<div id="dynsection-16" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-16-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-16-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-16-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a4fc0d11995a333e0808c3c20f1f93fa4_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a4fc0d11995a333e0808c3c20f1f93fa4_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a4fc0d11995a333e0808c3c20f1f93fa4_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a4fc0d11995a333e0808c3c20f1f93fa4_icgraph">
<area shape="rect" title="Calculate the Interest Rate curvature margin component for the given portfolio and product class." alt="" coords="385,5,508,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#afa017918b1c2efd004b2d39b3aa72cdd" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,5,337,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a7239a98428b9d2b50f6372ed1b3cb9e6" title=" " alt="" coords="5,5,120,31"/>
</map>
</div>

</div>
</div>
<a id="a12dd56db004e8584b643b1e8199137fa" name="a12dd56db004e8584b643b1e8199137fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12dd56db004e8584b643b1e8199137fa">&#9670;&#160;</a></span>margin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pair&lt; map&lt; string, Real &gt;, <a class="el" href="classbool.html">bool</a> &gt; margin </td>
          <td>(</td>
          <td class="paramtype">const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#a1c18a2eca0437452edb56ef0965d3ec2">CrifRecord::RiskType</a> &amp;&#160;</td>
          <td class="paramname"><em>rt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;&#160;</td>
          <td class="paramname"><em>netRecords</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Calculate the (delta or vega) margin component for the given portfolio, product class and risk type Used to calculate delta or vega or base correlation margin for all risk types except IR, IRVol (and by association, Inflation, XccyBasis and InflationVol) </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00886">886</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  887</span>                                                                                                                       {</div>
<div class="line"><span class="lineno">  888</span> </div>
<div class="line"><span class="lineno">  889</span>    <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; calcCcy = side == SimmSide::Call ? <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a3c2fc9fbb2d2df2e4a97152bde680460">calculationCcyCall_</a> : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abc16565c54ac283038b1e2114635cd43">calculationCcyPost_</a>;</div>
<div class="line"><span class="lineno">  890</span>    </div>
<div class="line"><span class="lineno">  891</span>    <span class="comment">// &quot;Bucket&quot; here refers to exposures under the CRIF qualifiers for FX (and IR) risk class, and CRIF buckets for</span></div>
<div class="line"><span class="lineno">  892</span>    <span class="comment">// every other risk class.</span></div>
<div class="line"><span class="lineno">  893</span>    <span class="comment">// For FX Delta margin, this refers to WS_k in Section B. &quot;Structure of the methodology&quot;, 8.(b).</span></div>
<div class="line"><span class="lineno">  894</span>    <span class="comment">// For FX Vega margin, this refers to VR_k in Section B., 10.(d).</span></div>
<div class="line"><span class="lineno">  895</span>    <span class="comment">// For other risk type, the bucket margin is K_b in the corresponding subsections.</span></div>
<div class="line"><span class="lineno">  896</span>    map&lt;string, Real&gt; bucketMargins;</div>
<div class="line"><span class="lineno">  897</span> </div>
<div class="line"><span class="lineno">  898</span>    <span class="keywordtype">bool</span> riskClassIsFX = rt == RiskType::FX || rt == RiskType::FXVol;</div>
<div class="line"><span class="lineno">  899</span> </div>
<div class="line"><span class="lineno">  900</span>    <span class="comment">// precomputed</span></div>
<div class="line"><span class="lineno">  901</span>    map&lt;std::pair&lt;std::string,std::string&gt;, std::vector&lt;CrifRecord&gt;&gt; crifByQualifierAndBucket;</div>
<div class="line"><span class="lineno">  902</span>    map&lt;std::string, std::vector&lt;CrifRecord&gt;&gt; crifByBucket;</div>
<div class="line"><span class="lineno">  903</span> </div>
<div class="line"><span class="lineno">  904</span>    <span class="comment">// Find the set of buckets and associated qualifiers for the netting set details, product class and risk type</span></div>
<div class="line"><span class="lineno">  905</span>    map&lt;string, set&lt;string&gt;&gt; buckets;</div>
<div class="line"><span class="lineno">  906</span>    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; it : crif.filterBy(nettingSetDetails, pc, rt)) {</div>
<div class="line"><span class="lineno">  907</span>        buckets[it.bucket].insert(it.qualifier);</div>
<div class="line"><span class="lineno">  908</span>        crifByQualifierAndBucket[std::make_pair(it.qualifier,it.bucket)].push_back(it);</div>
<div class="line"><span class="lineno">  909</span>        crifByBucket[it.bucket].push_back(it);</div>
<div class="line"><span class="lineno">  910</span>    }</div>
<div class="line"><span class="lineno">  911</span> </div>
<div class="line"><span class="lineno">  912</span>    <span class="comment">// If there are no buckets, return early and set bool to false to indicate margin does not apply</span></div>
<div class="line"><span class="lineno">  913</span>    <span class="keywordflow">if</span> (buckets.empty()) {</div>
<div class="line"><span class="lineno">  914</span>        bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = 0.0;</div>
<div class="line"><span class="lineno">  915</span>        <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  916</span>    }</div>
<div class="line"><span class="lineno">  917</span> </div>
<div class="line"><span class="lineno">  918</span>    <span class="comment">// The margin for each bucket i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  919</span>    map&lt;string, Real&gt; bucketMargin;</div>
<div class="line"><span class="lineno">  920</span>    <span class="comment">// The sum of the weighted sensitivities for each bucket i.e. $\sum_{k=1}^{K} WS_{k}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  921</span>    map&lt;string, Real&gt; sumWeightedSensis;</div>
<div class="line"><span class="lineno">  922</span>    <span class="comment">// The historical volatility ratio for the risk type - will be 1.0 if not applicable</span></div>
<div class="line"><span class="lineno">  923</span>    Real hvr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;historicalVolatilityRatio(rt);</div>
<div class="line"><span class="lineno">  924</span> </div>
<div class="line"><span class="lineno">  925</span>    <span class="comment">// Loop over the buckets</span></div>
<div class="line"><span class="lineno">  926</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; kv : buckets) {</div>
<div class="line"><span class="lineno">  927</span>        <span class="keywordtype">string</span> bucket = kv.first;</div>
<div class="line"><span class="lineno">  928</span> </div>
<div class="line"><span class="lineno">  929</span>        <span class="comment">// Initialise sumWeightedSensis here to ensure it is not empty in the later calculations</span></div>
<div class="line"><span class="lineno">  930</span>        sumWeightedSensis[bucket] = 0.0;</div>
<div class="line"><span class="lineno">  931</span> </div>
<div class="line"><span class="lineno">  932</span>        <span class="comment">// Get the concentration risk for each qualifier in current bucket i.e. $CR_k$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  933</span>        map&lt;string, Real&gt; concentrationRisk;</div>
<div class="line"><span class="lineno">  934</span> </div>
<div class="line"><span class="lineno">  935</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; qualifier : kv.second) {</div>
<div class="line"><span class="lineno">  936</span> </div>
<div class="line"><span class="lineno">  937</span>            <span class="comment">// Do not include Risk_FX components in the calculation currency in the SIMM calculation</span></div>
<div class="line"><span class="lineno">  938</span>            <span class="keywordflow">if</span> (rt == RiskType::FX &amp;&amp; qualifier == calcCcy) {</div>
<div class="line"><span class="lineno">  939</span>                <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno">  940</span>                    <a class="code hl_defineRef" href="../ored/log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Not calculating concentration risk for qualifier &quot;</span></div>
<div class="line"><span class="lineno">  941</span>                         &lt;&lt; qualifier &lt;&lt; <span class="stringliteral">&quot; of risk type &quot;</span> &lt;&lt; rt</div>
<div class="line"><span class="lineno">  942</span>                         &lt;&lt; <span class="stringliteral">&quot; since the qualifier equals the SIMM calculation currency &quot;</span> &lt;&lt; calcCcy);</div>
<div class="line"><span class="lineno">  943</span>                }</div>
<div class="line"><span class="lineno">  944</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  945</span>            }</div>
<div class="line"><span class="lineno">  946</span> </div>
<div class="line"><span class="lineno">  947</span>            <span class="comment">// Pair of iterators to start and end of sensitivities with current qualifier</span></div>
<div class="line"><span class="lineno">  948</span>            <span class="keyword">auto</span> pQualifier = crifByQualifierAndBucket[std::make_pair(qualifier,bucket)];</div>
<div class="line"><span class="lineno">  949</span> </div>
<div class="line"><span class="lineno">  950</span>            <span class="comment">// One pass to get the concentration risk for this qualifier</span></div>
<div class="line"><span class="lineno">  951</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = pQualifier.begin(); it != pQualifier.end(); ++it) {</div>
<div class="line"><span class="lineno">  952</span>                <span class="comment">// Get the sigma value if applicable - returns 1.0 if not applicable</span></div>
<div class="line"><span class="lineno">  953</span>                Real sigma = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;sigma(rt, it-&gt;qualifier, it-&gt;label1, calcCcy);</div>
<div class="line"><span class="lineno">  954</span>                concentrationRisk[qualifier] += it-&gt;amountResultCcy * sigma * hvr;</div>
<div class="line"><span class="lineno">  955</span>            }</div>
<div class="line"><span class="lineno">  956</span>            <span class="comment">// Divide by the concentration risk threshold</span></div>
<div class="line"><span class="lineno">  957</span>            Real concThreshold = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;concentrationThreshold(rt, qualifier);</div>
<div class="line"><span class="lineno">  958</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a> != <span class="stringliteral">&quot;USD&quot;</span>)</div>
<div class="line"><span class="lineno">  959</span>                concThreshold *= <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa14f759693736cf0438f0e6ff1a792fe">market_</a>-&gt;fxRate(<span class="stringliteral">&quot;USD&quot;</span> + <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a>)-&gt;value();</div>
<div class="line"><span class="lineno">  960</span>            concentrationRisk[qualifier] /= concThreshold;</div>
<div class="line"><span class="lineno">  961</span>            <span class="comment">// Final concentration risk amount</span></div>
<div class="line"><span class="lineno">  962</span>            concentrationRisk[qualifier] = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(1.0, <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(std::abs(concentrationRisk[qualifier])));</div>
<div class="line"><span class="lineno">  963</span>        }</div>
<div class="line"><span class="lineno">  964</span> </div>
<div class="line"><span class="lineno">  965</span> </div>
<div class="line"><span class="lineno">  966</span>        <span class="comment">// Calculate the margin component for the current bucket</span></div>
<div class="line"><span class="lineno">  967</span>        <span class="comment">// Pair of iterators to start and end of sensitivities within current bucket</span></div>
<div class="line"><span class="lineno">  968</span>        <span class="keyword">auto</span> pBucket = crifByBucket[bucket];</div>
<div class="line"><span class="lineno">  969</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = pBucket.begin(); itOuter != pBucket.end(); ++itOuter) {</div>
<div class="line"><span class="lineno">  970</span>            <span class="comment">// Do not include Risk_FX components in the calculation currency in the SIMM calculation</span></div>
<div class="line"><span class="lineno">  971</span>            <span class="keywordflow">if</span> (rt == RiskType::FX &amp;&amp; itOuter-&gt;qualifier == calcCcy) {</div>
<div class="line"><span class="lineno">  972</span>                <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno">  973</span>                    <a class="code hl_defineRef" href="../ored/log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Skipping qualifier &quot;</span> &lt;&lt; itOuter-&gt;qualifier &lt;&lt; <span class="stringliteral">&quot; of risk type &quot;</span> &lt;&lt; rt</div>
<div class="line"><span class="lineno">  974</span>                                               &lt;&lt; <span class="stringliteral">&quot; since the qualifier equals the SIMM calculation currency &quot;</span></div>
<div class="line"><span class="lineno">  975</span>                                               &lt;&lt; calcCcy);</div>
<div class="line"><span class="lineno">  976</span>                }</div>
<div class="line"><span class="lineno">  977</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  978</span>            }</div>
<div class="line"><span class="lineno">  979</span>            <span class="comment">// Risk weight i.e. $RW_k$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  980</span>            Real rwOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;weight(rt, itOuter-&gt;qualifier, itOuter-&gt;label1, calcCcy);</div>
<div class="line"><span class="lineno">  981</span>            <span class="comment">// Get the sigma value if applicable - returns 1.0 if not applicable</span></div>
<div class="line"><span class="lineno">  982</span>            Real sigmaOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;sigma(rt, itOuter-&gt;qualifier, itOuter-&gt;label1, calcCcy);</div>
<div class="line"><span class="lineno">  983</span>            <span class="comment">// Weighted sensitivity i.e. $WS_{k}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  984</span>            Real wsOuter =</div>
<div class="line"><span class="lineno">  985</span>                rwOuter * (itOuter-&gt;amountResultCcy * sigmaOuter * hvr) * concentrationRisk[itOuter-&gt;qualifier];</div>
<div class="line"><span class="lineno">  986</span>            <span class="comment">// Get concentration risk for outer qualifier</span></div>
<div class="line"><span class="lineno">  987</span>            Real outerConcentrationRisk = concentrationRisk.at(itOuter-&gt;qualifier);</div>
<div class="line"><span class="lineno">  988</span>            <span class="comment">// Update weighted sensitivity sum</span></div>
<div class="line"><span class="lineno">  989</span>            sumWeightedSensis[bucket] += wsOuter;</div>
<div class="line"><span class="lineno">  990</span>            <span class="comment">// Add diagonal element to bucket margin</span></div>
<div class="line"><span class="lineno">  991</span>            bucketMargin[bucket] += wsOuter * wsOuter;</div>
<div class="line"><span class="lineno">  992</span>            <span class="comment">// Add the cross elements to the bucket margin</span></div>
<div class="line"><span class="lineno">  993</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = pBucket.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno">  994</span>                <span class="comment">// Do not include Risk_FX components in the calculation currency in the SIMM calculation</span></div>
<div class="line"><span class="lineno">  995</span>                <span class="keywordflow">if</span> (rt == RiskType::FX &amp;&amp; itInner-&gt;qualifier == calcCcy) {</div>
<div class="line"><span class="lineno">  996</span>                    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno">  997</span>                        <a class="code hl_defineRef" href="../ored/log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Skipping qualifier &quot;</span> &lt;&lt; itInner-&gt;qualifier &lt;&lt; <span class="stringliteral">&quot; of risk type &quot;</span> &lt;&lt; rt</div>
<div class="line"><span class="lineno">  998</span>                                                   &lt;&lt; <span class="stringliteral">&quot; since the qualifier equals the SIMM calculation currency &quot;</span></div>
<div class="line"><span class="lineno">  999</span>                                                   &lt;&lt; calcCcy);</div>
<div class="line"><span class="lineno"> 1000</span>                    }</div>
<div class="line"><span class="lineno"> 1001</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1002</span>                }</div>
<div class="line"><span class="lineno"> 1003</span>                <span class="comment">// Correlation, $\rho_{k,l}$ in the SIMM docs</span></div>
<div class="line"><span class="lineno"> 1004</span>                Real corr =</div>
<div class="line"><span class="lineno"> 1005</span>                    <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(rt, itOuter-&gt;qualifier, itOuter-&gt;label1, itOuter-&gt;label2, rt,</div>
<div class="line"><span class="lineno"> 1006</span>                                                    itInner-&gt;qualifier, itInner-&gt;label1, itInner-&gt;label2, calcCcy);</div>
<div class="line"><span class="lineno"> 1007</span>                <span class="comment">// $f_{k,l}$ from the SIMM docs</span></div>
<div class="line"><span class="lineno"> 1008</span>                Real f = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(outerConcentrationRisk, concentrationRisk.at(itInner-&gt;qualifier)) /</div>
<div class="line"><span class="lineno"> 1009</span>                         <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(outerConcentrationRisk, concentrationRisk.at(itInner-&gt;qualifier));</div>
<div class="line"><span class="lineno"> 1010</span>                <span class="comment">// Add cross element to delta margin</span></div>
<div class="line"><span class="lineno"> 1011</span>                Real sigmaInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;sigma(rt, itInner-&gt;qualifier, itInner-&gt;label1, calcCcy);</div>
<div class="line"><span class="lineno"> 1012</span>                Real rwInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;weight(rt, itInner-&gt;qualifier, itInner-&gt;label1, calcCcy);</div>
<div class="line"><span class="lineno"> 1013</span>                Real wsInner =</div>
<div class="line"><span class="lineno"> 1014</span>                    rwInner * (itInner-&gt;amountResultCcy * sigmaInner * hvr) * concentrationRisk[itInner-&gt;qualifier];</div>
<div class="line"><span class="lineno"> 1015</span>                bucketMargin[bucket] += 2 * corr * f * wsOuter * wsInner;</div>
<div class="line"><span class="lineno"> 1016</span>            }</div>
<div class="line"><span class="lineno"> 1017</span>            <span class="comment">// For FX risk class, results are broken down by qualifier, i.e. currency, instead of bucket, which is not used for Risk_FX</span></div>
<div class="line"><span class="lineno"> 1018</span>            <span class="keywordflow">if</span> (riskClassIsFX)</div>
<div class="line"><span class="lineno"> 1019</span>                bucketMargins[itOuter-&gt;qualifier] += wsOuter;</div>
<div class="line"><span class="lineno"> 1020</span>        }</div>
<div class="line"><span class="lineno"> 1021</span> </div>
<div class="line"><span class="lineno"> 1022</span>        <span class="comment">// Finally have the value of $K_b$</span></div>
<div class="line"><span class="lineno"> 1023</span>        bucketMargin[bucket] = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(bucketMargin[bucket], 0.0));</div>
<div class="line"><span class="lineno"> 1024</span>    }</div>
<div class="line"><span class="lineno"> 1025</span> </div>
<div class="line"><span class="lineno"> 1026</span>    <span class="comment">// If there is a &quot;Residual&quot; bucket entry store it separately</span></div>
<div class="line"><span class="lineno"> 1027</span>    <span class="comment">// This is $K_{residual}$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1028</span>    Real residualMargin = 0.0;</div>
<div class="line"><span class="lineno"> 1029</span>    <span class="keywordflow">if</span> (bucketMargin.count(<span class="stringliteral">&quot;Residual&quot;</span>) &gt; 0) {</div>
<div class="line"><span class="lineno"> 1030</span>        residualMargin = bucketMargin.at(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1031</span>        bucketMargin.erase(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1032</span>    }</div>
<div class="line"><span class="lineno"> 1033</span> </div>
<div class="line"><span class="lineno"> 1034</span>    <span class="comment">// Now calculate final margin by aggregating across non-residual buckets</span></div>
<div class="line"><span class="lineno"> 1035</span>    Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> = 0.0;</div>
<div class="line"><span class="lineno"> 1036</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = bucketMargin.begin(); itOuter != bucketMargin.end(); ++itOuter) {</div>
<div class="line"><span class="lineno"> 1037</span>        <span class="keywordtype">string</span> outerBucket = itOuter-&gt;first;</div>
<div class="line"><span class="lineno"> 1038</span>        <span class="comment">// Diagonal term, $K_b^2$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1039</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += itOuter-&gt;second * itOuter-&gt;second;</div>
<div class="line"><span class="lineno"> 1040</span>        <span class="comment">// Cross terms</span></div>
<div class="line"><span class="lineno"> 1041</span>        <span class="comment">// $S_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1042</span>        Real sOuter = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(sumWeightedSensis.at(outerBucket), itOuter-&gt;second), -itOuter-&gt;second);</div>
<div class="line"><span class="lineno"> 1043</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = bucketMargin.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno"> 1044</span>            <span class="keywordtype">string</span> innerBucket = itInner-&gt;first;</div>
<div class="line"><span class="lineno"> 1045</span>            <span class="comment">// $S_c$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1046</span>            Real sInner = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(sumWeightedSensis.at(innerBucket), itInner-&gt;second), -itInner-&gt;second);</div>
<div class="line"><span class="lineno"> 1047</span>            <span class="comment">// $\gamma_{b,c}$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1048</span>            <span class="comment">// Interface to SimmConfiguration is on qualifiers =&gt; take any qualifier from each</span></div>
<div class="line"><span class="lineno"> 1049</span>            <span class="comment">// of the respective (different) buckets to get the inter-bucket correlation</span></div>
<div class="line"><span class="lineno"> 1050</span>            <span class="keywordtype">string</span> innerQualifier = *buckets.at(innerBucket).begin();</div>
<div class="line"><span class="lineno"> 1051</span>            <span class="keywordtype">string</span> outerQualifier = *buckets.at(outerBucket).begin();</div>
<div class="line"><span class="lineno"> 1052</span>            Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(rt, outerQualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, rt, innerQualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, calcCcy);</div>
<div class="line"><span class="lineno"> 1053</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += 2.0 * sOuter * sInner * corr;</div>
<div class="line"><span class="lineno"> 1054</span>        }</div>
<div class="line"><span class="lineno"> 1055</span>    }</div>
<div class="line"><span class="lineno"> 1056</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>, 0.0));</div>
<div class="line"><span class="lineno"> 1057</span> </div>
<div class="line"><span class="lineno"> 1058</span>    <span class="comment">// Now add the residual component back in</span></div>
<div class="line"><span class="lineno"> 1059</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += residualMargin;</div>
<div class="line"><span class="lineno"> 1060</span>    <span class="keywordflow">if</span> (!<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(residualMargin, 0.0))</div>
<div class="line"><span class="lineno"> 1061</span>        bucketMargins[<span class="stringliteral">&quot;Residual&quot;</span>] = residualMargin;</div>
<div class="line"><span class="lineno"> 1062</span> </div>
<div class="line"><span class="lineno"> 1063</span>    <span class="comment">// For non-FX risk class, results are broken down by buckets</span></div>
<div class="line"><span class="lineno"> 1064</span>    <span class="keywordflow">if</span> (!riskClassIsFX)</div>
<div class="line"><span class="lineno"> 1065</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; m : bucketMargin)</div>
<div class="line"><span class="lineno"> 1066</span>            bucketMargins[m.first] = m.second;</div>
<div class="line"><span class="lineno"> 1067</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1068</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; m : bucketMargins)</div>
<div class="line"><span class="lineno"> 1069</span>            m.second = std::abs(m.second);</div>
<div class="line"><span class="lineno"> 1070</span> </div>
<div class="line"><span class="lineno"> 1071</span>    bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>;</div>
<div class="line"><span class="lineno"> 1072</span>    <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1073</span>}</div>
</div><!-- fragment --><div id="dynsection-17" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-17-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-17-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-17-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a12dd56db004e8584b643b1e8199137fa_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a12dd56db004e8584b643b1e8199137fa_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a12dd56db004e8584b643b1e8199137fa_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a12dd56db004e8584b643b1e8199137fa_cgraph">
<area shape="rect" title=" " alt="" coords="5,120,67,145"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5" title=" " alt="" coords="127,5,229,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#ae60c8d5d49613f14cf237899570ac854" title=" " alt="" coords="115,55,241,95"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1" title=" " alt="" coords="155,120,201,145"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa" title=" " alt="" coords="157,169,199,195"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2" title=" " alt="" coords="156,219,200,244"/>
</map>
</div>
<div id="dynsection-18" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-18-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-18-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-18-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a12dd56db004e8584b643b1e8199137fa_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a12dd56db004e8584b643b1e8199137fa_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a12dd56db004e8584b643b1e8199137fa_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a12dd56db004e8584b643b1e8199137fa_icgraph">
<area shape="rect" title=" " alt="" coords="719,131,780,156"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#afa017918b1c2efd004b2d39b3aa72cdd" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,131,337,156"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a" title=" " alt="" coords="557,55,670,80"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a4fc0d11995a333e0808c3c20f1f93fa4" title="Calculate the Interest Rate curvature margin component for the given portfolio and product class." alt="" coords="385,106,508,131"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a2f30844efa1be083cc9096e5eb411454" title="Calculate the Interest Rate delta margin component for the given portfolio and product class." alt="" coords="397,156,496,182"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a40608992cde449b98628de2df0eff046" title="Calculate the Interest Rate vega margin component for the given portfolio and product class." alt="" coords="397,206,496,231"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#acdab2245e5344cc15b7c0f2da447a59b" title=" " alt="" coords="556,258,671,283"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a7239a98428b9d2b50f6372ed1b3cb9e6" title=" " alt="" coords="5,131,120,156"/>
</map>
</div>

</div>
</div>
<a id="a875f25ec95261673b6f1b6f12603ed5a" name="a875f25ec95261673b6f1b6f12603ed5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a875f25ec95261673b6f1b6f12603ed5a">&#9670;&#160;</a></span>curvatureMargin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pair&lt; map&lt; string, Real &gt;, <a class="el" href="classbool.html">bool</a> &gt; curvatureMargin </td>
          <td>(</td>
          <td class="paramtype">const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#a1c18a2eca0437452edb56ef0965d3ec2">CrifRecord::RiskType</a> &amp;&#160;</td>
          <td class="paramname"><em>rt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;&#160;</td>
          <td class="paramname"><em>netRecords</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>rfLabels</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Calculate the curvature margin component for the given portfolio, product class and risk type Used to calculate curvature margin for all risk types except IR </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l01076">1076</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1077</span>                                                                                             {</div>
<div class="line"><span class="lineno"> 1078</span> </div>
<div class="line"><span class="lineno"> 1079</span>    <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; calcCcy = side == SimmSide::Call ? <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a3c2fc9fbb2d2df2e4a97152bde680460">calculationCcyCall_</a> : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abc16565c54ac283038b1e2114635cd43">calculationCcyPost_</a>;</div>
<div class="line"><span class="lineno"> 1080</span> </div>
<div class="line"><span class="lineno"> 1081</span>    <span class="comment">// &quot;Bucket&quot; here refers to exposures under the CRIF qualifiers for FX (and IR) risk class, and CRIF buckets for</span></div>
<div class="line"><span class="lineno"> 1082</span>    <span class="comment">// every other risk class</span></div>
<div class="line"><span class="lineno"> 1083</span>    <span class="comment">// For FX Curvature marrgin, this refers to CVR_{b,k} in Section B. &quot;Structure of the methodology&quot;, 11.(c).</span></div>
<div class="line"><span class="lineno"> 1084</span>    <span class="comment">// For other risk types, the bucket margin is K_b in the corresponding subsection.</span></div>
<div class="line"><span class="lineno"> 1085</span>    map&lt;string, Real&gt; bucketMargins;</div>
<div class="line"><span class="lineno"> 1086</span> </div>
<div class="line"><span class="lineno"> 1087</span>    <span class="keywordtype">bool</span> riskClassIsFX = rt == RiskType::FX || rt == RiskType::FXVol;</div>
<div class="line"><span class="lineno"> 1088</span> </div>
<div class="line"><span class="lineno"> 1089</span>    <span class="comment">// Multiplier for sensitivities, -1 if SIMM side is Post</span></div>
<div class="line"><span class="lineno"> 1090</span>    Real multiplier = side == SimmSide::Call ? 1.0 : -1.0;</div>
<div class="line"><span class="lineno"> 1091</span>    </div>
<div class="line"><span class="lineno"> 1092</span>    <span class="comment">// Find the set of buckets and associated qualifiers for the netting set details, product class and risk type</span></div>
<div class="line"><span class="lineno"> 1093</span>    map&lt;string, set&lt;string&gt;&gt; buckets;</div>
<div class="line"><span class="lineno"> 1094</span>    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; it : crif.filterBy(nettingSetDetails, pc, rt)) {</div>
<div class="line"><span class="lineno"> 1095</span>        buckets[it.bucket].insert(it.qualifier);</div>
<div class="line"><span class="lineno"> 1096</span>    }</div>
<div class="line"><span class="lineno"> 1097</span> </div>
<div class="line"><span class="lineno"> 1098</span>    <span class="comment">// If there are no buckets, return early and set bool to false to indicate margin does not apply</span></div>
<div class="line"><span class="lineno"> 1099</span>    <span class="keywordflow">if</span> (buckets.empty()) {</div>
<div class="line"><span class="lineno"> 1100</span>        bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = 0.0;</div>
<div class="line"><span class="lineno"> 1101</span>        <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1102</span>    }</div>
<div class="line"><span class="lineno"> 1103</span> </div>
<div class="line"><span class="lineno"> 1104</span>    <span class="comment">// The curvature margin for each bucket i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1105</span>    map&lt;string, Real&gt; <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>;</div>
<div class="line"><span class="lineno"> 1106</span>    <span class="comment">// The sum of the weighted (and absolute weighted) sensitivities for each bucket</span></div>
<div class="line"><span class="lineno"> 1107</span>    <span class="comment">// i.e. $\sum_{k}^K CVR_{b,k}$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1108</span>    map&lt;string, Real&gt; sumWeightedSensis;</div>
<div class="line"><span class="lineno"> 1109</span>    map&lt;string, map&lt;string, Real&gt;&gt; sumAbsTemp;</div>
<div class="line"><span class="lineno"> 1110</span>    map&lt;string, Real&gt; sumAbsWeightedSensis;</div>
<div class="line"><span class="lineno"> 1111</span> </div>
<div class="line"><span class="lineno"> 1112</span>    <span class="comment">// Loop over the buckets</span></div>
<div class="line"><span class="lineno"> 1113</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; kv : buckets) {</div>
<div class="line"><span class="lineno"> 1114</span>        <span class="keywordtype">string</span> bucket = kv.first;</div>
<div class="line"><span class="lineno"> 1115</span>        sumAbsTemp[bucket] = {};</div>
<div class="line"><span class="lineno"> 1116</span> </div>
<div class="line"><span class="lineno"> 1117</span>        <span class="comment">// Calculate the margin component for the current bucket</span></div>
<div class="line"><span class="lineno"> 1118</span>        <span class="comment">// Pair of iterators to start and end of sensitivities within current bucket</span></div>
<div class="line"><span class="lineno"> 1119</span>        <span class="keyword">auto</span> pBucket = crif.filterByBucket(nettingSetDetails, pc, rt, bucket);</div>
<div class="line"><span class="lineno"> 1120</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = pBucket.begin(); itOuter != pBucket.end(); ++itOuter) {</div>
<div class="line"><span class="lineno"> 1121</span>            <span class="comment">// Curvature weight i.e. $SF(t_{kj})$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1122</span>            Real sfOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;curvatureWeight(rt, itOuter-&gt;label1);</div>
<div class="line"><span class="lineno"> 1123</span>            <span class="comment">// Get the sigma value if applicable - returns 1.0 if not applicable</span></div>
<div class="line"><span class="lineno"> 1124</span>            Real sigmaOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;sigma(rt, itOuter-&gt;qualifier, itOuter-&gt;label1, calcCcy);</div>
<div class="line"><span class="lineno"> 1125</span>            <span class="comment">// Weighted curvature i.e. $CVR_{ik}$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1126</span>            <span class="comment">// WARNING: The order of multiplication here is important because unit tests fail if for</span></div>
<div class="line"><span class="lineno"> 1127</span>            <span class="comment">//          example you use sfOuter * (itOuter-&gt;amountResultCcy * multiplier) * sigmaOuter;</span></div>
<div class="line"><span class="lineno"> 1128</span>            Real wsOuter = sfOuter * ((itOuter-&gt;amountResultCcy * multiplier) * sigmaOuter);</div>
<div class="line"><span class="lineno"> 1129</span>            <span class="comment">// for ISDA SIMM 2.2 or higher, this $CVR_{ik}$ for EQ bucket 12 is zero</span></div>
<div class="line"><span class="lineno"> 1130</span>            <span class="keyword">const</span> <span class="keywordtype">string</span> simmVersion = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;version();</div>
<div class="line"><span class="lineno"> 1131</span>            <a class="code hl_enumeration" href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477">SimmVersion</a> thresholdVersion = <a class="code hl_enumvalue" href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477aad7eb289e5bbace6151c0537f09ba033">SimmVersion::V2_2</a>;</div>
<div class="line"><span class="lineno"> 1132</span>            <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;isSimmConfigCalibration() || <a class="code hl_function" href="namespaceore_1_1analytics.html#a715afb0219b3c338740f98cd349e0845">parseSimmVersion</a>(simmVersion) &gt;= thresholdVersion) &amp;&amp;</div>
<div class="line"><span class="lineno"> 1133</span>                bucket == <span class="stringliteral">&quot;12&quot;</span> &amp;&amp; rt == RiskType::EquityVol) {</div>
<div class="line"><span class="lineno"> 1134</span>                wsOuter = 0.0;</div>
<div class="line"><span class="lineno"> 1135</span>            }</div>
<div class="line"><span class="lineno"> 1136</span>            <span class="comment">// Update weighted sensitivity sum</span></div>
<div class="line"><span class="lineno"> 1137</span>            sumWeightedSensis[bucket] += wsOuter;</div>
<div class="line"><span class="lineno"> 1138</span>            sumAbsTemp[bucket][itOuter-&gt;qualifier] += rfLabels ? std::abs(wsOuter) : wsOuter;</div>
<div class="line"><span class="lineno"> 1139</span>            <span class="comment">// Add diagonal element to curvature margin</span></div>
<div class="line"><span class="lineno"> 1140</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>[bucket] += wsOuter * wsOuter;</div>
<div class="line"><span class="lineno"> 1141</span>            <span class="comment">// Add the cross elements to the curvature margin</span></div>
<div class="line"><span class="lineno"> 1142</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = pBucket.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno"> 1143</span>                <span class="comment">// Correlation, $\rho_{k,l}$ in the SIMM docs</span></div>
<div class="line"><span class="lineno"> 1144</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(rt, itOuter-&gt;qualifier, itOuter-&gt;label1, itOuter-&gt;label2,</div>
<div class="line"><span class="lineno"> 1145</span>                                                            rt, itInner-&gt;qualifier, itInner-&gt;label1, itInner-&gt;label2,</div>
<div class="line"><span class="lineno"> 1146</span>                                                            calcCcy);</div>
<div class="line"><span class="lineno"> 1147</span>                <span class="comment">// Add cross element to delta margin</span></div>
<div class="line"><span class="lineno"> 1148</span>                Real sfInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;curvatureWeight(rt, itInner-&gt;label1);</div>
<div class="line"><span class="lineno"> 1149</span>                Real sigmaInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;sigma(rt, itInner-&gt;qualifier, itInner-&gt;label1, calcCcy);</div>
<div class="line"><span class="lineno"> 1150</span>                Real wsInner = sfInner * ((itInner-&gt;amountResultCcy * multiplier) * sigmaInner);</div>
<div class="line"><span class="lineno"> 1151</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>[bucket] += 2 * corr * corr * wsOuter * wsInner;</div>
<div class="line"><span class="lineno"> 1152</span>            }</div>
<div class="line"><span class="lineno"> 1153</span>            <span class="comment">// For FX risk class, results are broken down by qualifier, i.e. currency, instead of bucket, which is not</span></div>
<div class="line"><span class="lineno"> 1154</span>            <span class="comment">// used for Risk_FX</span></div>
<div class="line"><span class="lineno"> 1155</span>            <span class="keywordflow">if</span> (riskClassIsFX)</div>
<div class="line"><span class="lineno"> 1156</span>                bucketMargins[itOuter-&gt;qualifier] += wsOuter;</div>
<div class="line"><span class="lineno"> 1157</span>        }</div>
<div class="line"><span class="lineno"> 1158</span> </div>
<div class="line"><span class="lineno"> 1159</span>        <span class="comment">// Finally have the value of $K_b$</span></div>
<div class="line"><span class="lineno"> 1160</span>        Real bucketCurvatureMargin = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>[bucket], 0.0));</div>
<div class="line"><span class="lineno"> 1161</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>[bucket] = bucketCurvatureMargin;</div>
<div class="line"><span class="lineno"> 1162</span> </div>
<div class="line"><span class="lineno"> 1163</span>        <span class="comment">// Bucket level absolute sensitivity</span></div>
<div class="line"><span class="lineno"> 1164</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; kv : sumAbsTemp[bucket]) {</div>
<div class="line"><span class="lineno"> 1165</span>            sumAbsWeightedSensis[bucket] += std::abs(kv.second);</div>
<div class="line"><span class="lineno"> 1166</span>        }</div>
<div class="line"><span class="lineno"> 1167</span>    }</div>
<div class="line"><span class="lineno"> 1168</span> </div>
<div class="line"><span class="lineno"> 1169</span>    <span class="comment">// If there is a &quot;Residual&quot; bucket entry store it separately</span></div>
<div class="line"><span class="lineno"> 1170</span>    <span class="comment">// This is $K_{residual}$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1171</span>    Real residualMargin = 0.0;</div>
<div class="line"><span class="lineno"> 1172</span>    Real residualSum = 0.0;</div>
<div class="line"><span class="lineno"> 1173</span>    Real residualAbsSum = 0.0;</div>
<div class="line"><span class="lineno"> 1174</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>.count(<span class="stringliteral">&quot;Residual&quot;</span>) &gt; 0) {</div>
<div class="line"><span class="lineno"> 1175</span>        residualMargin = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>.at(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1176</span>        residualSum = sumWeightedSensis.at(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1177</span>        residualAbsSum = sumAbsWeightedSensis.at(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1178</span>        <span class="comment">// Remove the entries for &quot;Residual&quot; bucket</span></div>
<div class="line"><span class="lineno"> 1179</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>.erase(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1180</span>        sumWeightedSensis.erase(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1181</span>        sumAbsWeightedSensis.erase(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1182</span>    }</div>
<div class="line"><span class="lineno"> 1183</span> </div>
<div class="line"><span class="lineno"> 1184</span>    <span class="comment">// Now calculate final margin</span></div>
<div class="line"><span class="lineno"> 1185</span>    Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> = 0.0;</div>
<div class="line"><span class="lineno"> 1186</span> </div>
<div class="line"><span class="lineno"> 1187</span>    <span class="comment">// First, aggregating across non-residual buckets</span></div>
<div class="line"><span class="lineno"> 1188</span>    <span class="keyword">auto</span> acc = [](<span class="keyword">const</span> Real p, <span class="keyword">const</span> pair&lt;const string, Real&gt;&amp; kv) { <span class="keywordflow">return</span> p + kv.second; };</div>
<div class="line"><span class="lineno"> 1189</span>    Real sumSensis = accumulate(sumWeightedSensis.begin(), sumWeightedSensis.end(), 0.0, acc);</div>
<div class="line"><span class="lineno"> 1190</span>    Real sumAbsSensis = accumulate(sumAbsWeightedSensis.begin(), sumAbsWeightedSensis.end(), 0.0, acc);</div>
<div class="line"><span class="lineno"> 1191</span> </div>
<div class="line"><span class="lineno"> 1192</span>    <span class="keywordflow">if</span> (!<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(sumAbsSensis, 0.0)) {</div>
<div class="line"><span class="lineno"> 1193</span>        Real theta = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(sumSensis / sumAbsSensis, 0.0);</div>
<div class="line"><span class="lineno"> 1194</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>.begin(); itOuter != <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>.end(); ++itOuter) {</div>
<div class="line"><span class="lineno"> 1195</span>            <span class="keywordtype">string</span> outerBucket = itOuter-&gt;first;</div>
<div class="line"><span class="lineno"> 1196</span>            <span class="comment">// Diagonal term</span></div>
<div class="line"><span class="lineno"> 1197</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += itOuter-&gt;second * itOuter-&gt;second;</div>
<div class="line"><span class="lineno"> 1198</span>            <span class="comment">// Cross terms</span></div>
<div class="line"><span class="lineno"> 1199</span>            <span class="comment">// $S_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1200</span>            Real sOuter = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(sumWeightedSensis.at(outerBucket), itOuter-&gt;second), -itOuter-&gt;second);</div>
<div class="line"><span class="lineno"> 1201</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno"> 1202</span>                <span class="keywordtype">string</span> innerBucket = itInner-&gt;first;</div>
<div class="line"><span class="lineno"> 1203</span>                <span class="comment">// $S_c$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1204</span>                Real sInner = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(sumWeightedSensis.at(innerBucket), itInner-&gt;second), -itInner-&gt;second);</div>
<div class="line"><span class="lineno"> 1205</span>                <span class="comment">// $\gamma_{b,c}$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1206</span>                <span class="comment">// Interface to SimmConfiguration is on qualifiers =&gt; take any qualifier from each</span></div>
<div class="line"><span class="lineno"> 1207</span>                <span class="comment">// of the respective (different) buckets to get the inter-bucket correlation</span></div>
<div class="line"><span class="lineno"> 1208</span>                <span class="keywordtype">string</span> innerQualifier = *buckets.at(innerBucket).begin();</div>
<div class="line"><span class="lineno"> 1209</span>                <span class="keywordtype">string</span> outerQualifier = *buckets.at(outerBucket).begin();</div>
<div class="line"><span class="lineno"> 1210</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlation(rt, outerQualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, rt, innerQualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, calcCcy);</div>
<div class="line"><span class="lineno"> 1211</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += 2.0 * sOuter * sInner * corr * corr;</div>
<div class="line"><span class="lineno"> 1212</span>            }</div>
<div class="line"><span class="lineno"> 1213</span>        }</div>
<div class="line"><span class="lineno"> 1214</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(sumSensis + <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5">lambda</a>(theta) * <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>, 0.0)), 0.0);</div>
<div class="line"><span class="lineno"> 1215</span>    }</div>
<div class="line"><span class="lineno"> 1216</span> </div>
<div class="line"><span class="lineno"> 1217</span>    <span class="comment">// Second, the residual bucket if necessary, and add &quot;Residual&quot; bucket back in to be added to the SIMM results</span></div>
<div class="line"><span class="lineno"> 1218</span>    <span class="keywordflow">if</span> (!<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(residualAbsSum, 0.0)) {</div>
<div class="line"><span class="lineno"> 1219</span>        Real theta = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa">min</a>(residualSum / residualAbsSum, 0.0);</div>
<div class="line"><span class="lineno"> 1220</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>[<span class="stringliteral">&quot;Residual&quot;</span>] = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(residualSum + <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5">lambda</a>(theta) * residualMargin, 0.0);</div>
<div class="line"><span class="lineno"> 1221</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>[<span class="stringliteral">&quot;Residual&quot;</span>];</div>
<div class="line"><span class="lineno"> 1222</span>    }</div>
<div class="line"><span class="lineno"> 1223</span> </div>
<div class="line"><span class="lineno"> 1224</span>    <span class="comment">// For non-FX risk class, results are broken down by buckets</span></div>
<div class="line"><span class="lineno"> 1225</span>    <span class="keywordflow">if</span> (!riskClassIsFX)</div>
<div class="line"><span class="lineno"> 1226</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; m : <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a">curvatureMargin</a>)</div>
<div class="line"><span class="lineno"> 1227</span>            bucketMargins[m.first] = m.second;</div>
<div class="line"><span class="lineno"> 1228</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1229</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; m : bucketMargins)</div>
<div class="line"><span class="lineno"> 1230</span>            m.second = std::abs(m.second);</div>
<div class="line"><span class="lineno"> 1231</span> </div>
<div class="line"><span class="lineno"> 1232</span>    bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>;</div>
<div class="line"><span class="lineno"> 1233</span>    <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1234</span>}</div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a5c1f8b37037e5cd698ccaae388982477aad7eb289e5bbace6151c0537f09ba033"><div class="ttname"><a href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477aad7eb289e5bbace6151c0537f09ba033">ore::analytics::SimmVersion::V2_2</a></div><div class="ttdeci">@ V2_2</div></div>
</div><!-- fragment --><div id="dynsection-19" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-19-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-19-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-19-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a875f25ec95261673b6f1b6f12603ed5a_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a875f25ec95261673b6f1b6f12603ed5a_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a875f25ec95261673b6f1b6f12603ed5a_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a875f25ec95261673b6f1b6f12603ed5a_cgraph">
<area shape="rect" title=" " alt="" coords="5,224,119,249"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5" title=" " alt="" coords="401,5,504,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#ae60c8d5d49613f14cf237899570ac854" title=" " alt="" coords="389,70,516,110"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a424b2c96c8b5f13080141e499c282692" title=" " alt="" coords="191,325,317,365"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5" title="Give the &#160;used in the curvature margin calculation." alt="" coords="222,389,286,415"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa" title=" " alt="" coords="223,173,285,199"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1" title=" " alt="" coords="429,165,476,191"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa" title=" " alt="" coords="431,220,474,245"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2" title=" " alt="" coords="431,269,475,295"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a715afb0219b3c338740f98cd349e0845" title=" " alt="" coords="167,439,341,479"/>
</map>
</div>
<div id="dynsection-20" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-20-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-20-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-20-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a875f25ec95261673b6f1b6f12603ed5a_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a875f25ec95261673b6f1b6f12603ed5a_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a875f25ec95261673b6f1b6f12603ed5a_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a875f25ec95261673b6f1b6f12603ed5a_icgraph">
<area shape="rect" title=" " alt="" coords="556,29,669,55"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#afa017918b1c2efd004b2d39b3aa72cdd" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,29,337,55"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a4fc0d11995a333e0808c3c20f1f93fa4" title="Calculate the Interest Rate curvature margin component for the given portfolio and product class." alt="" coords="385,55,508,80"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a7239a98428b9d2b50f6372ed1b3cb9e6" title=" " alt="" coords="5,29,120,55"/>
</map>
</div>

</div>
</div>
<a id="a4a962180a9c1082605962fd7e021892f" name="a4a962180a9c1082605962fd7e021892f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a962180a9c1082605962fd7e021892f">&#9670;&#160;</a></span>calcAddMargin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calcAddMargin </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;&#160;</td>
          <td class="paramname"><em>nsd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>regulation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> &amp;&#160;</td>
          <td class="paramname"><em>netRecords</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the additional initial margin for the portfolio ID and regulation. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l01236">1236</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1237</span>                                                                               {</div>
<div class="line"><span class="lineno"> 1238</span> </div>
<div class="line"><span class="lineno"> 1239</span>    <span class="comment">// Reference to SIMM results for this portfolio</span></div>
<div class="line"><span class="lineno"> 1240</span>    <span class="keyword">auto</span>&amp; results = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a>[side][nettingSetDetails][regulation];</div>
<div class="line"><span class="lineno"> 1241</span> </div>
<div class="line"><span class="lineno"> 1242</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> overwrite = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1243</span> </div>
<div class="line"><span class="lineno"> 1244</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno"> 1245</span>        <a class="code hl_defineRef" href="../ored/log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Calculating additional margin for portfolio [&quot;</span> &lt;&lt; nettingSetDetails &lt;&lt; <span class="stringliteral">&quot;], regulation &quot;</span> &lt;&lt; regulation</div>
<div class="line"><span class="lineno"> 1246</span>                                                             &lt;&lt; <span class="stringliteral">&quot; and SIMM side &quot;</span> &lt;&lt; side);</div>
<div class="line"><span class="lineno"> 1247</span>    }</div>
<div class="line"><span class="lineno"> 1248</span> </div>
<div class="line"><span class="lineno"> 1249</span>    <span class="comment">// First, add scaled additional margin, using &quot;ProductClassMultiplier&quot;</span></div>
<div class="line"><span class="lineno"> 1250</span>    <span class="comment">// risk type, for the portfolio</span></div>
<div class="line"><span class="lineno"> 1251</span>    <span class="keyword">auto</span> pc = ProductClass::Empty;</div>
<div class="line"><span class="lineno"> 1252</span>    <span class="keyword">auto</span> rt = RiskType::ProductClassMultiplier;</div>
<div class="line"><span class="lineno"> 1253</span>    <span class="keyword">auto</span> pIt = crif.filterBy(nettingSetDetails, pc, rt);</div>
<div class="line"><span class="lineno"> 1254</span> </div>
<div class="line"><span class="lineno"> 1255</span>    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; it : pIt) {</div>
<div class="line"><span class="lineno"> 1256</span>        <span class="comment">// Qualifier should be a product class string</span></div>
<div class="line"><span class="lineno"> 1257</span>        <span class="keyword">auto</span> qpc = <a class="code hl_function" href="namespaceore_1_1analytics.html#aed244f2f7562d5e7c86e0a3452117b9a">parseProductClass</a>(it.qualifier);</div>
<div class="line"><span class="lineno"> 1258</span>        <span class="keywordflow">if</span> (results.has(qpc, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1259</span>            Real im = results.get(qpc, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1260</span>            Real factor = it.amount;</div>
<div class="line"><span class="lineno"> 1261</span>            QL_REQUIRE(factor &gt;= 0.0, <span class="stringliteral">&quot;SIMM Calculator: Amount for risk type &quot;</span></div>
<div class="line"><span class="lineno"> 1262</span>                &lt;&lt; rt &lt;&lt; <span class="stringliteral">&quot; must be greater than or equal to 0 but we got &quot;</span> &lt;&lt; factor);</div>
<div class="line"><span class="lineno"> 1263</span>            Real pcmMargin = (factor - 1.0) * im;</div>
<div class="line"><span class="lineno"> 1264</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, qpc, RiskClass::All, MarginType::AdditionalIM, <span class="stringliteral">&quot;All&quot;</span>, pcmMargin, side,</div>
<div class="line"><span class="lineno"> 1265</span>                overwrite);</div>
<div class="line"><span class="lineno"> 1266</span> </div>
<div class="line"><span class="lineno"> 1267</span>            <span class="comment">// Add to aggregation at margin type level</span></div>
<div class="line"><span class="lineno"> 1268</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, qpc, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>, pcmMargin, side, overwrite);</div>
<div class="line"><span class="lineno"> 1269</span>            <span class="comment">// Add to aggregation at product class level</span></div>
<div class="line"><span class="lineno"> 1270</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, MarginType::AdditionalIM, <span class="stringliteral">&quot;All&quot;</span>, pcmMargin,</div>
<div class="line"><span class="lineno"> 1271</span>                side, overwrite);</div>
<div class="line"><span class="lineno"> 1272</span>            <span class="comment">// Add to aggregation at portfolio level</span></div>
<div class="line"><span class="lineno"> 1273</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>, pcmMargin, side,</div>
<div class="line"><span class="lineno"> 1274</span>                overwrite);</div>
<div class="line"><span class="lineno"> 1275</span>            CrifRecord spRecord = it;</div>
<div class="line"><span class="lineno"> 1276</span>            <span class="keywordflow">if</span> (side == SimmSide::Call)</div>
<div class="line"><span class="lineno"> 1277</span>                spRecord.collectRegulations = regulation;</div>
<div class="line"><span class="lineno"> 1278</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1279</span>                spRecord.postRegulations = regulation;</div>
<div class="line"><span class="lineno"> 1280</span>            <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a827b948d9bcabe9d9f34d1e67edfd3ef">simmParameters_</a>.<a class="code hl_function" href="classore_1_1analytics_1_1_crif.html#a7bb355daed08a7b228199a1c0b7bbee5">addRecord</a>(spRecord);</div>
<div class="line"><span class="lineno"> 1281</span>        }</div>
<div class="line"><span class="lineno"> 1282</span>    }</div>
<div class="line"><span class="lineno"> 1283</span> </div>
<div class="line"><span class="lineno"> 1284</span>    <span class="comment">// Second, add fixed amounts IM, using &quot;AddOnFixedAmount&quot; risk type, for the portfolio</span></div>
<div class="line"><span class="lineno"> 1285</span>    pIt = crif.filterBy(nettingSetDetails, pc, RiskType::AddOnFixedAmount);</div>
<div class="line"><span class="lineno"> 1286</span>    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; it : pIt){</div>
<div class="line"><span class="lineno"> 1287</span>        Real fixedMargin = it.amountResultCcy;</div>
<div class="line"><span class="lineno"> 1288</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, ProductClass::AddOnFixedAmount, RiskClass::All, MarginType::AdditionalIM,</div>
<div class="line"><span class="lineno"> 1289</span>            <span class="stringliteral">&quot;All&quot;</span>, fixedMargin, side, overwrite);</div>
<div class="line"><span class="lineno"> 1290</span> </div>
<div class="line"><span class="lineno"> 1291</span>        <span class="comment">// Add to aggregation at margin type level</span></div>
<div class="line"><span class="lineno"> 1292</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, ProductClass::AddOnFixedAmount, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>,</div>
<div class="line"><span class="lineno"> 1293</span>            fixedMargin,</div>
<div class="line"><span class="lineno"> 1294</span>            side, overwrite);</div>
<div class="line"><span class="lineno"> 1295</span>        <span class="comment">// Add to aggregation at product class level</span></div>
<div class="line"><span class="lineno"> 1296</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, MarginType::AdditionalIM, <span class="stringliteral">&quot;All&quot;</span>,</div>
<div class="line"><span class="lineno"> 1297</span>            fixedMargin, side, overwrite);</div>
<div class="line"><span class="lineno"> 1298</span>        <span class="comment">// Add to aggregation at portfolio level</span></div>
<div class="line"><span class="lineno"> 1299</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>, fixedMargin, side,</div>
<div class="line"><span class="lineno"> 1300</span>            overwrite);</div>
<div class="line"><span class="lineno"> 1301</span>        CrifRecord spRecord = it;</div>
<div class="line"><span class="lineno"> 1302</span>        <span class="keywordflow">if</span> (side == SimmSide::Call)</div>
<div class="line"><span class="lineno"> 1303</span>            spRecord.collectRegulations = regulation;</div>
<div class="line"><span class="lineno"> 1304</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1305</span>            spRecord.postRegulations = regulation;</div>
<div class="line"><span class="lineno"> 1306</span>        <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a827b948d9bcabe9d9f34d1e67edfd3ef">simmParameters_</a>.<a class="code hl_function" href="classore_1_1analytics_1_1_crif.html#a7bb355daed08a7b228199a1c0b7bbee5">addRecord</a>(spRecord);</div>
<div class="line"><span class="lineno"> 1307</span>    }</div>
<div class="line"><span class="lineno"> 1308</span> </div>
<div class="line"><span class="lineno"> 1309</span>    <span class="comment">// Third, add percentage of notional amounts IM, using &quot;AddOnNotionalFactor&quot;</span></div>
<div class="line"><span class="lineno"> 1310</span>    <span class="comment">// and &quot;Notional&quot; risk types, for the portfolio.</span></div>
<div class="line"><span class="lineno"> 1311</span>    pIt = crif.filterBy(nettingSetDetails, pc, RiskType::AddOnNotionalFactor);</div>
<div class="line"><span class="lineno"> 1312</span>    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; it : pIt){</div>
<div class="line"><span class="lineno"> 1313</span>        <span class="comment">// We should have a single corresponding CrifRecord with risk type</span></div>
<div class="line"><span class="lineno"> 1314</span>        <span class="comment">// &quot;Notional&quot; and the same qualifier. Search for it.</span></div>
<div class="line"><span class="lineno"> 1315</span>        <span class="keyword">auto</span> pQualifierIt = crif.filterByQualifier(nettingSetDetails, pc, RiskType::Notional, it.qualifier);</div>
<div class="line"><span class="lineno"> 1316</span>        <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code hl_variableRef" href="../ored/ored_2marketdata_2todaysmarket_8cpp.html#a36d2d3ec8fc39969adfd76b5ac2cfcb0">count</a> = pQualifierIt.size();</div>
<div class="line"><span class="lineno"> 1317</span>        QL_REQUIRE(count &lt; 2, <span class="stringliteral">&quot;Expected either 0 or 1 elements for risk type &quot;</span></div>
<div class="line"><span class="lineno"> 1318</span>                                                &lt;&lt; RiskType::Notional &lt;&lt; <span class="stringliteral">&quot; and qualifier &quot;</span> &lt;&lt; it.qualifier</div>
<div class="line"><span class="lineno"> 1319</span>                                                &lt;&lt; <span class="stringliteral">&quot; but got &quot;</span> &lt;&lt; count);</div>
<div class="line"><span class="lineno"> 1320</span> </div>
<div class="line"><span class="lineno"> 1321</span>        <span class="comment">// If we have found a corresponding notional, update the additional margin</span></div>
<div class="line"><span class="lineno"> 1322</span>        <span class="keywordflow">if</span> (count == 1) {</div>
<div class="line"><span class="lineno"> 1323</span>            Real notional = pQualifierIt.front().amountResultCcy;</div>
<div class="line"><span class="lineno"> 1324</span>            Real factor = it.amount;</div>
<div class="line"><span class="lineno"> 1325</span>            Real notionalFactorMargin = notional * factor / 100.0;</div>
<div class="line"><span class="lineno"> 1326</span> </div>
<div class="line"><span class="lineno"> 1327</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, ProductClass::AddOnNotionalFactor, RiskClass::All,</div>
<div class="line"><span class="lineno"> 1328</span>                MarginType::AdditionalIM, <span class="stringliteral">&quot;All&quot;</span>, notionalFactorMargin, side, overwrite);</div>
<div class="line"><span class="lineno"> 1329</span> </div>
<div class="line"><span class="lineno"> 1330</span>            <span class="comment">// Add to aggregation at margin type level</span></div>
<div class="line"><span class="lineno"> 1331</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, ProductClass::AddOnNotionalFactor, RiskClass::All, MarginType::All,</div>
<div class="line"><span class="lineno"> 1332</span>                <span class="stringliteral">&quot;All&quot;</span>,</div>
<div class="line"><span class="lineno"> 1333</span>                notionalFactorMargin, side, overwrite);</div>
<div class="line"><span class="lineno"> 1334</span>            <span class="comment">// Add to aggregation at product class level</span></div>
<div class="line"><span class="lineno"> 1335</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, MarginType::AdditionalIM, <span class="stringliteral">&quot;All&quot;</span>,</div>
<div class="line"><span class="lineno"> 1336</span>                notionalFactorMargin, side, overwrite);</div>
<div class="line"><span class="lineno"> 1337</span>            <span class="comment">// Add to aggregation at portfolio level</span></div>
<div class="line"><span class="lineno"> 1338</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>,</div>
<div class="line"><span class="lineno"> 1339</span>                notionalFactorMargin,</div>
<div class="line"><span class="lineno"> 1340</span>                side, overwrite);</div>
<div class="line"><span class="lineno"> 1341</span>            CrifRecord spRecord = it;</div>
<div class="line"><span class="lineno"> 1342</span>            <span class="keywordflow">if</span> (side == SimmSide::Call)</div>
<div class="line"><span class="lineno"> 1343</span>                spRecord.collectRegulations = regulation;</div>
<div class="line"><span class="lineno"> 1344</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1345</span>                spRecord.postRegulations = regulation;</div>
<div class="line"><span class="lineno"> 1346</span>            <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a827b948d9bcabe9d9f34d1e67edfd3ef">simmParameters_</a>.<a class="code hl_function" href="classore_1_1analytics_1_1_crif.html#a7bb355daed08a7b228199a1c0b7bbee5">addRecord</a>(spRecord);</div>
<div class="line"><span class="lineno"> 1347</span>        }</div>
<div class="line"><span class="lineno"> 1348</span>    }</div>
<div class="line"><span class="lineno"> 1349</span>}</div>
<div class="ttc" id="anamespaceore_1_1analytics_html_aed244f2f7562d5e7c86e0a3452117b9a"><div class="ttname"><a href="namespaceore_1_1analytics.html#aed244f2f7562d5e7c86e0a3452117b9a">ore::analytics::parseProductClass</a></div><div class="ttdeci">CrifRecord::ProductClass parseProductClass(const string &amp;pc)</div><div class="ttdef"><b>Definition:</b> <a href="crifrecord_8cpp_source.html#l00127">crifrecord.cpp:127</a></div></div>
<div class="ttc" id="aored_2marketdata_2todaysmarket_8cpp_html_a36d2d3ec8fc39969adfd76b5ac2cfcb0"><div class="ttname"><a href="../ored/ored_2marketdata_2todaysmarket_8cpp.html#a36d2d3ec8fc39969adfd76b5ac2cfcb0">count</a></div><div class="ttdeci">std::size_t count</div></div>
</div><!-- fragment --><div id="dynsection-21" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-21-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-21-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-21-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a4a962180a9c1082605962fd7e021892f_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a4a962180a9c1082605962fd7e021892f_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a4a962180a9c1082605962fd7e021892f_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a4a962180a9c1082605962fd7e021892f_cgraph">
<area shape="rect" title="Calculate the additional initial margin for the portfolio ID and regulation." alt="" coords="5,247,113,273"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191" title=" " alt="" coords="233,126,275,151"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a7bb355daed08a7b228199a1c0b7bbee5" title=" " alt="" coords="191,176,317,216"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#ae60c8d5d49613f14cf237899570ac854" title=" " alt="" coords="191,240,317,280"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a273f66b7ccd20b924ca6eef153e59a13" title=" " alt="" coords="191,304,317,344"/>
<area shape="rect" href="namespaceore_1_1analytics.html#aed244f2f7562d5e7c86e0a3452117b9a" title=" " alt="" coords="161,368,347,408"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a3fa77fcee599a6d59e6552d4de54f96d" title=" " alt="" coords="411,119,546,159"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#af8e82ef448e1af321ea74e009daac384" title=" " alt="" coords="406,55,551,95"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#af74e34d137c7461cb9b749825c09935f" title=" " alt="" coords="611,176,797,216"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#ab402e2cf695460498ad220674bf5ef8f" title=" " alt="" coords="395,233,563,273"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#a463e709fa1ea429189685b96fdfe7e09" title=" " alt="" coords="395,297,563,337"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#aa108b23a011189ae8fac545736305e03" title=" " alt="" coords="641,84,767,124"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#a688854e414682c97a4bcfd3105a25463" title=" " alt="" coords="860,69,1033,109"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a16b48209e840abcea676c240310b306b" title=" " alt="" coords="845,133,1048,173"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#a5bb520e16d3d5631dbf3ba33986b15e7" title=" " alt="" coords="1096,5,1264,45"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#a2014d6737c363789a01e7a05d9acfe3e" title=" " alt="" coords="1096,69,1264,109"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#aff39b5ff2ca60d42f45031609b1c70ad" title=" " alt="" coords="1096,133,1264,173"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#ab2992493966a6434cfacf416e5a1bd3b" title=" " alt="" coords="1096,197,1264,237"/>
<area shape="rect" href="structore_1_1analytics_1_1_crif_record.html#aff4f62c8f81e353a2d4fd71d150df251" title=" " alt="" coords="1096,261,1264,301"/>
<area shape="rect" target="_parent" href="../ored/classore_1_1data_1_1_j_s_o_n_message.html#a5e21eca2668ed948bdc409b19a78e5bb" title=" " alt="" coords="850,198,1043,223"/>
<area shape="rect" target="_parent" href="../ored/namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455" title=" " alt="" coords="881,247,1012,273"/>
</map>
</div>
<div id="dynsection-22" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-22-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-22-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-22-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a4a962180a9c1082605962fd7e021892f_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a4a962180a9c1082605962fd7e021892f_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a4a962180a9c1082605962fd7e021892f_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a4a962180a9c1082605962fd7e021892f_icgraph">
<area shape="rect" title="Calculate the additional initial margin for the portfolio ID and regulation." alt="" coords="385,5,493,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#afa017918b1c2efd004b2d39b3aa72cdd" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,5,337,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a7239a98428b9d2b50f6372ed1b3cb9e6" title=" " alt="" coords="5,5,120,31"/>
</map>
</div>

</div>
</div>
<a id="acdab2245e5344cc15b7c0f2da447a59b" name="acdab2245e5344cc15b7c0f2da447a59b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdab2245e5344cc15b7c0f2da447a59b">&#9670;&#160;</a></span>populateResults()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void populateResults </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;&#160;</td>
          <td class="paramname"><em>nsd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>regulation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Populate the results structure with the higher level results after the IMs have been calculated at the (product class, risk class, margin type) level for the given regulation under the given portfolio </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l01351">1351</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1352</span>                                                               {</div>
<div class="line"><span class="lineno"> 1353</span> </div>
<div class="line"><span class="lineno"> 1354</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno"> 1355</span>        <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;SimmCalculator: Populating higher level results&quot;</span>)</div>
<div class="line"><span class="lineno"> 1356</span>    }</div>
<div class="line"><span class="lineno"> 1357</span> </div>
<div class="line"><span class="lineno"> 1358</span>    <span class="comment">// Sets of classes (excluding &#39;All&#39;)</span></div>
<div class="line"><span class="lineno"> 1359</span>    <span class="keyword">auto</span> pcs = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;productClasses(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1360</span>    <span class="keyword">auto</span> rcs = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;riskClasses(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1361</span>    <span class="keyword">auto</span> mts = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;marginTypes(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1362</span> </div>
<div class="line"><span class="lineno"> 1363</span>    <span class="comment">// Populate netting set level results for each portfolio</span></div>
<div class="line"><span class="lineno"> 1364</span> </div>
<div class="line"><span class="lineno"> 1365</span>    <span class="comment">// Reference to SIMM results for this portfolio</span></div>
<div class="line"><span class="lineno"> 1366</span>    <span class="keyword">auto</span>&amp; results = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a>[side][nettingSetDetails][regulation];</div>
<div class="line"><span class="lineno"> 1367</span> </div>
<div class="line"><span class="lineno"> 1368</span>    <span class="comment">// Fill in the margin within each (product class, risk class) combination</span></div>
<div class="line"><span class="lineno"> 1369</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pc : pcs) {</div>
<div class="line"><span class="lineno"> 1370</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; rc : rcs) {</div>
<div class="line"><span class="lineno"> 1371</span>            <span class="comment">// Margin for a risk class is just sum over margin for each margin type</span></div>
<div class="line"><span class="lineno"> 1372</span>            <span class="comment">// within that risk class</span></div>
<div class="line"><span class="lineno"> 1373</span>            Real riskClassMargin = 0.0;</div>
<div class="line"><span class="lineno"> 1374</span>            <span class="keywordtype">bool</span> hasRiskClass = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1375</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; mt : mts) {</div>
<div class="line"><span class="lineno"> 1376</span>                <span class="keywordflow">if</span> (results.has(pc, rc, mt, <span class="stringliteral">&quot;All&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1377</span>                    riskClassMargin += results.get(pc, rc, mt, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1378</span>                    <span class="keywordflow">if</span> (!hasRiskClass)</div>
<div class="line"><span class="lineno"> 1379</span>                        hasRiskClass = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1380</span>                }</div>
<div class="line"><span class="lineno"> 1381</span>            }</div>
<div class="line"><span class="lineno"> 1382</span> </div>
<div class="line"><span class="lineno"> 1383</span>            <span class="comment">// Add the margin to the results if it was calculated</span></div>
<div class="line"><span class="lineno"> 1384</span>            <span class="keywordflow">if</span> (hasRiskClass) {</div>
<div class="line"><span class="lineno"> 1385</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, pc, rc, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>, riskClassMargin, side);</div>
<div class="line"><span class="lineno"> 1386</span>            }</div>
<div class="line"><span class="lineno"> 1387</span>        }</div>
<div class="line"><span class="lineno"> 1388</span>    }</div>
<div class="line"><span class="lineno"> 1389</span> </div>
<div class="line"><span class="lineno"> 1390</span>    <span class="comment">// Fill in the margin within each product class by aggregating across risk classes</span></div>
<div class="line"><span class="lineno"> 1391</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pc : pcs) {</div>
<div class="line"><span class="lineno"> 1392</span>        Real productClassMargin = 0.0;</div>
<div class="line"><span class="lineno"> 1393</span>        <span class="keywordtype">bool</span> hasProductClass = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1394</span> </div>
<div class="line"><span class="lineno"> 1395</span>        <span class="comment">// IM within product class across risk classes requires correlation</span></div>
<div class="line"><span class="lineno"> 1396</span>        <span class="comment">// o suffix =&gt; outer and i suffix =&gt; inner here</span></div>
<div class="line"><span class="lineno"> 1397</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> ito = rcs.begin(); ito != rcs.end(); ++ito) {</div>
<div class="line"><span class="lineno"> 1398</span>            <span class="comment">// Skip to next if no results for current risk class</span></div>
<div class="line"><span class="lineno"> 1399</span>            <span class="keywordflow">if</span> (!results.has(pc, *ito, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>))</div>
<div class="line"><span class="lineno"> 1400</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1401</span>            <span class="comment">// If we get to here, we have the current product class</span></div>
<div class="line"><span class="lineno"> 1402</span>            <span class="keywordflow">if</span> (!hasProductClass)</div>
<div class="line"><span class="lineno"> 1403</span>                hasProductClass = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1404</span> </div>
<div class="line"><span class="lineno"> 1405</span>            Real imo = results.get(pc, *ito, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1406</span>            <span class="comment">// Diagonal term</span></div>
<div class="line"><span class="lineno"> 1407</span>            productClassMargin += imo * imo;</div>
<div class="line"><span class="lineno"> 1408</span> </div>
<div class="line"><span class="lineno"> 1409</span>            <span class="comment">// Now, cross terms</span></div>
<div class="line"><span class="lineno"> 1410</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> iti = rcs.begin(); iti != ito; ++iti) {</div>
<div class="line"><span class="lineno"> 1411</span>                <span class="keywordflow">if</span> (!results.has(pc, *iti, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>))</div>
<div class="line"><span class="lineno"> 1412</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1413</span>                Real imi = results.get(pc, *iti, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1414</span>                <span class="comment">// Get the correlation between risk classes</span></div>
<div class="line"><span class="lineno"> 1415</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlationRiskClasses(*ito, *iti);</div>
<div class="line"><span class="lineno"> 1416</span>                productClassMargin += 2.0 * corr * imo * imi;</div>
<div class="line"><span class="lineno"> 1417</span>            }</div>
<div class="line"><span class="lineno"> 1418</span>        }</div>
<div class="line"><span class="lineno"> 1419</span> </div>
<div class="line"><span class="lineno"> 1420</span>        <span class="comment">// Add the margin to the results if it was calculated</span></div>
<div class="line"><span class="lineno"> 1421</span>        <span class="keywordflow">if</span> (hasProductClass) {</div>
<div class="line"><span class="lineno"> 1422</span>            productClassMargin = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(productClassMargin, 0.0));</div>
<div class="line"><span class="lineno"> 1423</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, pc, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>, productClassMargin, side);</div>
<div class="line"><span class="lineno"> 1424</span>        }</div>
<div class="line"><span class="lineno"> 1425</span>    }</div>
<div class="line"><span class="lineno"> 1426</span> </div>
<div class="line"><span class="lineno"> 1427</span>    <span class="comment">// Overall initial margin for the portfolio is the sum of the initial margin in</span></div>
<div class="line"><span class="lineno"> 1428</span>    <span class="comment">// each of the product classes. Could have done it in the last loop but cleaner here.</span></div>
<div class="line"><span class="lineno"> 1429</span>    Real im = 0.0;</div>
<div class="line"><span class="lineno"> 1430</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pc : pcs) {</div>
<div class="line"><span class="lineno"> 1431</span>        <span class="keywordflow">if</span> (results.has(pc, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1432</span>            im += results.get(pc, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1433</span>        }</div>
<div class="line"><span class="lineno"> 1434</span>    }</div>
<div class="line"><span class="lineno"> 1435</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>, im, side);</div>
<div class="line"><span class="lineno"> 1436</span> </div>
<div class="line"><span class="lineno"> 1437</span>    <span class="comment">// Combinations outside of the natural SIMM hierarchy</span></div>
<div class="line"><span class="lineno"> 1438</span> </div>
<div class="line"><span class="lineno"> 1439</span>    <span class="comment">// Across risk class, for each product class and margin type</span></div>
<div class="line"><span class="lineno"> 1440</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pc : pcs) {</div>
<div class="line"><span class="lineno"> 1441</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; mt : mts) {</div>
<div class="line"><span class="lineno"> 1442</span>            Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> = 0.0;</div>
<div class="line"><span class="lineno"> 1443</span>            <span class="keywordtype">bool</span> hasPcMt = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1444</span> </div>
<div class="line"><span class="lineno"> 1445</span>            <span class="comment">// IM within product class and margin type across risk classes</span></div>
<div class="line"><span class="lineno"> 1446</span>            <span class="comment">// requires correlation. o suffix =&gt; outer and i suffix =&gt; inner here</span></div>
<div class="line"><span class="lineno"> 1447</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> ito = rcs.begin(); ito != rcs.end(); ++ito) {</div>
<div class="line"><span class="lineno"> 1448</span>                <span class="comment">// Skip to next if no results for current risk class</span></div>
<div class="line"><span class="lineno"> 1449</span>                <span class="keywordflow">if</span> (!results.has(pc, *ito, mt, <span class="stringliteral">&quot;All&quot;</span>))</div>
<div class="line"><span class="lineno"> 1450</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1451</span>                <span class="comment">// If we get to here, we have the current product class &amp; margin type</span></div>
<div class="line"><span class="lineno"> 1452</span>                <span class="keywordflow">if</span> (!hasPcMt)</div>
<div class="line"><span class="lineno"> 1453</span>                    hasPcMt = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1454</span> </div>
<div class="line"><span class="lineno"> 1455</span>                Real imo = results.get(pc, *ito, mt, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1456</span>                <span class="comment">// Diagonal term</span></div>
<div class="line"><span class="lineno"> 1457</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += imo * imo;</div>
<div class="line"><span class="lineno"> 1458</span> </div>
<div class="line"><span class="lineno"> 1459</span>                <span class="comment">// Now, cross terms</span></div>
<div class="line"><span class="lineno"> 1460</span>                <span class="keywordflow">for</span> (<span class="keyword">auto</span> iti = rcs.begin(); iti != ito; ++iti) {</div>
<div class="line"><span class="lineno"> 1461</span>                    <span class="keywordflow">if</span> (!results.has(pc, *iti, mt, <span class="stringliteral">&quot;All&quot;</span>))</div>
<div class="line"><span class="lineno"> 1462</span>                        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1463</span>                    Real imi = results.get(pc, *iti, mt, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1464</span>                    <span class="comment">// Get the correlation between risk classes</span></div>
<div class="line"><span class="lineno"> 1465</span>                    Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a7a39a158ea18a8a37f1db65a59f0048b">simmConfiguration_</a>-&gt;correlationRiskClasses(*ito, *iti);</div>
<div class="line"><span class="lineno"> 1466</span>                    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += 2.0 * corr * imo * imi;</div>
<div class="line"><span class="lineno"> 1467</span>                }</div>
<div class="line"><span class="lineno"> 1468</span>            }</div>
<div class="line"><span class="lineno"> 1469</span> </div>
<div class="line"><span class="lineno"> 1470</span>            <span class="comment">// Add the margin to the results if it was calculated</span></div>
<div class="line"><span class="lineno"> 1471</span>            <span class="keywordflow">if</span> (hasPcMt) {</div>
<div class="line"><span class="lineno"> 1472</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>, 0.0));</div>
<div class="line"><span class="lineno"> 1473</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, pc, RiskClass::All, mt, <span class="stringliteral">&quot;All&quot;</span>, <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>, side);</div>
<div class="line"><span class="lineno"> 1474</span>            }</div>
<div class="line"><span class="lineno"> 1475</span>        }</div>
<div class="line"><span class="lineno"> 1476</span>    }</div>
<div class="line"><span class="lineno"> 1477</span> </div>
<div class="line"><span class="lineno"> 1478</span>    <span class="comment">// Across product class, for each risk class and margin type</span></div>
<div class="line"><span class="lineno"> 1479</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; rc : rcs) {</div>
<div class="line"><span class="lineno"> 1480</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; mt : mts) {</div>
<div class="line"><span class="lineno"> 1481</span>            Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> = 0.0;</div>
<div class="line"><span class="lineno"> 1482</span>            <span class="keywordtype">bool</span> hasRcMt = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1483</span> </div>
<div class="line"><span class="lineno"> 1484</span>            <span class="comment">// Can just sum across product class</span></div>
<div class="line"><span class="lineno"> 1485</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pc : pcs) {</div>
<div class="line"><span class="lineno"> 1486</span>                <span class="comment">// Skip to next if no results for current product class</span></div>
<div class="line"><span class="lineno"> 1487</span>                <span class="keywordflow">if</span> (!results.has(pc, rc, mt, <span class="stringliteral">&quot;All&quot;</span>))</div>
<div class="line"><span class="lineno"> 1488</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1489</span>                <span class="comment">// If we get to here, we have the current risk class &amp; margin type</span></div>
<div class="line"><span class="lineno"> 1490</span>                <span class="keywordflow">if</span> (!hasRcMt)</div>
<div class="line"><span class="lineno"> 1491</span>                    hasRcMt = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1492</span> </div>
<div class="line"><span class="lineno"> 1493</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += results.get(pc, rc, mt, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1494</span>            }</div>
<div class="line"><span class="lineno"> 1495</span> </div>
<div class="line"><span class="lineno"> 1496</span>            <span class="comment">// Add the margin to the results if it was calculated</span></div>
<div class="line"><span class="lineno"> 1497</span>            <span class="keywordflow">if</span> (hasRcMt) {</div>
<div class="line"><span class="lineno"> 1498</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, ProductClass::All, rc, mt, <span class="stringliteral">&quot;All&quot;</span>, <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>, side);</div>
<div class="line"><span class="lineno"> 1499</span>            }</div>
<div class="line"><span class="lineno"> 1500</span>        }</div>
<div class="line"><span class="lineno"> 1501</span>    }</div>
<div class="line"><span class="lineno"> 1502</span> </div>
<div class="line"><span class="lineno"> 1503</span>    <span class="comment">// Across product class and margin type for each risk class</span></div>
<div class="line"><span class="lineno"> 1504</span>    <span class="comment">// Have already computed MarginType::All results above so just need</span></div>
<div class="line"><span class="lineno"> 1505</span>    <span class="comment">// to sum over product class for each risk class here</span></div>
<div class="line"><span class="lineno"> 1506</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; rc : rcs) {</div>
<div class="line"><span class="lineno"> 1507</span>        Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> = 0.0;</div>
<div class="line"><span class="lineno"> 1508</span>        <span class="keywordtype">bool</span> hasRc = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1509</span> </div>
<div class="line"><span class="lineno"> 1510</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pc : pcs) {</div>
<div class="line"><span class="lineno"> 1511</span>            <span class="comment">// Skip to next if no results for current product class</span></div>
<div class="line"><span class="lineno"> 1512</span>            <span class="keywordflow">if</span> (!results.has(pc, rc, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>))</div>
<div class="line"><span class="lineno"> 1513</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1514</span>            <span class="comment">// If we get to here, we have the current risk class</span></div>
<div class="line"><span class="lineno"> 1515</span>            <span class="keywordflow">if</span> (!hasRc)</div>
<div class="line"><span class="lineno"> 1516</span>                hasRc = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1517</span> </div>
<div class="line"><span class="lineno"> 1518</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += results.get(pc, rc, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1519</span>        }</div>
<div class="line"><span class="lineno"> 1520</span> </div>
<div class="line"><span class="lineno"> 1521</span>        <span class="comment">// Add the margin to the results if it was calculated</span></div>
<div class="line"><span class="lineno"> 1522</span>        <span class="keywordflow">if</span> (hasRc) {</div>
<div class="line"><span class="lineno"> 1523</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, ProductClass::All, rc, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>, <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>, side);</div>
<div class="line"><span class="lineno"> 1524</span>        }</div>
<div class="line"><span class="lineno"> 1525</span>    }</div>
<div class="line"><span class="lineno"> 1526</span> </div>
<div class="line"><span class="lineno"> 1527</span>    <span class="comment">// Across product class and risk class for each margin type</span></div>
<div class="line"><span class="lineno"> 1528</span>    <span class="comment">// Have already computed RiskClass::All results above so just need</span></div>
<div class="line"><span class="lineno"> 1529</span>    <span class="comment">// to sum over product class for each margin type here</span></div>
<div class="line"><span class="lineno"> 1530</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; mt : mts) {</div>
<div class="line"><span class="lineno"> 1531</span>        Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> = 0.0;</div>
<div class="line"><span class="lineno"> 1532</span>        <span class="keywordtype">bool</span> hasMt = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1533</span> </div>
<div class="line"><span class="lineno"> 1534</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pc : pcs) {</div>
<div class="line"><span class="lineno"> 1535</span>            <span class="comment">// Skip to next if no results for current product class</span></div>
<div class="line"><span class="lineno"> 1536</span>            <span class="keywordflow">if</span> (!results.has(pc, RiskClass::All, mt, <span class="stringliteral">&quot;All&quot;</span>))</div>
<div class="line"><span class="lineno"> 1537</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1538</span>            <span class="comment">// If we get to here, we have the current risk class</span></div>
<div class="line"><span class="lineno"> 1539</span>            <span class="keywordflow">if</span> (!hasMt)</div>
<div class="line"><span class="lineno"> 1540</span>                hasMt = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1541</span> </div>
<div class="line"><span class="lineno"> 1542</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a> += results.get(pc, RiskClass::All, mt, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1543</span>        }</div>
<div class="line"><span class="lineno"> 1544</span> </div>
<div class="line"><span class="lineno"> 1545</span>        <span class="comment">// Add the margin to the results if it was calculated</span></div>
<div class="line"><span class="lineno"> 1546</span>        <span class="keywordflow">if</span> (hasMt) {</div>
<div class="line"><span class="lineno"> 1547</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, mt, <span class="stringliteral">&quot;All&quot;</span>, <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa">margin</a>, side);</div>
<div class="line"><span class="lineno"> 1548</span>        }</div>
<div class="line"><span class="lineno"> 1549</span>    }</div>
<div class="line"><span class="lineno"> 1550</span>}</div>
</div><!-- fragment --><div id="dynsection-23" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-23-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-23-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-23-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_cgraph">
<area shape="rect" title=" " alt="" coords="5,144,120,169"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#ab744e5a7cd40f8aa6042cc4c0165f191" title=" " alt="" coords="177,45,220,71"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a12dd56db004e8584b643b1e8199137fa" title=" " alt="" coords="168,119,229,144"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1" title=" " alt="" coords="317,169,364,195"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2" title=" " alt="" coords="319,219,363,244"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5" title=" " alt="" coords="289,5,392,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#ae60c8d5d49613f14cf237899570ac854" title=" " alt="" coords="277,55,404,95"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#afe4df8f9c3657399dd532e1d3c895dfa" title=" " alt="" coords="319,120,362,145"/>
</map>
</div>
<div id="dynsection-24" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-24-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-24-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-24-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_icgraph">
<area shape="rect" title=" " alt="" coords="385,5,500,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#afa017918b1c2efd004b2d39b3aa72cdd" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,5,337,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a7239a98428b9d2b50f6372ed1b3cb9e6" title=" " alt="" coords="5,5,120,31"/>
</map>
</div>

</div>
</div>
<a id="a042350faccc6edc921037241553b2b47" name="a042350faccc6edc921037241553b2b47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a042350faccc6edc921037241553b2b47">&#9670;&#160;</a></span>populateFinalResults() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void populateFinalResults </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Populate final (i.e. winning regulators') using own list of winning regulators, which were determined solely by the SIMM results (i.e. not including any external IMSchedule results) </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l01595">1595</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1595</span>                                          {</div>
<div class="line"><span class="lineno"> 1596</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a042350faccc6edc921037241553b2b47">populateFinalResults</a>(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">winningRegulations_</a>);</div>
<div class="line"><span class="lineno"> 1597</span>}</div>
</div><!-- fragment --><div id="dynsection-25" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-25-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-25-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-25-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_cgraph">
<area shape="rect" title=" " alt="" coords="5,29,148,55"/>
</map>
</div>
<div id="dynsection-26" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-26-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-26-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-26-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_icgraph">
<area shape="rect" title=" " alt="" coords="168,29,311,55"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a7239a98428b9d2b50f6372ed1b3cb9e6" title=" " alt="" coords="5,29,120,55"/>
</map>
</div>

</div>
</div>
<a id="ab744e5a7cd40f8aa6042cc4c0165f191" name="ab744e5a7cd40f8aa6042cc4c0165f191"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab744e5a7cd40f8aa6042cc4c0165f191">&#9670;&#160;</a></span>add() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void add </td>
          <td>(</td>
          <td class="paramtype">const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>regulation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#add3dc62b3016ee40b1164ca8ac1f15b4">SimmConfiguration::RiskClass</a> &amp;&#160;</td>
          <td class="paramname"><em>rc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a6a26f2b024f96bf0f329f403a135acea">SimmConfiguration::MarginType</a> &amp;&#160;</td>
          <td class="paramname"><em>mt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Real&#160;</td>
          <td class="paramname"><em>margin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>overwrite</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Add a margin result to either call or post results container depending on the <code>side</code> parameter.</p>
<dl class="section remark"><dt>Remarks</dt><dd>all additions to the results containers should happen in this method </dd></dl>
<div id="dynsection-27" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-27-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-27-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-27-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_ab744e5a7cd40f8aa6042cc4c0165f191_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_ab744e5a7cd40f8aa6042cc4c0165f191_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_ab744e5a7cd40f8aa6042cc4c0165f191_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_ab744e5a7cd40f8aa6042cc4c0165f191_icgraph">
<area shape="rect" title=" " alt="" coords="548,56,591,81"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a4a962180a9c1082605962fd7e021892f" title="Calculate the additional initial margin for the portfolio ID and regulation." alt="" coords="389,5,497,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#afa017918b1c2efd004b2d39b3aa72cdd" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,56,337,81"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#acdab2245e5344cc15b7c0f2da447a59b" title=" " alt="" coords="385,107,500,132"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a7239a98428b9d2b50f6372ed1b3cb9e6" title=" " alt="" coords="5,56,120,81"/>
</map>
</div>

</div>
</div>
<a id="a223a2fcd44f12478d3bcf85650e1a71c" name="a223a2fcd44f12478d3bcf85650e1a71c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a223a2fcd44f12478d3bcf85650e1a71c">&#9670;&#160;</a></span>add() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void add </td>
          <td>(</td>
          <td class="paramtype">const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>regulation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#add3dc62b3016ee40b1164ca8ac1f15b4">SimmConfiguration::RiskClass</a> &amp;&#160;</td>
          <td class="paramname"><em>rc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a6a26f2b024f96bf0f329f403a135acea">SimmConfiguration::MarginType</a> &amp;&#160;</td>
          <td class="paramname"><em>mt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, QuantLib::Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>margins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>overwrite</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ad795c008f1effc94d2dd140b3ba9bfe9" name="ad795c008f1effc94d2dd140b3ba9bfe9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad795c008f1effc94d2dd140b3ba9bfe9">&#9670;&#160;</a></span>splitCrifByRegulationsAndPortfolios()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void splitCrifByRegulationsAndPortfolios </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_crif.html">Crif</a> &amp;&#160;</td>
          <td class="paramname"><em>crif</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>enforceIMRegulations</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Add CRIF record to the CRIF records container that correspondsd to the given regulation/s and portfolio ID. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l01620">1620</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1620</span>                                                                                                          {</div>
<div class="line"><span class="lineno"> 1621</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; crifRecord : crif) {</div>
<div class="line"><span class="lineno"> 1622</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; side : {SimmSide::Call, SimmSide::Post}) {</div>
<div class="line"><span class="lineno"> 1623</span>            <span class="keyword">const</span> <a class="code hl_classRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a>&amp; nettingSetDetails = crifRecord.nettingSetDetails;</div>
<div class="line"><span class="lineno"> 1624</span> </div>
<div class="line"><span class="lineno"> 1625</span>            <span class="keywordtype">bool</span> collectRegsIsEmpty = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1626</span>            <span class="keywordtype">bool</span> postRegsIsEmpty = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1627</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a5ec9383d15f514091d85cc7fd697abbb">collectRegsIsEmpty_</a>.find(crifRecord.nettingSetDetails) != <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a5ec9383d15f514091d85cc7fd697abbb">collectRegsIsEmpty_</a>.end())</div>
<div class="line"><span class="lineno"> 1628</span>                collectRegsIsEmpty = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a5ec9383d15f514091d85cc7fd697abbb">collectRegsIsEmpty_</a>.at(crifRecord.nettingSetDetails);</div>
<div class="line"><span class="lineno"> 1629</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a67f8ce8eaf3735d038f954742105a97d">postRegsIsEmpty_</a>.find(crifRecord.nettingSetDetails) != <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a67f8ce8eaf3735d038f954742105a97d">postRegsIsEmpty_</a>.end())</div>
<div class="line"><span class="lineno"> 1630</span>                postRegsIsEmpty = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a67f8ce8eaf3735d038f954742105a97d">postRegsIsEmpty_</a>.at(crifRecord.nettingSetDetails);</div>
<div class="line"><span class="lineno"> 1631</span> </div>
<div class="line"><span class="lineno"> 1632</span>            <span class="keywordtype">string</span> regsString;</div>
<div class="line"><span class="lineno"> 1633</span>            <span class="keywordflow">if</span> (enforceIMRegulations)</div>
<div class="line"><span class="lineno"> 1634</span>                regsString = side == SimmSide::Call ? crifRecord.collectRegulations : crifRecord.postRegulations;</div>
<div class="line"><span class="lineno"> 1635</span>            set&lt;string&gt; regs = <a class="code hl_function" href="namespaceore_1_1analytics.html#a35d86bbe3c6d9f5c3de91441c206506e">parseRegulationString</a>(regsString);</div>
<div class="line"><span class="lineno"> 1636</span> </div>
<div class="line"><span class="lineno"> 1637</span>            <span class="keyword">auto</span> newCrifRecord = crifRecord;</div>
<div class="line"><span class="lineno"> 1638</span>            newCrifRecord.collectRegulations.clear();</div>
<div class="line"><span class="lineno"> 1639</span>            newCrifRecord.postRegulations.clear();</div>
<div class="line"><span class="lineno"> 1640</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; r : regs) {</div>
<div class="line"><span class="lineno"> 1641</span>                <span class="keywordflow">if</span> (r == <span class="stringliteral">&quot;Excluded&quot;</span> ||</div>
<div class="line"><span class="lineno"> 1642</span>                    (r == <span class="stringliteral">&quot;Unspecified&quot;</span> &amp;&amp; enforceIMRegulations &amp;&amp; !(collectRegsIsEmpty &amp;&amp; postRegsIsEmpty))) {</div>
<div class="line"><span class="lineno"> 1643</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1644</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r != <span class="stringliteral">&quot;Excluded&quot;</span>) {</div>
<div class="line"><span class="lineno"> 1645</span>                    <span class="comment">// Keep a record of trade IDs for each regulation</span></div>
<div class="line"><span class="lineno"> 1646</span>                    <span class="keywordflow">if</span> (!newCrifRecord.isSimmParameter())</div>
<div class="line"><span class="lineno"> 1647</span>                        <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#ad8588960e070f807177fb86c539c02bc">tradeIds_</a>[side][nettingSetDetails][r].insert(newCrifRecord.tradeId);</div>
<div class="line"><span class="lineno"> 1648</span>                    <span class="comment">// We make sure to ignore amountCcy when aggregating the records, since we will only be using</span></div>
<div class="line"><span class="lineno"> 1649</span>                    <span class="comment">// amountResultCcy, and we may have CRIF records that are equal everywhere except for the amountCcy,</span></div>
<div class="line"><span class="lineno"> 1650</span>                    <span class="comment">// and this will fail in the case of Risk_XCcyBasis and Risk_Inflation.</span></div>
<div class="line"><span class="lineno"> 1651</span>                    <span class="keyword">const</span> <span class="keywordtype">bool</span> onDiffAmountCcy = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1652</span>                    <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aaf77b775af6d98a512e4e434839f7781">regSensitivities_</a>[side][nettingSetDetails][r].addRecord(newCrifRecord, onDiffAmountCcy);</div>
<div class="line"><span class="lineno"> 1653</span>                }</div>
<div class="line"><span class="lineno"> 1654</span>            }</div>
<div class="line"><span class="lineno"> 1655</span>        }</div>
<div class="line"><span class="lineno"> 1656</span>    }</div>
<div class="line"><span class="lineno"> 1657</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_ad8588960e070f807177fb86c539c02bc"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#ad8588960e070f807177fb86c539c02bc">ore::analytics::SimmCalculator::tradeIds_</a></div><div class="ttdeci">std::map&lt; SimmSide, std::map&lt; ore::data::NettingSetDetails, std::map&lt; std::string, set&lt; string &gt; &gt; &gt; &gt; tradeIds_</div><div class="ttdoc">Container for keeping track of what trade IDs belong to each regulation.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00161">simmcalculator.hpp:161</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_netting_set_details_html"><div class="ttname"><a href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a></div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a35d86bbe3c6d9f5c3de91441c206506e"><div class="ttname"><a href="namespaceore_1_1analytics.html#a35d86bbe3c6d9f5c3de91441c206506e">ore::analytics::parseRegulationString</a></div><div class="ttdeci">set&lt; string &gt; parseRegulationString(const string &amp;regsString, const set&lt; string &gt; &amp;valueIfEmpty)</div><div class="ttdoc">Reads a string containing regulations applicable for a given CRIF record.</div><div class="ttdef"><b>Definition:</b> <a href="simmconfiguration_8cpp_source.html#l00315">simmconfiguration.cpp:315</a></div></div>
</div><!-- fragment --><div id="dynsection-28" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-28-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-28-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-28-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_ad795c008f1effc94d2dd140b3ba9bfe9_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_ad795c008f1effc94d2dd140b3ba9bfe9_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_ad795c008f1effc94d2dd140b3ba9bfe9_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_ad795c008f1effc94d2dd140b3ba9bfe9_cgraph">
<area shape="rect" title="Add CRIF record to the CRIF records container that correspondsd to the given regulation/s and portfol..." alt="" coords="5,5,177,45"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a35d86bbe3c6d9f5c3de91441c206506e" title="Reads a string containing regulations applicable for a given CRIF record." alt="" coords="225,5,427,45"/>
</map>
</div>
<div id="dynsection-29" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-29-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-29-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-29-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_ad795c008f1effc94d2dd140b3ba9bfe9_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_ad795c008f1effc94d2dd140b3ba9bfe9_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_ad795c008f1effc94d2dd140b3ba9bfe9_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_ad795c008f1effc94d2dd140b3ba9bfe9_icgraph">
<area shape="rect" title="Add CRIF record to the CRIF records container that correspondsd to the given regulation/s and portfol..." alt="" coords="168,5,340,45"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a7239a98428b9d2b50f6372ed1b3cb9e6" title=" " alt="" coords="5,13,120,38"/>
</map>
</div>

</div>
</div>
<a id="a3fc9a75842580e08b25fca334bdeb9d5" name="a3fc9a75842580e08b25fca334bdeb9d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fc9a75842580e08b25fca334bdeb9d5">&#9670;&#160;</a></span>lambda()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Real lambda </td>
          <td>(</td>
          <td class="paramtype">QuantLib::Real&#160;</td>
          <td class="paramname"><em>theta</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Give the \(\lambda\) used in the curvature margin calculation. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l01659">1659</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1659</span>                                            {</div>
<div class="line"><span class="lineno"> 1660</span>    <span class="comment">// Use boost inverse normal here as opposed to QL. Using QL inverse normal</span></div>
<div class="line"><span class="lineno"> 1661</span>    <span class="comment">// will cause the ISDA SIMM unit tests to fail</span></div>
<div class="line"><span class="lineno"> 1662</span>    <span class="keyword">static</span> Real q = boost::math::quantile(boost::math::normal(), 0.995);</div>
<div class="line"><span class="lineno"> 1663</span> </div>
<div class="line"><span class="lineno"> 1664</span>    <span class="keywordflow">return</span> (q * q - 1.0) * (1.0 + theta) - theta;</div>
<div class="line"><span class="lineno"> 1665</span>}</div>
</div><!-- fragment --><div id="dynsection-30" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-30-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-30-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-30-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a3fc9a75842580e08b25fca334bdeb9d5_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a3fc9a75842580e08b25fca334bdeb9d5_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a3fc9a75842580e08b25fca334bdeb9d5_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a3fc9a75842580e08b25fca334bdeb9d5_icgraph">
<area shape="rect" title="Give the &#160;used in the curvature margin calculation." alt="" coords="717,55,781,80"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a875f25ec95261673b6f1b6f12603ed5a" title=" " alt="" coords="556,29,669,55"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a4fc0d11995a333e0808c3c20f1f93fa4" title="Calculate the Interest Rate curvature margin component for the given portfolio and product class." alt="" coords="385,80,508,105"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#afa017918b1c2efd004b2d39b3aa72cdd" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,55,337,80"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a7239a98428b9d2b50f6372ed1b3cb9e6" title=" " alt="" coords="5,55,120,80"/>
</map>
</div>

</div>
</div>
<a id="a1d2bc2fd582f6814002e27b00b6d4853" name="a1d2bc2fd582f6814002e27b00b6d4853"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d2bc2fd582f6814002e27b00b6d4853">&#9670;&#160;</a></span>getQualifiers()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::set&lt; std::string &gt; getQualifiers </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_crif.html">Crif</a> &amp;&#160;</td>
          <td class="paramname"><em>crif</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a> &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structore_1_1analytics_1_1_crif_record.html#aac3c9ca896a60df32236fdc4ef53bdc9">CrifRecord::ProductClass</a> &amp;&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="structore_1_1analytics_1_1_crif_record.html#a1c18a2eca0437452edb56ef0965d3ec2">CrifRecord::RiskType</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>riskTypes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l01667">1667</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1670</span>                                                                                                          {</div>
<div class="line"><span class="lineno"> 1671</span>    std::set&lt;std::string&gt; qualifiers;</div>
<div class="line"><span class="lineno"> 1672</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; rt : riskTypes) {</div>
<div class="line"><span class="lineno"> 1673</span>        <span class="keyword">auto</span> qualis = crif.qualifiersBy(nettingSetDetails, pc, rt);</div>
<div class="line"><span class="lineno"> 1674</span>        qualifiers.insert(qualis.begin(), qualis.end());</div>
<div class="line"><span class="lineno"> 1675</span>    }</div>
<div class="line"><span class="lineno"> 1676</span>    <span class="keywordflow">return</span> qualifiers;</div>
<div class="line"><span class="lineno"> 1677</span>}</div>
</div><!-- fragment --><div id="dynsection-31" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-31-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-31-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-31-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a1d2bc2fd582f6814002e27b00b6d4853_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a1d2bc2fd582f6814002e27b00b6d4853_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a1d2bc2fd582f6814002e27b00b6d4853_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a1d2bc2fd582f6814002e27b00b6d4853_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,100,38"/>
<area shape="rect" href="classore_1_1analytics_1_1_crif.html#a19aa28193073c2c75dd9f1e214054d7d" title=" " alt="" coords="148,5,275,45"/>
</map>
</div>
<div id="dynsection-32" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-32-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-32-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-32-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a1d2bc2fd582f6814002e27b00b6d4853_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a1d2bc2fd582f6814002e27b00b6d4853_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a1d2bc2fd582f6814002e27b00b6d4853_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a1d2bc2fd582f6814002e27b00b6d4853_icgraph">
<area shape="rect" title=" " alt="" coords="556,55,651,80"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a4fc0d11995a333e0808c3c20f1f93fa4" title="Calculate the Interest Rate curvature margin component for the given portfolio and product class." alt="" coords="385,5,508,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a2f30844efa1be083cc9096e5eb411454" title="Calculate the Interest Rate delta margin component for the given portfolio and product class." alt="" coords="397,55,496,80"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a40608992cde449b98628de2df0eff046" title="Calculate the Interest Rate vega margin component for the given portfolio and product class." alt="" coords="397,104,496,129"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#afa017918b1c2efd004b2d39b3aa72cdd" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,55,337,80"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a7239a98428b9d2b50f6372ed1b3cb9e6" title=" " alt="" coords="5,55,120,80"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="abf2dee0df927335cc4a8907e2c26bbbd" name="abf2dee0df927335cc4a8907e2c26bbbd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf2dee0df927335cc4a8907e2c26bbbd">&#9670;&#160;</a></span>crif_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> crif_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>All the net sensitivities passed in for the calculation. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00112">112</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="aaf77b775af6d98a512e4e434839f7781" name="aaf77b775af6d98a512e4e434839f7781"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf77b775af6d98a512e4e434839f7781">&#9670;&#160;</a></span>regSensitivities_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt;<a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::map&lt;std::string, <a class="el" href="classore_1_1analytics_1_1_crif.html">Crif</a>&gt; &gt; &gt; regSensitivities_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Net sentivities at the regulation level within each netting set. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00115">115</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="a827b948d9bcabe9d9f34d1e67edfd3ef" name="a827b948d9bcabe9d9f34d1e67edfd3ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a827b948d9bcabe9d9f34d1e67edfd3ef">&#9670;&#160;</a></span>simmParameters_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classore_1_1analytics_1_1_crif.html">ore::analytics::Crif</a> simmParameters_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Record of SIMM parameters that were used in the calculation. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00118">118</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="a7a39a158ea18a8a37f1db65a59f0048b" name="a7a39a158ea18a8a37f1db65a59f0048b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a39a158ea18a8a37f1db65a59f0048b">&#9670;&#160;</a></span>simmConfiguration_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::ext::shared_ptr&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html">SimmConfiguration</a>&gt; simmConfiguration_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The SIMM configuration governing the calculation. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00121">121</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="a3c2fc9fbb2d2df2e4a97152bde680460" name="a3c2fc9fbb2d2df2e4a97152bde680460"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c2fc9fbb2d2df2e4a97152bde680460">&#9670;&#160;</a></span>calculationCcyCall_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string calculationCcyCall_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The SIMM exposure calculation currency i.e. the currency for which FX delta risk is ignored. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00124">124</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="abc16565c54ac283038b1e2114635cd43" name="abc16565c54ac283038b1e2114635cd43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc16565c54ac283038b1e2114635cd43">&#9670;&#160;</a></span>calculationCcyPost_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string calculationCcyPost_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00124">124</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="aed547488155ddce90f75d9ade15d0764" name="aed547488155ddce90f75d9ade15d0764"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed547488155ddce90f75d9ade15d0764">&#9670;&#160;</a></span>resultCcy_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string resultCcy_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The SIMM result currency i.e. the currency in which the main SIMM results are denominated. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00127">127</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="aa14f759693736cf0438f0e6ff1a792fe" name="aa14f759693736cf0438f0e6ff1a792fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa14f759693736cf0438f0e6ff1a792fe">&#9670;&#160;</a></span>market_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::ext::shared_ptr&lt;<a class="elRef" href="../ored/classore_1_1data_1_1_market.html">ore::data::Market</a>&gt; market_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Market data for FX rates to use for converting amounts to USD. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00130">130</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="aa2fedb3c02ffb092a6c19a0ee1e81a02" name="aa2fedb3c02ffb092a6c19a0ee1e81a02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2fedb3c02ffb092a6c19a0ee1e81a02">&#9670;&#160;</a></span>quiet_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> quiet_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If true, no logging is written out. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00133">133</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="a2b0763dca4cfeddb14b14c992a4ec115" name="a2b0763dca4cfeddb14b14c992a4ec115"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b0763dca4cfeddb14b14c992a4ec115">&#9670;&#160;</a></span>hasSEC_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::set&lt;<a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a>&gt; &gt; hasSEC_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00135">135</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="a294f980933859f258720759c50392d25" name="a294f980933859f258720759c50392d25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a294f980933859f258720759c50392d25">&#9670;&#160;</a></span>hasCFTC_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::set&lt;<a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a>&gt; &gt; hasCFTC_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00135">135</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="a5ec9383d15f514091d85cc7fd697abbb" name="a5ec9383d15f514091d85cc7fd697abbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ec9383d15f514091d85cc7fd697abbb">&#9670;&#160;</a></span>collectRegsIsEmpty_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, <a class="el" href="classbool.html">bool</a>&gt; collectRegsIsEmpty_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>For each netting set, whether all CRIF records' collect regulations are empty. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00138">138</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="a67f8ce8eaf3735d038f954742105a97d" name="a67f8ce8eaf3735d038f954742105a97d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67f8ce8eaf3735d038f954742105a97d">&#9670;&#160;</a></span>postRegsIsEmpty_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, <a class="el" href="classbool.html">bool</a>&gt; postRegsIsEmpty_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>For each netting set, whether all CRIF records' post regulations are empty. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00141">141</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="a4b33acd9c41c58660a2f82e5f43963c4" name="a4b33acd9c41c58660a2f82e5f43963c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b33acd9c41c58660a2f82e5f43963c4">&#9670;&#160;</a></span>winningRegulations_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt;<a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::string&gt; &gt; winningRegulations_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Regulation with highest initial margin for each given netting set. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00145">145</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="a66ce6144aef4f726c92ef4ddaf4afe64" name="a66ce6144aef4f726c92ef4ddaf4afe64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66ce6144aef4f726c92ef4ddaf4afe64">&#9670;&#160;</a></span>simmResults_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt;<a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::map&lt;std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a>&gt; &gt; &gt; simmResults_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Containers, one for call and post, with a map containing a <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> object for each regulation under each portfolio ID </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00151">151</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="aa86bb7338b370ccfabfd1b6d218a5fb8" name="aa86bb7338b370ccfabfd1b6d218a5fb8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa86bb7338b370ccfabfd1b6d218a5fb8">&#9670;&#160;</a></span>finalSimmResults_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt;<a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::pair&lt;std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a>&gt; &gt; &gt; finalSimmResults_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Containers, one for call and post, with a <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> object for each portfolio ID, and each margin amount is that of the winning regulation applicable to the portfolio ID </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00157">157</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="ad8588960e070f807177fb86c539c02bc" name="ad8588960e070f807177fb86c539c02bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8588960e070f807177fb86c539c02bc">&#9670;&#160;</a></span>tradeIds_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt;<a class="elRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a>, std::map&lt;std::string, set&lt;string&gt; &gt; &gt; &gt; tradeIds_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Container for keeping track of what trade IDs belong to each regulation. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00161">161</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="acf6d3f08c36da850265818577b6c5111" name="acf6d3f08c36da850265818577b6c5111"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf6d3f08c36da850265818577b6c5111">&#9670;&#160;</a></span>finalTradeIds_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, set&lt;string&gt; &gt; finalTradeIds_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00163">163</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.9.5
</small></address>
</body>
</html>
