<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<title>OREAnalytics: SimmCalculator Class Reference</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="oreaextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-analytics@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.10</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceore.html">ore</a></li><li class="navelem"><a class="el" href="namespaceore_1_1analytics.html">analytics</a></li><li class="navelem"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html">SimmCalculator</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classore_1_1analytics_1_1_simm_calculator-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">SimmCalculator Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>A class to calculate SIMM given a set of aggregated CRIF results for one or more portfolios.  
 <a href="classore_1_1analytics_1_1_simm_calculator.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="simmcalculator_8hpp_source.html">orea/simm/simmcalculator.hpp</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for SimmCalculator:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator__coll__graph.png" border="0" usemap="#a_simm_calculator_coll__map" alt="Collaboration graph"/></div>
<map name="a_simm_calculator_coll__map" id="a_simm_calculator_coll__map">
<area shape="rect" title="A class to calculate SIMM given a set of aggregated CRIF results for one or more portfolios." alt="" coords="1501,1105,1691,1571"/>
<area shape="rect" title=" " alt="" coords="5,416,739,1043"/>
<area shape="rect" title=" " alt="" coords="1646,680,1863,779"/>
<area shape="rect" title=" " alt="" coords="1906,233,1993,273"/>
<area shape="rect" title=" " alt="" coords="1184,695,1371,764"/>
<area shape="rect" title=" " alt="" coords="1908,687,2135,771"/>
<area shape="rect" title=" " alt="" coords="2599,687,2862,771"/>
<area shape="rect" title=" " alt="" coords="763,687,957,771"/>
<area shape="rect" title=" " alt="" coords="2256,702,2405,757"/>
<area shape="rect" title=" " alt="" coords="1333,211,1569,295"/>
<area shape="rect" title=" " alt="" coords="1777,233,1876,273"/>
<area shape="rect" title=" " alt="" coords="2253,5,2291,45"/>
<area shape="rect" title=" " alt="" coords="2391,108,2468,148"/>
<area shape="rect" title=" " alt="" coords="1807,108,1846,148"/>
<area shape="rect" title=" " alt="" coords="982,702,1159,757"/>
<area shape="rect" title=" " alt="" coords="2513,108,2572,148"/>
<area shape="rect" title=" " alt="" coords="2431,233,2531,273"/>
<area shape="rect" title=" " alt="" coords="2469,5,2616,45"/>
<area shape="rect" title=" " alt="" coords="1395,702,1546,757"/>
<area shape="rect" title=" " alt="" coords="1571,709,1621,749"/>
<area shape="rect" title=" " alt="" coords="983,225,1166,280"/>
<area shape="rect" title=" " alt="" coords="2021,211,2203,295"/>
<area shape="rect" title=" " alt="" coords="2754,211,2937,295"/>
<area shape="rect" title=" " alt="" coords="607,218,790,287"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:afbff2a0e62c01d190bc46ff1461f7ddc"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmConfiguration::SimmSide</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#afbff2a0e62c01d190bc46ff1461f7ddc">SimmSide</a></td></tr>
<tr class="separator:afbff2a0e62c01d190bc46ff1461f7ddc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a5492abea466c6543ca7a9a98cc747061"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a5492abea466c6543ca7a9a98cc747061">SimmCalculator</a> (const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;simmNetSensitivities, const boost::shared_ptr&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html">SimmConfiguration</a> &gt; &amp;simmConfiguration, const std::string &amp;calculationCcy=&quot;USD&quot;, const std::string &amp;resultCcy=&quot;&quot;, const boost::shared_ptr&lt; ore::data::Market &gt; market=nullptr, const bool determineWinningRegulations=true, const bool enforceIMRegulations=false, const bool quiet=false)</td></tr>
<tr class="separator:a5492abea466c6543ca7a9a98cc747061"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abae54a48ef781027382517a9b0573bcb"><td class="memItemLeft" align="right" valign="top">const void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#abae54a48ef781027382517a9b0573bcb">calculateRegulationSimm</a> (const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;netRecords, const ore::data::NettingSetDetails &amp;nsd, const string &amp;regulation, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side)</td></tr>
<tr class="memdesc:abae54a48ef781027382517a9b0573bcb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates SIMM for a given regulation under a given netting set.  <a href="classore_1_1analytics_1_1_simm_calculator.html#abae54a48ef781027382517a9b0573bcb">More...</a><br /></td></tr>
<tr class="separator:abae54a48ef781027382517a9b0573bcb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8414527d1a5f3a71ae4bb31e6721d652"><td class="memItemLeft" align="right" valign="top">const std::string &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a8414527d1a5f3a71ae4bb31e6721d652">winningRegulations</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const ore::data::NettingSetDetails &amp;nettingSetDetails) const</td></tr>
<tr class="memdesc:a8414527d1a5f3a71ae4bb31e6721d652"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the winning regulation for each netting set.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a8414527d1a5f3a71ae4bb31e6721d652">More...</a><br /></td></tr>
<tr class="separator:a8414527d1a5f3a71ae4bb31e6721d652"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c411b3c186350a6cf759b4b6306baf6"><td class="memItemLeft" align="right" valign="top">const std::map&lt; ore::data::NettingSetDetails, string &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a7c411b3c186350a6cf759b4b6306baf6">winningRegulations</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side) const</td></tr>
<tr class="separator:a7c411b3c186350a6cf759b4b6306baf6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a766fc790a5e25235a2083f09f21011df"><td class="memItemLeft" align="right" valign="top">const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; ore::data::NettingSetDetails, string &gt; &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df">winningRegulations</a> () const</td></tr>
<tr class="separator:a766fc790a5e25235a2083f09f21011df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c484da72c93ba30b8fc72c6fd9d1592"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a0c484da72c93ba30b8fc72c6fd9d1592">simmResults</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const ore::data::NettingSetDetails &amp;nettingSetDetails, const std::string &amp;regulation) const</td></tr>
<tr class="memdesc:a0c484da72c93ba30b8fc72c6fd9d1592"><td class="mdescLeft">&#160;</td><td class="mdescRight">Give back the SIMM results container for the given portfolioId and SIMM side.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a0c484da72c93ba30b8fc72c6fd9d1592">More...</a><br /></td></tr>
<tr class="separator:a0c484da72c93ba30b8fc72c6fd9d1592"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cd92f588dc4b6adacf65aa6be29154e"><td class="memItemLeft" align="right" valign="top">const std::map&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a7cd92f588dc4b6adacf65aa6be29154e">simmResults</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const ore::data::NettingSetDetails &amp;nettingSetDetails) const</td></tr>
<tr class="separator:a7cd92f588dc4b6adacf65aa6be29154e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a043645c8f888e4793f5551c56cfda568"><td class="memItemLeft" align="right" valign="top">const std::map&lt; ore::data::NettingSetDetails, std::map&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a043645c8f888e4793f5551c56cfda568">simmResults</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side) const</td></tr>
<tr class="separator:a043645c8f888e4793f5551c56cfda568"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a009eb0a808f969304a75263fa81bb9bd"><td class="memItemLeft" align="right" valign="top">const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; ore::data::NettingSetDetails, std::map&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a009eb0a808f969304a75263fa81bb9bd">simmResults</a> () const</td></tr>
<tr class="separator:a009eb0a808f969304a75263fa81bb9bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3081990cf985ebb99a3d7f5a9b53a015"><td class="memItemLeft" align="right" valign="top">const std::pair&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a3081990cf985ebb99a3d7f5a9b53a015">finalSimmResults</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const ore::data::NettingSetDetails &amp;nettingSetDetails) const</td></tr>
<tr class="memdesc:a3081990cf985ebb99a3d7f5a9b53a015"><td class="mdescLeft">&#160;</td><td class="mdescRight">Give back the SIMM results container for the given netting set and SIMM side.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a3081990cf985ebb99a3d7f5a9b53a015">More...</a><br /></td></tr>
<tr class="separator:a3081990cf985ebb99a3d7f5a9b53a015"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e3384043ef38de3c8a063d6bcb134f2"><td class="memItemLeft" align="right" valign="top">const std::map&lt; ore::data::NettingSetDetails, std::pair&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a1e3384043ef38de3c8a063d6bcb134f2">finalSimmResults</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side) const</td></tr>
<tr class="separator:a1e3384043ef38de3c8a063d6bcb134f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a892df1a5c65ab07fefdc01d5c057ad66"><td class="memItemLeft" align="right" valign="top">const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; ore::data::NettingSetDetails, std::pair&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a892df1a5c65ab07fefdc01d5c057ad66">finalSimmResults</a> () const</td></tr>
<tr class="separator:a892df1a5c65ab07fefdc01d5c057ad66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c7eea9571d36346abceb7dfa72091b5"><td class="memItemLeft" align="right" valign="top">const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::set&lt; std::string &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a1c7eea9571d36346abceb7dfa72091b5">finalTradeIds</a> () const</td></tr>
<tr class="separator:a1c7eea9571d36346abceb7dfa72091b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1e5ad6cbecb8c2af1fdeb70d4b06a35"><td class="memItemLeft" align="right" valign="top">const std::string &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#aa1e5ad6cbecb8c2af1fdeb70d4b06a35">calculationCurrency</a> () const</td></tr>
<tr class="memdesc:aa1e5ad6cbecb8c2af1fdeb70d4b06a35"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the calculator's calculation currency.  <a href="classore_1_1analytics_1_1_simm_calculator.html#aa1e5ad6cbecb8c2af1fdeb70d4b06a35">More...</a><br /></td></tr>
<tr class="separator:aa1e5ad6cbecb8c2af1fdeb70d4b06a35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a957d4a9347f400dc03534f2c4ae9975a"><td class="memItemLeft" align="right" valign="top">const std::string &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a957d4a9347f400dc03534f2c4ae9975a">resultCurrency</a> () const</td></tr>
<tr class="memdesc:a957d4a9347f400dc03534f2c4ae9975a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the calculator's result currency.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a957d4a9347f400dc03534f2c4ae9975a">More...</a><br /></td></tr>
<tr class="separator:a957d4a9347f400dc03534f2c4ae9975a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa936c119f6230d0eed00b790981bef02"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#aa936c119f6230d0eed00b790981bef02">populateFinalResults</a> (const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; ore::data::NettingSetDetails, std::string &gt; &gt; &amp;<a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a8414527d1a5f3a71ae4bb31e6721d652">winningRegulations</a>)</td></tr>
<tr class="separator:aa936c119f6230d0eed00b790981bef02"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a1fd4a0251381cf52e9bfe88653277c00"><td class="memItemLeft" align="right" valign="top">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a1fd4a0251381cf52e9bfe88653277c00">irDeltaMargin</a> (const ore::data::NettingSetDetails &amp;nettingSetDetails, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#aac3c9ca896a60df32236fdc4ef53bdc9">SimmConfiguration::ProductClass</a> &amp;pc, const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;netRecords) const</td></tr>
<tr class="memdesc:a1fd4a0251381cf52e9bfe88653277c00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the Interest Rate delta margin component for the given portfolio and product class.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a1fd4a0251381cf52e9bfe88653277c00">More...</a><br /></td></tr>
<tr class="separator:a1fd4a0251381cf52e9bfe88653277c00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ea36c0dc24d0c5d96c1f0e0eb539b61"><td class="memItemLeft" align="right" valign="top">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a4ea36c0dc24d0c5d96c1f0e0eb539b61">irVegaMargin</a> (const ore::data::NettingSetDetails &amp;nettingSetDetails, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#aac3c9ca896a60df32236fdc4ef53bdc9">SimmConfiguration::ProductClass</a> &amp;pc, const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;netRecords) const</td></tr>
<tr class="memdesc:a4ea36c0dc24d0c5d96c1f0e0eb539b61"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the Interest Rate vega margin component for the given portfolio and product class.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a4ea36c0dc24d0c5d96c1f0e0eb539b61">More...</a><br /></td></tr>
<tr class="separator:a4ea36c0dc24d0c5d96c1f0e0eb539b61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cc5da0fd2177b68717c733484631787"><td class="memItemLeft" align="right" valign="top">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a6cc5da0fd2177b68717c733484631787">irCurvatureMargin</a> (const ore::data::NettingSetDetails &amp;nettingSetDetails, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#aac3c9ca896a60df32236fdc4ef53bdc9">SimmConfiguration::ProductClass</a> &amp;pc, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;netRecords) const</td></tr>
<tr class="memdesc:a6cc5da0fd2177b68717c733484631787"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the Interest Rate curvature margin component for the given portfolio and product class.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a6cc5da0fd2177b68717c733484631787">More...</a><br /></td></tr>
<tr class="separator:a6cc5da0fd2177b68717c733484631787"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28bf3bff3398397c2a09711c5ba1770f"><td class="memItemLeft" align="right" valign="top">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> (const ore::data::NettingSetDetails &amp;nettingSetDetails, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#aac3c9ca896a60df32236fdc4ef53bdc9">SimmConfiguration::ProductClass</a> &amp;pc, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a1c18a2eca0437452edb56ef0965d3ec2">SimmConfiguration::RiskType</a> &amp;rt, const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;netRecords) const</td></tr>
<tr class="separator:a28bf3bff3398397c2a09711c5ba1770f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab44b983595e1e6c3a0776a474c7313e7"><td class="memItemLeft" align="right" valign="top">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a> (const ore::data::NettingSetDetails &amp;nettingSetDetails, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#aac3c9ca896a60df32236fdc4ef53bdc9">SimmConfiguration::ProductClass</a> &amp;pc, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a1c18a2eca0437452edb56ef0965d3ec2">SimmConfiguration::RiskType</a> &amp;rt, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;netRecords, bool rfLabels=true) const</td></tr>
<tr class="separator:ab44b983595e1e6c3a0776a474c7313e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ebc63fe274dc9049972ebd3bc5af82f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a4ebc63fe274dc9049972ebd3bc5af82f">calcAddMargin</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const ore::data::NettingSetDetails &amp;nsd, const string &amp;regulation, const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;netRecords)</td></tr>
<tr class="memdesc:a4ebc63fe274dc9049972ebd3bc5af82f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the additional initial margin for the portfolio ID and regulation.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a4ebc63fe274dc9049972ebd3bc5af82f">More...</a><br /></td></tr>
<tr class="separator:a4ebc63fe274dc9049972ebd3bc5af82f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdab2245e5344cc15b7c0f2da447a59b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#acdab2245e5344cc15b7c0f2da447a59b">populateResults</a> (const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const ore::data::NettingSetDetails &amp;nsd, const string &amp;regulation)</td></tr>
<tr class="separator:acdab2245e5344cc15b7c0f2da447a59b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a042350faccc6edc921037241553b2b47"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a042350faccc6edc921037241553b2b47">populateFinalResults</a> ()</td></tr>
<tr class="separator:a042350faccc6edc921037241553b2b47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82003566bd426f075cc443927b2182b7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a> (const ore::data::NettingSetDetails &amp;nettingSetDetails, const string &amp;regulation, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#aac3c9ca896a60df32236fdc4ef53bdc9">SimmConfiguration::ProductClass</a> &amp;pc, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#add3dc62b3016ee40b1164ca8ac1f15b4">SimmConfiguration::RiskClass</a> &amp;rc, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a6a26f2b024f96bf0f329f403a135acea">SimmConfiguration::MarginType</a> &amp;mt, const std::string &amp;b, QuantLib::Real <a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>, <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> side, const bool overwrite=true)</td></tr>
<tr class="separator:a82003566bd426f075cc443927b2182b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad65d7673455fe8dbd2774818bbc6a3b4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#ad65d7673455fe8dbd2774818bbc6a3b4">add</a> (const ore::data::NettingSetDetails &amp;nettingSetDetails, const string &amp;regulation, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#aac3c9ca896a60df32236fdc4ef53bdc9">SimmConfiguration::ProductClass</a> &amp;pc, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#add3dc62b3016ee40b1164ca8ac1f15b4">SimmConfiguration::RiskClass</a> &amp;rc, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a6a26f2b024f96bf0f329f403a135acea">SimmConfiguration::MarginType</a> &amp;mt, const std::map&lt; std::string, QuantLib::Real &gt; &amp;margins, <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> side, const bool overwrite=true)</td></tr>
<tr class="separator:ad65d7673455fe8dbd2774818bbc6a3b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f5038214f94409386a43dcbd802813c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a5f5038214f94409386a43dcbd802813c">addCrifRecord</a> (const <a class="el" href="structore_1_1analytics_1_1_crif_record.html">CrifRecord</a> &amp;crifRecord, const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;side, const bool enforceIMRegulations)</td></tr>
<tr class="memdesc:a5f5038214f94409386a43dcbd802813c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add CRIF record to the CRIF records container that correspondsd to the given regulation/s and portfolio ID.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a5f5038214f94409386a43dcbd802813c">More...</a><br /></td></tr>
<tr class="separator:a5f5038214f94409386a43dcbd802813c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fc9a75842580e08b25fca334bdeb9d5"><td class="memItemLeft" align="right" valign="top">QuantLib::Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5">lambda</a> (QuantLib::Real theta) const</td></tr>
<tr class="memdesc:a3fc9a75842580e08b25fca334bdeb9d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Give the \(\lambda\) used in the curvature margin calculation.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5">More...</a><br /></td></tr>
<tr class="separator:a3fc9a75842580e08b25fca334bdeb9d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9510513007fdd3344eef216776cad63a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a9510513007fdd3344eef216776cad63a">convert</a> ()</td></tr>
<tr class="memdesc:a9510513007fdd3344eef216776cad63a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert all results to the calculation currency.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a9510513007fdd3344eef216776cad63a">More...</a><br /></td></tr>
<tr class="separator:a9510513007fdd3344eef216776cad63a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:afb00980c461e4d2601bb4b5f7e95bc6f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#afb00980c461e4d2601bb4b5f7e95bc6f">simmNetSensitivities_</a></td></tr>
<tr class="memdesc:afb00980c461e4d2601bb4b5f7e95bc6f"><td class="mdescLeft">&#160;</td><td class="mdescRight">All the net sensitivities passed in for the calculation.  <a href="classore_1_1analytics_1_1_simm_calculator.html#afb00980c461e4d2601bb4b5f7e95bc6f">More...</a><br /></td></tr>
<tr class="separator:afb00980c461e4d2601bb4b5f7e95bc6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a241d3f226b3000f03e324623fb3ac520"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; ore::data::NettingSetDetails, std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1analytics_1_1_crif_loader.html">CrifLoader</a> &gt; &gt; &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a241d3f226b3000f03e324623fb3ac520">regSensitivities_</a></td></tr>
<tr class="memdesc:a241d3f226b3000f03e324623fb3ac520"><td class="mdescLeft">&#160;</td><td class="mdescRight">Net sentivities at the regulation level within each netting set.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a241d3f226b3000f03e324623fb3ac520">More...</a><br /></td></tr>
<tr class="separator:a241d3f226b3000f03e324623fb3ac520"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90a8aa9a543924db944fe86246cd9231"><td class="memItemLeft" align="right" valign="top">boost::shared_ptr&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html">SimmConfiguration</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a></td></tr>
<tr class="memdesc:a90a8aa9a543924db944fe86246cd9231"><td class="mdescLeft">&#160;</td><td class="mdescRight">The SIMM configuration governing the calculation.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">More...</a><br /></td></tr>
<tr class="separator:a90a8aa9a543924db944fe86246cd9231"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb36b19e887d4397b44b9e9d0ec34f52"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a></td></tr>
<tr class="memdesc:abb36b19e887d4397b44b9e9d0ec34f52"><td class="mdescLeft">&#160;</td><td class="mdescRight">The SIMM exposure calculation currency i.e. the currency for which FX delta risk is ignored.  <a href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">More...</a><br /></td></tr>
<tr class="separator:abb36b19e887d4397b44b9e9d0ec34f52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed547488155ddce90f75d9ade15d0764"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a></td></tr>
<tr class="memdesc:aed547488155ddce90f75d9ade15d0764"><td class="mdescLeft">&#160;</td><td class="mdescRight">The SIMM result currency i.e. the currency in which the main SIMM results are denominated.  <a href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">More...</a><br /></td></tr>
<tr class="separator:aed547488155ddce90f75d9ade15d0764"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a231130240241304481b20503059a9864"><td class="memItemLeft" align="right" valign="top">boost::shared_ptr&lt; ore::data::Market &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a231130240241304481b20503059a9864">market_</a></td></tr>
<tr class="memdesc:a231130240241304481b20503059a9864"><td class="mdescLeft">&#160;</td><td class="mdescRight">Market data for FX rates to use for converting amounts to USD.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a231130240241304481b20503059a9864">More...</a><br /></td></tr>
<tr class="separator:a231130240241304481b20503059a9864"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2fedb3c02ffb092a6c19a0ee1e81a02"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a></td></tr>
<tr class="memdesc:aa2fedb3c02ffb092a6c19a0ee1e81a02"><td class="mdescLeft">&#160;</td><td class="mdescRight">If true, no logging is written out.  <a href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">More...</a><br /></td></tr>
<tr class="separator:aa2fedb3c02ffb092a6c19a0ee1e81a02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b33acd9c41c58660a2f82e5f43963c4"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; ore::data::NettingSetDetails, std::string &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">winningRegulations_</a></td></tr>
<tr class="memdesc:a4b33acd9c41c58660a2f82e5f43963c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Regulation with highest initial margin for each given netting set.  <a href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">More...</a><br /></td></tr>
<tr class="separator:a4b33acd9c41c58660a2f82e5f43963c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66ce6144aef4f726c92ef4ddaf4afe64"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; ore::data::NettingSetDetails, std::map&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a></td></tr>
<tr class="separator:a66ce6144aef4f726c92ef4ddaf4afe64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa86bb7338b370ccfabfd1b6d218a5fb8"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; ore::data::NettingSetDetails, std::pair&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#aa86bb7338b370ccfabfd1b6d218a5fb8">finalSimmResults_</a></td></tr>
<tr class="separator:aa86bb7338b370ccfabfd1b6d218a5fb8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8588960e070f807177fb86c539c02bc"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; ore::data::NettingSetDetails, std::map&lt; std::string, set&lt; string &gt; &gt; &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#ad8588960e070f807177fb86c539c02bc">tradeIds_</a></td></tr>
<tr class="memdesc:ad8588960e070f807177fb86c539c02bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Container for keeping track of what trade IDs belong to each regulation.  <a href="classore_1_1analytics_1_1_simm_calculator.html#ad8588960e070f807177fb86c539c02bc">More...</a><br /></td></tr>
<tr class="separator:ad8588960e070f807177fb86c539c02bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf6d3f08c36da850265818577b6c5111"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, set&lt; string &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html#acf6d3f08c36da850265818577b6c5111">finalTradeIds_</a></td></tr>
<tr class="separator:acf6d3f08c36da850265818577b6c5111"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >A class to calculate SIMM given a set of aggregated CRIF results for one or more portfolios. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00036">36</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a id="afbff2a0e62c01d190bc46ff1461f7ddc" name="afbff2a0e62c01d190bc46ff1461f7ddc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afbff2a0e62c01d190bc46ff1461f7ddc">&#9670;&#160;</a></span>SimmSide</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmConfiguration::SimmSide</a> <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00038">38</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a5492abea466c6543ca7a9a98cc747061" name="a5492abea466c6543ca7a9a98cc747061"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5492abea466c6543ca7a9a98cc747061">&#9670;&#160;</a></span>SimmCalculator()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classore_1_1analytics_1_1_simm_calculator.html">SimmCalculator</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;&#160;</td>
          <td class="paramname"><em>simmNetSensitivities</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const boost::shared_ptr&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html">SimmConfiguration</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>simmConfiguration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>calculationCcy</em> = <code>&quot;USD&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>resultCcy</em> = <code>&quot;&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const boost::shared_ptr&lt; ore::data::Market &gt;&#160;</td>
          <td class="paramname"><em>market</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>determineWinningRegulations</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>enforceIMRegulations</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>quiet</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Construct the <a class="el" href="classore_1_1analytics_1_1_simm_calculator.html" title="A class to calculate SIMM given a set of aggregated CRIF results for one or more portfolios.">SimmCalculator</a> from a container of netted CRIF records and a SIMM configuration. The SIMM number is initially calculated in USD using the AmountUSD column. It can optionally be converted to a calculation currency other than USD by using the <code>calculationCcy</code> parameter. If the <code>calculationCcy</code> is not USD then the <code>usdSpot</code> parameter must be used to give the FX spot rate between USD and the <code>calculationCcy</code>. This spot rate is interpreted as the number of USD per unit of <code>calculationCcy</code>. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00064">64</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   69</span>    : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#afb00980c461e4d2601bb4b5f7e95bc6f">simmNetSensitivities_</a>(simmNetSensitivities), <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>(simmConfiguration),</div>
<div class="line"><span class="lineno">   70</span>      <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>(calculationCcy), <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a>(resultCcy.empty() ? <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a> : resultCcy), <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a231130240241304481b20503059a9864">market_</a>(market),</div>
<div class="line"><span class="lineno">   71</span>      <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>(quiet) {</div>
<div class="line"><span class="lineno">   72</span> </div>
<div class="line"><span class="lineno">   73</span>    QL_REQUIRE(checkCurrency(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>),</div>
<div class="line"><span class="lineno">   74</span>               <span class="stringliteral">&quot;SIMM Calculator: The calculation currency (&quot;</span> &lt;&lt; <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a> &lt;&lt; <span class="stringliteral">&quot;) must be a valid ISO currency code&quot;</span>);</div>
<div class="line"><span class="lineno">   75</span>    QL_REQUIRE(checkCurrency(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a>),</div>
<div class="line"><span class="lineno">   76</span>               <span class="stringliteral">&quot;SIMM Calculator: The result currency (&quot;</span> &lt;&lt; <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a> &lt;&lt; <span class="stringliteral">&quot;) must be a valid ISO currency code&quot;</span>);</div>
<div class="line"><span class="lineno">   77</span> </div>
<div class="line"><span class="lineno">   78</span>    <a class="code hl_typedef" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> tmp;</div>
<div class="line"><span class="lineno">   79</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> CrifRecord&amp; cr : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#afb00980c461e4d2601bb4b5f7e95bc6f">simmNetSensitivities_</a>) {</div>
<div class="line"><span class="lineno">   80</span>        <span class="keyword">const</span> <span class="keywordtype">bool</span> isSchedule = cr.imModel == <span class="stringliteral">&quot;Schedule&quot;</span>;</div>
<div class="line"><span class="lineno">   81</span> </div>
<div class="line"><span class="lineno">   82</span>        <span class="keywordflow">if</span> (isSchedule) {</div>
<div class="line"><span class="lineno">   83</span>            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a> &amp;&amp; determineWinningRegulations) {</div>
<div class="line"><span class="lineno">   84</span>                WLOG(ore::data::StructuredTradeWarningMessage(cr.tradeId, cr.tradeType, <span class="stringliteral">&quot;SIMM calculator&quot;</span>, <span class="stringliteral">&quot;Skipping over Schedule CRIF record&quot;</span>));</div>
<div class="line"><span class="lineno">   85</span>            } </div>
<div class="line"><span class="lineno">   86</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">   87</span>        }</div>
<div class="line"><span class="lineno">   88</span> </div>
<div class="line"><span class="lineno">   89</span>        tmp.insert(cr);</div>
<div class="line"><span class="lineno">   90</span>    }</div>
<div class="line"><span class="lineno">   91</span> </div>
<div class="line"><span class="lineno">   92</span>    <span class="comment">// If there are no CRIF records to process</span></div>
<div class="line"><span class="lineno">   93</span>    <span class="keywordflow">if</span> (tmp.empty())</div>
<div class="line"><span class="lineno">   94</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">   95</span>    </div>
<div class="line"><span class="lineno">   96</span>    <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#afb00980c461e4d2601bb4b5f7e95bc6f">simmNetSensitivities_</a> = tmp;</div>
<div class="line"><span class="lineno">   97</span> </div>
<div class="line"><span class="lineno">   98</span>    <span class="comment">// Add CRIF records to each regulation under each netting set</span></div>
<div class="line"><span class="lineno">   99</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno">  100</span>        LOG(<span class="stringliteral">&quot;SimmCalculator: Splitting up original CRIF records into their respective collect/post regulations&quot;</span>);</div>
<div class="line"><span class="lineno">  101</span>    }</div>
<div class="line"><span class="lineno">  102</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> CrifRecord&amp; crifRecord : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#afb00980c461e4d2601bb4b5f7e95bc6f">simmNetSensitivities_</a>) {</div>
<div class="line"><span class="lineno">  103</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a5f5038214f94409386a43dcbd802813c">addCrifRecord</a>(crifRecord, SimmSide::Call, enforceIMRegulations);</div>
<div class="line"><span class="lineno">  104</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a5f5038214f94409386a43dcbd802813c">addCrifRecord</a>(crifRecord, SimmSide::Post, enforceIMRegulations);</div>
<div class="line"><span class="lineno">  105</span>    }</div>
<div class="line"><span class="lineno">  106</span> </div>
<div class="line"><span class="lineno">  107</span>    <span class="comment">// Some additional processing depending on the regulations applicable to each netting set</span></div>
<div class="line"><span class="lineno">  108</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; sv : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a241d3f226b3000f03e324623fb3ac520">regSensitivities_</a>) {</div>
<div class="line"><span class="lineno">  109</span>        </div>
<div class="line"><span class="lineno">  110</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; s : sv.second) {</div>
<div class="line"><span class="lineno">  111</span>            <span class="comment">// Where there is SEC and CFTC in the portfolio, we add the CFTC trades to SEC,</span></div>
<div class="line"><span class="lineno">  112</span>            <span class="comment">// but still continue with CFTC calculations</span></div>
<div class="line"><span class="lineno">  113</span>            <span class="keyword">const</span> <span class="keywordtype">bool</span> hasCFTC = s.second.count(<span class="stringliteral">&quot;CFTC&quot;</span>) &gt; 0;</div>
<div class="line"><span class="lineno">  114</span>            <span class="keyword">const</span> <span class="keywordtype">bool</span> hasSEC = s.second.count(<span class="stringliteral">&quot;SEC&quot;</span>) &gt; 0;</div>
<div class="line"><span class="lineno">  115</span>            <span class="keywordflow">if</span> (hasCFTC &amp;&amp; hasSEC) {</div>
<div class="line"><span class="lineno">  116</span>                <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a>&amp; netRecordsCFTC = s.second.at(<span class="stringliteral">&quot;CFTC&quot;</span>)-&gt;netRecords(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  117</span>                <span class="keyword">const</span> <a class="code hl_typedef" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a>&amp; netRecordsSEC = s.second.at(<span class="stringliteral">&quot;SEC&quot;</span>)-&gt;netRecords(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  118</span>                <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; cr : netRecordsCFTC) {</div>
<div class="line"><span class="lineno">  119</span>                    <span class="comment">// Only add CFTC records to SEC if the record was not already in SEC,</span></div>
<div class="line"><span class="lineno">  120</span>                    <span class="comment">// i.e. we skip over CRIF records with regulations specified as e.g. &quot;..., CFTC, SEC, ...&quot;</span></div>
<div class="line"><span class="lineno">  121</span>                    <span class="keywordflow">if</span> (netRecordsSEC.find(cr) == netRecordsSEC.end()) {</div>
<div class="line"><span class="lineno">  122</span>                        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno">  123</span>                            DLOG(<span class="stringliteral">&quot;SimmCalculator: Inserting CRIF record with CFTC &quot;</span></div>
<div class="line"><span class="lineno">  124</span>                                &lt;&lt; s.first &lt;&lt; <span class="stringliteral">&quot; regulation into SEC CRIF records: &quot;</span> &lt;&lt; cr);</div>
<div class="line"><span class="lineno">  125</span>                        }</div>
<div class="line"><span class="lineno">  126</span>                        s.second.at(<span class="stringliteral">&quot;SEC&quot;</span>)-&gt;add(cr);</div>
<div class="line"><span class="lineno">  127</span>                    }</div>
<div class="line"><span class="lineno">  128</span>                }</div>
<div class="line"><span class="lineno">  129</span>            }</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>            <span class="comment">// If netting set has &quot;Unspecified&quot; plus other regulations, the &quot;Unspecified&quot; sensis are to be excluded.</span></div>
<div class="line"><span class="lineno">  132</span>            <span class="comment">// If netting set only has &quot;Unspecified&quot;, then no regulations were ever specified, so all trades are</span></div>
<div class="line"><span class="lineno">  133</span>            <span class="comment">// included.</span></div>
<div class="line"><span class="lineno">  134</span>            <span class="keywordflow">if</span> (s.second.count(<span class="stringliteral">&quot;Unspecified&quot;</span>) &gt; 0 &amp;&amp; s.second.size() &gt; 1)</div>
<div class="line"><span class="lineno">  135</span>                s.second.erase(<span class="stringliteral">&quot;Unspecified&quot;</span>);</div>
<div class="line"><span class="lineno">  136</span>        }</div>
<div class="line"><span class="lineno">  137</span>    }</div>
<div class="line"><span class="lineno">  138</span> </div>
<div class="line"><span class="lineno">  139</span>    <span class="comment">// For each netting set, if only one side&#39;s regulations are populated, the other side&#39;s sensis should be excluded.</span></div>
<div class="line"><span class="lineno">  140</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; ns : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a241d3f226b3000f03e324623fb3ac520">regSensitivities_</a>.at(SimmSide::Call)) {</div>
<div class="line"><span class="lineno">  141</span>        <span class="keyword">auto</span>&amp; netSetCollect = ns.second;</div>
<div class="line"><span class="lineno">  142</span>        <span class="keywordtype">bool</span> collectRegsIsEmpty = netSetCollect.size() == 1 &amp;&amp; netSetCollect.count(<span class="stringliteral">&quot;Unspecified&quot;</span>) == 1;</div>
<div class="line"><span class="lineno">  143</span> </div>
<div class="line"><span class="lineno">  144</span>        <span class="keyword">auto</span>&amp; netSetPost = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a241d3f226b3000f03e324623fb3ac520">regSensitivities_</a>.at(SimmSide::Post).at(ns.first);</div>
<div class="line"><span class="lineno">  145</span>        <span class="keywordtype">bool</span> postRegsIsEmpty = netSetPost.size() == 1 &amp;&amp; netSetPost.count(<span class="stringliteral">&quot;Unspecified&quot;</span>) == 1;</div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>        <span class="keywordflow">if</span> (collectRegsIsEmpty &amp;&amp; !postRegsIsEmpty)</div>
<div class="line"><span class="lineno">  148</span>            netSetCollect.erase(<span class="stringliteral">&quot;Unspecified&quot;</span>);</div>
<div class="line"><span class="lineno">  149</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!collectRegsIsEmpty &amp;&amp; postRegsIsEmpty)</div>
<div class="line"><span class="lineno">  150</span>            netSetPost.erase(<span class="stringliteral">&quot;Unspecified&quot;</span>);</div>
<div class="line"><span class="lineno">  151</span>    }</div>
<div class="line"><span class="lineno">  152</span> </div>
<div class="line"><span class="lineno">  153</span>    <span class="comment">// Calculate SIMM call and post for each regulation under each netting set</span></div>
<div class="line"><span class="lineno">  154</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; sv : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a241d3f226b3000f03e324623fb3ac520">regSensitivities_</a>) {</div>
<div class="line"><span class="lineno">  155</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="classore_1_1analytics_1_1_simm_calculator.html#afbff2a0e62c01d190bc46ff1461f7ddc">SimmSide</a> side = sv.first;</div>
<div class="line"><span class="lineno">  156</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; nettingSetSensis : sv.second) {</div>
<div class="line"><span class="lineno">  157</span>            <span class="keyword">const</span> NettingSetDetails&amp; nsd = nettingSetSensis.first;</div>
<div class="line"><span class="lineno">  158</span> </div>
<div class="line"><span class="lineno">  159</span>            <span class="comment">// Calculate SIMM for particular side-nettingSet-regulation combination</span></div>
<div class="line"><span class="lineno">  160</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; regSensis : nettingSetSensis.second) {</div>
<div class="line"><span class="lineno">  161</span>                <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; regulation = regSensis.first;</div>
<div class="line"><span class="lineno">  162</span>                <span class="keywordtype">bool</span> hasFixedAddOn = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  163</span>                <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; sp : regSensis.second-&gt;simmParameters())</div>
<div class="line"><span class="lineno">  164</span>                    <span class="keywordflow">if</span> (sp.riskType == RiskType::AddOnFixedAmount) {</div>
<div class="line"><span class="lineno">  165</span>                        hasFixedAddOn = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  166</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  167</span>                    }</div>
<div class="line"><span class="lineno">  168</span>                <span class="keywordflow">if</span> (regSensis.second-&gt;hasCrifRecords() || hasFixedAddOn)</div>
<div class="line"><span class="lineno">  169</span>                    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#abae54a48ef781027382517a9b0573bcb">calculateRegulationSimm</a>(regSensis.second-&gt;netRecords(<span class="keyword">true</span>), nsd, regulation, side);</div>
<div class="line"><span class="lineno">  170</span>            }</div>
<div class="line"><span class="lineno">  171</span>        }</div>
<div class="line"><span class="lineno">  172</span>    }</div>
<div class="line"><span class="lineno">  173</span> </div>
<div class="line"><span class="lineno">  174</span>    <span class="comment">// Convert to result currency</span></div>
<div class="line"><span class="lineno">  175</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a9510513007fdd3344eef216776cad63a">convert</a>();</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>    <span class="comment">// Determine winning call and post regulations</span></div>
<div class="line"><span class="lineno">  178</span>    <span class="keywordflow">if</span> (determineWinningRegulations) {</div>
<div class="line"><span class="lineno">  179</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno">  180</span>            LOG(<span class="stringliteral">&quot;SimmCalculator: Determining winning regulations&quot;</span>);</div>
<div class="line"><span class="lineno">  181</span>        }</div>
<div class="line"><span class="lineno">  182</span> </div>
<div class="line"><span class="lineno">  183</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> sv : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a>) {</div>
<div class="line"><span class="lineno">  184</span>            <span class="keyword">const</span> <a class="code hl_typedef" href="classore_1_1analytics_1_1_simm_calculator.html#afbff2a0e62c01d190bc46ff1461f7ddc">SimmSide</a> side = sv.first;</div>
<div class="line"><span class="lineno">  185</span> </div>
<div class="line"><span class="lineno">  186</span>            <span class="comment">// Determine winning (call and post) regulation for each netting set</span></div>
<div class="line"><span class="lineno">  187</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; kv : sv.second) {</div>
<div class="line"><span class="lineno">  188</span> </div>
<div class="line"><span class="lineno">  189</span>                <span class="comment">// Collect margin amounts and determine the highest margin amount</span></div>
<div class="line"><span class="lineno">  190</span>                Real winningMargin = std::numeric_limits&lt;Real&gt;::min();</div>
<div class="line"><span class="lineno">  191</span>                map&lt;string, Real&gt; nettingSetMargins;</div>
<div class="line"><span class="lineno">  192</span>                std::vector&lt;Real&gt; margins;</div>
<div class="line"><span class="lineno">  193</span>                <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; regSimmResults : kv.second) {</div>
<div class="line"><span class="lineno">  194</span>                    <span class="keyword">const</span> Real&amp; im = regSimmResults.second.get(ProductClass::All, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno">  195</span>                    nettingSetMargins[regSimmResults.first] = im;</div>
<div class="line"><span class="lineno">  196</span>                    <span class="keywordflow">if</span> (im &gt; winningMargin)</div>
<div class="line"><span class="lineno">  197</span>                        winningMargin = im;</div>
<div class="line"><span class="lineno">  198</span>                }</div>
<div class="line"><span class="lineno">  199</span> </div>
<div class="line"><span class="lineno">  200</span>                <span class="comment">// Determine winning regulations, i.e. regulations under which we find the highest margin amount</span></div>
<div class="line"><span class="lineno">  201</span>                std::vector&lt;string&gt; <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df">winningRegulations</a>;</div>
<div class="line"><span class="lineno">  202</span>                <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; kv : nettingSetMargins) {</div>
<div class="line"><span class="lineno">  203</span>                    <span class="keywordflow">if</span> (close_enough(kv.second, winningMargin))</div>
<div class="line"><span class="lineno">  204</span>                        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df">winningRegulations</a>.push_back(kv.first);</div>
<div class="line"><span class="lineno">  205</span>                }</div>
<div class="line"><span class="lineno">  206</span> </div>
<div class="line"><span class="lineno">  207</span>                <span class="comment">// In the case of multiple winning regulations, pick one based on the priority in the list</span></div>
<div class="line"><span class="lineno">  208</span>                <span class="comment">//const Regulation winningRegulation = oreplus::analytics::getWinningRegulation(winningRegulations);</span></div>
<div class="line"><span class="lineno">  209</span>                <span class="keywordtype">string</span> winningRegulation = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df">winningRegulations</a>.size() &gt; 1</div>
<div class="line"><span class="lineno">  210</span>                                               ? to_string(<a class="code hl_function" href="namespaceore_1_1analytics.html#a35b7448b894b55dc772909ded32db916">getWinningRegulation</a>(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df">winningRegulations</a>))</div>
<div class="line"><span class="lineno">  211</span>                                               : <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df">winningRegulations</a>.at(0);</div>
<div class="line"><span class="lineno">  212</span> </div>
<div class="line"><span class="lineno">  213</span>                <span class="comment">// Populate internal list of winning regulators</span></div>
<div class="line"><span class="lineno">  214</span>                <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">winningRegulations_</a>[side][kv.first] = to_string(winningRegulation);</div>
<div class="line"><span class="lineno">  215</span>            }</div>
<div class="line"><span class="lineno">  216</span>        }</div>
<div class="line"><span class="lineno">  217</span> </div>
<div class="line"><span class="lineno">  218</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a042350faccc6edc921037241553b2b47">populateFinalResults</a>();</div>
<div class="line"><span class="lineno">  219</span>    }</div>
<div class="line"><span class="lineno">  220</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a042350faccc6edc921037241553b2b47"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a042350faccc6edc921037241553b2b47">ore::analytics::SimmCalculator::populateFinalResults</a></div><div class="ttdeci">void populateFinalResults()</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l01633">simmcalculator.cpp:1633</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a231130240241304481b20503059a9864"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a231130240241304481b20503059a9864">ore::analytics::SimmCalculator::market_</a></div><div class="ttdeci">boost::shared_ptr&lt; ore::data::Market &gt; market_</div><div class="ttdoc">Market data for FX rates to use for converting amounts to USD.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00119">simmcalculator.hpp:119</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a241d3f226b3000f03e324623fb3ac520"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a241d3f226b3000f03e324623fb3ac520">ore::analytics::SimmCalculator::regSensitivities_</a></div><div class="ttdeci">std::map&lt; SimmSide, std::map&lt; ore::data::NettingSetDetails, std::map&lt; std::string, boost::shared_ptr&lt; CrifLoader &gt; &gt; &gt; &gt; regSensitivities_</div><div class="ttdoc">Net sentivities at the regulation level within each netting set.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00107">simmcalculator.hpp:107</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a4b33acd9c41c58660a2f82e5f43963c4"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">ore::analytics::SimmCalculator::winningRegulations_</a></div><div class="ttdeci">std::map&lt; SimmSide, std::map&lt; ore::data::NettingSetDetails, std::string &gt; &gt; winningRegulations_</div><div class="ttdoc">Regulation with highest initial margin for each given netting set.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00126">simmcalculator.hpp:126</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a5f5038214f94409386a43dcbd802813c"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a5f5038214f94409386a43dcbd802813c">ore::analytics::SimmCalculator::addCrifRecord</a></div><div class="ttdeci">void addCrifRecord(const CrifRecord &amp;crifRecord, const SimmSide &amp;side, const bool enforceIMRegulations)</div><div class="ttdoc">Add CRIF record to the CRIF records container that correspondsd to the given regulation/s and portfol...</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l01657">simmcalculator.cpp:1657</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a66ce6144aef4f726c92ef4ddaf4afe64"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">ore::analytics::SimmCalculator::simmResults_</a></div><div class="ttdeci">std::map&lt; SimmSide, std::map&lt; ore::data::NettingSetDetails, std::map&lt; std::string, SimmResults &gt; &gt; &gt; simmResults_</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00132">simmcalculator.hpp:132</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a766fc790a5e25235a2083f09f21011df"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df">ore::analytics::SimmCalculator::winningRegulations</a></div><div class="ttdeci">const std::map&lt; SimmSide, std::map&lt; ore::data::NettingSetDetails, string &gt; &gt; &amp; winningRegulations() const</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l00370">simmcalculator.cpp:370</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a90a8aa9a543924db944fe86246cd9231"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">ore::analytics::SimmCalculator::simmConfiguration_</a></div><div class="ttdeci">boost::shared_ptr&lt; SimmConfiguration &gt; simmConfiguration_</div><div class="ttdoc">The SIMM configuration governing the calculation.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00110">simmcalculator.hpp:110</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a9510513007fdd3344eef216776cad63a"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a9510513007fdd3344eef216776cad63a">ore::analytics::SimmCalculator::convert</a></div><div class="ttdeci">void convert()</div><div class="ttdoc">Convert all results to the calculation currency.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l01692">simmcalculator.cpp:1692</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_aa2fedb3c02ffb092a6c19a0ee1e81a02"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">ore::analytics::SimmCalculator::quiet_</a></div><div class="ttdeci">bool quiet_</div><div class="ttdoc">If true, no logging is written out.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00122">simmcalculator.hpp:122</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_abae54a48ef781027382517a9b0573bcb"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#abae54a48ef781027382517a9b0573bcb">ore::analytics::SimmCalculator::calculateRegulationSimm</a></div><div class="ttdeci">const void calculateRegulationSimm(const SimmNetSensitivities &amp;netRecords, const ore::data::NettingSetDetails &amp;nsd, const string &amp;regulation, const SimmSide &amp;side)</div><div class="ttdoc">Calculates SIMM for a given regulation under a given netting set.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l00222">simmcalculator.cpp:222</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_abb36b19e887d4397b44b9e9d0ec34f52"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">ore::analytics::SimmCalculator::calculationCcy_</a></div><div class="ttdeci">std::string calculationCcy_</div><div class="ttdoc">The SIMM exposure calculation currency i.e. the currency for which FX delta risk is ignored.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00113">simmcalculator.hpp:113</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_aed547488155ddce90f75d9ade15d0764"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">ore::analytics::SimmCalculator::resultCcy_</a></div><div class="ttdeci">std::string resultCcy_</div><div class="ttdoc">The SIMM result currency i.e. the currency in which the main SIMM results are denominated.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00116">simmcalculator.hpp:116</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_afb00980c461e4d2601bb4b5f7e95bc6f"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#afb00980c461e4d2601bb4b5f7e95bc6f">ore::analytics::SimmCalculator::simmNetSensitivities_</a></div><div class="ttdeci">SimmNetSensitivities simmNetSensitivities_</div><div class="ttdoc">All the net sensitivities passed in for the calculation.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00104">simmcalculator.hpp:104</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_afbff2a0e62c01d190bc46ff1461f7ddc"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#afbff2a0e62c01d190bc46ff1461f7ddc">ore::analytics::SimmCalculator::SimmSide</a></div><div class="ttdeci">SimmConfiguration::SimmSide SimmSide</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00038">simmcalculator.hpp:38</a></div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a35b7448b894b55dc772909ded32db916"><div class="ttname"><a href="namespaceore_1_1analytics.html#a35b7448b894b55dc772909ded32db916">ore::analytics::getWinningRegulation</a></div><div class="ttdeci">SimmConfiguration::Regulation getWinningRegulation(const std::vector&lt; string &gt; &amp;winningRegulations)</div><div class="ttdoc">From a vector of regulations, determine the winning regulation based on order of priority.</div><div class="ttdef"><b>Definition:</b> <a href="simmconfiguration_8cpp_source.html#l00569">simmconfiguration.cpp:569</a></div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a9d8a3ff6040fc0182ac0f12d94f1a213"><div class="ttname"><a href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">ore::analytics::SimmNetSensitivities</a></div><div class="ttdeci">boost::multi_index_container&lt; CrifRecord, boost::multi_index::indexed_by&lt; boost::multi_index::ordered_unique&lt; boost::multi_index::identity&lt; CrifRecord &gt; &gt;, boost::multi_index::ordered_non_unique&lt; boost::multi_index::tag&lt; TradeIdTag &gt;, boost::multi_index::composite_key&lt; CrifRecord, boost::multi_index::member&lt; CrifRecord, std::string, &amp;CrifRecord::tradeId &gt; &gt; &gt;, boost::multi_index::ordered_non_unique&lt; boost::multi_index::tag&lt; PortfolioTag &gt;, boost::multi_index::composite_key&lt; CrifRecord, boost::multi_index::member&lt; CrifRecord, NettingSetDetails, &amp;CrifRecord::nettingSetDetails &gt; &gt; &gt;, boost::multi_index::ordered_non_unique&lt; boost::multi_index::tag&lt; ProductClassTag &gt;, boost::multi_index::composite_key&lt; CrifRecord, boost::multi_index::member&lt; CrifRecord, NettingSetDetails, &amp;CrifRecord::nettingSetDetails &gt;, boost::multi_index::member&lt; CrifRecord, SimmConfiguration::ProductClass, &amp;CrifRecord::productClass &gt; &gt; &gt;, boost::multi_index::ordered_non_unique&lt; boost::multi_index::tag&lt; RiskTypeTag &gt;, boost::multi_index::composite_key&lt; CrifRecord, boost::multi_index::member&lt; CrifRecord, NettingSetDetails, &amp;CrifRecord::nettingSetDetails &gt;, boost::multi_index::member&lt; CrifRecord, SimmConfiguration::ProductClass, &amp;CrifRecord::productClass &gt;, boost::multi_index::member&lt; CrifRecord, SimmConfiguration::RiskType, &amp;CrifRecord::riskType &gt; &gt; &gt;, boost::multi_index::ordered_non_unique&lt; boost::multi_index::tag&lt; QualifierTag &gt;, boost::multi_index::composite_key&lt; CrifRecord, boost::multi_index::member&lt; CrifRecord, NettingSetDetails, &amp;CrifRecord::nettingSetDetails &gt;, boost::multi_index::member&lt; CrifRecord, SimmConfiguration::ProductClass, &amp;CrifRecord::productClass &gt;, boost::multi_index::member&lt; CrifRecord, SimmConfiguration::RiskType, &amp;CrifRecord::riskType &gt;, boost::multi_index::member&lt; CrifRecord, std::string, &amp;CrifRecord::qualifier &gt; &gt; &gt;, boost::multi_index::ordered_non_unique&lt; boost::multi_index::tag&lt; BucketQualifierTag &gt;, boost::multi_index::composite_key&lt; CrifRecord, boost::multi_index::member&lt; CrifRecord, NettingSetDetails, &amp;CrifRecord::nettingSetDetails &gt;, boost::multi_index::member&lt; CrifRecord, SimmConfiguration::ProductClass, &amp;CrifRecord::productClass &gt;, boost::multi_index::member&lt; CrifRecord, SimmConfiguration::RiskType, &amp;CrifRecord::riskType &gt;, boost::multi_index::member&lt; CrifRecord, std::string, &amp;CrifRecord::bucket &gt;, boost::multi_index::member&lt; CrifRecord, std::string, &amp;CrifRecord::qualifier &gt; &gt; &gt;, boost::multi_index::ordered_non_unique&lt; boost::multi_index::tag&lt; BucketTag &gt;, boost::multi_index::composite_key&lt; CrifRecord, boost::multi_index::member&lt; CrifRecord, NettingSetDetails, &amp;CrifRecord::nettingSetDetails &gt;, boost::multi_index::member&lt; CrifRecord, SimmConfiguration::ProductClass, &amp;CrifRecord::productClass &gt;, boost::multi_index::member&lt; CrifRecord, SimmConfiguration::RiskType, &amp;CrifRecord::riskType &gt;, boost::multi_index::member&lt; CrifRecord, std::string, &amp;CrifRecord::bucket &gt; &gt; &gt; &gt; &gt; SimmNetSensitivities</div><div class="ttdef"><b>Definition:</b> <a href="crifrecord_8hpp_source.html#l00218">crifrecord.hpp:218</a></div></div>
</div><!-- fragment --><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a5492abea466c6543ca7a9a98cc747061_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a5492abea466c6543ca7a9a98cc747061_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a5492abea466c6543ca7a9a98cc747061_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a5492abea466c6543ca7a9a98cc747061_cgraph">
<area shape="rect" title=" " alt="" coords="5,374,120,400"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a5f5038214f94409386a43dcbd802813c" title="Add CRIF record to the CRIF records container that correspondsd to the given regulation/s and portfol..." alt="" coords="203,154,306,180"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#abae54a48ef781027382517a9b0573bcb" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="170,296,339,321"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a9510513007fdd3344eef216776cad63a" title="Convert all results to the calculation currency." alt="" coords="223,345,286,370"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a35b7448b894b55dc772909ded32db916" title="From a vector of regulations, determine the winning regulation based on order of priority." alt="" coords="168,395,341,435"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a042350faccc6edc921037241553b2b47" title=" " alt="" coords="183,484,326,509"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a766fc790a5e25235a2083f09f21011df" title=" " alt="" coords="188,533,321,558"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a35d86bbe3c6d9f5c3de91441c206506e" title="Reads a string containing regulations applicable for a given CRIF record." alt="" coords="389,30,591,70"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7" title=" " alt="" coords="705,422,747,448"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a4ebc63fe274dc9049972ebd3bc5af82f" title="Calculate the additional initial margin for the portfolio ID and regulation." alt="" coords="436,473,544,498"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7" title=" " alt="" coords="669,69,783,94"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f" title=" " alt="" coords="918,246,979,272"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a6cc5da0fd2177b68717c733484631787" title="Calculate the Interest Rate curvature margin component for the given portfolio and product class." alt="" coords="429,145,551,170"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a1fd4a0251381cf52e9bfe88653277c00" title="Calculate the Interest Rate delta margin component for the given portfolio and product class." alt="" coords="677,221,775,246"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a4ea36c0dc24d0c5d96c1f0e0eb539b61" title="Calculate the Interest Rate vega margin component for the given portfolio and product class." alt="" coords="677,270,775,296"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#acdab2245e5344cc15b7c0f2da447a59b" title=" " alt="" coords="433,372,547,397"/>
<area shape="rect" href="namespaceore_1_1analytics.html#add08f2897926c73ba4b8dcf55feebdd9" title=" " alt="" coords="639,472,813,512"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5" title="Give the &#160;used in the curvature margin calculation." alt="" coords="917,12,981,37"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a715afb0219b3c338740f98cd349e0845" title=" " alt="" coords="861,95,1036,135"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a3041af85f923e8c333f16febd8e66147" title=" " alt="" coords="389,522,591,548"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="abae54a48ef781027382517a9b0573bcb" name="abae54a48ef781027382517a9b0573bcb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abae54a48ef781027382517a9b0573bcb">&#9670;&#160;</a></span>calculateRegulationSimm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const void calculateRegulationSimm </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;&#160;</td>
          <td class="paramname"><em>netRecords</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ore::data::NettingSetDetails &amp;&#160;</td>
          <td class="paramname"><em>nsd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>regulation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates SIMM for a given regulation under a given netting set. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00222">222</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  224</span>                                                                         {</div>
<div class="line"><span class="lineno">  225</span> </div>
<div class="line"><span class="lineno">  226</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno">  227</span>        LOG(<span class="stringliteral">&quot;SimmCalculator: Calculating SIMM &quot;</span> &lt;&lt; side &lt;&lt; <span class="stringliteral">&quot; for portfolio [&quot;</span> &lt;&lt; nettingSetDetails &lt;&lt; <span class="stringliteral">&quot;], regulation &quot;</span></div>
<div class="line"><span class="lineno">  228</span>                                                &lt;&lt; regulation);</div>
<div class="line"><span class="lineno">  229</span>    }</div>
<div class="line"><span class="lineno">  230</span> </div>
<div class="line"><span class="lineno">  231</span>    <span class="comment">// Index in to SimmNetSensitivities</span></div>
<div class="line"><span class="lineno">  232</span>    <span class="keyword">auto</span>&amp; indexProduct = netRecords.get&lt;ProductClassTag&gt;();</div>
<div class="line"><span class="lineno">  233</span> </div>
<div class="line"><span class="lineno">  234</span>    <span class="comment">// Loop over portfolios and product classes</span></div>
<div class="line"><span class="lineno">  235</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = indexProduct.begin(); it != indexProduct.end();</div>
<div class="line"><span class="lineno">  236</span>         it = indexProduct.upper_bound(make_tuple(nettingSetDetails, it-&gt;productClass))) {</div>
<div class="line"><span class="lineno">  237</span>        <span class="keyword">auto</span> productClass = it-&gt;productClass;</div>
<div class="line"><span class="lineno">  238</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno">  239</span>            LOG(<span class="stringliteral">&quot;SimmCalculator: Calculating SIMM for product class &quot;</span> &lt;&lt; productClass);</div>
<div class="line"><span class="lineno">  240</span>        }</div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>        <span class="comment">// Delta margin components</span></div>
<div class="line"><span class="lineno">  243</span>        <a class="code hl_typedef" href="namespaceore_1_1analytics.html#a2e2b394182ab11afa96c27330a0a6fd3">RiskClass</a> rc = RiskClass::InterestRate;</div>
<div class="line"><span class="lineno">  244</span>        <a class="code hl_typedef" href="namespaceore_1_1analytics.html#a37f0476a64890aa4797db50095f787ec">MarginType</a> mt = MarginType::Delta;</div>
<div class="line"><span class="lineno">  245</span>        <span class="keyword">auto</span> p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a1fd4a0251381cf52e9bfe88653277c00">irDeltaMargin</a>(nettingSetDetails, productClass, netRecords);</div>
<div class="line"><span class="lineno">  246</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  247</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  248</span> </div>
<div class="line"><span class="lineno">  249</span>        rc = RiskClass::FX;</div>
<div class="line"><span class="lineno">  250</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>(nettingSetDetails, productClass, RiskType::FX, netRecords);</div>
<div class="line"><span class="lineno">  251</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  252</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  253</span> </div>
<div class="line"><span class="lineno">  254</span>        rc = RiskClass::CreditQualifying;</div>
<div class="line"><span class="lineno">  255</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>(nettingSetDetails, productClass, RiskType::CreditQ, netRecords);</div>
<div class="line"><span class="lineno">  256</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  257</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  258</span> </div>
<div class="line"><span class="lineno">  259</span>        rc = RiskClass::CreditNonQualifying;</div>
<div class="line"><span class="lineno">  260</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>(nettingSetDetails, productClass, RiskType::CreditNonQ, netRecords);</div>
<div class="line"><span class="lineno">  261</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  262</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  263</span> </div>
<div class="line"><span class="lineno">  264</span>        rc = RiskClass::Equity;</div>
<div class="line"><span class="lineno">  265</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>(nettingSetDetails, productClass, RiskType::Equity, netRecords);</div>
<div class="line"><span class="lineno">  266</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  267</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  268</span> </div>
<div class="line"><span class="lineno">  269</span>        rc = RiskClass::Commodity;</div>
<div class="line"><span class="lineno">  270</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>(nettingSetDetails, productClass, RiskType::Commodity, netRecords);</div>
<div class="line"><span class="lineno">  271</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  272</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  273</span> </div>
<div class="line"><span class="lineno">  274</span>        <span class="comment">// Vega margin components</span></div>
<div class="line"><span class="lineno">  275</span>        mt = MarginType::Vega;</div>
<div class="line"><span class="lineno">  276</span>        rc = RiskClass::InterestRate;</div>
<div class="line"><span class="lineno">  277</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a4ea36c0dc24d0c5d96c1f0e0eb539b61">irVegaMargin</a>(nettingSetDetails, productClass, netRecords);</div>
<div class="line"><span class="lineno">  278</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  279</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  280</span> </div>
<div class="line"><span class="lineno">  281</span>        rc = RiskClass::FX;</div>
<div class="line"><span class="lineno">  282</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>(nettingSetDetails, productClass, RiskType::FXVol, netRecords);</div>
<div class="line"><span class="lineno">  283</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  284</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  285</span> </div>
<div class="line"><span class="lineno">  286</span>        rc = RiskClass::CreditQualifying;</div>
<div class="line"><span class="lineno">  287</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>(nettingSetDetails, productClass, RiskType::CreditVol, netRecords);</div>
<div class="line"><span class="lineno">  288</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  289</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  290</span> </div>
<div class="line"><span class="lineno">  291</span>        rc = RiskClass::CreditNonQualifying;</div>
<div class="line"><span class="lineno">  292</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>(nettingSetDetails, productClass, RiskType::CreditVolNonQ, netRecords);</div>
<div class="line"><span class="lineno">  293</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  294</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  295</span> </div>
<div class="line"><span class="lineno">  296</span>        rc = RiskClass::Equity;</div>
<div class="line"><span class="lineno">  297</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>(nettingSetDetails, productClass, RiskType::EquityVol, netRecords);</div>
<div class="line"><span class="lineno">  298</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  299</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  300</span> </div>
<div class="line"><span class="lineno">  301</span>        rc = RiskClass::Commodity;</div>
<div class="line"><span class="lineno">  302</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>(nettingSetDetails, productClass, RiskType::CommodityVol, netRecords);</div>
<div class="line"><span class="lineno">  303</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  304</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  305</span> </div>
<div class="line"><span class="lineno">  306</span>        <span class="comment">// Curvature margin components for sides call and post</span></div>
<div class="line"><span class="lineno">  307</span>        mt = MarginType::Curvature;</div>
<div class="line"><span class="lineno">  308</span>        rc = RiskClass::InterestRate;</div>
<div class="line"><span class="lineno">  309</span> </div>
<div class="line"><span class="lineno">  310</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a6cc5da0fd2177b68717c733484631787">irCurvatureMargin</a>(nettingSetDetails, productClass, side, netRecords);</div>
<div class="line"><span class="lineno">  311</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  312</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  313</span> </div>
<div class="line"><span class="lineno">  314</span>        rc = RiskClass::FX;</div>
<div class="line"><span class="lineno">  315</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>(nettingSetDetails, productClass, RiskType::FXVol, side, netRecords, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  316</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  317</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  318</span> </div>
<div class="line"><span class="lineno">  319</span>        rc = RiskClass::CreditQualifying;</div>
<div class="line"><span class="lineno">  320</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>(nettingSetDetails, productClass, RiskType::CreditVol, side, netRecords);</div>
<div class="line"><span class="lineno">  321</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  322</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span>        rc = RiskClass::CreditNonQualifying;</div>
<div class="line"><span class="lineno">  325</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>(nettingSetDetails, productClass, RiskType::CreditVolNonQ, side, netRecords);</div>
<div class="line"><span class="lineno">  326</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  327</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  328</span> </div>
<div class="line"><span class="lineno">  329</span>        rc = RiskClass::Equity;</div>
<div class="line"><span class="lineno">  330</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>(nettingSetDetails, productClass, RiskType::EquityVol, side, netRecords, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  331</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  332</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  333</span> </div>
<div class="line"><span class="lineno">  334</span>        rc = RiskClass::Commodity;</div>
<div class="line"><span class="lineno">  335</span>        p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>(nettingSetDetails, productClass, RiskType::CommodityVol, side, netRecords, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  336</span>        <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  337</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, rc, mt, p.first, side);</div>
<div class="line"><span class="lineno">  338</span> </div>
<div class="line"><span class="lineno">  339</span>        <span class="comment">// Base correlation margin components. This risk type came later so need to check</span></div>
<div class="line"><span class="lineno">  340</span>        <span class="comment">// first if it is valid under the configuration</span></div>
<div class="line"><span class="lineno">  341</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;isValidRiskType(RiskType::BaseCorr)) {</div>
<div class="line"><span class="lineno">  342</span>            p = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>(nettingSetDetails, productClass, RiskType::BaseCorr, netRecords);</div>
<div class="line"><span class="lineno">  343</span>            <span class="keywordflow">if</span> (p.second)</div>
<div class="line"><span class="lineno">  344</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, productClass, RiskClass::CreditQualifying, MarginType::BaseCorr,</div>
<div class="line"><span class="lineno">  345</span>                    p.first, side);</div>
<div class="line"><span class="lineno">  346</span>        }</div>
<div class="line"><span class="lineno">  347</span>    }</div>
<div class="line"><span class="lineno">  348</span> </div>
<div class="line"><span class="lineno">  349</span>    <span class="comment">// Calculate the higher level margins</span></div>
<div class="line"><span class="lineno">  350</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#acdab2245e5344cc15b7c0f2da447a59b">populateResults</a>(side, nettingSetDetails, regulation);</div>
<div class="line"><span class="lineno">  351</span> </div>
<div class="line"><span class="lineno">  352</span>    <span class="comment">// For each portfolio, calculate the additional margin</span></div>
<div class="line"><span class="lineno">  353</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a4ebc63fe274dc9049972ebd3bc5af82f">calcAddMargin</a>(side, nettingSetDetails, regulation, netRecords);</div>
<div class="line"><span class="lineno">  354</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a1fd4a0251381cf52e9bfe88653277c00"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a1fd4a0251381cf52e9bfe88653277c00">ore::analytics::SimmCalculator::irDeltaMargin</a></div><div class="ttdeci">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, bool &gt; irDeltaMargin(const ore::data::NettingSetDetails &amp;nettingSetDetails, const SimmConfiguration::ProductClass &amp;pc, const SimmNetSensitivities &amp;netRecords) const</div><div class="ttdoc">Calculate the Interest Rate delta margin component for the given portfolio and product class.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l00421">simmcalculator.cpp:421</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a28bf3bff3398397c2a09711c5ba1770f"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">ore::analytics::SimmCalculator::margin</a></div><div class="ttdeci">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, bool &gt; margin(const ore::data::NettingSetDetails &amp;nettingSetDetails, const SimmConfiguration::ProductClass &amp;pc, const SimmConfiguration::RiskType &amp;rt, const SimmNetSensitivities &amp;netRecords) const</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l00926">simmcalculator.cpp:926</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a4ea36c0dc24d0c5d96c1f0e0eb539b61"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a4ea36c0dc24d0c5d96c1f0e0eb539b61">ore::analytics::SimmCalculator::irVegaMargin</a></div><div class="ttdeci">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, bool &gt; irVegaMargin(const ore::data::NettingSetDetails &amp;nettingSetDetails, const SimmConfiguration::ProductClass &amp;pc, const SimmNetSensitivities &amp;netRecords) const</div><div class="ttdoc">Calculate the Interest Rate vega margin component for the given portfolio and product class.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l00615">simmcalculator.cpp:615</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a4ebc63fe274dc9049972ebd3bc5af82f"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a4ebc63fe274dc9049972ebd3bc5af82f">ore::analytics::SimmCalculator::calcAddMargin</a></div><div class="ttdeci">void calcAddMargin(const SimmSide &amp;side, const ore::data::NettingSetDetails &amp;nsd, const string &amp;regulation, const SimmNetSensitivities &amp;netRecords)</div><div class="ttdoc">Calculate the additional initial margin for the portfolio ID and regulation.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l01275">simmcalculator.cpp:1275</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a6cc5da0fd2177b68717c733484631787"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a6cc5da0fd2177b68717c733484631787">ore::analytics::SimmCalculator::irCurvatureMargin</a></div><div class="ttdeci">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, bool &gt; irCurvatureMargin(const ore::data::NettingSetDetails &amp;nettingSetDetails, const SimmConfiguration::ProductClass &amp;pc, const SimmSide &amp;side, const SimmNetSensitivities &amp;netRecords) const</div><div class="ttdoc">Calculate the Interest Rate curvature margin component for the given portfolio and product class.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l00768">simmcalculator.cpp:768</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a82003566bd426f075cc443927b2182b7"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">ore::analytics::SimmCalculator::add</a></div><div class="ttdeci">void add(const ore::data::NettingSetDetails &amp;nettingSetDetails, const string &amp;regulation, const SimmConfiguration::ProductClass &amp;pc, const SimmConfiguration::RiskClass &amp;rc, const SimmConfiguration::MarginType &amp;mt, const std::string &amp;b, QuantLib::Real margin, SimmSide side, const bool overwrite=true)</div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_ab44b983595e1e6c3a0776a474c7313e7"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">ore::analytics::SimmCalculator::curvatureMargin</a></div><div class="ttdeci">std::pair&lt; std::map&lt; std::string, QuantLib::Real &gt;, bool &gt; curvatureMargin(const ore::data::NettingSetDetails &amp;nettingSetDetails, const SimmConfiguration::ProductClass &amp;pc, const SimmConfiguration::RiskType &amp;rt, const SimmSide &amp;side, const SimmNetSensitivities &amp;netRecords, bool rfLabels=true) const</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l01110">simmcalculator.cpp:1110</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_acdab2245e5344cc15b7c0f2da447a59b"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#acdab2245e5344cc15b7c0f2da447a59b">ore::analytics::SimmCalculator::populateResults</a></div><div class="ttdeci">void populateResults(const SimmSide &amp;side, const ore::data::NettingSetDetails &amp;nsd, const string &amp;regulation)</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l01389">simmcalculator.cpp:1389</a></div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a2e2b394182ab11afa96c27330a0a6fd3"><div class="ttname"><a href="namespaceore_1_1analytics.html#a2e2b394182ab11afa96c27330a0a6fd3">ore::analytics::RiskClass</a></div><div class="ttdeci">SimmConfiguration::RiskClass RiskClass</div><div class="ttdef"><b>Definition:</b> <a href="reportwriter_8cpp_source.html#l01685">reportwriter.cpp:1685</a></div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a37f0476a64890aa4797db50095f787ec"><div class="ttname"><a href="namespaceore_1_1analytics.html#a37f0476a64890aa4797db50095f787ec">ore::analytics::MarginType</a></div><div class="ttdeci">SimmConfiguration::MarginType MarginType</div><div class="ttdef"><b>Definition:</b> <a href="reportwriter_8cpp_source.html#l01686">reportwriter.cpp:1686</a></div></div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_abae54a48ef781027382517a9b0573bcb_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_abae54a48ef781027382517a9b0573bcb_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_abae54a48ef781027382517a9b0573bcb_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_abae54a48ef781027382517a9b0573bcb_cgraph">
<area shape="rect" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="5,197,175,222"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7" title=" " alt="" coords="459,70,502,95"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a4ebc63fe274dc9049972ebd3bc5af82f" title="Calculate the additional initial margin for the portfolio ID and regulation." alt="" coords="230,19,338,45"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7" title=" " alt="" coords="424,398,537,423"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f" title=" " alt="" coords="673,247,734,273"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a6cc5da0fd2177b68717c733484631787" title="Calculate the Interest Rate curvature margin component for the given portfolio and product class." alt="" coords="223,398,345,423"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a1fd4a0251381cf52e9bfe88653277c00" title="Calculate the Interest Rate delta margin component for the given portfolio and product class." alt="" coords="431,222,530,247"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a4ea36c0dc24d0c5d96c1f0e0eb539b61" title="Calculate the Interest Rate vega margin component for the given portfolio and product class." alt="" coords="235,273,333,298"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#acdab2245e5344cc15b7c0f2da447a59b" title=" " alt="" coords="227,121,341,146"/>
<area shape="rect" href="namespaceore_1_1analytics.html#add08f2897926c73ba4b8dcf55feebdd9" title=" " alt="" coords="393,5,568,45"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5" title="Give the &#160;used in the curvature margin calculation." alt="" coords="671,487,735,513"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a715afb0219b3c338740f98cd349e0845" title=" " alt="" coords="616,412,791,452"/>
</map>
</div>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_abae54a48ef781027382517a9b0573bcb_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_abae54a48ef781027382517a9b0573bcb_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_abae54a48ef781027382517a9b0573bcb_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_abae54a48ef781027382517a9b0573bcb_icgraph">
<area shape="rect" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,5,337,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a5492abea466c6543ca7a9a98cc747061" title=" " alt="" coords="5,5,120,31"/>
</map>
</div>

</div>
</div>
<a id="a8414527d1a5f3a71ae4bb31e6721d652" name="a8414527d1a5f3a71ae4bb31e6721d652"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8414527d1a5f3a71ae4bb31e6721d652">&#9670;&#160;</a></span>winningRegulations() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::string &amp; winningRegulations </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ore::data::NettingSetDetails &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the winning regulation for each netting set. </p>

</div>
</div>
<a id="a7c411b3c186350a6cf759b4b6306baf6" name="a7c411b3c186350a6cf759b4b6306baf6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c411b3c186350a6cf759b4b6306baf6">&#9670;&#160;</a></span>winningRegulations() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const map&lt; NettingSetDetails, string &gt; &amp; winningRegulations </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00364">364</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  364</span>                                                                                                   {</div>
<div class="line"><span class="lineno">  365</span>    QL_REQUIRE(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">winningRegulations_</a>.find(side) != <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">winningRegulations_</a>.end(),</div>
<div class="line"><span class="lineno">  366</span>               <span class="stringliteral">&quot;SimmCalculator::winningRegulations(): Could not find list of&quot;</span> &lt;&lt; side &lt;&lt; <span class="stringliteral">&quot; IM winning regulations&quot;</span>);</div>
<div class="line"><span class="lineno">  367</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">winningRegulations_</a>.at(side);</div>
<div class="line"><span class="lineno">  368</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a766fc790a5e25235a2083f09f21011df" name="a766fc790a5e25235a2083f09f21011df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a766fc790a5e25235a2083f09f21011df">&#9670;&#160;</a></span>winningRegulations() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, map&lt; NettingSetDetails, string &gt; &gt; &amp; winningRegulations </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00370">370</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  370</span>                                                                                              {</div>
<div class="line"><span class="lineno">  371</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">winningRegulations_</a>;</div>
<div class="line"><span class="lineno">  372</span>}</div>
</div><!-- fragment --><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a766fc790a5e25235a2083f09f21011df_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a766fc790a5e25235a2083f09f21011df_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a766fc790a5e25235a2083f09f21011df_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a766fc790a5e25235a2083f09f21011df_icgraph">
<area shape="rect" title=" " alt="" coords="168,5,301,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a5492abea466c6543ca7a9a98cc747061" title=" " alt="" coords="5,5,120,31"/>
</map>
</div>

</div>
</div>
<a id="a0c484da72c93ba30b8fc72c6fd9d1592" name="a0c484da72c93ba30b8fc72c6fd9d1592"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c484da72c93ba30b8fc72c6fd9d1592">&#9670;&#160;</a></span>simmResults() <span class="overload">[1/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &amp; simmResults </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ore::data::NettingSetDetails &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>regulation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Give back the SIMM results container for the given portfolioId and SIMM side. </p>

</div>
</div>
<a id="a7cd92f588dc4b6adacf65aa6be29154e" name="a7cd92f588dc4b6adacf65aa6be29154e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7cd92f588dc4b6adacf65aa6be29154e">&#9670;&#160;</a></span>simmResults() <span class="overload">[2/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::map&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &amp; simmResults </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ore::data::NettingSetDetails &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a043645c8f888e4793f5551c56cfda568" name="a043645c8f888e4793f5551c56cfda568"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a043645c8f888e4793f5551c56cfda568">&#9670;&#160;</a></span>simmResults() <span class="overload">[3/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const map&lt; NettingSetDetails, map&lt; string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &amp; simmResults </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Give back a map containing the SIMM results containers for every portfolio for the given SIMM <code>side</code>. The key is the portfolio ID and the value is the SIMM results container for that portfolio. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00392">392</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  392</span>                                                                                                              {</div>
<div class="line"><span class="lineno">  393</span>    QL_REQUIRE(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a>.find(side) != <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a>.end(),</div>
<div class="line"><span class="lineno">  394</span>               <span class="stringliteral">&quot;SimmCalculator::simmResults(): Could not find &quot;</span> &lt;&lt; side &lt;&lt; <span class="stringliteral">&quot; IM in the SIMM results&quot;</span>);</div>
<div class="line"><span class="lineno">  395</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a>.at(side);</div>
<div class="line"><span class="lineno">  396</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a009eb0a808f969304a75263fa81bb9bd" name="a009eb0a808f969304a75263fa81bb9bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a009eb0a808f969304a75263fa81bb9bd">&#9670;&#160;</a></span>simmResults() <span class="overload">[4/4]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, map&lt; NettingSetDetails, map&lt; string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &gt; &amp; simmResults </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00398">398</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  398</span>                                                                                                         {</div>
<div class="line"><span class="lineno">  399</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a>;</div>
<div class="line"><span class="lineno">  400</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3081990cf985ebb99a3d7f5a9b53a015" name="a3081990cf985ebb99a3d7f5a9b53a015"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3081990cf985ebb99a3d7f5a9b53a015">&#9670;&#160;</a></span>finalSimmResults() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::pair&lt; std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &amp; finalSimmResults </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ore::data::NettingSetDetails &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Give back the SIMM results container for the given netting set and SIMM side. </p>

</div>
</div>
<a id="a1e3384043ef38de3c8a063d6bcb134f2" name="a1e3384043ef38de3c8a063d6bcb134f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e3384043ef38de3c8a063d6bcb134f2">&#9670;&#160;</a></span>finalSimmResults() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const map&lt; NettingSetDetails, pair&lt; string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &amp; finalSimmResults </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Give back a map containing the SIMM results containers for every portfolio for the given SIMM <code>side</code>. The key is the portfolio ID and the value is a map, with regulation as the key, and the value is the SIMM results container for that portfolioId-regulation combination. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00411">411</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  411</span>                                                                                                                    {</div>
<div class="line"><span class="lineno">  412</span>    QL_REQUIRE(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa86bb7338b370ccfabfd1b6d218a5fb8">finalSimmResults_</a>.find(side) != <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa86bb7338b370ccfabfd1b6d218a5fb8">finalSimmResults_</a>.end(),</div>
<div class="line"><span class="lineno">  413</span>               <span class="stringliteral">&quot;SimmCalculator::finalSimmResults(): Could not find &quot;</span> &lt;&lt; side &lt;&lt; <span class="stringliteral">&quot; IM in the final SIMM results&quot;</span>);</div>
<div class="line"><span class="lineno">  414</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa86bb7338b370ccfabfd1b6d218a5fb8">finalSimmResults_</a>.at(side);</div>
<div class="line"><span class="lineno">  415</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_aa86bb7338b370ccfabfd1b6d218a5fb8"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#aa86bb7338b370ccfabfd1b6d218a5fb8">ore::analytics::SimmCalculator::finalSimmResults_</a></div><div class="ttdeci">std::map&lt; SimmSide, std::map&lt; ore::data::NettingSetDetails, std::pair&lt; std::string, SimmResults &gt; &gt; &gt; finalSimmResults_</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00138">simmcalculator.hpp:138</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a892df1a5c65ab07fefdc01d5c057ad66" name="a892df1a5c65ab07fefdc01d5c057ad66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a892df1a5c65ab07fefdc01d5c057ad66">&#9670;&#160;</a></span>finalSimmResults() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, map&lt; NettingSetDetails, pair&lt; string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> &gt; &gt; &gt; &amp; finalSimmResults </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00417">417</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  417</span>                                                                                                               {</div>
<div class="line"><span class="lineno">  418</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa86bb7338b370ccfabfd1b6d218a5fb8">finalSimmResults_</a>;</div>
<div class="line"><span class="lineno">  419</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1c7eea9571d36346abceb7dfa72091b5" name="a1c7eea9571d36346abceb7dfa72091b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c7eea9571d36346abceb7dfa72091b5">&#9670;&#160;</a></span>finalTradeIds()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::set&lt; std::string &gt; &gt; finalTradeIds </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00089">89</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   89</span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#acf6d3f08c36da850265818577b6c5111">finalTradeIds_</a>; }</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_acf6d3f08c36da850265818577b6c5111"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#acf6d3f08c36da850265818577b6c5111">ore::analytics::SimmCalculator::finalTradeIds_</a></div><div class="ttdeci">std::map&lt; SimmSide, set&lt; string &gt; &gt; finalTradeIds_</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00144">simmcalculator.hpp:144</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa1e5ad6cbecb8c2af1fdeb70d4b06a35" name="aa1e5ad6cbecb8c2af1fdeb70d4b06a35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1e5ad6cbecb8c2af1fdeb70d4b06a35">&#9670;&#160;</a></span>calculationCurrency()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::string &amp; calculationCurrency </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the calculator's calculation currency. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00092">92</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   92</span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a957d4a9347f400dc03534f2c4ae9975a" name="a957d4a9347f400dc03534f2c4ae9975a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a957d4a9347f400dc03534f2c4ae9975a">&#9670;&#160;</a></span>resultCurrency()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::string &amp; resultCurrency </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the calculator's result currency. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00095">95</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   95</span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa936c119f6230d0eed00b790981bef02" name="aa936c119f6230d0eed00b790981bef02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa936c119f6230d0eed00b790981bef02">&#9670;&#160;</a></span>populateFinalResults() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void populateFinalResults </td>
          <td>(</td>
          <td class="paramtype">const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt; ore::data::NettingSetDetails, std::string &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>winningRegulations</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Populate the finalSimmResults_ and finalAddMargins_ containers using the provided map of winning call/post regulations. </p>

</div>
</div>
<a id="a1fd4a0251381cf52e9bfe88653277c00" name="a1fd4a0251381cf52e9bfe88653277c00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fd4a0251381cf52e9bfe88653277c00">&#9670;&#160;</a></span>irDeltaMargin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pair&lt; map&lt; string, Real &gt;, bool &gt; irDeltaMargin </td>
          <td>(</td>
          <td class="paramtype">const ore::data::NettingSetDetails &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#aac3c9ca896a60df32236fdc4ef53bdc9">SimmConfiguration::ProductClass</a> &amp;&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;&#160;</td>
          <td class="paramname"><em>netRecords</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the Interest Rate delta margin component for the given portfolio and product class. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00421">421</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  423</span>                                                                                                          {</div>
<div class="line"><span class="lineno">  424</span> </div>
<div class="line"><span class="lineno">  425</span>    <span class="comment">// &quot;Bucket&quot; here referse to exposures under the CRIF qualifiers</span></div>
<div class="line"><span class="lineno">  426</span>    map&lt;string, Real&gt; bucketMargins;</div>
<div class="line"><span class="lineno">  427</span> </div>
<div class="line"><span class="lineno">  428</span>    <span class="comment">// Index on SIMM sensitivities in to Risk Type level</span></div>
<div class="line"><span class="lineno">  429</span>    <span class="keyword">auto</span>&amp; ssRiskTypeIndex = netRecords.get&lt;RiskTypeTag&gt;();</div>
<div class="line"><span class="lineno">  430</span>    <span class="comment">// Index on SIMM sensitivities in to Qualifier level</span></div>
<div class="line"><span class="lineno">  431</span>    <span class="keyword">auto</span>&amp; ssQualifierIndex = netRecords.get&lt;QualifierTag&gt;();</div>
<div class="line"><span class="lineno">  432</span> </div>
<div class="line"><span class="lineno">  433</span>    <span class="comment">// Find the set of qualifiers, i.e. currencies, in the Simm sensitivities</span></div>
<div class="line"><span class="lineno">  434</span>    set&lt;string&gt; qualifiers;</div>
<div class="line"><span class="lineno">  435</span> </div>
<div class="line"><span class="lineno">  436</span>    <span class="comment">// IRCurve qualifiers</span></div>
<div class="line"><span class="lineno">  437</span>    <span class="keyword">auto</span> pIrCurve = ssRiskTypeIndex.equal_range(make_tuple(nettingSetDetails, pc, RiskType::IRCurve));</div>
<div class="line"><span class="lineno">  438</span>    <span class="keywordflow">while</span> (pIrCurve.first != pIrCurve.second) {</div>
<div class="line"><span class="lineno">  439</span>        <span class="keywordflow">if</span> (qualifiers.count(pIrCurve.first-&gt;qualifier) == 0) {</div>
<div class="line"><span class="lineno">  440</span>            qualifiers.insert(pIrCurve.first-&gt;qualifier);</div>
<div class="line"><span class="lineno">  441</span>        }</div>
<div class="line"><span class="lineno">  442</span>        ++pIrCurve.first;</div>
<div class="line"><span class="lineno">  443</span>    }</div>
<div class="line"><span class="lineno">  444</span>    <span class="comment">// XCcyBasis qualifiers</span></div>
<div class="line"><span class="lineno">  445</span>    <span class="keyword">auto</span> pXccy = ssRiskTypeIndex.equal_range(make_tuple(nettingSetDetails, pc, RiskType::XCcyBasis));</div>
<div class="line"><span class="lineno">  446</span>    <span class="keywordflow">while</span> (pXccy.first != pXccy.second) {</div>
<div class="line"><span class="lineno">  447</span>        <span class="keywordflow">if</span> (qualifiers.count(pXccy.first-&gt;qualifier) == 0) {</div>
<div class="line"><span class="lineno">  448</span>            qualifiers.insert(pXccy.first-&gt;qualifier);</div>
<div class="line"><span class="lineno">  449</span>        }</div>
<div class="line"><span class="lineno">  450</span>        ++pXccy.first;</div>
<div class="line"><span class="lineno">  451</span>    }</div>
<div class="line"><span class="lineno">  452</span>    <span class="comment">// Inflation qualifiers</span></div>
<div class="line"><span class="lineno">  453</span>    <span class="keyword">auto</span> pInflation = ssRiskTypeIndex.equal_range(make_tuple(nettingSetDetails, pc, RiskType::Inflation));</div>
<div class="line"><span class="lineno">  454</span>    <span class="keywordflow">while</span> (pInflation.first != pInflation.second) {</div>
<div class="line"><span class="lineno">  455</span>        <span class="keywordflow">if</span> (qualifiers.count(pInflation.first-&gt;qualifier) == 0) {</div>
<div class="line"><span class="lineno">  456</span>            qualifiers.insert(pInflation.first-&gt;qualifier);</div>
<div class="line"><span class="lineno">  457</span>        }</div>
<div class="line"><span class="lineno">  458</span>        ++pInflation.first;</div>
<div class="line"><span class="lineno">  459</span>    }</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>    <span class="comment">// If there are no qualifiers, return early and set bool to false to indicate margin does not apply</span></div>
<div class="line"><span class="lineno">  462</span>    <span class="keywordflow">if</span> (qualifiers.empty()) {</div>
<div class="line"><span class="lineno">  463</span>        bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = 0.0;</div>
<div class="line"><span class="lineno">  464</span>        <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  465</span>    }</div>
<div class="line"><span class="lineno">  466</span> </div>
<div class="line"><span class="lineno">  467</span>    <span class="comment">// Hold the concentration risk for each qualifier i.e. $CR_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  468</span>    map&lt;string, Real&gt; concentrationRisk;</div>
<div class="line"><span class="lineno">  469</span>    <span class="comment">// The delta margin for each currency i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  470</span>    map&lt;string, Real&gt; deltaMargin;</div>
<div class="line"><span class="lineno">  471</span>    <span class="comment">// The sum of the weighted sensitivities for each currency i.e. $\sum_{i,k} WS_{k,i}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  472</span>    map&lt;string, Real&gt; sumWeightedSensis;</div>
<div class="line"><span class="lineno">  473</span> </div>
<div class="line"><span class="lineno">  474</span>    <span class="comment">// Loop over the qualifiers i.e. currencies</span></div>
<div class="line"><span class="lineno">  475</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; qualifier : qualifiers) {</div>
<div class="line"><span class="lineno">  476</span>        <span class="comment">// Pair of iterators to start and end of IRCurve sensitivities with current qualifier</span></div>
<div class="line"><span class="lineno">  477</span>        <span class="keyword">auto</span> pIrQualifier = ssQualifierIndex.equal_range(make_tuple(nettingSetDetails, pc, RiskType::IRCurve, qualifier));</div>
<div class="line"><span class="lineno">  478</span> </div>
<div class="line"><span class="lineno">  479</span>        <span class="comment">// Iterator to Xccy basis element with current qualifier (expect zero or one element)</span></div>
<div class="line"><span class="lineno">  480</span>        <span class="keyword">auto</span> XccyCount = ssQualifierIndex.count(make_tuple(nettingSetDetails, pc, RiskType::XCcyBasis, qualifier));</div>
<div class="line"><span class="lineno">  481</span>        QL_REQUIRE(XccyCount &lt; 2, <span class="stringliteral">&quot;SIMM Calcuator: Expected either 0 or 1 elements for risk type &quot;</span></div>
<div class="line"><span class="lineno">  482</span>                                      &lt;&lt; RiskType::XCcyBasis &lt;&lt; <span class="stringliteral">&quot; and qualifier &quot;</span> &lt;&lt; qualifier &lt;&lt; <span class="stringliteral">&quot; but got &quot;</span></div>
<div class="line"><span class="lineno">  483</span>                                      &lt;&lt; XccyCount);</div>
<div class="line"><span class="lineno">  484</span>        <span class="keyword">auto</span> itXccy = ssQualifierIndex.find(make_tuple(nettingSetDetails, pc, RiskType::XCcyBasis, qualifier));</div>
<div class="line"><span class="lineno">  485</span> </div>
<div class="line"><span class="lineno">  486</span>        <span class="comment">// Iterator to inflation element with current qualifier (expect zero or one element)</span></div>
<div class="line"><span class="lineno">  487</span>        <span class="keyword">auto</span> inflationCount = ssQualifierIndex.count(make_tuple(nettingSetDetails, pc, RiskType::Inflation, qualifier));</div>
<div class="line"><span class="lineno">  488</span>        QL_REQUIRE(inflationCount &lt; 2, <span class="stringliteral">&quot;SIMM Calculator: Expected either 0 or 1 elements for risk type &quot;</span></div>
<div class="line"><span class="lineno">  489</span>                                           &lt;&lt; RiskType::Inflation &lt;&lt; <span class="stringliteral">&quot; and qualifier &quot;</span> &lt;&lt; qualifier &lt;&lt; <span class="stringliteral">&quot; but got &quot;</span></div>
<div class="line"><span class="lineno">  490</span>                                           &lt;&lt; inflationCount);</div>
<div class="line"><span class="lineno">  491</span>        <span class="keyword">auto</span> itInflation = ssQualifierIndex.find(make_tuple(nettingSetDetails, pc, RiskType::Inflation, qualifier));</div>
<div class="line"><span class="lineno">  492</span> </div>
<div class="line"><span class="lineno">  493</span>        <span class="comment">// One pass to get the concentration risk for this qualifier</span></div>
<div class="line"><span class="lineno">  494</span>        <span class="comment">// Note: XccyBasis is not included in the calculation of concentration risk and the XccyBasis sensitivity</span></div>
<div class="line"><span class="lineno">  495</span>        <span class="comment">//       is not scaled by it</span></div>
<div class="line"><span class="lineno">  496</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = pIrQualifier.first; it != pIrQualifier.second; ++it) {</div>
<div class="line"><span class="lineno">  497</span>            concentrationRisk[qualifier] += it-&gt;amountUsd;</div>
<div class="line"><span class="lineno">  498</span>        }</div>
<div class="line"><span class="lineno">  499</span>        <span class="comment">// Add inflation sensitivity to the concentration risk</span></div>
<div class="line"><span class="lineno">  500</span>        <span class="keywordflow">if</span> (itInflation != ssQualifierIndex.end()) {</div>
<div class="line"><span class="lineno">  501</span>            concentrationRisk[qualifier] += itInflation-&gt;amountUsd;</div>
<div class="line"><span class="lineno">  502</span>        }</div>
<div class="line"><span class="lineno">  503</span>        <span class="comment">// Divide by the concentration risk threshold</span></div>
<div class="line"><span class="lineno">  504</span>        concentrationRisk[qualifier] /= <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;concentrationThreshold(RiskType::IRCurve, qualifier);</div>
<div class="line"><span class="lineno">  505</span>        <span class="comment">// Final concentration risk amount</span></div>
<div class="line"><span class="lineno">  506</span>        concentrationRisk[qualifier] = max(1.0, sqrt(std::abs(concentrationRisk[qualifier])));</div>
<div class="line"><span class="lineno">  507</span> </div>
<div class="line"><span class="lineno">  508</span>        <span class="comment">// Calculate the delta margin piece for this qualifier i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  509</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = pIrQualifier.first; itOuter != pIrQualifier.second; ++itOuter) {</div>
<div class="line"><span class="lineno">  510</span>            <span class="comment">// Risk weight i.e. $RW_k$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  511</span>            Real rwOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;weight(RiskType::IRCurve, qualifier, itOuter-&gt;label1);</div>
<div class="line"><span class="lineno">  512</span>            <span class="comment">// Weighted sensitivity i.e. $WS_{k,i}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  513</span>            Real wsOuter = rwOuter * itOuter-&gt;amountUsd * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  514</span>            <span class="comment">// Update weighted sensitivity sum</span></div>
<div class="line"><span class="lineno">  515</span>            sumWeightedSensis[qualifier] += wsOuter;</div>
<div class="line"><span class="lineno">  516</span>            <span class="comment">// Add diagonal element to delta margin</span></div>
<div class="line"><span class="lineno">  517</span>            deltaMargin[qualifier] += wsOuter * wsOuter;</div>
<div class="line"><span class="lineno">  518</span>            <span class="comment">// Add the cross elements to the delta margin</span></div>
<div class="line"><span class="lineno">  519</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = pIrQualifier.first; itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno">  520</span>                <span class="comment">// Label2 level correlation i.e. $\phi_{i,j}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  521</span>                Real subCurveCorr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(RiskType::IRCurve, qualifier, <span class="stringliteral">&quot;&quot;</span>, itOuter-&gt;label2,</div>
<div class="line"><span class="lineno">  522</span>                                                                    RiskType::IRCurve, qualifier, <span class="stringliteral">&quot;&quot;</span>, itInner-&gt;label2);</div>
<div class="line"><span class="lineno">  523</span>                <span class="comment">// Label1 level correlation i.e. $\rho_{k,l}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  524</span>                Real tenorCorr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(RiskType::IRCurve, qualifier, itOuter-&gt;label1, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">  525</span>                                                                 RiskType::IRCurve, qualifier, itInner-&gt;label1, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  526</span>                <span class="comment">// Add cross element to delta margin</span></div>
<div class="line"><span class="lineno">  527</span>                Real rwInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;weight(RiskType::IRCurve, qualifier, itInner-&gt;label1);</div>
<div class="line"><span class="lineno">  528</span>                Real wsInner = rwInner * itInner-&gt;amountUsd * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  529</span>                deltaMargin[qualifier] += 2 * subCurveCorr * tenorCorr * wsOuter * wsInner;</div>
<div class="line"><span class="lineno">  530</span>            }</div>
<div class="line"><span class="lineno">  531</span>        }</div>
<div class="line"><span class="lineno">  532</span> </div>
<div class="line"><span class="lineno">  533</span>        <span class="comment">// Add the Inflation component, if any</span></div>
<div class="line"><span class="lineno">  534</span>        Real wsInflation = 0.0;</div>
<div class="line"><span class="lineno">  535</span>        <span class="keywordflow">if</span> (itInflation != ssQualifierIndex.end()) {</div>
<div class="line"><span class="lineno">  536</span>            <span class="comment">// Risk weight</span></div>
<div class="line"><span class="lineno">  537</span>            Real rwInflation = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;weight(RiskType::Inflation, qualifier, itInflation-&gt;label1);</div>
<div class="line"><span class="lineno">  538</span>            <span class="comment">// Weighted sensitivity</span></div>
<div class="line"><span class="lineno">  539</span>            wsInflation = rwInflation * itInflation-&gt;amountUsd * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  540</span>            <span class="comment">// Update weighted sensitivity sum</span></div>
<div class="line"><span class="lineno">  541</span>            sumWeightedSensis[qualifier] += wsInflation;</div>
<div class="line"><span class="lineno">  542</span>            <span class="comment">// Add diagonal element to delta margin</span></div>
<div class="line"><span class="lineno">  543</span>            deltaMargin[qualifier] += wsInflation * wsInflation;</div>
<div class="line"><span class="lineno">  544</span>            <span class="comment">// Add the cross elements (Inflation with IRCurve tenors) to the delta margin</span></div>
<div class="line"><span class="lineno">  545</span>            <span class="comment">// Correlation (know that Label1 and Label2 do not matter)</span></div>
<div class="line"><span class="lineno">  546</span>            Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(RiskType::IRCurve, qualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, RiskType::Inflation,</div>
<div class="line"><span class="lineno">  547</span>                                                        qualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  548</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = pIrQualifier.first; it != pIrQualifier.second; ++it) {</div>
<div class="line"><span class="lineno">  549</span>                <span class="comment">// Add cross element to delta margin</span></div>
<div class="line"><span class="lineno">  550</span>                Real rw = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;weight(RiskType::IRCurve, qualifier, it-&gt;label1);</div>
<div class="line"><span class="lineno">  551</span>                Real ws = rw * it-&gt;amountUsd * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  552</span>                deltaMargin[qualifier] += 2 * corr * ws * wsInflation;</div>
<div class="line"><span class="lineno">  553</span>            }</div>
<div class="line"><span class="lineno">  554</span>        }</div>
<div class="line"><span class="lineno">  555</span> </div>
<div class="line"><span class="lineno">  556</span>        <span class="comment">// Add the XccyBasis component, if any</span></div>
<div class="line"><span class="lineno">  557</span>        <span class="keywordflow">if</span> (itXccy != ssQualifierIndex.end()) {</div>
<div class="line"><span class="lineno">  558</span>            <span class="comment">// Risk weight</span></div>
<div class="line"><span class="lineno">  559</span>            Real rwXccy = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;weight(RiskType::XCcyBasis, qualifier, itXccy-&gt;label1);</div>
<div class="line"><span class="lineno">  560</span>            <span class="comment">// Weighted sensitivity (no concentration risk here)</span></div>
<div class="line"><span class="lineno">  561</span>            Real wsXccy = rwXccy * itXccy-&gt;amountUsd;</div>
<div class="line"><span class="lineno">  562</span>            <span class="comment">// Update weighted sensitivity sum</span></div>
<div class="line"><span class="lineno">  563</span>            sumWeightedSensis[qualifier] += wsXccy;</div>
<div class="line"><span class="lineno">  564</span>            <span class="comment">// Add diagonal element to delta margin</span></div>
<div class="line"><span class="lineno">  565</span>            deltaMargin[qualifier] += wsXccy * wsXccy;</div>
<div class="line"><span class="lineno">  566</span>            <span class="comment">// Add the cross elements (XccyBasis with IRCurve tenors) to the delta margin</span></div>
<div class="line"><span class="lineno">  567</span>            <span class="comment">// Correlation (know that Label1 and Label2 do not matter)</span></div>
<div class="line"><span class="lineno">  568</span>            Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(RiskType::IRCurve, qualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, RiskType::XCcyBasis,</div>
<div class="line"><span class="lineno">  569</span>                                                        qualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  570</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = pIrQualifier.first; it != pIrQualifier.second; ++it) {</div>
<div class="line"><span class="lineno">  571</span>                <span class="comment">// Add cross element to delta margin</span></div>
<div class="line"><span class="lineno">  572</span>                Real rw = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;weight(RiskType::IRCurve, qualifier, it-&gt;label1, <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno">  573</span>                Real ws = rw * it-&gt;amountUsd * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  574</span>                deltaMargin[qualifier] += 2 * corr * ws * wsXccy;</div>
<div class="line"><span class="lineno">  575</span>            }</div>
<div class="line"><span class="lineno">  576</span> </div>
<div class="line"><span class="lineno">  577</span>            <span class="comment">// Inflation vs. XccyBasis cross component if any</span></div>
<div class="line"><span class="lineno">  578</span>            <span class="keywordflow">if</span> (itInflation != ssQualifierIndex.end()) {</div>
<div class="line"><span class="lineno">  579</span>                <span class="comment">// Correlation (know that Label1 and Label2 do not matter)</span></div>
<div class="line"><span class="lineno">  580</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(RiskType::Inflation, qualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, RiskType::XCcyBasis,</div>
<div class="line"><span class="lineno">  581</span>                                                            qualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  582</span>                deltaMargin[qualifier] += 2 * corr * wsInflation * wsXccy;</div>
<div class="line"><span class="lineno">  583</span>            }</div>
<div class="line"><span class="lineno">  584</span>        }</div>
<div class="line"><span class="lineno">  585</span> </div>
<div class="line"><span class="lineno">  586</span>        <span class="comment">// Finally have the value of $K_b$</span></div>
<div class="line"><span class="lineno">  587</span>        deltaMargin[qualifier] = sqrt(max(deltaMargin[qualifier], 0.0));</div>
<div class="line"><span class="lineno">  588</span>    }</div>
<div class="line"><span class="lineno">  589</span> </div>
<div class="line"><span class="lineno">  590</span>    <span class="comment">// Now calculate final IR delta margin by aggregating across currencies</span></div>
<div class="line"><span class="lineno">  591</span>    Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> = 0.0;</div>
<div class="line"><span class="lineno">  592</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = qualifiers.begin(); itOuter != qualifiers.end(); ++itOuter) {</div>
<div class="line"><span class="lineno">  593</span>        <span class="comment">// Diagonal term</span></div>
<div class="line"><span class="lineno">  594</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += deltaMargin.at(*itOuter) * deltaMargin.at(*itOuter);</div>
<div class="line"><span class="lineno">  595</span>        <span class="comment">// Cross terms</span></div>
<div class="line"><span class="lineno">  596</span>        Real sOuter = max(min(sumWeightedSensis.at(*itOuter), deltaMargin.at(*itOuter)), -deltaMargin.at(*itOuter));</div>
<div class="line"><span class="lineno">  597</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = qualifiers.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno">  598</span>            Real sInner = max(min(sumWeightedSensis.at(*itInner), deltaMargin.at(*itInner)), -deltaMargin.at(*itInner));</div>
<div class="line"><span class="lineno">  599</span>            Real g = min(concentrationRisk.at(*itOuter), concentrationRisk.at(*itInner)) /</div>
<div class="line"><span class="lineno">  600</span>                     max(concentrationRisk.at(*itOuter), concentrationRisk.at(*itInner));</div>
<div class="line"><span class="lineno">  601</span>            Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(RiskType::IRCurve, *itOuter, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, RiskType::IRCurve,</div>
<div class="line"><span class="lineno">  602</span>                                                        *itInner, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  603</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += 2.0 * sOuter * sInner * corr * g;</div>
<div class="line"><span class="lineno">  604</span>        }</div>
<div class="line"><span class="lineno">  605</span>    }</div>
<div class="line"><span class="lineno">  606</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> = sqrt(max(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>, 0.0));</div>
<div class="line"><span class="lineno">  607</span> </div>
<div class="line"><span class="lineno">  608</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; m : deltaMargin)</div>
<div class="line"><span class="lineno">  609</span>        bucketMargins[m.first] = m.second;</div>
<div class="line"><span class="lineno">  610</span>    bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>;</div>
<div class="line"><span class="lineno">  611</span> </div>
<div class="line"><span class="lineno">  612</span>    <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  613</span>}</div>
</div><!-- fragment --><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a1fd4a0251381cf52e9bfe88653277c00_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a1fd4a0251381cf52e9bfe88653277c00_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a1fd4a0251381cf52e9bfe88653277c00_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a1fd4a0251381cf52e9bfe88653277c00_cgraph">
<area shape="rect" title="Calculate the Interest Rate delta margin component for the given portfolio and product class." alt="" coords="5,29,104,55"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f" title=" " alt="" coords="152,29,213,55"/>
</map>
</div>
<div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a1fd4a0251381cf52e9bfe88653277c00_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a1fd4a0251381cf52e9bfe88653277c00_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a1fd4a0251381cf52e9bfe88653277c00_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a1fd4a0251381cf52e9bfe88653277c00_icgraph">
<area shape="rect" title="Calculate the Interest Rate delta margin component for the given portfolio and product class." alt="" coords="385,5,484,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#abae54a48ef781027382517a9b0573bcb" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,5,337,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a5492abea466c6543ca7a9a98cc747061" title=" " alt="" coords="5,5,120,31"/>
</map>
</div>

</div>
</div>
<a id="a4ea36c0dc24d0c5d96c1f0e0eb539b61" name="a4ea36c0dc24d0c5d96c1f0e0eb539b61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ea36c0dc24d0c5d96c1f0e0eb539b61">&#9670;&#160;</a></span>irVegaMargin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pair&lt; map&lt; string, Real &gt;, bool &gt; irVegaMargin </td>
          <td>(</td>
          <td class="paramtype">const ore::data::NettingSetDetails &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#aac3c9ca896a60df32236fdc4ef53bdc9">SimmConfiguration::ProductClass</a> &amp;&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;&#160;</td>
          <td class="paramname"><em>netRecords</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the Interest Rate vega margin component for the given portfolio and product class. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00615">615</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  617</span>                                                                                                         {</div>
<div class="line"><span class="lineno">  618</span> </div>
<div class="line"><span class="lineno">  619</span>    <span class="comment">// &quot;Bucket&quot; here refers to exposures under the CRIF qualifiers</span></div>
<div class="line"><span class="lineno">  620</span>    map&lt;string, Real&gt; bucketMargins;</div>
<div class="line"><span class="lineno">  621</span> </div>
<div class="line"><span class="lineno">  622</span>    <span class="comment">// Index on SIMM sensitivities in to Risk Type level</span></div>
<div class="line"><span class="lineno">  623</span>    <span class="keyword">auto</span>&amp; ssRiskTypeIndex = netRecords.get&lt;RiskTypeTag&gt;();</div>
<div class="line"><span class="lineno">  624</span>    <span class="comment">// Index on SIMM sensitivities in to Qualifier level</span></div>
<div class="line"><span class="lineno">  625</span>    <span class="keyword">auto</span>&amp; ssQualifierIndex = netRecords.get&lt;QualifierTag&gt;();</div>
<div class="line"><span class="lineno">  626</span> </div>
<div class="line"><span class="lineno">  627</span>    <span class="comment">// Find the set of qualifiers, i.e. currencies, in the Simm sensitivities</span></div>
<div class="line"><span class="lineno">  628</span>    set&lt;string&gt; qualifiers;</div>
<div class="line"><span class="lineno">  629</span> </div>
<div class="line"><span class="lineno">  630</span>    <span class="comment">// IRVol qualifiers</span></div>
<div class="line"><span class="lineno">  631</span>    <span class="keyword">auto</span> pIrVol = ssRiskTypeIndex.equal_range(make_tuple(nettingSetDetails, pc, RiskType::IRVol));</div>
<div class="line"><span class="lineno">  632</span>    <span class="keywordflow">while</span> (pIrVol.first != pIrVol.second) {</div>
<div class="line"><span class="lineno">  633</span>        <span class="keywordflow">if</span> (qualifiers.count(pIrVol.first-&gt;qualifier) == 0) {</div>
<div class="line"><span class="lineno">  634</span>            qualifiers.insert(pIrVol.first-&gt;qualifier);</div>
<div class="line"><span class="lineno">  635</span>        }</div>
<div class="line"><span class="lineno">  636</span>        ++pIrVol.first;</div>
<div class="line"><span class="lineno">  637</span>    }</div>
<div class="line"><span class="lineno">  638</span>    <span class="comment">// Inflation volatility qualifiers</span></div>
<div class="line"><span class="lineno">  639</span>    <span class="keyword">auto</span> pInfVol = ssRiskTypeIndex.equal_range(make_tuple(nettingSetDetails, pc, RiskType::InflationVol));</div>
<div class="line"><span class="lineno">  640</span>    <span class="keywordflow">while</span> (pInfVol.first != pInfVol.second) {</div>
<div class="line"><span class="lineno">  641</span>        <span class="keywordflow">if</span> (qualifiers.count(pInfVol.first-&gt;qualifier) == 0) {</div>
<div class="line"><span class="lineno">  642</span>            qualifiers.insert(pInfVol.first-&gt;qualifier);</div>
<div class="line"><span class="lineno">  643</span>        }</div>
<div class="line"><span class="lineno">  644</span>        ++pInfVol.first;</div>
<div class="line"><span class="lineno">  645</span>    }</div>
<div class="line"><span class="lineno">  646</span> </div>
<div class="line"><span class="lineno">  647</span>    <span class="comment">// If there are no qualifiers, return early and set bool to false to indicate margin does not apply</span></div>
<div class="line"><span class="lineno">  648</span>    <span class="keywordflow">if</span> (qualifiers.empty()) {</div>
<div class="line"><span class="lineno">  649</span>        bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = 0.0;</div>
<div class="line"><span class="lineno">  650</span>        <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  651</span>    }</div>
<div class="line"><span class="lineno">  652</span> </div>
<div class="line"><span class="lineno">  653</span>    <span class="comment">// Hold the concentration risk for each qualifier i.e. $VCR_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  654</span>    map&lt;string, Real&gt; concentrationRisk;</div>
<div class="line"><span class="lineno">  655</span>    <span class="comment">// The vega margin for each currency i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  656</span>    map&lt;string, Real&gt; vegaMargin;</div>
<div class="line"><span class="lineno">  657</span>    <span class="comment">// The sum of the weighted sensitivities for each currency i.e. $\sum_{k=1}^K VR_{k}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  658</span>    map&lt;string, Real&gt; sumWeightedSensis;</div>
<div class="line"><span class="lineno">  659</span> </div>
<div class="line"><span class="lineno">  660</span>    <span class="comment">// Loop over the qualifiers i.e. currencies</span></div>
<div class="line"><span class="lineno">  661</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; qualifier : qualifiers) {</div>
<div class="line"><span class="lineno">  662</span>        <span class="comment">// Pair of iterators to start and end of IRVol sensitivities with current qualifier</span></div>
<div class="line"><span class="lineno">  663</span>        <span class="keyword">auto</span> pIrQualifier = ssQualifierIndex.equal_range(make_tuple(nettingSetDetails, pc, RiskType::IRVol, qualifier));</div>
<div class="line"><span class="lineno">  664</span> </div>
<div class="line"><span class="lineno">  665</span>        <span class="comment">// Pair of iterators to start and end of InflationVol sensitivities with current qualifier</span></div>
<div class="line"><span class="lineno">  666</span>        <span class="keyword">auto</span> pInfQualifier =</div>
<div class="line"><span class="lineno">  667</span>            ssQualifierIndex.equal_range(make_tuple(nettingSetDetails, pc, RiskType::InflationVol, qualifier));</div>
<div class="line"><span class="lineno">  668</span> </div>
<div class="line"><span class="lineno">  669</span>        <span class="comment">// One pass to get the concentration risk for this qualifier</span></div>
<div class="line"><span class="lineno">  670</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = pIrQualifier.first; it != pIrQualifier.second; ++it) {</div>
<div class="line"><span class="lineno">  671</span>            concentrationRisk[qualifier] += it-&gt;amountUsd;</div>
<div class="line"><span class="lineno">  672</span>        }</div>
<div class="line"><span class="lineno">  673</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = pInfQualifier.first; it != pInfQualifier.second; ++it) {</div>
<div class="line"><span class="lineno">  674</span>            concentrationRisk[qualifier] += it-&gt;amountUsd;</div>
<div class="line"><span class="lineno">  675</span>        }</div>
<div class="line"><span class="lineno">  676</span>        <span class="comment">// Divide by the concentration risk threshold</span></div>
<div class="line"><span class="lineno">  677</span>        concentrationRisk[qualifier] /= <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;concentrationThreshold(RiskType::IRVol, qualifier);</div>
<div class="line"><span class="lineno">  678</span>        <span class="comment">// Final concentration risk amount</span></div>
<div class="line"><span class="lineno">  679</span>        concentrationRisk[qualifier] = max(1.0, sqrt(std::abs(concentrationRisk[qualifier])));</div>
<div class="line"><span class="lineno">  680</span> </div>
<div class="line"><span class="lineno">  681</span>        <span class="comment">// Calculate the margin piece for this qualifier i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  682</span>        <span class="comment">// Start with IRVol vs. IRVol components</span></div>
<div class="line"><span class="lineno">  683</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = pIrQualifier.first; itOuter != pIrQualifier.second; ++itOuter) {</div>
<div class="line"><span class="lineno">  684</span>            <span class="comment">// Risk weight i.e. $RW_k$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  685</span>            Real rwOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;weight(RiskType::IRVol, qualifier, itOuter-&gt;label1);</div>
<div class="line"><span class="lineno">  686</span>            <span class="comment">// Weighted sensitivity i.e. $WS_{k,i}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  687</span>            Real wsOuter = rwOuter * itOuter-&gt;amountUsd * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  688</span>            <span class="comment">// Update weighted sensitivity sum</span></div>
<div class="line"><span class="lineno">  689</span>            sumWeightedSensis[qualifier] += wsOuter;</div>
<div class="line"><span class="lineno">  690</span>            <span class="comment">// Add diagonal element to vega margin</span></div>
<div class="line"><span class="lineno">  691</span>            vegaMargin[qualifier] += wsOuter * wsOuter;</div>
<div class="line"><span class="lineno">  692</span>            <span class="comment">// Add the cross elements to the vega margin</span></div>
<div class="line"><span class="lineno">  693</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = pIrQualifier.first; itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno">  694</span>                <span class="comment">// Label1 level correlation i.e. $\rho_{k,l}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  695</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(RiskType::IRVol, qualifier, itOuter-&gt;label1, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">  696</span>                                                            RiskType::IRVol, qualifier, itInner-&gt;label1, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  697</span>                <span class="comment">// Add cross element to vega margin</span></div>
<div class="line"><span class="lineno">  698</span>                Real rwInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;weight(RiskType::IRVol, qualifier, itInner-&gt;label1);</div>
<div class="line"><span class="lineno">  699</span>                Real wsInner = rwInner * itInner-&gt;amountUsd * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  700</span>                vegaMargin[qualifier] += 2 * corr * wsOuter * wsInner;</div>
<div class="line"><span class="lineno">  701</span>            }</div>
<div class="line"><span class="lineno">  702</span>        }</div>
<div class="line"><span class="lineno">  703</span> </div>
<div class="line"><span class="lineno">  704</span>        <span class="comment">// Now deal with inflation component</span></div>
<div class="line"><span class="lineno">  705</span>        <span class="comment">// To be generic/future-proof, assume that we don&#39;t know correlation structure. The way SIMM is</span></div>
<div class="line"><span class="lineno">  706</span>        <span class="comment">// currently, we could just sum over the InflationVol numbers within qualifier and use this.</span></div>
<div class="line"><span class="lineno">  707</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = pInfQualifier.first; itOuter != pInfQualifier.second; ++itOuter) {</div>
<div class="line"><span class="lineno">  708</span>            <span class="comment">// Risk weight i.e. $RW_k$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  709</span>            Real rwOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;weight(RiskType::InflationVol, qualifier, itOuter-&gt;label1);</div>
<div class="line"><span class="lineno">  710</span>            <span class="comment">// Weighted sensitivity i.e. $WS_{k,i}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  711</span>            Real wsOuter = rwOuter * itOuter-&gt;amountUsd * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  712</span>            <span class="comment">// Update weighted sensitivity sum</span></div>
<div class="line"><span class="lineno">  713</span>            sumWeightedSensis[qualifier] += wsOuter;</div>
<div class="line"><span class="lineno">  714</span>            <span class="comment">// Add diagonal element to vega margin</span></div>
<div class="line"><span class="lineno">  715</span>            vegaMargin[qualifier] += wsOuter * wsOuter;</div>
<div class="line"><span class="lineno">  716</span>            <span class="comment">// Add the cross elements to the vega margin</span></div>
<div class="line"><span class="lineno">  717</span>            <span class="comment">// Firstly, against all IRVol components</span></div>
<div class="line"><span class="lineno">  718</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = pIrQualifier.first; itInner != pIrQualifier.second; ++itInner) {</div>
<div class="line"><span class="lineno">  719</span>                <span class="comment">// Correlation i.e. $\rho_{k,l}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  720</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(RiskType::InflationVol, qualifier, itOuter-&gt;label1, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">  721</span>                                                            RiskType::IRVol, qualifier, itInner-&gt;label1, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  722</span>                <span class="comment">// Add cross element to vega margin</span></div>
<div class="line"><span class="lineno">  723</span>                Real rwInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;weight(RiskType::IRVol, qualifier, itInner-&gt;label1);</div>
<div class="line"><span class="lineno">  724</span>                Real wsInner = rwInner * itInner-&gt;amountUsd * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  725</span>                vegaMargin[qualifier] += 2 * corr * wsOuter * wsInner;</div>
<div class="line"><span class="lineno">  726</span>            }</div>
<div class="line"><span class="lineno">  727</span>            <span class="comment">// Secondly, against all previous InflationVol components</span></div>
<div class="line"><span class="lineno">  728</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = pInfQualifier.first; itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno">  729</span>                <span class="comment">// Correlation i.e. $\rho_{k,l}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  730</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(RiskType::InflationVol, qualifier, itOuter-&gt;label1, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">  731</span>                                                            RiskType::InflationVol, qualifier, itInner-&gt;label1, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  732</span>                <span class="comment">// Add cross element to vega margin</span></div>
<div class="line"><span class="lineno">  733</span>                Real rwInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;weight(RiskType::InflationVol, qualifier, itInner-&gt;label1);</div>
<div class="line"><span class="lineno">  734</span>                Real wsInner = rwInner * itInner-&gt;amountUsd * concentrationRisk[qualifier];</div>
<div class="line"><span class="lineno">  735</span>                vegaMargin[qualifier] += 2 * corr * wsOuter * wsInner;</div>
<div class="line"><span class="lineno">  736</span>            }</div>
<div class="line"><span class="lineno">  737</span>        }</div>
<div class="line"><span class="lineno">  738</span> </div>
<div class="line"><span class="lineno">  739</span>        <span class="comment">// Finally have the value of $K_b$</span></div>
<div class="line"><span class="lineno">  740</span>        vegaMargin[qualifier] = sqrt(max(vegaMargin[qualifier], 0.0));</div>
<div class="line"><span class="lineno">  741</span>    }</div>
<div class="line"><span class="lineno">  742</span> </div>
<div class="line"><span class="lineno">  743</span>    <span class="comment">// Now calculate final vega margin by aggregating across currencies</span></div>
<div class="line"><span class="lineno">  744</span>    Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> = 0.0;</div>
<div class="line"><span class="lineno">  745</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = qualifiers.begin(); itOuter != qualifiers.end(); ++itOuter) {</div>
<div class="line"><span class="lineno">  746</span>        <span class="comment">// Diagonal term</span></div>
<div class="line"><span class="lineno">  747</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += vegaMargin.at(*itOuter) * vegaMargin.at(*itOuter);</div>
<div class="line"><span class="lineno">  748</span>        <span class="comment">// Cross terms</span></div>
<div class="line"><span class="lineno">  749</span>        Real sOuter = max(min(sumWeightedSensis.at(*itOuter), vegaMargin.at(*itOuter)), -vegaMargin.at(*itOuter));</div>
<div class="line"><span class="lineno">  750</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = qualifiers.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno">  751</span>            Real sInner = max(min(sumWeightedSensis.at(*itInner), vegaMargin.at(*itInner)), -vegaMargin.at(*itInner));</div>
<div class="line"><span class="lineno">  752</span>            Real g = min(concentrationRisk.at(*itOuter), concentrationRisk.at(*itInner)) /</div>
<div class="line"><span class="lineno">  753</span>                     max(concentrationRisk.at(*itOuter), concentrationRisk.at(*itInner));</div>
<div class="line"><span class="lineno">  754</span>            Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(RiskType::IRVol, *itOuter, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, RiskType::IRVol, *itInner,</div>
<div class="line"><span class="lineno">  755</span>                                                        <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno">  756</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += 2.0 * sOuter * sInner * corr * g;</div>
<div class="line"><span class="lineno">  757</span>        }</div>
<div class="line"><span class="lineno">  758</span>    }</div>
<div class="line"><span class="lineno">  759</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> = sqrt(max(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>, 0.0));</div>
<div class="line"><span class="lineno">  760</span> </div>
<div class="line"><span class="lineno">  761</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; m : vegaMargin)</div>
<div class="line"><span class="lineno">  762</span>        bucketMargins[m.first] = m.second;</div>
<div class="line"><span class="lineno">  763</span>    bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>;</div>
<div class="line"><span class="lineno">  764</span> </div>
<div class="line"><span class="lineno">  765</span>    <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  766</span>}</div>
</div><!-- fragment --><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a4ea36c0dc24d0c5d96c1f0e0eb539b61_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a4ea36c0dc24d0c5d96c1f0e0eb539b61_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a4ea36c0dc24d0c5d96c1f0e0eb539b61_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a4ea36c0dc24d0c5d96c1f0e0eb539b61_cgraph">
<area shape="rect" title="Calculate the Interest Rate vega margin component for the given portfolio and product class." alt="" coords="5,29,104,55"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f" title=" " alt="" coords="152,29,213,55"/>
</map>
</div>
<div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a4ea36c0dc24d0c5d96c1f0e0eb539b61_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a4ea36c0dc24d0c5d96c1f0e0eb539b61_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a4ea36c0dc24d0c5d96c1f0e0eb539b61_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a4ea36c0dc24d0c5d96c1f0e0eb539b61_icgraph">
<area shape="rect" title="Calculate the Interest Rate vega margin component for the given portfolio and product class." alt="" coords="385,5,484,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#abae54a48ef781027382517a9b0573bcb" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,5,337,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a5492abea466c6543ca7a9a98cc747061" title=" " alt="" coords="5,5,120,31"/>
</map>
</div>

</div>
</div>
<a id="a6cc5da0fd2177b68717c733484631787" name="a6cc5da0fd2177b68717c733484631787"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6cc5da0fd2177b68717c733484631787">&#9670;&#160;</a></span>irCurvatureMargin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pair&lt; map&lt; string, Real &gt;, bool &gt; irCurvatureMargin </td>
          <td>(</td>
          <td class="paramtype">const ore::data::NettingSetDetails &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#aac3c9ca896a60df32236fdc4ef53bdc9">SimmConfiguration::ProductClass</a> &amp;&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;&#160;</td>
          <td class="paramname"><em>netRecords</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the Interest Rate curvature margin component for the given portfolio and product class. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00768">768</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  771</span>                                                                                                              {</div>
<div class="line"><span class="lineno">  772</span> </div>
<div class="line"><span class="lineno">  773</span>    <span class="comment">// &quot;Bucket&quot; here refers to exposures under the CRIF qualifiers</span></div>
<div class="line"><span class="lineno">  774</span>    map&lt;string, Real&gt; bucketMargins;</div>
<div class="line"><span class="lineno">  775</span> </div>
<div class="line"><span class="lineno">  776</span>    <span class="comment">// Multiplier for sensitivities, -1 if SIMM side is Post</span></div>
<div class="line"><span class="lineno">  777</span>    Real multiplier = side == SimmSide::Call ? 1.0 : -1.0;</div>
<div class="line"><span class="lineno">  778</span> </div>
<div class="line"><span class="lineno">  779</span>    <span class="comment">// Index on SIMM sensitivities in to Risk Type level</span></div>
<div class="line"><span class="lineno">  780</span>    <span class="keyword">auto</span>&amp; ssRiskTypeIndex = netRecords.get&lt;RiskTypeTag&gt;();</div>
<div class="line"><span class="lineno">  781</span>    <span class="comment">// Index on SIMM sensitivities in to Qualifier level</span></div>
<div class="line"><span class="lineno">  782</span>    <span class="keyword">auto</span>&amp; ssQualifierIndex = netRecords.get&lt;QualifierTag&gt;();</div>
<div class="line"><span class="lineno">  783</span> </div>
<div class="line"><span class="lineno">  784</span>    <span class="comment">// Find the set of qualifiers, i.e. currencies, in the Simm sensitivities</span></div>
<div class="line"><span class="lineno">  785</span>    set&lt;string&gt; qualifiers;</div>
<div class="line"><span class="lineno">  786</span> </div>
<div class="line"><span class="lineno">  787</span>    <span class="comment">// IRVol qualifiers</span></div>
<div class="line"><span class="lineno">  788</span>    <span class="keyword">auto</span> pIrVol = ssRiskTypeIndex.equal_range(make_tuple(nettingSetDetails, pc, RiskType::IRVol));</div>
<div class="line"><span class="lineno">  789</span>    <span class="keywordflow">while</span> (pIrVol.first != pIrVol.second) {</div>
<div class="line"><span class="lineno">  790</span>        <span class="keywordflow">if</span> (qualifiers.count(pIrVol.first-&gt;qualifier) == 0) {</div>
<div class="line"><span class="lineno">  791</span>            qualifiers.insert(pIrVol.first-&gt;qualifier);</div>
<div class="line"><span class="lineno">  792</span>        }</div>
<div class="line"><span class="lineno">  793</span>        ++pIrVol.first;</div>
<div class="line"><span class="lineno">  794</span>    }</div>
<div class="line"><span class="lineno">  795</span>    <span class="comment">// Inflation volatility qualifiers</span></div>
<div class="line"><span class="lineno">  796</span>    <span class="keyword">auto</span> pInfVol = ssRiskTypeIndex.equal_range(make_tuple(nettingSetDetails, pc, RiskType::InflationVol));</div>
<div class="line"><span class="lineno">  797</span>    <span class="keywordflow">while</span> (pInfVol.first != pInfVol.second) {</div>
<div class="line"><span class="lineno">  798</span>        <span class="keywordflow">if</span> (qualifiers.count(pInfVol.first-&gt;qualifier) == 0) {</div>
<div class="line"><span class="lineno">  799</span>            qualifiers.insert(pInfVol.first-&gt;qualifier);</div>
<div class="line"><span class="lineno">  800</span>        }</div>
<div class="line"><span class="lineno">  801</span>        ++pInfVol.first;</div>
<div class="line"><span class="lineno">  802</span>    }</div>
<div class="line"><span class="lineno">  803</span> </div>
<div class="line"><span class="lineno">  804</span>    <span class="comment">// If there are no qualifiers, return early and set bool to false to indicate margin does not apply</span></div>
<div class="line"><span class="lineno">  805</span>    <span class="keywordflow">if</span> (qualifiers.empty()) {</div>
<div class="line"><span class="lineno">  806</span>        bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = 0.0;</div>
<div class="line"><span class="lineno">  807</span>        <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  808</span>    }</div>
<div class="line"><span class="lineno">  809</span> </div>
<div class="line"><span class="lineno">  810</span>    <span class="comment">// The curvature margin for each currency i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  811</span>    map&lt;string, Real&gt; <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>;</div>
<div class="line"><span class="lineno">  812</span>    <span class="comment">// The sum of the weighted sensitivities for each currency i.e. $\sum_{k}^K CVR_{b,k}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  813</span>    map&lt;string, Real&gt; sumWeightedSensis;</div>
<div class="line"><span class="lineno">  814</span>    <span class="comment">// The sum of all weighted sensitivities across currencies and risk factors</span></div>
<div class="line"><span class="lineno">  815</span>    Real sumWs = 0.0;</div>
<div class="line"><span class="lineno">  816</span>    <span class="comment">// The sum of the absolute value of weighted sensitivities across currencies and risk factors</span></div>
<div class="line"><span class="lineno">  817</span>    Real sumAbsWs = 0.0;</div>
<div class="line"><span class="lineno">  818</span> </div>
<div class="line"><span class="lineno">  819</span>    <span class="comment">// Loop over the qualifiers i.e. currencies</span></div>
<div class="line"><span class="lineno">  820</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; qualifier : qualifiers) {</div>
<div class="line"><span class="lineno">  821</span>        <span class="comment">// Pair of iterators to start and end of IRVol sensitivities with current qualifier</span></div>
<div class="line"><span class="lineno">  822</span>        <span class="keyword">auto</span> pIrQualifier = ssQualifierIndex.equal_range(make_tuple(nettingSetDetails, pc, RiskType::IRVol, qualifier));</div>
<div class="line"><span class="lineno">  823</span> </div>
<div class="line"><span class="lineno">  824</span>        <span class="comment">// Pair of iterators to start and end of InflationVol sensitivities with current qualifier</span></div>
<div class="line"><span class="lineno">  825</span>        <span class="keyword">auto</span> pInfQualifier =</div>
<div class="line"><span class="lineno">  826</span>            ssQualifierIndex.equal_range(make_tuple(nettingSetDetails, pc, RiskType::InflationVol, qualifier));</div>
<div class="line"><span class="lineno">  827</span> </div>
<div class="line"><span class="lineno">  828</span>        <span class="comment">// Calculate the margin piece for this qualifier i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  829</span>        <span class="comment">// Start with IRVol vs. IRVol components</span></div>
<div class="line"><span class="lineno">  830</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = pIrQualifier.first; itOuter != pIrQualifier.second; ++itOuter) {</div>
<div class="line"><span class="lineno">  831</span>            <span class="comment">// Curvature weight i.e. $SF(t_{kj})$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  832</span>            Real sfOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;curvatureWeight(RiskType::IRVol, itOuter-&gt;label1);</div>
<div class="line"><span class="lineno">  833</span>            <span class="comment">// Curvature sensitivity i.e. $CVR_{ik}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  834</span>            Real wsOuter = sfOuter * (itOuter-&gt;amountUsd * multiplier);</div>
<div class="line"><span class="lineno">  835</span>            <span class="comment">// Update weighted sensitivity sums</span></div>
<div class="line"><span class="lineno">  836</span>            sumWeightedSensis[qualifier] += wsOuter;</div>
<div class="line"><span class="lineno">  837</span>            sumWs += wsOuter;</div>
<div class="line"><span class="lineno">  838</span>            sumAbsWs += std::abs(wsOuter);</div>
<div class="line"><span class="lineno">  839</span>            <span class="comment">// Add diagonal element to curvature margin</span></div>
<div class="line"><span class="lineno">  840</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>[qualifier] += wsOuter * wsOuter;</div>
<div class="line"><span class="lineno">  841</span>            <span class="comment">// Add the cross elements to the curvature margin</span></div>
<div class="line"><span class="lineno">  842</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = pIrQualifier.first; itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno">  843</span>                <span class="comment">// Label1 level correlation i.e. $\rho_{k,l}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  844</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(RiskType::IRVol, qualifier, itOuter-&gt;label1, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">  845</span>                                                            RiskType::IRVol, qualifier, itInner-&gt;label1, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  846</span>                <span class="comment">// Add cross element to curvature margin</span></div>
<div class="line"><span class="lineno">  847</span>                Real sfInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;curvatureWeight(RiskType::IRVol, itInner-&gt;label1);</div>
<div class="line"><span class="lineno">  848</span>                Real wsInner = sfInner * (itInner-&gt;amountUsd * multiplier);</div>
<div class="line"><span class="lineno">  849</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>[qualifier] += 2 * corr * corr * wsOuter * wsInner;</div>
<div class="line"><span class="lineno">  850</span>            }</div>
<div class="line"><span class="lineno">  851</span>        }</div>
<div class="line"><span class="lineno">  852</span> </div>
<div class="line"><span class="lineno">  853</span>        <span class="comment">// Now deal with inflation component</span></div>
<div class="line"><span class="lineno">  854</span>        <a class="code hl_enumeration" href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477">SimmVersion</a> version = <a class="code hl_function" href="namespaceore_1_1analytics.html#a715afb0219b3c338740f98cd349e0845">parseSimmVersion</a>(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;version());</div>
<div class="line"><span class="lineno">  855</span>        <a class="code hl_enumeration" href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477">SimmVersion</a> thresholdVersion = <a class="code hl_enumvalue" href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477a6ec11796ccdf73b5b5872c5b8a977832">SimmVersion::V1_0</a>;</div>
<div class="line"><span class="lineno">  856</span>        <span class="keywordflow">if</span> (version &gt; thresholdVersion) {</div>
<div class="line"><span class="lineno">  857</span>            <span class="comment">// Weighted sensitivity i.e. $WS_{k,i}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  858</span>            Real infWs = 0.0;</div>
<div class="line"><span class="lineno">  859</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> infIt = pInfQualifier.first; infIt != pInfQualifier.second; ++infIt) {</div>
<div class="line"><span class="lineno">  860</span>                <span class="comment">// Curvature weight i.e. $SF(t_{kj})$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  861</span>                Real infSf = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;curvatureWeight(RiskType::InflationVol, infIt-&gt;label1);</div>
<div class="line"><span class="lineno">  862</span>                infWs += infSf * (infIt-&gt;amountUsd * multiplier);</div>
<div class="line"><span class="lineno">  863</span>            }</div>
<div class="line"><span class="lineno">  864</span>            <span class="comment">// Update weighted sensitivity sums</span></div>
<div class="line"><span class="lineno">  865</span>            sumWeightedSensis[qualifier] += infWs;</div>
<div class="line"><span class="lineno">  866</span>            sumWs += infWs;</div>
<div class="line"><span class="lineno">  867</span>            sumAbsWs += std::abs(infWs);</div>
<div class="line"><span class="lineno">  868</span> </div>
<div class="line"><span class="lineno">  869</span>            <span class="comment">// Add diagonal element to curvature margin - there is only one element for inflationVol</span></div>
<div class="line"><span class="lineno">  870</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>[qualifier] += infWs * infWs;</div>
<div class="line"><span class="lineno">  871</span> </div>
<div class="line"><span class="lineno">  872</span>            <span class="comment">// Add the cross elements to the curvature margin against IRVol components.</span></div>
<div class="line"><span class="lineno">  873</span>            <span class="comment">// There are no cross elements against InflationVol since we only have one element.</span></div>
<div class="line"><span class="lineno">  874</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> irIt = pIrQualifier.first; irIt != pIrQualifier.second; ++irIt) {</div>
<div class="line"><span class="lineno">  875</span>                <span class="comment">// Correlation i.e. $\rho_{k,l}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  876</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(RiskType::InflationVol, qualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, RiskType::IRVol,</div>
<div class="line"><span class="lineno">  877</span>                                                            qualifier, irIt-&gt;label1, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  878</span>                <span class="comment">// Add cross element to curvature margin</span></div>
<div class="line"><span class="lineno">  879</span>                Real irSf = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;curvatureWeight(RiskType::IRVol, irIt-&gt;label1);</div>
<div class="line"><span class="lineno">  880</span>                Real irWs = irSf * (irIt-&gt;amountUsd * multiplier);</div>
<div class="line"><span class="lineno">  881</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>[qualifier] += 2 * corr * corr * infWs * irWs;</div>
<div class="line"><span class="lineno">  882</span>            }</div>
<div class="line"><span class="lineno">  883</span>        }</div>
<div class="line"><span class="lineno">  884</span> </div>
<div class="line"><span class="lineno">  885</span>        <span class="comment">// Finally have the value of $K_b$</span></div>
<div class="line"><span class="lineno">  886</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>[qualifier] = sqrt(max(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>[qualifier], 0.0));</div>
<div class="line"><span class="lineno">  887</span>    }</div>
<div class="line"><span class="lineno">  888</span> </div>
<div class="line"><span class="lineno">  889</span>    <span class="comment">// If sum of absolute value of all individual curvature risks is zero, we can return 0.0</span></div>
<div class="line"><span class="lineno">  890</span>    <span class="keywordflow">if</span> (close_enough(sumAbsWs, 0.0)) {</div>
<div class="line"><span class="lineno">  891</span>        bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = 0.0;</div>
<div class="line"><span class="lineno">  892</span>        <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  893</span>    }</div>
<div class="line"><span class="lineno">  894</span> </div>
<div class="line"><span class="lineno">  895</span>    <span class="comment">// Now calculate final curvature margin by aggregating across currencies</span></div>
<div class="line"><span class="lineno">  896</span>    Real theta = min(sumWs / sumAbsWs, 0.0);</div>
<div class="line"><span class="lineno">  897</span> </div>
<div class="line"><span class="lineno">  898</span>    Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> = 0.0;</div>
<div class="line"><span class="lineno">  899</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = qualifiers.begin(); itOuter != qualifiers.end(); ++itOuter) {</div>
<div class="line"><span class="lineno">  900</span>        <span class="comment">// Diagonal term</span></div>
<div class="line"><span class="lineno">  901</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>.at(*itOuter) * <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>.at(*itOuter);</div>
<div class="line"><span class="lineno">  902</span>        <span class="comment">// Cross terms</span></div>
<div class="line"><span class="lineno">  903</span>        Real sOuter =</div>
<div class="line"><span class="lineno">  904</span>            max(min(sumWeightedSensis.at(*itOuter), <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>.at(*itOuter)), -<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>.at(*itOuter));</div>
<div class="line"><span class="lineno">  905</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = qualifiers.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno">  906</span>            Real sInner =</div>
<div class="line"><span class="lineno">  907</span>                max(min(sumWeightedSensis.at(*itInner), <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>.at(*itInner)), -<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>.at(*itInner));</div>
<div class="line"><span class="lineno">  908</span>            Real corr =</div>
<div class="line"><span class="lineno">  909</span>                <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(RiskType::IRVol, *itOuter, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, RiskType::IRVol, *itInner, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  910</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += 2.0 * sOuter * sInner * corr * corr;</div>
<div class="line"><span class="lineno">  911</span>        }</div>
<div class="line"><span class="lineno">  912</span>    }</div>
<div class="line"><span class="lineno">  913</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> = sumWs + <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5">lambda</a>(theta) * sqrt(max(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>, 0.0));</div>
<div class="line"><span class="lineno">  914</span> </div>
<div class="line"><span class="lineno">  915</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; m : <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>)</div>
<div class="line"><span class="lineno">  916</span>        bucketMargins[m.first] = m.second;</div>
<div class="line"><span class="lineno">  917</span> </div>
<div class="line"><span class="lineno">  918</span>    Real scaling = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;curvatureMarginScaling();</div>
<div class="line"><span class="lineno">  919</span>    Real totalCurvatureMargin = scaling * max(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>, 0.0);</div>
<div class="line"><span class="lineno">  920</span>    <span class="comment">// TODO: Review, should we return the pre-scaled value instead?</span></div>
<div class="line"><span class="lineno">  921</span>    bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = totalCurvatureMargin;</div>
<div class="line"><span class="lineno">  922</span> </div>
<div class="line"><span class="lineno">  923</span>    <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  924</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_a3fc9a75842580e08b25fca334bdeb9d5"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5">ore::analytics::SimmCalculator::lambda</a></div><div class="ttdeci">QuantLib::Real lambda(QuantLib::Real theta) const</div><div class="ttdoc">Give the  used in the curvature margin calculation.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8cpp_source.html#l01684">simmcalculator.cpp:1684</a></div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a5c1f8b37037e5cd698ccaae388982477"><div class="ttname"><a href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477">ore::analytics::SimmVersion</a></div><div class="ttdeci">SimmVersion</div><div class="ttdoc">Ordered SIMM versions.</div><div class="ttdef"><b>Definition:</b> <a href="utilities_8hpp_source.html#l00042">utilities.hpp:42</a></div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a5c1f8b37037e5cd698ccaae388982477a6ec11796ccdf73b5b5872c5b8a977832"><div class="ttname"><a href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477a6ec11796ccdf73b5b5872c5b8a977832">ore::analytics::SimmVersion::V1_0</a></div><div class="ttdeci">@ V1_0</div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a715afb0219b3c338740f98cd349e0845"><div class="ttname"><a href="namespaceore_1_1analytics.html#a715afb0219b3c338740f98cd349e0845">ore::analytics::parseSimmVersion</a></div><div class="ttdeci">SimmVersion parseSimmVersion(const string &amp;version)</div><div class="ttdef"><b>Definition:</b> <a href="utilities_8cpp_source.html#l00161">utilities.cpp:161</a></div></div>
</div><!-- fragment --><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a6cc5da0fd2177b68717c733484631787_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a6cc5da0fd2177b68717c733484631787_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a6cc5da0fd2177b68717c733484631787_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a6cc5da0fd2177b68717c733484631787_cgraph">
<area shape="rect" title="Calculate the Interest Rate curvature margin component for the given portfolio and product class." alt="" coords="5,99,128,124"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7" title=" " alt="" coords="176,73,289,99"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5" title="Give the &#160;used in the curvature margin calculation." alt="" coords="393,5,457,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f" title=" " alt="" coords="394,85,455,111"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a715afb0219b3c338740f98cd349e0845" title=" " alt="" coords="337,146,512,186"/>
</map>
</div>
<div id="dynsection-10" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-10-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a6cc5da0fd2177b68717c733484631787_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a6cc5da0fd2177b68717c733484631787_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a6cc5da0fd2177b68717c733484631787_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a6cc5da0fd2177b68717c733484631787_icgraph">
<area shape="rect" title="Calculate the Interest Rate curvature margin component for the given portfolio and product class." alt="" coords="385,5,508,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#abae54a48ef781027382517a9b0573bcb" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,5,337,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a5492abea466c6543ca7a9a98cc747061" title=" " alt="" coords="5,5,120,31"/>
</map>
</div>

</div>
</div>
<a id="a28bf3bff3398397c2a09711c5ba1770f" name="a28bf3bff3398397c2a09711c5ba1770f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28bf3bff3398397c2a09711c5ba1770f">&#9670;&#160;</a></span>margin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pair&lt; map&lt; string, Real &gt;, bool &gt; margin </td>
          <td>(</td>
          <td class="paramtype">const ore::data::NettingSetDetails &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#aac3c9ca896a60df32236fdc4ef53bdc9">SimmConfiguration::ProductClass</a> &amp;&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a1c18a2eca0437452edb56ef0965d3ec2">SimmConfiguration::RiskType</a> &amp;&#160;</td>
          <td class="paramname"><em>rt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;&#160;</td>
          <td class="paramname"><em>netRecords</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Calculate the (delta or vega) margin component for the given portfolio, product class and risk type Used to calculate delta or vega or base correlation margin for all risk types except IR, IRVol (and by association, Inflation, XccyBasis and InflationVol) </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l00926">926</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  927</span>                                                                                                                       {</div>
<div class="line"><span class="lineno">  928</span>    </div>
<div class="line"><span class="lineno">  929</span>    <span class="comment">// &quot;Bucket&quot; here refers to exposures under the CRIF qualifiers for FX (and IR) risk class, and CRIF buckets for</span></div>
<div class="line"><span class="lineno">  930</span>    <span class="comment">// every other risk class.</span></div>
<div class="line"><span class="lineno">  931</span>    <span class="comment">// For FX Delta margin, this refers to WS_k in Section B. &quot;Structure of the methodology&quot;, 8.(b).</span></div>
<div class="line"><span class="lineno">  932</span>    <span class="comment">// For FX Vega margin, this refers to VR_k in Section B., 10.(d).</span></div>
<div class="line"><span class="lineno">  933</span>    <span class="comment">// For other risk type, the bucket margin is K_b in the corresponding subsections.</span></div>
<div class="line"><span class="lineno">  934</span>    map&lt;string, Real&gt; bucketMargins;</div>
<div class="line"><span class="lineno">  935</span> </div>
<div class="line"><span class="lineno">  936</span>    <span class="keywordtype">bool</span> riskClassIsFX = rt == RiskType::FX || rt == RiskType::FXVol;</div>
<div class="line"><span class="lineno">  937</span> </div>
<div class="line"><span class="lineno">  938</span>    <span class="comment">// Index on SIMM sensitivities in to risk type level</span></div>
<div class="line"><span class="lineno">  939</span>    <span class="keyword">auto</span>&amp; ssRiskTypeIndex = netRecords.get&lt;RiskTypeTag&gt;();</div>
<div class="line"><span class="lineno">  940</span>    <span class="comment">// Index on SIMM sensitivities in to bucket level</span></div>
<div class="line"><span class="lineno">  941</span>    <span class="keyword">auto</span>&amp; ssBucketIndex = netRecords.get&lt;BucketTag&gt;();</div>
<div class="line"><span class="lineno">  942</span>    <span class="comment">// Index on SIMM sensitivities in to qualifier level</span></div>
<div class="line"><span class="lineno">  943</span>    <span class="keyword">auto</span>&amp; ssQualifierIndex = netRecords.get&lt;BucketQualifierTag&gt;();</div>
<div class="line"><span class="lineno">  944</span> </div>
<div class="line"><span class="lineno">  945</span>    <span class="comment">// Find the set of buckets and associated qualifiers for the netting set details, product class and risk type</span></div>
<div class="line"><span class="lineno">  946</span>    map&lt;string, set&lt;string&gt;&gt; buckets;</div>
<div class="line"><span class="lineno">  947</span>    <span class="keyword">auto</span> p = ssRiskTypeIndex.equal_range(make_tuple(nettingSetDetails, pc, rt));</div>
<div class="line"><span class="lineno">  948</span>    <span class="keywordflow">while</span> (p.first != p.second) {</div>
<div class="line"><span class="lineno">  949</span>        buckets[p.first-&gt;bucket].insert(p.first-&gt;qualifier);</div>
<div class="line"><span class="lineno">  950</span>        ++p.first;</div>
<div class="line"><span class="lineno">  951</span>    }</div>
<div class="line"><span class="lineno">  952</span> </div>
<div class="line"><span class="lineno">  953</span>    <span class="comment">// If there are no buckets, return early and set bool to false to indicate margin does not apply</span></div>
<div class="line"><span class="lineno">  954</span>    <span class="keywordflow">if</span> (buckets.empty()) {</div>
<div class="line"><span class="lineno">  955</span>        bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = 0.0;</div>
<div class="line"><span class="lineno">  956</span>        <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  957</span>    }</div>
<div class="line"><span class="lineno">  958</span> </div>
<div class="line"><span class="lineno">  959</span>    <span class="comment">// The margin for each bucket i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  960</span>    map&lt;string, Real&gt; bucketMargin;</div>
<div class="line"><span class="lineno">  961</span>    <span class="comment">// The sum of the weighted sensitivities for each bucket i.e. $\sum_{k=1}^{K} WS_{k}$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  962</span>    map&lt;string, Real&gt; sumWeightedSensis;</div>
<div class="line"><span class="lineno">  963</span>    <span class="comment">// The historical volatility ratio for the risk type - will be 1.0 if not applicable</span></div>
<div class="line"><span class="lineno">  964</span>    Real hvr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;historicalVolatilityRatio(rt);</div>
<div class="line"><span class="lineno">  965</span> </div>
<div class="line"><span class="lineno">  966</span>    <span class="comment">// Loop over the buckets</span></div>
<div class="line"><span class="lineno">  967</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; kv : buckets) {</div>
<div class="line"><span class="lineno">  968</span>        <span class="keywordtype">string</span> bucket = kv.first;</div>
<div class="line"><span class="lineno">  969</span> </div>
<div class="line"><span class="lineno">  970</span>        <span class="comment">// Initialise sumWeightedSensis here to ensure it is not empty in the later calculations</span></div>
<div class="line"><span class="lineno">  971</span>        sumWeightedSensis[bucket] = 0.0;</div>
<div class="line"><span class="lineno">  972</span> </div>
<div class="line"><span class="lineno">  973</span>        <span class="comment">// Get the concentration risk for each qualifier in current bucket i.e. $CR_k$ from SIMM docs</span></div>
<div class="line"><span class="lineno">  974</span>        map&lt;string, Real&gt; concentrationRisk;</div>
<div class="line"><span class="lineno">  975</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; qualifier : buckets.at(bucket)) {</div>
<div class="line"><span class="lineno">  976</span> </div>
<div class="line"><span class="lineno">  977</span>            <span class="comment">// Do not include Risk_FX components in the calculation currency in the SIMM calculation</span></div>
<div class="line"><span class="lineno">  978</span>            <span class="keywordflow">if</span> (rt == RiskType::FX &amp;&amp; qualifier == <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>) {</div>
<div class="line"><span class="lineno">  979</span>                <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno">  980</span>                    DLOG(<span class="stringliteral">&quot;Not calculating concentration risk for qualifier &quot;</span></div>
<div class="line"><span class="lineno">  981</span>                         &lt;&lt; qualifier &lt;&lt; <span class="stringliteral">&quot; of risk type &quot;</span> &lt;&lt; rt</div>
<div class="line"><span class="lineno">  982</span>                         &lt;&lt; <span class="stringliteral">&quot; since the qualifier equals the SIMM calculation currency &quot;</span> &lt;&lt; <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno">  983</span>                }</div>
<div class="line"><span class="lineno">  984</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  985</span>            }</div>
<div class="line"><span class="lineno">  986</span> </div>
<div class="line"><span class="lineno">  987</span>            <span class="comment">// Pair of iterators to start and end of sensitivities with current qualifier</span></div>
<div class="line"><span class="lineno">  988</span>            <span class="keyword">auto</span> pQualifier = ssQualifierIndex.equal_range(make_tuple(nettingSetDetails, pc, rt, bucket, qualifier));</div>
<div class="line"><span class="lineno">  989</span> </div>
<div class="line"><span class="lineno">  990</span>            <span class="comment">// One pass to get the concentration risk for this qualifier</span></div>
<div class="line"><span class="lineno">  991</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = pQualifier.first; it != pQualifier.second; ++it) {</div>
<div class="line"><span class="lineno">  992</span>                <span class="comment">// Get the sigma value if applicable - returns 1.0 if not applicable</span></div>
<div class="line"><span class="lineno">  993</span>                Real sigma = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;sigma(rt, it-&gt;qualifier, it-&gt;label1, <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno">  994</span>                concentrationRisk[qualifier] += it-&gt;amountUsd * sigma * hvr;</div>
<div class="line"><span class="lineno">  995</span>            }</div>
<div class="line"><span class="lineno">  996</span>            <span class="comment">// Divide by the concentration risk threshold</span></div>
<div class="line"><span class="lineno">  997</span>            concentrationRisk[qualifier] /= <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;concentrationThreshold(rt, qualifier);</div>
<div class="line"><span class="lineno">  998</span>            <span class="comment">// Final concentration risk amount</span></div>
<div class="line"><span class="lineno">  999</span>            concentrationRisk[qualifier] = max(1.0, sqrt(std::abs(concentrationRisk[qualifier])));</div>
<div class="line"><span class="lineno"> 1000</span>        }</div>
<div class="line"><span class="lineno"> 1001</span> </div>
<div class="line"><span class="lineno"> 1002</span>        <span class="comment">// Calculate the margin component for the current bucket</span></div>
<div class="line"><span class="lineno"> 1003</span>        <span class="comment">// Pair of iterators to start and end of sensitivities within current bucket</span></div>
<div class="line"><span class="lineno"> 1004</span>        <span class="keyword">auto</span> pBucket = ssBucketIndex.equal_range(make_tuple(nettingSetDetails, pc, rt, bucket));</div>
<div class="line"><span class="lineno"> 1005</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = pBucket.first; itOuter != pBucket.second; ++itOuter) {</div>
<div class="line"><span class="lineno"> 1006</span>            <span class="comment">// Do not include Risk_FX components in the calculation currency in the SIMM calculation</span></div>
<div class="line"><span class="lineno"> 1007</span>            <span class="keywordflow">if</span> (rt == RiskType::FX &amp;&amp; itOuter-&gt;qualifier == <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>) {</div>
<div class="line"><span class="lineno"> 1008</span>                <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno"> 1009</span>                    DLOG(<span class="stringliteral">&quot;Skipping qualifier &quot;</span> &lt;&lt; itOuter-&gt;qualifier &lt;&lt; <span class="stringliteral">&quot; of risk type &quot;</span> &lt;&lt; rt</div>
<div class="line"><span class="lineno"> 1010</span>                                               &lt;&lt; <span class="stringliteral">&quot; since the qualifier equals the SIMM calculation currency &quot;</span></div>
<div class="line"><span class="lineno"> 1011</span>                                               &lt;&lt; <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno"> 1012</span>                }</div>
<div class="line"><span class="lineno"> 1013</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1014</span>            }</div>
<div class="line"><span class="lineno"> 1015</span>            <span class="comment">// Risk weight i.e. $RW_k$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1016</span>            Real rwOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;weight(rt, itOuter-&gt;qualifier, itOuter-&gt;label1, <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno"> 1017</span>            <span class="comment">// Get the sigma value if applicable - returns 1.0 if not applicable</span></div>
<div class="line"><span class="lineno"> 1018</span>            Real sigmaOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;sigma(rt, itOuter-&gt;qualifier, itOuter-&gt;label1, <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno"> 1019</span>            <span class="comment">// Weighted sensitivity i.e. $WS_{k}$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1020</span>            Real wsOuter = rwOuter * (itOuter-&gt;amountUsd * sigmaOuter * hvr) * concentrationRisk[itOuter-&gt;qualifier];</div>
<div class="line"><span class="lineno"> 1021</span>            <span class="comment">// Update weighted sensitivity sum</span></div>
<div class="line"><span class="lineno"> 1022</span>            sumWeightedSensis[bucket] += wsOuter;</div>
<div class="line"><span class="lineno"> 1023</span>            <span class="comment">// Add diagonal element to bucket margin</span></div>
<div class="line"><span class="lineno"> 1024</span>            bucketMargin[bucket] += wsOuter * wsOuter;</div>
<div class="line"><span class="lineno"> 1025</span>            <span class="comment">// Add the cross elements to the bucket margin</span></div>
<div class="line"><span class="lineno"> 1026</span>            for (<span class="keyword">auto</span> itInner = pBucket.first; itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno"> 1027</span>                <span class="comment">// Do not include Risk_FX components in the calculation currency in the SIMM calculation</span></div>
<div class="line"><span class="lineno"> 1028</span>                <span class="keywordflow">if</span> (rt == RiskType::FX &amp;&amp; itInner-&gt;qualifier == <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>) {</div>
<div class="line"><span class="lineno"> 1029</span>                    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno"> 1030</span>                        DLOG(<span class="stringliteral">&quot;Skipping qualifier &quot;</span> &lt;&lt; itInner-&gt;qualifier &lt;&lt; <span class="stringliteral">&quot; of risk type &quot;</span> &lt;&lt; rt</div>
<div class="line"><span class="lineno"> 1031</span>                                                   &lt;&lt; <span class="stringliteral">&quot; since the qualifier equals the SIMM calculation currency &quot;</span></div>
<div class="line"><span class="lineno"> 1032</span>                                                   &lt;&lt; <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno"> 1033</span>                    }</div>
<div class="line"><span class="lineno"> 1034</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1035</span>                }</div>
<div class="line"><span class="lineno"> 1036</span>                <span class="comment">// Correlation, $\rho_{k,l}$ in the SIMM docs</span></div>
<div class="line"><span class="lineno"> 1037</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(rt, itOuter-&gt;qualifier, itOuter-&gt;label1, itOuter-&gt;label2,</div>
<div class="line"><span class="lineno"> 1038</span>                                                            rt, itInner-&gt;qualifier, itInner-&gt;label1, itInner-&gt;label2,</div>
<div class="line"><span class="lineno"> 1039</span>                                                            <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno"> 1040</span>                <span class="comment">// $f_{k,l}$ from the SIMM docs</span></div>
<div class="line"><span class="lineno"> 1041</span>                Real f = min(concentrationRisk.at(itOuter-&gt;qualifier), concentrationRisk.at(itInner-&gt;qualifier)) /</div>
<div class="line"><span class="lineno"> 1042</span>                         max(concentrationRisk.at(itOuter-&gt;qualifier), concentrationRisk.at(itInner-&gt;qualifier));</div>
<div class="line"><span class="lineno"> 1043</span>                <span class="comment">// Add cross element to delta margin</span></div>
<div class="line"><span class="lineno"> 1044</span>                Real sigmaInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;sigma(rt, itInner-&gt;qualifier, itInner-&gt;label1, <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno"> 1045</span>                Real rwInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;weight(rt, itInner-&gt;qualifier, itInner-&gt;label1, <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno"> 1046</span>                Real wsInner =</div>
<div class="line"><span class="lineno"> 1047</span>                    rwInner * (itInner-&gt;amountUsd * sigmaInner * hvr) * concentrationRisk[itInner-&gt;qualifier];</div>
<div class="line"><span class="lineno"> 1048</span>                bucketMargin[bucket] += 2 * corr * f * wsOuter * wsInner;</div>
<div class="line"><span class="lineno"> 1049</span>            }</div>
<div class="line"><span class="lineno"> 1050</span>            <span class="comment">// For FX risk class, results are broken down by qualifier, i.e. currency, instead of bucket, which is not used for Risk_FX</span></div>
<div class="line"><span class="lineno"> 1051</span>            <span class="keywordflow">if</span> (riskClassIsFX)</div>
<div class="line"><span class="lineno"> 1052</span>                bucketMargins[itOuter-&gt;qualifier] += wsOuter;</div>
<div class="line"><span class="lineno"> 1053</span>        }</div>
<div class="line"><span class="lineno"> 1054</span> </div>
<div class="line"><span class="lineno"> 1055</span>        <span class="comment">// Finally have the value of $K_b$</span></div>
<div class="line"><span class="lineno"> 1056</span>        bucketMargin[bucket] = sqrt(max(bucketMargin[bucket], 0.0));</div>
<div class="line"><span class="lineno"> 1057</span>    }</div>
<div class="line"><span class="lineno"> 1058</span> </div>
<div class="line"><span class="lineno"> 1059</span>    <span class="comment">// If there is a &quot;Residual&quot; bucket entry store it separately</span></div>
<div class="line"><span class="lineno"> 1060</span>    <span class="comment">// This is $K_{residual}$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1061</span>    Real residualMargin = 0.0;</div>
<div class="line"><span class="lineno"> 1062</span>    <span class="keywordflow">if</span> (bucketMargin.count(<span class="stringliteral">&quot;Residual&quot;</span>) &gt; 0) {</div>
<div class="line"><span class="lineno"> 1063</span>        residualMargin = bucketMargin.at(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1064</span>        bucketMargin.erase(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1065</span>    }</div>
<div class="line"><span class="lineno"> 1066</span> </div>
<div class="line"><span class="lineno"> 1067</span>    <span class="comment">// Now calculate final margin by aggregating across non-residual buckets</span></div>
<div class="line"><span class="lineno"> 1068</span>    Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> = 0.0;</div>
<div class="line"><span class="lineno"> 1069</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = bucketMargin.begin(); itOuter != bucketMargin.end(); ++itOuter) {</div>
<div class="line"><span class="lineno"> 1070</span>        <span class="keywordtype">string</span> outerBucket = itOuter-&gt;first;</div>
<div class="line"><span class="lineno"> 1071</span>        <span class="comment">// Diagonal term, $K_b^2$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1072</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += itOuter-&gt;second * itOuter-&gt;second;</div>
<div class="line"><span class="lineno"> 1073</span>        <span class="comment">// Cross terms</span></div>
<div class="line"><span class="lineno"> 1074</span>        <span class="comment">// $S_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1075</span>        Real sOuter = max(min(sumWeightedSensis.at(outerBucket), itOuter-&gt;second), -itOuter-&gt;second);</div>
<div class="line"><span class="lineno"> 1076</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = bucketMargin.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno"> 1077</span>            <span class="keywordtype">string</span> innerBucket = itInner-&gt;first;</div>
<div class="line"><span class="lineno"> 1078</span>            <span class="comment">// $S_c$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1079</span>            Real sInner = max(min(sumWeightedSensis.at(innerBucket), itInner-&gt;second), -itInner-&gt;second);</div>
<div class="line"><span class="lineno"> 1080</span>            <span class="comment">// $\gamma_{b,c}$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1081</span>            <span class="comment">// Interface to SimmConfiguration is on qualifiers =&gt; take any qualifier from each</span></div>
<div class="line"><span class="lineno"> 1082</span>            <span class="comment">// of the respective (different) buckets to get the inter-bucket correlation</span></div>
<div class="line"><span class="lineno"> 1083</span>            <span class="keywordtype">string</span> innerQualifier = *buckets.at(innerBucket).begin();</div>
<div class="line"><span class="lineno"> 1084</span>            <span class="keywordtype">string</span> outerQualifier = *buckets.at(outerBucket).begin();</div>
<div class="line"><span class="lineno"> 1085</span>            Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(rt, outerQualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, rt, innerQualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno"> 1086</span>                                                        <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno"> 1087</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += 2.0 * sOuter * sInner * corr;</div>
<div class="line"><span class="lineno"> 1088</span>        }</div>
<div class="line"><span class="lineno"> 1089</span>    }</div>
<div class="line"><span class="lineno"> 1090</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> = sqrt(max(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>, 0.0));</div>
<div class="line"><span class="lineno"> 1091</span> </div>
<div class="line"><span class="lineno"> 1092</span>    <span class="comment">// Now add the residual component back in</span></div>
<div class="line"><span class="lineno"> 1093</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += residualMargin;</div>
<div class="line"><span class="lineno"> 1094</span>    <span class="keywordflow">if</span> (!close_enough(residualMargin, 0.0))</div>
<div class="line"><span class="lineno"> 1095</span>        bucketMargins[<span class="stringliteral">&quot;Residual&quot;</span>] = residualMargin;</div>
<div class="line"><span class="lineno"> 1096</span> </div>
<div class="line"><span class="lineno"> 1097</span>    <span class="comment">// For non-FX risk class, results are broken down by buckets</span></div>
<div class="line"><span class="lineno"> 1098</span>    <span class="keywordflow">if</span> (!riskClassIsFX)</div>
<div class="line"><span class="lineno"> 1099</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; m : bucketMargin)</div>
<div class="line"><span class="lineno"> 1100</span>            bucketMargins[m.first] = m.second;</div>
<div class="line"><span class="lineno"> 1101</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1102</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; m : bucketMargins)</div>
<div class="line"><span class="lineno"> 1103</span>            m.second = std::abs(m.second);</div>
<div class="line"><span class="lineno"> 1104</span> </div>
<div class="line"><span class="lineno"> 1105</span>    bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>;</div>
<div class="line"><span class="lineno"> 1106</span>    <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1107</span>}</div>
</div><!-- fragment --><div id="dynsection-11" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-11-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a28bf3bff3398397c2a09711c5ba1770f_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a28bf3bff3398397c2a09711c5ba1770f_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a28bf3bff3398397c2a09711c5ba1770f_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a28bf3bff3398397c2a09711c5ba1770f_cgraph">
<area shape="rect" title=" " alt="" coords="5,29,67,55"/>
</map>
</div>
<div id="dynsection-12" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-12-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a28bf3bff3398397c2a09711c5ba1770f_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a28bf3bff3398397c2a09711c5ba1770f_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a28bf3bff3398397c2a09711c5ba1770f_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a28bf3bff3398397c2a09711c5ba1770f_icgraph">
<area shape="rect" title=" " alt="" coords="719,131,780,156"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#abae54a48ef781027382517a9b0573bcb" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,131,337,156"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7" title=" " alt="" coords="557,55,670,80"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a6cc5da0fd2177b68717c733484631787" title="Calculate the Interest Rate curvature margin component for the given portfolio and product class." alt="" coords="385,106,508,131"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a1fd4a0251381cf52e9bfe88653277c00" title="Calculate the Interest Rate delta margin component for the given portfolio and product class." alt="" coords="397,156,496,182"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a4ea36c0dc24d0c5d96c1f0e0eb539b61" title="Calculate the Interest Rate vega margin component for the given portfolio and product class." alt="" coords="397,206,496,231"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#acdab2245e5344cc15b7c0f2da447a59b" title=" " alt="" coords="556,258,671,283"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a5492abea466c6543ca7a9a98cc747061" title=" " alt="" coords="5,131,120,156"/>
</map>
</div>

</div>
</div>
<a id="ab44b983595e1e6c3a0776a474c7313e7" name="ab44b983595e1e6c3a0776a474c7313e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab44b983595e1e6c3a0776a474c7313e7">&#9670;&#160;</a></span>curvatureMargin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pair&lt; map&lt; string, Real &gt;, bool &gt; curvatureMargin </td>
          <td>(</td>
          <td class="paramtype">const ore::data::NettingSetDetails &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#aac3c9ca896a60df32236fdc4ef53bdc9">SimmConfiguration::ProductClass</a> &amp;&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a1c18a2eca0437452edb56ef0965d3ec2">SimmConfiguration::RiskType</a> &amp;&#160;</td>
          <td class="paramname"><em>rt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;&#160;</td>
          <td class="paramname"><em>netRecords</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>rfLabels</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Calculate the curvature margin component for the given portfolio, product class and risk type Used to calculate curvature margin for all risk types except IR </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l01110">1110</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1111</span>                                                                                                                   {</div>
<div class="line"><span class="lineno"> 1112</span> </div>
<div class="line"><span class="lineno"> 1113</span>    <span class="comment">// &quot;Bucket&quot; here refers to exposures under the CRIF qualifiers for FX (and IR) risk class, and CRIF buckets for</span></div>
<div class="line"><span class="lineno"> 1114</span>    <span class="comment">// every other risk class</span></div>
<div class="line"><span class="lineno"> 1115</span>    <span class="comment">// For FX Curvature marrgin, this refers to CVR_{b,k} in Section B. &quot;Structure of the methodology&quot;, 11.(c).</span></div>
<div class="line"><span class="lineno"> 1116</span>    <span class="comment">// For other risk types, the bucket margin is K_b in the corresponding subsection.</span></div>
<div class="line"><span class="lineno"> 1117</span>    map&lt;string, Real&gt; bucketMargins;</div>
<div class="line"><span class="lineno"> 1118</span> </div>
<div class="line"><span class="lineno"> 1119</span>    <span class="keywordtype">bool</span> riskClassIsFX = rt == RiskType::FX || rt == RiskType::FXVol;</div>
<div class="line"><span class="lineno"> 1120</span> </div>
<div class="line"><span class="lineno"> 1121</span>    <span class="comment">// Multiplier for sensitivities, -1 if SIMM side is Post</span></div>
<div class="line"><span class="lineno"> 1122</span>    Real multiplier = side == SimmSide::Call ? 1.0 : -1.0;</div>
<div class="line"><span class="lineno"> 1123</span> </div>
<div class="line"><span class="lineno"> 1124</span>    <span class="comment">// Index on SIMM sensitivities in to risk type level</span></div>
<div class="line"><span class="lineno"> 1125</span>    <span class="keyword">auto</span>&amp; ssRiskTypeIndex = netRecords.get&lt;RiskTypeTag&gt;();</div>
<div class="line"><span class="lineno"> 1126</span>    <span class="comment">// Index on SIMM sensitivities in to bucket level</span></div>
<div class="line"><span class="lineno"> 1127</span>    <span class="keyword">auto</span>&amp; ssBucketIndex = netRecords.get&lt;BucketTag&gt;();</div>
<div class="line"><span class="lineno"> 1128</span> </div>
<div class="line"><span class="lineno"> 1129</span>    <span class="comment">// Find the set of buckets and associated qualifiers for the portfolio, product class and risk type</span></div>
<div class="line"><span class="lineno"> 1130</span>    map&lt;string, set&lt;string&gt;&gt; buckets;</div>
<div class="line"><span class="lineno"> 1131</span>    <span class="keyword">auto</span> p = ssRiskTypeIndex.equal_range(make_tuple(nettingSetDetails, pc, rt));</div>
<div class="line"><span class="lineno"> 1132</span>    <span class="keywordflow">while</span> (p.first != p.second) {</div>
<div class="line"><span class="lineno"> 1133</span>        buckets[p.first-&gt;bucket].insert(p.first-&gt;qualifier);</div>
<div class="line"><span class="lineno"> 1134</span>        ++p.first;</div>
<div class="line"><span class="lineno"> 1135</span>    }</div>
<div class="line"><span class="lineno"> 1136</span> </div>
<div class="line"><span class="lineno"> 1137</span>    <span class="comment">// If there are no buckets, return early and set bool to false to indicate margin does not apply</span></div>
<div class="line"><span class="lineno"> 1138</span>    <span class="keywordflow">if</span> (buckets.empty()) {</div>
<div class="line"><span class="lineno"> 1139</span>        bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = 0.0;</div>
<div class="line"><span class="lineno"> 1140</span>        <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1141</span>    }</div>
<div class="line"><span class="lineno"> 1142</span> </div>
<div class="line"><span class="lineno"> 1143</span>    <span class="comment">// The curvature margin for each bucket i.e. $K_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1144</span>    map&lt;string, Real&gt; <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>;</div>
<div class="line"><span class="lineno"> 1145</span>    <span class="comment">// The sum of the weighted (and absolute weighted) sensitivities for each bucket</span></div>
<div class="line"><span class="lineno"> 1146</span>    <span class="comment">// i.e. $\sum_{k}^K CVR_{b,k}$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1147</span>    map&lt;string, Real&gt; sumWeightedSensis;</div>
<div class="line"><span class="lineno"> 1148</span>    map&lt;string, map&lt;string, Real&gt;&gt; sumAbsTemp;</div>
<div class="line"><span class="lineno"> 1149</span>    map&lt;string, Real&gt; sumAbsWeightedSensis;</div>
<div class="line"><span class="lineno"> 1150</span> </div>
<div class="line"><span class="lineno"> 1151</span>    <span class="comment">// Loop over the buckets</span></div>
<div class="line"><span class="lineno"> 1152</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; kv : buckets) {</div>
<div class="line"><span class="lineno"> 1153</span>        <span class="keywordtype">string</span> bucket = kv.first;</div>
<div class="line"><span class="lineno"> 1154</span>        sumAbsTemp[bucket] = {};</div>
<div class="line"><span class="lineno"> 1155</span> </div>
<div class="line"><span class="lineno"> 1156</span>        <span class="comment">// Calculate the margin component for the current bucket</span></div>
<div class="line"><span class="lineno"> 1157</span>        <span class="comment">// Pair of iterators to start and end of sensitivities within current bucket</span></div>
<div class="line"><span class="lineno"> 1158</span>        <span class="keyword">auto</span> pBucket = ssBucketIndex.equal_range(make_tuple(nettingSetDetails, pc, rt, bucket));</div>
<div class="line"><span class="lineno"> 1159</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = pBucket.first; itOuter != pBucket.second; ++itOuter) {</div>
<div class="line"><span class="lineno"> 1160</span>            <span class="comment">// Curvature weight i.e. $SF(t_{kj})$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1161</span>            Real sfOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;curvatureWeight(rt, itOuter-&gt;label1);</div>
<div class="line"><span class="lineno"> 1162</span>            <span class="comment">// Get the sigma value if applicable - returns 1.0 if not applicable</span></div>
<div class="line"><span class="lineno"> 1163</span>            Real sigmaOuter = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;sigma(rt, itOuter-&gt;qualifier, itOuter-&gt;label1, <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno"> 1164</span>            <span class="comment">// Weighted curvature i.e. $CVR_{ik}$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1165</span>            <span class="comment">// WARNING: The order of multiplication here is important because unit tests fail if for</span></div>
<div class="line"><span class="lineno"> 1166</span>            <span class="comment">//          example you use sfOuter * (itOuter-&gt;amountUsd * multiplier) * sigmaOuter;</span></div>
<div class="line"><span class="lineno"> 1167</span>            Real wsOuter = sfOuter * ((itOuter-&gt;amountUsd * multiplier) * sigmaOuter);</div>
<div class="line"><span class="lineno"> 1168</span>            <span class="comment">// for ISDA SIMM 2.2 or higher, this $CVR_{ik}$ for EQ bucket 12 is zero</span></div>
<div class="line"><span class="lineno"> 1169</span>            <a class="code hl_enumeration" href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477">SimmVersion</a> version = <a class="code hl_function" href="namespaceore_1_1analytics.html#a715afb0219b3c338740f98cd349e0845">parseSimmVersion</a>(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;version());</div>
<div class="line"><span class="lineno"> 1170</span>            <a class="code hl_enumeration" href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477">SimmVersion</a> thresholdVersion = <a class="code hl_enumvalue" href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477aad7eb289e5bbace6151c0537f09ba033">SimmVersion::V2_2</a>;</div>
<div class="line"><span class="lineno"> 1171</span>            <span class="keywordflow">if</span> (version &gt;= thresholdVersion &amp;&amp; bucket == <span class="stringliteral">&quot;12&quot;</span> &amp;&amp; rt == RiskType::EquityVol) {</div>
<div class="line"><span class="lineno"> 1172</span>                wsOuter = 0.0;</div>
<div class="line"><span class="lineno"> 1173</span>            }</div>
<div class="line"><span class="lineno"> 1174</span>            <span class="comment">// Update weighted sensitivity sum</span></div>
<div class="line"><span class="lineno"> 1175</span>            sumWeightedSensis[bucket] += wsOuter;</div>
<div class="line"><span class="lineno"> 1176</span>            sumAbsTemp[bucket][itOuter-&gt;qualifier] += rfLabels ? std::abs(wsOuter) : wsOuter;</div>
<div class="line"><span class="lineno"> 1177</span>            <span class="comment">// Add diagonal element to curvature margin</span></div>
<div class="line"><span class="lineno"> 1178</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>[bucket] += wsOuter * wsOuter;</div>
<div class="line"><span class="lineno"> 1179</span>            <span class="comment">// Add the cross elements to the curvature margin</span></div>
<div class="line"><span class="lineno"> 1180</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = pBucket.first; itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno"> 1181</span>                <span class="comment">// Correlation, $\rho_{k,l}$ in the SIMM docs</span></div>
<div class="line"><span class="lineno"> 1182</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(rt, itOuter-&gt;qualifier, itOuter-&gt;label1, itOuter-&gt;label2,</div>
<div class="line"><span class="lineno"> 1183</span>                                                            rt, itInner-&gt;qualifier, itInner-&gt;label1, itInner-&gt;label2,</div>
<div class="line"><span class="lineno"> 1184</span>                                                            <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno"> 1185</span>                <span class="comment">// Add cross element to delta margin</span></div>
<div class="line"><span class="lineno"> 1186</span>                Real sfInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;curvatureWeight(rt, itInner-&gt;label1);</div>
<div class="line"><span class="lineno"> 1187</span>                Real sigmaInner = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;sigma(rt, itInner-&gt;qualifier, itInner-&gt;label1, <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno"> 1188</span>                Real wsInner = sfInner * ((itInner-&gt;amountUsd * multiplier) * sigmaInner);</div>
<div class="line"><span class="lineno"> 1189</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>[bucket] += 2 * corr * corr * wsOuter * wsInner;</div>
<div class="line"><span class="lineno"> 1190</span>            }</div>
<div class="line"><span class="lineno"> 1191</span>            <span class="comment">// For FX risk class, results are broken down by qualifier, i.e. currency, instead of bucket, which is not</span></div>
<div class="line"><span class="lineno"> 1192</span>            <span class="comment">// used for Risk_FX</span></div>
<div class="line"><span class="lineno"> 1193</span>            <span class="keywordflow">if</span> (riskClassIsFX)</div>
<div class="line"><span class="lineno"> 1194</span>                bucketMargins[itOuter-&gt;qualifier] += wsOuter;</div>
<div class="line"><span class="lineno"> 1195</span>        }</div>
<div class="line"><span class="lineno"> 1196</span> </div>
<div class="line"><span class="lineno"> 1197</span>        <span class="comment">// Finally have the value of $K_b$</span></div>
<div class="line"><span class="lineno"> 1198</span>        Real bucketCurvatureMargin = sqrt(max(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>[bucket], 0.0));</div>
<div class="line"><span class="lineno"> 1199</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>[bucket] = bucketCurvatureMargin;</div>
<div class="line"><span class="lineno"> 1200</span> </div>
<div class="line"><span class="lineno"> 1201</span>        <span class="comment">// Bucket level absolute sensitivity</span></div>
<div class="line"><span class="lineno"> 1202</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; kv : sumAbsTemp[bucket]) {</div>
<div class="line"><span class="lineno"> 1203</span>            sumAbsWeightedSensis[bucket] += std::abs(kv.second);</div>
<div class="line"><span class="lineno"> 1204</span>        }</div>
<div class="line"><span class="lineno"> 1205</span>    }</div>
<div class="line"><span class="lineno"> 1206</span> </div>
<div class="line"><span class="lineno"> 1207</span>    <span class="comment">// If there is a &quot;Residual&quot; bucket entry store it separately</span></div>
<div class="line"><span class="lineno"> 1208</span>    <span class="comment">// This is $K_{residual}$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1209</span>    Real residualMargin = 0.0;</div>
<div class="line"><span class="lineno"> 1210</span>    Real residualSum = 0.0;</div>
<div class="line"><span class="lineno"> 1211</span>    Real residualAbsSum = 0.0;</div>
<div class="line"><span class="lineno"> 1212</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>.count(<span class="stringliteral">&quot;Residual&quot;</span>) &gt; 0) {</div>
<div class="line"><span class="lineno"> 1213</span>        residualMargin = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>.at(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1214</span>        residualSum = sumWeightedSensis.at(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1215</span>        residualAbsSum = sumAbsWeightedSensis.at(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1216</span>        <span class="comment">// Remove the entries for &quot;Residual&quot; bucket</span></div>
<div class="line"><span class="lineno"> 1217</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>.erase(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1218</span>        sumWeightedSensis.erase(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1219</span>        sumAbsWeightedSensis.erase(<span class="stringliteral">&quot;Residual&quot;</span>);</div>
<div class="line"><span class="lineno"> 1220</span>    }</div>
<div class="line"><span class="lineno"> 1221</span> </div>
<div class="line"><span class="lineno"> 1222</span>    <span class="comment">// Now calculate final margin</span></div>
<div class="line"><span class="lineno"> 1223</span>    Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> = 0.0;</div>
<div class="line"><span class="lineno"> 1224</span> </div>
<div class="line"><span class="lineno"> 1225</span>    <span class="comment">// First, aggregating across non-residual buckets</span></div>
<div class="line"><span class="lineno"> 1226</span>    <span class="keyword">auto</span> acc = [](<span class="keyword">const</span> Real p, <span class="keyword">const</span> pair&lt;const string, Real&gt;&amp; kv) { <span class="keywordflow">return</span> p + kv.second; };</div>
<div class="line"><span class="lineno"> 1227</span>    Real sumSensis = accumulate(sumWeightedSensis.begin(), sumWeightedSensis.end(), 0.0, acc);</div>
<div class="line"><span class="lineno"> 1228</span>    Real sumAbsSensis = accumulate(sumAbsWeightedSensis.begin(), sumAbsWeightedSensis.end(), 0.0, acc);</div>
<div class="line"><span class="lineno"> 1229</span> </div>
<div class="line"><span class="lineno"> 1230</span>    <span class="keywordflow">if</span> (!close_enough(sumAbsSensis, 0.0)) {</div>
<div class="line"><span class="lineno"> 1231</span>        Real theta = min(sumSensis / sumAbsSensis, 0.0);</div>
<div class="line"><span class="lineno"> 1232</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> itOuter = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>.begin(); itOuter != <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>.end(); ++itOuter) {</div>
<div class="line"><span class="lineno"> 1233</span>            <span class="keywordtype">string</span> outerBucket = itOuter-&gt;first;</div>
<div class="line"><span class="lineno"> 1234</span>            <span class="comment">// Diagonal term</span></div>
<div class="line"><span class="lineno"> 1235</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += itOuter-&gt;second * itOuter-&gt;second;</div>
<div class="line"><span class="lineno"> 1236</span>            <span class="comment">// Cross terms</span></div>
<div class="line"><span class="lineno"> 1237</span>            <span class="comment">// $S_b$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1238</span>            Real sOuter = max(min(sumWeightedSensis.at(outerBucket), itOuter-&gt;second), -itOuter-&gt;second);</div>
<div class="line"><span class="lineno"> 1239</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> itInner = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>.begin(); itInner != itOuter; ++itInner) {</div>
<div class="line"><span class="lineno"> 1240</span>                <span class="keywordtype">string</span> innerBucket = itInner-&gt;first;</div>
<div class="line"><span class="lineno"> 1241</span>                <span class="comment">// $S_c$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1242</span>                Real sInner = max(min(sumWeightedSensis.at(innerBucket), itInner-&gt;second), -itInner-&gt;second);</div>
<div class="line"><span class="lineno"> 1243</span>                <span class="comment">// $\gamma_{b,c}$ from SIMM docs</span></div>
<div class="line"><span class="lineno"> 1244</span>                <span class="comment">// Interface to SimmConfiguration is on qualifiers =&gt; take any qualifier from each</span></div>
<div class="line"><span class="lineno"> 1245</span>                <span class="comment">// of the respective (different) buckets to get the inter-bucket correlation</span></div>
<div class="line"><span class="lineno"> 1246</span>                <span class="keywordtype">string</span> innerQualifier = *buckets.at(innerBucket).begin();</div>
<div class="line"><span class="lineno"> 1247</span>                <span class="keywordtype">string</span> outerQualifier = *buckets.at(outerBucket).begin();</div>
<div class="line"><span class="lineno"> 1248</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlation(rt, outerQualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, rt, innerQualifier, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno"> 1249</span>                                                            <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#abb36b19e887d4397b44b9e9d0ec34f52">calculationCcy_</a>);</div>
<div class="line"><span class="lineno"> 1250</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += 2.0 * sOuter * sInner * corr * corr;</div>
<div class="line"><span class="lineno"> 1251</span>            }</div>
<div class="line"><span class="lineno"> 1252</span>        }</div>
<div class="line"><span class="lineno"> 1253</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> = max(sumSensis + <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5">lambda</a>(theta) * sqrt(max(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>, 0.0)), 0.0);</div>
<div class="line"><span class="lineno"> 1254</span>    }</div>
<div class="line"><span class="lineno"> 1255</span> </div>
<div class="line"><span class="lineno"> 1256</span>    <span class="comment">// Second, the residual bucket if necessary, and add &quot;Residual&quot; bucket back in to be added to the SIMM results</span></div>
<div class="line"><span class="lineno"> 1257</span>    <span class="keywordflow">if</span> (!close_enough(residualAbsSum, 0.0)) {</div>
<div class="line"><span class="lineno"> 1258</span>        Real theta = min(residualSum / residualAbsSum, 0.0);</div>
<div class="line"><span class="lineno"> 1259</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>[<span class="stringliteral">&quot;Residual&quot;</span>] = max(residualSum + <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5">lambda</a>(theta) * residualMargin, 0.0);</div>
<div class="line"><span class="lineno"> 1260</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>[<span class="stringliteral">&quot;Residual&quot;</span>];</div>
<div class="line"><span class="lineno"> 1261</span>    }</div>
<div class="line"><span class="lineno"> 1262</span> </div>
<div class="line"><span class="lineno"> 1263</span>    <span class="comment">// For non-FX risk class, results are broken down by buckets</span></div>
<div class="line"><span class="lineno"> 1264</span>    <span class="keywordflow">if</span> (!riskClassIsFX)</div>
<div class="line"><span class="lineno"> 1265</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; m : <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7">curvatureMargin</a>)</div>
<div class="line"><span class="lineno"> 1266</span>            bucketMargins[m.first] = m.second;</div>
<div class="line"><span class="lineno"> 1267</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1268</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; m : bucketMargins)</div>
<div class="line"><span class="lineno"> 1269</span>            m.second = std::abs(m.second);</div>
<div class="line"><span class="lineno"> 1270</span> </div>
<div class="line"><span class="lineno"> 1271</span>    bucketMargins[<span class="stringliteral">&quot;All&quot;</span>] = <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>;</div>
<div class="line"><span class="lineno"> 1272</span>    <span class="keywordflow">return</span> make_pair(bucketMargins, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1273</span>}</div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a5c1f8b37037e5cd698ccaae388982477aad7eb289e5bbace6151c0537f09ba033"><div class="ttname"><a href="namespaceore_1_1analytics.html#a5c1f8b37037e5cd698ccaae388982477aad7eb289e5bbace6151c0537f09ba033">ore::analytics::SimmVersion::V2_2</a></div><div class="ttdeci">@ V2_2</div></div>
</div><!-- fragment --><div id="dynsection-13" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-13-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_ab44b983595e1e6c3a0776a474c7313e7_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_ab44b983595e1e6c3a0776a474c7313e7_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_ab44b983595e1e6c3a0776a474c7313e7_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_ab44b983595e1e6c3a0776a474c7313e7_cgraph">
<area shape="rect" title=" " alt="" coords="5,79,119,104"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a3fc9a75842580e08b25fca334bdeb9d5" title="Give the &#160;used in the curvature margin calculation." alt="" coords="222,5,286,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f" title=" " alt="" coords="223,79,285,104"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a715afb0219b3c338740f98cd349e0845" title=" " alt="" coords="167,129,341,169"/>
</map>
</div>
<div id="dynsection-14" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-14-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_ab44b983595e1e6c3a0776a474c7313e7_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_ab44b983595e1e6c3a0776a474c7313e7_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_ab44b983595e1e6c3a0776a474c7313e7_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_ab44b983595e1e6c3a0776a474c7313e7_icgraph">
<area shape="rect" title=" " alt="" coords="556,29,669,55"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#abae54a48ef781027382517a9b0573bcb" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,29,337,55"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a6cc5da0fd2177b68717c733484631787" title="Calculate the Interest Rate curvature margin component for the given portfolio and product class." alt="" coords="385,55,508,80"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a5492abea466c6543ca7a9a98cc747061" title=" " alt="" coords="5,29,120,55"/>
</map>
</div>

</div>
</div>
<a id="a4ebc63fe274dc9049972ebd3bc5af82f" name="a4ebc63fe274dc9049972ebd3bc5af82f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ebc63fe274dc9049972ebd3bc5af82f">&#9670;&#160;</a></span>calcAddMargin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calcAddMargin </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ore::data::NettingSetDetails &amp;&#160;</td>
          <td class="paramname"><em>nsd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>regulation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> &amp;&#160;</td>
          <td class="paramname"><em>netRecords</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the additional initial margin for the portfolio ID and regulation. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l01275">1275</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1276</span>                                                                                                     {</div>
<div class="line"><span class="lineno"> 1277</span> </div>
<div class="line"><span class="lineno"> 1278</span>    <span class="comment">// Index on SIMM sensitivities in to risk type level</span></div>
<div class="line"><span class="lineno"> 1279</span>    <span class="keyword">auto</span>&amp; ssRiskTypeIndex = netRecords.get&lt;RiskTypeTag&gt;();</div>
<div class="line"><span class="lineno"> 1280</span> </div>
<div class="line"><span class="lineno"> 1281</span>    <span class="comment">// Reference to SIMM results for this portfolio</span></div>
<div class="line"><span class="lineno"> 1282</span>    <span class="keyword">auto</span>&amp; results = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a>[side][nettingSetDetails][regulation];</div>
<div class="line"><span class="lineno"> 1283</span> </div>
<div class="line"><span class="lineno"> 1284</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> overwrite = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1285</span> </div>
<div class="line"><span class="lineno"> 1286</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno"> 1287</span>        DLOG(<span class="stringliteral">&quot;Calculating additional margin for portfolio [&quot;</span> &lt;&lt; nettingSetDetails &lt;&lt; <span class="stringliteral">&quot;], regulation &quot;</span> &lt;&lt; regulation</div>
<div class="line"><span class="lineno"> 1288</span>                                                             &lt;&lt; <span class="stringliteral">&quot; and SIMM side &quot;</span> &lt;&lt; side);</div>
<div class="line"><span class="lineno"> 1289</span>    }</div>
<div class="line"><span class="lineno"> 1290</span> </div>
<div class="line"><span class="lineno"> 1291</span>    <span class="comment">// First, add scaled additional margin, using &quot;ProductClassMultiplier&quot;</span></div>
<div class="line"><span class="lineno"> 1292</span>    <span class="comment">// risk type, for the portfolio</span></div>
<div class="line"><span class="lineno"> 1293</span>    <span class="keyword">auto</span> pc = ProductClass::Empty;</div>
<div class="line"><span class="lineno"> 1294</span>    <span class="keyword">auto</span> rt = RiskType::ProductClassMultiplier;</div>
<div class="line"><span class="lineno"> 1295</span>    <span class="keyword">auto</span> key = make_tuple(nettingSetDetails, pc, rt);</div>
<div class="line"><span class="lineno"> 1296</span>    <span class="keyword">auto</span> pIt = ssRiskTypeIndex.equal_range(key);</div>
<div class="line"><span class="lineno"> 1297</span> </div>
<div class="line"><span class="lineno"> 1298</span>    <span class="keywordflow">while</span> (pIt.first != pIt.second) {</div>
<div class="line"><span class="lineno"> 1299</span>        <span class="comment">// Qualifier should be a product class string</span></div>
<div class="line"><span class="lineno"> 1300</span>        <span class="keyword">auto</span> qpc = <a class="code hl_function" href="namespaceore_1_1analytics.html#add08f2897926c73ba4b8dcf55feebdd9">parseSimmProductClass</a>(pIt.first-&gt;qualifier);</div>
<div class="line"><span class="lineno"> 1301</span>        <span class="keywordflow">if</span> (results.has(qpc, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1302</span>            Real im = results.get(qpc, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1303</span>            Real factor = pIt.first-&gt;amount;</div>
<div class="line"><span class="lineno"> 1304</span>            QL_REQUIRE(factor &gt;= 1.0, <span class="stringliteral">&quot;SIMM Calculator: Amount for risk type &quot;</span></div>
<div class="line"><span class="lineno"> 1305</span>                                          &lt;&lt; rt &lt;&lt; <span class="stringliteral">&quot; must be greater than or equal to 1.0 but we got &quot;</span> &lt;&lt; factor);</div>
<div class="line"><span class="lineno"> 1306</span>            Real pcmMargin = (factor - 1.0) * im;</div>
<div class="line"><span class="lineno"> 1307</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, qpc, RiskClass::All, MarginType::AdditionalIM, <span class="stringliteral">&quot;All&quot;</span>, pcmMargin, side,</div>
<div class="line"><span class="lineno"> 1308</span>                overwrite);</div>
<div class="line"><span class="lineno"> 1309</span> </div>
<div class="line"><span class="lineno"> 1310</span>            <span class="comment">// Add to aggregation at margin type level</span></div>
<div class="line"><span class="lineno"> 1311</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, qpc, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>, pcmMargin, side, overwrite);</div>
<div class="line"><span class="lineno"> 1312</span>            <span class="comment">// Add to aggregation at product class level</span></div>
<div class="line"><span class="lineno"> 1313</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, MarginType::AdditionalIM, <span class="stringliteral">&quot;All&quot;</span>, pcmMargin,</div>
<div class="line"><span class="lineno"> 1314</span>                side, overwrite);</div>
<div class="line"><span class="lineno"> 1315</span>            <span class="comment">// Add to aggregation at portfolio level</span></div>
<div class="line"><span class="lineno"> 1316</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>, pcmMargin, side,</div>
<div class="line"><span class="lineno"> 1317</span>                overwrite);</div>
<div class="line"><span class="lineno"> 1318</span>        }</div>
<div class="line"><span class="lineno"> 1319</span>        ++pIt.first;</div>
<div class="line"><span class="lineno"> 1320</span>    }</div>
<div class="line"><span class="lineno"> 1321</span> </div>
<div class="line"><span class="lineno"> 1322</span>    <span class="comment">// Second, add fixed amounts IM, using &quot;AddOnFixedAmount&quot; risk type, for the portfolio</span></div>
<div class="line"><span class="lineno"> 1323</span>    rt = RiskType::AddOnFixedAmount;</div>
<div class="line"><span class="lineno"> 1324</span>    key = make_tuple(nettingSetDetails, pc, rt);</div>
<div class="line"><span class="lineno"> 1325</span>    pIt = ssRiskTypeIndex.equal_range(key);</div>
<div class="line"><span class="lineno"> 1326</span>    <span class="keywordflow">while</span> (pIt.first != pIt.second) {</div>
<div class="line"><span class="lineno"> 1327</span>        Real fixedMargin = pIt.first-&gt;amountUsd;</div>
<div class="line"><span class="lineno"> 1328</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, ProductClass::AddOnFixedAmount, RiskClass::All, MarginType::AdditionalIM,</div>
<div class="line"><span class="lineno"> 1329</span>            <span class="stringliteral">&quot;All&quot;</span>, fixedMargin, side, overwrite);</div>
<div class="line"><span class="lineno"> 1330</span> </div>
<div class="line"><span class="lineno"> 1331</span>        <span class="comment">// Add to aggregation at margin type level</span></div>
<div class="line"><span class="lineno"> 1332</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, ProductClass::AddOnFixedAmount, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>,</div>
<div class="line"><span class="lineno"> 1333</span>            fixedMargin,</div>
<div class="line"><span class="lineno"> 1334</span>            side, overwrite);</div>
<div class="line"><span class="lineno"> 1335</span>        <span class="comment">// Add to aggregation at product class level</span></div>
<div class="line"><span class="lineno"> 1336</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, MarginType::AdditionalIM, <span class="stringliteral">&quot;All&quot;</span>,</div>
<div class="line"><span class="lineno"> 1337</span>            fixedMargin, side, overwrite);</div>
<div class="line"><span class="lineno"> 1338</span>        <span class="comment">// Add to aggregation at portfolio level</span></div>
<div class="line"><span class="lineno"> 1339</span>        <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>, fixedMargin, side,</div>
<div class="line"><span class="lineno"> 1340</span>            overwrite);</div>
<div class="line"><span class="lineno"> 1341</span>        ++pIt.first;</div>
<div class="line"><span class="lineno"> 1342</span>    }</div>
<div class="line"><span class="lineno"> 1343</span> </div>
<div class="line"><span class="lineno"> 1344</span>    <span class="comment">// Third, add percentage of notional amounts IM, using &quot;AddOnNotionalFactor&quot;</span></div>
<div class="line"><span class="lineno"> 1345</span>    <span class="comment">// and &quot;Notional&quot; risk types, for the portfolio.</span></div>
<div class="line"><span class="lineno"> 1346</span> </div>
<div class="line"><span class="lineno"> 1347</span>    <span class="comment">// Index on SIMM sensitivities in to risk type level</span></div>
<div class="line"><span class="lineno"> 1348</span>    <span class="keyword">auto</span>&amp; ssQualifierIndex = netRecords.get&lt;QualifierTag&gt;();</div>
<div class="line"><span class="lineno"> 1349</span> </div>
<div class="line"><span class="lineno"> 1350</span>    rt = RiskType::AddOnNotionalFactor;</div>
<div class="line"><span class="lineno"> 1351</span>    key = make_tuple(nettingSetDetails, pc, rt);</div>
<div class="line"><span class="lineno"> 1352</span>    pIt = ssRiskTypeIndex.equal_range(key);</div>
<div class="line"><span class="lineno"> 1353</span>    <span class="keywordflow">while</span> (pIt.first != pIt.second) {</div>
<div class="line"><span class="lineno"> 1354</span>        <span class="comment">// We should have a single corresponding CrifRecord with risk type</span></div>
<div class="line"><span class="lineno"> 1355</span>        <span class="comment">// &quot;Notional&quot; and the same qualifier. Search for it.</span></div>
<div class="line"><span class="lineno"> 1356</span>        <span class="keyword">auto</span> pQualifierIt = ssQualifierIndex.equal_range(</div>
<div class="line"><span class="lineno"> 1357</span>            make_tuple(nettingSetDetails, pc, RiskType::Notional, pIt.first-&gt;qualifier));</div>
<div class="line"><span class="lineno"> 1358</span>        <span class="keyword">auto</span> count = distance(pQualifierIt.first, pQualifierIt.second);</div>
<div class="line"><span class="lineno"> 1359</span>        QL_REQUIRE(count &lt; 2, <span class="stringliteral">&quot;Expected either 0 or 1 elements for risk type &quot;</span></div>
<div class="line"><span class="lineno"> 1360</span>                                    &lt;&lt; RiskType::Notional &lt;&lt; <span class="stringliteral">&quot; and qualifier &quot;</span> &lt;&lt; pIt.first-&gt;qualifier</div>
<div class="line"><span class="lineno"> 1361</span>                                    &lt;&lt; <span class="stringliteral">&quot; but got &quot;</span> &lt;&lt; count);</div>
<div class="line"><span class="lineno"> 1362</span> </div>
<div class="line"><span class="lineno"> 1363</span>        <span class="comment">// If we have found a corresponding notional, update the additional margin</span></div>
<div class="line"><span class="lineno"> 1364</span>        <span class="keywordflow">if</span> (count == 1) {</div>
<div class="line"><span class="lineno"> 1365</span>            Real notional = pQualifierIt.first-&gt;amountUsd;</div>
<div class="line"><span class="lineno"> 1366</span>            Real factor = pIt.first-&gt;amount;</div>
<div class="line"><span class="lineno"> 1367</span>            Real notionalFactorMargin = notional * factor / 100.0;</div>
<div class="line"><span class="lineno"> 1368</span> </div>
<div class="line"><span class="lineno"> 1369</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, ProductClass::AddOnNotionalFactor, RiskClass::All,</div>
<div class="line"><span class="lineno"> 1370</span>                MarginType::AdditionalIM, <span class="stringliteral">&quot;All&quot;</span>, notionalFactorMargin, side, overwrite);</div>
<div class="line"><span class="lineno"> 1371</span> </div>
<div class="line"><span class="lineno"> 1372</span>            <span class="comment">// Add to aggregation at margin type level</span></div>
<div class="line"><span class="lineno"> 1373</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, ProductClass::AddOnNotionalFactor, RiskClass::All, MarginType::All,</div>
<div class="line"><span class="lineno"> 1374</span>                <span class="stringliteral">&quot;All&quot;</span>,</div>
<div class="line"><span class="lineno"> 1375</span>                notionalFactorMargin, side, overwrite);</div>
<div class="line"><span class="lineno"> 1376</span>            <span class="comment">// Add to aggregation at product class level</span></div>
<div class="line"><span class="lineno"> 1377</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, MarginType::AdditionalIM, <span class="stringliteral">&quot;All&quot;</span>,</div>
<div class="line"><span class="lineno"> 1378</span>                notionalFactorMargin, side, overwrite);</div>
<div class="line"><span class="lineno"> 1379</span>            <span class="comment">// Add to aggregation at portfolio level</span></div>
<div class="line"><span class="lineno"> 1380</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>,</div>
<div class="line"><span class="lineno"> 1381</span>                notionalFactorMargin,</div>
<div class="line"><span class="lineno"> 1382</span>                side, overwrite);</div>
<div class="line"><span class="lineno"> 1383</span>        }</div>
<div class="line"><span class="lineno"> 1384</span> </div>
<div class="line"><span class="lineno"> 1385</span>        ++pIt.first;</div>
<div class="line"><span class="lineno"> 1386</span>    }</div>
<div class="line"><span class="lineno"> 1387</span>}</div>
<div class="ttc" id="anamespaceore_1_1analytics_html_add08f2897926c73ba4b8dcf55feebdd9"><div class="ttname"><a href="namespaceore_1_1analytics.html#add08f2897926c73ba4b8dcf55feebdd9">ore::analytics::parseSimmProductClass</a></div><div class="ttdeci">SimmConfiguration::ProductClass parseSimmProductClass(const string &amp;pc)</div><div class="ttdef"><b>Definition:</b> <a href="simmconfiguration_8cpp_source.html#l00471">simmconfiguration.cpp:471</a></div></div>
</div><!-- fragment --><div id="dynsection-15" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-15-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a4ebc63fe274dc9049972ebd3bc5af82f_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a4ebc63fe274dc9049972ebd3bc5af82f_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a4ebc63fe274dc9049972ebd3bc5af82f_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a4ebc63fe274dc9049972ebd3bc5af82f_cgraph">
<area shape="rect" title="Calculate the additional initial margin for the portfolio ID and regulation." alt="" coords="5,35,113,60"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7" title=" " alt="" coords="227,5,270,31"/>
<area shape="rect" href="namespaceore_1_1analytics.html#add08f2897926c73ba4b8dcf55feebdd9" title=" " alt="" coords="161,55,336,95"/>
</map>
</div>
<div id="dynsection-16" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-16-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-16-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-16-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a4ebc63fe274dc9049972ebd3bc5af82f_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a4ebc63fe274dc9049972ebd3bc5af82f_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a4ebc63fe274dc9049972ebd3bc5af82f_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a4ebc63fe274dc9049972ebd3bc5af82f_icgraph">
<area shape="rect" title="Calculate the additional initial margin for the portfolio ID and regulation." alt="" coords="385,5,493,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#abae54a48ef781027382517a9b0573bcb" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,5,337,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a5492abea466c6543ca7a9a98cc747061" title=" " alt="" coords="5,5,120,31"/>
</map>
</div>

</div>
</div>
<a id="acdab2245e5344cc15b7c0f2da447a59b" name="acdab2245e5344cc15b7c0f2da447a59b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdab2245e5344cc15b7c0f2da447a59b">&#9670;&#160;</a></span>populateResults()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void populateResults </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ore::data::NettingSetDetails &amp;&#160;</td>
          <td class="paramname"><em>nsd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>regulation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Populate the results structure with the higher level results after the IMs have been calculated at the (product class, risk class, margin type) level for the given regulation under the given portfolio </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l01389">1389</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1390</span>                                                               {</div>
<div class="line"><span class="lineno"> 1391</span> </div>
<div class="line"><span class="lineno"> 1392</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aa2fedb3c02ffb092a6c19a0ee1e81a02">quiet_</a>) {</div>
<div class="line"><span class="lineno"> 1393</span>        LOG(<span class="stringliteral">&quot;SimmCalculator: Populating higher level results&quot;</span>)</div>
<div class="line"><span class="lineno"> 1394</span>    }</div>
<div class="line"><span class="lineno"> 1395</span> </div>
<div class="line"><span class="lineno"> 1396</span>    <span class="comment">// Sets of classes (excluding &#39;All&#39;)</span></div>
<div class="line"><span class="lineno"> 1397</span>    <span class="keyword">auto</span> pcs = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;productClasses(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1398</span>    <span class="keyword">auto</span> rcs = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;riskClasses(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1399</span>    <span class="keyword">auto</span> mts = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;marginTypes(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1400</span> </div>
<div class="line"><span class="lineno"> 1401</span>    <span class="comment">// Populate netting set level results for each portfolio</span></div>
<div class="line"><span class="lineno"> 1402</span> </div>
<div class="line"><span class="lineno"> 1403</span>    <span class="comment">// Reference to SIMM results for this portfolio</span></div>
<div class="line"><span class="lineno"> 1404</span>    <span class="keyword">auto</span>&amp; results = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a>[side][nettingSetDetails][regulation];</div>
<div class="line"><span class="lineno"> 1405</span> </div>
<div class="line"><span class="lineno"> 1406</span>    <span class="comment">// Fill in the margin within each (product class, risk class) combination</span></div>
<div class="line"><span class="lineno"> 1407</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pc : pcs) {</div>
<div class="line"><span class="lineno"> 1408</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; rc : rcs) {</div>
<div class="line"><span class="lineno"> 1409</span>            <span class="comment">// Margin for a risk class is just sum over margin for each margin type</span></div>
<div class="line"><span class="lineno"> 1410</span>            <span class="comment">// within that risk class</span></div>
<div class="line"><span class="lineno"> 1411</span>            Real riskClassMargin = 0.0;</div>
<div class="line"><span class="lineno"> 1412</span>            <span class="keywordtype">bool</span> hasRiskClass = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1413</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; mt : mts) {</div>
<div class="line"><span class="lineno"> 1414</span>                <span class="keywordflow">if</span> (results.has(pc, rc, mt, <span class="stringliteral">&quot;All&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1415</span>                    riskClassMargin += results.get(pc, rc, mt, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1416</span>                    <span class="keywordflow">if</span> (!hasRiskClass)</div>
<div class="line"><span class="lineno"> 1417</span>                        hasRiskClass = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1418</span>                }</div>
<div class="line"><span class="lineno"> 1419</span>            }</div>
<div class="line"><span class="lineno"> 1420</span> </div>
<div class="line"><span class="lineno"> 1421</span>            <span class="comment">// Add the margin to the results if it was calculated</span></div>
<div class="line"><span class="lineno"> 1422</span>            <span class="keywordflow">if</span> (hasRiskClass) {</div>
<div class="line"><span class="lineno"> 1423</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, pc, rc, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>, riskClassMargin, side);</div>
<div class="line"><span class="lineno"> 1424</span>            }</div>
<div class="line"><span class="lineno"> 1425</span>        }</div>
<div class="line"><span class="lineno"> 1426</span>    }</div>
<div class="line"><span class="lineno"> 1427</span> </div>
<div class="line"><span class="lineno"> 1428</span>    <span class="comment">// Fill in the margin within each product class by aggregating across risk classes</span></div>
<div class="line"><span class="lineno"> 1429</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pc : pcs) {</div>
<div class="line"><span class="lineno"> 1430</span>        Real productClassMargin = 0.0;</div>
<div class="line"><span class="lineno"> 1431</span>        <span class="keywordtype">bool</span> hasProductClass = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1432</span> </div>
<div class="line"><span class="lineno"> 1433</span>        <span class="comment">// IM within product class across risk classes requires correlation</span></div>
<div class="line"><span class="lineno"> 1434</span>        <span class="comment">// o suffix =&gt; outer and i suffix =&gt; inner here</span></div>
<div class="line"><span class="lineno"> 1435</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> ito = rcs.begin(); ito != rcs.end(); ++ito) {</div>
<div class="line"><span class="lineno"> 1436</span>            <span class="comment">// Skip to next if no results for current risk class</span></div>
<div class="line"><span class="lineno"> 1437</span>            <span class="keywordflow">if</span> (!results.has(pc, *ito, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>))</div>
<div class="line"><span class="lineno"> 1438</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1439</span>            <span class="comment">// If we get to here, we have the current product class</span></div>
<div class="line"><span class="lineno"> 1440</span>            <span class="keywordflow">if</span> (!hasProductClass)</div>
<div class="line"><span class="lineno"> 1441</span>                hasProductClass = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1442</span> </div>
<div class="line"><span class="lineno"> 1443</span>            Real imo = results.get(pc, *ito, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1444</span>            <span class="comment">// Diagonal term</span></div>
<div class="line"><span class="lineno"> 1445</span>            productClassMargin += imo * imo;</div>
<div class="line"><span class="lineno"> 1446</span> </div>
<div class="line"><span class="lineno"> 1447</span>            <span class="comment">// Now, cross terms</span></div>
<div class="line"><span class="lineno"> 1448</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> iti = rcs.begin(); iti != ito; ++iti) {</div>
<div class="line"><span class="lineno"> 1449</span>                <span class="keywordflow">if</span> (!results.has(pc, *iti, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>))</div>
<div class="line"><span class="lineno"> 1450</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1451</span>                Real imi = results.get(pc, *iti, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1452</span>                <span class="comment">// Get the correlation between risk classes</span></div>
<div class="line"><span class="lineno"> 1453</span>                Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlationRiskClasses(*ito, *iti);</div>
<div class="line"><span class="lineno"> 1454</span>                productClassMargin += 2.0 * corr * imo * imi;</div>
<div class="line"><span class="lineno"> 1455</span>            }</div>
<div class="line"><span class="lineno"> 1456</span>        }</div>
<div class="line"><span class="lineno"> 1457</span> </div>
<div class="line"><span class="lineno"> 1458</span>        <span class="comment">// Add the margin to the results if it was calculated</span></div>
<div class="line"><span class="lineno"> 1459</span>        <span class="keywordflow">if</span> (hasProductClass) {</div>
<div class="line"><span class="lineno"> 1460</span>            productClassMargin = sqrt(max(productClassMargin, 0.0));</div>
<div class="line"><span class="lineno"> 1461</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, pc, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>, productClassMargin, side);</div>
<div class="line"><span class="lineno"> 1462</span>        }</div>
<div class="line"><span class="lineno"> 1463</span>    }</div>
<div class="line"><span class="lineno"> 1464</span> </div>
<div class="line"><span class="lineno"> 1465</span>    <span class="comment">// Overall initial margin for the portfolio is the sum of the initial margin in</span></div>
<div class="line"><span class="lineno"> 1466</span>    <span class="comment">// each of the product classes. Could have done it in the last loop but cleaner here.</span></div>
<div class="line"><span class="lineno"> 1467</span>    Real im = 0.0;</div>
<div class="line"><span class="lineno"> 1468</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pc : pcs) {</div>
<div class="line"><span class="lineno"> 1469</span>        <span class="keywordflow">if</span> (results.has(pc, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1470</span>            im += results.get(pc, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1471</span>        }</div>
<div class="line"><span class="lineno"> 1472</span>    }</div>
<div class="line"><span class="lineno"> 1473</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>, im, side);</div>
<div class="line"><span class="lineno"> 1474</span> </div>
<div class="line"><span class="lineno"> 1475</span>    <span class="comment">// Combinations outside of the natural SIMM hierarchy</span></div>
<div class="line"><span class="lineno"> 1476</span> </div>
<div class="line"><span class="lineno"> 1477</span>    <span class="comment">// Across risk class, for each product class and margin type</span></div>
<div class="line"><span class="lineno"> 1478</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pc : pcs) {</div>
<div class="line"><span class="lineno"> 1479</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; mt : mts) {</div>
<div class="line"><span class="lineno"> 1480</span>            Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> = 0.0;</div>
<div class="line"><span class="lineno"> 1481</span>            <span class="keywordtype">bool</span> hasPcMt = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1482</span> </div>
<div class="line"><span class="lineno"> 1483</span>            <span class="comment">// IM within product class and margin type across risk classes</span></div>
<div class="line"><span class="lineno"> 1484</span>            <span class="comment">// requires correlation. o suffix =&gt; outer and i suffix =&gt; inner here</span></div>
<div class="line"><span class="lineno"> 1485</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> ito = rcs.begin(); ito != rcs.end(); ++ito) {</div>
<div class="line"><span class="lineno"> 1486</span>                <span class="comment">// Skip to next if no results for current risk class</span></div>
<div class="line"><span class="lineno"> 1487</span>                <span class="keywordflow">if</span> (!results.has(pc, *ito, mt, <span class="stringliteral">&quot;All&quot;</span>))</div>
<div class="line"><span class="lineno"> 1488</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1489</span>                <span class="comment">// If we get to here, we have the current product class &amp; margin type</span></div>
<div class="line"><span class="lineno"> 1490</span>                <span class="keywordflow">if</span> (!hasPcMt)</div>
<div class="line"><span class="lineno"> 1491</span>                    hasPcMt = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1492</span> </div>
<div class="line"><span class="lineno"> 1493</span>                Real imo = results.get(pc, *ito, mt, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1494</span>                <span class="comment">// Diagonal term</span></div>
<div class="line"><span class="lineno"> 1495</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += imo * imo;</div>
<div class="line"><span class="lineno"> 1496</span> </div>
<div class="line"><span class="lineno"> 1497</span>                <span class="comment">// Now, cross terms</span></div>
<div class="line"><span class="lineno"> 1498</span>                <span class="keywordflow">for</span> (<span class="keyword">auto</span> iti = rcs.begin(); iti != ito; ++iti) {</div>
<div class="line"><span class="lineno"> 1499</span>                    <span class="keywordflow">if</span> (!results.has(pc, *iti, mt, <span class="stringliteral">&quot;All&quot;</span>))</div>
<div class="line"><span class="lineno"> 1500</span>                        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1501</span>                    Real imi = results.get(pc, *iti, mt, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1502</span>                    <span class="comment">// Get the correlation between risk classes</span></div>
<div class="line"><span class="lineno"> 1503</span>                    Real corr = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>-&gt;correlationRiskClasses(*ito, *iti);</div>
<div class="line"><span class="lineno"> 1504</span>                    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += 2.0 * corr * imo * imi;</div>
<div class="line"><span class="lineno"> 1505</span>                }</div>
<div class="line"><span class="lineno"> 1506</span>            }</div>
<div class="line"><span class="lineno"> 1507</span> </div>
<div class="line"><span class="lineno"> 1508</span>            <span class="comment">// Add the margin to the results if it was calculated</span></div>
<div class="line"><span class="lineno"> 1509</span>            <span class="keywordflow">if</span> (hasPcMt) {</div>
<div class="line"><span class="lineno"> 1510</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> = sqrt(max(<a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>, 0.0));</div>
<div class="line"><span class="lineno"> 1511</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, pc, RiskClass::All, mt, <span class="stringliteral">&quot;All&quot;</span>, <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>, side);</div>
<div class="line"><span class="lineno"> 1512</span>            }</div>
<div class="line"><span class="lineno"> 1513</span>        }</div>
<div class="line"><span class="lineno"> 1514</span>    }</div>
<div class="line"><span class="lineno"> 1515</span> </div>
<div class="line"><span class="lineno"> 1516</span>    <span class="comment">// Across product class, for each risk class and margin type</span></div>
<div class="line"><span class="lineno"> 1517</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; rc : rcs) {</div>
<div class="line"><span class="lineno"> 1518</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; mt : mts) {</div>
<div class="line"><span class="lineno"> 1519</span>            Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> = 0.0;</div>
<div class="line"><span class="lineno"> 1520</span>            <span class="keywordtype">bool</span> hasRcMt = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1521</span> </div>
<div class="line"><span class="lineno"> 1522</span>            <span class="comment">// Can just sum across product class</span></div>
<div class="line"><span class="lineno"> 1523</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pc : pcs) {</div>
<div class="line"><span class="lineno"> 1524</span>                <span class="comment">// Skip to next if no results for current product class</span></div>
<div class="line"><span class="lineno"> 1525</span>                <span class="keywordflow">if</span> (!results.has(pc, rc, mt, <span class="stringliteral">&quot;All&quot;</span>))</div>
<div class="line"><span class="lineno"> 1526</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1527</span>                <span class="comment">// If we get to here, we have the current risk class &amp; margin type</span></div>
<div class="line"><span class="lineno"> 1528</span>                <span class="keywordflow">if</span> (!hasRcMt)</div>
<div class="line"><span class="lineno"> 1529</span>                    hasRcMt = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1530</span> </div>
<div class="line"><span class="lineno"> 1531</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += results.get(pc, rc, mt, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1532</span>            }</div>
<div class="line"><span class="lineno"> 1533</span> </div>
<div class="line"><span class="lineno"> 1534</span>            <span class="comment">// Add the margin to the results if it was calculated</span></div>
<div class="line"><span class="lineno"> 1535</span>            <span class="keywordflow">if</span> (hasRcMt) {</div>
<div class="line"><span class="lineno"> 1536</span>                <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, ProductClass::All, rc, mt, <span class="stringliteral">&quot;All&quot;</span>, <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>, side);</div>
<div class="line"><span class="lineno"> 1537</span>            }</div>
<div class="line"><span class="lineno"> 1538</span>        }</div>
<div class="line"><span class="lineno"> 1539</span>    }</div>
<div class="line"><span class="lineno"> 1540</span> </div>
<div class="line"><span class="lineno"> 1541</span>    <span class="comment">// Across product class and margin type for each risk class</span></div>
<div class="line"><span class="lineno"> 1542</span>    <span class="comment">// Have already computed MarginType::All results above so just need</span></div>
<div class="line"><span class="lineno"> 1543</span>    <span class="comment">// to sum over product class for each risk class here</span></div>
<div class="line"><span class="lineno"> 1544</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; rc : rcs) {</div>
<div class="line"><span class="lineno"> 1545</span>        Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> = 0.0;</div>
<div class="line"><span class="lineno"> 1546</span>        <span class="keywordtype">bool</span> hasRc = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1547</span> </div>
<div class="line"><span class="lineno"> 1548</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pc : pcs) {</div>
<div class="line"><span class="lineno"> 1549</span>            <span class="comment">// Skip to next if no results for current product class</span></div>
<div class="line"><span class="lineno"> 1550</span>            <span class="keywordflow">if</span> (!results.has(pc, rc, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>))</div>
<div class="line"><span class="lineno"> 1551</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1552</span>            <span class="comment">// If we get to here, we have the current risk class</span></div>
<div class="line"><span class="lineno"> 1553</span>            <span class="keywordflow">if</span> (!hasRc)</div>
<div class="line"><span class="lineno"> 1554</span>                hasRc = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1555</span> </div>
<div class="line"><span class="lineno"> 1556</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += results.get(pc, rc, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1557</span>        }</div>
<div class="line"><span class="lineno"> 1558</span> </div>
<div class="line"><span class="lineno"> 1559</span>        <span class="comment">// Add the margin to the results if it was calculated</span></div>
<div class="line"><span class="lineno"> 1560</span>        <span class="keywordflow">if</span> (hasRc) {</div>
<div class="line"><span class="lineno"> 1561</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, ProductClass::All, rc, MarginType::All, <span class="stringliteral">&quot;All&quot;</span>, <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>, side);</div>
<div class="line"><span class="lineno"> 1562</span>        }</div>
<div class="line"><span class="lineno"> 1563</span>    }</div>
<div class="line"><span class="lineno"> 1564</span> </div>
<div class="line"><span class="lineno"> 1565</span>    <span class="comment">// Across product class and risk class for each margin type</span></div>
<div class="line"><span class="lineno"> 1566</span>    <span class="comment">// Have already computed RiskClass::All results above so just need</span></div>
<div class="line"><span class="lineno"> 1567</span>    <span class="comment">// to sum over product class for each margin type here</span></div>
<div class="line"><span class="lineno"> 1568</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; mt : mts) {</div>
<div class="line"><span class="lineno"> 1569</span>        Real <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> = 0.0;</div>
<div class="line"><span class="lineno"> 1570</span>        <span class="keywordtype">bool</span> hasMt = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1571</span> </div>
<div class="line"><span class="lineno"> 1572</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pc : pcs) {</div>
<div class="line"><span class="lineno"> 1573</span>            <span class="comment">// Skip to next if no results for current product class</span></div>
<div class="line"><span class="lineno"> 1574</span>            <span class="keywordflow">if</span> (!results.has(pc, RiskClass::All, mt, <span class="stringliteral">&quot;All&quot;</span>))</div>
<div class="line"><span class="lineno"> 1575</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1576</span>            <span class="comment">// If we get to here, we have the current risk class</span></div>
<div class="line"><span class="lineno"> 1577</span>            <span class="keywordflow">if</span> (!hasMt)</div>
<div class="line"><span class="lineno"> 1578</span>                hasMt = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1579</span> </div>
<div class="line"><span class="lineno"> 1580</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a> += results.get(pc, RiskClass::All, mt, <span class="stringliteral">&quot;All&quot;</span>);</div>
<div class="line"><span class="lineno"> 1581</span>        }</div>
<div class="line"><span class="lineno"> 1582</span> </div>
<div class="line"><span class="lineno"> 1583</span>        <span class="comment">// Add the margin to the results if it was calculated</span></div>
<div class="line"><span class="lineno"> 1584</span>        <span class="keywordflow">if</span> (hasMt) {</div>
<div class="line"><span class="lineno"> 1585</span>            <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7">add</a>(nettingSetDetails, regulation, ProductClass::All, RiskClass::All, mt, <span class="stringliteral">&quot;All&quot;</span>, <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f">margin</a>, side);</div>
<div class="line"><span class="lineno"> 1586</span>        }</div>
<div class="line"><span class="lineno"> 1587</span>    }</div>
<div class="line"><span class="lineno"> 1588</span>}</div>
</div><!-- fragment --><div id="dynsection-17" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-17-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-17-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-17-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_cgraph">
<area shape="rect" title=" " alt="" coords="5,43,120,68"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a82003566bd426f075cc443927b2182b7" title=" " alt="" coords="177,5,220,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a28bf3bff3398397c2a09711c5ba1770f" title=" " alt="" coords="168,79,229,104"/>
</map>
</div>
<div id="dynsection-18" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-18-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-18-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-18-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_acdab2245e5344cc15b7c0f2da447a59b_icgraph">
<area shape="rect" title=" " alt="" coords="385,5,500,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#abae54a48ef781027382517a9b0573bcb" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,5,337,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a5492abea466c6543ca7a9a98cc747061" title=" " alt="" coords="5,5,120,31"/>
</map>
</div>

</div>
</div>
<a id="a042350faccc6edc921037241553b2b47" name="a042350faccc6edc921037241553b2b47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a042350faccc6edc921037241553b2b47">&#9670;&#160;</a></span>populateFinalResults() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void populateFinalResults </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Populate final (i.e. winning regulators') using own list of winning regulators, which were determined solely by the SIMM results (i.e. not including any external IMSchedule results) </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l01633">1633</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1633</span>                                          {</div>
<div class="line"><span class="lineno"> 1634</span>    <a class="code hl_function" href="classore_1_1analytics_1_1_simm_calculator.html#a042350faccc6edc921037241553b2b47">populateFinalResults</a>(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a4b33acd9c41c58660a2f82e5f43963c4">winningRegulations_</a>);</div>
<div class="line"><span class="lineno"> 1635</span>}</div>
</div><!-- fragment --><div id="dynsection-19" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-19-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-19-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-19-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_cgraph">
<area shape="rect" title=" " alt="" coords="5,29,148,55"/>
</map>
</div>
<div id="dynsection-20" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-20-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-20-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-20-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a042350faccc6edc921037241553b2b47_icgraph">
<area shape="rect" title=" " alt="" coords="168,29,311,55"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a5492abea466c6543ca7a9a98cc747061" title=" " alt="" coords="5,29,120,55"/>
</map>
</div>

</div>
</div>
<a id="a82003566bd426f075cc443927b2182b7" name="a82003566bd426f075cc443927b2182b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82003566bd426f075cc443927b2182b7">&#9670;&#160;</a></span>add() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void add </td>
          <td>(</td>
          <td class="paramtype">const ore::data::NettingSetDetails &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>regulation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#aac3c9ca896a60df32236fdc4ef53bdc9">SimmConfiguration::ProductClass</a> &amp;&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#add3dc62b3016ee40b1164ca8ac1f15b4">SimmConfiguration::RiskClass</a> &amp;&#160;</td>
          <td class="paramname"><em>rc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a6a26f2b024f96bf0f329f403a135acea">SimmConfiguration::MarginType</a> &amp;&#160;</td>
          <td class="paramname"><em>mt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Real&#160;</td>
          <td class="paramname"><em>margin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>overwrite</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Add a margin result to either call or post results container depending on the <code>side</code> parameter.</p>
<dl class="section remark"><dt>Remarks</dt><dd>all additions to the results containers should happen in this method </dd></dl>
<div id="dynsection-21" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-21-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-21-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-21-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a82003566bd426f075cc443927b2182b7_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a82003566bd426f075cc443927b2182b7_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a82003566bd426f075cc443927b2182b7_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a82003566bd426f075cc443927b2182b7_icgraph">
<area shape="rect" title=" " alt="" coords="548,56,591,81"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a4ebc63fe274dc9049972ebd3bc5af82f" title="Calculate the additional initial margin for the portfolio ID and regulation." alt="" coords="389,5,497,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#abae54a48ef781027382517a9b0573bcb" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,56,337,81"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#acdab2245e5344cc15b7c0f2da447a59b" title=" " alt="" coords="385,107,500,132"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a5492abea466c6543ca7a9a98cc747061" title=" " alt="" coords="5,56,120,81"/>
</map>
</div>

</div>
</div>
<a id="ad65d7673455fe8dbd2774818bbc6a3b4" name="ad65d7673455fe8dbd2774818bbc6a3b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad65d7673455fe8dbd2774818bbc6a3b4">&#9670;&#160;</a></span>add() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void add </td>
          <td>(</td>
          <td class="paramtype">const ore::data::NettingSetDetails &amp;&#160;</td>
          <td class="paramname"><em>nettingSetDetails</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>regulation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#aac3c9ca896a60df32236fdc4ef53bdc9">SimmConfiguration::ProductClass</a> &amp;&#160;</td>
          <td class="paramname"><em>pc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#add3dc62b3016ee40b1164ca8ac1f15b4">SimmConfiguration::RiskClass</a> &amp;&#160;</td>
          <td class="paramname"><em>rc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a6a26f2b024f96bf0f329f403a135acea">SimmConfiguration::MarginType</a> &amp;&#160;</td>
          <td class="paramname"><em>mt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, QuantLib::Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>margins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>overwrite</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a5f5038214f94409386a43dcbd802813c" name="a5f5038214f94409386a43dcbd802813c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f5038214f94409386a43dcbd802813c">&#9670;&#160;</a></span>addCrifRecord()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void addCrifRecord </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structore_1_1analytics_1_1_crif_record.html">CrifRecord</a> &amp;&#160;</td>
          <td class="paramname"><em>crifRecord</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>enforceIMRegulations</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Add CRIF record to the CRIF records container that correspondsd to the given regulation/s and portfolio ID. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l01657">1657</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1658</span>                                                                    {</div>
<div class="line"><span class="lineno"> 1659</span> </div>
<div class="line"><span class="lineno"> 1660</span>    <span class="keyword">const</span> NettingSetDetails&amp; nettingSetDetails = crifRecord.nettingSetDetails;</div>
<div class="line"><span class="lineno"> 1661</span> </div>
<div class="line"><span class="lineno"> 1662</span>    <span class="keywordtype">string</span> regsString;</div>
<div class="line"><span class="lineno"> 1663</span>    <span class="keywordflow">if</span> (enforceIMRegulations)</div>
<div class="line"><span class="lineno"> 1664</span>        regsString = side == SimmSide::Call ? crifRecord.collectRegulations : crifRecord.postRegulations;</div>
<div class="line"><span class="lineno"> 1665</span>    set&lt;string&gt; regs = <a class="code hl_function" href="namespaceore_1_1analytics.html#a35d86bbe3c6d9f5c3de91441c206506e">parseRegulationString</a>(regsString);</div>
<div class="line"><span class="lineno"> 1666</span> </div>
<div class="line"><span class="lineno"> 1667</span>    <span class="keyword">auto</span> newCrifRecord = crifRecord;</div>
<div class="line"><span class="lineno"> 1668</span>    newCrifRecord.collectRegulations.clear();</div>
<div class="line"><span class="lineno"> 1669</span>    newCrifRecord.postRegulations.clear();</div>
<div class="line"><span class="lineno"> 1670</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">string</span>&amp; r : regs)</div>
<div class="line"><span class="lineno"> 1671</span>        <span class="keywordflow">if</span> (r != <span class="stringliteral">&quot;Excluded&quot;</span>) {</div>
<div class="line"><span class="lineno"> 1672</span>            <span class="comment">// Keep a record of trade IDs for each regulation</span></div>
<div class="line"><span class="lineno"> 1673</span>            <span class="keywordflow">if</span> (!newCrifRecord.isSimmParameter())</div>
<div class="line"><span class="lineno"> 1674</span>                <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#ad8588960e070f807177fb86c539c02bc">tradeIds_</a>[side][nettingSetDetails][r].insert(newCrifRecord.tradeId);</div>
<div class="line"><span class="lineno"> 1675</span> </div>
<div class="line"><span class="lineno"> 1676</span>            <span class="comment">// Add CRIF record to the appropriate regulations</span></div>
<div class="line"><span class="lineno"> 1677</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a241d3f226b3000f03e324623fb3ac520">regSensitivities_</a>[side][nettingSetDetails][r] == <span class="keyword">nullptr</span>)</div>
<div class="line"><span class="lineno"> 1678</span>                <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a241d3f226b3000f03e324623fb3ac520">regSensitivities_</a>[side][nettingSetDetails][r] = boost::make_shared&lt;CrifLoader&gt;(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a90a8aa9a543924db944fe86246cd9231">simmConfiguration_</a>, <a class="code hl_variable" href="structore_1_1analytics_1_1_crif_record.html#ac266bc2fffdf618caa4d8c37beb4629e">CrifRecord::additionalHeaders</a>, <span class="keyword">true</span>, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1679</span> </div>
<div class="line"><span class="lineno"> 1680</span>            <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a241d3f226b3000f03e324623fb3ac520">regSensitivities_</a>[side][nettingSetDetails][r]-&gt;add(newCrifRecord);</div>
<div class="line"><span class="lineno"> 1681</span>        }</div>
<div class="line"><span class="lineno"> 1682</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simm_calculator_html_ad8588960e070f807177fb86c539c02bc"><div class="ttname"><a href="classore_1_1analytics_1_1_simm_calculator.html#ad8588960e070f807177fb86c539c02bc">ore::analytics::SimmCalculator::tradeIds_</a></div><div class="ttdeci">std::map&lt; SimmSide, std::map&lt; ore::data::NettingSetDetails, std::map&lt; std::string, set&lt; string &gt; &gt; &gt; &gt; tradeIds_</div><div class="ttdoc">Container for keeping track of what trade IDs belong to each regulation.</div><div class="ttdef"><b>Definition:</b> <a href="simmcalculator_8hpp_source.html#l00142">simmcalculator.hpp:142</a></div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a35d86bbe3c6d9f5c3de91441c206506e"><div class="ttname"><a href="namespaceore_1_1analytics.html#a35d86bbe3c6d9f5c3de91441c206506e">ore::analytics::parseRegulationString</a></div><div class="ttdeci">set&lt; string &gt; parseRegulationString(const string &amp;regsString, const set&lt; string &gt; &amp;valueIfEmpty)</div><div class="ttdoc">Reads a string containing regulations applicable for a given CRIF record.</div><div class="ttdef"><b>Definition:</b> <a href="simmconfiguration_8cpp_source.html#l00499">simmconfiguration.cpp:499</a></div></div>
<div class="ttc" id="astructore_1_1analytics_1_1_crif_record_html_ac266bc2fffdf618caa4d8c37beb4629e"><div class="ttname"><a href="structore_1_1analytics_1_1_crif_record.html#ac266bc2fffdf618caa4d8c37beb4629e">ore::analytics::CrifRecord::additionalHeaders</a></div><div class="ttdeci">static std::map&lt; QuantLib::Size, std::set&lt; std::string &gt; &gt; additionalHeaders</div><div class="ttdef"><b>Definition:</b> <a href="crifrecord_8hpp_source.html#l00145">crifrecord.hpp:145</a></div></div>
</div><!-- fragment --><div id="dynsection-22" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-22-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-22-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-22-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a5f5038214f94409386a43dcbd802813c_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a5f5038214f94409386a43dcbd802813c_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a5f5038214f94409386a43dcbd802813c_cgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a5f5038214f94409386a43dcbd802813c_cgraph">
<area shape="rect" title="Add CRIF record to the CRIF records container that correspondsd to the given regulation/s and portfol..." alt="" coords="5,13,108,38"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a35d86bbe3c6d9f5c3de91441c206506e" title="Reads a string containing regulations applicable for a given CRIF record." alt="" coords="156,5,357,45"/>
</map>
</div>
<div id="dynsection-23" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-23-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-23-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-23-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a5f5038214f94409386a43dcbd802813c_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a5f5038214f94409386a43dcbd802813c_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a5f5038214f94409386a43dcbd802813c_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a5f5038214f94409386a43dcbd802813c_icgraph">
<area shape="rect" title="Add CRIF record to the CRIF records container that correspondsd to the given regulation/s and portfol..." alt="" coords="168,5,271,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a5492abea466c6543ca7a9a98cc747061" title=" " alt="" coords="5,5,120,31"/>
</map>
</div>

</div>
</div>
<a id="a3fc9a75842580e08b25fca334bdeb9d5" name="a3fc9a75842580e08b25fca334bdeb9d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fc9a75842580e08b25fca334bdeb9d5">&#9670;&#160;</a></span>lambda()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Real lambda </td>
          <td>(</td>
          <td class="paramtype">QuantLib::Real&#160;</td>
          <td class="paramname"><em>theta</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Give the \(\lambda\) used in the curvature margin calculation. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l01684">1684</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1684</span>                                            {</div>
<div class="line"><span class="lineno"> 1685</span>    <span class="comment">// Use boost inverse normal here as opposed to QL. Using QL inverse normal</span></div>
<div class="line"><span class="lineno"> 1686</span>    <span class="comment">// will cause the ISDA SIMM unit tests to fail</span></div>
<div class="line"><span class="lineno"> 1687</span>    <span class="keyword">static</span> Real q = boost::math::quantile(boost::math::normal(), 0.995);</div>
<div class="line"><span class="lineno"> 1688</span> </div>
<div class="line"><span class="lineno"> 1689</span>    <span class="keywordflow">return</span> (q * q - 1.0) * (1.0 + theta) - theta;</div>
<div class="line"><span class="lineno"> 1690</span>}</div>
</div><!-- fragment --><div id="dynsection-24" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-24-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-24-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-24-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a3fc9a75842580e08b25fca334bdeb9d5_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a3fc9a75842580e08b25fca334bdeb9d5_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a3fc9a75842580e08b25fca334bdeb9d5_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a3fc9a75842580e08b25fca334bdeb9d5_icgraph">
<area shape="rect" title="Give the &#160;used in the curvature margin calculation." alt="" coords="717,55,781,80"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#ab44b983595e1e6c3a0776a474c7313e7" title=" " alt="" coords="556,29,669,55"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a6cc5da0fd2177b68717c733484631787" title="Calculate the Interest Rate curvature margin component for the given portfolio and product class." alt="" coords="385,80,508,105"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#abae54a48ef781027382517a9b0573bcb" title="Calculates SIMM for a given regulation under a given netting set." alt="" coords="168,55,337,80"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a5492abea466c6543ca7a9a98cc747061" title=" " alt="" coords="5,55,120,80"/>
</map>
</div>

</div>
</div>
<a id="a9510513007fdd3344eef216776cad63a" name="a9510513007fdd3344eef216776cad63a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9510513007fdd3344eef216776cad63a">&#9670;&#160;</a></span>convert()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void convert </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Convert all results to the calculation currency. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8cpp_source.html#l01692">1692</a> of file <a class="el" href="simmcalculator_8cpp_source.html">simmcalculator.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1692</span>                             {</div>
<div class="line"><span class="lineno"> 1693</span>    <span class="comment">// If calculation currency is USD, nothing to do.</span></div>
<div class="line"><span class="lineno"> 1694</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a> == <span class="stringliteral">&quot;USD&quot;</span>)</div>
<div class="line"><span class="lineno"> 1695</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1696</span> </div>
<div class="line"><span class="lineno"> 1697</span>    QL_REQUIRE(<a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a231130240241304481b20503059a9864">market_</a>, <span class="stringliteral">&quot;market not set&quot;</span>);</div>
<div class="line"><span class="lineno"> 1698</span>    QuantLib::Handle&lt;QuantLib::Quote&gt; fxQuote = <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a231130240241304481b20503059a9864">market_</a>-&gt;fxRate(<span class="stringliteral">&quot;USD&quot;</span> + <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a>);</div>
<div class="line"><span class="lineno"> 1699</span>    QL_REQUIRE(!fxQuote.empty(), <span class="stringliteral">&quot;market FX/USD/&quot;</span> &lt;&lt; <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a> &lt;&lt; <span class="stringliteral">&quot; rate not found&quot;</span>);</div>
<div class="line"><span class="lineno"> 1700</span>    <span class="keyword">const</span> Real fxSpot = fxQuote-&gt;value();</div>
<div class="line"><span class="lineno"> 1701</span> </div>
<div class="line"><span class="lineno"> 1702</span>    QL_REQUIRE(fxSpot &gt; 0, <span class="stringliteral">&quot;SIMM Calculator: The USD spot rate must be positive&quot;</span>);</div>
<div class="line"><span class="lineno"> 1703</span> </div>
<div class="line"><span class="lineno"> 1704</span>    <span class="comment">// Loop over all results and divide by the spot rate (i.e. convert from USD to SIMM calculation currency)</span></div>
<div class="line"><span class="lineno"> 1705</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; side : <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#a66ce6144aef4f726c92ef4ddaf4afe64">simmResults_</a>) {</div>
<div class="line"><span class="lineno"> 1706</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; okv : side.second) {</div>
<div class="line"><span class="lineno"> 1707</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; reg : okv.second) {</div>
<div class="line"><span class="lineno"> 1708</span>                reg.second.convert(fxSpot, <a class="code hl_variable" href="classore_1_1analytics_1_1_simm_calculator.html#aed547488155ddce90f75d9ade15d0764">resultCcy_</a>);</div>
<div class="line"><span class="lineno"> 1709</span>            }</div>
<div class="line"><span class="lineno"> 1710</span>        }</div>
<div class="line"><span class="lineno"> 1711</span>    }</div>
<div class="line"><span class="lineno"> 1712</span>}</div>
</div><!-- fragment --><div id="dynsection-25" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-25-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-25-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-25-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_simm_calculator_a9510513007fdd3344eef216776cad63a_icgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_simm_calculator_a9510513007fdd3344eef216776cad63a_icgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_simm_calculator_a9510513007fdd3344eef216776cad63a_icgraph" id="aclassore_1_1analytics_1_1_simm_calculator_a9510513007fdd3344eef216776cad63a_icgraph">
<area shape="rect" title="Convert all results to the calculation currency." alt="" coords="168,5,231,31"/>
<area shape="rect" href="classore_1_1analytics_1_1_simm_calculator.html#a5492abea466c6543ca7a9a98cc747061" title=" " alt="" coords="5,5,120,31"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="afb00980c461e4d2601bb4b5f7e95bc6f" name="afb00980c461e4d2601bb4b5f7e95bc6f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb00980c461e4d2601bb4b5f7e95bc6f">&#9670;&#160;</a></span>simmNetSensitivities_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespaceore_1_1analytics.html#a9d8a3ff6040fc0182ac0f12d94f1a213">SimmNetSensitivities</a> simmNetSensitivities_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>All the net sensitivities passed in for the calculation. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00104">104</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="a241d3f226b3000f03e324623fb3ac520" name="a241d3f226b3000f03e324623fb3ac520"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a241d3f226b3000f03e324623fb3ac520">&#9670;&#160;</a></span>regSensitivities_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt;ore::data::NettingSetDetails, std::map&lt;std::string, boost::shared_ptr&lt;<a class="el" href="classore_1_1analytics_1_1_crif_loader.html">CrifLoader</a>&gt; &gt; &gt; &gt; regSensitivities_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Net sentivities at the regulation level within each netting set. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00107">107</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="a90a8aa9a543924db944fe86246cd9231" name="a90a8aa9a543924db944fe86246cd9231"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90a8aa9a543924db944fe86246cd9231">&#9670;&#160;</a></span>simmConfiguration_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html">SimmConfiguration</a>&gt; simmConfiguration_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The SIMM configuration governing the calculation. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00110">110</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="abb36b19e887d4397b44b9e9d0ec34f52" name="abb36b19e887d4397b44b9e9d0ec34f52"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb36b19e887d4397b44b9e9d0ec34f52">&#9670;&#160;</a></span>calculationCcy_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string calculationCcy_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The SIMM exposure calculation currency i.e. the currency for which FX delta risk is ignored. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00113">113</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="aed547488155ddce90f75d9ade15d0764" name="aed547488155ddce90f75d9ade15d0764"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed547488155ddce90f75d9ade15d0764">&#9670;&#160;</a></span>resultCcy_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string resultCcy_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The SIMM result currency i.e. the currency in which the main SIMM results are denominated. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00116">116</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="a231130240241304481b20503059a9864" name="a231130240241304481b20503059a9864"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a231130240241304481b20503059a9864">&#9670;&#160;</a></span>market_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt;ore::data::Market&gt; market_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Market data for FX rates to use for converting amounts to USD. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00119">119</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="aa2fedb3c02ffb092a6c19a0ee1e81a02" name="aa2fedb3c02ffb092a6c19a0ee1e81a02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2fedb3c02ffb092a6c19a0ee1e81a02">&#9670;&#160;</a></span>quiet_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool quiet_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If true, no logging is written out. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00122">122</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="a4b33acd9c41c58660a2f82e5f43963c4" name="a4b33acd9c41c58660a2f82e5f43963c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b33acd9c41c58660a2f82e5f43963c4">&#9670;&#160;</a></span>winningRegulations_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt;ore::data::NettingSetDetails, std::string&gt; &gt; winningRegulations_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Regulation with highest initial margin for each given netting set. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00126">126</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="a66ce6144aef4f726c92ef4ddaf4afe64" name="a66ce6144aef4f726c92ef4ddaf4afe64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66ce6144aef4f726c92ef4ddaf4afe64">&#9670;&#160;</a></span>simmResults_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt;ore::data::NettingSetDetails, std::map&lt;std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a>&gt; &gt; &gt; simmResults_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Containers, one for call and post, with a map containing a <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> object for each regulation under each portfolio ID </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00132">132</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="aa86bb7338b370ccfabfd1b6d218a5fb8" name="aa86bb7338b370ccfabfd1b6d218a5fb8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa86bb7338b370ccfabfd1b6d218a5fb8">&#9670;&#160;</a></span>finalSimmResults_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt;ore::data::NettingSetDetails, std::pair&lt;std::string, <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a>&gt; &gt; &gt; finalSimmResults_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Containers, one for call and post, with a <a class="el" href="classore_1_1analytics_1_1_simm_results.html">SimmResults</a> object for each portfolio ID, and each margin amount is that of the winning regulation applicable to the portfolio ID </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00138">138</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="ad8588960e070f807177fb86c539c02bc" name="ad8588960e070f807177fb86c539c02bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8588960e070f807177fb86c539c02bc">&#9670;&#160;</a></span>tradeIds_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, std::map&lt;ore::data::NettingSetDetails, std::map&lt;std::string, set&lt;string&gt; &gt; &gt; &gt; tradeIds_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Container for keeping track of what trade IDs belong to each regulation. </p>

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00142">142</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
<a id="acf6d3f08c36da850265818577b6c5111" name="acf6d3f08c36da850265818577b6c5111"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf6d3f08c36da850265818577b6c5111">&#9670;&#160;</a></span>finalTradeIds_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="classore_1_1analytics_1_1_simm_configuration.html#a7350b34aa36058291464dad7368190f1">SimmSide</a>, set&lt;string&gt; &gt; finalTradeIds_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="simmcalculator_8hpp_source.html#l00144">144</a> of file <a class="el" href="simmcalculator_8hpp_source.html">simmcalculator.hpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.9.5
</small></address>
</body>
</html>
