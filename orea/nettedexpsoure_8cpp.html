<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<title>OREAnalytics: test/nettedexpsoure.cpp File Reference</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="oreaextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-analytics@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.10</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_13e138d54eb8818da29c3992edef070a.html">test</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">nettedexpsoure.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;boost/test/unit_test.hpp&gt;</code><br />
<code>#include &lt;boost/timer/timer.hpp&gt;</code><br />
<code>#include &lt;<a class="el" href="inmemorycube_8hpp_source.html">orea/cube/inmemorycube.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="npvcube_8hpp_source.html">orea/cube/npvcube.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="valuationcalculator_8hpp_source.html">orea/engine/valuationcalculator.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="valuationengine_8hpp_source.html">orea/engine/valuationengine.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="crossassetmodelscenariogenerator_8hpp_source.html">orea/scenario/crossassetmodelscenariogenerator.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="scenariosimmarket_8hpp_source.html">orea/scenario/scenariosimmarket.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="scenariosimmarketparameters_8hpp_source.html">orea/scenario/scenariosimmarketparameters.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="simplescenariofactory_8hpp_source.html">orea/scenario/simplescenariofactory.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../ored/crossassetmodelbuilder_8hpp.html">ored/model/crossassetmodelbuilder.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../ored/lgmdata_8hpp.html">ored/model/lgmdata.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../ored/irlgmdata_8hpp.html">ored/model/irlgmdata.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../ored/builders_2swap_8hpp.html">ored/portfolio/builders/swap.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../ored/portfolio_8hpp.html">ored/portfolio/portfolio.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../ored/swap_8hpp.html">ored/portfolio/swap.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../ored/log_8hpp.html">ored/utilities/log.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../ored/osutils_8hpp.html">ored/utilities/osutils.hpp</a>&gt;</code><br />
<code>#include &lt;oret/toplevelfixture.hpp&gt;</code><br />
<code>#include &lt;ql/math/randomnumbers/mt19937uniformrng.hpp&gt;</code><br />
<code>#include &lt;ql/time/calendars/target.hpp&gt;</code><br />
<code>#include &lt;ql/time/date.hpp&gt;</code><br />
<code>#include &lt;ql/time/daycounters/actualactual.hpp&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../qle/multipathgeneratorbase_8hpp.html">qle/methods/multipathgeneratorbase.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="oreatoplevelfixture_8hpp_source.html">test/oreatoplevelfixture.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="testmarket_8hpp_source.html">test/testmarket.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="exposurecalculator_8hpp_source.html">orea/aggregation/exposurecalculator.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="nettedexposurecalculator_8hpp_source.html">orea/aggregation/nettedexposurecalculator.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="dimcalculator_8hpp_source.html">orea/aggregation/dimcalculator.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="dimregressioncalculator_8hpp_source.html">orea/aggregation/dimregressioncalculator.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="scenariogeneratordata_8hpp_source.html">orea/scenario/scenariogeneratordata.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="aggregationscenariodata_8hpp_source.html">orea/scenario/aggregationscenariodata.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../ored/nettingsetdetails_8hpp.html">ored/portfolio/nettingsetdetails.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../ored/nettingsetdefinition_8hpp.html">ored/portfolio/nettingsetdefinition.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../ored/nettingsetmanager_8hpp.html">ored/portfolio/nettingsetmanager.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="cube__io_8hpp_source.html">orea/cube/cube_io.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="mporcalculator_8hpp_source.html">orea/engine/mporcalculator.hpp</a>&gt;</code><br />
<code>#include &lt;ql/utilities/dataparsers.hpp&gt;</code><br />
<code>#include &lt;cmath&gt;</code><br />
</div>
<p><a href="nettedexpsoure_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aed3546fd4a2f63cd4ed2c7e190dc3116"><td class="memItemLeft" align="right" valign="top">boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_conventions.html">data::Conventions</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nettedexpsoure_8cpp.html#aed3546fd4a2f63cd4ed2c7e190dc3116">convs</a> ()</td></tr>
<tr class="separator:aed3546fd4a2f63cd4ed2c7e190dc3116"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb2ded909a682440a6743629968650da"><td class="memItemLeft" align="right" valign="top">boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_portfolio.html">Portfolio</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nettedexpsoure_8cpp.html#adb2ded909a682440a6743629968650da">buildPortfolio</a> (Size portfolioSize, boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_engine_factory.html">EngineFactory</a> &gt; &amp;factory)</td></tr>
<tr class="separator:adb2ded909a682440a6743629968650da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a950ed0e1f15a4a6db32cd3321e2020ab"><td class="memItemLeft" align="right" valign="top">boost::shared_ptr&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_cross_asset_model.html">CrossAssetModel</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nettedexpsoure_8cpp.html#a950ed0e1f15a4a6db32cd3321e2020ab">buildCrossAssetModel</a> (boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_market.html">Market</a> &gt; &amp;initMarket)</td></tr>
<tr class="separator:a950ed0e1f15a4a6db32cd3321e2020ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29768d15c2e22d0758b1a19b27de0163"><td class="memItemLeft" align="right" valign="top">boost::shared_ptr&lt; <a class="el" href="classore_1_1analytics_1_1_scenario_sim_market.html">analytics::ScenarioSimMarket</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nettedexpsoure_8cpp.html#a29768d15c2e22d0758b1a19b27de0163">buildScenarioSimMarket</a> (boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_date_grid.html">DateGrid</a> &gt; dateGrid, boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_market.html">Market</a> &gt; &amp;initMarket, boost::shared_ptr&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_cross_asset_model.html">CrossAssetModel</a> &gt; &amp;model, Size samples=1, Size seed=5, <a class="el" href="classbool.html">bool</a> antithetic=false)</td></tr>
<tr class="separator:a29768d15c2e22d0758b1a19b27de0163"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44745c9b080fbfd731fa9b6b431779bd"><td class="memItemLeft" align="right" valign="top">boost::shared_ptr&lt; <a class="el" href="classore_1_1analytics_1_1_n_p_v_cube.html">NPVCube</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nettedexpsoure_8cpp.html#a44745c9b080fbfd731fa9b6b431779bd">buildNPVCube</a> (boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_date_grid.html">DateGrid</a> &gt; dateGrid, <a class="el" href="classbool.html">bool</a> withCloseOutGrid, boost::shared_ptr&lt; <a class="el" href="classore_1_1analytics_1_1_scenario_sim_market.html">analytics::ScenarioSimMarket</a> &gt; &amp;simMarket, boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_portfolio.html">Portfolio</a> &gt; &amp;portfolio, <a class="el" href="classbool.html">bool</a> mporStickyDate=false, Size samples=1, Size seed=5)</td></tr>
<tr class="separator:a44745c9b080fbfd731fa9b6b431779bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73c6b5990ccfc4cf44c8bf4da9a1f3ee"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nettedexpsoure_8cpp.html#a73c6b5990ccfc4cf44c8bf4da9a1f3ee">BOOST_AUTO_TEST_CASE</a> (NettedExposureCalculatorTest)</td></tr>
<tr class="separator:a73c6b5990ccfc4cf44c8bf4da9a1f3ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="aed3546fd4a2f63cd4ed2c7e190dc3116" name="aed3546fd4a2f63cd4ed2c7e190dc3116"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed3546fd4a2f63cd4ed2c7e190dc3116">&#9670;&#160;</a></span>convs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_conventions.html">data::Conventions</a> &gt; convs </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nettedexpsoure_8cpp_source.html#l00076">76</a> of file <a class="el" href="nettedexpsoure_8cpp_source.html">nettedexpsoure.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   76</span>                                         {</div>
<div class="line"><span class="lineno">   77</span>    boost::shared_ptr&lt;data::Conventions&gt; conventions(<span class="keyword">new</span> <a class="code hl_classRef" href="../ored/classore_1_1data_1_1_conventions.html">data::Conventions</a>());</div>
<div class="line"><span class="lineno">   78</span> </div>
<div class="line"><span class="lineno">   79</span>    boost::shared_ptr&lt;data::Convention&gt; swapIndexConv(</div>
<div class="line"><span class="lineno">   80</span>        <span class="keyword">new</span> <a class="code hl_classRef" href="../ored/classore_1_1data_1_1_swap_index_convention.html">data::SwapIndexConvention</a>(<span class="stringliteral">&quot;EUR-CMS-2Y&quot;</span>, <span class="stringliteral">&quot;EUR-6M-SWAP-CONVENTIONS&quot;</span>));</div>
<div class="line"><span class="lineno">   81</span>    conventions-&gt;add(swapIndexConv);</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>    boost::shared_ptr&lt;data::Convention&gt; swapConv(</div>
<div class="line"><span class="lineno">   84</span>        <span class="keyword">new</span> <a class="code hl_classRef" href="../ored/classore_1_1data_1_1_i_r_swap_convention.html">data::IRSwapConvention</a>(<span class="stringliteral">&quot;EUR-6M-SWAP-CONVENTIONS&quot;</span>, <span class="stringliteral">&quot;TARGET&quot;</span>, <span class="stringliteral">&quot;Annual&quot;</span>, <span class="stringliteral">&quot;MF&quot;</span>, <span class="stringliteral">&quot;30/360&quot;</span>, <span class="stringliteral">&quot;EUR-EURIBOR-6M&quot;</span>));</div>
<div class="line"><span class="lineno">   85</span>    conventions-&gt;add(swapConv);</div>
<div class="line"><span class="lineno">   86</span> </div>
<div class="line"><span class="lineno">   87</span>    InstrumentConventions::instance().setConventions(conventions);</div>
<div class="line"><span class="lineno">   88</span> </div>
<div class="line"><span class="lineno">   89</span>    <span class="keywordflow">return</span> conventions;</div>
<div class="line"><span class="lineno">   90</span>}</div>
<div class="ttc" id="aclassore_1_1data_1_1_conventions_html"><div class="ttname"><a href="../ored/classore_1_1data_1_1_conventions.html">ore::data::Conventions</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_i_r_swap_convention_html"><div class="ttname"><a href="../ored/classore_1_1data_1_1_i_r_swap_convention.html">ore::data::IRSwapConvention</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_swap_index_convention_html"><div class="ttname"><a href="../ored/classore_1_1data_1_1_swap_index_convention.html">ore::data::SwapIndexConvention</a></div></div>
</div><!-- fragment --><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="nettedexpsoure_8cpp_aed3546fd4a2f63cd4ed2c7e190dc3116_icgraph.png" border="0" usemap="#anettedexpsoure_8cpp_aed3546fd4a2f63cd4ed2c7e190dc3116_icgraph" alt=""/></div>
<map name="anettedexpsoure_8cpp_aed3546fd4a2f63cd4ed2c7e190dc3116_icgraph" id="anettedexpsoure_8cpp_aed3546fd4a2f63cd4ed2c7e190dc3116_icgraph">
<area shape="rect" title=" " alt="" coords="483,55,537,80"/>
<area shape="rect" href="test_2scenariosimmarket_8cpp.html#a98bc741bd338099794406193106db40b" title=" " alt="" coords="244,5,435,31"/>
<area shape="rect" href="nettedexpsoure_8cpp.html#a29768d15c2e22d0758b1a19b27de0163" title=" " alt="" coords="258,55,421,80"/>
<area shape="rect" href="simulationmeasures_8cpp.html#a2d28d9482c88b6bc30b9c883d3002303" title=" " alt="" coords="289,104,390,129"/>
<area shape="rect" href="simulationmeasures_8cpp.html#a56d91767dde8f498911de589448c2306" title=" " alt="" coords="5,104,196,129"/>
</map>
</div>

</div>
</div>
<a id="adb2ded909a682440a6743629968650da" name="adb2ded909a682440a6743629968650da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb2ded909a682440a6743629968650da">&#9670;&#160;</a></span>buildPortfolio()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_portfolio.html">Portfolio</a> &gt; buildPortfolio </td>
          <td>(</td>
          <td class="paramtype">Size&#160;</td>
          <td class="paramname"><em>portfolioSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_engine_factory.html">EngineFactory</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>factory</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nettedexpsoure_8cpp_source.html#l00092">92</a> of file <a class="el" href="nettedexpsoure_8cpp_source.html">nettedexpsoure.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   92</span>                                                                                                       {</div>
<div class="line"><span class="lineno">   93</span> </div>
<div class="line"><span class="lineno">   94</span>    boost::shared_ptr&lt;Portfolio&gt; portfolio(<span class="keyword">new</span> <a class="code hl_classRef" href="../ored/classore_1_1data_1_1_portfolio.html">Portfolio</a>());</div>
<div class="line"><span class="lineno">   95</span> </div>
<div class="line"><span class="lineno">   96</span>    vector&lt;string&gt; ccys = {<span class="stringliteral">&quot;EUR&quot;</span>};</div>
<div class="line"><span class="lineno">   97</span> </div>
<div class="line"><span class="lineno">   98</span>    map&lt;string, vector&lt;string&gt;&gt; indices = {{<span class="stringliteral">&quot;EUR&quot;</span>, {<span class="stringliteral">&quot;EUR-EURIBOR-6M&quot;</span>}}};</div>
<div class="line"><span class="lineno">   99</span> </div>
<div class="line"><span class="lineno">  100</span>    vector&lt;string&gt; fixedTenors = {<span class="stringliteral">&quot;1Y&quot;</span>};</div>
<div class="line"><span class="lineno">  101</span> </div>
<div class="line"><span class="lineno">  102</span>    Size seed = 5; <span class="comment">// keep this constant to ensure portfolio doesn&#39;t change</span></div>
<div class="line"><span class="lineno">  103</span>    MersenneTwisterUniformRng rng(seed);</div>
<div class="line"><span class="lineno">  104</span> </div>
<div class="line"><span class="lineno">  105</span>    Date today = Settings::instance().evaluationDate();</div>
<div class="line"><span class="lineno">  106</span> </div>
<div class="line"><span class="lineno">  107</span>    Calendar cal = TARGET();</div>
<div class="line"><span class="lineno">  108</span>    <span class="keywordtype">string</span> calStr = <span class="stringliteral">&quot;TARGET&quot;</span>;</div>
<div class="line"><span class="lineno">  109</span>    <span class="keywordtype">string</span> conv = <span class="stringliteral">&quot;MF&quot;</span>;</div>
<div class="line"><span class="lineno">  110</span>    <span class="keywordtype">string</span> rule = <span class="stringliteral">&quot;Forward&quot;</span>;</div>
<div class="line"><span class="lineno">  111</span>    Size days = 2;</div>
<div class="line"><span class="lineno">  112</span>    <span class="keywordtype">string</span> fixDC = <span class="stringliteral">&quot;30/360&quot;</span>;</div>
<div class="line"><span class="lineno">  113</span>    <span class="keywordtype">string</span> floatDC = <span class="stringliteral">&quot;ACT/365&quot;</span>;</div>
<div class="line"><span class="lineno">  114</span> </div>
<div class="line"><span class="lineno">  115</span>    vector&lt;double&gt; notional(1, 1000000);</div>
<div class="line"><span class="lineno">  116</span>    vector&lt;double&gt; spread(1, 0);</div>
<div class="line"><span class="lineno">  117</span> </div>
<div class="line"><span class="lineno">  118</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; portfolioSize; i++) {</div>
<div class="line"><span class="lineno">  119</span>        Size term = 1;</div>
<div class="line"><span class="lineno">  120</span>        <span class="comment">// Start today +/- 1 Year</span></div>
<div class="line"><span class="lineno">  121</span>        Date startDate = cal.adjust(today);</div>
<div class="line"><span class="lineno">  122</span>        Date endDate = cal.adjust(startDate + term * Years);</div>
<div class="line"><span class="lineno">  123</span> </div>
<div class="line"><span class="lineno">  124</span>        <span class="comment">// date 2 string</span></div>
<div class="line"><span class="lineno">  125</span>        ostringstream oss;</div>
<div class="line"><span class="lineno">  126</span>        oss &lt;&lt; io::iso_date(startDate);</div>
<div class="line"><span class="lineno">  127</span>        <span class="keywordtype">string</span> start(oss.str());</div>
<div class="line"><span class="lineno">  128</span>        oss.str(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  129</span>        oss.clear();</div>
<div class="line"><span class="lineno">  130</span>        oss &lt;&lt; io::iso_date(endDate);</div>
<div class="line"><span class="lineno">  131</span>        <span class="keywordtype">string</span> end(oss.str());</div>
<div class="line"><span class="lineno">  132</span> </div>
<div class="line"><span class="lineno">  133</span>        <span class="comment">// ccy + index</span></div>
<div class="line"><span class="lineno">  134</span>        <span class="keywordtype">string</span> ccy = <span class="stringliteral">&quot;EUR&quot;</span>;</div>
<div class="line"><span class="lineno">  135</span>        <span class="keywordtype">string</span> index = <span class="stringliteral">&quot;EUR-EURIBOR-6M&quot;</span>;</div>
<div class="line"><span class="lineno">  136</span>        <span class="keywordtype">string</span> floatFreq =  <span class="stringliteral">&quot;6M&quot;</span>;</div>
<div class="line"><span class="lineno">  137</span> </div>
<div class="line"><span class="lineno">  138</span>        <span class="comment">// This variable is not used and only here to ensure that the random numbers generated in</span></div>
<div class="line"><span class="lineno">  139</span>        <span class="comment">// subsequent blocks produce a swap portfolio, which is compatible with the archived values.</span></div>
<div class="line"><span class="lineno">  140</span>        <span class="keywordtype">string</span> fixedTenor = <span class="stringliteral">&quot;1Y&quot;</span>;</div>
<div class="line"><span class="lineno">  141</span>        fixedTenor = fixedTenor + <span class="stringliteral">&quot;_&quot;</span>;</div>
<div class="line"><span class="lineno">  142</span> </div>
<div class="line"><span class="lineno">  143</span>        <span class="comment">// fixed details</span></div>
<div class="line"><span class="lineno">  144</span>        Real fixedRate =  0.02 ;</div>
<div class="line"><span class="lineno">  145</span>        <span class="keywordtype">string</span> fixFreq = <span class="stringliteral">&quot;1Y&quot;</span>;</div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>        <span class="comment">// envelope</span></div>
<div class="line"><span class="lineno">  148</span>        <a class="code hl_classRef" href="../ored/classore_1_1data_1_1_envelope.html">Envelope</a> env(<span class="stringliteral">&quot;CP&quot;</span>, <span class="stringliteral">&quot;NettingSet1&quot;</span>);</div>
<div class="line"><span class="lineno">  149</span> </div>
<div class="line"><span class="lineno">  150</span>        <span class="comment">// Schedules</span></div>
<div class="line"><span class="lineno">  151</span>        <a class="code hl_classRef" href="../ored/classore_1_1data_1_1_schedule_data.html">ScheduleData</a> floatSchedule(<a class="code hl_classRef" href="../ored/classore_1_1data_1_1_schedule_rules.html">ScheduleRules</a>(start, end, floatFreq, calStr, conv, conv, rule));</div>
<div class="line"><span class="lineno">  152</span>        <a class="code hl_classRef" href="../ored/classore_1_1data_1_1_schedule_data.html">ScheduleData</a> fixedSchedule(<a class="code hl_classRef" href="../ored/classore_1_1data_1_1_schedule_rules.html">ScheduleRules</a>(start, end, fixFreq, calStr, conv, conv, rule));</div>
<div class="line"><span class="lineno">  153</span> </div>
<div class="line"><span class="lineno">  154</span>        <span class="keywordtype">bool</span> isPayer = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  155</span> </div>
<div class="line"><span class="lineno">  156</span>        <span class="comment">// fixed Leg - with dummy rate</span></div>
<div class="line"><span class="lineno">  157</span>        <a class="code hl_classRef" href="../ored/classore_1_1data_1_1_leg_data.html">LegData</a> fixedLeg(boost::make_shared&lt;FixedLegData&gt;(vector&lt;double&gt;(1, fixedRate)), isPayer, ccy, fixedSchedule,</div>
<div class="line"><span class="lineno">  158</span>                         fixDC, notional);</div>
<div class="line"><span class="lineno">  159</span> </div>
<div class="line"><span class="lineno">  160</span>        <span class="comment">// float Leg</span></div>
<div class="line"><span class="lineno">  161</span>        vector&lt;double&gt; spreads(1, 0);</div>
<div class="line"><span class="lineno">  162</span>        <a class="code hl_classRef" href="../ored/classore_1_1data_1_1_leg_data.html">LegData</a> floatingLeg(boost::make_shared&lt;FloatingLegData&gt;(index, days, <span class="keyword">false</span>, spread), !isPayer, ccy,</div>
<div class="line"><span class="lineno">  163</span>                            floatSchedule, floatDC, notional);</div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>        boost::shared_ptr&lt;Trade&gt; swap(<span class="keyword">new</span> <a class="code hl_classRef" href="../ored/classore_1_1data_1_1_swap.html">data::Swap</a>(env, floatingLeg, fixedLeg));</div>
<div class="line"><span class="lineno">  166</span> </div>
<div class="line"><span class="lineno">  167</span>        <span class="comment">// id</span></div>
<div class="line"><span class="lineno">  168</span>        oss.clear();</div>
<div class="line"><span class="lineno">  169</span>        oss.str(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  170</span>        oss &lt;&lt; <span class="stringliteral">&quot;Trade_&quot;</span> &lt;&lt; i + 1;</div>
<div class="line"><span class="lineno">  171</span>        swap-&gt;id() = oss.str();</div>
<div class="line"><span class="lineno">  172</span> </div>
<div class="line"><span class="lineno">  173</span>        portfolio-&gt;add(swap);</div>
<div class="line"><span class="lineno">  174</span>    }</div>
<div class="line"><span class="lineno">  175</span>    <span class="comment">// portfolio-&gt;save(&quot;port.xml&quot;);</span></div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>    portfolio-&gt;build(factory);</div>
<div class="line"><span class="lineno">  178</span> </div>
<div class="line"><span class="lineno">  179</span>    <span class="keywordflow">if</span> (portfolio-&gt;size() != portfolioSize)</div>
<div class="line"><span class="lineno">  180</span>        BOOST_ERROR(<span class="stringliteral">&quot;Failed to build portfolio (got &quot;</span> &lt;&lt; portfolio-&gt;size() &lt;&lt; <span class="stringliteral">&quot; expected &quot;</span> &lt;&lt; portfolioSize &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>    <span class="comment">// Dump stats about portfolio</span></div>
<div class="line"><span class="lineno">  183</span>    Time <a class="code hl_variableRef" href="../ored/utilities_8cpp.html#a13d7d92e74b3e8c94c52ca7a1262c55e">maturity</a> = 0;</div>
<div class="line"><span class="lineno">  184</span>    DayCounter dc = ActualActual(ActualActual::ISDA);</div>
<div class="line"><span class="lineno">  185</span>    map&lt;string, Size&gt; fixedFreqs;</div>
<div class="line"><span class="lineno">  186</span>    map&lt;string, Size&gt; floatFreqs;</div>
<div class="line"><span class="lineno">  187</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; [tradeId, trade] : portfolio-&gt;trades()) {</div>
<div class="line"><span class="lineno">  188</span>        <a class="code hl_variableRef" href="../ored/utilities_8cpp.html#a13d7d92e74b3e8c94c52ca7a1262c55e">maturity</a> += dc.yearFraction(today, trade-&gt;maturity());</div>
<div class="line"><span class="lineno">  189</span> </div>
<div class="line"><span class="lineno">  190</span>        <span class="comment">// fixed Freq</span></div>
<div class="line"><span class="lineno">  191</span>        boost::shared_ptr&lt;data::Swap&gt; swap = boost::dynamic_pointer_cast&lt;data::Swap&gt;(trade);</div>
<div class="line"><span class="lineno">  192</span>        <span class="keywordtype">string</span> floatFreq = swap-&gt;legData()[0].schedule().rules().front().tenor();</div>
<div class="line"><span class="lineno">  193</span>        <span class="keywordtype">string</span> fixFreq = swap-&gt;legData()[1].schedule().rules().front().tenor();</div>
<div class="line"><span class="lineno">  194</span>        QL_REQUIRE(swap-&gt;legData()[0].legType() == <span class="stringliteral">&quot;Floating&quot;</span> &amp;&amp; swap-&gt;legData()[1].legType() == <span class="stringliteral">&quot;Fixed&quot;</span>, <span class="stringliteral">&quot;Leg mixup&quot;</span>);</div>
<div class="line"><span class="lineno">  195</span>        <span class="keywordflow">if</span> (fixedFreqs.find(fixFreq) == fixedFreqs.end())</div>
<div class="line"><span class="lineno">  196</span>            fixedFreqs[fixFreq] = 1;</div>
<div class="line"><span class="lineno">  197</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  198</span>            fixedFreqs[fixFreq]++;</div>
<div class="line"><span class="lineno">  199</span>        <span class="keywordflow">if</span> (floatFreqs.find(floatFreq) == floatFreqs.end())</div>
<div class="line"><span class="lineno">  200</span>            floatFreqs[floatFreq] = 1;</div>
<div class="line"><span class="lineno">  201</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  202</span>            floatFreqs[floatFreq]++;</div>
<div class="line"><span class="lineno">  203</span>    }</div>
<div class="line"><span class="lineno">  204</span>    <a class="code hl_variableRef" href="../ored/utilities_8cpp.html#a13d7d92e74b3e8c94c52ca7a1262c55e">maturity</a> /= portfolioSize;</div>
<div class="line"><span class="lineno">  205</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Portfolio Size    : &quot;</span> &lt;&lt; portfolioSize);</div>
<div class="line"><span class="lineno">  206</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Maturity  : &quot;</span> &lt;&lt; maturity);</div>
<div class="line"><span class="lineno">  207</span>    ostringstream oss;</div>
<div class="line"><span class="lineno">  208</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; ccys.size(); i++)</div>
<div class="line"><span class="lineno">  209</span>        oss &lt;&lt; ccys[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><span class="lineno">  210</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Currencies        : &quot;</span> &lt;&lt; oss.str());</div>
<div class="line"><span class="lineno">  211</span>    <span class="comment">// dump % breakdown of tenors</span></div>
<div class="line"><span class="lineno">  212</span>    map&lt;string, Size&gt;::iterator it;</div>
<div class="line"><span class="lineno">  213</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Fixed Tenors      : &quot;</span>&lt;&lt; fixedFreqs.begin()-&gt;first);</div>
<div class="line"><span class="lineno">  214</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Floating Tenors   : &quot;</span>&lt;&lt; floatFreqs.begin()-&gt;first);</div>
<div class="line"><span class="lineno">  215</span>    <span class="keywordflow">return</span> portfolio;</div>
<div class="line"><span class="lineno">  216</span>}</div>
<div class="ttc" id="aclassore_1_1data_1_1_envelope_html"><div class="ttname"><a href="../ored/classore_1_1data_1_1_envelope.html">ore::data::Envelope</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_leg_data_html"><div class="ttname"><a href="../ored/classore_1_1data_1_1_leg_data.html">ore::data::LegData</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_portfolio_html"><div class="ttname"><a href="../ored/classore_1_1data_1_1_portfolio.html">ore::data::Portfolio</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_schedule_data_html"><div class="ttname"><a href="../ored/classore_1_1data_1_1_schedule_data.html">ore::data::ScheduleData</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_schedule_rules_html"><div class="ttname"><a href="../ored/classore_1_1data_1_1_schedule_rules.html">ore::data::ScheduleRules</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_swap_html"><div class="ttname"><a href="../ored/classore_1_1data_1_1_swap.html">ore::data::Swap</a></div></div>
<div class="ttc" id="autilities_8cpp_html_a13d7d92e74b3e8c94c52ca7a1262c55e"><div class="ttname"><a href="../ored/utilities_8cpp.html#a13d7d92e74b3e8c94c52ca7a1262c55e">maturity</a></div><div class="ttdeci">Time maturity</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a950ed0e1f15a4a6db32cd3321e2020ab" name="a950ed0e1f15a4a6db32cd3321e2020ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a950ed0e1f15a4a6db32cd3321e2020ab">&#9670;&#160;</a></span>buildCrossAssetModel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_cross_asset_model.html">CrossAssetModel</a> &gt; buildCrossAssetModel </td>
          <td>(</td>
          <td class="paramtype">boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_market.html">Market</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>initMarket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nettedexpsoure_8cpp_source.html#l00218">218</a> of file <a class="el" href="nettedexpsoure_8cpp_source.html">nettedexpsoure.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  218</span>                                                                                          {</div>
<div class="line"><span class="lineno">  219</span>    <span class="comment">// Config</span></div>
<div class="line"><span class="lineno">  220</span>    <span class="comment">// Build IR configurations</span></div>
<div class="line"><span class="lineno">  221</span>    <a class="code hl_enumerationRef" href="../ored/namespaceore_1_1data.html#a18340f2f2342933b54b1dc8e6c0ed797">CalibrationType</a> calibrationType = CalibrationType::Bootstrap;</div>
<div class="line"><span class="lineno">  222</span>    <a class="code hl_enumerationRef" href="../ored/classore_1_1data_1_1_lgm_data.html#a85128cf8fffb22eea15b6db0929ffb43">LgmData::ReversionType</a> revType = LgmData::ReversionType::HullWhite;</div>
<div class="line"><span class="lineno">  223</span>    <a class="code hl_enumerationRef" href="../ored/classore_1_1data_1_1_lgm_data.html#a8b2aa10016abb1ffb6f55484a04a5143">LgmData::VolatilityType</a> volType = LgmData::VolatilityType::Hagan;</div>
<div class="line"><span class="lineno">  224</span>    vector&lt;string&gt; swaptionExpiries = {<span class="stringliteral">&quot;1Y&quot;</span>, <span class="stringliteral">&quot;2Y&quot;</span>, <span class="stringliteral">&quot;3Y&quot;</span>, <span class="stringliteral">&quot;5Y&quot;</span>, <span class="stringliteral">&quot;7Y&quot;</span>, <span class="stringliteral">&quot;10Y&quot;</span>, <span class="stringliteral">&quot;15Y&quot;</span>, <span class="stringliteral">&quot;20Y&quot;</span>, <span class="stringliteral">&quot;30Y&quot;</span>};</div>
<div class="line"><span class="lineno">  225</span>    vector&lt;string&gt; swaptionTerms = {<span class="stringliteral">&quot;5Y&quot;</span>, <span class="stringliteral">&quot;5Y&quot;</span>, <span class="stringliteral">&quot;5Y&quot;</span>, <span class="stringliteral">&quot;5Y&quot;</span>, <span class="stringliteral">&quot;5Y&quot;</span>, <span class="stringliteral">&quot;5Y&quot;</span>, <span class="stringliteral">&quot;5Y&quot;</span>, <span class="stringliteral">&quot;5Y&quot;</span>, <span class="stringliteral">&quot;5Y&quot;</span>};</div>
<div class="line"><span class="lineno">  226</span>    vector&lt;string&gt; swaptionStrikes(swaptionExpiries.size(), <span class="stringliteral">&quot;ATM&quot;</span>);</div>
<div class="line"><span class="lineno">  227</span>    vector&lt;Time&gt; hTimes = {};</div>
<div class="line"><span class="lineno">  228</span>    vector&lt;Time&gt; aTimes = {};</div>
<div class="line"><span class="lineno">  229</span> </div>
<div class="line"><span class="lineno">  230</span>    std::vector&lt;boost::shared_ptr&lt;IrModelData&gt;&gt; irConfigs;</div>
<div class="line"><span class="lineno">  231</span> </div>
<div class="line"><span class="lineno">  232</span>    vector&lt;Real&gt; hValues = {0.02};</div>
<div class="line"><span class="lineno">  233</span>    vector&lt;Real&gt; aValues = {0.008};</div>
<div class="line"><span class="lineno">  234</span>    irConfigs.push_back(boost::make_shared&lt;IrLgmData&gt;(</div>
<div class="line"><span class="lineno">  235</span>        <span class="stringliteral">&quot;EUR&quot;</span>, calibrationType, revType, volType, <span class="keyword">false</span>, ParamType::Constant, hTimes, hValues, <span class="keyword">true</span>,</div>
<div class="line"><span class="lineno">  236</span>        ParamType::Piecewise, aTimes, aValues, 0.0, 1.0, swaptionExpiries, swaptionTerms, swaptionStrikes));</div>
<div class="line"><span class="lineno">  237</span> </div>
<div class="line"><span class="lineno">  238</span>    hValues = {0.03};</div>
<div class="line"><span class="lineno">  239</span>    aValues = {0.009};</div>
<div class="line"><span class="lineno">  240</span>    irConfigs.push_back(boost::make_shared&lt;IrLgmData&gt;(</div>
<div class="line"><span class="lineno">  241</span>        <span class="stringliteral">&quot;USD&quot;</span>, calibrationType, revType, volType, <span class="keyword">false</span>, ParamType::Constant, hTimes, hValues, <span class="keyword">true</span>,</div>
<div class="line"><span class="lineno">  242</span>        ParamType::Piecewise, aTimes, aValues, 0.0, 1.0, swaptionExpiries, swaptionTerms, swaptionStrikes));</div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span> </div>
<div class="line"><span class="lineno">  245</span>    <span class="comment">// Compile FX configurations</span></div>
<div class="line"><span class="lineno">  246</span>    vector&lt;string&gt; optionExpiries = {<span class="stringliteral">&quot;1Y&quot;</span>, <span class="stringliteral">&quot;2Y&quot;</span>, <span class="stringliteral">&quot;3Y&quot;</span>, <span class="stringliteral">&quot;5Y&quot;</span>, <span class="stringliteral">&quot;7Y&quot;</span>, <span class="stringliteral">&quot;10Y&quot;</span>};</div>
<div class="line"><span class="lineno">  247</span>    vector&lt;string&gt; optionStrikes(optionExpiries.size(), <span class="stringliteral">&quot;ATMF&quot;</span>);</div>
<div class="line"><span class="lineno">  248</span>    vector&lt;Time&gt; sigmaTimes = {};</div>
<div class="line"><span class="lineno">  249</span> </div>
<div class="line"><span class="lineno">  250</span>    std::vector&lt;boost::shared_ptr&lt;FxBsData&gt;&gt; fxConfigs;</div>
<div class="line"><span class="lineno">  251</span> </div>
<div class="line"><span class="lineno">  252</span>    vector&lt;Real&gt; sigmaValues = {0.15};</div>
<div class="line"><span class="lineno">  253</span>    fxConfigs.push_back(boost::make_shared&lt;FxBsData&gt;(<span class="stringliteral">&quot;USD&quot;</span>, <span class="stringliteral">&quot;EUR&quot;</span>, calibrationType, <span class="keyword">true</span>, ParamType::Piecewise,</div>
<div class="line"><span class="lineno">  254</span>                                                     sigmaTimes, sigmaValues, optionExpiries, optionStrikes));</div>
<div class="line"><span class="lineno">  255</span> </div>
<div class="line"><span class="lineno">  256</span>    map&lt;CorrelationKey, Handle&lt;Quote&gt;&gt; corr;</div>
<div class="line"><span class="lineno">  257</span>    <a class="code hl_structRef" href="../ored/structore_1_1data_1_1_correlation_factor.html">CorrelationFactor</a> f_1{ CrossAssetModel::AssetType::IR, <span class="stringliteral">&quot;EUR&quot;</span>, 0 };</div>
<div class="line"><span class="lineno">  258</span>    <a class="code hl_structRef" href="../ored/structore_1_1data_1_1_correlation_factor.html">CorrelationFactor</a> f_2{ CrossAssetModel::AssetType::IR, <span class="stringliteral">&quot;USD&quot;</span>, 0 };</div>
<div class="line"><span class="lineno">  259</span>    corr[make_pair(f_1, f_2)] = Handle&lt;Quote&gt;(boost::make_shared&lt;SimpleQuote&gt;(0.6));</div>
<div class="line"><span class="lineno">  260</span> </div>
<div class="line"><span class="lineno">  261</span>    boost::shared_ptr&lt;CrossAssetModelData&gt; config(boost::make_shared&lt;CrossAssetModelData&gt;(irConfigs, fxConfigs, corr));</div>
<div class="line"><span class="lineno">  262</span> </div>
<div class="line"><span class="lineno">  263</span>    <span class="comment">// Model Builder &amp; Model</span></div>
<div class="line"><span class="lineno">  264</span>    <span class="comment">// model builder</span></div>
<div class="line"><span class="lineno">  265</span>    boost::shared_ptr&lt;CrossAssetModelBuilder&gt; modelBuilder(<span class="keyword">new</span> <a class="code hl_classRef" href="../ored/classore_1_1data_1_1_cross_asset_model_builder.html">CrossAssetModelBuilder</a>(initMarket, config));</div>
<div class="line"><span class="lineno">  266</span>    <span class="keywordflow">return</span> *modelBuilder-&gt;model();</div>
<div class="line"><span class="lineno">  267</span> </div>
<div class="line"><span class="lineno">  268</span>}</div>
<div class="ttc" id="aclassore_1_1data_1_1_cross_asset_model_builder_html"><div class="ttname"><a href="../ored/classore_1_1data_1_1_cross_asset_model_builder.html">ore::data::CrossAssetModelBuilder</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_lgm_data_html_a85128cf8fffb22eea15b6db0929ffb43"><div class="ttname"><a href="../ored/classore_1_1data_1_1_lgm_data.html#a85128cf8fffb22eea15b6db0929ffb43">ore::data::LgmData::ReversionType</a></div><div class="ttdeci">ReversionType</div></div>
<div class="ttc" id="aclassore_1_1data_1_1_lgm_data_html_a8b2aa10016abb1ffb6f55484a04a5143"><div class="ttname"><a href="../ored/classore_1_1data_1_1_lgm_data.html#a8b2aa10016abb1ffb6f55484a04a5143">ore::data::LgmData::VolatilityType</a></div><div class="ttdeci">VolatilityType</div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a18340f2f2342933b54b1dc8e6c0ed797"><div class="ttname"><a href="../ored/namespaceore_1_1data.html#a18340f2f2342933b54b1dc8e6c0ed797">CalibrationType</a></div><div class="ttdeci">CalibrationType</div></div>
<div class="ttc" id="astructore_1_1data_1_1_correlation_factor_html"><div class="ttname"><a href="../ored/structore_1_1data_1_1_correlation_factor.html">ore::data::CorrelationFactor</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a29768d15c2e22d0758b1a19b27de0163" name="a29768d15c2e22d0758b1a19b27de0163"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29768d15c2e22d0758b1a19b27de0163">&#9670;&#160;</a></span>buildScenarioSimMarket()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt; <a class="el" href="classore_1_1analytics_1_1_scenario_sim_market.html">analytics::ScenarioSimMarket</a> &gt; buildScenarioSimMarket </td>
          <td>(</td>
          <td class="paramtype">boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_date_grid.html">DateGrid</a> &gt;&#160;</td>
          <td class="paramname"><em>dateGrid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_market.html">Market</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>initMarket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boost::shared_ptr&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_cross_asset_model.html">CrossAssetModel</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Size&#160;</td>
          <td class="paramname"><em>samples</em> = <code>1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Size&#160;</td>
          <td class="paramname"><em>seed</em> = <code>5</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>antithetic</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nettedexpsoure_8cpp_source.html#l00270">270</a> of file <a class="el" href="nettedexpsoure_8cpp_source.html">nettedexpsoure.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  275</span>                                                                                             {</div>
<div class="line"><span class="lineno">  276</span>    <span class="comment">// build scenario sim market parameters</span></div>
<div class="line"><span class="lineno">  277</span>    Date today = initMarket-&gt;asofDate();</div>
<div class="line"><span class="lineno">  278</span> </div>
<div class="line"><span class="lineno">  279</span>    <span class="keywordtype">string</span> baseCcy = <span class="stringliteral">&quot;EUR&quot;</span>;</div>
<div class="line"><span class="lineno">  280</span>    vector&lt;string&gt; ccys;</div>
<div class="line"><span class="lineno">  281</span>    ccys.push_back(baseCcy);</div>
<div class="line"><span class="lineno">  282</span>    ccys.push_back(<span class="stringliteral">&quot;USD&quot;</span>);</div>
<div class="line"><span class="lineno">  283</span> </div>
<div class="line"><span class="lineno">  284</span>    boost::shared_ptr&lt;analytics::ScenarioSimMarketParameters&gt; parameters(<span class="keyword">new</span> <a class="code hl_class" href="classore_1_1analytics_1_1_scenario_sim_market_parameters.html">analytics::ScenarioSimMarketParameters</a>());</div>
<div class="line"><span class="lineno">  285</span>    parameters-&gt;baseCcy() = baseCcy;</div>
<div class="line"><span class="lineno">  286</span>    parameters-&gt;setDiscountCurveNames(ccys);</div>
<div class="line"><span class="lineno">  287</span>    parameters-&gt;setYieldCurveTenors(<span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">  288</span>                                    {1 * Months, 6 * Months, 1 * Years, 2 * Years, 5 * Years, 10 * Years, 20 * Years});</div>
<div class="line"><span class="lineno">  289</span>    parameters-&gt;setIndices({<span class="stringliteral">&quot;EUR-EONIA&quot;</span>, <span class="stringliteral">&quot;EUR-EURIBOR-6M&quot;</span>, <span class="stringliteral">&quot;USD-LIBOR-3M&quot;</span>});</div>
<div class="line"><span class="lineno">  290</span> </div>
<div class="line"><span class="lineno">  291</span>    parameters-&gt;interpolation() = <span class="stringliteral">&quot;LogLinear&quot;</span>;</div>
<div class="line"><span class="lineno">  292</span> </div>
<div class="line"><span class="lineno">  293</span>    parameters-&gt;setSimulateSwapVols(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  294</span>    parameters-&gt;setSwapVolTerms(<span class="stringliteral">&quot;&quot;</span>, {6 * Months, 1 * Years});</div>
<div class="line"><span class="lineno">  295</span>    parameters-&gt;setSwapVolExpiries(<span class="stringliteral">&quot;&quot;</span>, {1 * Years, 2 * Years});</div>
<div class="line"><span class="lineno">  296</span>    parameters-&gt;swapVolKeys() = ccys;</div>
<div class="line"><span class="lineno">  297</span>    parameters-&gt;swapVolDecayMode() = <span class="stringliteral">&quot;ForwardVariance&quot;</span>;</div>
<div class="line"><span class="lineno">  298</span> </div>
<div class="line"><span class="lineno">  299</span>    parameters-&gt;setFxVolExpiries(<span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">  300</span>        vector&lt;Period&gt;{1 * Months, 3 * Months, 6 * Months, 2 * Years, 3 * Years, 4 * Years, 5 * Years});</div>
<div class="line"><span class="lineno">  301</span>    parameters-&gt;setFxVolDecayMode(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;ConstantVariance&quot;</span>));</div>
<div class="line"><span class="lineno">  302</span>    parameters-&gt;setSimulateFXVols(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  303</span> </div>
<div class="line"><span class="lineno">  304</span>    parameters-&gt;setFxVolCcyPairs({<span class="stringliteral">&quot;USDEUR&quot;</span>});</div>
<div class="line"><span class="lineno">  305</span>    parameters-&gt;setFxCcyPairs({<span class="stringliteral">&quot;USDEUR&quot;</span>});</div>
<div class="line"><span class="lineno">  306</span> </div>
<div class="line"><span class="lineno">  307</span>    parameters-&gt;setAdditionalScenarioDataIndices({<span class="stringliteral">&quot;EUR-EONIA&quot;</span>});</div>
<div class="line"><span class="lineno">  308</span>    parameters-&gt;setAdditionalScenarioDataCcys({<span class="stringliteral">&quot;EUR&quot;</span>});</div>
<div class="line"><span class="lineno">  309</span> </div>
<div class="line"><span class="lineno">  310</span>    <span class="comment">// Path generator</span></div>
<div class="line"><span class="lineno">  311</span>    boost::shared_ptr&lt;QuantExt::MultiPathGeneratorBase&gt; pathGen =</div>
<div class="line"><span class="lineno">  312</span>        boost::make_shared&lt;MultiPathGeneratorMersenneTwister&gt;(model-&gt;stateProcess(), dateGrid-&gt;timeGrid(), seed, antithetic);</div>
<div class="line"><span class="lineno">  313</span> </div>
<div class="line"><span class="lineno">  314</span>    <span class="comment">// build scenario generator</span></div>
<div class="line"><span class="lineno">  315</span>    boost::shared_ptr&lt;ScenarioFactory&gt; scenarioFactory(<span class="keyword">new</span> <a class="code hl_class" href="classore_1_1analytics_1_1_simple_scenario_factory.html">SimpleScenarioFactory</a>);</div>
<div class="line"><span class="lineno">  316</span>    boost::shared_ptr&lt;ScenarioGenerator&gt; scenarioGenerator = boost::make_shared&lt;CrossAssetModelScenarioGenerator&gt;(model, </div>
<div class="line"><span class="lineno">  317</span>                                                                                                                  pathGen, </div>
<div class="line"><span class="lineno">  318</span>                                                                                                                  scenarioFactory, </div>
<div class="line"><span class="lineno">  319</span>                                                                                                                  parameters, </div>
<div class="line"><span class="lineno">  320</span>                                                                                                                  today, </div>
<div class="line"><span class="lineno">  321</span>                                                                                                                  dateGrid, </div>
<div class="line"><span class="lineno">  322</span>                                                                                                                  initMarket);</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span>    <span class="comment">// build scenario sim market</span></div>
<div class="line"><span class="lineno">  325</span>    <a class="code hl_function" href="nettedexpsoure_8cpp.html#aed3546fd4a2f63cd4ed2c7e190dc3116">convs</a>();</div>
<div class="line"><span class="lineno">  326</span>    <span class="keyword">auto</span> simMarket = boost::make_shared&lt;analytics::ScenarioSimMarket&gt;(initMarket, parameters);</div>
<div class="line"><span class="lineno">  327</span>    simMarket-&gt;scenarioGenerator() = scenarioGenerator;</div>
<div class="line"><span class="lineno">  328</span> </div>
<div class="line"><span class="lineno">  329</span>    boost::shared_ptr&lt;AggregationScenarioData&gt; scenarioData = boost::make_shared&lt;InMemoryAggregationScenarioData&gt;(dateGrid-&gt;timeGrid().size(), samples);</div>
<div class="line"><span class="lineno">  330</span>    simMarket-&gt;aggregationScenarioData() = scenarioData;</div>
<div class="line"><span class="lineno">  331</span>    </div>
<div class="line"><span class="lineno">  332</span>    <span class="keywordflow">return</span> simMarket;</div>
<div class="line"><span class="lineno">  333</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_scenario_sim_market_parameters_html"><div class="ttname"><a href="classore_1_1analytics_1_1_scenario_sim_market_parameters.html">ore::analytics::ScenarioSimMarketParameters</a></div><div class="ttdoc">ScenarioSimMarket description.</div><div class="ttdef"><b>Definition:</b> <a href="scenariosimmarketparameters_8hpp_source.html#l00047">scenariosimmarketparameters.hpp:47</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_simple_scenario_factory_html"><div class="ttname"><a href="classore_1_1analytics_1_1_simple_scenario_factory.html">ore::analytics::SimpleScenarioFactory</a></div><div class="ttdoc">Factory class for building simple scenario objects.</div><div class="ttdef"><b>Definition:</b> <a href="simplescenariofactory_8hpp_source.html#l00036">simplescenariofactory.hpp:36</a></div></div>
<div class="ttc" id="anettedexpsoure_8cpp_html_aed3546fd4a2f63cd4ed2c7e190dc3116"><div class="ttname"><a href="nettedexpsoure_8cpp.html#aed3546fd4a2f63cd4ed2c7e190dc3116">convs</a></div><div class="ttdeci">boost::shared_ptr&lt; data::Conventions &gt; convs()</div><div class="ttdef"><b>Definition:</b> <a href="nettedexpsoure_8cpp_source.html#l00076">nettedexpsoure.cpp:76</a></div></div>
</div><!-- fragment --><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="nettedexpsoure_8cpp_a29768d15c2e22d0758b1a19b27de0163_cgraph.png" border="0" usemap="#anettedexpsoure_8cpp_a29768d15c2e22d0758b1a19b27de0163_cgraph" alt=""/></div>
<map name="anettedexpsoure_8cpp_a29768d15c2e22d0758b1a19b27de0163_cgraph" id="anettedexpsoure_8cpp_a29768d15c2e22d0758b1a19b27de0163_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,168,31"/>
<area shape="rect" href="nettedexpsoure_8cpp.html#aed3546fd4a2f63cd4ed2c7e190dc3116" title=" " alt="" coords="216,5,271,31"/>
</map>
</div>

</div>
</div>
<a id="a44745c9b080fbfd731fa9b6b431779bd" name="a44745c9b080fbfd731fa9b6b431779bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44745c9b080fbfd731fa9b6b431779bd">&#9670;&#160;</a></span>buildNPVCube()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt; <a class="el" href="classore_1_1analytics_1_1_n_p_v_cube.html">NPVCube</a> &gt; buildNPVCube </td>
          <td>(</td>
          <td class="paramtype">boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_date_grid.html">DateGrid</a> &gt;&#160;</td>
          <td class="paramname"><em>dateGrid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>withCloseOutGrid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boost::shared_ptr&lt; <a class="el" href="classore_1_1analytics_1_1_scenario_sim_market.html">analytics::ScenarioSimMarket</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>simMarket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boost::shared_ptr&lt; <a class="elRef" href="../ored/classore_1_1data_1_1_portfolio.html">Portfolio</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>portfolio</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>mporStickyDate</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Size&#160;</td>
          <td class="paramname"><em>samples</em> = <code>1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Size&#160;</td>
          <td class="paramname"><em>seed</em> = <code>5</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nettedexpsoure_8cpp_source.html#l00335">335</a> of file <a class="el" href="nettedexpsoure_8cpp_source.html">nettedexpsoure.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  341</span>                                                    {</div>
<div class="line"><span class="lineno">  342</span> </div>
<div class="line"><span class="lineno">  343</span>    Date today = Settings::instance().evaluationDate();</div>
<div class="line"><span class="lineno">  344</span>    <span class="comment">// Now calculate exposure</span></div>
<div class="line"><span class="lineno">  345</span>    <a class="code hl_class" href="classore_1_1analytics_1_1_valuation_engine.html">ValuationEngine</a> valEngine(today, dateGrid, simMarket);</div>
<div class="line"><span class="lineno">  346</span> </div>
<div class="line"><span class="lineno">  347</span>    Size depth = 1;</div>
<div class="line"><span class="lineno">  348</span>    <span class="keywordflow">if</span> (withCloseOutGrid)</div>
<div class="line"><span class="lineno">  349</span>        depth = 2;</div>
<div class="line"><span class="lineno">  350</span> </div>
<div class="line"><span class="lineno">  351</span>    <span class="comment">// Calculate Cube</span></div>
<div class="line"><span class="lineno">  352</span>    boost::timer::cpu_timer t;</div>
<div class="line"><span class="lineno">  353</span>    <span class="comment">//BOOST_TEST_MESSAGE(&quot;dg-&gt;numDates() &quot; &lt;&lt; dateGrid-&gt;valuationDates().size()&lt;&lt;&quot;, &quot; &lt;&lt;&quot;dg-&gt;dates() &quot;&lt;&lt;dateGrid-&gt;dates().size());</span></div>
<div class="line"><span class="lineno">  354</span>    boost::shared_ptr&lt;NPVCube&gt; cube =</div>
<div class="line"><span class="lineno">  355</span>        boost::make_shared&lt;DoublePrecisionInMemoryCubeN&gt;(today, portfolio-&gt;ids(), dateGrid-&gt;valuationDates(), samples, depth);</div>
<div class="line"><span class="lineno">  356</span> </div>
<div class="line"><span class="lineno">  357</span>    vector&lt;boost::shared_ptr&lt;ValuationCalculator&gt;&gt; calculators;</div>
<div class="line"><span class="lineno">  358</span>    boost::shared_ptr&lt;NPVCalculator&gt; npvCalc = boost::make_shared&lt;NPVCalculator&gt;(<span class="stringliteral">&quot;EUR&quot;</span>);</div>
<div class="line"><span class="lineno">  359</span>    calculators.push_back(npvCalc);</div>
<div class="line"><span class="lineno">  360</span>    <span class="keywordflow">if</span> (withCloseOutGrid)</div>
<div class="line"><span class="lineno">  361</span>        calculators.push_back(boost::make_shared&lt;MPORCalculator&gt;(npvCalc));</div>
<div class="line"><span class="lineno">  362</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;mporStickyDate &quot;</span>&lt;&lt;mporStickyDate);</div>
<div class="line"><span class="lineno">  363</span>    valEngine.buildCube(portfolio, cube, calculators, mporStickyDate);</div>
<div class="line"><span class="lineno">  364</span>    t.stop();</div>
<div class="line"><span class="lineno">  365</span>    <span class="keywordtype">double</span> elapsed = t.elapsed().wall * 1e-9;</div>
<div class="line"><span class="lineno">  366</span>    </div>
<div class="line"><span class="lineno">  367</span>    <span class="keywordflow">if</span> (withCloseOutGrid){</div>
<div class="line"><span class="lineno">  368</span>        std::string fileName = <span class="stringliteral">&quot;scenarioData_closeout.csv&quot;</span>;</div>
<div class="line"><span class="lineno">  369</span>        <a class="code hl_function" href="namespaceore_1_1analytics.html#a9167bb1f2f26d02e86af8bc3a12b6564">saveAggregationScenarioData</a>(fileName, *simMarket-&gt;aggregationScenarioData());</div>
<div class="line"><span class="lineno">  370</span>        fileName = <span class="stringliteral">&quot;cube_closeout.csv&quot;</span>;</div>
<div class="line"><span class="lineno">  371</span>        <a class="code hl_function" href="namespaceore_1_1analytics.html#a5f3ebcdbf3058f80aa6baa1e02669fea">saveCube</a>(fileName, *cube);</div>
<div class="line"><span class="lineno">  372</span>    }<span class="keywordflow">else</span>{</div>
<div class="line"><span class="lineno">  373</span>        std::string fileName = <span class="stringliteral">&quot;scenarioData.csv&quot;</span>;</div>
<div class="line"><span class="lineno">  374</span>        <a class="code hl_function" href="namespaceore_1_1analytics.html#a9167bb1f2f26d02e86af8bc3a12b6564">saveAggregationScenarioData</a>(fileName, *simMarket-&gt;aggregationScenarioData());</div>
<div class="line"><span class="lineno">  375</span>        fileName = <span class="stringliteral">&quot;cube.csv&quot;</span>;</div>
<div class="line"><span class="lineno">  376</span>        <a class="code hl_function" href="namespaceore_1_1analytics.html#a5f3ebcdbf3058f80aa6baa1e02669fea">saveCube</a>(fileName, *cube);</div>
<div class="line"><span class="lineno">  377</span>    }</div>
<div class="line"><span class="lineno">  378</span> </div>
<div class="line"><span class="lineno">  379</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Cube generated in &quot;</span> &lt;&lt; elapsed &lt;&lt; <span class="stringliteral">&quot; seconds&quot;</span>);</div>
<div class="line"><span class="lineno">  380</span>    <span class="keywordflow">return</span> cube;</div>
<div class="line"><span class="lineno">  381</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_valuation_engine_html"><div class="ttname"><a href="classore_1_1analytics_1_1_valuation_engine.html">ore::analytics::ValuationEngine</a></div><div class="ttdoc">Valuation Engine.</div><div class="ttdef"><b>Definition:</b> <a href="valuationengine_8hpp_source.html#l00058">valuationengine.hpp:58</a></div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a5f3ebcdbf3058f80aa6baa1e02669fea"><div class="ttname"><a href="namespaceore_1_1analytics.html#a5f3ebcdbf3058f80aa6baa1e02669fea">ore::analytics::saveCube</a></div><div class="ttdeci">void saveCube(const std::string &amp;filename, const NPVCube &amp;cube, const bool doublePrecision)</div><div class="ttdef"><b>Definition:</b> <a href="cube__io_8cpp_source.html#l00145">cube_io.cpp:145</a></div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a9167bb1f2f26d02e86af8bc3a12b6564"><div class="ttname"><a href="namespaceore_1_1analytics.html#a9167bb1f2f26d02e86af8bc3a12b6564">ore::analytics::saveAggregationScenarioData</a></div><div class="ttdeci">void saveAggregationScenarioData(const std::string &amp;filename, const AggregationScenarioData &amp;cube)</div><div class="ttdef"><b>Definition:</b> <a href="cube__io_8cpp_source.html#l00268">cube_io.cpp:268</a></div></div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="nettedexpsoure_8cpp_a44745c9b080fbfd731fa9b6b431779bd_cgraph.png" border="0" usemap="#anettedexpsoure_8cpp_a44745c9b080fbfd731fa9b6b431779bd_cgraph" alt=""/></div>
<map name="anettedexpsoure_8cpp_a44745c9b080fbfd731fa9b6b431779bd_cgraph" id="anettedexpsoure_8cpp_a44745c9b080fbfd731fa9b6b431779bd_cgraph">
<area shape="rect" title=" " alt="" coords="5,365,112,390"/>
<area shape="rect" href="classore_1_1analytics_1_1_valuation_engine.html#ad24847236b96716fc0b97aaa04c64e94" title="Build NPV cube." alt="" coords="180,133,343,173"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a9167bb1f2f26d02e86af8bc3a12b6564" title=" " alt="" coords="160,357,363,397"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a5f3ebcdbf3058f80aa6baa1e02669fea" title=" " alt="" coords="179,761,343,786"/>
<area shape="rect" href="classore_1_1analytics_1_1_valuation_engine.html#a9cee7dbce995d0e0396b7e5fbba7a181" title=" " alt="" coords="420,5,592,45"/>
<area shape="rect" href="classore_1_1analytics_1_1_valuation_engine.html#a026e0e52de2af3f31255833e1f67aee3" title=" " alt="" coords="425,69,587,109"/>
<area shape="rect" href="classore_1_1analytics_1_1_valuation_engine.html#a4ce5e4309192252c3c97970eb5021175" title=" " alt="" coords="423,133,589,173"/>
<area shape="rect" target="_parent" href="../ored/classore_1_1data_1_1_progress_reporter.html#aa0478bbe90075f6f870926294318bf7e" title=" " alt="" coords="415,197,597,237"/>
<area shape="rect" target="_parent" href="../ored/group__utilities.html#ga1b8cd9a976247da6df232ad48d4af190" title=" " alt="" coords="649,298,780,323"/>
<area shape="rect" href="classore_1_1analytics_1_1_aggregation_scenario_data.html#a319d07b61e92987fe7dea6c1c8404955" title="Return the length of each dimension." alt="" coords="417,261,595,301"/>
<area shape="rect" href="classore_1_1analytics_1_1_aggregation_scenario_data.html#a9c116f9c57b482bff6caa7b796668739" title=" " alt="" coords="416,325,596,365"/>
<area shape="rect" href="classore_1_1analytics_1_1_aggregation_scenario_data.html#a3114d080efc641fb4c9604f0c31a4f07" title="Get a value from the cube." alt="" coords="417,389,595,429"/>
<area shape="rect" href="classore_1_1analytics_1_1_aggregation_scenario_data.html#acc5f7ea2e9ce225df9dca064908a21b8" title=" " alt="" coords="417,453,595,493"/>
<area shape="rect" href="classore_1_1analytics_1_1_n_p_v_cube.html#a557df7b72d5a09b9a44380368f5f2095" title="Return the asof date (T0 date)" alt="" coords="423,568,589,608"/>
<area shape="rect" href="classore_1_1analytics_1_1_n_p_v_cube.html#a78bd2d956976936e8598bf99343ef59a" title="Get the vector of dates for this cube." alt="" coords="423,632,589,672"/>
<area shape="rect" href="classore_1_1analytics_1_1_n_p_v_cube.html#a6839816abbb60a97918c14e7c1540f61" title=" " alt="" coords="423,696,589,736"/>
<area shape="rect" href="classore_1_1analytics_1_1_n_p_v_cube.html#a51d6bc85694efe8a1a00eabef240046a" title="Get a value from the cube using index." alt="" coords="411,761,601,786"/>
<area shape="rect" href="classore_1_1analytics_1_1_n_p_v_cube.html#a0fb72231e788ca8e499b6208e06e8c11" title="Get a T0 value from the cube using index." alt="" coords="423,811,589,851"/>
<area shape="rect" href="classore_1_1analytics_1_1_n_p_v_cube.html#abb8911c32dcb162a540e5f039a950816" title="Get a map of id and their index position in this cube." alt="" coords="423,875,589,915"/>
<area shape="rect" href="classore_1_1analytics_1_1_n_p_v_cube.html#a191f8e9622c21154d2c8a30a7a67bc4a" title=" " alt="" coords="423,939,589,979"/>
<area shape="rect" href="classore_1_1analytics_1_1_n_p_v_cube.html#a66c4451b69de32d15c114e888b96b706" title="Return the length of each dimension." alt="" coords="423,1003,589,1043"/>
<area shape="rect" href="classore_1_1analytics_1_1_n_p_v_cube.html#a28fb4fd0d20b4a197f76d4db1b9d5dd5" title=" " alt="" coords="423,1067,589,1107"/>
</map>
</div>

</div>
</div>
<a id="a73c6b5990ccfc4cf44c8bf4da9a1f3ee" name="a73c6b5990ccfc4cf44c8bf4da9a1f3ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73c6b5990ccfc4cf44c8bf4da9a1f3ee">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">NettedExposureCalculatorTest&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="nettedexpsoure_8cpp_source.html#l00500">500</a> of file <a class="el" href="nettedexpsoure_8cpp_source.html">nettedexpsoure.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  500</span>                                                   {</div>
<div class="line"><span class="lineno">  501</span> </div>
<div class="line"><span class="lineno">  502</span> </div>
<div class="line"><span class="lineno">  503</span> </div>
<div class="line"><span class="lineno">  504</span>    CachedResultsData cachedResults;</div>
<div class="line"><span class="lineno">  505</span>    std::map&lt;tuple&lt;string, string, string, string, string, string&gt;, vector&lt;Date&gt;&gt; cachedDefaultDates = cachedResults.defaultDates;</div>
<div class="line"><span class="lineno">  506</span>    std::map&lt;tuple&lt;string, string, string, string, string, string&gt;, vector&lt;Real&gt;&gt; cachedDefaultValues = cachedResults.defaultValues;</div>
<div class="line"><span class="lineno">  507</span>    std::map&lt;tuple&lt;string, string, string, string, string, string&gt;, vector&lt;Date&gt;&gt; cachedCloseOutDates = cachedResults.closeOutDates;</div>
<div class="line"><span class="lineno">  508</span>    std::map&lt;tuple&lt;string, string, string, string, string, string&gt;, vector&lt;Real&gt;&gt; cachedCloseOutValues = cachedResults.closeOutValues;</div>
<div class="line"><span class="lineno">  509</span>    </div>
<div class="line"><span class="lineno">  510</span> </div>
<div class="line"><span class="lineno">  511</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Running NettedExposureCalculatorTestWithCloseOutGrid...&quot;</span>);</div>
<div class="line"><span class="lineno">  512</span>    Date <a class="code hl_variableRef" href="../ored/utilities_8cpp.html#a24bc06abadc72e51af462e64714c3822">referenceDate</a> = Date(14, April, 2016);</div>
<div class="line"><span class="lineno">  513</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Reference Date is &quot;</span>&lt;&lt;QuantLib::io::iso_date(referenceDate));</div>
<div class="line"><span class="lineno">  514</span>    Settings::instance().evaluationDate() = <a class="code hl_variableRef" href="../ored/utilities_8cpp.html#a24bc06abadc72e51af462e64714c3822">referenceDate</a>;</div>
<div class="line"><span class="lineno">  515</span> </div>
<div class="line"><span class="lineno">  516</span>    <span class="keywordtype">string</span> dateGridStr;</div>
<div class="line"><span class="lineno">  517</span>    boost::shared_ptr&lt;DateGrid&gt; dateGrid;</div>
<div class="line"><span class="lineno">  518</span>    std::string nettingSetMpor = <span class="stringliteral">&quot;1W&quot;</span>;</div>
<div class="line"><span class="lineno">  519</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Neting-set mpor is &quot;</span>&lt;&lt; nettingSetMpor);</div>
<div class="line"><span class="lineno">  520</span>    vector&lt;bool&gt; withCloseOutGrid = {<span class="keyword">false</span>, <span class="keyword">true</span>}; </div>
<div class="line"><span class="lineno">  521</span>    <span class="keywordtype">bool</span> mporStickyDate = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  522</span>    <span class="keywordtype">string</span> mporModeStr = mporStickyDate ? <span class="stringliteral">&quot;StickyDate&quot;</span>: <span class="stringliteral">&quot;ActualDate&quot;</span>;</div>
<div class="line"><span class="lineno">  523</span>    <span class="keywordtype">bool</span> withCompounding = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  524</span>    <span class="keywordtype">string</span> compoundingStr = withCompounding ? <span class="stringliteral">&quot;withCompounding&quot;</span> : <span class="stringliteral">&quot;woCompounding&quot;</span>;</div>
<div class="line"><span class="lineno">  525</span>    <span class="keywordtype">string</span> calcTypeStr;</div>
<div class="line"><span class="lineno">  526</span> </div>
<div class="line"><span class="lineno">  527</span>    <span class="keywordflow">for</span>(Size k = 0; k&lt;withCloseOutGrid.size(); k++){</div>
<div class="line"><span class="lineno">  528</span> </div>
<div class="line"><span class="lineno">  529</span>        <span class="keywordtype">string</span> closeOutGridStr = withCloseOutGrid[k] ? <span class="stringliteral">&quot;withCloseOutGrid&quot;</span>: <span class="stringliteral">&quot;woCloseOutGrid&quot;</span>;</div>
<div class="line"><span class="lineno">  530</span>        std::vector&lt;CollateralExposureHelper::CalculationType&gt; calcTypes; </div>
<div class="line"><span class="lineno">  531</span>        <span class="keywordflow">if</span> (withCloseOutGrid[k]){</div>
<div class="line"><span class="lineno">  532</span>            dateGridStr = <span class="stringliteral">&quot;13,1M&quot;</span>;</div>
<div class="line"><span class="lineno">  533</span>            dateGrid = boost::make_shared&lt;DateGrid&gt;(dateGridStr);</div>
<div class="line"><span class="lineno">  534</span>            calcTypes= {CollateralExposureHelper::CalculationType::NoLag};</div>
<div class="line"><span class="lineno">  535</span>        }</div>
<div class="line"><span class="lineno">  536</span>        <span class="keywordflow">else</span>{</div>
<div class="line"><span class="lineno">  537</span>            dateGridStr = <span class="stringliteral">&quot;13,1W&quot;</span>;</div>
<div class="line"><span class="lineno">  538</span>            dateGrid = boost::make_shared&lt;DateGrid&gt;(dateGridStr);</div>
<div class="line"><span class="lineno">  539</span>            calcTypes= {CollateralExposureHelper::CalculationType::Symmetric,</div>
<div class="line"><span class="lineno">  540</span>                        CollateralExposureHelper::CalculationType::AsymmetricCVA,</div>
<div class="line"><span class="lineno">  541</span>                        CollateralExposureHelper::CalculationType::AsymmetricDVA</div>
<div class="line"><span class="lineno">  542</span>                        };</div>
<div class="line"><span class="lineno">  543</span>        }</div>
<div class="line"><span class="lineno">  544</span>        Period Mpor(1, Weeks);</div>
<div class="line"><span class="lineno">  545</span>        <span class="keywordflow">if</span> (withCloseOutGrid[k]){</div>
<div class="line"><span class="lineno">  546</span>            BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;With close-out grid!&quot;</span>);</div>
<div class="line"><span class="lineno">  547</span>            BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;MPOR in close-out grid= &quot;</span>&lt;&lt; Mpor);</div>
<div class="line"><span class="lineno">  548</span>            dateGrid-&gt;addCloseOutDates(Mpor);</div>
<div class="line"><span class="lineno">  549</span>            <span class="keywordflow">if</span> (mporStickyDate){</div>
<div class="line"><span class="lineno">  550</span>                BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;With mpor mode sticky date!&quot;</span>);</div>
<div class="line"><span class="lineno">  551</span>            }<span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  552</span>                BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;With mpor mode actual date!&quot;</span>);</div>
<div class="line"><span class="lineno">  553</span>        }<span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  554</span>            BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Without close-out grid!&quot;</span>);</div>
<div class="line"><span class="lineno">  555</span> </div>
<div class="line"><span class="lineno">  556</span>        TestData td(referenceDate, dateGrid, withCloseOutGrid[k], mporStickyDate);</div>
<div class="line"><span class="lineno">  557</span> </div>
<div class="line"><span class="lineno">  558</span>        BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;DateGrid: &quot;</span>);</div>
<div class="line"><span class="lineno">  559</span>        BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;t_0, &quot;</span>&lt;&lt;io::iso_date(referenceDate));</div>
<div class="line"><span class="lineno">  560</span>        <span class="keywordflow">for</span>(Size i=0; i&lt;dateGrid-&gt;times().size(); i++)</div>
<div class="line"><span class="lineno">  561</span>            BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;t_&quot;</span>&lt;&lt;i+1&lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt;QuantLib::io::iso_date(dateGrid-&gt;dates()[i]));</div>
<div class="line"><span class="lineno">  562</span>        </div>
<div class="line"><span class="lineno">  563</span>        boost::shared_ptr&lt;Market&gt; initMarket = td.initMarket_;</div>
<div class="line"><span class="lineno">  564</span>        boost::shared_ptr&lt;NPVCube&gt; cube = td.cube_;</div>
<div class="line"><span class="lineno">  565</span>        boost::shared_ptr&lt;Portfolio&gt; portfolio = td.portfolio_;</div>
<div class="line"><span class="lineno">  566</span> </div>
<div class="line"><span class="lineno">  567</span>        std::string nettingSetId = portfolio-&gt;trades().begin()-&gt;second-&gt;envelope().nettingSetId();</div>
<div class="line"><span class="lineno">  568</span>        <a class="code hl_classRef" href="../ored/classore_1_1data_1_1_netting_set_details.html">NettingSetDetails</a> nettingSetDetails(nettingSetId);</div>
<div class="line"><span class="lineno">  569</span> </div>
<div class="line"><span class="lineno">  570</span>        <span class="keywordflow">if</span> (withCloseOutGrid[k]){</div>
<div class="line"><span class="lineno">  571</span>            Period nettingSetMporPeriod = PeriodParser::parse(nettingSetMpor);</div>
<div class="line"><span class="lineno">  572</span>            QL_REQUIRE(nettingSetMporPeriod == Mpor, <span class="stringliteral">&quot;Netting-set mpor is not consistent with the closeout grid!&quot;</span>);</div>
<div class="line"><span class="lineno">  573</span>        }</div>
<div class="line"><span class="lineno">  574</span> </div>
<div class="line"><span class="lineno">  575</span>        std::vector&lt;std::string&gt; elgColls = {<span class="stringliteral">&quot;EUR&quot;</span>};</div>
<div class="line"><span class="lineno">  576</span>        boost::shared_ptr&lt;NettingSetDefinition&gt; nettingSetDefinition = boost::make_shared&lt;NettingSetDefinition&gt;(nettingSetDetails, </div>
<div class="line"><span class="lineno">  577</span>                                                                                                                <span class="stringliteral">&quot;Bilateral&quot;</span>, <span class="stringliteral">&quot;EUR&quot;</span>, <span class="stringliteral">&quot;EUR-EONIA&quot;</span>, </div>
<div class="line"><span class="lineno">  578</span>                                                                                                                0.0, 0.0, 0.0, 0.0, 0.0, </div>
<div class="line"><span class="lineno">  579</span>                                                                                                                <span class="stringliteral">&quot;FIXED&quot;</span>, <span class="stringliteral">&quot;1D&quot;</span>, <span class="stringliteral">&quot;1D&quot;</span>,</div>
<div class="line"><span class="lineno">  580</span>                                                                                                                nettingSetMpor, 0.0, 0.0, elgColls);</div>
<div class="line"><span class="lineno">  581</span>        boost::shared_ptr&lt;NettingSetManager&gt; nettingSetManager = boost::make_shared&lt;NettingSetManager&gt;();</div>
<div class="line"><span class="lineno">  582</span>        nettingSetManager-&gt;add(nettingSetDefinition);</div>
<div class="line"><span class="lineno">  583</span> </div>
<div class="line"><span class="lineno">  584</span>        map&lt;string, vector&lt;vector&lt;Real&gt;&gt;&gt; nettingSetDefaultValue;</div>
<div class="line"><span class="lineno">  585</span>        map&lt;string, vector&lt;vector&lt;Real&gt;&gt;&gt; nettingSetCloseOutValue;</div>
<div class="line"><span class="lineno">  586</span>        map&lt;string, vector&lt;vector&lt;Real&gt;&gt;&gt; nettingSetMporPositiveFlow;</div>
<div class="line"><span class="lineno">  587</span>        map&lt;string, vector&lt;vector&lt;Real&gt;&gt;&gt; nettingSetMporNegativeFlow;</div>
<div class="line"><span class="lineno">  588</span>        map&lt;string, vector&lt;vector&lt;Real&gt;&gt;&gt; nettingSetValue;</div>
<div class="line"><span class="lineno">  589</span>        vector&lt;Real&gt; collateralBalance;</div>
<div class="line"><span class="lineno">  590</span>        vector&lt;vector&lt;Real&gt;&gt; defaultValue;</div>
<div class="line"><span class="lineno">  591</span>        </div>
<div class="line"><span class="lineno">  592</span>        std::string fileName;</div>
<div class="line"><span class="lineno">  593</span>        Handle&lt;AggregationScenarioData&gt; asd;</div>
<div class="line"><span class="lineno">  594</span>        boost::shared_ptr&lt;CubeInterpretation&gt; cubeInterpreter;</div>
<div class="line"><span class="lineno">  595</span>        <span class="keywordflow">if</span> (withCloseOutGrid[k]) {</div>
<div class="line"><span class="lineno">  596</span>            fileName = <span class="stringliteral">&quot;scenarioData_closeout.csv&quot;</span>;</div>
<div class="line"><span class="lineno">  597</span>            asd = Handle&lt;AggregationScenarioData&gt;(<a class="code hl_function" href="namespaceore_1_1analytics.html#a40f1a96a1e189d817b4eb488220c8cf5">loadAggregationScenarioData</a>(fileName));</div>
<div class="line"><span class="lineno">  598</span>            cubeInterpreter = boost::make_shared&lt;CubeInterpretation&gt;(<span class="keyword">true</span>, <span class="keyword">true</span>, asd, dateGrid);</div>
<div class="line"><span class="lineno">  599</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  600</span>            fileName = <span class="stringliteral">&quot;scenarioData.csv&quot;</span>;</div>
<div class="line"><span class="lineno">  601</span>            asd = Handle&lt;AggregationScenarioData&gt;(<a class="code hl_function" href="namespaceore_1_1analytics.html#a40f1a96a1e189d817b4eb488220c8cf5">loadAggregationScenarioData</a>(fileName));</div>
<div class="line"><span class="lineno">  602</span>            cubeInterpreter = boost::make_shared&lt;CubeInterpretation&gt;(<span class="keyword">true</span>, <span class="keyword">false</span>, asd);</div>
<div class="line"><span class="lineno">  603</span>        }</div>
<div class="line"><span class="lineno">  604</span> </div>
<div class="line"><span class="lineno">  605</span>        <span class="keywordflow">if</span> (!withCompounding){</div>
<div class="line"><span class="lineno">  606</span>            compoundingStr = <span class="stringliteral">&quot;woCompounding&quot;</span>;</div>
<div class="line"><span class="lineno">  607</span>            <span class="keywordflow">for</span> (Size i =0; i&lt;cube-&gt;dates().size(); i++)</div>
<div class="line"><span class="lineno">  608</span>                asd-&gt;set(i, 0, 0, AggregationScenarioDataType::IndexFixing, <span class="stringliteral">&quot;EUR-EONIA&quot;</span>);</div>
<div class="line"><span class="lineno">  609</span>        }</div>
<div class="line"><span class="lineno">  610</span> </div>
<div class="line"><span class="lineno">  611</span>        vector&lt;string&gt; regressors = {<span class="stringliteral">&quot;EUR-EURIBOR-6M&quot;</span>};</div>
<div class="line"><span class="lineno">  612</span>        boost::shared_ptr&lt;InputParameters&gt; inputs = boost::make_shared&lt;InputParameters&gt;();</div>
<div class="line"><span class="lineno">  613</span>        boost::shared_ptr&lt;RegressionDynamicInitialMarginCalculator&gt; dimCalculator =</div>
<div class="line"><span class="lineno">  614</span>            boost::make_shared&lt;RegressionDynamicInitialMarginCalculator&gt;(inputs, portfolio, cube, cubeInterpreter, *asd,</div>
<div class="line"><span class="lineno">  615</span>                                                                         0.99, 14, 2, regressors);</div>
<div class="line"><span class="lineno">  616</span> </div>
<div class="line"><span class="lineno">  617</span>        BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;initial NPV at &quot;</span>&lt;&lt; QuantLib::io::iso_date(referenceDate)&lt;&lt;<span class="stringliteral">&quot;: &quot;</span>&lt;&lt;cube-&gt;getT0(0));</div>
<div class="line"><span class="lineno">  618</span>        <span class="keywordflow">for</span> (Size i = 0; i&lt;cube-&gt;dates().size(); i++)     </div>
<div class="line"><span class="lineno">  619</span>            BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;defaultValue at &quot;</span>&lt;&lt; QuantLib::io::iso_date(dateGrid-&gt;valuationDates()[i])&lt;&lt;<span class="stringliteral">&quot;: &quot;</span>&lt;&lt;cubeInterpreter-&gt;getDefaultNpv(cube, 0, i, 0));      </div>
<div class="line"><span class="lineno">  620</span> </div>
<div class="line"><span class="lineno">  621</span>        <span class="keywordflow">for</span> (Size i = 0; i&lt;cube-&gt;dates().size(); i++){</div>
<div class="line"><span class="lineno">  622</span>            <span class="keywordflow">if</span> (withCloseOutGrid[k]){</div>
<div class="line"><span class="lineno">  623</span>                <span class="keywordflow">if</span> (i != cube-&gt;dates().size()-1)</div>
<div class="line"><span class="lineno">  624</span>                    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;closeOutValue at &quot;</span>&lt;&lt; QuantLib::io::iso_date(dateGrid-&gt;closeOutDates()[i])&lt;&lt;<span class="stringliteral">&quot;: &quot;</span>&lt;&lt;cubeInterpreter-&gt;getCloseOutNpv(cube, 0, i, 0));</div>
<div class="line"><span class="lineno">  625</span>            }</div>
<div class="line"><span class="lineno">  626</span>            <span class="keywordflow">else</span>{</div>
<div class="line"><span class="lineno">  627</span>                <span class="keywordflow">if</span> (i != cube-&gt;dates().size()-1)</div>
<div class="line"><span class="lineno">  628</span>                    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;closeOutValue at &quot;</span>&lt;&lt; QuantLib::io::iso_date(dateGrid-&gt;valuationDates()[i])&lt;&lt;<span class="stringliteral">&quot;: &quot;</span>&lt;&lt;cubeInterpreter-&gt;getCloseOutNpv(cube, 0, i, 0));</div>
<div class="line"><span class="lineno">  629</span>            }</div>
<div class="line"><span class="lineno">  630</span>            </div>
<div class="line"><span class="lineno">  631</span>        }</div>
<div class="line"><span class="lineno">  632</span>    </div>
<div class="line"><span class="lineno">  633</span>        <span class="keywordflow">for</span>(<span class="keyword">auto</span> calcType : calcTypes){</div>
<div class="line"><span class="lineno">  634</span>            <span class="keywordflow">if</span> (calcType == <a class="code hl_enumvalue" href="classore_1_1analytics_1_1_collateral_exposure_helper.html#ae2fb950fc8d1f9388248733404704d2fa33e94d2249181e0e1f815e7c0affc69b">CollateralExposureHelper::Symmetric</a>)</div>
<div class="line"><span class="lineno">  635</span>                calcTypeStr = <span class="stringliteral">&quot;Symmetric&quot;</span>;</div>
<div class="line"><span class="lineno">  636</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (calcType == <a class="code hl_enumvalue" href="classore_1_1analytics_1_1_collateral_exposure_helper.html#ae2fb950fc8d1f9388248733404704d2fa9182f684195edba0c45ff885efc353dd">CollateralExposureHelper::AsymmetricCVA</a>)</div>
<div class="line"><span class="lineno">  637</span>                calcTypeStr = <span class="stringliteral">&quot;AsymmetricCVA&quot;</span>;</div>
<div class="line"><span class="lineno">  638</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (calcType == <a class="code hl_enumvalue" href="classore_1_1analytics_1_1_collateral_exposure_helper.html#ae2fb950fc8d1f9388248733404704d2fa44971f8e9b4421cb0a0f462218e377a5">CollateralExposureHelper::AsymmetricDVA</a>)</div>
<div class="line"><span class="lineno">  639</span>                calcTypeStr = <span class="stringliteral">&quot;AsymmetricDVA&quot;</span>;</div>
<div class="line"><span class="lineno">  640</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (calcType == <a class="code hl_enumvalue" href="classore_1_1analytics_1_1_collateral_exposure_helper.html#ae2fb950fc8d1f9388248733404704d2fa724175292085d556aeaa28f6804b8f55">CollateralExposureHelper::NoLag</a>)</div>
<div class="line"><span class="lineno">  641</span>                calcTypeStr = <span class="stringliteral">&quot;NoLag&quot;</span>;</div>
<div class="line"><span class="lineno">  642</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  643</span>                QL_FAIL(<span class="stringliteral">&quot;Collateral calculation type not covered&quot;</span>);</div>
<div class="line"><span class="lineno">  644</span>            BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Calculation type: &quot;</span>&lt;&lt; calcTypeStr); </div>
<div class="line"><span class="lineno">  645</span> </div>
<div class="line"><span class="lineno">  646</span>            boost::shared_ptr&lt;ExposureCalculator&gt; exposureCalculator = boost::make_shared&lt;ExposureCalculator&gt;(portfolio, cube, cubeInterpreter,</div>
<div class="line"><span class="lineno">  647</span>                                                                    initMarket, <span class="keyword">false</span>, <span class="stringliteral">&quot;EUR&quot;</span>, <span class="stringliteral">&quot;Market&quot;</span>,</div>
<div class="line"><span class="lineno">  648</span>                                                                    0.99, calcType, <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  649</span>            exposureCalculator-&gt;build();</div>
<div class="line"><span class="lineno">  650</span>            nettingSetDefaultValue = exposureCalculator-&gt;nettingSetDefaultValue();</div>
<div class="line"><span class="lineno">  651</span>            nettingSetCloseOutValue = exposureCalculator-&gt;nettingSetCloseOutValue();</div>
<div class="line"><span class="lineno">  652</span>            nettingSetMporPositiveFlow = exposureCalculator-&gt;nettingSetMporPositiveFlow();</div>
<div class="line"><span class="lineno">  653</span>            nettingSetMporNegativeFlow = exposureCalculator-&gt;nettingSetMporNegativeFlow();</div>
<div class="line"><span class="lineno">  654</span>            boost::shared_ptr&lt;NettedExposureCalculator&gt; nettedExposureCalculator = boost::make_shared&lt;NettedExposureCalculator&gt;(portfolio, initMarket, cube, <span class="stringliteral">&quot;EUR&quot;</span>, <span class="stringliteral">&quot;Market&quot;</span>,</div>
<div class="line"><span class="lineno">  655</span>                                                                                                                    0.99, calcType, <span class="keyword">false</span>, nettingSetManager, nettingSetDefaultValue,</div>
<div class="line"><span class="lineno">  656</span>                                                                                                                    nettingSetCloseOutValue, nettingSetMporPositiveFlow,</div>
<div class="line"><span class="lineno">  657</span>                                                                                                                    nettingSetMporNegativeFlow, *asd, cubeInterpreter,</div>
<div class="line"><span class="lineno">  658</span>                                                                                                                    <span class="keyword">false</span>, dimCalculator, <span class="keyword">false</span>, <span class="keyword">false</span>, 0.1, exposureCalculator-&gt;exposureCube(),</div>
<div class="line"><span class="lineno">  659</span>                                                                                                                    0, 0, <span class="keyword">false</span>, mporStickyDate, ScenarioGeneratorData::MporCashFlowMode::BothPay);</div>
<div class="line"><span class="lineno">  660</span>            nettedExposureCalculator-&gt;build();</div>
<div class="line"><span class="lineno">  661</span>            nettingSetValue = (calcType == CollateralExposureHelper::CalculationType::NoLag</div>
<div class="line"><span class="lineno">  662</span>                                ? nettedExposureCalculator-&gt;nettingSetCloseOutValue()</div>
<div class="line"><span class="lineno">  663</span>                                : nettedExposureCalculator-&gt;nettingSetDefaultValue());</div>
<div class="line"><span class="lineno">  664</span>            collateralBalance = nettedExposureCalculator-&gt;expectedCollateral(nettingSetId);</div>
<div class="line"><span class="lineno">  665</span>            BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;defaultDate, defaultValue, closeOutDate, collateralBalance&quot;</span>);</div>
<div class="line"><span class="lineno">  666</span>            <span class="keyword">auto</span> key = make_tuple(dateGridStr, nettingSetMpor, closeOutGridStr, mporModeStr, calcTypeStr, compoundingStr); </div>
<div class="line"><span class="lineno">  667</span> </div>
<div class="line"><span class="lineno">  668</span>            vector&lt;Date&gt; cdd = cachedDefaultDates[key];</div>
<div class="line"><span class="lineno">  669</span>            vector&lt;Real&gt; cdv = cachedDefaultValues[key];</div>
<div class="line"><span class="lineno">  670</span>            vector&lt;Date&gt; ccd = cachedCloseOutDates[key];</div>
<div class="line"><span class="lineno">  671</span>            vector&lt;Real&gt; ccv = cachedCloseOutValues[key];</div>
<div class="line"><span class="lineno">  672</span>            BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;cdd &quot;</span>&lt;&lt;cdd.size());</div>
<div class="line"><span class="lineno">  673</span>            BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;cdv &quot;</span>&lt;&lt;cdv.size());</div>
<div class="line"><span class="lineno">  674</span>            BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;ccd &quot;</span>&lt;&lt;ccd.size());</div>
<div class="line"><span class="lineno">  675</span>            BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;ccv &quot;</span>&lt;&lt;ccv.size());</div>
<div class="line"><span class="lineno">  676</span>            Real tolerance = 0.000001;</div>
<div class="line"><span class="lineno">  677</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> n : nettingSetValue){</div>
<div class="line"><span class="lineno">  678</span>                vector&lt;vector&lt;Real&gt;&gt; defaultValue = n.second;</div>
<div class="line"><span class="lineno">  679</span>                <span class="keywordflow">for</span> (Size j = 0; j &lt; cube-&gt;dates().size(); j++){</div>
<div class="line"><span class="lineno">  680</span>                    BOOST_TEST_MESSAGE(io::iso_date(dateGrid-&gt;valuationDates()[j])&lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt;defaultValue[j][0] &lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt; collateralBalance[j+1]);</div>
<div class="line"><span class="lineno">  681</span> </div>
<div class="line"><span class="lineno">  682</span>                    BOOST_CHECK_MESSAGE(dateGrid-&gt;valuationDates()[j] == cdd[j], </div>
<div class="line"><span class="lineno">  683</span>                                                <span class="stringliteral">&quot;default date &quot;</span>&lt;&lt; dateGrid-&gt;valuationDates()[j] &lt;&lt; <span class="stringliteral">&quot; does not match with cashed default date &quot;</span>&lt;&lt; cdd[j]);</div>
<div class="line"><span class="lineno">  684</span>                    BOOST_CHECK_MESSAGE(fabs(defaultValue[j][0] - cdv[j]) &lt; tolerance, </div>
<div class="line"><span class="lineno">  685</span>                                                <span class="stringliteral">&quot;default value &quot;</span>&lt;&lt; defaultValue[j][0] &lt;&lt; <span class="stringliteral">&quot; does not match with cashed default value &quot;</span>&lt;&lt; cdv[j]);  </div>
<div class="line"><span class="lineno">  686</span>                    BOOST_CHECK_MESSAGE(fabs(collateralBalance[j+1] - ccv[j]) &lt; tolerance,</div>
<div class="line"><span class="lineno">  687</span>                                                <span class="stringliteral">&quot;collateral balance &quot;</span>&lt;&lt; collateralBalance[j+1] &lt;&lt; <span class="stringliteral">&quot; does not match with cashed collateral balance &quot;</span>&lt;&lt; ccv[j]);</div>
<div class="line"><span class="lineno">  688</span>                }</div>
<div class="line"><span class="lineno">  689</span>            }</div>
<div class="line"><span class="lineno">  690</span>        }</div>
<div class="line"><span class="lineno">  691</span>    }</div>
<div class="line"><span class="lineno">  692</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_collateral_exposure_helper_html_ae2fb950fc8d1f9388248733404704d2fa33e94d2249181e0e1f815e7c0affc69b"><div class="ttname"><a href="classore_1_1analytics_1_1_collateral_exposure_helper.html#ae2fb950fc8d1f9388248733404704d2fa33e94d2249181e0e1f815e7c0affc69b">ore::analytics::CollateralExposureHelper::Symmetric</a></div><div class="ttdeci">@ Symmetric</div><div class="ttdef"><b>Definition:</b> <a href="collatexposurehelper_8hpp_source.html#l00063">collatexposurehelper.hpp:63</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_collateral_exposure_helper_html_ae2fb950fc8d1f9388248733404704d2fa44971f8e9b4421cb0a0f462218e377a5"><div class="ttname"><a href="classore_1_1analytics_1_1_collateral_exposure_helper.html#ae2fb950fc8d1f9388248733404704d2fa44971f8e9b4421cb0a0f462218e377a5">ore::analytics::CollateralExposureHelper::AsymmetricDVA</a></div><div class="ttdeci">@ AsymmetricDVA</div><div class="ttdef"><b>Definition:</b> <a href="collatexposurehelper_8hpp_source.html#l00063">collatexposurehelper.hpp:63</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_collateral_exposure_helper_html_ae2fb950fc8d1f9388248733404704d2fa724175292085d556aeaa28f6804b8f55"><div class="ttname"><a href="classore_1_1analytics_1_1_collateral_exposure_helper.html#ae2fb950fc8d1f9388248733404704d2fa724175292085d556aeaa28f6804b8f55">ore::analytics::CollateralExposureHelper::NoLag</a></div><div class="ttdeci">@ NoLag</div><div class="ttdef"><b>Definition:</b> <a href="collatexposurehelper_8hpp_source.html#l00063">collatexposurehelper.hpp:63</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_collateral_exposure_helper_html_ae2fb950fc8d1f9388248733404704d2fa9182f684195edba0c45ff885efc353dd"><div class="ttname"><a href="classore_1_1analytics_1_1_collateral_exposure_helper.html#ae2fb950fc8d1f9388248733404704d2fa9182f684195edba0c45ff885efc353dd">ore::analytics::CollateralExposureHelper::AsymmetricCVA</a></div><div class="ttdeci">@ AsymmetricCVA</div><div class="ttdef"><b>Definition:</b> <a href="collatexposurehelper_8hpp_source.html#l00063">collatexposurehelper.hpp:63</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_netting_set_details_html"><div class="ttname"><a href="../ored/classore_1_1data_1_1_netting_set_details.html">ore::data::NettingSetDetails</a></div></div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a40f1a96a1e189d817b4eb488220c8cf5"><div class="ttname"><a href="namespaceore_1_1analytics.html#a40f1a96a1e189d817b4eb488220c8cf5">ore::analytics::loadAggregationScenarioData</a></div><div class="ttdeci">boost::shared_ptr&lt; AggregationScenarioData &gt; loadAggregationScenarioData(const std::string &amp;filename)</div><div class="ttdef"><b>Definition:</b> <a href="cube__io_8cpp_source.html#l00200">cube_io.cpp:200</a></div></div>
<div class="ttc" id="autilities_8cpp_html_a24bc06abadc72e51af462e64714c3822"><div class="ttname"><a href="../ored/utilities_8cpp.html#a24bc06abadc72e51af462e64714c3822">referenceDate</a></div><div class="ttdeci">Date referenceDate</div></div>
</div><!-- fragment --><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="nettedexpsoure_8cpp_a73c6b5990ccfc4cf44c8bf4da9a1f3ee_cgraph.png" border="0" usemap="#anettedexpsoure_8cpp_a73c6b5990ccfc4cf44c8bf4da9a1f3ee_cgraph" alt=""/></div>
<map name="anettedexpsoure_8cpp_a73c6b5990ccfc4cf44c8bf4da9a1f3ee_cgraph" id="anettedexpsoure_8cpp_a73c6b5990ccfc4cf44c8bf4da9a1f3ee_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,196,56"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a40f1a96a1e189d817b4eb488220c8cf5" title=" " alt="" coords="244,23,445,63"/>
<area shape="rect" target="_parent" href="../ored/group__utilities.html#gaecd67eda4fb5f4859bb8f6d383547721" title=" " alt="" coords="493,5,645,31"/>
<area shape="rect" target="_parent" href="../ored/group__utilities.html#gad1db2a68f9a73667c3b4084d63955bdd" title=" " alt="" coords="500,55,639,80"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.9.5
</small></address>
</body>
</html>
