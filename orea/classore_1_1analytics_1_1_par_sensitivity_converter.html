<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<title>OREAnalytics: ParSensitivityConverter Class Reference</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="oreaextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-analytics@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.8.12</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceore.html">ore</a></li><li class="navelem"><a class="el" href="namespaceore_1_1analytics.html">analytics</a></li><li class="navelem"><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html">ParSensitivityConverter</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classore_1_1analytics_1_1_par_sensitivity_converter-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">ParSensitivityConverter Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html" title="ParSensitivityConverter class.">ParSensitivityConverter</a> class.  
 <a href="classore_1_1analytics_1_1_par_sensitivity_converter.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html">orea/engine/parsensitivityanalysis.hpp</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for ParSensitivityConverter:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_par_sensitivity_converter__coll__graph.png" border="0" usemap="#a_par_sensitivity_converter_coll__map" alt="Collaboration graph"/></div>
<map name="a_par_sensitivity_converter_coll__map" id="a_par_sensitivity_converter_coll__map">
<area shape="rect" title="ParSensitivityConverter class." alt="" coords="245,491,427,619"/>
<area shape="rect" title=" " alt="" coords="126,359,261,413"/>
<area shape="rect" href="classore_1_1analytics_1_1_risk_factor_key.html" title="Data types stored in the scenario class." alt="" coords="75,197,210,281"/>
<area shape="rect" title=" " alt="" coords="5,95,83,135"/>
<area shape="rect" title=" " alt="" coords="107,95,165,135"/>
<area shape="rect" title=" " alt="" coords="63,5,209,45"/>
<area shape="rect" title=" " alt="" coords="190,95,242,135"/>
<area shape="rect" title=" " alt="" coords="244,219,321,259"/>
<area shape="rect" title=" " alt="" coords="270,95,309,135"/>
<area shape="rect" title=" " alt="" coords="285,366,387,406"/>
<area shape="rect" title=" " alt="" coords="412,366,583,406"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a8c2afda8c72547917b246769f04ee152"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a8c2afda8c72547917b246769f04ee152">ParSensitivityConverter</a> (const <a class="el" href="classore_1_1analytics_1_1_par_sensitivity_analysis.html#abe637de864ef34aa2842b582cf4680b4">ParSensitivityAnalysis::ParContainer</a> &amp;parSensitivities, const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_risk_factor_key.html">ore::analytics::RiskFactorKey</a>, std::pair&lt; QuantLib::Real, QuantLib::Real &gt; &gt; &amp;shiftSizes)</td></tr>
<tr class="separator:a8c2afda8c72547917b246769f04ee152"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae1342ff44962b71bcc7fef74f22e168"><td class="memItemLeft" align="right" valign="top">const std::set&lt; <a class="el" href="classore_1_1analytics_1_1_risk_factor_key.html">ore::analytics::RiskFactorKey</a> &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#aae1342ff44962b71bcc7fef74f22e168">rawKeys</a> ()</td></tr>
<tr class="memdesc:aae1342ff44962b71bcc7fef74f22e168"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inspectors.  <a href="classore_1_1analytics_1_1_par_sensitivity_converter.html#aae1342ff44962b71bcc7fef74f22e168">More...</a><br /></td></tr>
<tr class="separator:aae1342ff44962b71bcc7fef74f22e168"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a198e93051a59e5fbaaa229059c3ba44e"><td class="memItemLeft" align="right" valign="top">const std::set&lt; <a class="el" href="classore_1_1analytics_1_1_risk_factor_key.html">ore::analytics::RiskFactorKey</a> &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a198e93051a59e5fbaaa229059c3ba44e">parKeys</a> ()</td></tr>
<tr class="separator:a198e93051a59e5fbaaa229059c3ba44e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5383f0ebf9907227d0d17426b695fbb6"><td class="memItemLeft" align="right" valign="top">boost::numeric::ublas::vector&lt; Real &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5383f0ebf9907227d0d17426b695fbb6">convertSensitivity</a> (const boost::numeric::ublas::vector&lt; Real &gt; &amp;zeroSensitivities)</td></tr>
<tr class="memdesc:a5383f0ebf9907227d0d17426b695fbb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Takes an array of zero sensitivities and returns an array of par sensitivities.  <a href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5383f0ebf9907227d0d17426b695fbb6">More...</a><br /></td></tr>
<tr class="separator:a5383f0ebf9907227d0d17426b695fbb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a154d8f197dfa11c3d9fe32159e3a355b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a154d8f197dfa11c3d9fe32159e3a355b">writeConversionMatrix</a> (<a class="elRef" href="../ored/classore_1_1data_1_1_report.html">ore::data::Report</a> &amp;reportOut) const</td></tr>
<tr class="memdesc:a154d8f197dfa11c3d9fe32159e3a355b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write the inverse of the transposed Jacobian to the <code>reportOut</code>.  <a href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a154d8f197dfa11c3d9fe32159e3a355b">More...</a><br /></td></tr>
<tr class="separator:a154d8f197dfa11c3d9fe32159e3a355b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfa161443de774ad0ae35a4bb75ebbe7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_analysis.html#abe637de864ef34aa2842b582cf4680b4">ParSensitivityAnalysis::ParContainer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#adfa161443de774ad0ae35a4bb75ebbe7">inverseJacobian</a> () const</td></tr>
<tr class="separator:adfa161443de774ad0ae35a4bb75ebbe7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a5ed87ee8270263d0f1d6dff7a6403951"><td class="memItemLeft" align="right" valign="top">std::set&lt; <a class="el" href="classore_1_1analytics_1_1_risk_factor_key.html">ore::analytics::RiskFactorKey</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">rawKeys_</a></td></tr>
<tr class="separator:a5ed87ee8270263d0f1d6dff7a6403951"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15fe2fc674e73073ae204c67beec98af"><td class="memItemLeft" align="right" valign="top">std::set&lt; <a class="el" href="classore_1_1analytics_1_1_risk_factor_key.html">ore::analytics::RiskFactorKey</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a15fe2fc674e73073ae204c67beec98af">parKeys_</a></td></tr>
<tr class="separator:a15fe2fc674e73073ae204c67beec98af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab306f203cbdc63e4fd60be53cc526eed"><td class="memItemLeft" align="right" valign="top">QuantLib::SparseMatrix&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#ab306f203cbdc63e4fd60be53cc526eed">jacobi_transp_inv_</a></td></tr>
<tr class="separator:ab306f203cbdc63e4fd60be53cc526eed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f9d36a1e4e25450af27f6c9dda92422"><td class="memItemLeft" align="right" valign="top">boost::numeric::ublas::vector&lt; QuantLib::Real &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5f9d36a1e4e25450af27f6c9dda92422">zeroShifts_</a></td></tr>
<tr class="memdesc:a5f9d36a1e4e25450af27f6c9dda92422"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vector of absolute zero shift sizes.  <a href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5f9d36a1e4e25450af27f6c9dda92422">More...</a><br /></td></tr>
<tr class="separator:a5f9d36a1e4e25450af27f6c9dda92422"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c2b75a426c1695a539acc6cb266fc51"><td class="memItemLeft" align="right" valign="top">boost::numeric::ublas::vector&lt; QuantLib::Real &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a8c2b75a426c1695a539acc6cb266fc51">parShifts_</a></td></tr>
<tr class="memdesc:a8c2b75a426c1695a539acc6cb266fc51"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vector of absolute par shift sizes.  <a href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a8c2b75a426c1695a539acc6cb266fc51">More...</a><br /></td></tr>
<tr class="separator:a8c2b75a426c1695a539acc6cb266fc51"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p ><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html" title="ParSensitivityConverter class.">ParSensitivityConverter</a> class. </p>
<p >1) Build Jacobi matrix containing sensitivities of par rates (first index) w.r.t. zero shifts (second index) 2) Convert zero rate and optionlet vol sensitivities into par rate/vol sensitivities</p>
<p >Let: p_ij denote curve i's par instrument j (curve may be a discount or an index curve) z_kl denote curve k's zero shift l (curve may be a discount or an index curve) i,k run from 0 to I j,l run from 0 to J</p>
<p >Organisation of the matrix: z_00 z_01 z_02 ... z_0J ... z_10 z_11 ... z_1J ... z_I0 z_I1 ... z_IJ p_00 p_01 p_02 ... p_0J p_10 p_11 ... p_1J ... p_I0 p_I1 ... p_IJ</p>
<p >The curve numbering starts with discount curves (by ccy), followed by index curves (by index name). The number J of par instruments respectively zero shifts can differ between discount and index curves. The number of zero shifts matches the number of par instruments. The Jacobi matrix is therefore quadratic by construction. </p>

<p class="definition">Definition at line <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html#l00174">174</a> of file <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html">parsensitivityanalysis.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a8c2afda8c72547917b246769f04ee152" name="a8c2afda8c72547917b246769f04ee152"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c2afda8c72547917b246769f04ee152">&#9670;&#160;</a></span>ParSensitivityConverter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html">ParSensitivityConverter</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1analytics_1_1_par_sensitivity_analysis.html#abe637de864ef34aa2842b582cf4680b4">ParSensitivityAnalysis::ParContainer</a> &amp;&#160;</td>
          <td class="paramname"><em>parSensitivities</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; <a class="el" href="classore_1_1analytics_1_1_risk_factor_key.html">ore::analytics::RiskFactorKey</a>, std::pair&lt; QuantLib::Real, QuantLib::Real &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>shiftSizes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Constructor where <code>parSensitivities</code> is the par rate sensitivities w.r.t. zero shifts <code>shiftSizes</code> gives the absolute zero and par shift sizes for each risk factor key. </p>

<p class="definition">Definition at line <a class="el" href="orea_2engine_2parsensitivityanalysis_8cpp_source.html#l00572">572</a> of file <a class="el" href="orea_2engine_2parsensitivityanalysis_8cpp_source.html">parsensitivityanalysis.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  573</span>                                                                                                         {</div>
<div class="line"><span class="lineno">  574</span> </div>
<div class="line"><span class="lineno">  575</span>    <span class="comment">// Populate the set of par keys (rows of Jacobi) and raw zero keys (columns of Jacobi)</span></div>
<div class="line"><span class="lineno">  576</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> parEntry : parSensitivities) {</div>
<div class="line"><span class="lineno">  577</span>        <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a15fe2fc674e73073ae204c67beec98af">parKeys_</a>.insert(parEntry.first.first);</div>
<div class="line"><span class="lineno">  578</span>        <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">rawKeys_</a>.insert(parEntry.first.second);</div>
<div class="line"><span class="lineno">  579</span>    }</div>
<div class="line"><span class="lineno">  580</span> </div>
<div class="line"><span class="lineno">  581</span>    Size n_par = <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a15fe2fc674e73073ae204c67beec98af">parKeys_</a>.size();</div>
<div class="line"><span class="lineno">  582</span>    Size n_raw = <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">rawKeys_</a>.size();</div>
<div class="line"><span class="lineno">  583</span>    SparseMatrix jacobi_transp(n_raw, n_par); <span class="comment">// transposed Jacobi</span></div>
<div class="line"><span class="lineno">  584</span>    <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Transposed Jacobi matrix dimension &quot;</span> &lt;&lt; n_raw &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; n_par);</div>
<div class="line"><span class="lineno">  585</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a15fe2fc674e73073ae204c67beec98af">parKeys_</a> != <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">rawKeys_</a>) {</div>
<div class="line"><span class="lineno">  586</span>        std::set&lt;RiskFactorKey&gt; parMinusRaw, rawMinusPar;</div>
<div class="line"><span class="lineno">  587</span>        std::set_difference(<a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a15fe2fc674e73073ae204c67beec98af">parKeys_</a>.begin(), <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a15fe2fc674e73073ae204c67beec98af">parKeys_</a>.end(), <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">rawKeys_</a>.begin(), <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">rawKeys_</a>.end(),</div>
<div class="line"><span class="lineno">  588</span>                            std::inserter(parMinusRaw, parMinusRaw.begin()));</div>
<div class="line"><span class="lineno">  589</span>        std::set_difference(<a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">rawKeys_</a>.begin(), <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">rawKeys_</a>.end(), <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a15fe2fc674e73073ae204c67beec98af">parKeys_</a>.begin(), <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a15fe2fc674e73073ae204c67beec98af">parKeys_</a>.end(),</div>
<div class="line"><span class="lineno">  590</span>                            std::inserter(rawMinusPar, rawMinusPar.begin()));</div>
<div class="line"><span class="lineno">  591</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; p : parMinusRaw) {</div>
<div class="line"><span class="lineno">  592</span>            <a class="code hl_defineRef" href="../ored/log_8hpp.html#a35cb05f674d9e764ca12cff351b064f2">ALOG</a>(<span class="stringliteral">&quot;par key &#39;&quot;</span> &lt;&lt; p &lt;&lt; <span class="stringliteral">&quot;&#39; not in raw key set&quot;</span>);</div>
<div class="line"><span class="lineno">  593</span>        }</div>
<div class="line"><span class="lineno">  594</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; p : rawMinusPar) {</div>
<div class="line"><span class="lineno">  595</span>            <a class="code hl_defineRef" href="../ored/log_8hpp.html#a35cb05f674d9e764ca12cff351b064f2">ALOG</a>(<span class="stringliteral">&quot;raw key &#39;&quot;</span> &lt;&lt; p &lt;&lt; <span class="stringliteral">&quot;&#39; not in par key set&quot;</span>);</div>
<div class="line"><span class="lineno">  596</span>        }</div>
<div class="line"><span class="lineno">  597</span>        QL_FAIL(<span class="stringliteral">&quot;Zero and par keys should be equal for par conversion, see log for differences&quot;</span>);</div>
<div class="line"><span class="lineno">  598</span>    }</div>
<div class="line"><span class="lineno">  599</span>    QL_REQUIRE(n_raw &gt; 0, <span class="stringliteral">&quot;Transposed Jacobi matrix has size 0&quot;</span>);</div>
<div class="line"><span class="lineno">  600</span> </div>
<div class="line"><span class="lineno">  601</span>    <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Populating the vector of zero and par shift sizes&quot;</span>);</div>
<div class="line"><span class="lineno">  602</span>    <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5f9d36a1e4e25450af27f6c9dda92422">zeroShifts_</a>.resize(n_raw);</div>
<div class="line"><span class="lineno">  603</span>    <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a8c2b75a426c1695a539acc6cb266fc51">parShifts_</a>.resize(n_par);</div>
<div class="line"><span class="lineno">  604</span>    Size i = 0;</div>
<div class="line"><span class="lineno">  605</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; key : <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">rawKeys_</a>) {</div>
<div class="line"><span class="lineno">  606</span>        QL_REQUIRE(shiftSizes.count(key) == 1, <span class="stringliteral">&quot;ParSensitivityConverter is missing shift sizes for key &quot;</span> &lt;&lt; key);</div>
<div class="line"><span class="lineno">  607</span>        <span class="comment">// avoid division by zero below: if we have a zero shift, the corresponding zero sensi will be zero, too,</span></div>
<div class="line"><span class="lineno">  608</span>        <span class="comment">// but if we divide this sensi by zero, we will get nan instead of zero</span></div>
<div class="line"><span class="lineno">  609</span>        <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5f9d36a1e4e25450af27f6c9dda92422">zeroShifts_</a>[i] = std::max(shiftSizes.at(key).first, 1E-10);</div>
<div class="line"><span class="lineno">  610</span>        <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a8c2b75a426c1695a539acc6cb266fc51">parShifts_</a>[i] = shiftSizes.at(key).second;</div>
<div class="line"><span class="lineno">  611</span>        i++;</div>
<div class="line"><span class="lineno">  612</span>    }</div>
<div class="line"><span class="lineno">  613</span> </div>
<div class="line"><span class="lineno">  614</span>    <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Populating Transposed Jacobi matrix&quot;</span>);</div>
<div class="line"><span class="lineno">  615</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; p : parSensitivities) {</div>
<div class="line"><span class="lineno">  616</span>        Size parIdx = std::distance(<a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a15fe2fc674e73073ae204c67beec98af">parKeys_</a>.begin(), <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a15fe2fc674e73073ae204c67beec98af">parKeys_</a>.find(p.first.first));</div>
<div class="line"><span class="lineno">  617</span>        Size rawIdx = std::distance(<a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">rawKeys_</a>.begin(), <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">rawKeys_</a>.find(p.first.second));</div>
<div class="line"><span class="lineno">  618</span>        QL_REQUIRE(parIdx &lt; n_par, <span class="stringliteral">&quot;internal error: parKey &quot;</span> &lt;&lt; p.first.first &lt;&lt; <span class="stringliteral">&quot; not found in parKeys_&quot;</span>);</div>
<div class="line"><span class="lineno">  619</span>        QL_REQUIRE(rawIdx &lt; n_raw, <span class="stringliteral">&quot;internal error: rawKey &quot;</span> &lt;&lt; p.first.second &lt;&lt; <span class="stringliteral">&quot; not found in parKeys_&quot;</span>);</div>
<div class="line"><span class="lineno">  620</span>        jacobi_transp(rawIdx, parIdx) = p.second;</div>
<div class="line"><span class="lineno">  621</span>        <a class="code hl_defineRef" href="../ored/log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Matrix entry [&quot;</span> &lt;&lt; rawIdx &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; parIdx &lt;&lt; <span class="stringliteral">&quot;] ~ [raw:&quot;</span> &lt;&lt; p.first.second &lt;&lt; <span class="stringliteral">&quot;, par:&quot;</span> &lt;&lt; p.first.first</div>
<div class="line"><span class="lineno">  622</span>                              &lt;&lt; <span class="stringliteral">&quot;]: &quot;</span> &lt;&lt; p.second);</div>
<div class="line"><span class="lineno">  623</span>    }</div>
<div class="line"><span class="lineno">  624</span>    <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Finished populating transposed Jacobi matrix, non-zero entries = &quot;</span></div>
<div class="line"><span class="lineno">  625</span>        &lt;&lt; parSensitivities.size() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span></div>
<div class="line"><span class="lineno">  626</span>        &lt;&lt; 100.0 * <span class="keyword">static_cast&lt;</span>Real<span class="keyword">&gt;</span>(parSensitivities.size()) / <span class="keyword">static_cast&lt;</span>Real<span class="keyword">&gt;</span>(n_par * n_raw) &lt;&lt; <span class="stringliteral">&quot;%)&quot;</span>);</div>
<div class="line"><span class="lineno">  627</span> </div>
<div class="line"><span class="lineno">  628</span>    <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Populating block indices&quot;</span>);</div>
<div class="line"><span class="lineno">  629</span>    vector&lt;Size&gt; blockIndices;</div>
<div class="line"><span class="lineno">  630</span>    pair&lt;RiskFactorKey::KeyType, string&gt; previousGroup(<a class="code hl_enumvalue" href="classore_1_1analytics_1_1_risk_factor_key.html#aab0feaba617470cb4aa830dc5935238ca6adf97f83acf6453d4a6a4b1070f3754">RiskFactorKey::KeyType::None</a>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  631</span>    Size blockIndex = 0;</div>
<div class="line"><span class="lineno">  632</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> r : <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">rawKeys_</a>) {</div>
<div class="line"><span class="lineno">  633</span>        <span class="comment">// Update block indices with the index where the risk factor group changes</span></div>
<div class="line"><span class="lineno">  634</span>        <span class="comment">// e.g. when move from (DiscountCurve, EUR) to (DiscountCurve, USD)</span></div>
<div class="line"><span class="lineno">  635</span>        pair&lt;RiskFactorKey::KeyType, string&gt; thisGroup(r.keytype, r.name);</div>
<div class="line"><span class="lineno">  636</span>        <span class="keywordflow">if</span> (blockIndex &gt; 0 &amp;&amp; previousGroup != thisGroup) {</div>
<div class="line"><span class="lineno">  637</span>            blockIndices.push_back(blockIndex);</div>
<div class="line"><span class="lineno">  638</span>            <a class="code hl_defineRef" href="../ored/log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Adding block index &quot;</span> &lt;&lt; blockIndex);</div>
<div class="line"><span class="lineno">  639</span>        }</div>
<div class="line"><span class="lineno">  640</span>        ++blockIndex;</div>
<div class="line"><span class="lineno">  641</span> </div>
<div class="line"><span class="lineno">  642</span>        <span class="comment">// Update the risk factor group</span></div>
<div class="line"><span class="lineno">  643</span>        previousGroup = thisGroup;</div>
<div class="line"><span class="lineno">  644</span>    }</div>
<div class="line"><span class="lineno">  645</span>    blockIndices.push_back(blockIndex);</div>
<div class="line"><span class="lineno">  646</span>    <a class="code hl_defineRef" href="../ored/log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Adding block index &quot;</span> &lt;&lt; blockIndex);</div>
<div class="line"><span class="lineno">  647</span>    <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Finished Populating block indices.&quot;</span>);</div>
<div class="line"><span class="lineno">  648</span> </div>
<div class="line"><span class="lineno">  649</span>    <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Invert Transposed Jacobi matrix&quot;</span>);</div>
<div class="line"><span class="lineno">  650</span>    <span class="keywordtype">bool</span> success = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  651</span>    <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  652</span>        <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#ab306f203cbdc63e4fd60be53cc526eed">jacobi_transp_inv_</a> = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a923d909efec4ac21f85e7754efd389e1">blockMatrixInverse</a>(jacobi_transp, blockIndices);</div>
<div class="line"><span class="lineno">  653</span>    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div>
<div class="line"><span class="lineno">  654</span>        <span class="comment">// something went wrong during the matrix inversion, so we run an extended analysis on the original matrix</span></div>
<div class="line"><span class="lineno">  655</span>        <span class="comment">// to see whether there are zero or linearly dependent rows / columns</span></div>
<div class="line"><span class="lineno">  656</span>        <a class="code hl_class" href="classore_1_1analytics_1_1_structured_analytics_error_message.html">StructuredAnalyticsErrorMessage</a>(<span class="stringliteral">&quot;Par sensitivity conversion&quot;</span>, <span class="stringliteral">&quot;Transposed Jacobi matrix inversion failed&quot;</span>,</div>
<div class="line"><span class="lineno">  657</span>                                        e.what())</div>
<div class="line"><span class="lineno">  658</span>            .<a class="code hl_functionRef" href="../ored/classore_1_1data_1_1_j_s_o_n_message.html#a5e21eca2668ed948bdc409b19a78e5bb">log</a>();</div>
<div class="line"><span class="lineno">  659</span>        <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Running extended matrix diagnostics (looking for zero or linearly dependent rows / columns...)&quot;</span>);</div>
<div class="line"><span class="lineno">  660</span>        <span class="keyword">constexpr</span> Size nOp = 1000; <span class="comment">// number of operations for close_enough comparisons below</span></div>
<div class="line"><span class="lineno">  661</span>        <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Checking for zero rows...&quot;</span>);</div>
<div class="line"><span class="lineno">  662</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it1 = jacobi_transp.begin1(); it1 != jacobi_transp.end1(); ++it1) {</div>
<div class="line"><span class="lineno">  663</span>            Real tmp = 0.0;</div>
<div class="line"><span class="lineno">  664</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> it2 = it1.begin(); it2 != it1.end(); ++it2) {</div>
<div class="line"><span class="lineno">  665</span>                tmp += (*it2) * (*it2);</div>
<div class="line"><span class="lineno">  666</span>            }</div>
<div class="line"><span class="lineno">  667</span>            <span class="keywordflow">if</span> (<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(tmp, 0.0, n_par * nOp)) {</div>
<div class="line"><span class="lineno">  668</span>                <a class="code hl_defineRef" href="../ored/log_8hpp.html#a9622ca943201e814041f051b7a10b3ea">WLOG</a>(<span class="stringliteral">&quot;row &quot;</span> &lt;&lt; it1.index1() &lt;&lt; <span class="stringliteral">&quot; is zero&quot;</span>);</div>
<div class="line"><span class="lineno">  669</span>            }</div>
<div class="line"><span class="lineno">  670</span>        }</div>
<div class="line"><span class="lineno">  671</span>        <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Checking for zero columns...&quot;</span>);</div>
<div class="line"><span class="lineno">  672</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it2 = jacobi_transp.begin2(); it2 != jacobi_transp.end2(); ++it2) {</div>
<div class="line"><span class="lineno">  673</span>            Real tmp = 0.0;</div>
<div class="line"><span class="lineno">  674</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> it1 = it2.begin(); it1 != it2.end(); ++it1) {</div>
<div class="line"><span class="lineno">  675</span>                tmp += (*it1) * (*it1);</div>
<div class="line"><span class="lineno">  676</span>            }</div>
<div class="line"><span class="lineno">  677</span>            <span class="keywordflow">if</span> (<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(tmp, 0.0, n_par * nOp)) {</div>
<div class="line"><span class="lineno">  678</span>                <a class="code hl_defineRef" href="../ored/log_8hpp.html#a9622ca943201e814041f051b7a10b3ea">WLOG</a>(<span class="stringliteral">&quot;column &quot;</span> &lt;&lt; it2.index2() &lt;&lt; <span class="stringliteral">&quot; is zero&quot;</span>);</div>
<div class="line"><span class="lineno">  679</span>            }</div>
<div class="line"><span class="lineno">  680</span>        }</div>
<div class="line"><span class="lineno">  681</span>        <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Checking for linearly dependent rows...&quot;</span>);</div>
<div class="line"><span class="lineno">  682</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it1 = jacobi_transp.begin1(); it1 != jacobi_transp.end1(); ++it1) {</div>
<div class="line"><span class="lineno">  683</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> it1b = jacobi_transp.begin1(); it1b != jacobi_transp.end1(); ++it1b) {</div>
<div class="line"><span class="lineno">  684</span>                <span class="keywordflow">if</span> (it1b.index1() &lt;= it1.index1())</div>
<div class="line"><span class="lineno">  685</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  686</span>                Real ratio = Null&lt;Real&gt;();</div>
<div class="line"><span class="lineno">  687</span>                <span class="keywordflow">if</span> (it1.begin() != it1.end() &amp;&amp; it1b.begin() != it1b.end()) {</div>
<div class="line"><span class="lineno">  688</span>                    <span class="keywordtype">bool</span> dependent = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  689</span>                    <span class="keyword">auto</span> it2b = it1b.begin();</div>
<div class="line"><span class="lineno">  690</span>                    <span class="keywordflow">for</span> (<span class="keyword">auto</span> it2 = it1.begin(); it2 != it1.end() &amp;&amp; dependent; ++it2) {</div>
<div class="line"><span class="lineno">  691</span>                        <span class="keywordflow">if</span> (<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(*it2, 0.0, nOp))</div>
<div class="line"><span class="lineno">  692</span>                            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  693</span>                        <span class="keywordtype">bool</span> foundMatchingIndex = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  694</span>                        <span class="keywordflow">while</span> (it2b != it1b.end() &amp;&amp; it2b.index2() &lt;= it2.index2() &amp;&amp; dependent) {</div>
<div class="line"><span class="lineno">  695</span>                            <span class="keywordflow">if</span> (it2b.index2() &lt; it2.index2()) {</div>
<div class="line"><span class="lineno">  696</span>                                <span class="keywordflow">if</span> (!<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(*it2b, 0.0, nOp))</div>
<div class="line"><span class="lineno">  697</span>                                    dependent = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  698</span>                            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  699</span>                                foundMatchingIndex = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  700</span>                                <span class="keywordflow">if</span> (<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(*it2b, 0.0, nOp)) {</div>
<div class="line"><span class="lineno">  701</span>                                    dependent = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  702</span>                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ratio == Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  703</span>                                    ratio = *it2b / *it2;</div>
<div class="line"><span class="lineno">  704</span>                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(*it2b / *it2, ratio, nOp)) {</div>
<div class="line"><span class="lineno">  705</span>                                    dependent = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  706</span>                                }</div>
<div class="line"><span class="lineno">  707</span>                            }</div>
<div class="line"><span class="lineno">  708</span>                            ++it2b;</div>
<div class="line"><span class="lineno">  709</span>                        }</div>
<div class="line"><span class="lineno">  710</span>                        <span class="keywordflow">if</span> (!foundMatchingIndex)</div>
<div class="line"><span class="lineno">  711</span>                            dependent = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  712</span>                    }</div>
<div class="line"><span class="lineno">  713</span>                    <span class="keywordflow">while</span> (it2b != it1b.end() &amp;&amp; dependent) {</div>
<div class="line"><span class="lineno">  714</span>                        <span class="keywordflow">if</span> (!<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(*it2b, 0.0))</div>
<div class="line"><span class="lineno">  715</span>                            dependent = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  716</span>                        ++it2b;</div>
<div class="line"><span class="lineno">  717</span>                    }</div>
<div class="line"><span class="lineno">  718</span>                    <span class="keywordflow">if</span> (dependent) {</div>
<div class="line"><span class="lineno">  719</span>                        <a class="code hl_defineRef" href="../ored/log_8hpp.html#a9622ca943201e814041f051b7a10b3ea">WLOG</a>(<span class="stringliteral">&quot;rows &quot;</span> &lt;&lt; it1.index1() &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; it1b.index1() &lt;&lt; <span class="stringliteral">&quot; are linearly dependent.&quot;</span>);</div>
<div class="line"><span class="lineno">  720</span>                    }</div>
<div class="line"><span class="lineno">  721</span>                }</div>
<div class="line"><span class="lineno">  722</span>            }</div>
<div class="line"><span class="lineno">  723</span>        }</div>
<div class="line"><span class="lineno">  724</span>        <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Checking for linearly dependent columns...&quot;</span>);</div>
<div class="line"><span class="lineno">  725</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it1 = jacobi_transp.begin2(); it1 != jacobi_transp.end2(); ++it1) {</div>
<div class="line"><span class="lineno">  726</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> it1b = jacobi_transp.begin2(); it1b != jacobi_transp.end2(); ++it1b) {</div>
<div class="line"><span class="lineno">  727</span>                <span class="keywordflow">if</span> (it1b.index2() &lt;= it1.index2())</div>
<div class="line"><span class="lineno">  728</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  729</span>                Real ratio = Null&lt;Real&gt;();</div>
<div class="line"><span class="lineno">  730</span>                <span class="keywordflow">if</span> (it1.begin() != it1.end() &amp;&amp; it1b.begin() != it1b.end()) {</div>
<div class="line"><span class="lineno">  731</span>                    <span class="keywordtype">bool</span> dependent = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  732</span>                    <span class="keyword">auto</span> it2b = it1b.begin();</div>
<div class="line"><span class="lineno">  733</span>                    <span class="keywordflow">for</span> (<span class="keyword">auto</span> it2 = it1.begin(); it2 != it1.end() &amp;&amp; dependent; ++it2) {</div>
<div class="line"><span class="lineno">  734</span>                        <span class="keywordflow">if</span> (<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(*it2, 0.0, nOp))</div>
<div class="line"><span class="lineno">  735</span>                            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  736</span>                        <span class="keywordtype">bool</span> foundMatchingIndex = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  737</span>                        <span class="keywordflow">while</span> (it2b != it1b.end() &amp;&amp; it2b.index1() &lt;= it2.index1() &amp;&amp; dependent) {</div>
<div class="line"><span class="lineno">  738</span>                            <span class="keywordflow">if</span> (it2b.index1() &lt; it2.index1()) {</div>
<div class="line"><span class="lineno">  739</span>                                <span class="keywordflow">if</span> (!<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(*it2b, 0.0, nOp))</div>
<div class="line"><span class="lineno">  740</span>                                    dependent = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  741</span>                            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  742</span>                                foundMatchingIndex = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  743</span>                                <span class="keywordflow">if</span> (<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(*it2b, 0.0, nOp)) {</div>
<div class="line"><span class="lineno">  744</span>                                    dependent = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  745</span>                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ratio == Null&lt;Real&gt;()) {</div>
<div class="line"><span class="lineno">  746</span>                                    ratio = *it2b / *it2;</div>
<div class="line"><span class="lineno">  747</span>                                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(*it2b / *it2, ratio, nOp)) {</div>
<div class="line"><span class="lineno">  748</span>                                    dependent = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  749</span>                                }</div>
<div class="line"><span class="lineno">  750</span>                            }</div>
<div class="line"><span class="lineno">  751</span>                            ++it2b;</div>
<div class="line"><span class="lineno">  752</span>                        }</div>
<div class="line"><span class="lineno">  753</span>                        <span class="keywordflow">if</span> (!foundMatchingIndex)</div>
<div class="line"><span class="lineno">  754</span>                            dependent = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  755</span>                    }</div>
<div class="line"><span class="lineno">  756</span>                    <span class="keywordflow">while</span> (it2b != it1b.end() &amp;&amp; dependent) {</div>
<div class="line"><span class="lineno">  757</span>                        <span class="keywordflow">if</span> (!<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a>(*it2b, 0.0))</div>
<div class="line"><span class="lineno">  758</span>                            dependent = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  759</span>                        ++it2b;</div>
<div class="line"><span class="lineno">  760</span>                    }</div>
<div class="line"><span class="lineno">  761</span>                    <span class="keywordflow">if</span> (dependent) {</div>
<div class="line"><span class="lineno">  762</span>                        <a class="code hl_defineRef" href="../ored/log_8hpp.html#a9622ca943201e814041f051b7a10b3ea">WLOG</a>(<span class="stringliteral">&quot;columns &quot;</span> &lt;&lt; it1.index2() &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; it1b.index2() &lt;&lt; <span class="stringliteral">&quot; are linearly dependent.&quot;</span>);</div>
<div class="line"><span class="lineno">  763</span>                    }</div>
<div class="line"><span class="lineno">  764</span>                }</div>
<div class="line"><span class="lineno">  765</span>            }</div>
<div class="line"><span class="lineno">  766</span>        }</div>
<div class="line"><span class="lineno">  767</span>        <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Extended matrix diagnostics done. Exiting application.&quot;</span>);</div>
<div class="line"><span class="lineno">  768</span>        success = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  769</span>    }</div>
<div class="line"><span class="lineno">  770</span>    QL_REQUIRE(success, <span class="stringliteral">&quot;Jacobi matrix inversion failed, see log file for more details.&quot;</span>);</div>
<div class="line"><span class="lineno">  771</span>    Real conditionNumber = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a57915895a401fce0143d3570f2320b26">modifiedMaxNorm</a>(jacobi_transp) * <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a57915895a401fce0143d3570f2320b26">modifiedMaxNorm</a>(<a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#ab306f203cbdc63e4fd60be53cc526eed">jacobi_transp_inv_</a>);</div>
<div class="line"><span class="lineno">  772</span>    <a class="code hl_defineRef" href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Inverse Jacobi done, condition number of Jacobi matrix is &quot;</span> &lt;&lt; conditionNumber);</div>
<div class="line"><span class="lineno">  773</span>    <a class="code hl_defineRef" href="../ored/log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Diagonal entries of Jacobi and inverse Jacobi:&quot;</span>);</div>
<div class="line"><span class="lineno">  774</span>    <a class="code hl_defineRef" href="../ored/log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;row/col              Jacobi             Inverse&quot;</span>);</div>
<div class="line"><span class="lineno">  775</span>    <span class="keywordflow">for</span> (Size j = 0; j &lt; jacobi_transp.size1(); ++j) {</div>
<div class="line"><span class="lineno">  776</span>        <a class="code hl_defineRef" href="../ored/log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(right &lt;&lt; setw(7) &lt;&lt; j &lt;&lt; setw(20) &lt;&lt; jacobi_transp(j, j) &lt;&lt; setw(20) &lt;&lt; <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#ab306f203cbdc63e4fd60be53cc526eed">jacobi_transp_inv_</a>(j, j));</div>
<div class="line"><span class="lineno">  777</span>    }</div>
<div class="line"><span class="lineno">  778</span>}</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_par_sensitivity_converter_html_a15fe2fc674e73073ae204c67beec98af"><div class="ttname"><a href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a15fe2fc674e73073ae204c67beec98af">ore::analytics::ParSensitivityConverter::parKeys_</a></div><div class="ttdeci">std::set&lt; ore::analytics::RiskFactorKey &gt; parKeys_</div><div class="ttdef"><b>Definition:</b> <a href="orea_2engine_2parsensitivityanalysis_8hpp_source.html#l00221">parsensitivityanalysis.hpp:221</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_par_sensitivity_converter_html_a5ed87ee8270263d0f1d6dff7a6403951"><div class="ttname"><a href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">ore::analytics::ParSensitivityConverter::rawKeys_</a></div><div class="ttdeci">std::set&lt; ore::analytics::RiskFactorKey &gt; rawKeys_</div><div class="ttdef"><b>Definition:</b> <a href="orea_2engine_2parsensitivityanalysis_8hpp_source.html#l00220">parsensitivityanalysis.hpp:220</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_par_sensitivity_converter_html_a5f9d36a1e4e25450af27f6c9dda92422"><div class="ttname"><a href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5f9d36a1e4e25450af27f6c9dda92422">ore::analytics::ParSensitivityConverter::zeroShifts_</a></div><div class="ttdeci">boost::numeric::ublas::vector&lt; QuantLib::Real &gt; zeroShifts_</div><div class="ttdoc">Vector of absolute zero shift sizes.</div><div class="ttdef"><b>Definition:</b> <a href="orea_2engine_2parsensitivityanalysis_8hpp_source.html#l00225">parsensitivityanalysis.hpp:225</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_par_sensitivity_converter_html_a8c2b75a426c1695a539acc6cb266fc51"><div class="ttname"><a href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a8c2b75a426c1695a539acc6cb266fc51">ore::analytics::ParSensitivityConverter::parShifts_</a></div><div class="ttdeci">boost::numeric::ublas::vector&lt; QuantLib::Real &gt; parShifts_</div><div class="ttdoc">Vector of absolute par shift sizes.</div><div class="ttdef"><b>Definition:</b> <a href="orea_2engine_2parsensitivityanalysis_8hpp_source.html#l00227">parsensitivityanalysis.hpp:227</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_par_sensitivity_converter_html_ab306f203cbdc63e4fd60be53cc526eed"><div class="ttname"><a href="classore_1_1analytics_1_1_par_sensitivity_converter.html#ab306f203cbdc63e4fd60be53cc526eed">ore::analytics::ParSensitivityConverter::jacobi_transp_inv_</a></div><div class="ttdeci">QuantLib::SparseMatrix jacobi_transp_inv_</div><div class="ttdef"><b>Definition:</b> <a href="orea_2engine_2parsensitivityanalysis_8hpp_source.html#l00223">parsensitivityanalysis.hpp:223</a></div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_risk_factor_key_html_aab0feaba617470cb4aa830dc5935238ca6adf97f83acf6453d4a6a4b1070f3754"><div class="ttname"><a href="classore_1_1analytics_1_1_risk_factor_key.html#aab0feaba617470cb4aa830dc5935238ca6adf97f83acf6453d4a6a4b1070f3754">ore::analytics::RiskFactorKey::KeyType::None</a></div><div class="ttdeci">@ None</div></div>
<div class="ttc" id="aclassore_1_1analytics_1_1_structured_analytics_error_message_html"><div class="ttname"><a href="classore_1_1analytics_1_1_structured_analytics_error_message.html">ore::analytics::StructuredAnalyticsErrorMessage</a></div><div class="ttdef"><b>Definition:</b> <a href="structuredanalyticserror_8hpp_source.html#l00031">structuredanalyticserror.hpp:31</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_j_s_o_n_message_html_a5e21eca2668ed948bdc409b19a78e5bb"><div class="ttname"><a href="../ored/classore_1_1data_1_1_j_s_o_n_message.html#a5e21eca2668ed948bdc409b19a78e5bb">ore::data::JSONMessage::log</a></div><div class="ttdeci">void log() const</div></div>
<div class="ttc" id="alog_8hpp_html_a158e0f085ddedfe5c8ed069986039f50"><div class="ttname"><a href="../ored/log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a></div><div class="ttdeci">#define LOG(text)</div></div>
<div class="ttc" id="alog_8hpp_html_a34c7c8cde9b91d2eee82d7b9a0b66fd5"><div class="ttname"><a href="../ored/log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a></div><div class="ttdeci">#define DLOG(text)</div></div>
<div class="ttc" id="alog_8hpp_html_a35cb05f674d9e764ca12cff351b064f2"><div class="ttname"><a href="../ored/log_8hpp.html#a35cb05f674d9e764ca12cff351b064f2">ALOG</a></div><div class="ttdeci">#define ALOG(text)</div></div>
<div class="ttc" id="alog_8hpp_html_a9622ca943201e814041f051b7a10b3ea"><div class="ttname"><a href="../ored/log_8hpp.html#a9622ca943201e814041f051b7a10b3ea">WLOG</a></div><div class="ttdeci">#define WLOG(text)</div></div>
<div class="ttc" id="alog_8hpp_html_a99aeca53f904c71a68070e1f9d310232"><div class="ttname"><a href="../ored/log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a></div><div class="ttdeci">#define TLOG(text)</div></div>
<div class="ttc" id="anamespace_quant_ext_html_a1cab4fb6a720eff245acb9f3a7a9e7c5"><div class="ttname"><a href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5">close_enough</a></div><div class="ttdeci">Filter close_enough(const RandomVariable &amp;x, const RandomVariable &amp;y)</div></div>
<div class="ttc" id="anamespace_quant_ext_html_a57915895a401fce0143d3570f2320b26"><div class="ttname"><a href="../qle/namespace_quant_ext.html#a57915895a401fce0143d3570f2320b26">QuantExt::modifiedMaxNorm</a></div><div class="ttdeci">Real modifiedMaxNorm(const QuantLib::SparseMatrix &amp;A)</div></div>
<div class="ttc" id="anamespace_quant_ext_html_a923d909efec4ac21f85e7754efd389e1"><div class="ttname"><a href="../qle/namespace_quant_ext.html#a923d909efec4ac21f85e7754efd389e1">QuantExt::blockMatrixInverse</a></div><div class="ttdeci">Matrix blockMatrixInverse(const Matrix &amp;A, const std::vector&lt; Size &gt; &amp;blockIndices)</div></div>
</div><!-- fragment --><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_par_sensitivity_converter_a8c2afda8c72547917b246769f04ee152_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_par_sensitivity_converter_a8c2afda8c72547917b246769f04ee152_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_par_sensitivity_converter_a8c2afda8c72547917b246769f04ee152_cgraph" id="aclassore_1_1analytics_1_1_par_sensitivity_converter_a8c2afda8c72547917b246769f04ee152_cgraph">
<area shape="rect" title=" " alt="" coords="5,80,160,105"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a923d909efec4ac21f85e7754efd389e1" title=" " alt="" coords="209,5,401,31"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a1cab4fb6a720eff245acb9f3a7a9e7c5" title=" " alt="" coords="253,55,356,80"/>
<area shape="rect" target="_parent" href="../ored/classore_1_1data_1_1_j_s_o_n_message.html#a5e21eca2668ed948bdc409b19a78e5bb" title=" " alt="" coords="208,104,401,129"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a57915895a401fce0143d3570f2320b26" title=" " alt="" coords="210,153,399,179"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aae1342ff44962b71bcc7fef74f22e168" name="aae1342ff44962b71bcc7fef74f22e168"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae1342ff44962b71bcc7fef74f22e168">&#9670;&#160;</a></span>rawKeys()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::set&lt; <a class="el" href="classore_1_1analytics_1_1_risk_factor_key.html">ore::analytics::RiskFactorKey</a> &gt; &amp; rawKeys </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inspectors. </p>
<p >Return the set of raw, i.e. zero, risk factor keys The ordering in this set defines the order of the columns in the Jacobi matrix </p>

<p class="definition">Definition at line <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html#l00187">187</a> of file <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html">parsensitivityanalysis.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  187</span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">rawKeys_</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a198e93051a59e5fbaaa229059c3ba44e" name="a198e93051a59e5fbaaa229059c3ba44e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a198e93051a59e5fbaaa229059c3ba44e">&#9670;&#160;</a></span>parKeys()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::set&lt; <a class="el" href="classore_1_1analytics_1_1_risk_factor_key.html">ore::analytics::RiskFactorKey</a> &gt; &amp; parKeys </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Return the set of par risk factor keys The ordering in this set defines the order of the rows in the Jacobi matrix </p>

<p class="definition">Definition at line <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html#l00190">190</a> of file <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html">parsensitivityanalysis.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  190</span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a15fe2fc674e73073ae204c67beec98af">parKeys_</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a5383f0ebf9907227d0d17426b695fbb6" name="a5383f0ebf9907227d0d17426b695fbb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5383f0ebf9907227d0d17426b695fbb6">&#9670;&#160;</a></span>convertSensitivity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boost::numeric::ublas::vector&lt; Real &gt; convertSensitivity </td>
          <td>(</td>
          <td class="paramtype">const boost::numeric::ublas::vector&lt; Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>zeroSensitivities</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Takes an array of zero sensitivities and returns an array of par sensitivities. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">zeroSensitivities</td><td>array of zero sensitivities ordered according to <a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#aae1342ff44962b71bcc7fef74f22e168" title="Inspectors.">rawKeys()</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array of par sensitivities ordered according to <a class="el" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a198e93051a59e5fbaaa229059c3ba44e">parKeys()</a></dd></dl>

<p class="definition">Definition at line <a class="el" href="orea_2engine_2parsensitivityanalysis_8cpp_source.html#l00781">781</a> of file <a class="el" href="orea_2engine_2parsensitivityanalysis_8cpp_source.html">parsensitivityanalysis.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  781</span>                                                                                                  {</div>
<div class="line"><span class="lineno">  782</span> </div>
<div class="line"><span class="lineno">  783</span>    <a class="code hl_defineRef" href="../ored/log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Start sensitivity conversion&quot;</span>);</div>
<div class="line"><span class="lineno">  784</span> </div>
<div class="line"><span class="lineno">  785</span>    Size dim = zeroSensitivities.size();</div>
<div class="line"><span class="lineno">  786</span>    QL_REQUIRE(<a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#ab306f203cbdc63e4fd60be53cc526eed">jacobi_transp_inv_</a>.size1() == dim, <span class="stringliteral">&quot;Size mismatch between Transoposed Jacobi inverse matrix [&quot;</span></div>
<div class="line"><span class="lineno">  787</span>                                                      &lt;&lt; <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#ab306f203cbdc63e4fd60be53cc526eed">jacobi_transp_inv_</a>.size1() &lt;&lt; <span class="stringliteral">&quot; x &quot;</span></div>
<div class="line"><span class="lineno">  788</span>                                                      &lt;&lt; <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#ab306f203cbdc63e4fd60be53cc526eed">jacobi_transp_inv_</a>.size2() &lt;&lt; <span class="stringliteral">&quot;] and zero sensitivity array [&quot;</span></div>
<div class="line"><span class="lineno">  789</span>                                                      &lt;&lt; dim &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>);</div>
<div class="line"><span class="lineno">  790</span> </div>
<div class="line"><span class="lineno">  791</span>    <span class="comment">// Vector storing approximation for \frac{\partial V}{\partial z_i} for each zero factor z_i</span></div>
<div class="line"><span class="lineno">  792</span>    boost::numeric::ublas::vector&lt;Real&gt; zeroDerivs(dim);</div>
<div class="line"><span class="lineno">  793</span>    zeroDerivs = element_div(zeroSensitivities, <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5f9d36a1e4e25450af27f6c9dda92422">zeroShifts_</a>);</div>
<div class="line"><span class="lineno">  794</span> </div>
<div class="line"><span class="lineno">  795</span>    <span class="comment">// Vector initially storing approximation for \frac{\partial V}{\partial c_i} for each par factor c_i</span></div>
<div class="line"><span class="lineno">  796</span>    boost::numeric::ublas::vector&lt;Real&gt; parSensitivities(dim);</div>
<div class="line"><span class="lineno">  797</span>    boost::numeric::ublas::axpy_prod(<a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#ab306f203cbdc63e4fd60be53cc526eed">jacobi_transp_inv_</a>, zeroDerivs, parSensitivities, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  798</span> </div>
<div class="line"><span class="lineno">  799</span>    <span class="comment">// Update parSensitivities vector to hold the first order approximation of the NPV change due to the configured</span></div>
<div class="line"><span class="lineno">  800</span>    <span class="comment">// shift in each of the par factors c_i</span></div>
<div class="line"><span class="lineno">  801</span>    parSensitivities = element_prod(parSensitivities, <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a8c2b75a426c1695a539acc6cb266fc51">parShifts_</a>);</div>
<div class="line"><span class="lineno">  802</span> </div>
<div class="line"><span class="lineno">  803</span>    <a class="code hl_defineRef" href="../ored/log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Sensitivity conversion done&quot;</span>);</div>
<div class="line"><span class="lineno">  804</span> </div>
<div class="line"><span class="lineno">  805</span>    <span class="keywordflow">return</span> parSensitivities;</div>
<div class="line"><span class="lineno">  806</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a154d8f197dfa11c3d9fe32159e3a355b" name="a154d8f197dfa11c3d9fe32159e3a355b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a154d8f197dfa11c3d9fe32159e3a355b">&#9670;&#160;</a></span>writeConversionMatrix()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void writeConversionMatrix </td>
          <td>(</td>
          <td class="paramtype"><a class="elRef" href="../ored/classore_1_1data_1_1_report.html">ore::data::Report</a> &amp;&#160;</td>
          <td class="paramname"><em>reportOut</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write the inverse of the transposed Jacobian to the <code>reportOut</code>. </p>

<p class="definition">Definition at line <a class="el" href="orea_2engine_2parsensitivityanalysis_8cpp_source.html#l00808">808</a> of file <a class="el" href="orea_2engine_2parsensitivityanalysis_8cpp_source.html">parsensitivityanalysis.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  808</span>                                                                        {</div>
<div class="line"><span class="lineno">  809</span> </div>
<div class="line"><span class="lineno">  810</span>    <span class="comment">// Report headers</span></div>
<div class="line"><span class="lineno">  811</span>    report.addColumn(<span class="stringliteral">&quot;RawFactor(z)&quot;</span>, <span class="keywordtype">string</span>());</div>
<div class="line"><span class="lineno">  812</span>    report.addColumn(<span class="stringliteral">&quot;ParFactor(c)&quot;</span>, <span class="keywordtype">string</span>());</div>
<div class="line"><span class="lineno">  813</span>    report.addColumn(<span class="stringliteral">&quot;dz/dc&quot;</span>, <span class="keywordtype">double</span>(), 12);</div>
<div class="line"><span class="lineno">  814</span> </div>
<div class="line"><span class="lineno">  815</span>    <span class="comment">// Write report contents i.e. entries where sparse matrix is non-zero</span></div>
<div class="line"><span class="lineno">  816</span>    Size parIdx = 0;</div>
<div class="line"><span class="lineno">  817</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; parKey : <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a15fe2fc674e73073ae204c67beec98af">parKeys_</a>) {</div>
<div class="line"><span class="lineno">  818</span>        Size rawIdx = 0;</div>
<div class="line"><span class="lineno">  819</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; rawKey : <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">rawKeys_</a>) {</div>
<div class="line"><span class="lineno">  820</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceore_1_1analytics.html#a1d01daebcd210546f1784785760fb64e">close</a>(<a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#ab306f203cbdc63e4fd60be53cc526eed">jacobi_transp_inv_</a>(parIdx, rawIdx), 0.0)) {</div>
<div class="line"><span class="lineno">  821</span>                report.next();</div>
<div class="line"><span class="lineno">  822</span>                report.add(<a class="code hl_functionRef" href="../ored/namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">to_string</a>(rawKey));</div>
<div class="line"><span class="lineno">  823</span>                report.add(<a class="code hl_functionRef" href="../ored/namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">to_string</a>(parKey));</div>
<div class="line"><span class="lineno">  824</span>                report.add(<a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#ab306f203cbdc63e4fd60be53cc526eed">jacobi_transp_inv_</a>(parIdx, rawIdx));</div>
<div class="line"><span class="lineno">  825</span>            }</div>
<div class="line"><span class="lineno">  826</span>            rawIdx++;</div>
<div class="line"><span class="lineno">  827</span>        }</div>
<div class="line"><span class="lineno">  828</span>        parIdx++;</div>
<div class="line"><span class="lineno">  829</span>    }</div>
<div class="line"><span class="lineno">  830</span> </div>
<div class="line"><span class="lineno">  831</span>    <span class="comment">// Close report</span></div>
<div class="line"><span class="lineno">  832</span>    report.end();</div>
<div class="line"><span class="lineno">  833</span>}</div>
<div class="ttc" id="anamespaceore_1_1analytics_html_a1d01daebcd210546f1784785760fb64e"><div class="ttname"><a href="namespaceore_1_1analytics.html#a1d01daebcd210546f1784785760fb64e">ore::analytics::close</a></div><div class="ttdeci">bool close(const Real &amp;t_1, const Real &amp;t_2)</div><div class="ttdef"><b>Definition:</b> <a href="sensitivityscenariogenerator_8cpp_source.html#l00079">sensitivityscenariogenerator.cpp:79</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a86651dfeb5c18ee891f7a4734d8cf455"><div class="ttname"><a href="../ored/namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">to_string</a></div><div class="ttdeci">std::string to_string(const LocationInfo &amp;l)</div></div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1analytics_1_1_par_sensitivity_converter_a154d8f197dfa11c3d9fe32159e3a355b_cgraph.png" border="0" usemap="#aclassore_1_1analytics_1_1_par_sensitivity_converter_a154d8f197dfa11c3d9fe32159e3a355b_cgraph" alt=""/></div>
<map name="aclassore_1_1analytics_1_1_par_sensitivity_converter_a154d8f197dfa11c3d9fe32159e3a355b_cgraph" id="aclassore_1_1analytics_1_1_par_sensitivity_converter_a154d8f197dfa11c3d9fe32159e3a355b_cgraph">
<area shape="rect" title="Write the inverse of the transposed Jacobian to the reportOut." alt="" coords="5,169,153,195"/>
<area shape="rect" target="_parent" href="../ored/classore_1_1data_1_1_report.html#a1abd2a390257bb4c7151a4014d7c9e9b" title=" " alt="" coords="203,5,351,31"/>
<area shape="rect" target="_parent" href="../ored/classore_1_1data_1_1_report.html#ad6bf9a73eddcb8473dd7139d8b083e6a" title=" " alt="" coords="214,55,341,95"/>
<area shape="rect" href="namespaceore_1_1analytics.html#a1d01daebcd210546f1784785760fb64e" title=" " alt="" coords="208,144,347,169"/>
<area shape="rect" target="_parent" href="../ored/classore_1_1data_1_1_report.html#aa540e86022c1f72380d1014d98f38f43" title=" " alt="" coords="203,193,351,219"/>
<area shape="rect" target="_parent" href="../ored/classore_1_1data_1_1_report.html#a69c56d981466b25cc95c3e3f5ecdb30b" title=" " alt="" coords="201,243,353,268"/>
<area shape="rect" target="_parent" href="../ored/namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455" title=" " alt="" coords="241,292,313,317"/>
</map>
</div>

</div>
</div>
<a id="adfa161443de774ad0ae35a4bb75ebbe7" name="adfa161443de774ad0ae35a4bb75ebbe7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfa161443de774ad0ae35a4bb75ebbe7">&#9670;&#160;</a></span>inverseJacobian()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classore_1_1analytics_1_1_par_sensitivity_analysis.html#abe637de864ef34aa2842b582cf4680b4">ParSensitivityAnalysis::ParContainer</a> inverseJacobian </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html#l00206">206</a> of file <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html">parsensitivityanalysis.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  206</span>                                                               { <a class="code hl_typedef" href="classore_1_1analytics_1_1_par_sensitivity_analysis.html#abe637de864ef34aa2842b582cf4680b4">ParSensitivityAnalysis::ParContainer</a> results;</div>
<div class="line"><span class="lineno">  207</span>        Size parIdx = 0;</div>
<div class="line"><span class="lineno">  208</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; parKey : <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a15fe2fc674e73073ae204c67beec98af">parKeys_</a>) {</div>
<div class="line"><span class="lineno">  209</span>            Size rawIdx = 0;</div>
<div class="line"><span class="lineno">  210</span>            <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; rawKey : <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#a5ed87ee8270263d0f1d6dff7a6403951">rawKeys_</a>) {</div>
<div class="line"><span class="lineno">  211</span>                results[{rawKey, parKey}] = <a class="code hl_variable" href="classore_1_1analytics_1_1_par_sensitivity_converter.html#ab306f203cbdc63e4fd60be53cc526eed">jacobi_transp_inv_</a>(parIdx, rawIdx);</div>
<div class="line"><span class="lineno">  212</span>                rawIdx++;</div>
<div class="line"><span class="lineno">  213</span>            }</div>
<div class="line"><span class="lineno">  214</span>            parIdx++;</div>
<div class="line"><span class="lineno">  215</span>        }</div>
<div class="line"><span class="lineno">  216</span>        <span class="keywordflow">return</span> results;</div>
<div class="line"><span class="lineno">  217</span>    }</div>
<div class="ttc" id="aclassore_1_1analytics_1_1_par_sensitivity_analysis_html_abe637de864ef34aa2842b582cf4680b4"><div class="ttname"><a href="classore_1_1analytics_1_1_par_sensitivity_analysis.html#abe637de864ef34aa2842b582cf4680b4">ore::analytics::ParSensitivityAnalysis::ParContainer</a></div><div class="ttdeci">std::map&lt; std::pair&lt; ore::analytics::RiskFactorKey, ore::analytics::RiskFactorKey &gt;, Real &gt; ParContainer</div><div class="ttdef"><b>Definition:</b> <a href="orea_2engine_2parsensitivityanalysis_8hpp_source.html#l00059">parsensitivityanalysis.hpp:59</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a5ed87ee8270263d0f1d6dff7a6403951" name="a5ed87ee8270263d0f1d6dff7a6403951"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ed87ee8270263d0f1d6dff7a6403951">&#9670;&#160;</a></span>rawKeys_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::set&lt;<a class="el" href="classore_1_1analytics_1_1_risk_factor_key.html">ore::analytics::RiskFactorKey</a>&gt; rawKeys_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html#l00220">220</a> of file <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html">parsensitivityanalysis.hpp</a>.</p>

</div>
</div>
<a id="a15fe2fc674e73073ae204c67beec98af" name="a15fe2fc674e73073ae204c67beec98af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15fe2fc674e73073ae204c67beec98af">&#9670;&#160;</a></span>parKeys_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::set&lt;<a class="el" href="classore_1_1analytics_1_1_risk_factor_key.html">ore::analytics::RiskFactorKey</a>&gt; parKeys_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html#l00221">221</a> of file <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html">parsensitivityanalysis.hpp</a>.</p>

</div>
</div>
<a id="ab306f203cbdc63e4fd60be53cc526eed" name="ab306f203cbdc63e4fd60be53cc526eed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab306f203cbdc63e4fd60be53cc526eed">&#9670;&#160;</a></span>jacobi_transp_inv_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::SparseMatrix jacobi_transp_inv_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html#l00223">223</a> of file <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html">parsensitivityanalysis.hpp</a>.</p>

</div>
</div>
<a id="a5f9d36a1e4e25450af27f6c9dda92422" name="a5f9d36a1e4e25450af27f6c9dda92422"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f9d36a1e4e25450af27f6c9dda92422">&#9670;&#160;</a></span>zeroShifts_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::numeric::ublas::vector&lt;QuantLib::Real&gt; zeroShifts_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Vector of absolute zero shift sizes. </p>

<p class="definition">Definition at line <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html#l00225">225</a> of file <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html">parsensitivityanalysis.hpp</a>.</p>

</div>
</div>
<a id="a8c2b75a426c1695a539acc6cb266fc51" name="a8c2b75a426c1695a539acc6cb266fc51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c2b75a426c1695a539acc6cb266fc51">&#9670;&#160;</a></span>parShifts_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::numeric::ublas::vector&lt;QuantLib::Real&gt; parShifts_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Vector of absolute par shift sizes. </p>

<p class="definition">Definition at line <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html#l00227">227</a> of file <a class="el" href="orea_2engine_2parsensitivityanalysis_8hpp_source.html">parsensitivityanalysis.hpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.9.5
</small></address>
</body>
</html>
