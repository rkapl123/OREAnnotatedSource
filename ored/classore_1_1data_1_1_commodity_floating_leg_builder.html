<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<title>OREData: CommodityFloatingLegBuilder Class Reference</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="oredextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-data@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.8.12</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceore.html">ore</a></li><li class="navelem"><a class="el" href="namespaceore_1_1data.html">data</a></li><li class="navelem"><a class="el" href="classore_1_1data_1_1_commodity_floating_leg_builder.html">CommodityFloatingLegBuilder</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classore_1_1data_1_1_commodity_floating_leg_builder-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">CommodityFloatingLegBuilder Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="commoditylegbuilder_8hpp_source.html">ored/portfolio/commoditylegbuilder.hpp</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for CommodityFloatingLegBuilder:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="classore_1_1data_1_1_commodity_floating_leg_builder__inherit__graph.svg" width="230" height="271"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for CommodityFloatingLegBuilder:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="classore_1_1data_1_1_commodity_floating_leg_builder__coll__graph.svg" width="274" height="448"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a77363b01e951735407a4c990f37e82e4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_floating_leg_builder.html#a77363b01e951735407a4c990f37e82e4">CommodityFloatingLegBuilder</a> ()</td></tr>
<tr class="separator:a77363b01e951735407a4c990f37e82e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e327fffe1588e7813e797d48b1b3420"><td class="memItemLeft" align="right" valign="top">QuantLib::Leg&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_floating_leg_builder.html#a1e327fffe1588e7813e797d48b1b3420">buildLeg</a> (const <a class="el" href="classore_1_1data_1_1_leg_data.html">ore::data::LegData</a> &amp;data, const QuantLib::ext::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_engine_factory.html">ore::data::EngineFactory</a> &gt; &amp;engineFactory, <a class="el" href="classore_1_1data_1_1_required_fixings.html">RequiredFixings</a> &amp;requiredFixings, const std::string &amp;configuration, const QuantLib::Date &amp;openEndDateReplacement=Null&lt; Date &gt;(), const <a class="el" href="classbool.html">bool</a> useXbsCurves=false) const override</td></tr>
<tr class="separator:a1e327fffe1588e7813e797d48b1b3420"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a989cbb8940a8e987c1fff598360c86f2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_floating_leg_builder.html#a989cbb8940a8e987c1fff598360c86f2">allAveraging</a> () const</td></tr>
<tr class="memdesc:a989cbb8940a8e987c1fff598360c86f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inspect the <code>allAveraging_</code> flag.  <a href="classore_1_1data_1_1_commodity_floating_leg_builder.html#a989cbb8940a8e987c1fff598360c86f2">More...</a><br /></td></tr>
<tr class="separator:a989cbb8940a8e987c1fff598360c86f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classore_1_1data_1_1_leg_builder"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classore_1_1data_1_1_leg_builder')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classore_1_1data_1_1_leg_builder.html">LegBuilder</a></td></tr>
<tr class="memitem:ab3129c8aad43795d77fdf7823381aae1 inherit pub_methods_classore_1_1data_1_1_leg_builder"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_leg_builder.html#ab3129c8aad43795d77fdf7823381aae1">LegBuilder</a> (const string &amp;<a class="el" href="classore_1_1data_1_1_leg_builder.html#a81b9d9c795e1f72812f0da9b14382f4a">legType</a>)</td></tr>
<tr class="separator:ab3129c8aad43795d77fdf7823381aae1 inherit pub_methods_classore_1_1data_1_1_leg_builder"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b9c705693c5448c57c94d2d695f313f inherit pub_methods_classore_1_1data_1_1_leg_builder"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_leg_builder.html#a7b9c705693c5448c57c94d2d695f313f">~LegBuilder</a> ()</td></tr>
<tr class="separator:a7b9c705693c5448c57c94d2d695f313f inherit pub_methods_classore_1_1data_1_1_leg_builder"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0df530ae380e6002bb20d3c4009951f3 inherit pub_methods_classore_1_1data_1_1_leg_builder"><td class="memItemLeft" align="right" valign="top">virtual Leg&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_leg_builder.html#a0df530ae380e6002bb20d3c4009951f3">buildLeg</a> (const <a class="el" href="classore_1_1data_1_1_leg_data.html">LegData</a> &amp;data, const QuantLib::ext::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_engine_factory.html">EngineFactory</a> &gt; &amp;, <a class="el" href="classore_1_1data_1_1_required_fixings.html">RequiredFixings</a> &amp;requiredFixings, const string &amp;configuration, const QuantLib::Date &amp;openEndDateReplacement=Null&lt; Date &gt;(), const <a class="el" href="classbool.html">bool</a> useXbsCurves=false) const =0</td></tr>
<tr class="separator:a0df530ae380e6002bb20d3c4009951f3 inherit pub_methods_classore_1_1data_1_1_leg_builder"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81b9d9c795e1f72812f0da9b14382f4a inherit pub_methods_classore_1_1data_1_1_leg_builder"><td class="memItemLeft" align="right" valign="top">const string &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_leg_builder.html#a81b9d9c795e1f72812f0da9b14382f4a">legType</a> () const</td></tr>
<tr class="separator:a81b9d9c795e1f72812f0da9b14382f4a inherit pub_methods_classore_1_1data_1_1_leg_builder"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a80c11faffb1ad959cf6499976d026664"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classbool.html">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_floating_leg_builder.html#a80c11faffb1ad959cf6499976d026664">allAveraging_</a></td></tr>
<tr class="separator:a80c11faffb1ad959cf6499976d026664"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="commoditylegbuilder_8hpp_source.html#l00044">44</a> of file <a class="el" href="commoditylegbuilder_8hpp_source.html">commoditylegbuilder.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a77363b01e951735407a4c990f37e82e4" name="a77363b01e951735407a4c990f37e82e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77363b01e951735407a4c990f37e82e4">&#9670;&#160;</a></span>CommodityFloatingLegBuilder()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classore_1_1data_1_1_commodity_floating_leg_builder.html">CommodityFloatingLegBuilder</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commoditylegbuilder_8hpp_source.html#l00046">46</a> of file <a class="el" href="commoditylegbuilder_8hpp_source.html">commoditylegbuilder.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   47</span>        : <a class="code hl_function" href="classore_1_1data_1_1_leg_builder.html#ab3129c8aad43795d77fdf7823381aae1">LegBuilder</a>(<span class="stringliteral">&quot;CommodityFloating&quot;</span>), <a class="code hl_variable" href="classore_1_1data_1_1_commodity_floating_leg_builder.html#a80c11faffb1ad959cf6499976d026664">allAveraging_</a>(<span class="keyword">false</span>) {}</div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_floating_leg_builder_html_a80c11faffb1ad959cf6499976d026664"><div class="ttname"><a href="classore_1_1data_1_1_commodity_floating_leg_builder.html#a80c11faffb1ad959cf6499976d026664">ore::data::CommodityFloatingLegBuilder::allAveraging_</a></div><div class="ttdeci">bool allAveraging_</div><div class="ttdef"><b>Definition:</b> <a href="commoditylegbuilder_8hpp_source.html#l00062">commoditylegbuilder.hpp:62</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_leg_builder_html_ab3129c8aad43795d77fdf7823381aae1"><div class="ttname"><a href="classore_1_1data_1_1_leg_builder.html#ab3129c8aad43795d77fdf7823381aae1">ore::data::LegBuilder::LegBuilder</a></div><div class="ttdeci">LegBuilder(const string &amp;legType)</div><div class="ttdef"><b>Definition:</b> <a href="enginefactory_8hpp_source.html#l00307">enginefactory.hpp:307</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a1e327fffe1588e7813e797d48b1b3420" name="a1e327fffe1588e7813e797d48b1b3420"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e327fffe1588e7813e797d48b1b3420">&#9670;&#160;</a></span>buildLeg()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Leg buildLeg </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_leg_data.html">ore::data::LegData</a> &amp;&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const QuantLib::ext::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_engine_factory.html">ore::data::EngineFactory</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>engineFactory</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classore_1_1data_1_1_required_fixings.html">RequiredFixings</a> &amp;&#160;</td>
          <td class="paramname"><em>requiredFixings</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>configuration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>openEndDateReplacement</em> = <code>Null&lt;Date&gt;()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>useXbsCurves</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commoditylegbuilder_8cpp_source.html#l00411">411</a> of file <a class="el" href="commoditylegbuilder_8cpp_source.html">commoditylegbuilder.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  413</span>                                                                                                                     {</div>
<div class="line"><span class="lineno">  414</span> </div>
<div class="line"><span class="lineno">  415</span>    <span class="comment">// allAveraging_ flag should be reset to false before each build. If we do not do this, the allAveraging_</span></div>
<div class="line"><span class="lineno">  416</span>    <span class="comment">// flag may have been set from building a different leg previously</span></div>
<div class="line"><span class="lineno">  417</span>    <a class="code hl_variable" href="classore_1_1data_1_1_commodity_floating_leg_builder.html#a80c11faffb1ad959cf6499976d026664">allAveraging_</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  418</span> </div>
<div class="line"><span class="lineno">  419</span>    <span class="keyword">auto</span> floatingLegData = QuantLib::ext::dynamic_pointer_cast&lt;CommodityFloatingLegData&gt;(<a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.concreteLegData());</div>
<div class="line"><span class="lineno">  420</span>    QL_REQUIRE(floatingLegData, <span class="stringliteral">&quot;Wrong LegType: expected CommodityFloating but got &quot;</span> &lt;&lt; <a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.legType());</div>
<div class="line"><span class="lineno">  421</span> </div>
<div class="line"><span class="lineno">  422</span>    <span class="comment">// Commodity name and its conventions.</span></div>
<div class="line"><span class="lineno">  423</span>    <span class="comment">// Default weekends only calendar used to create the &quot;index&quot;. Attempt to populate with sth sensible here.</span></div>
<div class="line"><span class="lineno">  424</span>    <span class="keywordtype">string</span> commName = floatingLegData-&gt;name();</div>
<div class="line"><span class="lineno">  425</span>    Calendar commCal = WeekendsOnly();</div>
<div class="line"><span class="lineno">  426</span>    QuantLib::ext::shared_ptr&lt;Conventions&gt; conventions = InstrumentConventions::instance().conventions();</div>
<div class="line"><span class="lineno">  427</span>    QuantLib::ext::shared_ptr&lt;CommodityFutureConvention&gt; commFutureConv;</div>
<div class="line"><span class="lineno">  428</span>    boost::optional&lt;pair&lt;Calendar, Real&gt;&gt; offPeakPowerData;</div>
<div class="line"><span class="lineno">  429</span>    <span class="keywordtype">bool</span> balanceOfTheMonth = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  430</span>    <span class="keywordflow">if</span> (conventions-&gt;has(commName)) {</div>
<div class="line"><span class="lineno">  431</span>        QuantLib::ext::shared_ptr&lt;Convention&gt; commConv = conventions-&gt;get(commName);</div>
<div class="line"><span class="lineno">  432</span> </div>
<div class="line"><span class="lineno">  433</span>        <span class="comment">// If commodity forward convention</span></div>
<div class="line"><span class="lineno">  434</span>        <span class="keywordflow">if</span> (<span class="keyword">auto</span> c = QuantLib::ext::dynamic_pointer_cast&lt;CommodityForwardConvention&gt;(commConv)) {</div>
<div class="line"><span class="lineno">  435</span>            <span class="keywordflow">if</span> (c-&gt;advanceCalendar() != NullCalendar()) {</div>
<div class="line"><span class="lineno">  436</span>                commCal = c-&gt;advanceCalendar();</div>
<div class="line"><span class="lineno">  437</span>            }</div>
<div class="line"><span class="lineno">  438</span>        }</div>
<div class="line"><span class="lineno">  439</span> </div>
<div class="line"><span class="lineno">  440</span>        <span class="comment">// If commodity future convention</span></div>
<div class="line"><span class="lineno">  441</span>        commFutureConv = QuantLib::ext::dynamic_pointer_cast&lt;CommodityFutureConvention&gt;(commConv);</div>
<div class="line"><span class="lineno">  442</span>        <span class="keywordflow">if</span> (commFutureConv) {</div>
<div class="line"><span class="lineno">  443</span>            balanceOfTheMonth = commFutureConv-&gt;balanceOfTheMonth();</div>
<div class="line"><span class="lineno">  444</span>            commCal = commFutureConv-&gt;calendar();</div>
<div class="line"><span class="lineno">  445</span>            <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; oppid = commFutureConv-&gt;offPeakPowerIndexData()) {</div>
<div class="line"><span class="lineno">  446</span>                offPeakPowerData = make_pair(oppid-&gt;peakCalendar(), oppid-&gt;offPeakHours());</div>
<div class="line"><span class="lineno">  447</span>            }</div>
<div class="line"><span class="lineno">  448</span>        }</div>
<div class="line"><span class="lineno">  449</span>    }</div>
<div class="line"><span class="lineno">  450</span> </div>
<div class="line"><span class="lineno">  451</span>    <span class="comment">// Get price type i.e. is the commodity floating leg referencing the spot price or a future settlement price.</span></div>
<div class="line"><span class="lineno">  452</span>    <a class="code hl_enumeration" href="namespaceore_1_1data.html#aaec25a9a272c33ea399fb9f2f839ecf7">CommodityPriceType</a> priceType = floatingLegData-&gt;priceType();</div>
<div class="line"><span class="lineno">  453</span> </div>
<div class="line"><span class="lineno">  454</span>    <span class="comment">// If referencing a future settlement price, we will need a valid FutureExpiryCalculator below.</span></div>
<div class="line"><span class="lineno">  455</span>    QuantLib::ext::shared_ptr&lt;FutureExpiryCalculator&gt; feCalc;</div>
<div class="line"><span class="lineno">  456</span>    <span class="keywordflow">if</span> (priceType == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#aaec25a9a272c33ea399fb9f2f839ecf7ab2726d1bfb080cc9e752a13ddef1631c">CommodityPriceType::FutureSettlement</a>) {</div>
<div class="line"><span class="lineno">  457</span> </div>
<div class="line"><span class="lineno">  458</span>        <span class="comment">// We should have a valid commodity future convention in this case but check anyway</span></div>
<div class="line"><span class="lineno">  459</span>        QL_REQUIRE(commFutureConv, <span class="stringliteral">&quot;Expected to have a commodity future convention for commodity &quot;</span> &lt;&lt; commName);</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>        feCalc = QuantLib::ext::make_shared&lt;ConventionsBasedFutureExpiry&gt;(*commFutureConv);</div>
<div class="line"><span class="lineno">  462</span> </div>
<div class="line"><span class="lineno">  463</span>        <span class="comment">// If the future contract is averaging but the trade is not averaging, we can&#39;t price the trade</span></div>
<div class="line"><span class="lineno">  464</span>        <span class="comment">// TODO: Should we just issue a warning here, switch the trade to averaging and price it?</span></div>
<div class="line"><span class="lineno">  465</span>        <span class="keywordflow">if</span> (commFutureConv-&gt;isAveraging()) {</div>
<div class="line"><span class="lineno">  466</span>            QL_REQUIRE(floatingLegData-&gt;isAveraged(),</div>
<div class="line"><span class="lineno">  467</span>                       <span class="stringliteral">&quot;The future, &quot;</span> &lt;&lt; commName &lt;&lt; <span class="stringliteral">&quot;, is averaging but the leg is not.&quot;</span>);</div>
<div class="line"><span class="lineno">  468</span>            <a class="code hl_variable" href="classore_1_1data_1_1_commodity_floating_leg_builder.html#a80c11faffb1ad959cf6499976d026664">allAveraging_</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  469</span>        }</div>
<div class="line"><span class="lineno">  470</span>    }</div>
<div class="line"><span class="lineno">  471</span> </div>
<div class="line"><span class="lineno">  472</span>    <span class="comment">// Construct the commodity index.</span></div>
<div class="line"><span class="lineno">  473</span>    Handle&lt;PriceTermStructure&gt; priceCurve = engineFactory-&gt;market()-&gt;commodityPriceCurve(commName, configuration);</div>
<div class="line"><span class="lineno">  474</span>    <span class="keyword">auto</span> index = <a class="code hl_function" href="namespaceore_1_1data.html#abd022b98516a69b335865f8c17a645cf">parseCommodityIndex</a>(commName, <span class="keyword">false</span>, priceCurve, NullCalendar(),</div>
<div class="line"><span class="lineno">  475</span>                                     priceType == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#aaec25a9a272c33ea399fb9f2f839ecf7ab2726d1bfb080cc9e752a13ddef1631c">CommodityPriceType::FutureSettlement</a>);</div>
<div class="line"><span class="lineno">  476</span> </div>
<div class="line"><span class="lineno">  477</span>    <span class="comment">// Get the commodity floating leg schedule and quantities</span></div>
<div class="line"><span class="lineno">  478</span>    Schedule schedule = <a class="code hl_function" href="namespaceore_1_1data.html#af158e922cf963a59228878344ca5858d">makeSchedule</a>(<a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.schedule());</div>
<div class="line"><span class="lineno">  479</span>    vector&lt;Real&gt; quantities =</div>
<div class="line"><span class="lineno">  480</span>        <a class="code hl_function" href="namespaceore_1_1data.html#a9206da3667d412d6992de0f3909beef2">buildScheduledVector</a>(floatingLegData-&gt;quantities(), floatingLegData-&gt;quantityDates(), schedule);</div>
<div class="line"><span class="lineno">  481</span> </div>
<div class="line"><span class="lineno">  482</span>    <span class="comment">// Get spreads and gearings which may be empty</span></div>
<div class="line"><span class="lineno">  483</span>    vector&lt;Real&gt; spreads = <a class="code hl_function" href="namespaceore_1_1data.html#a9206da3667d412d6992de0f3909beef2">buildScheduledVector</a>(floatingLegData-&gt;spreads(), floatingLegData-&gt;spreadDates(), schedule);</div>
<div class="line"><span class="lineno">  484</span>    vector&lt;Real&gt; gearings =</div>
<div class="line"><span class="lineno">  485</span>        <a class="code hl_function" href="namespaceore_1_1data.html#a9206da3667d412d6992de0f3909beef2">buildScheduledVector</a>(floatingLegData-&gt;gearings(), floatingLegData-&gt;gearingDates(), schedule);</div>
<div class="line"><span class="lineno">  486</span> </div>
<div class="line"><span class="lineno">  487</span>    <span class="comment">// Get explicit pricing dates which in most cases should be empty</span></div>
<div class="line"><span class="lineno">  488</span>    vector&lt;Date&gt; <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#ab0b32bc299eb03d1e3d53a2b97af52e7">pricingDates</a>;</div>
<div class="line"><span class="lineno">  489</span>    <span class="keywordflow">if</span> (!floatingLegData-&gt;pricingDates().empty()) {</div>
<div class="line"><span class="lineno">  490</span>        <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#ab0b32bc299eb03d1e3d53a2b97af52e7">pricingDates</a> = parseVectorOfValues&lt;Date&gt;(floatingLegData-&gt;pricingDates(), &amp;parseDate);</div>
<div class="line"><span class="lineno">  491</span>    }</div>
<div class="line"><span class="lineno">  492</span> </div>
<div class="line"><span class="lineno">  493</span>    <span class="comment">// Some common variables needed in building the commodity floating leg</span></div>
<div class="line"><span class="lineno">  494</span>    <a class="code hl_typedef" href="namespaceore_1_1data.html#ae005d902ae9b906517bf93ca8c77e595">PaymentLag</a> paymentLag = <a class="code hl_function" href="group__utilities.html#gaaccd32117e7bb7cbec793de579976cc8">parsePaymentLag</a>(<a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.paymentLag());</div>
<div class="line"><span class="lineno">  495</span>    BusinessDayConvention paymentConvention =</div>
<div class="line"><span class="lineno">  496</span>        <a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.paymentConvention().empty() ? Following : <a class="code hl_function" href="group__utilities.html#ga86adcf55f91e340ff40783964666e732">parseBusinessDayConvention</a>(<a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.paymentConvention());</div>
<div class="line"><span class="lineno">  497</span>    Calendar paymentCalendar =</div>
<div class="line"><span class="lineno">  498</span>        <a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.paymentCalendar().empty() ? schedule.calendar() : <a class="code hl_function" href="group__utilities.html#ga0f72d6fcccae10a674bdcd5095200f14">parseCalendar</a>(<a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.paymentCalendar());</div>
<div class="line"><span class="lineno">  499</span>    Calendar pricingCalendar;</div>
<div class="line"><span class="lineno">  500</span> </div>
<div class="line"><span class="lineno">  501</span>    <span class="comment">// Override missing pricing calendar with calendar from convention</span></div>
<div class="line"><span class="lineno">  502</span>    <span class="keywordflow">if</span> (floatingLegData-&gt;pricingCalendar().empty() &amp;&amp; floatingLegData-&gt;isAveraged() &amp;&amp; balanceOfTheMonth &amp;&amp;</div>
<div class="line"><span class="lineno">  503</span>        commFutureConv) {</div>
<div class="line"><span class="lineno">  504</span>        pricingCalendar = commFutureConv-&gt;balanceOfTheMonthPricingCalendar();</div>
<div class="line"><span class="lineno">  505</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (floatingLegData-&gt;pricingCalendar().empty()) {</div>
<div class="line"><span class="lineno">  506</span>        pricingCalendar = commCal;</div>
<div class="line"><span class="lineno">  507</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  508</span>        pricingCalendar = <a class="code hl_function" href="group__utilities.html#ga0f72d6fcccae10a674bdcd5095200f14">parseCalendar</a>(floatingLegData-&gt;pricingCalendar());</div>
<div class="line"><span class="lineno">  509</span>    }</div>
<div class="line"><span class="lineno">  510</span>         </div>
<div class="line"><span class="lineno">  511</span>    <span class="comment">// Get explicit payment dates which in most cases should be empty</span></div>
<div class="line"><span class="lineno">  512</span>    vector&lt;Date&gt; paymentDates;</div>
<div class="line"><span class="lineno">  513</span> </div>
<div class="line"><span class="lineno">  514</span>    </div>
<div class="line"><span class="lineno">  515</span>    Schedule paymentSchedule = <a class="code hl_function" href="namespaceore_1_1data.html#af158e922cf963a59228878344ca5858d">makeSchedule</a>(<a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.paymentSchedule(), openEndDateReplacement);</div>
<div class="line"><span class="lineno">  516</span>   </div>
<div class="line"><span class="lineno">  517</span>    <span class="keywordflow">if</span> (!paymentSchedule.empty()) {</div>
<div class="line"><span class="lineno">  518</span>        paymentDates = paymentSchedule.dates();</div>
<div class="line"><span class="lineno">  519</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.paymentDates().empty()) {</div>
<div class="line"><span class="lineno">  520</span>        BusinessDayConvention paymentDatesConvention =</div>
<div class="line"><span class="lineno">  521</span>            <a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.paymentConvention().empty() ? Unadjusted : <a class="code hl_function" href="group__utilities.html#ga86adcf55f91e340ff40783964666e732">parseBusinessDayConvention</a>(<a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.paymentConvention());</div>
<div class="line"><span class="lineno">  522</span>        Calendar paymentDatesCalendar =</div>
<div class="line"><span class="lineno">  523</span>            <a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.paymentCalendar().empty() ? NullCalendar() : <a class="code hl_function" href="group__utilities.html#ga0f72d6fcccae10a674bdcd5095200f14">parseCalendar</a>(<a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.paymentCalendar());</div>
<div class="line"><span class="lineno">  524</span>        paymentDates = parseVectorOfValues&lt;Date&gt;(<a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.paymentDates(), &amp;parseDate);</div>
<div class="line"><span class="lineno">  525</span>        <span class="keywordflow">for</span> (Size i = 0; i &lt; paymentDates.size(); i++)</div>
<div class="line"><span class="lineno">  526</span>            paymentDates[i] = paymentDatesCalendar.adjust(paymentDates[i], paymentDatesConvention);</div>
<div class="line"><span class="lineno">  527</span>    }</div>
<div class="line"><span class="lineno">  528</span> </div>
<div class="line"><span class="lineno">  529</span>    <span class="comment">// May need to poulate hours per day</span></div>
<div class="line"><span class="lineno">  530</span>    <span class="keyword">auto</span> hoursPerDay = floatingLegData-&gt;hoursPerDay();</div>
<div class="line"><span class="lineno">  531</span>    <span class="keywordflow">if</span> ((floatingLegData-&gt;commodityQuantityFrequency() == CommodityQuantityFrequency::PerHour ||</div>
<div class="line"><span class="lineno">  532</span>         floatingLegData-&gt;commodityQuantityFrequency() == CommodityQuantityFrequency::PerHourAndCalendarDay) &amp;&amp;</div>
<div class="line"><span class="lineno">  533</span>        hoursPerDay == Null&lt;Natural&gt;()) {</div>
<div class="line"><span class="lineno">  534</span>        QL_REQUIRE(commFutureConv,</div>
<div class="line"><span class="lineno">  535</span>                   <span class="stringliteral">&quot;Commodity floating leg commodity frequency set to PerHour / PerHourAndCalendarDay but&quot;</span></div>
<div class="line"><span class="lineno">  536</span>                       &lt;&lt; <span class="stringliteral">&quot; no HoursPerDay provided in floating leg data and no commodity future convention for &quot;</span></div>
<div class="line"><span class="lineno">  537</span>                       &lt;&lt; commName);</div>
<div class="line"><span class="lineno">  538</span>        hoursPerDay = commFutureConv-&gt;hoursPerDay();</div>
<div class="line"><span class="lineno">  539</span>        QL_REQUIRE(commFutureConv,</div>
<div class="line"><span class="lineno">  540</span>                   <span class="stringliteral">&quot;Commodity floating leg commodity frequency set to PerHour / PerHourAndCalendarDay but&quot;</span></div>
<div class="line"><span class="lineno">  541</span>                       &lt;&lt; <span class="stringliteral">&quot; no HoursPerDay provided in floating leg data and commodity future convention for &quot;</span></div>
<div class="line"><span class="lineno">  542</span>                       &lt;&lt; commName &lt;&lt; <span class="stringliteral">&quot; does not provide it.&quot;</span>);</div>
<div class="line"><span class="lineno">  543</span>    }</div>
<div class="line"><span class="lineno">  544</span> </div>
<div class="line"><span class="lineno">  545</span>    <span class="comment">// populate daylight saving begin / end</span></div>
<div class="line"><span class="lineno">  546</span>    std::string daylightSavingLocation;</div>
<div class="line"><span class="lineno">  547</span>    <span class="keywordflow">if</span> (floatingLegData-&gt;commodityQuantityFrequency() == CommodityQuantityFrequency::PerHourAndCalendarDay) {</div>
<div class="line"><span class="lineno">  548</span>        QL_REQUIRE(</div>
<div class="line"><span class="lineno">  549</span>            commFutureConv,</div>
<div class="line"><span class="lineno">  550</span>            <span class="stringliteral">&quot;Commodity floating leg commodity frequency set to PerHourAndCalendarDay, need commodity convention for &quot;</span></div>
<div class="line"><span class="lineno">  551</span>                &lt;&lt; commName);</div>
<div class="line"><span class="lineno">  552</span>        daylightSavingLocation = commFutureConv-&gt;savingsTime();</div>
<div class="line"><span class="lineno">  553</span>    }</div>
<div class="line"><span class="lineno">  554</span>    QuantLib::ext::shared_ptr&lt;FxIndex&gt; fxIndex;</div>
<div class="line"><span class="lineno">  555</span>    <span class="comment">// Build the leg. Different ctor depending on whether cashflow is averaging or not.</span></div>
<div class="line"><span class="lineno">  556</span>    Leg leg;</div>
<div class="line"><span class="lineno">  557</span> </div>
<div class="line"><span class="lineno">  558</span>    <span class="keywordtype">bool</span> isCashFlowAveraged =</div>
<div class="line"><span class="lineno">  559</span>        floatingLegData-&gt;isAveraged() &amp;&amp; !<a class="code hl_variable" href="classore_1_1data_1_1_commodity_floating_leg_builder.html#a80c11faffb1ad959cf6499976d026664">allAveraging_</a> &amp;&amp; floatingLegData-&gt;lastNDays() == Null&lt;Natural&gt;();</div>
<div class="line"><span class="lineno">  560</span> </div>
<div class="line"><span class="lineno">  561</span>    <span class="comment">// If daily expiry offset is given, check that referenced future contract has a daily frequency.</span></div>
<div class="line"><span class="lineno">  562</span>    <span class="keyword">auto</span> dailyExpOffset = floatingLegData-&gt;dailyExpiryOffset();</div>
<div class="line"><span class="lineno">  563</span>    <span class="keywordflow">if</span> (dailyExpOffset != Null&lt;Natural&gt;() &amp;&amp; dailyExpOffset &gt; 0) {</div>
<div class="line"><span class="lineno">  564</span>        QL_REQUIRE(commFutureConv, <span class="stringliteral">&quot;A positive DailyExpiryOffset has been provided but no commodity&quot;</span></div>
<div class="line"><span class="lineno">  565</span>                                       &lt;&lt; <span class="stringliteral">&quot; future convention given for &quot;</span> &lt;&lt; commName);</div>
<div class="line"><span class="lineno">  566</span>        QL_REQUIRE(commFutureConv-&gt;contractFrequency() == Daily,</div>
<div class="line"><span class="lineno">  567</span>                   <span class="stringliteral">&quot;A positive DailyExpiryOffset has been&quot;</span></div>
<div class="line"><span class="lineno">  568</span>                       &lt;&lt; <span class="stringliteral">&quot; provided but the commodity contract frequency is not Daily (&quot;</span></div>
<div class="line"><span class="lineno">  569</span>                       &lt;&lt; commFutureConv-&gt;contractFrequency() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno">  570</span>    }</div>
<div class="line"><span class="lineno">  571</span> </div>
<div class="line"><span class="lineno">  572</span>    <span class="keywordflow">if</span> (!floatingLegData-&gt;fxIndex().empty()) { <span class="comment">// build the fxIndex for daily average conversion</span></div>
<div class="line"><span class="lineno">  573</span>        <span class="keyword">auto</span> underlyingCcy = priceCurve-&gt;currency().code();</div>
<div class="line"><span class="lineno">  574</span>        <span class="keyword">auto</span> npvCurrency = <a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a>.currency();</div>
<div class="line"><span class="lineno">  575</span>        <span class="keywordflow">if</span> (underlyingCcy != npvCurrency) <span class="comment">// only need an FX Index if currencies differ</span></div>
<div class="line"><span class="lineno">  576</span>            fxIndex = <a class="code hl_function" href="namespaceore_1_1data.html#ae313b95f8a3ab32f9ef5fbb83ac3254f">buildFxIndex</a>(floatingLegData-&gt;fxIndex(), npvCurrency, underlyingCcy, engineFactory-&gt;market(),</div>
<div class="line"><span class="lineno">  577</span>                                   engineFactory-&gt;configuration(<a class="code hl_enumvalue" href="namespaceore_1_1data.html#a81db05f0ea371a4a14cac6e955ecd5cca59aab28b54594c59dab8d19afd9478e4">MarketContext::pricing</a>));</div>
<div class="line"><span class="lineno">  578</span>    }</div>
<div class="line"><span class="lineno">  579</span> </div>
<div class="line"><span class="lineno">  580</span>    <span class="keywordflow">if</span> (isCashFlowAveraged) {</div>
<div class="line"><span class="lineno">  581</span>        <a class="code hl_enumerationRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_cash_flow.html#ad4543fa3ccf34fd7094241b04092cef0">CommodityIndexedAverageCashFlow::PaymentTiming</a> paymentTiming =</div>
<div class="line"><span class="lineno">  582</span>            CommodityIndexedAverageCashFlow::PaymentTiming::InArrears;</div>
<div class="line"><span class="lineno">  583</span>        <span class="keywordflow">if</span> (floatingLegData-&gt;commodityPayRelativeTo() == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a350945686b4e42dbe9c8f1e2ab79bdbfa40a517f4cd142f5bd8e03d46542de4a2">CommodityPayRelativeTo::CalculationPeriodStartDate</a>) {</div>
<div class="line"><span class="lineno">  584</span>            paymentTiming = CommodityIndexedAverageCashFlow::PaymentTiming::InAdvance;</div>
<div class="line"><span class="lineno">  585</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (floatingLegData-&gt;commodityPayRelativeTo() == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a350945686b4e42dbe9c8f1e2ab79bdbfa9aa4d3f458f3c1d5a093c62c94f20f71">CommodityPayRelativeTo::CalculationPeriodEndDate</a>) {</div>
<div class="line"><span class="lineno">  586</span>            paymentTiming = CommodityIndexedAverageCashFlow::PaymentTiming::InArrears;</div>
<div class="line"><span class="lineno">  587</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (floatingLegData-&gt;commodityPayRelativeTo() == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a350945686b4e42dbe9c8f1e2ab79bdbfaa260b63bf1033efe2157e0fcd58b423e">CommodityPayRelativeTo::FutureExpiryDate</a>) {</div>
<div class="line"><span class="lineno">  588</span>            QL_FAIL(<span class="stringliteral">&quot;CommodityLegBuilder: CommodityPayRelativeTo &#39;FutureExpiryDate&#39; not allowed for average cashflow.&quot;</span>);</div>
<div class="line"><span class="lineno">  589</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  590</span>            QL_FAIL(<span class="stringliteral">&quot;CommodityLegBuilder: CommodityPayRelativeTo &quot;</span> &lt;&lt; floatingLegData-&gt;commodityPayRelativeTo()</div>
<div class="line"><span class="lineno">  591</span>                                                                   &lt;&lt; <span class="stringliteral">&quot; not handled. This is an internal error.&quot;</span>);</div>
<div class="line"><span class="lineno">  592</span>        }</div>
<div class="line"><span class="lineno">  593</span> </div>
<div class="line"><span class="lineno">  594</span>        leg = <a class="code hl_classRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html">CommodityIndexedAverageLeg</a>(schedule, index)</div>
<div class="line"><span class="lineno">  595</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a9a0d5a7277800380a87eabb8dbe46422">withQuantities</a>(quantities)</div>
<div class="line"><span class="lineno">  596</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a159f5024a802ee0692c16780f114c67a">withPaymentLag</a>(boost::apply_visitor(<a class="code hl_struct" href="structore_1_1data_1_1_payment_lag_integer.html">PaymentLagInteger</a>(), paymentLag))</div>
<div class="line"><span class="lineno">  597</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#aa4c81405ef7eccca2f849d92fa2bb2fc">withPaymentCalendar</a>(paymentCalendar)</div>
<div class="line"><span class="lineno">  598</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a7b990149a901c356718a0e429720d80e">withPaymentConvention</a>(paymentConvention)</div>
<div class="line"><span class="lineno">  599</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#ab8906bdae278ba5fa45768f573a4510c">withPricingCalendar</a>(pricingCalendar)</div>
<div class="line"><span class="lineno">  600</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#ae367bf80b054125fb9e637a43485f465">withSpreads</a>(spreads)</div>
<div class="line"><span class="lineno">  601</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a2d8f6bb3e227e8127fa535f479cd5b58">withGearings</a>(gearings)</div>
<div class="line"><span class="lineno">  602</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a3c3363ff0ea42ad4c19362fd6d467aea">paymentTiming</a>(paymentTiming)</div>
<div class="line"><span class="lineno">  603</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a08cf0ee30fe45d98f3d3b502567a25fc">useFuturePrice</a>(priceType == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#aaec25a9a272c33ea399fb9f2f839ecf7ab2726d1bfb080cc9e752a13ddef1631c">CommodityPriceType::FutureSettlement</a>)</div>
<div class="line"><span class="lineno">  604</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a4b53345e353b20b6487294f52787f414">withDeliveryDateRoll</a>(floatingLegData-&gt;deliveryRollDays())</div>
<div class="line"><span class="lineno">  605</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a2c79aedb314f01fd0258198d729dba41">withFutureMonthOffset</a>(floatingLegData-&gt;futureMonthOffset())</div>
<div class="line"><span class="lineno">  606</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#ab859e7fba8fe577ba8ae0192118b86db">withFutureExpiryCalculator</a>(feCalc)</div>
<div class="line"><span class="lineno">  607</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#af71e2213e8d7551918c07aee938ea899">payAtMaturity</a>(floatingLegData-&gt;commodityPayRelativeTo() ==</div>
<div class="line"><span class="lineno">  608</span>                      <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a350945686b4e42dbe9c8f1e2ab79bdbfa3f8dea04fbd4a6aae89bab0e681eeb66">CommodityPayRelativeTo::TerminationDate</a>)</div>
<div class="line"><span class="lineno">  609</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a204747837b3a8769db304bf77c6c89b7">includeEndDate</a>(floatingLegData-&gt;includePeriodEnd())</div>
<div class="line"><span class="lineno">  610</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a25a9e0b95cd509dcf87a74208ac2ea3b">excludeStartDate</a>(floatingLegData-&gt;excludePeriodStart())</div>
<div class="line"><span class="lineno">  611</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a4f21e3193f688762418282ddf7c45b9e">withQuantityFrequency</a>(floatingLegData-&gt;commodityQuantityFrequency())</div>
<div class="line"><span class="lineno">  612</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a873c5386f7a290c983eca87e9bd9e8a1">withPaymentDates</a>(paymentDates)</div>
<div class="line"><span class="lineno">  613</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#ab72d7b98853e3973e32d2eeebb46e099">useBusinessDays</a>(floatingLegData-&gt;useBusinessDays())</div>
<div class="line"><span class="lineno">  614</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#ab601d8776a6dbaf0548c99029447f2d2">withHoursPerDay</a>(hoursPerDay)</div>
<div class="line"><span class="lineno">  615</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a9287c91d5281150111cb5c9576e04edd">withDailyExpiryOffset</a>(dailyExpOffset)</div>
<div class="line"><span class="lineno">  616</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#ae4ddccf7674bb22118624fbcf563ee1d">unrealisedQuantity</a>(floatingLegData-&gt;unrealisedQuantity())</div>
<div class="line"><span class="lineno">  617</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#ae99bf93f79a48d6737d4768f76874509">withOffPeakPowerData</a>(offPeakPowerData)</div>
<div class="line"><span class="lineno">  618</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#aedcc9ea1821c19bb3736cb3406deb130">withFxIndex</a>(fxIndex);</div>
<div class="line"><span class="lineno">  619</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  620</span>        <a class="code hl_enumerationRef" href="../qle/class_quant_ext_1_1_commodity_indexed_cash_flow.html#ad4543fa3ccf34fd7094241b04092cef0">CommodityIndexedCashFlow::PaymentTiming</a> paymentTiming = CommodityIndexedCashFlow::PaymentTiming::InArrears;</div>
<div class="line"><span class="lineno">  621</span>        <span class="keywordflow">if</span> (floatingLegData-&gt;commodityPayRelativeTo() == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a350945686b4e42dbe9c8f1e2ab79bdbfa40a517f4cd142f5bd8e03d46542de4a2">CommodityPayRelativeTo::CalculationPeriodStartDate</a>) {</div>
<div class="line"><span class="lineno">  622</span>            paymentTiming = CommodityIndexedCashFlow::PaymentTiming::InAdvance;</div>
<div class="line"><span class="lineno">  623</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (floatingLegData-&gt;commodityPayRelativeTo() == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a350945686b4e42dbe9c8f1e2ab79bdbfa9aa4d3f458f3c1d5a093c62c94f20f71">CommodityPayRelativeTo::CalculationPeriodEndDate</a>) {</div>
<div class="line"><span class="lineno">  624</span>            paymentTiming = CommodityIndexedCashFlow::PaymentTiming::InArrears;</div>
<div class="line"><span class="lineno">  625</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (floatingLegData-&gt;commodityPayRelativeTo() == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a350945686b4e42dbe9c8f1e2ab79bdbfaa260b63bf1033efe2157e0fcd58b423e">CommodityPayRelativeTo::FutureExpiryDate</a>) {</div>
<div class="line"><span class="lineno">  626</span>            paymentTiming = CommodityIndexedCashFlow::PaymentTiming::RelativeToExpiry;</div>
<div class="line"><span class="lineno">  627</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  628</span>            QL_FAIL(<span class="stringliteral">&quot;CommodityLegBuilder: CommodityPayRelativeTo &quot;</span> &lt;&lt; floatingLegData-&gt;commodityPayRelativeTo()</div>
<div class="line"><span class="lineno">  629</span>                                                                   &lt;&lt; <span class="stringliteral">&quot; not handled. This is an internal error.&quot;</span>);</div>
<div class="line"><span class="lineno">  630</span>        }</div>
<div class="line"><span class="lineno">  631</span> </div>
<div class="line"><span class="lineno">  632</span>        leg = <a class="code hl_classRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html">CommodityIndexedLeg</a>(schedule, index)</div>
<div class="line"><span class="lineno">  633</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a64cfd9319bd7d1950913f635a010361a">withQuantities</a>(quantities)</div>
<div class="line"><span class="lineno">  634</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a9ab733edeedfe3515ce53f5de21d6bf6">withPaymentLag</a>(boost::apply_visitor(<a class="code hl_struct" href="structore_1_1data_1_1_payment_lag_integer.html">PaymentLagInteger</a>(), paymentLag))</div>
<div class="line"><span class="lineno">  635</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#aa1e5e9ede02e491b609fdd2943d138aa">withPaymentCalendar</a>(paymentCalendar)</div>
<div class="line"><span class="lineno">  636</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#ad156641247039082182899f8c5d3c90f">withPaymentConvention</a>(paymentConvention)</div>
<div class="line"><span class="lineno">  637</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#add31145dcf36c28fc78b0d2644fbdfe8">withPricingLag</a>(floatingLegData-&gt;pricingLag())</div>
<div class="line"><span class="lineno">  638</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a106ee203249d1ec7bb6565270e6acd16">withPricingLagCalendar</a>(pricingCalendar)</div>
<div class="line"><span class="lineno">  639</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#abd00a3f9dd34792d2088fff6b7f7aadc">withSpreads</a>(spreads)</div>
<div class="line"><span class="lineno">  640</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a9ec2c4a0d7a36e9fb6bb8ecbd1648d6e">withGearings</a>(gearings)</div>
<div class="line"><span class="lineno">  641</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a15550c0cbb0255db4cd163ef3c950b99">paymentTiming</a>(paymentTiming)</div>
<div class="line"><span class="lineno">  642</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a9c173f106fb64f11f8cdb7a4bbf1b8d2">inArrears</a>(floatingLegData-&gt;isInArrears())</div>
<div class="line"><span class="lineno">  643</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#ac39ab5a1faec900f7a2d659d6bc58a21">useFuturePrice</a>(priceType == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#aaec25a9a272c33ea399fb9f2f839ecf7ab2726d1bfb080cc9e752a13ddef1631c">CommodityPriceType::FutureSettlement</a>)</div>
<div class="line"><span class="lineno">  644</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#af35f2f5df2bfc74fcb7bf52eb0183ff7">useFutureExpiryDate</a>(floatingLegData-&gt;pricingDateRule() == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a8034865a15f1945f0ae6f4875011ecd4aa260b63bf1033efe2157e0fcd58b423e">CommodityPricingDateRule::FutureExpiryDate</a>)</div>
<div class="line"><span class="lineno">  645</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a5896c859bff34e9ba7fae1c509d554e8">withFutureMonthOffset</a>(floatingLegData-&gt;futureMonthOffset())</div>
<div class="line"><span class="lineno">  646</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a96ed20cec5c490b430fd3cc4c7df762a">withFutureExpiryCalculator</a>(feCalc)</div>
<div class="line"><span class="lineno">  647</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a2b6334c742ec23582e7c66e2e46243f5">payAtMaturity</a>(floatingLegData-&gt;commodityPayRelativeTo() == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a350945686b4e42dbe9c8f1e2ab79bdbfa3f8dea04fbd4a6aae89bab0e681eeb66">CommodityPayRelativeTo::TerminationDate</a>)</div>
<div class="line"><span class="lineno">  648</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#aa65ea6e434c1f2fa029ac3ef0d874d37">withPricingDates</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#ab0b32bc299eb03d1e3d53a2b97af52e7">pricingDates</a>)</div>
<div class="line"><span class="lineno">  649</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a6a2561a26064a92ec4c45039c65a1e0c">withPaymentDates</a>(paymentDates)</div>
<div class="line"><span class="lineno">  650</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#aa1a73dd1d88d6f0f6971e6592c8e5a7a">withDailyExpiryOffset</a>(dailyExpOffset)</div>
<div class="line"><span class="lineno">  651</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a8a1eec16c435ea7fb8841b74d65cbe3b">withFxIndex</a>(fxIndex)</div>
<div class="line"><span class="lineno">  652</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a3528da691e8c50babc688b1681ae52b2">withIsAveraging</a>(floatingLegData-&gt;isAveraged() &amp;&amp; balanceOfTheMonth)</div>
<div class="line"><span class="lineno">  653</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#ace28b64087c12623371117646fa86828">withPricingCalendar</a>(pricingCalendar)</div>
<div class="line"><span class="lineno">  654</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a4b65e24e4767bbc2b224a55d0ae402eb">includeEndDate</a>(floatingLegData-&gt;includePeriodEnd())</div>
<div class="line"><span class="lineno">  655</span>                  .<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a0d4aaf84b21d15a57d910b9968c0e810">excludeStartDate</a>(floatingLegData-&gt;excludePeriodStart());</div>
<div class="line"><span class="lineno">  656</span> </div>
<div class="line"><span class="lineno">  657</span>        <span class="comment">// Possibly update the leg&#39;s quantities.</span></div>
<div class="line"><span class="lineno">  658</span>        updateQuantities(leg, <a class="code hl_variable" href="classore_1_1data_1_1_commodity_floating_leg_builder.html#a80c11faffb1ad959cf6499976d026664">allAveraging_</a>, floatingLegData-&gt;commodityQuantityFrequency(), schedule,</div>
<div class="line"><span class="lineno">  659</span>                         floatingLegData-&gt;excludePeriodStart(), floatingLegData-&gt;includePeriodEnd(), commFutureConv,</div>
<div class="line"><span class="lineno">  660</span>                         feCalc, hoursPerDay, floatingLegData-&gt;useBusinessDays(), daylightSavingLocation, commName,</div>
<div class="line"><span class="lineno">  661</span>                         floatingLegData-&gt;unrealisedQuantity(), offPeakPowerData);</div>
<div class="line"><span class="lineno">  662</span> </div>
<div class="line"><span class="lineno">  663</span>        <span class="comment">// If lastNDays is set, amend each cashflow in the leg to an averaging cashflow over the lastNDays.</span></div>
<div class="line"><span class="lineno">  664</span>        <span class="keyword">auto</span> lastNDays = floatingLegData-&gt;lastNDays();</div>
<div class="line"><span class="lineno">  665</span>        <span class="keywordflow">if</span> (lastNDays != Null&lt;Natural&gt;() &amp;&amp; lastNDays &gt; 1) {</div>
<div class="line"><span class="lineno">  666</span>            <span class="keywordflow">if</span> (commFutureConv) {</div>
<div class="line"><span class="lineno">  667</span>                <span class="keywordflow">if</span> (lastNDays &gt; 31) {</div>
<div class="line"><span class="lineno">  668</span>                    <a class="code hl_define" href="log_8hpp.html#a9622ca943201e814041f051b7a10b3ea">WLOG</a>(<span class="stringliteral">&quot;LastNDays (&quot;</span> &lt;&lt; lastNDays &lt;&lt; <span class="stringliteral">&quot;) should not be greater than 31. &quot;</span> &lt;&lt;</div>
<div class="line"><span class="lineno">  669</span>                        <span class="stringliteral">&quot;Proceed as if it is not set.&quot;</span>);</div>
<div class="line"><span class="lineno">  670</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (commFutureConv-&gt;isAveraging()) {</div>
<div class="line"><span class="lineno">  671</span>                    <a class="code hl_define" href="log_8hpp.html#a9622ca943201e814041f051b7a10b3ea">WLOG</a>(<span class="stringliteral">&quot;Commodity future convention for &quot;</span> &lt;&lt; commName &lt;&lt; <span class="stringliteral">&quot; is averaging so LastNDays (&quot;</span> &lt;&lt;</div>
<div class="line"><span class="lineno">  672</span>                        lastNDays &lt;&lt; <span class="stringliteral">&quot;) is ignored. Proceed as if it is not set.&quot;</span>);</div>
<div class="line"><span class="lineno">  673</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  674</span>                    <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Amending cashflows to account for LastNDays (&quot;</span> &lt;&lt; lastNDays &lt;&lt; <span class="stringliteral">&quot;).&quot;</span>);</div>
<div class="line"><span class="lineno">  675</span>                    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; cal = commFutureConv-&gt;calendar();</div>
<div class="line"><span class="lineno">  676</span>                    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; cf : leg) {</div>
<div class="line"><span class="lineno">  677</span>                        <span class="keyword">auto</span> ccf = QuantLib::ext::dynamic_pointer_cast&lt;CommodityIndexedCashFlow&gt;(cf);</div>
<div class="line"><span class="lineno">  678</span>                        <span class="keyword">const</span> Date&amp; endDate = ccf-&gt;pricingDate();</div>
<div class="line"><span class="lineno">  679</span>                        Date startDate = cal.advance(endDate, -<span class="keyword">static_cast&lt;</span>Integer<span class="keyword">&gt;</span>(lastNDays) + 1, Days, Preceding);</div>
<div class="line"><span class="lineno">  680</span>                        <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Creating cashflow averaging over period [&quot;</span> &lt;&lt; io::iso_date(startDate) &lt;&lt;</div>
<div class="line"><span class="lineno">  681</span>                            <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; io::iso_date(endDate) &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>);</div>
<div class="line"><span class="lineno">  682</span>                        cf = QuantLib::ext::make_shared&lt;CommodityIndexedAverageCashFlow&gt;(ccf-&gt;periodQuantity(), startDate,</div>
<div class="line"><span class="lineno">  683</span>                            endDate, ccf-&gt;date(), ccf-&gt;index(), cal, ccf-&gt;spread(), ccf-&gt;gearing(),</div>
<div class="line"><span class="lineno">  684</span>                            ccf-&gt;useFuturePrice(), 0, 0, feCalc, <span class="keyword">true</span>, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  685</span>                    }</div>
<div class="line"><span class="lineno">  686</span>                }</div>
<div class="line"><span class="lineno">  687</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  688</span>                <a class="code hl_define" href="log_8hpp.html#a9622ca943201e814041f051b7a10b3ea">WLOG</a>(<span class="stringliteral">&quot;Need a commodity future convention for &quot;</span> &lt;&lt; commName &lt;&lt; <span class="stringliteral">&quot; when LastNDays (&quot;</span> &lt;&lt; lastNDays &lt;&lt;</div>
<div class="line"><span class="lineno">  689</span>                    <span class="stringliteral">&quot;) is set and greater than 1. Proceed as if it is not set.&quot;</span>);</div>
<div class="line"><span class="lineno">  690</span>            }</div>
<div class="line"><span class="lineno">  691</span>        }</div>
<div class="line"><span class="lineno">  692</span>    }</div>
<div class="line"><span class="lineno">  693</span> </div>
<div class="line"><span class="lineno">  694</span>    <span class="keywordflow">if</span> (fxIndex) {</div>
<div class="line"><span class="lineno">  695</span>        <span class="comment">// fx daily indexing needed</span></div>
<div class="line"><span class="lineno">  696</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> cf : leg) {</div>
<div class="line"><span class="lineno">  697</span>            <span class="keyword">auto</span> cacf = QuantLib::ext::dynamic_pointer_cast&lt;CommodityCashFlow&gt;(cf);</div>
<div class="line"><span class="lineno">  698</span>            QL_REQUIRE(cacf, <span class="stringliteral">&quot;Commodity Indexed averaged cashflow is required to compute daily converted average.&quot;</span>);</div>
<div class="line"><span class="lineno">  699</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> kv : cacf-&gt;indices()) {</div>
<div class="line"><span class="lineno">  700</span>                <span class="keywordflow">if</span> (!fxIndex-&gt;fixingCalendar().isBusinessDay(</div>
<div class="line"><span class="lineno">  701</span>                        kv.first)) {</div>
<div class="line"><span class="lineno">  702</span>                    <span class="comment">/* If fx index is not available for the commodity pricing day, this ensures to require the previous</span></div>
<div class="line"><span class="lineno">  703</span><span class="comment">                     * valid one which will be used in pricing from fxIndex()-&gt;fixing(...) */</span></div>
<div class="line"><span class="lineno">  704</span>                    Date adjustedFixingDate = fxIndex-&gt;fixingCalendar().adjust(kv.first, Preceding);</div>
<div class="line"><span class="lineno">  705</span>                    requiredFixings.<a class="code hl_function" href="classore_1_1data_1_1_required_fixings.html#ab7dfe7e5dd7a3d8d8f67fc9096a3c57d">addFixingDate</a>(adjustedFixingDate, floatingLegData-&gt;fxIndex());</div>
<div class="line"><span class="lineno">  706</span>                } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  707</span>                    requiredFixings.<a class="code hl_function" href="classore_1_1data_1_1_required_fixings.html#ab7dfe7e5dd7a3d8d8f67fc9096a3c57d">addFixingDate</a>(kv.first, floatingLegData-&gt;fxIndex());</div>
<div class="line"><span class="lineno">  708</span>            }</div>
<div class="line"><span class="lineno">  709</span>        }</div>
<div class="line"><span class="lineno">  710</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  711</span>        <span class="comment">// standard indexing approach</span></div>
<div class="line"><span class="lineno">  712</span>        <a class="code hl_function" href="namespaceore_1_1data.html#a5d06d31ceafbb5a0bf0f9a4dbd09ab7e">applyIndexing</a>(leg, data, engineFactory, requiredFixings, openEndDateReplacement, useXbsCurves);</div>
<div class="line"><span class="lineno">  713</span>    }</div>
<div class="line"><span class="lineno">  714</span> </div>
<div class="line"><span class="lineno">  715</span>    <a class="code hl_function" href="namespaceore_1_1data.html#a7453cd5f9e91b39da1712c6207aca462">addToRequiredFixings</a>(leg, QuantLib::ext::make_shared&lt;FixingDateGetter&gt;(requiredFixings));</div>
<div class="line"><span class="lineno">  716</span>    <span class="keywordflow">return</span> leg;</div>
<div class="line"><span class="lineno">  717</span>}</div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_cash_flow_html_ad4543fa3ccf34fd7094241b04092cef0"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_cash_flow.html#ad4543fa3ccf34fd7094241b04092cef0">QuantExt::CommodityIndexedAverageCashFlow::PaymentTiming</a></div><div class="ttdeci">PaymentTiming</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html">QuantExt::CommodityIndexedAverageLeg</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_a08cf0ee30fe45d98f3d3b502567a25fc"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a08cf0ee30fe45d98f3d3b502567a25fc">QuantExt::CommodityIndexedAverageLeg::useFuturePrice</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; useFuturePrice(bool flag=false)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_a159f5024a802ee0692c16780f114c67a"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a159f5024a802ee0692c16780f114c67a">QuantExt::CommodityIndexedAverageLeg::withPaymentLag</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withPaymentLag(QuantLib::Natural paymentLag)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_a204747837b3a8769db304bf77c6c89b7"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a204747837b3a8769db304bf77c6c89b7">QuantExt::CommodityIndexedAverageLeg::includeEndDate</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; includeEndDate(bool flag=true)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_a25a9e0b95cd509dcf87a74208ac2ea3b"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a25a9e0b95cd509dcf87a74208ac2ea3b">QuantExt::CommodityIndexedAverageLeg::excludeStartDate</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; excludeStartDate(bool flag=true)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_a2c79aedb314f01fd0258198d729dba41"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a2c79aedb314f01fd0258198d729dba41">QuantExt::CommodityIndexedAverageLeg::withFutureMonthOffset</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withFutureMonthOffset(QuantLib::Natural futureMonthOffset)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_a2d8f6bb3e227e8127fa535f479cd5b58"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a2d8f6bb3e227e8127fa535f479cd5b58">QuantExt::CommodityIndexedAverageLeg::withGearings</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withGearings(QuantLib::Real gearing)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_a3c3363ff0ea42ad4c19362fd6d467aea"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a3c3363ff0ea42ad4c19362fd6d467aea">QuantExt::CommodityIndexedAverageLeg::paymentTiming</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; paymentTiming(CommodityIndexedAverageCashFlow::PaymentTiming paymentTiming)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_a4b53345e353b20b6487294f52787f414"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a4b53345e353b20b6487294f52787f414">QuantExt::CommodityIndexedAverageLeg::withDeliveryDateRoll</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withDeliveryDateRoll(QuantLib::Natural deliveryDateRoll)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_a4f21e3193f688762418282ddf7c45b9e"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a4f21e3193f688762418282ddf7c45b9e">QuantExt::CommodityIndexedAverageLeg::withQuantityFrequency</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withQuantityFrequency(CommodityQuantityFrequency quantityFrequency)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_a7b990149a901c356718a0e429720d80e"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a7b990149a901c356718a0e429720d80e">QuantExt::CommodityIndexedAverageLeg::withPaymentConvention</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withPaymentConvention(QuantLib::BusinessDayConvention paymentConvention)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_a873c5386f7a290c983eca87e9bd9e8a1"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a873c5386f7a290c983eca87e9bd9e8a1">QuantExt::CommodityIndexedAverageLeg::withPaymentDates</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withPaymentDates(const std::vector&lt; QuantLib::Date &gt; &amp;paymentDates)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_a9287c91d5281150111cb5c9576e04edd"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a9287c91d5281150111cb5c9576e04edd">QuantExt::CommodityIndexedAverageLeg::withDailyExpiryOffset</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withDailyExpiryOffset(QuantLib::Natural dailyExpiryOffset)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_a9a0d5a7277800380a87eabb8dbe46422"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#a9a0d5a7277800380a87eabb8dbe46422">QuantExt::CommodityIndexedAverageLeg::withQuantities</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withQuantities(QuantLib::Real quantity)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_aa4c81405ef7eccca2f849d92fa2bb2fc"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#aa4c81405ef7eccca2f849d92fa2bb2fc">QuantExt::CommodityIndexedAverageLeg::withPaymentCalendar</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withPaymentCalendar(const QuantLib::Calendar &amp;paymentCalendar)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_ab601d8776a6dbaf0548c99029447f2d2"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#ab601d8776a6dbaf0548c99029447f2d2">QuantExt::CommodityIndexedAverageLeg::withHoursPerDay</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withHoursPerDay(QuantLib::Natural hoursPerDay)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_ab72d7b98853e3973e32d2eeebb46e099"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#ab72d7b98853e3973e32d2eeebb46e099">QuantExt::CommodityIndexedAverageLeg::useBusinessDays</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; useBusinessDays(bool flag=true)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_ab859e7fba8fe577ba8ae0192118b86db"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#ab859e7fba8fe577ba8ae0192118b86db">QuantExt::CommodityIndexedAverageLeg::withFutureExpiryCalculator</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withFutureExpiryCalculator(const ext::shared_ptr&lt; FutureExpiryCalculator &gt; &amp;calc=nullptr)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_ab8906bdae278ba5fa45768f573a4510c"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#ab8906bdae278ba5fa45768f573a4510c">QuantExt::CommodityIndexedAverageLeg::withPricingCalendar</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withPricingCalendar(const QuantLib::Calendar &amp;pricingCalendar)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_ae367bf80b054125fb9e637a43485f465"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#ae367bf80b054125fb9e637a43485f465">QuantExt::CommodityIndexedAverageLeg::withSpreads</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withSpreads(QuantLib::Real spread)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_ae4ddccf7674bb22118624fbcf563ee1d"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#ae4ddccf7674bb22118624fbcf563ee1d">QuantExt::CommodityIndexedAverageLeg::unrealisedQuantity</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; unrealisedQuantity(bool flag=false)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_ae99bf93f79a48d6737d4768f76874509"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#ae99bf93f79a48d6737d4768f76874509">QuantExt::CommodityIndexedAverageLeg::withOffPeakPowerData</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withOffPeakPowerData(const boost::optional&lt; std::pair&lt; QuantLib::Calendar, QuantLib::Real &gt; &gt; &amp;offPeakPowerData)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_aedcc9ea1821c19bb3736cb3406deb130"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#aedcc9ea1821c19bb3736cb3406deb130">QuantExt::CommodityIndexedAverageLeg::withFxIndex</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; withFxIndex(const ext::shared_ptr&lt; FxIndex &gt; &amp;fxIndex)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_average_leg_html_af71e2213e8d7551918c07aee938ea899"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_average_leg.html#af71e2213e8d7551918c07aee938ea899">QuantExt::CommodityIndexedAverageLeg::payAtMaturity</a></div><div class="ttdeci">CommodityIndexedAverageLeg &amp; payAtMaturity(bool flag=false)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_cash_flow_html_ad4543fa3ccf34fd7094241b04092cef0"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_cash_flow.html#ad4543fa3ccf34fd7094241b04092cef0">QuantExt::CommodityIndexedCashFlow::PaymentTiming</a></div><div class="ttdeci">PaymentTiming</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html">QuantExt::CommodityIndexedLeg</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_a0d4aaf84b21d15a57d910b9968c0e810"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a0d4aaf84b21d15a57d910b9968c0e810">QuantExt::CommodityIndexedLeg::excludeStartDate</a></div><div class="ttdeci">CommodityIndexedLeg &amp; excludeStartDate(bool flag=true)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_a106ee203249d1ec7bb6565270e6acd16"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a106ee203249d1ec7bb6565270e6acd16">QuantExt::CommodityIndexedLeg::withPricingLagCalendar</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withPricingLagCalendar(const QuantLib::Calendar &amp;pricingLagCalendar)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_a15550c0cbb0255db4cd163ef3c950b99"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a15550c0cbb0255db4cd163ef3c950b99">QuantExt::CommodityIndexedLeg::paymentTiming</a></div><div class="ttdeci">CommodityIndexedLeg &amp; paymentTiming(CommodityIndexedCashFlow::PaymentTiming paymentTiming)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_a2b6334c742ec23582e7c66e2e46243f5"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a2b6334c742ec23582e7c66e2e46243f5">QuantExt::CommodityIndexedLeg::payAtMaturity</a></div><div class="ttdeci">CommodityIndexedLeg &amp; payAtMaturity(bool flag=false)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_a3528da691e8c50babc688b1681ae52b2"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a3528da691e8c50babc688b1681ae52b2">QuantExt::CommodityIndexedLeg::withIsAveraging</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withIsAveraging(const bool isAveraging)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_a4b65e24e4767bbc2b224a55d0ae402eb"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a4b65e24e4767bbc2b224a55d0ae402eb">QuantExt::CommodityIndexedLeg::includeEndDate</a></div><div class="ttdeci">CommodityIndexedLeg &amp; includeEndDate(bool flag=true)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_a5896c859bff34e9ba7fae1c509d554e8"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a5896c859bff34e9ba7fae1c509d554e8">QuantExt::CommodityIndexedLeg::withFutureMonthOffset</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withFutureMonthOffset(QuantLib::Natural futureMonthOffset)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_a64cfd9319bd7d1950913f635a010361a"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a64cfd9319bd7d1950913f635a010361a">QuantExt::CommodityIndexedLeg::withQuantities</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withQuantities(QuantLib::Real quantity)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_a6a2561a26064a92ec4c45039c65a1e0c"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a6a2561a26064a92ec4c45039c65a1e0c">QuantExt::CommodityIndexedLeg::withPaymentDates</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withPaymentDates(const std::vector&lt; QuantLib::Date &gt; &amp;paymentDates)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_a8a1eec16c435ea7fb8841b74d65cbe3b"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a8a1eec16c435ea7fb8841b74d65cbe3b">QuantExt::CommodityIndexedLeg::withFxIndex</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withFxIndex(const ext::shared_ptr&lt; FxIndex &gt; &amp;fxIndex)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_a96ed20cec5c490b430fd3cc4c7df762a"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a96ed20cec5c490b430fd3cc4c7df762a">QuantExt::CommodityIndexedLeg::withFutureExpiryCalculator</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withFutureExpiryCalculator(const ext::shared_ptr&lt; FutureExpiryCalculator &gt; &amp;calc=nullptr)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_a9ab733edeedfe3515ce53f5de21d6bf6"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a9ab733edeedfe3515ce53f5de21d6bf6">QuantExt::CommodityIndexedLeg::withPaymentLag</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withPaymentLag(QuantLib::Natural paymentLag)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_a9c173f106fb64f11f8cdb7a4bbf1b8d2"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a9c173f106fb64f11f8cdb7a4bbf1b8d2">QuantExt::CommodityIndexedLeg::inArrears</a></div><div class="ttdeci">CommodityIndexedLeg &amp; inArrears(bool flag=true)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_a9ec2c4a0d7a36e9fb6bb8ecbd1648d6e"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#a9ec2c4a0d7a36e9fb6bb8ecbd1648d6e">QuantExt::CommodityIndexedLeg::withGearings</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withGearings(QuantLib::Real gearing)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_aa1a73dd1d88d6f0f6971e6592c8e5a7a"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#aa1a73dd1d88d6f0f6971e6592c8e5a7a">QuantExt::CommodityIndexedLeg::withDailyExpiryOffset</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withDailyExpiryOffset(QuantLib::Natural dailyExpiryOffset)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_aa1e5e9ede02e491b609fdd2943d138aa"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#aa1e5e9ede02e491b609fdd2943d138aa">QuantExt::CommodityIndexedLeg::withPaymentCalendar</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withPaymentCalendar(const QuantLib::Calendar &amp;paymentCalendar)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_aa65ea6e434c1f2fa029ac3ef0d874d37"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#aa65ea6e434c1f2fa029ac3ef0d874d37">QuantExt::CommodityIndexedLeg::withPricingDates</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withPricingDates(const std::vector&lt; QuantLib::Date &gt; &amp;pricingDates)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_abd00a3f9dd34792d2088fff6b7f7aadc"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#abd00a3f9dd34792d2088fff6b7f7aadc">QuantExt::CommodityIndexedLeg::withSpreads</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withSpreads(QuantLib::Real spread)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_ac39ab5a1faec900f7a2d659d6bc58a21"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#ac39ab5a1faec900f7a2d659d6bc58a21">QuantExt::CommodityIndexedLeg::useFuturePrice</a></div><div class="ttdeci">CommodityIndexedLeg &amp; useFuturePrice(bool flag=false)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_ace28b64087c12623371117646fa86828"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#ace28b64087c12623371117646fa86828">QuantExt::CommodityIndexedLeg::withPricingCalendar</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withPricingCalendar(const QuantLib::Calendar &amp;pricingCalendar)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_ad156641247039082182899f8c5d3c90f"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#ad156641247039082182899f8c5d3c90f">QuantExt::CommodityIndexedLeg::withPaymentConvention</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withPaymentConvention(QuantLib::BusinessDayConvention paymentConvention)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_add31145dcf36c28fc78b0d2644fbdfe8"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#add31145dcf36c28fc78b0d2644fbdfe8">QuantExt::CommodityIndexedLeg::withPricingLag</a></div><div class="ttdeci">CommodityIndexedLeg &amp; withPricingLag(QuantLib::Natural pricingLag)</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_commodity_indexed_leg_html_af35f2f5df2bfc74fcb7bf52eb0183ff7"><div class="ttname"><a href="../qle/class_quant_ext_1_1_commodity_indexed_leg.html#af35f2f5df2bfc74fcb7bf52eb0183ff7">QuantExt::CommodityIndexedLeg::useFutureExpiryDate</a></div><div class="ttdeci">CommodityIndexedLeg &amp; useFutureExpiryDate(bool flag=true)</div></div>
<div class="ttc" id="aclassore_1_1data_1_1_required_fixings_html_ab7dfe7e5dd7a3d8d8f67fc9096a3c57d"><div class="ttname"><a href="classore_1_1data_1_1_required_fixings.html#ab7dfe7e5dd7a3d8d8f67fc9096a3c57d">ore::data::RequiredFixings::addFixingDate</a></div><div class="ttdeci">void addFixingDate(const QuantLib::Date &amp;fixingDate, const std::string &amp;indexName, const QuantLib::Date &amp;payDate=Date::maxDate(), const bool alwaysAddIfPaysOnSettlement=false, const bool mandatoryFixing=true)</div><div class="ttdef"><b>Definition:</b> <a href="fixingdates_8cpp_source.html#l00364">fixingdates.cpp:364</a></div></div>
<div class="ttc" id="agroup__utilities_html_ga0f72d6fcccae10a674bdcd5095200f14"><div class="ttname"><a href="group__utilities.html#ga0f72d6fcccae10a674bdcd5095200f14">ore::data::parseCalendar</a></div><div class="ttdeci">Calendar parseCalendar(const string &amp;s)</div><div class="ttdoc">Convert text to QuantLib::Calendar.</div><div class="ttdef"><b>Definition:</b> <a href="parsers_8cpp_source.html#l00157">parsers.cpp:157</a></div></div>
<div class="ttc" id="agroup__utilities_html_ga86adcf55f91e340ff40783964666e732"><div class="ttname"><a href="group__utilities.html#ga86adcf55f91e340ff40783964666e732">ore::data::parseBusinessDayConvention</a></div><div class="ttdeci">BusinessDayConvention parseBusinessDayConvention(const string &amp;s)</div><div class="ttdoc">Convert text to QuantLib::BusinessDayConvention.</div><div class="ttdef"><b>Definition:</b> <a href="parsers_8cpp_source.html#l00173">parsers.cpp:173</a></div></div>
<div class="ttc" id="agroup__utilities_html_gaaccd32117e7bb7cbec793de579976cc8"><div class="ttname"><a href="group__utilities.html#gaaccd32117e7bb7cbec793de579976cc8">ore::data::parsePaymentLag</a></div><div class="ttdeci">PaymentLag parsePaymentLag(const string &amp;s)</div><div class="ttdoc">Convert text to PaymentLag.</div><div class="ttdef"><b>Definition:</b> <a href="parsers_8cpp_source.html#l00628">parsers.cpp:628</a></div></div>
<div class="ttc" id="alog_8hpp_html_a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b"><div class="ttname"><a href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a></div><div class="ttdeci">@ data</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00077">log.hpp:77</a></div></div>
<div class="ttc" id="alog_8hpp_html_a34c7c8cde9b91d2eee82d7b9a0b66fd5"><div class="ttname"><a href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a></div><div class="ttdeci">#define DLOG(text)</div><div class="ttdoc">Logging Macro (Level = Debug)</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00554">log.hpp:554</a></div></div>
<div class="ttc" id="alog_8hpp_html_a9622ca943201e814041f051b7a10b3ea"><div class="ttname"><a href="log_8hpp.html#a9622ca943201e814041f051b7a10b3ea">WLOG</a></div><div class="ttdeci">#define WLOG(text)</div><div class="ttdoc">Logging Macro (Level = Warning)</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00550">log.hpp:550</a></div></div>
<div class="ttc" id="alog_8hpp_html_a99aeca53f904c71a68070e1f9d310232"><div class="ttname"><a href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a></div><div class="ttdeci">#define TLOG(text)</div><div class="ttdoc">Logging Macro (Level = Data)</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00556">log.hpp:556</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_ab0b32bc299eb03d1e3d53a2b97af52e7"><div class="ttname"><a href="../qle/namespace_quant_ext.html#ab0b32bc299eb03d1e3d53a2b97af52e7">QuantExt::pricingDates</a></div><div class="ttdeci">set&lt; Date &gt; pricingDates(const Date &amp;s, const Date &amp;e, const Calendar &amp;pricingCalendar, bool excludeStart, bool includeEnd, bool useBusinessDays)</div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a350945686b4e42dbe9c8f1e2ab79bdbfa3f8dea04fbd4a6aae89bab0e681eeb66"><div class="ttname"><a href="namespaceore_1_1data.html#a350945686b4e42dbe9c8f1e2ab79bdbfa3f8dea04fbd4a6aae89bab0e681eeb66">ore::data::CommodityPayRelativeTo::TerminationDate</a></div><div class="ttdeci">@ TerminationDate</div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a350945686b4e42dbe9c8f1e2ab79bdbfa40a517f4cd142f5bd8e03d46542de4a2"><div class="ttname"><a href="namespaceore_1_1data.html#a350945686b4e42dbe9c8f1e2ab79bdbfa40a517f4cd142f5bd8e03d46542de4a2">ore::data::CommodityPayRelativeTo::CalculationPeriodStartDate</a></div><div class="ttdeci">@ CalculationPeriodStartDate</div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a350945686b4e42dbe9c8f1e2ab79bdbfa9aa4d3f458f3c1d5a093c62c94f20f71"><div class="ttname"><a href="namespaceore_1_1data.html#a350945686b4e42dbe9c8f1e2ab79bdbfa9aa4d3f458f3c1d5a093c62c94f20f71">ore::data::CommodityPayRelativeTo::CalculationPeriodEndDate</a></div><div class="ttdeci">@ CalculationPeriodEndDate</div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a350945686b4e42dbe9c8f1e2ab79bdbfaa260b63bf1033efe2157e0fcd58b423e"><div class="ttname"><a href="namespaceore_1_1data.html#a350945686b4e42dbe9c8f1e2ab79bdbfaa260b63bf1033efe2157e0fcd58b423e">ore::data::CommodityPayRelativeTo::FutureExpiryDate</a></div><div class="ttdeci">@ FutureExpiryDate</div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a5d06d31ceafbb5a0bf0f9a4dbd09ab7e"><div class="ttname"><a href="namespaceore_1_1data.html#a5d06d31ceafbb5a0bf0f9a4dbd09ab7e">ore::data::applyIndexing</a></div><div class="ttdeci">void applyIndexing(Leg &amp;leg, const LegData &amp;data, const QuantLib::ext::shared_ptr&lt; EngineFactory &gt; &amp;engineFactory, RequiredFixings &amp;requiredFixings, const QuantLib::Date &amp;openEndDateReplacement, const bool useXbsCurves)</div><div class="ttdef"><b>Definition:</b> <a href="ored_2portfolio_2legdata_8cpp_source.html#l02633">legdata.cpp:2633</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a7453cd5f9e91b39da1712c6207aca462"><div class="ttname"><a href="namespaceore_1_1data.html#a7453cd5f9e91b39da1712c6207aca462">ore::data::addToRequiredFixings</a></div><div class="ttdeci">void addToRequiredFixings(const QuantLib::Leg &amp;leg, const QuantLib::ext::shared_ptr&lt; FixingDateGetter &gt; &amp;fixingDateGetter)</div><div class="ttdef"><b>Definition:</b> <a href="fixingdates_8cpp_source.html#l00789">fixingdates.cpp:789</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a8034865a15f1945f0ae6f4875011ecd4aa260b63bf1033efe2157e0fcd58b423e"><div class="ttname"><a href="namespaceore_1_1data.html#a8034865a15f1945f0ae6f4875011ecd4aa260b63bf1033efe2157e0fcd58b423e">ore::data::CommodityPricingDateRule::FutureExpiryDate</a></div><div class="ttdeci">@ FutureExpiryDate</div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a81db05f0ea371a4a14cac6e955ecd5cca59aab28b54594c59dab8d19afd9478e4"><div class="ttname"><a href="namespaceore_1_1data.html#a81db05f0ea371a4a14cac6e955ecd5cca59aab28b54594c59dab8d19afd9478e4">ore::data::MarketContext::pricing</a></div><div class="ttdeci">@ pricing</div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a9206da3667d412d6992de0f3909beef2"><div class="ttname"><a href="namespaceore_1_1data.html#a9206da3667d412d6992de0f3909beef2">ore::data::buildScheduledVector</a></div><div class="ttdeci">vector&lt; T &gt; buildScheduledVector(const vector&lt; T &gt; &amp;values, const vector&lt; string &gt; &amp;dates, const Schedule &amp;schedule, const bool checkAllValuesAppearInResult=false)</div><div class="ttdef"><b>Definition:</b> <a href="legdata_8hpp_source.html#l01061">legdata.hpp:1061</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_aaec25a9a272c33ea399fb9f2f839ecf7"><div class="ttname"><a href="namespaceore_1_1data.html#aaec25a9a272c33ea399fb9f2f839ecf7">ore::data::CommodityPriceType</a></div><div class="ttdeci">CommodityPriceType</div><div class="ttdef"><b>Definition:</b> <a href="commoditylegdata_8hpp_source.html#l00042">commoditylegdata.hpp:42</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_aaec25a9a272c33ea399fb9f2f839ecf7ab2726d1bfb080cc9e752a13ddef1631c"><div class="ttname"><a href="namespaceore_1_1data.html#aaec25a9a272c33ea399fb9f2f839ecf7ab2726d1bfb080cc9e752a13ddef1631c">ore::data::CommodityPriceType::FutureSettlement</a></div><div class="ttdeci">@ FutureSettlement</div></div>
<div class="ttc" id="anamespaceore_1_1data_html_abd022b98516a69b335865f8c17a645cf"><div class="ttname"><a href="namespaceore_1_1data.html#abd022b98516a69b335865f8c17a645cf">ore::data::parseCommodityIndex</a></div><div class="ttdeci">QuantLib::ext::shared_ptr&lt; QuantExt::CommodityIndex &gt; parseCommodityIndex(const string &amp;name, bool hasPrefix, const Handle&lt; PriceTermStructure &gt; &amp;ts, const Calendar &amp;cal, const bool enforceFutureIndex)</div><div class="ttdef"><b>Definition:</b> <a href="indexparser_8cpp_source.html#l00797">indexparser.cpp:797</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_ae005d902ae9b906517bf93ca8c77e595"><div class="ttname"><a href="namespaceore_1_1data.html#ae005d902ae9b906517bf93ca8c77e595">ore::data::PaymentLag</a></div><div class="ttdeci">boost::variant&lt; QuantLib::Period, QuantLib::Natural &gt; PaymentLag</div><div class="ttdef"><b>Definition:</b> <a href="types_8hpp_source.html#l00032">types.hpp:32</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_ae313b95f8a3ab32f9ef5fbb83ac3254f"><div class="ttname"><a href="namespaceore_1_1data.html#ae313b95f8a3ab32f9ef5fbb83ac3254f">ore::data::buildFxIndex</a></div><div class="ttdeci">QuantLib::ext::shared_ptr&lt; QuantExt::FxIndex &gt; buildFxIndex(const string &amp;fxIndex, const string &amp;domestic, const string &amp;foreign, const QuantLib::ext::shared_ptr&lt; Market &gt; &amp;market, const string &amp;configuration, bool useXbsCurves)</div><div class="ttdef"><b>Definition:</b> <a href="marketdata_8cpp_source.html#l00137">marketdata.cpp:137</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_af158e922cf963a59228878344ca5858d"><div class="ttname"><a href="namespaceore_1_1data.html#af158e922cf963a59228878344ca5858d">ore::data::makeSchedule</a></div><div class="ttdeci">Schedule makeSchedule(const ScheduleDates &amp;data)</div><div class="ttdef"><b>Definition:</b> <a href="ored_2portfolio_2schedule_8cpp_source.html#l00263">schedule.cpp:263</a></div></div>
<div class="ttc" id="astructore_1_1data_1_1_payment_lag_integer_html"><div class="ttname"><a href="structore_1_1data_1_1_payment_lag_integer.html">ore::data::PaymentLagInteger</a></div><div class="ttdef"><b>Definition:</b> <a href="types_8hpp_source.html#l00040">types.hpp:40</a></div></div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="classore_1_1data_1_1_commodity_floating_leg_builder_a1e327fffe1588e7813e797d48b1b3420_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a989cbb8940a8e987c1fff598360c86f2" name="a989cbb8940a8e987c1fff598360c86f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a989cbb8940a8e987c1fff598360c86f2">&#9670;&#160;</a></span>allAveraging()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> allAveraging </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inspect the <code>allAveraging_</code> flag. </p>

<p class="definition">Definition at line <a class="el" href="commoditylegbuilder_8hpp_source.html#l00056">56</a> of file <a class="el" href="commoditylegbuilder_8hpp_source.html">commoditylegbuilder.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   56</span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1data_1_1_commodity_floating_leg_builder.html#a80c11faffb1ad959cf6499976d026664">allAveraging_</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a80c11faffb1ad959cf6499976d026664" name="a80c11faffb1ad959cf6499976d026664"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a80c11faffb1ad959cf6499976d026664">&#9670;&#160;</a></span>allAveraging_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classbool.html">bool</a> allAveraging_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >A flag that is set if the leg is averaging and the conventions indicate that the commodity contract itself on which the leg is based is averaging. This flag is false in all other circumstances. </p>

<p class="definition">Definition at line <a class="el" href="commoditylegbuilder_8hpp_source.html#l00062">62</a> of file <a class="el" href="commoditylegbuilder_8hpp_source.html">commoditylegbuilder.hpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.9.5
</small></address>
</body>
</html>
