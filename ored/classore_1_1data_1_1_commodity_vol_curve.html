<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>OREData: CommodityVolCurve Class Reference</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="oredextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-data@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.7</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceore.html">ore</a></li><li class="navelem"><a class="el" href="namespaceore_1_1data.html">data</a></li><li class="navelem"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html">CommodityVolCurve</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="classore_1_1data_1_1_commodity_vol_curve-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">CommodityVolCurve Class Reference<div class="ingroups"><a class="el" href="group__marketdata.html">Market Data</a> &raquo; <a class="el" href="group__curves.html">Curves</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Wrapper class for building commodity volatility structures.  
 <a href="classore_1_1data_1_1_commodity_vol_curve.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="commodityvolcurve_8hpp_source.html">ored/marketdata/commodityvolcurve.hpp</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for CommodityVolCurve:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_commodity_vol_curve__coll__graph.png" border="0" usemap="#a_commodity_vol_curve_coll__map" alt="Collaboration graph"/></div>
<map name="_commodity_vol_curve_coll__map" id="a_commodity_vol_curve_coll__map">
<area shape="rect" title="Wrapper class for building commodity volatility structures." alt="" coords="668,729,847,1056"/>
<area shape="rect" title=" " alt="" coords="5,545,96,623"/>
<area shape="rect" title=" " alt="" coords="121,538,295,630"/>
<area shape="rect" title=" " alt="" coords="320,538,528,630"/>
<area shape="rect" title=" " alt="" coords="552,538,744,630"/>
<area shape="rect" title=" " alt="" coords="769,538,965,630"/>
<area shape="rect" title=" " alt="" coords="989,538,1165,630"/>
<area shape="rect" title=" " alt="" coords="1190,545,1263,623"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html" title="Commodity volatility description." alt="" coords="1287,501,1507,667"/>
<area shape="rect" href="classore_1_1data_1_1_curve_spec.html" title="Curve Specification." alt="" coords="1459,272,1576,452"/>
<area shape="rect" title="STL class." alt="" coords="1341,132,1395,209"/>
<area shape="rect" title="STL class." alt="" coords="1297,5,1439,83"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader">Constructors</div></td></tr>
<tr class="memitem:ac00829921b76f3148a8851001de1ceb3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#ac00829921b76f3148a8851001de1ceb3">CommodityVolCurve</a> ()</td></tr>
<tr class="memdesc:ac00829921b76f3148a8851001de1ceb3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default constructor.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#ac00829921b76f3148a8851001de1ceb3">More...</a><br /></td></tr>
<tr class="separator:ac00829921b76f3148a8851001de1ceb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8478158917d0a0aa60c59e6338b3fb2b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a8478158917d0a0aa60c59e6338b3fb2b">CommodityVolCurve</a> (const QuantLib::Date &amp;asof, const <a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> &amp;<a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#afd68572ab1a4e7f6cd7c303eafd8cac1">spec</a>, const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;loader, const <a class="el" href="classore_1_1data_1_1_curve_configurations.html">CurveConfigurations</a> &amp;<a class="el" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>, const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_yield_curve.html">YieldCurve</a> &gt;&gt; &amp;yieldCurves={}, const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_curve.html">CommodityCurve</a> &gt;&gt; &amp;commodityCurves={}, const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html">CommodityVolCurve</a> &gt;&gt; &amp;commodityVolCurves={}, const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_f_x_vol_curve.html">FXVolCurve</a> &gt;&gt; &amp;fxVolCurves={}, const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_correlation_curve.html">CorrelationCurve</a> &gt;&gt; &amp;correlationCurves={}, const <a class="el" href="classore_1_1data_1_1_market.html">Market</a> *fxIndices=nullptr)</td></tr>
<tr class="memdesc:a8478158917d0a0aa60c59e6338b3fb2b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Detailed constructor.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#a8478158917d0a0aa60c59e6338b3fb2b">More...</a><br /></td></tr>
<tr class="separator:a8478158917d0a0aa60c59e6338b3fb2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
Inspectors</h2></td></tr>
<tr class="memitem:a2d6d676f5b66ce3ee357e308044138ba"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a2d6d676f5b66ce3ee357e308044138ba">spec_</a></td></tr>
<tr class="separator:a2d6d676f5b66ce3ee357e308044138ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf4baf7de4b5a3c87a9d9291f7a18116"><td class="memItemLeft" align="right" valign="top">boost::shared_ptr&lt; QuantLib::BlackVolTermStructure &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a></td></tr>
<tr class="separator:abf4baf7de4b5a3c87a9d9291f7a18116"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a365f188d3c44026746409d5540137c79"><td class="memItemLeft" align="right" valign="top">boost::shared_ptr&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_future_expiry_calculator.html">QuantExt::FutureExpiryCalculator</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a365f188d3c44026746409d5540137c79">expCalc_</a></td></tr>
<tr class="separator:a365f188d3c44026746409d5540137c79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9d85bafc53967e3a27153fbc1f3905d"><td class="memItemLeft" align="right" valign="top">boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_future_convention.html">CommodityFutureConvention</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#ad9d85bafc53967e3a27153fbc1f3905d">convention_</a></td></tr>
<tr class="separator:ad9d85bafc53967e3a27153fbc1f3905d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a936be92f5f766489c24b9ce54d702b36"><td class="memItemLeft" align="right" valign="top">QuantLib::Calendar&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a936be92f5f766489c24b9ce54d702b36">calendar_</a></td></tr>
<tr class="separator:a936be92f5f766489c24b9ce54d702b36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad54546634b68f067b0f3867f7283c998"><td class="memItemLeft" align="right" valign="top">QuantLib::DayCounter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#ad54546634b68f067b0f3867f7283c998">dayCounter_</a></td></tr>
<tr class="separator:ad54546634b68f067b0f3867f7283c998"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bf289bf605afd1052086f88a33fc2d1"><td class="memItemLeft" align="right" valign="top">QuantLib::Handle&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">QuantExt::PriceTermStructure</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a2bf289bf605afd1052086f88a33fc2d1">pts_</a></td></tr>
<tr class="separator:a2bf289bf605afd1052086f88a33fc2d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb845122ddd1a21e03828d0cd39f2e0f"><td class="memItemLeft" align="right" valign="top">QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#acb845122ddd1a21e03828d0cd39f2e0f">yts_</a></td></tr>
<tr class="separator:acb845122ddd1a21e03828d0cd39f2e0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd68572ab1a4e7f6cd7c303eafd8cac1"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#afd68572ab1a4e7f6cd7c303eafd8cac1">spec</a> () const</td></tr>
<tr class="separator:afd68572ab1a4e7f6cd7c303eafd8cac1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c5096ac06d1c35a40c5c513774035bc"><td class="memItemLeft" align="right" valign="top">const boost::shared_ptr&lt; QuantLib::BlackVolTermStructure &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a8c5096ac06d1c35a40c5c513774035bc">volatility</a> ()</td></tr>
<tr class="separator:a8c5096ac06d1c35a40c5c513774035bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08baf556261e694d6fd67532c3d6afe7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a08baf556261e694d6fd67532c3d6afe7">buildVolatility</a> (const QuantLib::Date &amp;asof, const <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;vc, const <a class="el" href="classore_1_1data_1_1_constant_volatility_config.html">ConstantVolatilityConfig</a> &amp;cvc, const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;loader)</td></tr>
<tr class="memdesc:a08baf556261e694d6fd67532c3d6afe7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build a volatility structure from a single constant volatility quote.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#a08baf556261e694d6fd67532c3d6afe7">More...</a><br /></td></tr>
<tr class="separator:a08baf556261e694d6fd67532c3d6afe7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a782cc59a036687f2402136c9003e07c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a782cc59a036687f2402136c9003e07c2">buildVolatility</a> (const QuantLib::Date &amp;asof, const <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;vc, const <a class="el" href="classore_1_1data_1_1_volatility_curve_config.html">VolatilityCurveConfig</a> &amp;vcc, const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;loader)</td></tr>
<tr class="memdesc:a782cc59a036687f2402136c9003e07c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build a volatility curve from a 1-D curve of volatility quotes.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#a782cc59a036687f2402136c9003e07c2">More...</a><br /></td></tr>
<tr class="separator:a782cc59a036687f2402136c9003e07c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcc61ebefadc0e8481bdf86dc739d23c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#abcc61ebefadc0e8481bdf86dc739d23c">buildVolatility</a> (const QuantLib::Date &amp;asof, <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;vc, const <a class="el" href="classore_1_1data_1_1_volatility_strike_surface_config.html">VolatilityStrikeSurfaceConfig</a> &amp;vssc, const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;loader)</td></tr>
<tr class="memdesc:abcc61ebefadc0e8481bdf86dc739d23c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build a volatility surface from a collection of expiry and absolute strike pairs.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#abcc61ebefadc0e8481bdf86dc739d23c">More...</a><br /></td></tr>
<tr class="separator:abcc61ebefadc0e8481bdf86dc739d23c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accbfc0352ecd2e4be852a0cc6238fbb5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#accbfc0352ecd2e4be852a0cc6238fbb5">buildVolatilityExplicit</a> (const QuantLib::Date &amp;asof, <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;vc, const <a class="el" href="classore_1_1data_1_1_volatility_strike_surface_config.html">VolatilityStrikeSurfaceConfig</a> &amp;vssc, const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;loader, const std::vector&lt; QuantLib::Real &gt; &amp;configuredStrikes)</td></tr>
<tr class="separator:accbfc0352ecd2e4be852a0cc6238fbb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa772bf4579fcbb84db47720fd747a953"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#aa772bf4579fcbb84db47720fd747a953">buildVolatility</a> (const QuantLib::Date &amp;asof, <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;vc, const <a class="el" href="classore_1_1data_1_1_volatility_delta_surface_config.html">VolatilityDeltaSurfaceConfig</a> &amp;vdsc, const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;loader)</td></tr>
<tr class="separator:aa772bf4579fcbb84db47720fd747a953"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a215f4878146bd685646285b1c621ce23"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a215f4878146bd685646285b1c621ce23">buildVolatility</a> (const QuantLib::Date &amp;asof, <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;vc, const <a class="el" href="classore_1_1data_1_1_volatility_moneyness_surface_config.html">VolatilityMoneynessSurfaceConfig</a> &amp;vmsc, const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;loader)</td></tr>
<tr class="separator:a215f4878146bd685646285b1c621ce23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ec3a734b609ed0a997abc1b4d62fc91"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a6ec3a734b609ed0a997abc1b4d62fc91">buildVolatility</a> (const QuantLib::Date &amp;asof, <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;vc, const <a class="el" href="classore_1_1data_1_1_volatility_apo_future_surface_config.html">VolatilityApoFutureSurfaceConfig</a> &amp;vapo, const QuantLib::Handle&lt; QuantLib::BlackVolTermStructure &gt; &amp;baseVts, const QuantLib::Handle&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">QuantExt::PriceTermStructure</a> &gt; &amp;basePts)</td></tr>
<tr class="separator:a6ec3a734b609ed0a997abc1b4d62fc91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab55a412b698dfa9d9c9a1c156098b680"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#ab55a412b698dfa9d9c9a1c156098b680">buildVolatility</a> (const QuantLib::Date &amp;asof, const <a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> &amp;<a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#afd68572ab1a4e7f6cd7c303eafd8cac1">spec</a>, const <a class="el" href="classore_1_1data_1_1_curve_configurations.html">CurveConfigurations</a> &amp;<a class="el" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>, const <a class="el" href="classore_1_1data_1_1_proxy_volatility_config.html">ProxyVolatilityConfig</a> &amp;pvc, const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_curve.html">CommodityCurve</a> &gt;&gt; &amp;comCurves, const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html">CommodityVolCurve</a> &gt;&gt; &amp;volCurves, const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_f_x_vol_curve.html">FXVolCurve</a> &gt;&gt; &amp;fxVolCurves, const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_correlation_curve.html">CorrelationCurve</a> &gt;&gt; &amp;correlationCurves, const <a class="el" href="classore_1_1data_1_1_market.html">Market</a> *fxIndices=nullptr)</td></tr>
<tr class="memdesc:ab55a412b698dfa9d9c9a1c156098b680"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build a volatility surface as a proxy from another volatility surface.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#ab55a412b698dfa9d9c9a1c156098b680">More...</a><br /></td></tr>
<tr class="separator:ab55a412b698dfa9d9c9a1c156098b680"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7e1102e1a7fab6db190335153446ece"><td class="memItemLeft" align="right" valign="top">QuantLib::Handle&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">QuantExt::PriceTermStructure</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#ab7e1102e1a7fab6db190335153446ece">correctFuturePriceCurve</a> (const QuantLib::Date &amp;asof, const std::string &amp;contractName, const boost::shared_ptr&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">QuantExt::PriceTermStructure</a> &gt; &amp;pts, const std::vector&lt; QuantLib::Date &gt; &amp;optionExpiries) const</td></tr>
<tr class="separator:ab7e1102e1a7fab6db190335153446ece"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53aacd04237d728a4918ea672c79ba9f"><td class="memItemLeft" align="right" valign="top">QuantLib::Date&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a53aacd04237d728a4918ea672c79ba9f">getExpiry</a> (const QuantLib::Date &amp;asof, const boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_expiry.html">Expiry</a> &gt; &amp;expiry, const std::string &amp;<a class="el" href="todaysmarketparameters_8cpp.html#a8ccf841cb59e451791bcb2e1ac4f1edc">name</a>, QuantLib::Natural rollDays) const</td></tr>
<tr class="memdesc:a53aacd04237d728a4918ea672c79ba9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get an explicit expiry date from a commodity option quote's <a class="el" href="classore_1_1data_1_1_expiry.html">Expiry</a>.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#a53aacd04237d728a4918ea672c79ba9f">More...</a><br /></td></tr>
<tr class="separator:a53aacd04237d728a4918ea672c79ba9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74e52708d793e99ad834733005aeece9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a74e52708d793e99ad834733005aeece9">populateCurves</a> (const <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;config, const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_yield_curve.html">YieldCurve</a> &gt;&gt; &amp;yieldCurves, const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_curve.html">CommodityCurve</a> &gt;&gt; &amp;commodityCurves, bool searchYield, bool dontThrow=false)</td></tr>
<tr class="memdesc:a74e52708d793e99ad834733005aeece9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Populate price curve, <code>pts_</code>, and yield curve, <code>yts_</code>.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#a74e52708d793e99ad834733005aeece9">More...</a><br /></td></tr>
<tr class="separator:a74e52708d793e99ad834733005aeece9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc2a1854aa88b4b0963f1567425ba06c"><td class="memItemLeft" align="right" valign="top">std::vector&lt; QuantLib::Real &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#acc2a1854aa88b4b0963f1567425ba06c">checkMoneyness</a> (const std::vector&lt; std::string &gt; &amp;moneynessLevels) const</td></tr>
<tr class="memdesc:acc2a1854aa88b4b0963f1567425ba06c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check and return moneyness levels.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#acc2a1854aa88b4b0963f1567425ba06c">More...</a><br /></td></tr>
<tr class="separator:acc2a1854aa88b4b0963f1567425ba06c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Wrapper class for building commodity volatility structures. </p>

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00042">42</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ac00829921b76f3148a8851001de1ceb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac00829921b76f3148a8851001de1ceb3">&#9670;&nbsp;</a></span>CommodityVolCurve() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html">CommodityVolCurve</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Default constructor. </p>

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00047">47</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;{}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8478158917d0a0aa60c59e6338b3fb2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8478158917d0a0aa60c59e6338b3fb2b">&#9670;&nbsp;</a></span>CommodityVolCurve() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html">CommodityVolCurve</a> </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> &amp;&#160;</td>
          <td class="paramname"><em>spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;&#160;</td>
          <td class="paramname"><em>loader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_curve_configurations.html">CurveConfigurations</a> &amp;&#160;</td>
          <td class="paramname"><em>curveConfigs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_yield_curve.html">YieldCurve</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>yieldCurves</em> = <code>{}</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_curve.html">CommodityCurve</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>commodityCurves</em> = <code>{}</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html">CommodityVolCurve</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>commodityVolCurves</em> = <code>{}</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_f_x_vol_curve.html">FXVolCurve</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>fxVolCurves</em> = <code>{}</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_correlation_curve.html">CorrelationCurve</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>correlationCurves</em> = <code>{}</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_market.html">Market</a> *&#160;</td>
          <td class="paramname"><em>fxIndices</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Detailed constructor. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="afd68572ab1a4e7f6cd7c303eafd8cac1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd68572ab1a4e7f6cd7c303eafd8cac1">&#9670;&nbsp;</a></span>spec()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a>&amp; spec </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00062">62</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#a2d6d676f5b66ce3ee357e308044138ba">spec_</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8c5096ac06d1c35a40c5c513774035bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c5096ac06d1c35a40c5c513774035bc">&#9670;&nbsp;</a></span>volatility()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const boost::shared_ptr&lt;QuantLib::BlackVolTermStructure&gt;&amp; volatility </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00063">63</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a08baf556261e694d6fd67532c3d6afe7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08baf556261e694d6fd67532c3d6afe7">&#9670;&nbsp;</a></span>buildVolatility() <span class="overload">[1/7]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatility </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_constant_volatility_config.html">ConstantVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>cvc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;&#160;</td>
          <td class="paramname"><em>loader</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Build a volatility structure from a single constant volatility quote. </p>

</div>
</div>
<a id="a782cc59a036687f2402136c9003e07c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a782cc59a036687f2402136c9003e07c2">&#9670;&nbsp;</a></span>buildVolatility() <span class="overload">[2/7]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatility </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_volatility_curve_config.html">VolatilityCurveConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vcc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;&#160;</td>
          <td class="paramname"><em>loader</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Build a volatility curve from a 1-D curve of volatility quotes. </p>

<p class="definition">Definition at line <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l00310">310</a> of file <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                                                                                                {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <a class="code" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: start building 1-D volatility curve&quot;</span>);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="comment">// Must have at least one quote</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    QL_REQUIRE(vcc.quotes().size() &gt; 0, <span class="stringliteral">&quot;No quotes specified in config &quot;</span> &lt;&lt; vc.curveID());</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    QL_REQUIRE(vcc.quoteType() == <a class="code" href="classore_1_1data_1_1_market_datum.html#aa5b3ec8bb6c730c38b87a73c11dec808a51c1258108cb3ef6a757d4e01db7f115">MarketDatum::QuoteType::RATE_LNVOL</a>, <span class="stringliteral">&quot;CommodityVolCurve: only quote type&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="stringliteral">&quot; RATE_LNVOL is currently supported for 1-D commodity volatility curves.&quot;</span>);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">// Check if we are using a regular expression to select the quotes for the curve. If we are, the quotes should</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="comment">// contain exactly one element.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keyword">auto</span> wildcard = <a class="code" href="namespaceore_1_1data.html#afbb6a9b32d74c08e52ac0984dcf2d880">getUniqueWildcard</a>(vcc.quotes());</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="comment">// curveData will be populated with the expiry dates and volatility values.</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    map&lt;Date, Real&gt; curveData;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">// Different approaches depending on whether we are using a regex or searching for a list of explicit quotes.</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">if</span> (wildcard) {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Have single quote with pattern &quot;</span> &lt;&lt; (*wildcard).pattern());</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="comment">// Loop over quotes and process commodity option quotes matching pattern on asof</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> boost::shared_ptr&lt;MarketDatum&gt;&amp; md : loader.loadQuotes(asof)) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="comment">// Go to next quote if the market data point&#39;s date does not equal our asof</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <span class="keywordflow">if</span> (md-&gt;asofDate() != asof)</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            <span class="keyword">auto</span> q = boost::dynamic_pointer_cast&lt;CommodityOptionQuote&gt;(md);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <span class="keywordflow">if</span> (q &amp;&amp; (*wildcard).matches(q-&gt;name())) {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;The quote &quot;</span> &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot; matched the pattern&quot;</span>);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                Date expiryDate = <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#a53aacd04237d728a4918ea672c79ba9f">getExpiry</a>(asof, q-&gt;expiry(), vc.futureConventionsId(), vc.optionExpiryRollDays());</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                <span class="keywordflow">if</span> (expiryDate &gt; asof) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                    <span class="comment">// Add the quote to the curve data</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                    <span class="keyword">auto</span> it = curveData.find(expiryDate);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                    <span class="keywordflow">if</span> (it != curveData.end()) {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                        <a class="code" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Already added quote &quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9) &lt;&lt; it-&gt;second &lt;&lt; <span class="stringliteral">&quot; for the expiry&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                            <span class="stringliteral">&quot; date &quot;</span> &lt;&lt; io::iso_date(expiryDate) &lt;&lt; <span class="stringliteral">&quot; for commodity curve &quot;</span> &lt;&lt; vc.curveID() &lt;&lt;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                            <span class="stringliteral">&quot; so not adding &quot;</span> &lt;&lt; q-&gt;name());</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                        curveData[expiryDate] = q-&gt;quote()-&gt;value();</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                        <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Added quote &quot;</span> &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot;: (&quot;</span> &lt;&lt; io::iso_date(expiryDate) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                            fixed &lt;&lt; setprecision(9) &lt;&lt; q-&gt;quote()-&gt;value() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                    }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                }</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            }</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="comment">// Check that we have quotes in the end</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        QL_REQUIRE(curveData.size() &gt; 0, <span class="stringliteral">&quot;No quotes found matching regular expression &quot;</span> &lt;&lt; vcc.quotes()[0]);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Have &quot;</span> &lt;&lt; vcc.quotes().size() &lt;&lt; <span class="stringliteral">&quot; explicit quotes&quot;</span>);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="comment">// Loop over quotes and process commodity option quotes that are explicitly specified in the config</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        Size quotesAdded = 0;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        Size skippedExpiredQuotes = 0;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> boost::shared_ptr&lt;MarketDatum&gt;&amp; md : loader.loadQuotes(asof)) {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <span class="comment">// Go to next quote if the market data point&#39;s date does not equal our asof</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            <span class="keywordflow">if</span> (md-&gt;asofDate() != asof)</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            <span class="keywordflow">if</span> (<span class="keyword">auto</span> q = boost::dynamic_pointer_cast&lt;CommodityOptionQuote&gt;(md)) {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                <span class="comment">// Find quote name in configured quotes.</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                <span class="keyword">auto</span> it = find(vcc.quotes().begin(), vcc.quotes().end(), q-&gt;name());</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                <span class="keywordflow">if</span> (it != vcc.quotes().end()) {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                    <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Found the configured quote &quot;</span> &lt;&lt; q-&gt;name());</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160; </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                    Date expiryDate = <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#a53aacd04237d728a4918ea672c79ba9f">getExpiry</a>(asof, q-&gt;expiry(), vc.futureConventionsId(), vc.optionExpiryRollDays());</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                    <span class="keywordflow">if</span> (expiryDate &gt; asof) {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                        QL_REQUIRE(expiryDate &gt; asof, <span class="stringliteral">&quot;Commodity volatility quote &#39;&quot;</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                                                          &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot;&#39; has expiry in the past (&quot;</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                                                          &lt;&lt; io::iso_date(expiryDate) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                        QL_REQUIRE(curveData.count(expiryDate) == 0, <span class="stringliteral">&quot;Duplicate quote for the date &quot;</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                                                                         &lt;&lt; io::iso_date(expiryDate)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                                                                         &lt;&lt; <span class="stringliteral">&quot; provided by commodity volatility config &quot;</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                                                                         &lt;&lt; vc.curveID());</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                        curveData[expiryDate] = q-&gt;quote()-&gt;value();</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                        quotesAdded++;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                        <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Added quote &quot;</span> &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot;: (&quot;</span> &lt;&lt; io::iso_date(expiryDate) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                                            &lt;&lt; setprecision(9) &lt;&lt; q-&gt;quote()-&gt;value() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                        skippedExpiredQuotes++;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                        <a class="code" href="log_8hpp.html#a9622ca943201e814041f051b7a10b3ea">WLOG</a>(<span class="stringliteral">&quot;Skipped quote &quot;</span> &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot;: (&quot;</span> &lt;&lt; io::iso_date(expiryDate) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                                              &lt;&lt; setprecision(9) &lt;&lt; q-&gt;quote()-&gt;value() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                    }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                }</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="comment">// Check that we have found all of the explicitly configured quotes</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        QL_REQUIRE((quotesAdded + skippedExpiredQuotes) == vcc.quotes().size(),</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                   <span class="stringliteral">&quot;Found &quot;</span> &lt;&lt; quotesAdded &lt;&lt; <span class="stringliteral">&quot; live quotes and &quot;</span> &lt;&lt; skippedExpiredQuotes &lt;&lt; <span class="stringliteral">&quot; expired quotes&quot;</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot; but &quot;</span> &lt;&lt; vcc.quotes().size() &lt;&lt; <span class="stringliteral">&quot; quotes were given in config.&quot;</span>);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="comment">// Create the dates and volatility vector</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    vector&lt;Date&gt; dates;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    vector&lt;Volatility&gt; volatilities;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; datum : curveData) {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        dates.push_back(datum.first);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        volatilities.push_back(datum.second);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Added data point (&quot;</span> &lt;&lt; io::iso_date(dates.back()) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9)</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                                  &lt;&lt; volatilities.back() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Creating BlackVarianceCurve object.&quot;</span>);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keyword">auto</span> tmp = boost::make_shared&lt;BlackVarianceCurve&gt;(asof, dates, volatilities, <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#ad54546634b68f067b0f3867f7283c998">dayCounter_</a>);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">// Set the interpolation.</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">if</span> (vcc.interpolation() == <span class="stringliteral">&quot;Linear&quot;</span>) {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Interpolation set to Linear.&quot;</span>);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vcc.interpolation() == <span class="stringliteral">&quot;Cubic&quot;</span>) {</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Setting interpolation to Cubic.&quot;</span>);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        tmp-&gt;setInterpolation&lt;Cubic&gt;();</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vcc.interpolation() == <span class="stringliteral">&quot;LogLinear&quot;</span>) {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Setting interpolation to LogLinear.&quot;</span>);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        tmp-&gt;setInterpolation&lt;LogLinear&gt;();</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Interpolation &quot;</span> &lt;&lt; vcc.interpolation() &lt;&lt; <span class="stringliteral">&quot; not recognised so leaving it Linear.&quot;</span>);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">// Set the volatility_ member after we have possibly updated the interpolation.</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a> = tmp;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="comment">// Set the extrapolation</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc">parseExtrapolation</a>(vcc.extrapolation()) == <a class="code" href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a745e3db6a7ffd50e1a72b39482f0882d">Extrapolation::Flat</a>) {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Enabling BlackVarianceCurve flat volatility extrapolation.&quot;</span>);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;enableExtrapolation();</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc">parseExtrapolation</a>(vcc.extrapolation()) == <a class="code" href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a6adf97f83acf6453d4a6a4b1070f3754">Extrapolation::None</a>) {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Disabling BlackVarianceCurve extrapolation.&quot;</span>);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;disableExtrapolation();</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc">parseExtrapolation</a>(vcc.extrapolation()) == Extrapolation::UseInterpolator) {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;BlackVarianceCurve does not support using interpolator for extrapolation &quot;</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;             &lt;&lt; <span class="stringliteral">&quot;so default to flat volatility extrapolation.&quot;</span>);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;enableExtrapolation();</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Unexpected extrapolation so default to flat volatility extrapolation.&quot;</span>);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;enableExtrapolation();</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <a class="code" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: finished building 1-D volatility curve&quot;</span>);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;}</div>
</div><!-- fragment --><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_commodity_vol_curve_a782cc59a036687f2402136c9003e07c2_cgraph.png" border="0" usemap="#aclassore_1_1data_1_1_commodity_vol_curve_a782cc59a036687f2402136c9003e07c2_cgraph" alt=""/></div>
<map name="classore_1_1data_1_1_commodity_vol_curve_a782cc59a036687f2402136c9003e07c2_cgraph" id="aclassore_1_1data_1_1_commodity_vol_curve_a782cc59a036687f2402136c9003e07c2_cgraph">
<area shape="rect" title="Build a volatility curve from a 1&#45;D curve of volatility quotes." alt="" coords="5,294,104,321"/>
<area shape="rect" href="classore_1_1data_1_1_curve_config.html#a745b9578f3aa0f77a9429764501e76bb" title=" " alt="" coords="179,5,328,47"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_curve_config.html#a71d04050567400ccff5ac423a9d1570e" title=" " alt="" coords="172,71,335,112"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_config.html#a83cc42ccc32e31a0b381be7782555cd2" title=" " alt="" coords="155,136,352,177"/>
<area shape="rect" href="namespaceore_1_1data.html#afbb6a9b32d74c08e52ac0984dcf2d880" title="checks if at most one element in C has a wild card and returns it in this case" alt="" coords="158,202,349,229"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_curve_config.html#a2a6f5a5c9b3b0d9dceb9f4de333cd9a9" title=" " alt="" coords="172,253,335,295"/>
<area shape="rect" href="classore_1_1data_1_1_loader.html#a6265c0b19e531f835ac5ae2283193a76" title="get all quotes, TODO change the return value to std::set" alt="" coords="189,319,317,360"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_config.html#a274ce630c64d8e1f9c038cde36c3055e" title=" " alt="" coords="155,384,352,425"/>
<area shape="rect" href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc" title="Parse Extrapolation from string." alt="" coords="159,450,348,477"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_curve_config.html#ab4850b56e8bad34c1c061fed3ade5d1a" title=" " alt="" coords="172,501,335,543"/>
<area shape="rect" href="classore_1_1data_1_1_quote_based_volatility_config.html#a422e72a3f8fbfdeb0cc3e232817fa3de" title=" " alt="" coords="152,567,355,608"/>
<area shape="rect" href="classore_1_1data_1_1_wildcard.html#a2c8716c3eecd1edf1c1675aa730d59e3" title=" " alt="" coords="403,195,535,236"/>
</map>
</div>

</div>
</div>
<a id="abcc61ebefadc0e8481bdf86dc739d23c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abcc61ebefadc0e8481bdf86dc739d23c">&#9670;&nbsp;</a></span>buildVolatility() <span class="overload">[3/7]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatility </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_volatility_strike_surface_config.html">VolatilityStrikeSurfaceConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vssc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;&#160;</td>
          <td class="paramname"><em>loader</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Build a volatility surface from a collection of expiry and absolute strike pairs. </p>

</div>
</div>
<a id="accbfc0352ecd2e4be852a0cc6238fbb5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#accbfc0352ecd2e4be852a0cc6238fbb5">&#9670;&nbsp;</a></span>buildVolatilityExplicit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatilityExplicit </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_volatility_strike_surface_config.html">VolatilityStrikeSurfaceConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vssc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;&#160;</td>
          <td class="paramname"><em>loader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; QuantLib::Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>configuredStrikes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Build a volatility surface from a collection of expiry and absolute strike pairs where the strikes and expiries are both explicitly configured i.e. where wild cards are not used for either the strikes or the expiries. </p>

<p class="definition">Definition at line <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l00728">728</a> of file <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                                                                                       {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <a class="code" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: start building 2-D volatility absolute strike surface with explicit strikes and expiries&quot;</span>);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160; </div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    QL_REQUIRE(vssc.quoteType() == <a class="code" href="classore_1_1data_1_1_market_datum.html#aa5b3ec8bb6c730c38b87a73c11dec808a51c1258108cb3ef6a757d4e01db7f115">MarketDatum::QuoteType::RATE_LNVOL</a>, <span class="stringliteral">&quot;CommodityVolCurve: only quote type&quot;</span> &lt;&lt;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <span class="stringliteral">&quot; RATE_LNVOL is currently supported for 2-D volatility strike surface with explicit strikes and expiries.&quot;</span>);</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160; </div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="comment">// Map to hold the rows of the commodity volatility matrix. The keys are the expiry dates and the values are the</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="comment">// vectors of volatilities, one for each configured strike.</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    map&lt;Date, vector&lt;Real&gt;&gt; surfaceData;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160; </div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="comment">// Count the number of quotes added. We check at the end that we have added all configured quotes.</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    Size quotesAdded = 0;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    Size skippedExpiredQuotes = 0;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="comment">// Loop over quotes and process commodity option quotes that have been requested</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> boost::shared_ptr&lt;MarketDatum&gt;&amp; md : loader.loadQuotes(asof)) {</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160; </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        <span class="comment">// Go to next quote if the market data point&#39;s date does not equal our asof.</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="keywordflow">if</span> (md-&gt;asofDate() != asof)</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="comment">// Go to next quote if not a commodity option quote.</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keyword">auto</span> q = boost::dynamic_pointer_cast&lt;CommodityOptionQuote&gt;(md);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <span class="keywordflow">if</span> (!q)</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <span class="comment">// This surface is for absolute strikes only.</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <span class="keyword">auto</span> strike = boost::dynamic_pointer_cast&lt;AbsoluteStrike&gt;(q-&gt;strike());</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keywordflow">if</span> (!strike)</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160; </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="comment">// If the quote is not in the configured quotes continue</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="keyword">auto</span> it = find(vc.quotes().begin(), vc.quotes().end(), q-&gt;name());</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <span class="keywordflow">if</span> (it == vc.quotes().end())</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="comment">// Process the quote</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        Date eDate = <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#a53aacd04237d728a4918ea672c79ba9f">getExpiry</a>(asof, q-&gt;expiry(), vc.futureConventionsId(), vc.optionExpiryRollDays());</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        </div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <span class="keywordflow">if</span> (eDate &gt; asof) {</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            <span class="comment">// Position of quote in vector of strikes</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            <span class="keyword">auto</span> strikeIt = find_if(configuredStrikes.begin(), configuredStrikes.end(),</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                                    [&amp;strike](Real s) { return close(s, strike-&gt;strike()); });</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            Size pos = distance(configuredStrikes.begin(), strikeIt);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            QL_REQUIRE(pos &lt; configuredStrikes.size(),</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                       <span class="stringliteral">&quot;The quote &#39;&quot;</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                           &lt;&lt; q-&gt;name()</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                           &lt;&lt; <span class="stringliteral">&quot;&#39; is in the list of configured quotes but does not match any of the configured strikes&quot;</span>);</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <span class="comment">// Add quote to surface</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            <span class="keywordflow">if</span> (surfaceData.count(eDate) == 0)</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                surfaceData[eDate] = vector&lt;Real&gt;(configuredStrikes.size(), Null&lt;Real&gt;());</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160; </div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            QL_REQUIRE(surfaceData[eDate][pos] == Null&lt;Real&gt;(),</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                       <span class="stringliteral">&quot;Quote &quot;</span> &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot; provides a duplicate quote for the date &quot;</span> &lt;&lt; io::iso_date(eDate)</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot; and the strike &quot;</span> &lt;&lt; configuredStrikes[pos]);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            surfaceData[eDate][pos] = q-&gt;quote()-&gt;value();</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            quotesAdded++;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160; </div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Added quote &quot;</span> &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot;: (&quot;</span> &lt;&lt; io::iso_date(eDate) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9)</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                                &lt;&lt; configuredStrikes[pos] &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; q-&gt;quote()-&gt;value() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            skippedExpiredQuotes++;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Skipped quote &quot;</span> &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot;: (&quot;</span> &lt;&lt; io::iso_date(eDate) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9)</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                                  &lt;&lt; q-&gt;quote()-&gt;value() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        }</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    }</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <a class="code" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: added &quot;</span> &lt;&lt; quotesAdded &lt;&lt; <span class="stringliteral">&quot; quotes in building explicit absolute strike surface.&quot;</span>);</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160; </div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    QL_REQUIRE(vc.quotes().size() == quotesAdded + skippedExpiredQuotes,</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;               <span class="stringliteral">&quot;Found &quot;</span> &lt;&lt; quotesAdded &lt;&lt; <span class="stringliteral">&quot; live quotes and &quot;</span> &lt;&lt; skippedExpiredQuotes &lt;&lt; <span class="stringliteral">&quot;expired quotes, but &quot;</span> &lt;&lt; vc.quotes().size()</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                        &lt;&lt; <span class="stringliteral">&quot; quotes required by config.&quot;</span>);</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160; </div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="comment">// Set up the BlackVarianceSurface. Note that the rows correspond to strikes and that the columns correspond to</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="comment">// the expiry dates in the matrix that is fed to the BlackVarianceSurface ctor.</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    vector&lt;Date&gt; expiryDates;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    Matrix volatilities = Matrix(configuredStrikes.size(), surfaceData.size());</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    Size expiryIdx = 0;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; expiryRow : surfaceData) {</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        expiryDates.push_back(expiryRow.first);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <span class="keywordflow">for</span> (Size i = 0; i &lt; configuredStrikes.size(); i++) {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            volatilities[i][expiryIdx] = expiryRow.second[i];</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        expiryIdx++;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    }</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160; </div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="comment">// Trace log the surface</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Explicit strike surface grid points:&quot;</span>);</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;expiry,strike,volatility&quot;</span>);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">for</span> (Size i = 0; i &lt; volatilities.rows(); i++) {</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        <span class="keywordflow">for</span> (Size j = 0; j &lt; volatilities.columns(); j++) {</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(io::iso_date(expiryDates[j])</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9) &lt;&lt; configuredStrikes[i] &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; volatilities[i][j]);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    }</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="comment">// Set the strike extrapolation which only matters if extrapolation is turned on for the whole surface.</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="comment">// BlackVarianceSurface time extrapolation is hard-coded to constant in volatility.</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <a class="code" href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5">BlackVarianceSurface::Extrapolation</a> strikeExtrap = BlackVarianceSurface::ConstantExtrapolation;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keywordflow">if</span> (vssc.extrapolation()) {</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160; </div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keyword">auto</span> strikeExtrapType = <a class="code" href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc">parseExtrapolation</a>(vssc.strikeExtrapolation());</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <span class="keywordflow">if</span> (strikeExtrapType == Extrapolation::UseInterpolator) {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Strike extrapolation switched to using interpolator.&quot;</span>);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            strikeExtrap = BlackVarianceSurface::InterpolatorDefaultExtrapolation;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strikeExtrapType == <a class="code" href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a6adf97f83acf6453d4a6a4b1070f3754">Extrapolation::None</a>) {</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Strike extrapolation cannot be turned off on its own so defaulting to flat.&quot;</span>);</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strikeExtrapType == <a class="code" href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a745e3db6a7ffd50e1a72b39482f0882d">Extrapolation::Flat</a>) {</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Strike extrapolation has been set to flat.&quot;</span>);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Strike extrapolation &quot;</span> &lt;&lt; strikeExtrapType &lt;&lt; <span class="stringliteral">&quot; not expected so default to flat.&quot;</span>);</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        }</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160; </div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="keyword">auto</span> timeExtrapType = <a class="code" href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc">parseExtrapolation</a>(vssc.timeExtrapolation());</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        <span class="keywordflow">if</span> (timeExtrapType != <a class="code" href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a745e3db6a7ffd50e1a72b39482f0882d">Extrapolation::Flat</a>) {</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;BlackVarianceSurface only supports flat volatility extrapolation in the time direction&quot;</span>);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        }</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Extrapolation is turned off for the whole surface so the time and&quot;</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;             &lt;&lt; <span class="stringliteral">&quot; strike extrapolation settings are ignored&quot;</span>);</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    }</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160; </div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Creating BlackVarianceSurface object&quot;</span>);</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="keyword">auto</span> tmp = boost::make_shared&lt;BlackVarianceSurface&gt;(asof, <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#a936be92f5f766489c24b9ce54d702b36">calendar_</a>, expiryDates, configuredStrikes, volatilities,</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                                                        <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#ad54546634b68f067b0f3867f7283c998">dayCounter_</a>, strikeExtrap, strikeExtrap);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160; </div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="comment">// Set the interpolation if configured properly. The default is Bilinear.</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">if</span> (!(vssc.timeInterpolation() == <span class="stringliteral">&quot;Linear&quot;</span> &amp;&amp; vssc.strikeInterpolation() == <span class="stringliteral">&quot;Linear&quot;</span>)) {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="keywordflow">if</span> (vssc.timeInterpolation() != vssc.strikeInterpolation()) {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;            <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Time and strike interpolation must be the same for BlackVarianceSurface but we got strike &quot;</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;interpolation &quot;</span> &lt;&lt; vssc.strikeInterpolation() &lt;&lt; <span class="stringliteral">&quot; and time interpolation &quot;</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                 &lt;&lt; vssc.timeInterpolation());</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vssc.timeInterpolation() == <span class="stringliteral">&quot;Cubic&quot;</span>) {</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Setting interpolation to BiCubic&quot;</span>);</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            tmp-&gt;setInterpolation&lt;Bicubic&gt;();</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Interpolation type &quot;</span> &lt;&lt; vssc.timeInterpolation() &lt;&lt; <span class="stringliteral">&quot; not supported in 2 dimensions&quot;</span>);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        }</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    }</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="comment">// Set the volatility_ member after we have possibly updated the interpolation.</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a> = tmp;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160; </div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Setting BlackVarianceSurface extrapolation to &quot;</span> &lt;&lt; <a class="code" href="group__utilities.html#ga1b8cd9a976247da6df232ad48d4af190">to_string</a>(vssc.extrapolation()));</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;enableExtrapolation(vssc.extrapolation());</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160; </div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <a class="code" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: finished building 2-D volatility absolute strike &quot;</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;surface with explicit strikes and expiries&quot;</span>);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;}</div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_commodity_vol_curve_accbfc0352ecd2e4be852a0cc6238fbb5_cgraph.png" border="0" usemap="#aclassore_1_1data_1_1_commodity_vol_curve_accbfc0352ecd2e4be852a0cc6238fbb5_cgraph" alt=""/></div>
<map name="classore_1_1data_1_1_commodity_vol_curve_accbfc0352ecd2e4be852a0cc6238fbb5_cgraph" id="aclassore_1_1data_1_1_commodity_vol_curve_accbfc0352ecd2e4be852a0cc6238fbb5_cgraph">
<area shape="rect" title=" " alt="" coords="5,359,148,386"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_surface_config.html#a7dd47beba239c5ffec6a4a50f4110664" title=" " alt="" coords="210,5,385,47"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_config.html#a83cc42ccc32e31a0b381be7782555cd2" title=" " alt="" coords="199,71,396,112"/>
<area shape="rect" href="classore_1_1data_1_1_loader.html#a6265c0b19e531f835ac5ae2283193a76" title="get all quotes, TODO change the return value to std::set" alt="" coords="233,136,361,177"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_config.html#a274ce630c64d8e1f9c038cde36c3055e" title=" " alt="" coords="199,201,396,243"/>
<area shape="rect" href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc" title="Parse Extrapolation from string." alt="" coords="203,267,392,294"/>
<area shape="rect" href="classore_1_1data_1_1_curve_config.html#acb4109b171873c911dca4a2c9f037135" title="Return all the market quotes required for this config." alt="" coords="223,319,372,360"/>
<area shape="rect" href="classore_1_1data_1_1_quote_based_volatility_config.html#a422e72a3f8fbfdeb0cc3e232817fa3de" title=" " alt="" coords="196,384,399,425"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_surface_config.html#ab066a0686be5c8dc20430121a7c7147d" title=" " alt="" coords="210,449,385,491"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_surface_config.html#aad34d8325ea5f1822af8c7a550880411" title=" " alt="" coords="210,515,385,556"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_surface_config.html#af0ab27eac5840f868d415cb197da2cf5" title=" " alt="" coords="210,580,385,621"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_surface_config.html#a13c055eb05fe7ed1272d0021b11a7d61" title=" " alt="" coords="210,645,385,687"/>
<area shape="rect" href="group__utilities.html#ga1b8cd9a976247da6df232ad48d4af190" title="Convert QuantLib::Date to std::string." alt="" coords="232,711,363,738"/>
</map>
</div>

</div>
</div>
<a id="aa772bf4579fcbb84db47720fd747a953"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa772bf4579fcbb84db47720fd747a953">&#9670;&nbsp;</a></span>buildVolatility() <span class="overload">[4/7]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatility </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_volatility_delta_surface_config.html">VolatilityDeltaSurfaceConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vdsc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;&#160;</td>
          <td class="paramname"><em>loader</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Build a volatility surface from a collection of expiry and strike pairs where the strikes are defined in terms of option delta and ATM values. </p>

</div>
</div>
<a id="a215f4878146bd685646285b1c621ce23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a215f4878146bd685646285b1c621ce23">&#9670;&nbsp;</a></span>buildVolatility() <span class="overload">[5/7]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatility </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_volatility_moneyness_surface_config.html">VolatilityMoneynessSurfaceConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vmsc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;&#160;</td>
          <td class="paramname"><em>loader</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Build a volatility surface from a collection of expiry and strike pairs where the strikes are defined in terms of moneyness levels. </p>

</div>
</div>
<a id="a6ec3a734b609ed0a997abc1b4d62fc91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ec3a734b609ed0a997abc1b4d62fc91">&#9670;&nbsp;</a></span>buildVolatility() <span class="overload">[6/7]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatility </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_volatility_apo_future_surface_config.html">VolatilityApoFutureSurfaceConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vapo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const QuantLib::Handle&lt; QuantLib::BlackVolTermStructure &gt; &amp;&#160;</td>
          <td class="paramname"><em>baseVts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const QuantLib::Handle&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">QuantExt::PriceTermStructure</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>basePts</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Build a future price APO surface using a given price term structure. Use the natural expiries of the future options as the expiry pillar points and use configured moneyness levels in the strike dimension. </p>

</div>
</div>
<a id="ab55a412b698dfa9d9c9a1c156098b680"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab55a412b698dfa9d9c9a1c156098b680">&#9670;&nbsp;</a></span>buildVolatility() <span class="overload">[7/7]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatility </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> &amp;&#160;</td>
          <td class="paramname"><em>spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_curve_configurations.html">CurveConfigurations</a> &amp;&#160;</td>
          <td class="paramname"><em>curveConfigs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_proxy_volatility_config.html">ProxyVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>pvc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_curve.html">CommodityCurve</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>comCurves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html">CommodityVolCurve</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>volCurves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_f_x_vol_curve.html">FXVolCurve</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>fxVolCurves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_correlation_curve.html">CorrelationCurve</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>correlationCurves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_market.html">Market</a> *&#160;</td>
          <td class="paramname"><em>fxIndices</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Build a volatility surface as a proxy from another volatility surface. </p>

<p class="definition">Definition at line <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l01425">1425</a> of file <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;                                                                                                              {</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160; </div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Build Proxy Vol surface&quot;</span>);</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="comment">// get all the configurations and the curve needed for proxying</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="keyword">auto</span> config = *<a class="code" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>.commodityVolatilityConfig(<a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#afd68572ab1a4e7f6cd7c303eafd8cac1">spec</a>.<a class="code" href="classore_1_1data_1_1_curve_spec.html#af40138bd8dabd4911947cc120ae18c20">curveConfigID</a>());</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160; </div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    <span class="keyword">auto</span> proxy = pvc.proxyVolatilityCurve();</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <span class="keyword">auto</span> comConfig = *<a class="code" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>.commodityCurveConfig(<a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#afd68572ab1a4e7f6cd7c303eafd8cac1">spec</a>.<a class="code" href="classore_1_1data_1_1_curve_spec.html#af40138bd8dabd4911947cc120ae18c20">curveConfigID</a>());</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <span class="keyword">auto</span> proxyConfig = *<a class="code" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>.commodityCurveConfig(proxy);</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    <span class="keyword">auto</span> proxyVolConfig = *<a class="code" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>.commodityVolatilityConfig(proxy);</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160; </div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="comment">// create dummy specs to look up the required curves</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    CommodityCurveSpec comSpec(comConfig.currency(), <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#afd68572ab1a4e7f6cd7c303eafd8cac1">spec</a>.<a class="code" href="classore_1_1data_1_1_curve_spec.html#af40138bd8dabd4911947cc120ae18c20">curveConfigID</a>());</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    CommodityCurveSpec proxySpec(proxyConfig.currency(), proxy);</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    CommodityVolatilityCurveSpec proxyVolSpec(proxyVolConfig.currency(), proxy);</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160; </div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="comment">// Get all necessary curves</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <span class="keyword">auto</span> curve = comCurves.find(comSpec.name());</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    QL_REQUIRE(curve != comCurves.end(),</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;               <span class="stringliteral">&quot;CommodityVolCurve: Failed to find commodity curve, when building commodity vol curve &quot;</span> &lt;&lt; <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#afd68572ab1a4e7f6cd7c303eafd8cac1">spec</a>.<a class="code" href="classore_1_1data_1_1_curve_spec.html#afa7a10b4b56522f03c698ac514b0f844">name</a>());</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="keyword">auto</span> proxyCurve = comCurves.find(proxySpec.name());</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    QL_REQUIRE(proxyCurve != comCurves.end(), <span class="stringliteral">&quot;currency: Failed to find commodity curve for proxy &quot;</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;                                                 &lt;&lt; proxySpec.name() &lt;&lt; <span class="stringliteral">&quot;, when building commodity vol curve &quot;</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;                                                 &lt;&lt; <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#afd68572ab1a4e7f6cd7c303eafd8cac1">spec</a>.<a class="code" href="classore_1_1data_1_1_curve_spec.html#afa7a10b4b56522f03c698ac514b0f844">name</a>());</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="keyword">auto</span> proxyVolCurve = volCurves.find(proxyVolSpec.name());</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    QL_REQUIRE(proxyVolCurve != volCurves.end(), <span class="stringliteral">&quot;CommodityVolCurve: Failed to find commodity vol curve for proxy &quot;</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;                                                       &lt;&lt; proxyVolSpec.name() &lt;&lt; <span class="stringliteral">&quot;, when building currency vol curve &quot;</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;                                                       &lt;&lt; <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#afd68572ab1a4e7f6cd7c303eafd8cac1">spec</a>.<a class="code" href="classore_1_1data_1_1_curve_spec.html#afa7a10b4b56522f03c698ac514b0f844">name</a>());</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160; </div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    <span class="comment">// check the currency against the proxy surface currrency</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160; </div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    boost::shared_ptr&lt;BlackVolTermStructure&gt; fxSurface;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    boost::shared_ptr&lt;FxIndex&gt; fxIndex;</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    boost::shared_ptr&lt;QuantExt::CorrelationTermStructure&gt; correlation;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    <span class="keywordflow">if</span> (config.currency() != proxyVolConfig.currency() &amp;&amp; fxIndices != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        QL_REQUIRE(!pvc.fxVolatilityCurve().empty(),</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;                   <span class="stringliteral">&quot;CommodityVolCurve: FXVolatilityCurve must be provided for commodity vol config &quot;</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;                       &lt;&lt; <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#afd68572ab1a4e7f6cd7c303eafd8cac1">spec</a>.<a class="code" href="classore_1_1data_1_1_curve_spec.html#af40138bd8dabd4911947cc120ae18c20">curveConfigID</a>() &lt;&lt; <span class="stringliteral">&quot; as proxy currencies if different from commodity currency.&quot;</span>);</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        QL_REQUIRE(!pvc.correlationCurve().empty(),</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;                   <span class="stringliteral">&quot;CommodityVolCurve: CorrelationCurve must be provided for commodity vol config &quot;</span></div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;                       &lt;&lt; <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#afd68572ab1a4e7f6cd7c303eafd8cac1">spec</a>.<a class="code" href="classore_1_1data_1_1_curve_spec.html#af40138bd8dabd4911947cc120ae18c20">curveConfigID</a>() &lt;&lt; <span class="stringliteral">&quot; as proxy currencies if different from commodity currency.&quot;</span>);</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160; </div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        <span class="comment">// get the fx vol surface</span></div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;        QL_REQUIRE(pvc.fxVolatilityCurve().size() == 6, <span class="stringliteral">&quot;CommodityVolCurve: FXVolatilityCurve provided &quot;</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;                                                             &lt;&lt; pvc.fxVolatilityCurve() &lt;&lt; <span class="stringliteral">&quot; for commodity vol config &quot;</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;                                                             &lt;&lt; <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#afd68572ab1a4e7f6cd7c303eafd8cac1">spec</a>.<a class="code" href="classore_1_1data_1_1_curve_spec.html#af40138bd8dabd4911947cc120ae18c20">curveConfigID</a>()</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;                                                             &lt;&lt; <span class="stringliteral">&quot; must be of length 6, and of form CC1CCY2 e.g EURUSD&quot;</span>);</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        <span class="keywordtype">string</span> proxyVolForCcy = pvc.fxVolatilityCurve().substr(0, 3);</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        <span class="keywordtype">string</span> proxyVolDomCcy = pvc.fxVolatilityCurve().substr(3, 3);</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        FXVolatilityCurveSpec fxSpec(proxyVolForCcy, proxyVolDomCcy, pvc.fxVolatilityCurve());</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        <span class="keyword">auto</span> volIt = fxVolCurves.find(fxSpec.name());</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;        <span class="keywordflow">if</span> (volIt == fxVolCurves.end())</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;            QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve: cannot find required Fx volatility surface &quot;</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;                    &lt;&lt; fxSpec.name() &lt;&lt; <span class="stringliteral">&quot; to build proxy vol surface for &quot;</span> &lt;&lt; comSpec.name());</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        fxSurface = volIt-&gt;second-&gt;volTermStructure();</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160; </div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        <span class="comment">// check if the fx vol surface needs to be inverted</span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        <span class="keywordflow">if</span> (proxyVolForCcy != proxyVolConfig.currency()) {</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;            Handle&lt;BlackVolTermStructure&gt; hFx(fxSurface);</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;            fxSurface = boost::make_shared&lt;QuantExt::BlackInvertedVolTermStructure&gt;(hFx);</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;            fxSurface-&gt;enableExtrapolation();</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        }</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160; </div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        fxIndex = fxIndices-&gt;fxIndex(proxyVolConfig.currency() + config.currency()).currentLink();</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        FXSpotSpec spotSpec(proxyVolConfig.currency(), config.currency());</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;        </div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;        CorrelationCurveSpec corrSpec(pvc.correlationCurve());</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        <span class="keyword">auto</span> corrIt = requiredCorrelationCurves.find(corrSpec.name());</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;        <span class="keywordflow">if</span> (corrIt == requiredCorrelationCurves.end())</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;            QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve: cannot find required correlation curve &quot;</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                    &lt;&lt; pvc.correlationCurve() &lt;&lt; <span class="stringliteral">&quot; to build proxy vol surface for &quot;</span> &lt;&lt; comSpec.name());</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        correlation = corrIt-&gt;second-&gt;corrTermStructure();</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    }</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160; </div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a> = boost::make_shared&lt;BlackVolatilitySurfaceProxy&gt;(</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        proxyVolCurve-&gt;second-&gt;volatility(), curve-&gt;second-&gt;commodityIndex(), proxyCurve-&gt;second-&gt;commodityIndex(),</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        fxSurface, fxIndex, correlation);</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;}</div>
</div><!-- fragment --><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_commodity_vol_curve_ab55a412b698dfa9d9c9a1c156098b680_cgraph.png" border="0" usemap="#aclassore_1_1data_1_1_commodity_vol_curve_ab55a412b698dfa9d9c9a1c156098b680_cgraph" alt=""/></div>
<map name="classore_1_1data_1_1_commodity_vol_curve_ab55a412b698dfa9d9c9a1c156098b680_cgraph" id="aclassore_1_1data_1_1_commodity_vol_curve_ab55a412b698dfa9d9c9a1c156098b680_cgraph">
<area shape="rect" title="Build a volatility surface as a proxy from another volatility surface." alt="" coords="5,177,104,203"/>
<area shape="rect" href="classore_1_1data_1_1_proxy_volatility_config.html#a202eea0c9db63c9182ad0fa06249a534" title=" " alt="" coords="159,5,325,47"/>
<area shape="rect" href="classore_1_1data_1_1_curve_spec.html#af40138bd8dabd4911947cc120ae18c20" title=" " alt="" coords="171,71,313,112"/>
<area shape="rect" href="classore_1_1data_1_1_market.html#ae46955de67dcc13f4bab380774f985dc" title=" " alt="" coords="177,136,307,177"/>
<area shape="rect" href="classore_1_1data_1_1_proxy_volatility_config.html#a2af3a0a0994bfd36ea63c3558f8234cf" title=" " alt="" coords="159,201,325,243"/>
<area shape="rect" href="classore_1_1data_1_1_curve_spec.html#afa7a10b4b56522f03c698ac514b0f844" title="returns the unique curve name" alt="" coords="171,267,313,308"/>
<area shape="rect" href="classore_1_1data_1_1_proxy_volatility_config.html#a62d0f9f8dea5b372303fdc2de239a5c3" title=" " alt="" coords="152,332,332,373"/>
<area shape="rect" href="classore_1_1data_1_1_curve_spec.html#a3d24768215bf6280c80eca3930ea3f55" title=" " alt="" coords="380,233,523,275"/>
<area shape="rect" href="classore_1_1data_1_1_curve_spec.html#a471fbcf9df5ab7ac2153495b4c8ac723" title=" " alt="" coords="380,299,523,340"/>
<area shape="rect" href="classore_1_1data_1_1_curve_spec.html#a0106d2fb6472e64456c6ebd018aa6300" title=" " alt="" coords="571,204,713,245"/>
<area shape="rect" href="group__utilities.html#ga1b8cd9a976247da6df232ad48d4af190" title="Convert QuantLib::Date to std::string." alt="" coords="577,270,707,297"/>
</map>
</div>

</div>
</div>
<a id="ab7e1102e1a7fab6db190335153446ece"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7e1102e1a7fab6db190335153446ece">&#9670;&nbsp;</a></span>correctFuturePriceCurve()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Handle&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">PriceTermStructure</a> &gt; correctFuturePriceCurve </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>contractName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const boost::shared_ptr&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">QuantExt::PriceTermStructure</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>pts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; QuantLib::Date &gt; &amp;&#160;</td>
          <td class="paramname"><em>optionExpiries</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Assume that the input price curve <code>pts</code> is a future price curve giving the price of a sequence of future contracts at the contract expiry. Create a copy of this input curve with additional pillar points at the future option contract expiries. The price returned when this curve is queried at the option contract expiry or the future contract expiry is the expected future contract price i.e. the quoted future price. We need this to allow option surface creation with our current infrastructure for options on futures in particular where the surface creation relies on knowing the "forward" price. </p>

<p class="definition">Definition at line <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l01509">1509</a> of file <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;                                                                                                                {</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160; </div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    <a class="code" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: start adding future price correction at option expiry.&quot;</span>);</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160; </div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    <span class="comment">// Gather curve dates and prices</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    map&lt;Date, Real&gt; curveData;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160; </div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    <span class="comment">// Get existing curve dates and prices. Messy but can&#39;t think of another way.</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    vector&lt;Date&gt; ptsDates;</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="codeRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;Linear&gt;</a>&gt;(pts)) {</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        ptsDates = ipc-&gt;pillarDates();</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="codeRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;LogLinear&gt;</a>&gt;(pts)) {</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        ptsDates = ipc-&gt;pillarDates();</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="codeRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;Cubic&gt;</a>&gt;(pts)) {</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        ptsDates = ipc-&gt;pillarDates();</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="codeRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;LinearFlat&gt;</a>&gt;(pts)) {</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        ptsDates = ipc-&gt;pillarDates();</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="codeRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;LogLinearFlat&gt;</a>&gt;(pts)) {</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        ptsDates = ipc-&gt;pillarDates();</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="codeRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;CubicFlat&gt;</a>&gt;(pts)) {</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        ptsDates = ipc-&gt;pillarDates();</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Could not cast the price term structure so do not have its pillar dates.&quot;</span>);</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    }</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160; </div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    <span class="comment">// Add existing dates and prices to data.</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Got &quot;</span> &lt;&lt; ptsDates.size() &lt;&lt; <span class="stringliteral">&quot; pillar dates from the price curve.&quot;</span>);</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> Date&amp; d : ptsDates) {</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        curveData[d] = pts-&gt;price(d);</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;        <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Added (&quot;</span> &lt;&lt; io::iso_date(d) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9) &lt;&lt; curveData.at(d) &lt;&lt; <span class="stringliteral">&quot;).&quot;</span>);</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    }</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160; </div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <span class="comment">// Add future price at option expiry to the curve i.e. override any interpolation between future option</span></div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <span class="comment">// expiry (oed) and future expiry (fed).</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> Date&amp; oed : optionExpiries) {</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        Date fed = <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#a365f188d3c44026746409d5540137c79">expCalc_</a>-&gt;nextExpiry(<span class="keyword">true</span>, oed, 0, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        <span class="comment">// In general, expect that the future expiry date will already be in curveData but maybe not.</span></div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        <span class="keyword">auto</span> it = curveData.find(fed);</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;        <span class="keywordflow">if</span> (it != curveData.end()) {</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;            curveData[oed] = it-&gt;second;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;            <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Found future expiry in existing data. (Option Expiry,Future Expiry,Future Price) is (&quot;</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;                 &lt;&lt; io::iso_date(oed) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; io::iso_date(fed) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9)</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;                 &lt;&lt; curveData.at(oed) &lt;&lt; <span class="stringliteral">&quot;).&quot;</span>);</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;            curveData[oed] = pts-&gt;price(fed);</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;            curveData[fed] = pts-&gt;price(fed);</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;            <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Future expiry not found in existing data. (Option Expiry,Future Expiry,Future Price) is (&quot;</span></div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;                 &lt;&lt; io::iso_date(oed) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; io::iso_date(fed) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9)</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;                 &lt;&lt; curveData.at(oed) &lt;&lt; <span class="stringliteral">&quot;).&quot;</span>);</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;        }</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    }</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160; </div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="comment">// Gather data for building the &quot;corrected&quot; curve.</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    vector&lt;Date&gt; curveDates;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    vector&lt;Real&gt; curvePrices;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; kv : curveData) {</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        curveDates.push_back(kv.first);</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;        curvePrices.push_back(kv.second);</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    }</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    DayCounter dc = pts-&gt;dayCounter();</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160; </div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="comment">// Create the &quot;corrected&quot; curve. Again messy but can&#39;t think of another way.</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    boost::shared_ptr&lt;PriceTermStructure&gt; cpts;</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="codeRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;Linear&gt;</a>&gt;(pts)) {</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;        cpts = boost::make_shared&lt;InterpolatedPriceCurve&lt;Linear&gt;&gt;(asof, curveDates, curvePrices, dc, pts-&gt;currency());</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="codeRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;LogLinear&gt;</a>&gt;(pts)) {</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;        cpts =</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;            boost::make_shared&lt;InterpolatedPriceCurve&lt;LogLinear&gt;&gt;(asof, curveDates, curvePrices, dc, pts-&gt;currency());</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="codeRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;Cubic&gt;</a>&gt;(pts)) {</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;        cpts = boost::make_shared&lt;InterpolatedPriceCurve&lt;Cubic&gt;&gt;(asof, curveDates, curvePrices, dc, pts-&gt;currency());</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="codeRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;LinearFlat&gt;</a>&gt;(pts)) {</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;        cpts =</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;            boost::make_shared&lt;InterpolatedPriceCurve&lt;LinearFlat&gt;&gt;(asof, curveDates, curvePrices, dc, pts-&gt;currency());</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="codeRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;LogLinearFlat&gt;</a>&gt;(pts)) {</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;        cpts = boost::make_shared&lt;InterpolatedPriceCurve&lt;LogLinearFlat&gt;&gt;(asof, curveDates, curvePrices, dc,</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                                                                         pts-&gt;currency());</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="codeRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;CubicFlat&gt;</a>&gt;(pts)) {</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        cpts =</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;            boost::make_shared&lt;InterpolatedPriceCurve&lt;CubicFlat&gt;&gt;(asof, curveDates, curvePrices, dc, pts-&gt;currency());</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;        <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Could not cast the price term structure so corrected curve is a linear InterpolatedPriceCurve.&quot;</span>);</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        cpts = boost::make_shared&lt;InterpolatedPriceCurve&lt;Linear&gt;&gt;(asof, curveDates, curvePrices, dc, pts-&gt;currency());</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    }</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    cpts-&gt;enableExtrapolation(pts-&gt;allowsExtrapolation());</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160; </div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    <a class="code" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: finished adding future price correction at option expiry.&quot;</span>);</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160; </div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    <span class="keywordflow">return</span> Handle&lt;PriceTermStructure&gt;(cpts);</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a53aacd04237d728a4918ea672c79ba9f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53aacd04237d728a4918ea672c79ba9f">&#9670;&nbsp;</a></span>getExpiry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Date getExpiry </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_expiry.html">Expiry</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>expiry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Natural&#160;</td>
          <td class="paramname"><em>rollDays</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get an explicit expiry date from a commodity option quote's <a class="el" href="classore_1_1data_1_1_expiry.html">Expiry</a>. </p>

<p class="definition">Definition at line <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l01601">1601</a> of file <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;                                                          {</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160; </div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    Date result;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160; </div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">auto</span> expiryDate = boost::dynamic_pointer_cast&lt;ExpiryDate&gt;(expiry)) {</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;        result = expiryDate-&gt;expiryDate();</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> expiryPeriod = boost::dynamic_pointer_cast&lt;ExpiryPeriod&gt;(expiry)) {</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;        <span class="comment">// We may need more conventions here eventually.</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        result = <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#a936be92f5f766489c24b9ce54d702b36">calendar_</a>.adjust(asof + expiryPeriod-&gt;expiryPeriod());</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> fcExpiry = boost::dynamic_pointer_cast&lt;FutureContinuationExpiry&gt;(expiry)) {</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160; </div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;        QL_REQUIRE(<a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#a365f188d3c44026746409d5540137c79">expCalc_</a>, <span class="stringliteral">&quot;CommodityVolCurve::getExpiry: need a future expiry calculator for continuation quotes.&quot;</span>);</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;        QL_REQUIRE(<a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#ad9d85bafc53967e3a27153fbc1f3905d">convention_</a>, <span class="stringliteral">&quot;CommodityVolCurve::getExpiry: need a future convention for continuation quotes.&quot;</span>);</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Future option continuation expiry is &quot;</span> &lt;&lt; *fcExpiry);</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160; </div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;        <span class="comment">// Firstly, get the next option expiry on or after the asof date</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        result = <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#a365f188d3c44026746409d5540137c79">expCalc_</a>-&gt;nextExpiry(<span class="keyword">true</span>, asof, 0, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;        <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;CommodityVolCurve::getExpiry: next option expiry relative to &quot;</span> &lt;&lt; io::iso_date(asof) &lt;&lt; <span class="stringliteral">&quot; is &quot;</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;                                                                             &lt;&lt; io::iso_date(result) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160; </div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;        <span class="comment">// Market quotes may be delivered with a given number of roll days.</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        <span class="keywordflow">if</span> (rollDays &gt; 0) {</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;            Date roll;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;            roll = <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#a936be92f5f766489c24b9ce54d702b36">calendar_</a>.advance(result, -<span class="keyword">static_cast&lt;</span>Integer<span class="keyword">&gt;</span>(rollDays), Days);</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;            <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;CommodityVolCurve::getExpiry: roll days is &quot;</span> &lt;&lt; rollDays &lt;&lt; <span class="stringliteral">&quot; giving a roll date &quot;</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;                                                               &lt;&lt; io::iso_date(roll) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;            <span class="comment">// Take the next option expiry if the roll days means the roll date is before asof.</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;            <span class="keywordflow">if</span> (roll &lt; asof) {</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                result = <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#a365f188d3c44026746409d5540137c79">expCalc_</a>-&gt;nextExpiry(<span class="keyword">true</span>, asof, 1, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                roll = <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#a936be92f5f766489c24b9ce54d702b36">calendar_</a>.advance(result, -<span class="keyword">static_cast&lt;</span>Integer<span class="keyword">&gt;</span>(rollDays), Days);</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                QL_REQUIRE(roll &gt; asof, <span class="stringliteral">&quot;CommodityVolCurve::getExpiry: expected roll to be greater than asof.&quot;</span>);</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;CommodityVolCurve::getExpiry: roll date &quot;</span> &lt;&lt; io::iso_date(roll) &lt;&lt; <span class="stringliteral">&quot; is less than asof &quot;</span></div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;                                                                &lt;&lt; io::iso_date(asof) &lt;&lt; <span class="stringliteral">&quot; so take next option expiry &quot;</span></div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                                                                &lt;&lt; io::iso_date(result));</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;            }</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;        }</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160; </div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;        <span class="comment">// At this stage, &#39;result&#39; should hold the next option expiry on or after the asof date accounting for roll </span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        <span class="comment">// days.</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;        <a class="code" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;CommodityVolCurve::getExpiry: first option expiry is &quot;</span> &lt;&lt; io::iso_date(result) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160; </div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;        <span class="comment">// If the continuation index is greater than 1 get the corresponding expiry.</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;        Natural fcIndex = fcExpiry-&gt;expiryIndex();</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160; </div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        <span class="comment">// The option continuation expiry may be mapped to another one.</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; ocm = <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#ad9d85bafc53967e3a27153fbc1f3905d">convention_</a>-&gt;optionContinuationMappings();</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;        <span class="keyword">auto</span> it = ocm.find(fcIndex);</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;        <span class="keywordflow">if</span> (it != ocm.end())</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;            fcIndex = it-&gt;second;</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160; </div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;        <span class="keywordflow">if</span> (fcIndex &gt; 1) {</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;            result += 1 * Days;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;            result = <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#a365f188d3c44026746409d5540137c79">expCalc_</a>-&gt;nextExpiry(<span class="keyword">true</span>, result, fcIndex - 2, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        }</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160; </div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;        <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Expiry date corresponding to continuation expiry, &quot;</span> &lt;&lt; *fcExpiry &lt;&lt;</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;            <span class="stringliteral">&quot;, is &quot;</span> &lt;&lt; io::iso_date(result) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160; </div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve::getExpiry: cannot determine expiry type.&quot;</span>);</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    }</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160; </div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a74e52708d793e99ad834733005aeece9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74e52708d793e99ad834733005aeece9">&#9670;&nbsp;</a></span>populateCurves()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void populateCurves </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_yield_curve.html">YieldCurve</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>yieldCurves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_curve.html">CommodityCurve</a> &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>commodityCurves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>searchYield</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>dontThrow</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Populate price curve, <code>pts_</code>, and yield curve, <code>yts_</code>. </p>

<p class="definition">Definition at line <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l01667">1667</a> of file <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;                                                                         {</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160; </div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    <span class="keywordflow">if</span> (searchYield) {</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; ytsId = config.yieldCurveId();</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;        <span class="keywordflow">if</span> (!ytsId.empty()) {</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;            <span class="keyword">auto</span> itYts = yieldCurves.find(ytsId);</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;            <span class="keywordflow">if</span> (itYts != yieldCurves.end()) {</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;                <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#acb845122ddd1a21e03828d0cd39f2e0f">yts_</a> = itYts-&gt;second-&gt;handle();</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!dontThrow) {</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;                QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve: can&#39;t find yield curve with id &quot;</span> &lt;&lt; ytsId);</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;            }</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!dontThrow) {</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;            QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve: YieldCurveId was not populated for &quot;</span> &lt;&lt; config.curveID());</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;        }</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    }</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160; </div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; ptsId = config.priceCurveId();</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <span class="keywordflow">if</span> (!ptsId.empty()) {</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;        <span class="keyword">auto</span> itPts = commodityCurves.find(ptsId);</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;        <span class="keywordflow">if</span> (itPts != commodityCurves.end()) {</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;            <a class="code" href="classore_1_1data_1_1_commodity_vol_curve.html#a2bf289bf605afd1052086f88a33fc2d1">pts_</a> = Handle&lt;PriceTermStructure&gt;(itPts-&gt;second-&gt;commodityPriceCurve());</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!dontThrow) {</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;            QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve: can&#39;t find price curve with id &quot;</span> &lt;&lt; ptsId);</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;        }</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!dontThrow) {</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;        QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve: PriceCurveId was not populated for &quot;</span> &lt;&lt; config.curveID());</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    }</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;}</div>
</div><!-- fragment --><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_commodity_vol_curve_a74e52708d793e99ad834733005aeece9_cgraph.png" border="0" usemap="#aclassore_1_1data_1_1_commodity_vol_curve_a74e52708d793e99ad834733005aeece9_cgraph" alt=""/></div>
<map name="classore_1_1data_1_1_commodity_vol_curve_a74e52708d793e99ad834733005aeece9_cgraph" id="aclassore_1_1data_1_1_commodity_vol_curve_a74e52708d793e99ad834733005aeece9_cgraph">
<area shape="rect" title="Populate price curve, pts_, and yield curve, yts_." alt="" coords="5,78,116,105"/>
<area shape="rect" href="classore_1_1data_1_1_curve_config.html#a745b9578f3aa0f77a9429764501e76bb" title=" " alt="" coords="188,5,337,47"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_config.html#a2fbdc44fecf20e44e0628909ec636b59" title=" " alt="" coords="164,71,361,112"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_config.html#a2ae1d7d237a824b8c80c8d1afc4bcdb1" title=" " alt="" coords="164,136,361,177"/>
</map>
</div>

</div>
</div>
<a id="acc2a1854aa88b4b0963f1567425ba06c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc2a1854aa88b4b0963f1567425ba06c">&#9670;&nbsp;</a></span>checkMoneyness()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt; Real &gt; checkMoneyness </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>moneynessLevels</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check and return moneyness levels. </p>

<p class="definition">Definition at line <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l01699">1699</a> of file <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;                                                                                             {</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160; </div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <span class="keyword">using</span> boost::adaptors::transformed;</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    <span class="keyword">using</span> boost::algorithm::join;</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160; </div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    vector&lt;Real&gt; moneynessLevels = parseVectorOfValues&lt;Real&gt;(strMoneynessLevels, &amp;<a class="code" href="group__utilities.html#gad1db2a68f9a73667c3b4084d63955bdd">parseReal</a>);</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    sort(moneynessLevels.begin(), moneynessLevels.end(), [](Real x, Real y) { return !close(x, y) &amp;&amp; x &lt; y; });</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    QL_REQUIRE(adjacent_find(moneynessLevels.begin(), moneynessLevels.end(),</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                             [](Real x, Real y) { return close(x, y); }) == moneynessLevels.end(),</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;               <span class="stringliteral">&quot;The configured moneyness levels contain duplicates&quot;</span>);</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Parsed &quot;</span> &lt;&lt; moneynessLevels.size() &lt;&lt; <span class="stringliteral">&quot; unique configured moneyness levels.&quot;</span>);</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <a class="code" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;The moneyness levels are: &quot;</span> &lt;&lt; join(</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;             moneynessLevels | transformed([](Real d) { <span class="keywordflow">return</span> <a class="code" href="group__utilities.html#ga1b8cd9a976247da6df232ad48d4af190">ore::data::to_string</a>(d); }), <span class="stringliteral">&quot;,&quot;</span>));</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160; </div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="keywordflow">return</span> moneynessLevels;</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;}</div>
</div><!-- fragment --><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_commodity_vol_curve_acc2a1854aa88b4b0963f1567425ba06c_cgraph.png" border="0" usemap="#aclassore_1_1data_1_1_commodity_vol_curve_acc2a1854aa88b4b0963f1567425ba06c_cgraph" alt=""/></div>
<map name="classore_1_1data_1_1_commodity_vol_curve_acc2a1854aa88b4b0963f1567425ba06c_cgraph" id="aclassore_1_1data_1_1_commodity_vol_curve_acc2a1854aa88b4b0963f1567425ba06c_cgraph">
<area shape="rect" title="Check and return moneyness levels." alt="" coords="5,31,129,57"/>
<area shape="rect" href="group__utilities.html#gad1db2a68f9a73667c3b4084d63955bdd" title="Convert text to Real." alt="" coords="177,5,316,32"/>
<area shape="rect" href="group__utilities.html#ga1b8cd9a976247da6df232ad48d4af190" title="Convert QuantLib::Date to std::string." alt="" coords="181,56,312,83"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a2d6d676f5b66ce3ee357e308044138ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d6d676f5b66ce3ee357e308044138ba">&#9670;&nbsp;</a></span>spec_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> spec_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00067">67</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="abf4baf7de4b5a3c87a9d9291f7a18116"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf4baf7de4b5a3c87a9d9291f7a18116">&#9670;&nbsp;</a></span>volatility_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt;QuantLib::BlackVolTermStructure&gt; volatility_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00068">68</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="a365f188d3c44026746409d5540137c79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a365f188d3c44026746409d5540137c79">&#9670;&nbsp;</a></span>expCalc_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt;<a class="elRef" href="../qle/class_quant_ext_1_1_future_expiry_calculator.html">QuantExt::FutureExpiryCalculator</a>&gt; expCalc_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00069">69</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="ad9d85bafc53967e3a27153fbc1f3905d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9d85bafc53967e3a27153fbc1f3905d">&#9670;&nbsp;</a></span>convention_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt;<a class="el" href="classore_1_1data_1_1_commodity_future_convention.html">CommodityFutureConvention</a>&gt; convention_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00070">70</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="a936be92f5f766489c24b9ce54d702b36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a936be92f5f766489c24b9ce54d702b36">&#9670;&nbsp;</a></span>calendar_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::Calendar calendar_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00071">71</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="ad54546634b68f067b0f3867f7283c998"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad54546634b68f067b0f3867f7283c998">&#9670;&nbsp;</a></span>dayCounter_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::DayCounter dayCounter_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00072">72</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="a2bf289bf605afd1052086f88a33fc2d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2bf289bf605afd1052086f88a33fc2d1">&#9670;&nbsp;</a></span>pts_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::Handle&lt;<a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">QuantExt::PriceTermStructure</a>&gt; pts_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00075">75</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="acb845122ddd1a21e03828d0cd39f2e0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb845122ddd1a21e03828d0cd39f2e0f">&#9670;&nbsp;</a></span>yts_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::Handle&lt;QuantLib::YieldTermStructure&gt; yts_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00076">76</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<div class="ttc" id="aclassore_1_1data_1_1_curve_spec_html_afa7a10b4b56522f03c698ac514b0f844"><div class="ttname"><a href="classore_1_1data_1_1_curve_spec.html#afa7a10b4b56522f03c698ac514b0f844">ore::data::CurveSpec::name</a></div><div class="ttdeci">string name() const</div><div class="ttdoc">returns the unique curve name</div><div class="ttdef"><b>Definition:</b> <a href="curvespec_8hpp_source.html#l00078">curvespec.hpp:78</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a8e2df513f6590afb6c85a22a458745c5a6adf97f83acf6453d4a6a4b1070f3754"><div class="ttname"><a href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a6adf97f83acf6453d4a6a4b1070f3754">ore::data::Extrapolation::None</a></div><div class="ttdeci">@ None</div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_afd68572ab1a4e7f6cd7c303eafd8cac1"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#afd68572ab1a4e7f6cd7c303eafd8cac1">ore::data::CommodityVolCurve::spec</a></div><div class="ttdeci">const CommodityVolatilityCurveSpec &amp; spec() const</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00062">commodityvolcurve.hpp:62</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_curve_spec_html_af40138bd8dabd4911947cc120ae18c20"><div class="ttname"><a href="classore_1_1data_1_1_curve_spec.html#af40138bd8dabd4911947cc120ae18c20">ore::data::CurveSpec::curveConfigID</a></div><div class="ttdeci">const std::string &amp; curveConfigID() const</div><div class="ttdef"><b>Definition:</b> <a href="curvespec_8hpp_source.html#l00083">curvespec.hpp:83</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a8e2df513f6590afb6c85a22a458745c5a745e3db6a7ffd50e1a72b39482f0882d"><div class="ttname"><a href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a745e3db6a7ffd50e1a72b39482f0882d">ore::data::Extrapolation::Flat</a></div><div class="ttdeci">@ Flat</div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_a2bf289bf605afd1052086f88a33fc2d1"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#a2bf289bf605afd1052086f88a33fc2d1">ore::data::CommodityVolCurve::pts_</a></div><div class="ttdeci">QuantLib::Handle&lt; QuantExt::PriceTermStructure &gt; pts_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00075">commodityvolcurve.hpp:75</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_a2d6d676f5b66ce3ee357e308044138ba"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#a2d6d676f5b66ce3ee357e308044138ba">ore::data::CommodityVolCurve::spec_</a></div><div class="ttdeci">CommodityVolatilityCurveSpec spec_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00067">commodityvolcurve.hpp:67</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_afbb6a9b32d74c08e52ac0984dcf2d880"><div class="ttname"><a href="namespaceore_1_1data.html#afbb6a9b32d74c08e52ac0984dcf2d880">ore::data::getUniqueWildcard</a></div><div class="ttdeci">boost::optional&lt; Wildcard &gt; getUniqueWildcard(const C &amp;c)</div><div class="ttdoc">checks if at most one element in C has a wild card and returns it in this case</div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8hpp_source.html#l00065">wildcard.hpp:65</a></div></div>
<div class="ttc" id="alog_8hpp_html_a9622ca943201e814041f051b7a10b3ea"><div class="ttname"><a href="log_8hpp.html#a9622ca943201e814041f051b7a10b3ea">WLOG</a></div><div class="ttdeci">#define WLOG(text)</div><div class="ttdoc">Logging Macro (Level = Warning)</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00338">log.hpp:338</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_ad54546634b68f067b0f3867f7283c998"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#ad54546634b68f067b0f3867f7283c998">ore::data::CommodityVolCurve::dayCounter_</a></div><div class="ttdeci">QuantLib::DayCounter dayCounter_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00072">commodityvolcurve.hpp:72</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_market_datum_html_aa5b3ec8bb6c730c38b87a73c11dec808a51c1258108cb3ef6a757d4e01db7f115"><div class="ttname"><a href="classore_1_1data_1_1_market_datum.html#aa5b3ec8bb6c730c38b87a73c11dec808a51c1258108cb3ef6a757d4e01db7f115">ore::data::MarketDatum::QuoteType::RATE_LNVOL</a></div><div class="ttdeci">@ RATE_LNVOL</div></div>
<div class="ttc" id="alog_8hpp_html_a34c7c8cde9b91d2eee82d7b9a0b66fd5"><div class="ttname"><a href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a></div><div class="ttdeci">#define DLOG(text)</div><div class="ttdoc">Logging Macro (Level = Debug)</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00342">log.hpp:342</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_a365f188d3c44026746409d5540137c79"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#a365f188d3c44026746409d5540137c79">ore::data::CommodityVolCurve::expCalc_</a></div><div class="ttdeci">boost::shared_ptr&lt; QuantExt::FutureExpiryCalculator &gt; expCalc_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00069">commodityvolcurve.hpp:69</a></div></div>
<div class="ttc" id="agroup__utilities_html_ga1b8cd9a976247da6df232ad48d4af190"><div class="ttname"><a href="group__utilities.html#ga1b8cd9a976247da6df232ad48d4af190">ore::data::to_string</a></div><div class="ttdeci">std::string to_string(const QuantLib::Date &amp;date)</div><div class="ttdoc">Convert QuantLib::Date to std::string.</div><div class="ttdef"><b>Definition:</b> <a href="to__string_8cpp_source.html#l00038">to_string.cpp:38</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_interpolated_price_curve_html"><div class="ttname"><a href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">QuantExt::InterpolatedPriceCurve</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_a936be92f5f766489c24b9ce54d702b36"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#a936be92f5f766489c24b9ce54d702b36">ore::data::CommodityVolCurve::calendar_</a></div><div class="ttdeci">QuantLib::Calendar calendar_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00071">commodityvolcurve.hpp:71</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_abf4baf7de4b5a3c87a9d9291f7a18116"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">ore::data::CommodityVolCurve::volatility_</a></div><div class="ttdeci">boost::shared_ptr&lt; QuantLib::BlackVolTermStructure &gt; volatility_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00068">commodityvolcurve.hpp:68</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a8e2df513f6590afb6c85a22a458745c5"><div class="ttname"><a href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5">ore::data::Extrapolation</a></div><div class="ttdeci">Extrapolation</div><div class="ttdoc">Enumeration for holding various extrapolation settings.</div><div class="ttdef"><b>Definition:</b> <a href="parsers_8hpp_source.html#l00422">parsers.hpp:422</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_a53aacd04237d728a4918ea672c79ba9f"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#a53aacd04237d728a4918ea672c79ba9f">ore::data::CommodityVolCurve::getExpiry</a></div><div class="ttdeci">QuantLib::Date getExpiry(const QuantLib::Date &amp;asof, const boost::shared_ptr&lt; Expiry &gt; &amp;expiry, const std::string &amp;name, QuantLib::Natural rollDays) const</div><div class="ttdoc">Get an explicit expiry date from a commodity option quote's Expiry.</div><div class="ttdef"><b>Definition:</b> <a href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l01601">commodityvolcurve.cpp:1601</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_ad9d85bafc53967e3a27153fbc1f3905d"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#ad9d85bafc53967e3a27153fbc1f3905d">ore::data::CommodityVolCurve::convention_</a></div><div class="ttdeci">boost::shared_ptr&lt; CommodityFutureConvention &gt; convention_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00070">commodityvolcurve.hpp:70</a></div></div>
<div class="ttc" id="alog_8hpp_html_a99aeca53f904c71a68070e1f9d310232"><div class="ttname"><a href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a></div><div class="ttdeci">#define TLOG(text)</div><div class="ttdoc">Logging Macro (Level = Data)</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00344">log.hpp:344</a></div></div>
<div class="ttc" id="atest_2commodityvolcurve_8cpp_html_a96a582300d10244c7df851066de48438"><div class="ttname"><a href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a></div><div class="ttdeci">vector&lt; string &gt; curveConfigs</div><div class="ttdef"><b>Definition:</b> <a href="test_2commodityvolcurve_8cpp_source.html#l00525">commodityvolcurve.cpp:525</a></div></div>
<div class="ttc" id="alog_8hpp_html_a158e0f085ddedfe5c8ed069986039f50"><div class="ttname"><a href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a></div><div class="ttdeci">#define LOG(text)</div><div class="ttdoc">Logging Macro (Level = Notice)</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00340">log.hpp:340</a></div></div>
<div class="ttc" id="agroup__utilities_html_gad1db2a68f9a73667c3b4084d63955bdd"><div class="ttname"><a href="group__utilities.html#gad1db2a68f9a73667c3b4084d63955bdd">ore::data::parseReal</a></div><div class="ttdeci">Real parseReal(const string &amp;s)</div><div class="ttdoc">Convert text to Real.</div><div class="ttdef"><b>Definition:</b> <a href="parsers_8cpp_source.html#l00112">parsers.cpp:112</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_aec1b45a4f7d2f40e0800b91d415b94fc"><div class="ttname"><a href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc">ore::data::parseExtrapolation</a></div><div class="ttdeci">Extrapolation parseExtrapolation(const string &amp;s)</div><div class="ttdoc">Parse Extrapolation from string.</div><div class="ttdef"><b>Definition:</b> <a href="parsers_8cpp_source.html#l00722">parsers.cpp:722</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_acb845122ddd1a21e03828d0cd39f2e0f"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#acb845122ddd1a21e03828d0cd39f2e0f">ore::data::CommodityVolCurve::yts_</a></div><div class="ttdeci">QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt; yts_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00076">commodityvolcurve.hpp:76</a></div></div>
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.8.20
</small></address>
</body>
</html>
