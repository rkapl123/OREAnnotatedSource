<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<title>OREData: CommodityVolCurve Class Reference</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="oredextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-data@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.8.11</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceore.html">ore</a></li><li class="navelem"><a class="el" href="namespaceore_1_1data.html">data</a></li><li class="navelem"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html">CommodityVolCurve</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="classore_1_1data_1_1_commodity_vol_curve-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">CommodityVolCurve Class Reference<div class="ingroups"><a class="el" href="group__marketdata.html">Market Data</a> &raquo; <a class="el" href="group__curves.html">Curves</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Wrapper class for building commodity volatility structures.  
 <a href="classore_1_1data_1_1_commodity_vol_curve.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="commodityvolcurve_8hpp_source.html">ored/marketdata/commodityvolcurve.hpp</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for CommodityVolCurve:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_commodity_vol_curve__coll__graph.png" border="0" usemap="#a_commodity_vol_curve_coll__map" alt="Collaboration graph"/></div>
<map name="a_commodity_vol_curve_coll__map" id="a_commodity_vol_curve_coll__map">
<area shape="rect" title="Wrapper class for building commodity volatility structures." alt="" coords="870,668,1049,1001"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html" title="Commodity volatility description." alt="" coords="5,404,209,605"/>
<area shape="rect" href="classore_1_1data_1_1_curve_spec.html" title="Curve Specification." alt="" coords="203,197,321,355"/>
<area shape="rect" title=" " alt="" coords="115,95,174,135"/>
<area shape="rect" title=" " alt="" coords="71,5,218,45"/>
<area shape="rect" title=" " alt="" coords="234,477,410,532"/>
<area shape="rect" title=" " alt="" coords="435,477,609,532"/>
<area shape="rect" title=" " alt="" coords="634,477,842,532"/>
<area shape="rect" title=" " alt="" coords="866,485,943,525"/>
<area shape="rect" title=" " alt="" coords="968,485,1063,525"/>
<area shape="rect" title=" " alt="" coords="1087,477,1298,532"/>
<area shape="rect" title=" " alt="" coords="1322,485,1375,525"/>
<area shape="rect" title=" " alt="" coords="1399,477,1599,532"/>
<area shape="rect" title=" " alt="" coords="1624,477,1820,532"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader">Constructors</div></td></tr>
<tr class="memitem:ac00829921b76f3148a8851001de1ceb3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#ac00829921b76f3148a8851001de1ceb3">CommodityVolCurve</a> ()</td></tr>
<tr class="memdesc:ac00829921b76f3148a8851001de1ceb3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default constructor.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#ac00829921b76f3148a8851001de1ceb3">More...</a><br /></td></tr>
<tr class="separator:ac00829921b76f3148a8851001de1ceb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8652808d1887e8dd4b619df49d9881b9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a8652808d1887e8dd4b619df49d9881b9">CommodityVolCurve</a> (const QuantLib::Date &amp;asof, const <a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> &amp;<a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#aa29667d9b43959f91d90f8a9df92eec2">spec</a>, const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;loader, const <a class="el" href="classore_1_1data_1_1_curve_configurations.html">CurveConfigurations</a> &amp;<a class="el" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>, const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_yield_curve.html">YieldCurve</a> &gt; &gt; &amp;yieldCurves={}, const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_curve.html">CommodityCurve</a> &gt; &gt; &amp;commodityCurves={}, const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html">CommodityVolCurve</a> &gt; &gt; &amp;commodityVolCurves={}, const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_f_x_vol_curve.html">FXVolCurve</a> &gt; &gt; &amp;fxVolCurves={}, const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_correlation_curve.html">CorrelationCurve</a> &gt; &gt; &amp;correlationCurves={}, const <a class="el" href="classore_1_1data_1_1_market.html">Market</a> *fxIndices=nullptr, const <a class="el" href="classbool.html">bool</a> buildCalibrationInfo=true)</td></tr>
<tr class="memdesc:a8652808d1887e8dd4b619df49d9881b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Detailed constructor.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#a8652808d1887e8dd4b619df49d9881b9">More...</a><br /></td></tr>
<tr class="separator:a8652808d1887e8dd4b619df49d9881b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader">Inspectors</h2></td></tr>
<tr class="memitem:a2d6d676f5b66ce3ee357e308044138ba"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a2d6d676f5b66ce3ee357e308044138ba">spec_</a></td></tr>
<tr class="separator:a2d6d676f5b66ce3ee357e308044138ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf4baf7de4b5a3c87a9d9291f7a18116"><td class="memItemLeft" align="right" valign="top">boost::shared_ptr&lt; QuantLib::BlackVolTermStructure &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a></td></tr>
<tr class="separator:abf4baf7de4b5a3c87a9d9291f7a18116"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a365f188d3c44026746409d5540137c79"><td class="memItemLeft" align="right" valign="top">boost::shared_ptr&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_future_expiry_calculator.html">QuantExt::FutureExpiryCalculator</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a365f188d3c44026746409d5540137c79">expCalc_</a></td></tr>
<tr class="separator:a365f188d3c44026746409d5540137c79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9d85bafc53967e3a27153fbc1f3905d"><td class="memItemLeft" align="right" valign="top">boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_future_convention.html">CommodityFutureConvention</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#ad9d85bafc53967e3a27153fbc1f3905d">convention_</a></td></tr>
<tr class="separator:ad9d85bafc53967e3a27153fbc1f3905d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a936be92f5f766489c24b9ce54d702b36"><td class="memItemLeft" align="right" valign="top">QuantLib::Calendar&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a936be92f5f766489c24b9ce54d702b36">calendar_</a></td></tr>
<tr class="separator:a936be92f5f766489c24b9ce54d702b36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad54546634b68f067b0f3867f7283c998"><td class="memItemLeft" align="right" valign="top">QuantLib::DayCounter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#ad54546634b68f067b0f3867f7283c998">dayCounter_</a></td></tr>
<tr class="separator:ad54546634b68f067b0f3867f7283c998"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6406d74151328ae90b3ebeecaf0ba9a9"><td class="memItemLeft" align="right" valign="top">boost::shared_ptr&lt; <a class="el" href="structore_1_1data_1_1_fx_eq_comm_vol_calibration_info.html">FxEqCommVolCalibrationInfo</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a6406d74151328ae90b3ebeecaf0ba9a9">calibrationInfo_</a></td></tr>
<tr class="separator:a6406d74151328ae90b3ebeecaf0ba9a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83e7c296e20653ab73fa6c3b2ebed22a"><td class="memItemLeft" align="right" valign="top">QuantLib::Date&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a83e7c296e20653ab73fa6c3b2ebed22a">maxExpiry_</a></td></tr>
<tr class="separator:a83e7c296e20653ab73fa6c3b2ebed22a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bf289bf605afd1052086f88a33fc2d1"><td class="memItemLeft" align="right" valign="top">QuantLib::Handle&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">QuantExt::PriceTermStructure</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a2bf289bf605afd1052086f88a33fc2d1">pts_</a></td></tr>
<tr class="separator:a2bf289bf605afd1052086f88a33fc2d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb845122ddd1a21e03828d0cd39f2e0f"><td class="memItemLeft" align="right" valign="top">QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#acb845122ddd1a21e03828d0cd39f2e0f">yts_</a></td></tr>
<tr class="separator:acb845122ddd1a21e03828d0cd39f2e0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa29667d9b43959f91d90f8a9df92eec2"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#aa29667d9b43959f91d90f8a9df92eec2">spec</a> () const</td></tr>
<tr class="separator:aa29667d9b43959f91d90f8a9df92eec2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae53f35a58f51c9e2fdb5f867d0e957cc"><td class="memItemLeft" align="right" valign="top">const boost::shared_ptr&lt; QuantLib::BlackVolTermStructure &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#ae53f35a58f51c9e2fdb5f867d0e957cc">volatility</a> ()</td></tr>
<tr class="separator:ae53f35a58f51c9e2fdb5f867d0e957cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7784555c5b7b47a8460250357687736"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#aa7784555c5b7b47a8460250357687736">buildVolCalibrationInfo</a> (const Date &amp;asof, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_volatility_config.html">VolatilityConfig</a> &gt; &amp;volatilityConfig, const <a class="el" href="classore_1_1data_1_1_curve_configurations.html">CurveConfigurations</a> &amp;<a class="el" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>, const <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;config)</td></tr>
<tr class="memdesc:aa7784555c5b7b47a8460250357687736"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build the calibration info.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#aa7784555c5b7b47a8460250357687736">More...</a><br /></td></tr>
<tr class="separator:aa7784555c5b7b47a8460250357687736"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bcc2beb0a4e69b2194f13109f74ecd0"><td class="memItemLeft" align="right" valign="top">const boost::shared_ptr&lt; <a class="el" href="structore_1_1data_1_1_fx_eq_comm_vol_calibration_info.html">FxEqCommVolCalibrationInfo</a> &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a2bcc2beb0a4e69b2194f13109f74ecd0">calibrationInfo</a> () const</td></tr>
<tr class="separator:a2bcc2beb0a4e69b2194f13109f74ecd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08baf556261e694d6fd67532c3d6afe7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a08baf556261e694d6fd67532c3d6afe7">buildVolatility</a> (const QuantLib::Date &amp;asof, const <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;vc, const <a class="el" href="classore_1_1data_1_1_constant_volatility_config.html">ConstantVolatilityConfig</a> &amp;cvc, const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;loader)</td></tr>
<tr class="memdesc:a08baf556261e694d6fd67532c3d6afe7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build a volatility structure from a single constant volatility quote.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#a08baf556261e694d6fd67532c3d6afe7">More...</a><br /></td></tr>
<tr class="separator:a08baf556261e694d6fd67532c3d6afe7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a782cc59a036687f2402136c9003e07c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a782cc59a036687f2402136c9003e07c2">buildVolatility</a> (const QuantLib::Date &amp;asof, const <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;vc, const <a class="el" href="classore_1_1data_1_1_volatility_curve_config.html">VolatilityCurveConfig</a> &amp;vcc, const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;loader)</td></tr>
<tr class="memdesc:a782cc59a036687f2402136c9003e07c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build a volatility curve from a 1-D curve of volatility quotes.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#a782cc59a036687f2402136c9003e07c2">More...</a><br /></td></tr>
<tr class="separator:a782cc59a036687f2402136c9003e07c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcc61ebefadc0e8481bdf86dc739d23c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#abcc61ebefadc0e8481bdf86dc739d23c">buildVolatility</a> (const QuantLib::Date &amp;asof, <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;vc, const <a class="el" href="classore_1_1data_1_1_volatility_strike_surface_config.html">VolatilityStrikeSurfaceConfig</a> &amp;vssc, const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;loader)</td></tr>
<tr class="memdesc:abcc61ebefadc0e8481bdf86dc739d23c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build a volatility surface from a collection of expiry and absolute strike pairs.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#abcc61ebefadc0e8481bdf86dc739d23c">More...</a><br /></td></tr>
<tr class="separator:abcc61ebefadc0e8481bdf86dc739d23c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accbfc0352ecd2e4be852a0cc6238fbb5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#accbfc0352ecd2e4be852a0cc6238fbb5">buildVolatilityExplicit</a> (const QuantLib::Date &amp;asof, <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;vc, const <a class="el" href="classore_1_1data_1_1_volatility_strike_surface_config.html">VolatilityStrikeSurfaceConfig</a> &amp;vssc, const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;loader, const std::vector&lt; QuantLib::Real &gt; &amp;configuredStrikes)</td></tr>
<tr class="separator:accbfc0352ecd2e4be852a0cc6238fbb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa772bf4579fcbb84db47720fd747a953"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#aa772bf4579fcbb84db47720fd747a953">buildVolatility</a> (const QuantLib::Date &amp;asof, <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;vc, const <a class="el" href="classore_1_1data_1_1_volatility_delta_surface_config.html">VolatilityDeltaSurfaceConfig</a> &amp;vdsc, const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;loader)</td></tr>
<tr class="separator:aa772bf4579fcbb84db47720fd747a953"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a215f4878146bd685646285b1c621ce23"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a215f4878146bd685646285b1c621ce23">buildVolatility</a> (const QuantLib::Date &amp;asof, <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;vc, const <a class="el" href="classore_1_1data_1_1_volatility_moneyness_surface_config.html">VolatilityMoneynessSurfaceConfig</a> &amp;vmsc, const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;loader)</td></tr>
<tr class="separator:a215f4878146bd685646285b1c621ce23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ec3a734b609ed0a997abc1b4d62fc91"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a6ec3a734b609ed0a997abc1b4d62fc91">buildVolatility</a> (const QuantLib::Date &amp;asof, <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;vc, const <a class="el" href="classore_1_1data_1_1_volatility_apo_future_surface_config.html">VolatilityApoFutureSurfaceConfig</a> &amp;vapo, const QuantLib::Handle&lt; QuantLib::BlackVolTermStructure &gt; &amp;baseVts, const QuantLib::Handle&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">QuantExt::PriceTermStructure</a> &gt; &amp;basePts)</td></tr>
<tr class="separator:a6ec3a734b609ed0a997abc1b4d62fc91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0df8dadb9ba46fdeeae5386e27ef59a3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a0df8dadb9ba46fdeeae5386e27ef59a3">buildVolatility</a> (const QuantLib::Date &amp;asof, const <a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> &amp;<a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#aa29667d9b43959f91d90f8a9df92eec2">spec</a>, const <a class="el" href="classore_1_1data_1_1_curve_configurations.html">CurveConfigurations</a> &amp;<a class="el" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>, const <a class="el" href="classore_1_1data_1_1_proxy_volatility_config.html">ProxyVolatilityConfig</a> &amp;pvc, const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_curve.html">CommodityCurve</a> &gt; &gt; &amp;comCurves, const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html">CommodityVolCurve</a> &gt; &gt; &amp;volCurves, const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_f_x_vol_curve.html">FXVolCurve</a> &gt; &gt; &amp;fxVolCurves, const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_correlation_curve.html">CorrelationCurve</a> &gt; &gt; &amp;correlationCurves, const <a class="el" href="classore_1_1data_1_1_market.html">Market</a> *fxIndices=nullptr)</td></tr>
<tr class="memdesc:a0df8dadb9ba46fdeeae5386e27ef59a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build a volatility surface as a proxy from another volatility surface.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#a0df8dadb9ba46fdeeae5386e27ef59a3">More...</a><br /></td></tr>
<tr class="separator:a0df8dadb9ba46fdeeae5386e27ef59a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7e1102e1a7fab6db190335153446ece"><td class="memItemLeft" align="right" valign="top">QuantLib::Handle&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">QuantExt::PriceTermStructure</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#ab7e1102e1a7fab6db190335153446ece">correctFuturePriceCurve</a> (const QuantLib::Date &amp;asof, const std::string &amp;contractName, const boost::shared_ptr&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">QuantExt::PriceTermStructure</a> &gt; &amp;pts, const std::vector&lt; QuantLib::Date &gt; &amp;optionExpiries) const</td></tr>
<tr class="separator:ab7e1102e1a7fab6db190335153446ece"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53aacd04237d728a4918ea672c79ba9f"><td class="memItemLeft" align="right" valign="top">QuantLib::Date&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a53aacd04237d728a4918ea672c79ba9f">getExpiry</a> (const QuantLib::Date &amp;asof, const boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_expiry.html">Expiry</a> &gt; &amp;expiry, const std::string &amp;<a class="el" href="todaysmarketparameters_8cpp.html#a8ccf841cb59e451791bcb2e1ac4f1edc">name</a>, QuantLib::Natural rollDays) const</td></tr>
<tr class="memdesc:a53aacd04237d728a4918ea672c79ba9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get an explicit expiry date from a commodity option quote's <a class="el" href="classore_1_1data_1_1_expiry.html">Expiry</a>.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#a53aacd04237d728a4918ea672c79ba9f">More...</a><br /></td></tr>
<tr class="separator:a53aacd04237d728a4918ea672c79ba9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b87e769e8e9c9d6c8b0038c470dcfd1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#a1b87e769e8e9c9d6c8b0038c470dcfd1">populateCurves</a> (const <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;config, const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_yield_curve.html">YieldCurve</a> &gt; &gt; &amp;yieldCurves, const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_curve.html">CommodityCurve</a> &gt; &gt; &amp;commodityCurves, <a class="el" href="classbool.html">bool</a> searchYield, <a class="el" href="classbool.html">bool</a> dontThrow=false)</td></tr>
<tr class="memdesc:a1b87e769e8e9c9d6c8b0038c470dcfd1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Populate price curve, <code>pts_</code>, and yield curve, <code>yts_</code>.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#a1b87e769e8e9c9d6c8b0038c470dcfd1">More...</a><br /></td></tr>
<tr class="separator:a1b87e769e8e9c9d6c8b0038c470dcfd1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc2a1854aa88b4b0963f1567425ba06c"><td class="memItemLeft" align="right" valign="top">std::vector&lt; QuantLib::Real &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html#acc2a1854aa88b4b0963f1567425ba06c">checkMoneyness</a> (const std::vector&lt; std::string &gt; &amp;moneynessLevels) const</td></tr>
<tr class="memdesc:acc2a1854aa88b4b0963f1567425ba06c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check and return moneyness levels.  <a href="classore_1_1data_1_1_commodity_vol_curve.html#acc2a1854aa88b4b0963f1567425ba06c">More...</a><br /></td></tr>
<tr class="separator:acc2a1854aa88b4b0963f1567425ba06c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Wrapper class for building commodity volatility structures. </p>

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00042">42</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ac00829921b76f3148a8851001de1ceb3" name="ac00829921b76f3148a8851001de1ceb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac00829921b76f3148a8851001de1ceb3">&#9670;&#160;</a></span>CommodityVolCurve() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html">CommodityVolCurve</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Default constructor. </p>

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00047">47</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   47</span>{}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8652808d1887e8dd4b619df49d9881b9" name="a8652808d1887e8dd4b619df49d9881b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8652808d1887e8dd4b619df49d9881b9">&#9670;&#160;</a></span>CommodityVolCurve() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html">CommodityVolCurve</a> </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> &amp;&#160;</td>
          <td class="paramname"><em>spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;&#160;</td>
          <td class="paramname"><em>loader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_curve_configurations.html">CurveConfigurations</a> &amp;&#160;</td>
          <td class="paramname"><em>curveConfigs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_yield_curve.html">YieldCurve</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>yieldCurves</em> = <code>{}</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_curve.html">CommodityCurve</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>commodityCurves</em> = <code>{}</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html">CommodityVolCurve</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>commodityVolCurves</em> = <code>{}</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_f_x_vol_curve.html">FXVolCurve</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>fxVolCurves</em> = <code>{}</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_correlation_curve.html">CorrelationCurve</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>correlationCurves</em> = <code>{}</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_market.html">Market</a> *&#160;</td>
          <td class="paramname"><em>fxIndices</em> = <code>nullptr</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>buildCalibrationInfo</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Detailed constructor. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aa29667d9b43959f91d90f8a9df92eec2" name="aa29667d9b43959f91d90f8a9df92eec2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa29667d9b43959f91d90f8a9df92eec2">&#9670;&#160;</a></span>spec()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> &amp; spec </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00062">62</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   62</span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a2d6d676f5b66ce3ee357e308044138ba">spec_</a>; }</div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_a2d6d676f5b66ce3ee357e308044138ba"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#a2d6d676f5b66ce3ee357e308044138ba">ore::data::CommodityVolCurve::spec_</a></div><div class="ttdeci">CommodityVolatilityCurveSpec spec_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00072">commodityvolcurve.hpp:72</a></div></div>
</div><!-- fragment --><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_commodity_vol_curve_aa29667d9b43959f91d90f8a9df92eec2_icgraph.png" border="0" usemap="#aclassore_1_1data_1_1_commodity_vol_curve_aa29667d9b43959f91d90f8a9df92eec2_icgraph" alt=""/></div>
<map name="aclassore_1_1data_1_1_commodity_vol_curve_aa29667d9b43959f91d90f8a9df92eec2_icgraph" id="aclassore_1_1data_1_1_commodity_vol_curve_aa29667d9b43959f91d90f8a9df92eec2_icgraph">
<area shape="rect" title=" " alt="" coords="152,5,203,31"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_vol_curve.html#a0df8dadb9ba46fdeeae5386e27ef59a3" title="Build a volatility surface as a proxy from another volatility surface." alt="" coords="5,5,104,31"/>
</map>
</div>

</div>
</div>
<a id="ae53f35a58f51c9e2fdb5f867d0e957cc" name="ae53f35a58f51c9e2fdb5f867d0e957cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae53f35a58f51c9e2fdb5f867d0e957cc">&#9670;&#160;</a></span>volatility()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const boost::shared_ptr&lt; QuantLib::BlackVolTermStructure &gt; &amp; volatility </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00063">63</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   63</span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>; }</div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_abf4baf7de4b5a3c87a9d9291f7a18116"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">ore::data::CommodityVolCurve::volatility_</a></div><div class="ttdeci">boost::shared_ptr&lt; QuantLib::BlackVolTermStructure &gt; volatility_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00073">commodityvolcurve.hpp:73</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa7784555c5b7b47a8460250357687736" name="aa7784555c5b7b47a8460250357687736"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7784555c5b7b47a8460250357687736">&#9670;&#160;</a></span>buildVolCalibrationInfo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolCalibrationInfo </td>
          <td>(</td>
          <td class="paramtype">const Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_volatility_config.html">VolatilityConfig</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>volatilityConfig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_curve_configurations.html">CurveConfigurations</a> &amp;&#160;</td>
          <td class="paramname"><em>curveConfigs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Build the calibration info. </p>

<p class="definition">Definition at line <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l01742">1742</a> of file <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1744</span>                                                                                         {</div>
<div class="line"><span class="lineno"> 1745</span>    <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: building volatility calibration info&quot;</span>);</div>
<div class="line"><span class="lineno"> 1746</span>    <span class="keywordflow">try</span>{</div>
<div class="line"><span class="lineno"> 1747</span> </div>
<div class="line"><span class="lineno"> 1748</span>        ReportConfig rc = <a class="code hl_function" href="namespaceore_1_1data.html#a5e51bfe798b6a12ac603d4578c144c6b">effectiveReportConfig</a>(<a class="code hl_variable" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>.reportConfigCommVols(), config.reportConfig());</div>
<div class="line"><span class="lineno"> 1749</span>        <span class="keywordtype">bool</span> reportOnDeltaGrid = *rc.reportOnDeltaGrid();</div>
<div class="line"><span class="lineno"> 1750</span>        <span class="keywordtype">bool</span> reportOnMoneynessGrid = *rc.reportOnMoneynessGrid();</div>
<div class="line"><span class="lineno"> 1751</span>        std::vector&lt;Real&gt; moneyness = *rc.moneyness();</div>
<div class="line"><span class="lineno"> 1752</span>        std::vector&lt;std::string&gt; deltas = *rc.deltas();</div>
<div class="line"><span class="lineno"> 1753</span>        std::vector&lt;Period&gt; expiries = *rc.expiries();</div>
<div class="line"><span class="lineno"> 1754</span> </div>
<div class="line"><span class="lineno"> 1755</span> </div>
<div class="line"><span class="lineno"> 1756</span>        <span class="keyword">auto</span> info = boost::make_shared&lt;FxEqCommVolCalibrationInfo&gt;();</div>
<div class="line"><span class="lineno"> 1757</span> </div>
<div class="line"><span class="lineno"> 1758</span>        DeltaVolQuote::AtmType atmType = DeltaVolQuote::AtmType::AtmDeltaNeutral;</div>
<div class="line"><span class="lineno"> 1759</span>        DeltaVolQuote::DeltaType deltaType = DeltaVolQuote::DeltaType::Fwd;</div>
<div class="line"><span class="lineno"> 1760</span> </div>
<div class="line"><span class="lineno"> 1761</span>        <span class="keywordflow">if</span> (<span class="keyword">auto</span> vdsc = boost::dynamic_pointer_cast&lt;VolatilityDeltaSurfaceConfig&gt;(vc)) {</div>
<div class="line"><span class="lineno"> 1762</span>            atmType = <a class="code hl_function" href="group__utilities.html#gac646d7e5cbc09cb6e4f094729a07558b">parseAtmType</a>(vdsc-&gt;atmType());</div>
<div class="line"><span class="lineno"> 1763</span>            deltaType = <a class="code hl_function" href="group__utilities.html#gafea498a41f014bd2031e10d3df7891a1">parseDeltaType</a>(vdsc-&gt;deltaType());</div>
<div class="line"><span class="lineno"> 1764</span>        }</div>
<div class="line"><span class="lineno"> 1765</span> </div>
<div class="line"><span class="lineno"> 1766</span>        info-&gt;dayCounter = <a class="code hl_function" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">to_string</a>(<a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#ad54546634b68f067b0f3867f7283c998">dayCounter_</a>);</div>
<div class="line"><span class="lineno"> 1767</span>        info-&gt;calendar = <a class="code hl_function" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">to_string</a>(<a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a936be92f5f766489c24b9ce54d702b36">calendar_</a>).empty() ? <span class="stringliteral">&quot;na&quot;</span> : <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a936be92f5f766489c24b9ce54d702b36">calendar_</a>.name();</div>
<div class="line"><span class="lineno"> 1768</span>        info-&gt;atmType = <a class="code hl_function" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">ore::data::to_string</a>(atmType);</div>
<div class="line"><span class="lineno"> 1769</span>        info-&gt;deltaType = <a class="code hl_function" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">ore::data::to_string</a>(deltaType);</div>
<div class="line"><span class="lineno"> 1770</span>        info-&gt;longTermAtmType = <a class="code hl_function" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">ore::data::to_string</a>(atmType);</div>
<div class="line"><span class="lineno"> 1771</span>        info-&gt;longTermDeltaType = <a class="code hl_function" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">ore::data::to_string</a>(deltaType);</div>
<div class="line"><span class="lineno"> 1772</span>        info-&gt;switchTenor = <span class="stringliteral">&quot;na&quot;</span>;</div>
<div class="line"><span class="lineno"> 1773</span>        info-&gt;riskReversalInFavorOf = <span class="stringliteral">&quot;na&quot;</span>;</div>
<div class="line"><span class="lineno"> 1774</span>        info-&gt;butterflyStyle = <span class="stringliteral">&quot;na&quot;</span>;</div>
<div class="line"><span class="lineno"> 1775</span> </div>
<div class="line"><span class="lineno"> 1776</span>        std::vector&lt;Real&gt; times, forwards;</div>
<div class="line"><span class="lineno"> 1777</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; p : expiries) {</div>
<div class="line"><span class="lineno"> 1778</span>            <span class="keyword">auto</span> d = <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;optionDateFromTenor(p);</div>
<div class="line"><span class="lineno"> 1779</span>            info-&gt;expiryDates.push_back(d);</div>
<div class="line"><span class="lineno"> 1780</span>            times.push_back(<a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;dayCounter().empty() ? Actual365Fixed().yearFraction(asof, d)</div>
<div class="line"><span class="lineno"> 1781</span>                                                              : <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;timeFromReference(d));</div>
<div class="line"><span class="lineno"> 1782</span>            forwards.push_back(<a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a2bf289bf605afd1052086f88a33fc2d1">pts_</a>-&gt;price(d));</div>
<div class="line"><span class="lineno"> 1783</span>        }</div>
<div class="line"><span class="lineno"> 1784</span> </div>
<div class="line"><span class="lineno"> 1785</span>        info-&gt;times = times;</div>
<div class="line"><span class="lineno"> 1786</span>        info-&gt;forwards = forwards;</div>
<div class="line"><span class="lineno"> 1787</span>        std::vector&lt;std::vector&lt;Real&gt;&gt; callPricesDelta(times.size(), std::vector&lt;Real&gt;(deltas.size(), 0.0));</div>
<div class="line"><span class="lineno"> 1788</span>        <span class="keywordflow">if</span> (reportOnDeltaGrid) {</div>
<div class="line"><span class="lineno"> 1789</span>            info-&gt;deltas = deltas;</div>
<div class="line"><span class="lineno"> 1790</span>            info-&gt;deltaCallPrices =</div>
<div class="line"><span class="lineno"> 1791</span>                    std::vector&lt;std::vector&lt;Real&gt;&gt;(times.size(), std::vector&lt;Real&gt;(deltas.size(), 0.0));</div>
<div class="line"><span class="lineno"> 1792</span>            info-&gt;deltaPutPrices =</div>
<div class="line"><span class="lineno"> 1793</span>                std::vector&lt;std::vector&lt;Real&gt;&gt;(times.size(), std::vector&lt;Real&gt;(deltas.size(), 0.0));</div>
<div class="line"><span class="lineno"> 1794</span>            info-&gt;deltaGridStrikes =</div>
<div class="line"><span class="lineno"> 1795</span>                std::vector&lt;std::vector&lt;Real&gt;&gt;(times.size(), std::vector&lt;Real&gt;(deltas.size(), 0.0));</div>
<div class="line"><span class="lineno"> 1796</span>            info-&gt;deltaGridProb = std::vector&lt;std::vector&lt;Real&gt;&gt;(times.size(), std::vector&lt;Real&gt;(deltas.size(), 0.0));</div>
<div class="line"><span class="lineno"> 1797</span>            info-&gt;deltaGridImpliedVolatility =</div>
<div class="line"><span class="lineno"> 1798</span>                std::vector&lt;std::vector&lt;Real&gt;&gt;(times.size(), std::vector&lt;Real&gt;(deltas.size(), 0.0));</div>
<div class="line"><span class="lineno"> 1799</span>            info-&gt;deltaGridCallSpreadArbitrage =</div>
<div class="line"><span class="lineno"> 1800</span>                std::vector&lt;std::vector&lt;bool&gt;&gt;(times.size(), std::vector&lt;bool&gt;(deltas.size(), <span class="keyword">true</span>));</div>
<div class="line"><span class="lineno"> 1801</span>            info-&gt;deltaGridButterflyArbitrage =</div>
<div class="line"><span class="lineno"> 1802</span>                std::vector&lt;std::vector&lt;bool&gt;&gt;(times.size(), std::vector&lt;bool&gt;(deltas.size(), <span class="keyword">true</span>));</div>
<div class="line"><span class="lineno"> 1803</span> </div>
<div class="line"><span class="lineno"> 1804</span>            Real maxTime = QL_MAX_REAL;</div>
<div class="line"><span class="lineno"> 1805</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a83e7c296e20653ab73fa6c3b2ebed22a">maxExpiry_</a> != Date()) {</div>
<div class="line"><span class="lineno"> 1806</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;dayCounter().empty())</div>
<div class="line"><span class="lineno"> 1807</span>                    maxTime = Actual365Fixed().yearFraction(asof, <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a83e7c296e20653ab73fa6c3b2ebed22a">maxExpiry_</a>);</div>
<div class="line"><span class="lineno"> 1808</span>                <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1809</span>                    maxTime = <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;timeFromReference(<a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a83e7c296e20653ab73fa6c3b2ebed22a">maxExpiry_</a>);</div>
<div class="line"><span class="lineno"> 1810</span>            }</div>
<div class="line"><span class="lineno"> 1811</span> </div>
<div class="line"><span class="lineno"> 1812</span>            DeltaVolQuote::AtmType at;</div>
<div class="line"><span class="lineno"> 1813</span>            DeltaVolQuote::DeltaType dt;</div>
<div class="line"><span class="lineno"> 1814</span>            <span class="keywordflow">for</span> (Size i = 0; i &lt; times.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1815</span>                Real t = times[i];</div>
<div class="line"><span class="lineno"> 1816</span>                at = atmType;</div>
<div class="line"><span class="lineno"> 1817</span>                dt = deltaType;</div>
<div class="line"><span class="lineno"> 1818</span>                <span class="comment">// for times after the last quoted expiry we use artificial conventions to avoid problems with strike (as in equities)</span></div>
<div class="line"><span class="lineno"> 1819</span>                <span class="comment">// from delta conversions: we use fwd delta always and ATM DNS</span></div>
<div class="line"><span class="lineno"> 1820</span>                <span class="keywordflow">if</span> (t &gt; maxTime) {</div>
<div class="line"><span class="lineno"> 1821</span>                    at = DeltaVolQuote::AtmDeltaNeutral;</div>
<div class="line"><span class="lineno"> 1822</span>                    dt = DeltaVolQuote::Fwd;</div>
<div class="line"><span class="lineno"> 1823</span>                }</div>
<div class="line"><span class="lineno"> 1824</span>                <span class="keywordtype">bool</span> validSlice = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno"> 1825</span>                <span class="keywordflow">for</span> (Size j = 0; j &lt; deltas.size(); ++j) {</div>
<div class="line"><span class="lineno"> 1826</span>                    DeltaString d(deltas[j]);</div>
<div class="line"><span class="lineno"> 1827</span>                    <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno"> 1828</span>                        Real strike;</div>
<div class="line"><span class="lineno"> 1829</span>                        <span class="keywordflow">if</span> (d.isAtm()) {</div>
<div class="line"><span class="lineno"> 1830</span>                            strike =</div>
<div class="line"><span class="lineno"> 1831</span>                                <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a097163251a347e24846dd4f1b569493c">QuantExt::getAtmStrike</a>(dt, at, <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a2bf289bf605afd1052086f88a33fc2d1">pts_</a>-&gt;price(asof,<span class="keyword">true</span>), <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#acb845122ddd1a21e03828d0cd39f2e0f">yts_</a>-&gt;discount(t), 1., <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>, t);</div>
<div class="line"><span class="lineno"> 1832</span>                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d.isCall()) {</div>
<div class="line"><span class="lineno"> 1833</span>                            strike = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afbdda05b0f8c22a55596d604e3c1c652">QuantExt::getStrikeFromDelta</a>(Option::Call, d.delta(), dt, <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a2bf289bf605afd1052086f88a33fc2d1">pts_</a>-&gt;price(asof,<span class="keyword">true</span>),</div>
<div class="line"><span class="lineno"> 1834</span>                                                                  <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#acb845122ddd1a21e03828d0cd39f2e0f">yts_</a>-&gt;discount(t), 1., <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>, t);</div>
<div class="line"><span class="lineno"> 1835</span>                        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1836</span>                            strike = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#afbdda05b0f8c22a55596d604e3c1c652">QuantExt::getStrikeFromDelta</a>(Option::Put, d.delta(), dt, <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a2bf289bf605afd1052086f88a33fc2d1">pts_</a>-&gt;price(asof,<span class="keyword">true</span>),</div>
<div class="line"><span class="lineno"> 1837</span>                                                                  <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#acb845122ddd1a21e03828d0cd39f2e0f">yts_</a>-&gt;discount(t), 1., <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>, t);</div>
<div class="line"><span class="lineno"> 1838</span>                        }</div>
<div class="line"><span class="lineno"> 1839</span>                        Real stddev = std::sqrt(<a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;blackVariance(t, strike));</div>
<div class="line"><span class="lineno"> 1840</span>                        callPricesDelta[i][j] = QuantExt::blackFormula(Option::Call, strike, forwards[i], stddev);</div>
<div class="line"><span class="lineno"> 1841</span> </div>
<div class="line"><span class="lineno"> 1842</span>                        <span class="keywordflow">if</span> (d.isPut()) {</div>
<div class="line"><span class="lineno"> 1843</span>                            info-&gt;deltaPutPrices[i][j] = blackFormula(Option::Put, strike, forwards[i], stddev, <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#acb845122ddd1a21e03828d0cd39f2e0f">yts_</a>-&gt;discount(t));</div>
<div class="line"><span class="lineno"> 1844</span>                        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1845</span>                            info-&gt;deltaCallPrices[i][j] = blackFormula(Option::Call, strike, forwards[i], stddev, <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#acb845122ddd1a21e03828d0cd39f2e0f">yts_</a>-&gt;discount(t));</div>
<div class="line"><span class="lineno"> 1846</span>                        }</div>
<div class="line"><span class="lineno"> 1847</span> </div>
<div class="line"><span class="lineno"> 1848</span>                        info-&gt;deltaGridStrikes[i][j] = strike;</div>
<div class="line"><span class="lineno"> 1849</span>                        info-&gt;deltaGridImpliedVolatility[i][j] = stddev / std::sqrt(t);</div>
<div class="line"><span class="lineno"> 1850</span>                    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div>
<div class="line"><span class="lineno"> 1851</span>                        validSlice = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1852</span>                        <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: error for time &quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot; delta &quot;</span> &lt;&lt; deltas[j] &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; e.what());</div>
<div class="line"><span class="lineno"> 1853</span>                    }</div>
<div class="line"><span class="lineno"> 1854</span>                }</div>
<div class="line"><span class="lineno"> 1855</span>                <span class="keywordflow">if</span> (validSlice) {</div>
<div class="line"><span class="lineno"> 1856</span>                    <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno"> 1857</span>                        <a class="code hl_classRef" href="../qle/class_quant_ext_1_1_carr_madan_marginal_probability.html">QuantExt::CarrMadanMarginalProbability</a> cm(info-&gt;deltaGridStrikes[i], forwards[i],</div>
<div class="line"><span class="lineno"> 1858</span>                                                                  callPricesDelta[i]);</div>
<div class="line"><span class="lineno"> 1859</span>                        info-&gt;deltaGridCallSpreadArbitrage[i] = cm.callSpreadArbitrage();</div>
<div class="line"><span class="lineno"> 1860</span>                        info-&gt;deltaGridButterflyArbitrage[i] = cm.butterflyArbitrage();</div>
<div class="line"><span class="lineno"> 1861</span>                        <span class="keywordflow">if</span> (!cm.arbitrageFree())</div>
<div class="line"><span class="lineno"> 1862</span>                            info-&gt;isArbitrageFree = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1863</span>                        info-&gt;deltaGridProb[i] = cm.density();</div>
<div class="line"><span class="lineno"> 1864</span>                        <a class="code hl_define" href="log_8hpp.html#a4cf6b52b5cb6fdd420eaad750cfc20cc">TLOGGERSTREAM</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#ab389c65095cf5cf8101a6244a48a4102">arbitrageAsString</a>(cm));</div>
<div class="line"><span class="lineno"> 1865</span>                    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div>
<div class="line"><span class="lineno"> 1866</span>                        <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;error for time &quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; e.what());</div>
<div class="line"><span class="lineno"> 1867</span>                        info-&gt;isArbitrageFree = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1868</span>                        <a class="code hl_define" href="log_8hpp.html#a4cf6b52b5cb6fdd420eaad750cfc20cc">TLOGGERSTREAM</a>(<span class="stringliteral">&quot;..(invalid slice)..&quot;</span>);</div>
<div class="line"><span class="lineno"> 1869</span>                    }</div>
<div class="line"><span class="lineno"> 1870</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1871</span>                    info-&gt;isArbitrageFree = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1872</span>                    <a class="code hl_define" href="log_8hpp.html#a4cf6b52b5cb6fdd420eaad750cfc20cc">TLOGGERSTREAM</a>(<span class="stringliteral">&quot;..(invalid slice)..&quot;</span>);</div>
<div class="line"><span class="lineno"> 1873</span>                }</div>
<div class="line"><span class="lineno"> 1874</span>            }</div>
<div class="line"><span class="lineno"> 1875</span>            <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: Delta surface arbitrage analysis completed.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1876</span>        }</div>
<div class="line"><span class="lineno"> 1877</span>        std::vector&lt;std::vector&lt;Real&gt;&gt; callPricesMoneyness(times.size(), std::vector&lt;Real&gt;(moneyness.size(), 0.0));</div>
<div class="line"><span class="lineno"> 1878</span>        <span class="keywordflow">if</span> (reportOnMoneynessGrid) {</div>
<div class="line"><span class="lineno"> 1879</span>            info-&gt;moneyness = moneyness;</div>
<div class="line"><span class="lineno"> 1880</span>            info-&gt;moneynessCallPrices =</div>
<div class="line"><span class="lineno"> 1881</span>                std::vector&lt;std::vector&lt;Real&gt;&gt;(times.size(), std::vector&lt;Real&gt;(moneyness.size(), 0.0));</div>
<div class="line"><span class="lineno"> 1882</span>            info-&gt;moneynessPutPrices =</div>
<div class="line"><span class="lineno"> 1883</span>                std::vector&lt;std::vector&lt;Real&gt;&gt;(times.size(), std::vector&lt;Real&gt;(moneyness.size(), 0.0));</div>
<div class="line"><span class="lineno"> 1884</span>            info-&gt;moneynessGridStrikes =</div>
<div class="line"><span class="lineno"> 1885</span>                std::vector&lt;std::vector&lt;Real&gt;&gt;(times.size(), std::vector&lt;Real&gt;(moneyness.size(), 0.0));</div>
<div class="line"><span class="lineno"> 1886</span>            info-&gt;moneynessGridProb =</div>
<div class="line"><span class="lineno"> 1887</span>                std::vector&lt;std::vector&lt;Real&gt;&gt;(times.size(), std::vector&lt;Real&gt;(moneyness.size(), 0.0));</div>
<div class="line"><span class="lineno"> 1888</span>            info-&gt;moneynessGridImpliedVolatility =</div>
<div class="line"><span class="lineno"> 1889</span>                std::vector&lt;std::vector&lt;Real&gt;&gt;(times.size(), std::vector&lt;Real&gt;(moneyness.size(), 0.0));</div>
<div class="line"><span class="lineno"> 1890</span>            info-&gt;moneynessGridCallSpreadArbitrage =</div>
<div class="line"><span class="lineno"> 1891</span>                std::vector&lt;std::vector&lt;bool&gt;&gt;(times.size(), std::vector&lt;bool&gt;(moneyness.size(), <span class="keyword">true</span>));</div>
<div class="line"><span class="lineno"> 1892</span>            info-&gt;moneynessGridButterflyArbitrage =</div>
<div class="line"><span class="lineno"> 1893</span>                std::vector&lt;std::vector&lt;bool&gt;&gt;(times.size(), std::vector&lt;bool&gt;(moneyness.size(), <span class="keyword">true</span>));</div>
<div class="line"><span class="lineno"> 1894</span>            info-&gt;moneynessGridCalendarArbitrage =</div>
<div class="line"><span class="lineno"> 1895</span>                std::vector&lt;std::vector&lt;bool&gt;&gt;(times.size(), std::vector&lt;bool&gt;(moneyness.size(), <span class="keyword">true</span>));</div>
<div class="line"><span class="lineno"> 1896</span>            <span class="keywordflow">for</span> (Size i = 0; i &lt; times.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1897</span>                Real t = times[i];</div>
<div class="line"><span class="lineno"> 1898</span>                <span class="keywordflow">for</span> (Size j = 0; j &lt; moneyness.size(); ++j) {</div>
<div class="line"><span class="lineno"> 1899</span>                    <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno"> 1900</span>                        Real strike = moneyness[j] * forwards[i];</div>
<div class="line"><span class="lineno"> 1901</span>                        info-&gt;moneynessGridStrikes[i][j] = strike;</div>
<div class="line"><span class="lineno"> 1902</span>                        Real stddev = std::sqrt(<a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;blackVariance(t, strike));</div>
<div class="line"><span class="lineno"> 1903</span>                        callPricesMoneyness[i][j] = blackFormula(Option::Call, strike, forwards[i], stddev);</div>
<div class="line"><span class="lineno"> 1904</span>                        info-&gt;moneynessGridImpliedVolatility[i][j] = stddev / std::sqrt(t);</div>
<div class="line"><span class="lineno"> 1905</span>                        <span class="keywordflow">if</span> (moneyness[j] &gt;= 1) {</div>
<div class="line"><span class="lineno"> 1906</span>                            <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a6406d74151328ae90b3ebeecaf0ba9a9">calibrationInfo_</a>-&gt;moneynessCallPrices[i][j] = blackFormula(Option::Call, strike, forwards[i], stddev, <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#acb845122ddd1a21e03828d0cd39f2e0f">yts_</a>-&gt;discount(t));</div>
<div class="line"><span class="lineno"> 1907</span>                        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1908</span>                            <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a6406d74151328ae90b3ebeecaf0ba9a9">calibrationInfo_</a>-&gt;moneynessPutPrices[i][j] = blackFormula(Option::Put, strike, forwards[i], stddev, <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#acb845122ddd1a21e03828d0cd39f2e0f">yts_</a>-&gt;discount(t));</div>
<div class="line"><span class="lineno"> 1909</span>                        };</div>
<div class="line"><span class="lineno"> 1910</span>                    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div>
<div class="line"><span class="lineno"> 1911</span>                        <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: error for time &quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot; moneyness &quot;</span> &lt;&lt; moneyness[j] &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; e.what());</div>
<div class="line"><span class="lineno"> 1912</span>                    }</div>
<div class="line"><span class="lineno"> 1913</span>                }</div>
<div class="line"><span class="lineno"> 1914</span>            }</div>
<div class="line"><span class="lineno"> 1915</span>            <span class="keywordflow">if</span> (!times.empty() &amp;&amp; !moneyness.empty()) {</div>
<div class="line"><span class="lineno"> 1916</span>                <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno"> 1917</span>                    <a class="code hl_classRef" href="../qle/class_quant_ext_1_1_carr_madan_surface.html">QuantExt::CarrMadanSurface</a> cm(times, moneyness, <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a2bf289bf605afd1052086f88a33fc2d1">pts_</a>-&gt;price(asof,<span class="keyword">true</span>), forwards,</div>
<div class="line"><span class="lineno"> 1918</span>                                                  callPricesMoneyness);</div>
<div class="line"><span class="lineno"> 1919</span>                    <span class="keywordflow">for</span> (Size i = 0; i &lt; times.size(); ++i) {</div>
<div class="line"><span class="lineno"> 1920</span>                        info-&gt;moneynessGridProb[i] = cm.timeSlices()[i].density();</div>
<div class="line"><span class="lineno"> 1921</span>                    }</div>
<div class="line"><span class="lineno"> 1922</span>                    info-&gt;moneynessGridCallSpreadArbitrage = cm.callSpreadArbitrage();</div>
<div class="line"><span class="lineno"> 1923</span>                    info-&gt;moneynessGridButterflyArbitrage = cm.butterflyArbitrage();</div>
<div class="line"><span class="lineno"> 1924</span>                    info-&gt;moneynessGridCalendarArbitrage = cm.calendarArbitrage();</div>
<div class="line"><span class="lineno"> 1925</span>                    <span class="keywordflow">if</span> (!cm.arbitrageFree())</div>
<div class="line"><span class="lineno"> 1926</span>                        info-&gt;isArbitrageFree = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1927</span>                    <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: Moneyness surface Arbitrage analysis result:&quot;</span>);</div>
<div class="line"><span class="lineno"> 1928</span>                    <a class="code hl_define" href="log_8hpp.html#a4cf6b52b5cb6fdd420eaad750cfc20cc">TLOGGERSTREAM</a>(<a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#ab389c65095cf5cf8101a6244a48a4102">arbitrageAsString</a>(cm));</div>
<div class="line"><span class="lineno"> 1929</span>                } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div>
<div class="line"><span class="lineno"> 1930</span>                    <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: error: &quot;</span> &lt;&lt; e.what());</div>
<div class="line"><span class="lineno"> 1931</span>                    info-&gt;isArbitrageFree = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno"> 1932</span>                }</div>
<div class="line"><span class="lineno"> 1933</span>                <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: Moneyness surface Arbitrage analysis completed:&quot;</span>);</div>
<div class="line"><span class="lineno"> 1934</span>            }</div>
<div class="line"><span class="lineno"> 1935</span>        }</div>
<div class="line"><span class="lineno"> 1936</span>    <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a6406d74151328ae90b3ebeecaf0ba9a9">calibrationInfo_</a> = info;</div>
<div class="line"><span class="lineno"> 1937</span>    }</div>
<div class="line"><span class="lineno"> 1938</span>    <span class="keywordflow">catch</span> (std::exception&amp; e){</div>
<div class="line"><span class="lineno"> 1939</span>        QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve: calibration info building failed: &quot;</span> &lt;&lt; e.what());</div>
<div class="line"><span class="lineno"> 1940</span>    } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><span class="lineno"> 1941</span>        QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve:  calibration info building failed: unknown error&quot;</span>);</div>
<div class="line"><span class="lineno"> 1942</span>    }</div>
<div class="line"><span class="lineno"> 1943</span>    }</div>
<div class="ttc" id="aclass_quant_ext_1_1_carr_madan_marginal_probability_html"><div class="ttname"><a href="../qle/class_quant_ext_1_1_carr_madan_marginal_probability.html">QuantExt::CarrMadanMarginalProbability</a></div></div>
<div class="ttc" id="aclass_quant_ext_1_1_carr_madan_surface_html"><div class="ttname"><a href="../qle/class_quant_ext_1_1_carr_madan_surface.html">QuantExt::CarrMadanSurface</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_a2bf289bf605afd1052086f88a33fc2d1"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#a2bf289bf605afd1052086f88a33fc2d1">ore::data::CommodityVolCurve::pts_</a></div><div class="ttdeci">QuantLib::Handle&lt; QuantExt::PriceTermStructure &gt; pts_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00082">commodityvolcurve.hpp:82</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_a6406d74151328ae90b3ebeecaf0ba9a9"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#a6406d74151328ae90b3ebeecaf0ba9a9">ore::data::CommodityVolCurve::calibrationInfo_</a></div><div class="ttdeci">boost::shared_ptr&lt; FxEqCommVolCalibrationInfo &gt; calibrationInfo_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00078">commodityvolcurve.hpp:78</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_a83e7c296e20653ab73fa6c3b2ebed22a"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#a83e7c296e20653ab73fa6c3b2ebed22a">ore::data::CommodityVolCurve::maxExpiry_</a></div><div class="ttdeci">QuantLib::Date maxExpiry_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00079">commodityvolcurve.hpp:79</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_a936be92f5f766489c24b9ce54d702b36"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#a936be92f5f766489c24b9ce54d702b36">ore::data::CommodityVolCurve::calendar_</a></div><div class="ttdeci">QuantLib::Calendar calendar_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00076">commodityvolcurve.hpp:76</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_acb845122ddd1a21e03828d0cd39f2e0f"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#acb845122ddd1a21e03828d0cd39f2e0f">ore::data::CommodityVolCurve::yts_</a></div><div class="ttdeci">QuantLib::Handle&lt; QuantLib::YieldTermStructure &gt; yts_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00083">commodityvolcurve.hpp:83</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_ad54546634b68f067b0f3867f7283c998"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#ad54546634b68f067b0f3867f7283c998">ore::data::CommodityVolCurve::dayCounter_</a></div><div class="ttdeci">QuantLib::DayCounter dayCounter_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00077">commodityvolcurve.hpp:77</a></div></div>
<div class="ttc" id="agroup__utilities_html_gac646d7e5cbc09cb6e4f094729a07558b"><div class="ttname"><a href="group__utilities.html#gac646d7e5cbc09cb6e4f094729a07558b">ore::data::parseAtmType</a></div><div class="ttdeci">DeltaVolQuote::AtmType parseAtmType(const std::string &amp;s)</div><div class="ttdoc">Convert text to QuantLib::DeltaVolQuote::AtmType.</div><div class="ttdef"><b>Definition:</b> <a href="parsers_8cpp_source.html#l00722">parsers.cpp:722</a></div></div>
<div class="ttc" id="agroup__utilities_html_gafea498a41f014bd2031e10d3df7891a1"><div class="ttname"><a href="group__utilities.html#gafea498a41f014bd2031e10d3df7891a1">ore::data::parseDeltaType</a></div><div class="ttdeci">DeltaVolQuote::DeltaType parseDeltaType(const std::string &amp;s)</div><div class="ttdoc">Convert text to QuantLib::DeltaVolQuote::DeltaType.</div><div class="ttdef"><b>Definition:</b> <a href="parsers_8cpp_source.html#l00739">parsers.cpp:739</a></div></div>
<div class="ttc" id="alog_8hpp_html_a34c7c8cde9b91d2eee82d7b9a0b66fd5"><div class="ttname"><a href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a></div><div class="ttdeci">#define DLOG(text)</div><div class="ttdoc">Logging Macro (Level = Debug)</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00508">log.hpp:508</a></div></div>
<div class="ttc" id="alog_8hpp_html_a4cf6b52b5cb6fdd420eaad750cfc20cc"><div class="ttname"><a href="log_8hpp.html#a4cf6b52b5cb6fdd420eaad750cfc20cc">TLOGGERSTREAM</a></div><div class="ttdeci">#define TLOGGERSTREAM(text)</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00587">log.hpp:587</a></div></div>
<div class="ttc" id="alog_8hpp_html_a99aeca53f904c71a68070e1f9d310232"><div class="ttname"><a href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a></div><div class="ttdeci">#define TLOG(text)</div><div class="ttdoc">Logging Macro (Level = Data)</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00510">log.hpp:510</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_a097163251a347e24846dd4f1b569493c"><div class="ttname"><a href="../qle/namespace_quant_ext.html#a097163251a347e24846dd4f1b569493c">QuantExt::getAtmStrike</a></div><div class="ttdeci">Real getAtmStrike(DeltaVolQuote::DeltaType dt, DeltaVolQuote::AtmType at, Real spot, Real domDiscount, Real forDiscount, boost::shared_ptr&lt; BlackVolTermStructure &gt; vol, Real t, Real accuracy, Size maxIterations)</div></div>
<div class="ttc" id="anamespace_quant_ext_html_ab389c65095cf5cf8101a6244a48a4102"><div class="ttname"><a href="../qle/namespace_quant_ext.html#ab389c65095cf5cf8101a6244a48a4102">QuantExt::arbitrageAsString</a></div><div class="ttdeci">std::string arbitrageAsString(const CarrMadanMarginalProbabilityClass &amp;cm)</div></div>
<div class="ttc" id="anamespace_quant_ext_html_afbdda05b0f8c22a55596d604e3c1c652"><div class="ttname"><a href="../qle/namespace_quant_ext.html#afbdda05b0f8c22a55596d604e3c1c652">QuantExt::getStrikeFromDelta</a></div><div class="ttdeci">Real getStrikeFromDelta(Option::Type optionType, Real delta, DeltaVolQuote::DeltaType dt, Real spot, Real domDiscount, Real forDiscount, boost::shared_ptr&lt; BlackVolTermStructure &gt; vol, Real t, Real accuracy, Size maxIterations)</div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a5e51bfe798b6a12ac603d4578c144c6b"><div class="ttname"><a href="namespaceore_1_1data.html#a5e51bfe798b6a12ac603d4578c144c6b">ore::data::effectiveReportConfig</a></div><div class="ttdeci">ReportConfig effectiveReportConfig(const ReportConfig &amp;globalConfig, const ReportConfig &amp;localConfig)</div><div class="ttdef"><b>Definition:</b> <a href="reportconfig_8cpp_source.html#l00109">reportconfig.cpp:109</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a86651dfeb5c18ee891f7a4734d8cf455"><div class="ttname"><a href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">ore::data::to_string</a></div><div class="ttdeci">std::string to_string(const LocationInfo &amp;l)</div><div class="ttdef"><b>Definition:</b> <a href="ast_8cpp_source.html#l00028">ast.cpp:28</a></div></div>
<div class="ttc" id="atest_2commodityvolcurve_8cpp_html_a96a582300d10244c7df851066de48438"><div class="ttname"><a href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a></div><div class="ttdeci">vector&lt; string &gt; curveConfigs</div><div class="ttdef"><b>Definition:</b> <a href="test_2commodityvolcurve_8cpp_source.html#l00525">commodityvolcurve.cpp:525</a></div></div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_commodity_vol_curve_aa7784555c5b7b47a8460250357687736_cgraph.png" border="0" usemap="#aclassore_1_1data_1_1_commodity_vol_curve_aa7784555c5b7b47a8460250357687736_cgraph" alt=""/></div>
<map name="aclassore_1_1data_1_1_commodity_vol_curve_aa7784555c5b7b47a8460250357687736_cgraph" id="aclassore_1_1data_1_1_commodity_vol_curve_aa7784555c5b7b47a8460250357687736_cgraph">
<area shape="rect" title="Build the calibration info." alt="" coords="5,820,155,845"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#ab389c65095cf5cf8101a6244a48a4102" title=" " alt="" coords="212,5,397,31"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_carr_madan_marginal_probability.html#a2c9e9c3980a73aa98162a2149d7b0604" title=" " alt="" coords="206,55,403,95"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_carr_madan_surface.html#a2c9e9c3980a73aa98162a2149d7b0604" title=" " alt="" coords="209,119,401,159"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_delta_surface_config.html#ac1df45ab0edf6303b3a7035109c56731" title=" " alt="" coords="224,183,385,223"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_carr_madan_marginal_probability.html#a050154669e2d6571151716c8e7c0cb34" title=" " alt="" coords="206,247,403,287"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_carr_madan_surface.html#a08d0363135af67ef063a51bee340d460" title=" " alt="" coords="209,311,401,351"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_carr_madan_surface.html#a367f9077f0c218edcd60507be81bbac6" title=" " alt="" coords="209,375,401,415"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_carr_madan_marginal_probability.html#a8e9a460f12d8d5c9001a36bf087a6a8a" title=" " alt="" coords="203,439,407,479"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_carr_madan_surface.html#abdede4413de05babce69513924456c5b" title=" " alt="" coords="209,503,401,543"/>
<area shape="rect" href="classore_1_1data_1_1_delta_string.html#a397f8534c2b3d08642e5040c40426ab7" title=" " alt="" coords="232,567,377,607"/>
<area shape="rect" href="classore_1_1data_1_1_report_config.html#a4e7f096baca32e79358e09ada698bdce" title=" " alt="" coords="467,527,621,567"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_delta_surface_config.html#a1a94512029afb513f987537604e7e305" title=" " alt="" coords="221,949,388,989"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_carr_madan_marginal_probability.html#ac92c479ebb5da27bcb6cf6f806bd3860" title=" " alt="" coords="206,1013,403,1053"/>
<area shape="rect" href="namespaceore_1_1data.html#a5e51bfe798b6a12ac603d4578c144c6b" title=" " alt="" coords="222,783,387,823"/>
<area shape="rect" href="classore_1_1data_1_1_report_config.html#a82578f32908fbaf6c03607239312437d" title=" " alt="" coords="467,591,621,631"/>
<area shape="rect" href="classore_1_1data_1_1_report_config.html#aee007654632574a63d04e7c6d0bc048f" title=" " alt="" coords="467,655,621,695"/>
<area shape="rect" href="classore_1_1data_1_1_report_config.html#a13b426492274e696ee57b64ee0905f8b" title=" " alt="" coords="467,1039,621,1079"/>
<area shape="rect" href="classore_1_1data_1_1_report_config.html#a56ab5896ba11edc3f435cefc0c45085a" title=" " alt="" coords="459,1103,629,1143"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a097163251a347e24846dd4f1b569493c" title=" " alt="" coords="224,1077,385,1103"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#afbdda05b0f8c22a55596d604e3c1c652" title=" " alt="" coords="206,1127,403,1152"/>
<area shape="rect" href="classore_1_1data_1_1_delta_string.html#a33677d9992d9935c8dda721c7e90c488" title=" " alt="" coords="232,1177,377,1217"/>
<area shape="rect" href="classore_1_1data_1_1_delta_string.html#a24f2d93e33ef1aba7e9b5dbeda088e98" title=" " alt="" coords="232,1241,377,1281"/>
<area shape="rect" href="classore_1_1data_1_1_delta_string.html#abd751388e9fe4ca670f88a12a9bf3356" title=" " alt="" coords="232,1305,377,1345"/>
<area shape="rect" href="group__utilities.html#gac646d7e5cbc09cb6e4f094729a07558b" title="Convert text to QuantLib::DeltaVolQuote::AtmType." alt="" coords="222,1369,387,1395"/>
<area shape="rect" href="group__utilities.html#gafea498a41f014bd2031e10d3df7891a1" title="Convert text to QuantLib::DeltaVolQuote::DeltaType." alt="" coords="219,1419,390,1444"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_config.html#ab7e04e920649365f47da95adf40df527" title=" " alt="" coords="206,1469,403,1509"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_carr_madan_surface.html#af46a1928b8c0698f1b5208daca238413" title=" " alt="" coords="209,1533,401,1573"/>
<area shape="rect" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455" title=" " alt="" coords="239,1621,370,1647"/>
<area shape="rect" href="classore_1_1data_1_1_report_config.html#a74e55eb606801e93e03464e36edc3954" title=" " alt="" coords="467,719,621,759"/>
<area shape="rect" href="classore_1_1data_1_1_report_config.html#a5552ccfe35e93f625d97ce7912182770" title=" " alt="" coords="455,783,633,823"/>
<area shape="rect" href="classore_1_1data_1_1_report_config.html#a3e27de23896c5cad96fe8b54be7efbfc" title=" " alt="" coords="467,847,621,887"/>
<area shape="rect" href="classore_1_1data_1_1_report_config.html#af8d226e2763da6112782a272b6bf454b" title=" " alt="" coords="467,911,621,951"/>
<area shape="rect" href="classore_1_1data_1_1_report_config.html#a17329bf807a1070ecbc7e03e3cc94df3" title=" " alt="" coords="467,975,621,1015"/>
</map>
</div>

</div>
</div>
<a id="a2bcc2beb0a4e69b2194f13109f74ecd0" name="a2bcc2beb0a4e69b2194f13109f74ecd0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2bcc2beb0a4e69b2194f13109f74ecd0">&#9670;&#160;</a></span>calibrationInfo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const boost::shared_ptr&lt; <a class="el" href="structore_1_1data_1_1_fx_eq_comm_vol_calibration_info.html">FxEqCommVolCalibrationInfo</a> &gt; &amp; calibrationInfo </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00068">68</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   68</span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a6406d74151328ae90b3ebeecaf0ba9a9">calibrationInfo_</a>; }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a08baf556261e694d6fd67532c3d6afe7" name="a08baf556261e694d6fd67532c3d6afe7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08baf556261e694d6fd67532c3d6afe7">&#9670;&#160;</a></span>buildVolatility() <span class="overload">[1/7]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatility </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_constant_volatility_config.html">ConstantVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>cvc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;&#160;</td>
          <td class="paramname"><em>loader</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Build a volatility structure from a single constant volatility quote. </p>

</div>
</div>
<a id="a782cc59a036687f2402136c9003e07c2" name="a782cc59a036687f2402136c9003e07c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a782cc59a036687f2402136c9003e07c2">&#9670;&#160;</a></span>buildVolatility() <span class="overload">[2/7]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatility </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_volatility_curve_config.html">VolatilityCurveConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vcc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;&#160;</td>
          <td class="paramname"><em>loader</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Build a volatility curve from a 1-D curve of volatility quotes. </p>

<p class="definition">Definition at line <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l00310">310</a> of file <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  311</span>                                                                                                {</div>
<div class="line"><span class="lineno">  312</span> </div>
<div class="line"><span class="lineno">  313</span>    <a class="code hl_define" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: start building 1-D volatility curve&quot;</span>);</div>
<div class="line"><span class="lineno">  314</span> </div>
<div class="line"><span class="lineno">  315</span>    <span class="comment">// Must have at least one quote</span></div>
<div class="line"><span class="lineno">  316</span>    QL_REQUIRE(vcc.quotes().size() &gt; 0, <span class="stringliteral">&quot;No quotes specified in config &quot;</span> &lt;&lt; vc.curveID());</div>
<div class="line"><span class="lineno">  317</span> </div>
<div class="line"><span class="lineno">  318</span>    QL_REQUIRE(vcc.quoteType() == <a class="code hl_enumvalue" href="classore_1_1data_1_1_market_datum.html#aa5b3ec8bb6c730c38b87a73c11dec808a51c1258108cb3ef6a757d4e01db7f115">MarketDatum::QuoteType::RATE_LNVOL</a>, <span class="stringliteral">&quot;CommodityVolCurve: only quote type&quot;</span> &lt;&lt;</div>
<div class="line"><span class="lineno">  319</span>        <span class="stringliteral">&quot; RATE_LNVOL is currently supported for 1-D commodity volatility curves.&quot;</span>);</div>
<div class="line"><span class="lineno">  320</span> </div>
<div class="line"><span class="lineno">  321</span>    <span class="comment">// Check if we are using a regular expression to select the quotes for the curve. If we are, the quotes should</span></div>
<div class="line"><span class="lineno">  322</span>    <span class="comment">// contain exactly one element.</span></div>
<div class="line"><span class="lineno">  323</span>    <span class="keyword">auto</span> wildcard = <a class="code hl_function" href="namespaceore_1_1data.html#afb4bd26f4cf89fd9281278c484e0f9c3">getUniqueWildcard</a>(vcc.quotes());</div>
<div class="line"><span class="lineno">  324</span> </div>
<div class="line"><span class="lineno">  325</span>    <span class="comment">// curveData will be populated with the expiry dates and volatility values.</span></div>
<div class="line"><span class="lineno">  326</span>    map&lt;Date, Real&gt; curveData;</div>
<div class="line"><span class="lineno">  327</span> </div>
<div class="line"><span class="lineno">  328</span>    <span class="comment">// Different approaches depending on whether we are using a regex or searching for a list of explicit quotes.</span></div>
<div class="line"><span class="lineno">  329</span>    <span class="keywordflow">if</span> (wildcard) {</div>
<div class="line"><span class="lineno">  330</span> </div>
<div class="line"><span class="lineno">  331</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Have single quote with pattern &quot;</span> &lt;&lt; wildcard-&gt;pattern());</div>
<div class="line"><span class="lineno">  332</span> </div>
<div class="line"><span class="lineno">  333</span>        <span class="comment">// Loop over quotes and process commodity option quotes matching pattern on asof</span></div>
<div class="line"><span class="lineno">  334</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; md : loader.get(*wildcard, asof)) {</div>
<div class="line"><span class="lineno">  335</span> </div>
<div class="line"><span class="lineno">  336</span>            <span class="comment">// Go to next quote if the market data point&#39;s date does not equal our asof</span></div>
<div class="line"><span class="lineno">  337</span>            <span class="keywordflow">if</span> (md-&gt;asofDate() != asof)</div>
<div class="line"><span class="lineno">  338</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  339</span> </div>
<div class="line"><span class="lineno">  340</span>            <span class="keyword">auto</span> q = boost::dynamic_pointer_cast&lt;CommodityOptionQuote&gt;(md);</div>
<div class="line"><span class="lineno">  341</span>            <span class="keywordflow">if</span> (!q)</div>
<div class="line"><span class="lineno">  342</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  343</span>            QL_REQUIRE(q-&gt;quoteType() == vcc.quoteType(),</div>
<div class="line"><span class="lineno">  344</span>                <span class="stringliteral">&quot;CommodityOptionQuote type &#39;&quot;</span> &lt;&lt; q-&gt;quoteType() &lt;&lt; <span class="stringliteral">&quot;&#39; &lt;&gt; VolatilityCurveConfig quote type &#39;&quot;</span> &lt;&lt; vcc.quoteType() &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line"><span class="lineno">  345</span> </div>
<div class="line"><span class="lineno">  346</span>            <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;The quote &quot;</span> &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot; matched the pattern&quot;</span>);</div>
<div class="line"><span class="lineno">  347</span> </div>
<div class="line"><span class="lineno">  348</span>            Date expiryDate = <a class="code hl_function" href="classore_1_1data_1_1_commodity_vol_curve.html#a53aacd04237d728a4918ea672c79ba9f">getExpiry</a>(asof, q-&gt;expiry(), vc.futureConventionsId(), vc.optionExpiryRollDays());</div>
<div class="line"><span class="lineno">  349</span>            <span class="keywordflow">if</span> (expiryDate &gt; asof) {</div>
<div class="line"><span class="lineno">  350</span>                <span class="comment">// Add the quote to the curve data</span></div>
<div class="line"><span class="lineno">  351</span>                <span class="keyword">auto</span> it = curveData.find(expiryDate);</div>
<div class="line"><span class="lineno">  352</span>                <span class="keywordflow">if</span> (it != curveData.end()) {</div>
<div class="line"><span class="lineno">  353</span>                    <a class="code hl_define" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;Already added quote &quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9) &lt;&lt; it-&gt;second &lt;&lt; <span class="stringliteral">&quot; for the expiry&quot;</span> &lt;&lt;</div>
<div class="line"><span class="lineno">  354</span>                        <span class="stringliteral">&quot; date &quot;</span> &lt;&lt; io::iso_date(expiryDate) &lt;&lt; <span class="stringliteral">&quot; for commodity curve &quot;</span> &lt;&lt; vc.curveID() &lt;&lt;</div>
<div class="line"><span class="lineno">  355</span>                        <span class="stringliteral">&quot; so not adding &quot;</span> &lt;&lt; q-&gt;name());</div>
<div class="line"><span class="lineno">  356</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  357</span>                    curveData[expiryDate] = q-&gt;quote()-&gt;value();</div>
<div class="line"><span class="lineno">  358</span>                    <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Added quote &quot;</span> &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot;: (&quot;</span> &lt;&lt; io::iso_date(expiryDate) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt;</div>
<div class="line"><span class="lineno">  359</span>                        fixed &lt;&lt; setprecision(9) &lt;&lt; q-&gt;quote()-&gt;value() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno">  360</span>                }</div>
<div class="line"><span class="lineno">  361</span>            }</div>
<div class="line"><span class="lineno">  362</span>        }</div>
<div class="line"><span class="lineno">  363</span> </div>
<div class="line"><span class="lineno">  364</span>        <span class="comment">// Check that we have quotes in the end</span></div>
<div class="line"><span class="lineno">  365</span>        QL_REQUIRE(curveData.size() &gt; 0, <span class="stringliteral">&quot;No quotes found matching regular expression &quot;</span> &lt;&lt; vcc.quotes()[0]);</div>
<div class="line"><span class="lineno">  366</span> </div>
<div class="line"><span class="lineno">  367</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  368</span> </div>
<div class="line"><span class="lineno">  369</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Have &quot;</span> &lt;&lt; vcc.quotes().size() &lt;&lt; <span class="stringliteral">&quot; explicit quotes&quot;</span>);</div>
<div class="line"><span class="lineno">  370</span> </div>
<div class="line"><span class="lineno">  371</span>        <span class="comment">// Loop over quotes and process commodity option quotes that are explicitly specified in the config</span></div>
<div class="line"><span class="lineno">  372</span>        Size quotesAdded = 0;</div>
<div class="line"><span class="lineno">  373</span>        Size skippedExpiredQuotes = 0;</div>
<div class="line"><span class="lineno">  374</span>        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; quoteName : vcc.quotes()) {</div>
<div class="line"><span class="lineno">  375</span>            <span class="keyword">auto</span> md = loader.get(quoteName, asof);</div>
<div class="line"><span class="lineno">  376</span>            QL_REQUIRE(md, <span class="stringliteral">&quot;Unable to load quote &#39;&quot;</span> &lt;&lt; quoteName &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line"><span class="lineno">  377</span> </div>
<div class="line"><span class="lineno">  378</span>            QL_REQUIRE(md-&gt;asofDate() == asof, <span class="stringliteral">&quot;MarketDatum asofDate &#39;&quot;</span> &lt;&lt; md-&gt;asofDate() &lt;&lt; <span class="stringliteral">&quot;&#39; &lt;&gt; asof &#39;&quot;</span> &lt;&lt; asof &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line"><span class="lineno">  379</span> </div>
<div class="line"><span class="lineno">  380</span>            <span class="keyword">auto</span> q = boost::dynamic_pointer_cast&lt;CommodityOptionQuote&gt;(md);</div>
<div class="line"><span class="lineno">  381</span>            QL_REQUIRE(q, <span class="stringliteral">&quot;Internal error: could not downcast MarketDatum &#39;&quot;</span> &lt;&lt; md-&gt;name() &lt;&lt; <span class="stringliteral">&quot;&#39; to CommodityOptionQuote&quot;</span>);</div>
<div class="line"><span class="lineno">  382</span> </div>
<div class="line"><span class="lineno">  383</span>            <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Found the configured quote &quot;</span> &lt;&lt; q-&gt;name());</div>
<div class="line"><span class="lineno">  384</span> </div>
<div class="line"><span class="lineno">  385</span>            Date expiryDate = <a class="code hl_function" href="classore_1_1data_1_1_commodity_vol_curve.html#a53aacd04237d728a4918ea672c79ba9f">getExpiry</a>(asof, q-&gt;expiry(), vc.futureConventionsId(), vc.optionExpiryRollDays());</div>
<div class="line"><span class="lineno">  386</span>            <span class="keywordflow">if</span> (expiryDate &gt; asof) {</div>
<div class="line"><span class="lineno">  387</span>                QL_REQUIRE(expiryDate &gt; asof, <span class="stringliteral">&quot;Commodity volatility quote &#39;&quot;</span></div>
<div class="line"><span class="lineno">  388</span>                                                  &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot;&#39; has expiry in the past (&quot;</span></div>
<div class="line"><span class="lineno">  389</span>                                                  &lt;&lt; io::iso_date(expiryDate) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno">  390</span>                QL_REQUIRE(curveData.count(expiryDate) == 0, <span class="stringliteral">&quot;Duplicate quote for the date &quot;</span></div>
<div class="line"><span class="lineno">  391</span>                                                                 &lt;&lt; io::iso_date(expiryDate)</div>
<div class="line"><span class="lineno">  392</span>                                                                 &lt;&lt; <span class="stringliteral">&quot; provided by commodity volatility config &quot;</span></div>
<div class="line"><span class="lineno">  393</span>                                                                 &lt;&lt; vc.curveID());</div>
<div class="line"><span class="lineno">  394</span>                curveData[expiryDate] = q-&gt;quote()-&gt;value();</div>
<div class="line"><span class="lineno">  395</span>                quotesAdded++;</div>
<div class="line"><span class="lineno">  396</span>                <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Added quote &quot;</span> &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot;: (&quot;</span> &lt;&lt; io::iso_date(expiryDate) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed</div>
<div class="line"><span class="lineno">  397</span>                                    &lt;&lt; setprecision(9) &lt;&lt; q-&gt;quote()-&gt;value() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno">  398</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  399</span>                skippedExpiredQuotes++;</div>
<div class="line"><span class="lineno">  400</span>                <a class="code hl_define" href="log_8hpp.html#a9622ca943201e814041f051b7a10b3ea">WLOG</a>(<span class="stringliteral">&quot;Skipped quote &quot;</span> &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot;: (&quot;</span> &lt;&lt; io::iso_date(expiryDate) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed</div>
<div class="line"><span class="lineno">  401</span>                                      &lt;&lt; setprecision(9) &lt;&lt; q-&gt;quote()-&gt;value() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno">  402</span>            }</div>
<div class="line"><span class="lineno">  403</span>        }</div>
<div class="line"><span class="lineno">  404</span> </div>
<div class="line"><span class="lineno">  405</span>        <span class="comment">// Check that we have found all of the explicitly configured quotes</span></div>
<div class="line"><span class="lineno">  406</span>        QL_REQUIRE((quotesAdded + skippedExpiredQuotes) == vcc.quotes().size(),</div>
<div class="line"><span class="lineno">  407</span>                   <span class="stringliteral">&quot;Found &quot;</span> &lt;&lt; quotesAdded &lt;&lt; <span class="stringliteral">&quot; live quotes and &quot;</span> &lt;&lt; skippedExpiredQuotes &lt;&lt; <span class="stringliteral">&quot; expired quotes&quot;</span></div>
<div class="line"><span class="lineno">  408</span>                            &lt;&lt; <span class="stringliteral">&quot; but &quot;</span> &lt;&lt; vcc.quotes().size() &lt;&lt; <span class="stringliteral">&quot; quotes were given in config.&quot;</span>);</div>
<div class="line"><span class="lineno">  409</span>    }</div>
<div class="line"><span class="lineno">  410</span> </div>
<div class="line"><span class="lineno">  411</span>    <span class="comment">// Create the dates and volatility vector</span></div>
<div class="line"><span class="lineno">  412</span>    vector&lt;Date&gt; dates;</div>
<div class="line"><span class="lineno">  413</span>    vector&lt;Volatility&gt; volatilities;</div>
<div class="line"><span class="lineno">  414</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; datum : curveData) {</div>
<div class="line"><span class="lineno">  415</span>        dates.push_back(datum.first);</div>
<div class="line"><span class="lineno">  416</span>        volatilities.push_back(datum.second);</div>
<div class="line"><span class="lineno">  417</span>        <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Added data point (&quot;</span> &lt;&lt; io::iso_date(dates.back()) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9)</div>
<div class="line"><span class="lineno">  418</span>                                  &lt;&lt; volatilities.back() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno">  419</span>    }</div>
<div class="line"><span class="lineno">  420</span>    <span class="comment">// set max expiry date (used in buildCalibrationInfo())</span></div>
<div class="line"><span class="lineno">  421</span>    <span class="keywordflow">if</span> (!dates.empty())</div>
<div class="line"><span class="lineno">  422</span>        <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a83e7c296e20653ab73fa6c3b2ebed22a">maxExpiry_</a> = dates.back();</div>
<div class="line"><span class="lineno">  423</span>    <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Creating BlackVarianceCurve object.&quot;</span>);</div>
<div class="line"><span class="lineno">  424</span>    <span class="keyword">auto</span> tmp = boost::make_shared&lt;BlackVarianceCurve&gt;(asof, dates, volatilities, <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#ad54546634b68f067b0f3867f7283c998">dayCounter_</a>);</div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>    <span class="comment">// Set the interpolation.</span></div>
<div class="line"><span class="lineno">  427</span>    <span class="keywordflow">if</span> (vcc.interpolation() == <span class="stringliteral">&quot;Linear&quot;</span>) {</div>
<div class="line"><span class="lineno">  428</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Interpolation set to Linear.&quot;</span>);</div>
<div class="line"><span class="lineno">  429</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vcc.interpolation() == <span class="stringliteral">&quot;Cubic&quot;</span>) {</div>
<div class="line"><span class="lineno">  430</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Setting interpolation to Cubic.&quot;</span>);</div>
<div class="line"><span class="lineno">  431</span>        tmp-&gt;setInterpolation&lt;Cubic&gt;();</div>
<div class="line"><span class="lineno">  432</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vcc.interpolation() == <span class="stringliteral">&quot;LogLinear&quot;</span>) {</div>
<div class="line"><span class="lineno">  433</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Setting interpolation to LogLinear.&quot;</span>);</div>
<div class="line"><span class="lineno">  434</span>        tmp-&gt;setInterpolation&lt;LogLinear&gt;();</div>
<div class="line"><span class="lineno">  435</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  436</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Interpolation &quot;</span> &lt;&lt; vcc.interpolation() &lt;&lt; <span class="stringliteral">&quot; not recognised so leaving it Linear.&quot;</span>);</div>
<div class="line"><span class="lineno">  437</span>    }</div>
<div class="line"><span class="lineno">  438</span> </div>
<div class="line"><span class="lineno">  439</span>    <span class="comment">// Set the volatility_ member after we have possibly updated the interpolation.</span></div>
<div class="line"><span class="lineno">  440</span>    <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a> = tmp;</div>
<div class="line"><span class="lineno">  441</span> </div>
<div class="line"><span class="lineno">  442</span>    <span class="comment">// Set the extrapolation</span></div>
<div class="line"><span class="lineno">  443</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc">parseExtrapolation</a>(vcc.extrapolation()) == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a745e3db6a7ffd50e1a72b39482f0882d">Extrapolation::Flat</a>) {</div>
<div class="line"><span class="lineno">  444</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Enabling BlackVarianceCurve flat volatility extrapolation.&quot;</span>);</div>
<div class="line"><span class="lineno">  445</span>        <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;enableExtrapolation();</div>
<div class="line"><span class="lineno">  446</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc">parseExtrapolation</a>(vcc.extrapolation()) == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a6adf97f83acf6453d4a6a4b1070f3754">Extrapolation::None</a>) {</div>
<div class="line"><span class="lineno">  447</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Disabling BlackVarianceCurve extrapolation.&quot;</span>);</div>
<div class="line"><span class="lineno">  448</span>        <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;disableExtrapolation();</div>
<div class="line"><span class="lineno">  449</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc">parseExtrapolation</a>(vcc.extrapolation()) == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a57c68e2bc2b5b45f0ca5a4fa3f3c6874">Extrapolation::UseInterpolator</a>) {</div>
<div class="line"><span class="lineno">  450</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;BlackVarianceCurve does not support using interpolator for extrapolation &quot;</span></div>
<div class="line"><span class="lineno">  451</span>             &lt;&lt; <span class="stringliteral">&quot;so default to flat volatility extrapolation.&quot;</span>);</div>
<div class="line"><span class="lineno">  452</span>        <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;enableExtrapolation();</div>
<div class="line"><span class="lineno">  453</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  454</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Unexpected extrapolation so default to flat volatility extrapolation.&quot;</span>);</div>
<div class="line"><span class="lineno">  455</span>        <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;enableExtrapolation();</div>
<div class="line"><span class="lineno">  456</span>    }</div>
<div class="line"><span class="lineno">  457</span> </div>
<div class="line"><span class="lineno">  458</span>    <a class="code hl_define" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: finished building 1-D volatility curve&quot;</span>);</div>
<div class="line"><span class="lineno">  459</span>}</div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_a53aacd04237d728a4918ea672c79ba9f"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#a53aacd04237d728a4918ea672c79ba9f">ore::data::CommodityVolCurve::getExpiry</a></div><div class="ttdeci">QuantLib::Date getExpiry(const QuantLib::Date &amp;asof, const boost::shared_ptr&lt; Expiry &gt; &amp;expiry, const std::string &amp;name, QuantLib::Natural rollDays) const</div><div class="ttdoc">Get an explicit expiry date from a commodity option quote's Expiry.</div><div class="ttdef"><b>Definition:</b> <a href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l01628">commodityvolcurve.cpp:1628</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_market_datum_html_aa5b3ec8bb6c730c38b87a73c11dec808a51c1258108cb3ef6a757d4e01db7f115"><div class="ttname"><a href="classore_1_1data_1_1_market_datum.html#aa5b3ec8bb6c730c38b87a73c11dec808a51c1258108cb3ef6a757d4e01db7f115">ore::data::MarketDatum::QuoteType::RATE_LNVOL</a></div><div class="ttdeci">@ RATE_LNVOL</div></div>
<div class="ttc" id="alog_8hpp_html_a158e0f085ddedfe5c8ed069986039f50"><div class="ttname"><a href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a></div><div class="ttdeci">#define LOG(text)</div><div class="ttdoc">Logging Macro (Level = Notice)</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00506">log.hpp:506</a></div></div>
<div class="ttc" id="alog_8hpp_html_a9622ca943201e814041f051b7a10b3ea"><div class="ttname"><a href="log_8hpp.html#a9622ca943201e814041f051b7a10b3ea">WLOG</a></div><div class="ttdeci">#define WLOG(text)</div><div class="ttdoc">Logging Macro (Level = Warning)</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00504">log.hpp:504</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a8e2df513f6590afb6c85a22a458745c5a57c68e2bc2b5b45f0ca5a4fa3f3c6874"><div class="ttname"><a href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a57c68e2bc2b5b45f0ca5a4fa3f3c6874">ore::data::Extrapolation::UseInterpolator</a></div><div class="ttdeci">@ UseInterpolator</div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a8e2df513f6590afb6c85a22a458745c5a6adf97f83acf6453d4a6a4b1070f3754"><div class="ttname"><a href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a6adf97f83acf6453d4a6a4b1070f3754">ore::data::Extrapolation::None</a></div><div class="ttdeci">@ None</div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a8e2df513f6590afb6c85a22a458745c5a745e3db6a7ffd50e1a72b39482f0882d"><div class="ttname"><a href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a745e3db6a7ffd50e1a72b39482f0882d">ore::data::Extrapolation::Flat</a></div><div class="ttdeci">@ Flat</div></div>
<div class="ttc" id="anamespaceore_1_1data_html_aec1b45a4f7d2f40e0800b91d415b94fc"><div class="ttname"><a href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc">ore::data::parseExtrapolation</a></div><div class="ttdeci">Extrapolation parseExtrapolation(const string &amp;s)</div><div class="ttdoc">Parse Extrapolation from string.</div><div class="ttdef"><b>Definition:</b> <a href="parsers_8cpp_source.html#l00754">parsers.cpp:754</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_afb4bd26f4cf89fd9281278c484e0f9c3"><div class="ttname"><a href="namespaceore_1_1data.html#afb4bd26f4cf89fd9281278c484e0f9c3">ore::data::getUniqueWildcard</a></div><div class="ttdeci">boost::optional&lt; Wildcard &gt; getUniqueWildcard(const C &amp;c)</div><div class="ttdoc">checks if at most one element in C has a wild card and returns it in this case</div><div class="ttdef"><b>Definition:</b> <a href="wildcard_8hpp_source.html#l00065">wildcard.hpp:65</a></div></div>
</div><!-- fragment --><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_commodity_vol_curve_a782cc59a036687f2402136c9003e07c2_cgraph.png" border="0" usemap="#aclassore_1_1data_1_1_commodity_vol_curve_a782cc59a036687f2402136c9003e07c2_cgraph" alt=""/></div>
<map name="aclassore_1_1data_1_1_commodity_vol_curve_a782cc59a036687f2402136c9003e07c2_cgraph" id="aclassore_1_1data_1_1_commodity_vol_curve_a782cc59a036687f2402136c9003e07c2_cgraph">
<area shape="rect" title="Build a volatility curve from a 1&#45;D curve of volatility quotes." alt="" coords="5,297,104,322"/>
<area shape="rect" href="classore_1_1data_1_1_curve_config.html#a469f15054f3eb55783dfeb953fdf4373" title=" " alt="" coords="179,5,328,45"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_curve_config.html#a71d04050567400ccff5ac423a9d1570e" title=" " alt="" coords="172,69,335,109"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_config.html#a83cc42ccc32e31a0b381be7782555cd2" title=" " alt="" coords="155,133,352,173"/>
<area shape="rect" href="classore_1_1data_1_1_loader.html#a1b9199cf1feab53f4fda69ddccc4a63c" title="get quote by its unique name, throws if not existent, override in derived classes for performance" alt="" coords="180,198,327,223"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_vol_curve.html#a53aacd04237d728a4918ea672c79ba9f" title="Get an explicit expiry date from a commodity option quote&#39;s Expiry." alt="" coords="215,247,292,273"/>
<area shape="rect" href="namespaceore_1_1data.html#afb4bd26f4cf89fd9281278c484e0f9c3" title="checks if at most one element in C has a wild card and returns it in this case" alt="" coords="158,297,349,322"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_curve_config.html#a2a6f5a5c9b3b0d9dceb9f4de333cd9a9" title=" " alt="" coords="172,347,335,387"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_config.html#a274ce630c64d8e1f9c038cde36c3055e" title=" " alt="" coords="155,411,352,451"/>
<area shape="rect" href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc" title="Parse Extrapolation from string." alt="" coords="159,475,348,501"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_curve_config.html#ab4850b56e8bad34c1c061fed3ade5d1a" title=" " alt="" coords="172,525,335,565"/>
<area shape="rect" href="classore_1_1data_1_1_quote_based_volatility_config.html#a385c53054b5d8a065ba24438db33e705" title=" " alt="" coords="152,589,355,629"/>
<area shape="rect" href="classore_1_1data_1_1_loader.html#a0113deda97c9b9f64d1a436cda884a51" title="get all quotes, TODO change the return value to std::set" alt="" coords="405,191,533,231"/>
<area shape="rect" href="classore_1_1data_1_1_wildcard.html#a2c8716c3eecd1edf1c1675aa730d59e3" title=" " alt="" coords="403,289,535,329"/>
</map>
</div>

</div>
</div>
<a id="abcc61ebefadc0e8481bdf86dc739d23c" name="abcc61ebefadc0e8481bdf86dc739d23c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abcc61ebefadc0e8481bdf86dc739d23c">&#9670;&#160;</a></span>buildVolatility() <span class="overload">[3/7]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatility </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_volatility_strike_surface_config.html">VolatilityStrikeSurfaceConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vssc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;&#160;</td>
          <td class="paramname"><em>loader</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Build a volatility surface from a collection of expiry and absolute strike pairs. </p>

</div>
</div>
<a id="accbfc0352ecd2e4be852a0cc6238fbb5" name="accbfc0352ecd2e4be852a0cc6238fbb5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#accbfc0352ecd2e4be852a0cc6238fbb5">&#9670;&#160;</a></span>buildVolatilityExplicit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatilityExplicit </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_volatility_strike_surface_config.html">VolatilityStrikeSurfaceConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vssc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;&#160;</td>
          <td class="paramname"><em>loader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; QuantLib::Real &gt; &amp;&#160;</td>
          <td class="paramname"><em>configuredStrikes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Build a volatility surface from a collection of expiry and absolute strike pairs where the strikes and expiries are both explicitly configured i.e. where wild cards are not used for either the strikes or the expiries. </p>

<p class="definition">Definition at line <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l00732">732</a> of file <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  734</span>                                                                                       {</div>
<div class="line"><span class="lineno">  735</span> </div>
<div class="line"><span class="lineno">  736</span>    <a class="code hl_define" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: start building 2-D volatility absolute strike surface with explicit strikes and expiries&quot;</span>);</div>
<div class="line"><span class="lineno">  737</span> </div>
<div class="line"><span class="lineno">  738</span>    QL_REQUIRE(vssc.quoteType() == <a class="code hl_enumvalue" href="classore_1_1data_1_1_market_datum.html#aa5b3ec8bb6c730c38b87a73c11dec808a51c1258108cb3ef6a757d4e01db7f115">MarketDatum::QuoteType::RATE_LNVOL</a>, <span class="stringliteral">&quot;CommodityVolCurve: only quote type&quot;</span> &lt;&lt;</div>
<div class="line"><span class="lineno">  739</span>        <span class="stringliteral">&quot; RATE_LNVOL is currently supported for 2-D volatility strike surface with explicit strikes and expiries.&quot;</span>);</div>
<div class="line"><span class="lineno">  740</span> </div>
<div class="line"><span class="lineno">  741</span>    <span class="comment">// Map to hold the rows of the commodity volatility matrix. The keys are the expiry dates and the values are the</span></div>
<div class="line"><span class="lineno">  742</span>    <span class="comment">// vectors of volatilities, one for each configured strike.</span></div>
<div class="line"><span class="lineno">  743</span>    map&lt;Date, vector&lt;Real&gt;&gt; surfaceData;</div>
<div class="line"><span class="lineno">  744</span> </div>
<div class="line"><span class="lineno">  745</span>    <span class="comment">// Count the number of quotes added. We check at the end that we have added all configured quotes.</span></div>
<div class="line"><span class="lineno">  746</span>    Size quotesAdded = 0;</div>
<div class="line"><span class="lineno">  747</span>    Size skippedExpiredQuotes = 0;</div>
<div class="line"><span class="lineno">  748</span>    <span class="comment">// Loop over quotes and process commodity option quotes that have been requested</span></div>
<div class="line"><span class="lineno">  749</span>    std::ostringstream ss;</div>
<div class="line"><span class="lineno">  750</span>    ss &lt;&lt; <a class="code hl_enumvalue" href="classore_1_1data_1_1_market_datum.html#a78a53e954df1d387bae9b3680287ec69af2508b77da6363a9a9bc4ca0cf59db70">MarketDatum::InstrumentType::COMMODITY_OPTION</a> &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; vssc.quoteType() &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; vc.curveID() &lt;&lt; <span class="stringliteral">&quot;/&quot;</span></div>
<div class="line"><span class="lineno">  751</span>       &lt;&lt; vc.currency() &lt;&lt; <span class="stringliteral">&quot;/*&quot;</span>;</div>
<div class="line"><span class="lineno">  752</span>    Wildcard w(ss.str());</div>
<div class="line"><span class="lineno">  753</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; md : loader.get(w, asof)) {</div>
<div class="line"><span class="lineno">  754</span> </div>
<div class="line"><span class="lineno">  755</span>        QL_REQUIRE(md-&gt;asofDate() == asof, <span class="stringliteral">&quot;MarketDatum asofDate &#39;&quot;</span> &lt;&lt; md-&gt;asofDate() &lt;&lt; <span class="stringliteral">&quot;&#39; &lt;&gt; asof &#39;&quot;</span> &lt;&lt; asof &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line"><span class="lineno">  756</span> </div>
<div class="line"><span class="lineno">  757</span>        <span class="keyword">auto</span> q = boost::dynamic_pointer_cast&lt;CommodityOptionQuote&gt;(md);</div>
<div class="line"><span class="lineno">  758</span>        QL_REQUIRE(q, <span class="stringliteral">&quot;Internal error: could not downcast MarketDatum &#39;&quot;</span> &lt;&lt; md-&gt;name() &lt;&lt; <span class="stringliteral">&quot;&#39; to CommodityOptionQuote&quot;</span>);</div>
<div class="line"><span class="lineno">  759</span> </div>
<div class="line"><span class="lineno">  760</span>        <span class="comment">// This surface is for absolute strikes only.</span></div>
<div class="line"><span class="lineno">  761</span>        <span class="keyword">auto</span> strike = boost::dynamic_pointer_cast&lt;AbsoluteStrike&gt;(q-&gt;strike());</div>
<div class="line"><span class="lineno">  762</span>        <span class="keywordflow">if</span> (!strike)</div>
<div class="line"><span class="lineno">  763</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  764</span> </div>
<div class="line"><span class="lineno">  765</span>        <span class="comment">// If the quote is not in the configured quotes continue</span></div>
<div class="line"><span class="lineno">  766</span>        <span class="keyword">auto</span> it = find(vc.quotes().begin(), vc.quotes().end(), q-&gt;name());</div>
<div class="line"><span class="lineno">  767</span>        <span class="keywordflow">if</span> (it == vc.quotes().end())</div>
<div class="line"><span class="lineno">  768</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  769</span> </div>
<div class="line"><span class="lineno">  770</span>        <span class="comment">// Process the quote</span></div>
<div class="line"><span class="lineno">  771</span>        Date eDate = <a class="code hl_function" href="classore_1_1data_1_1_commodity_vol_curve.html#a53aacd04237d728a4918ea672c79ba9f">getExpiry</a>(asof, q-&gt;expiry(), vc.futureConventionsId(), vc.optionExpiryRollDays());</div>
<div class="line"><span class="lineno">  772</span>        </div>
<div class="line"><span class="lineno">  773</span>        <span class="keywordflow">if</span> (eDate &gt; asof) {</div>
<div class="line"><span class="lineno">  774</span> </div>
<div class="line"><span class="lineno">  775</span>            <span class="comment">// Position of quote in vector of strikes</span></div>
<div class="line"><span class="lineno">  776</span>            <span class="keyword">auto</span> strikeIt = find_if(configuredStrikes.begin(), configuredStrikes.end(),</div>
<div class="line"><span class="lineno">  777</span>                                    [&amp;strike](Real s) { return close(s, strike-&gt;strike()); });</div>
<div class="line"><span class="lineno">  778</span>            Size pos = distance(configuredStrikes.begin(), strikeIt);</div>
<div class="line"><span class="lineno">  779</span>            QL_REQUIRE(pos &lt; configuredStrikes.size(),</div>
<div class="line"><span class="lineno">  780</span>                       <span class="stringliteral">&quot;The quote &#39;&quot;</span></div>
<div class="line"><span class="lineno">  781</span>                           &lt;&lt; q-&gt;name()</div>
<div class="line"><span class="lineno">  782</span>                           &lt;&lt; <span class="stringliteral">&quot;&#39; is in the list of configured quotes but does not match any of the configured strikes&quot;</span>);</div>
<div class="line"><span class="lineno">  783</span> </div>
<div class="line"><span class="lineno">  784</span>            <span class="comment">// Add quote to surface</span></div>
<div class="line"><span class="lineno">  785</span>            <span class="keywordflow">if</span> (surfaceData.count(eDate) == 0)</div>
<div class="line"><span class="lineno">  786</span>                surfaceData[eDate] = vector&lt;Real&gt;(configuredStrikes.size(), Null&lt;Real&gt;());</div>
<div class="line"><span class="lineno">  787</span> </div>
<div class="line"><span class="lineno">  788</span>            QL_REQUIRE(surfaceData[eDate][pos] == Null&lt;Real&gt;(),</div>
<div class="line"><span class="lineno">  789</span>                       <span class="stringliteral">&quot;Quote &quot;</span> &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot; provides a duplicate quote for the date &quot;</span> &lt;&lt; io::iso_date(eDate)</div>
<div class="line"><span class="lineno">  790</span>                                &lt;&lt; <span class="stringliteral">&quot; and the strike &quot;</span> &lt;&lt; configuredStrikes[pos]);</div>
<div class="line"><span class="lineno">  791</span>            surfaceData[eDate][pos] = q-&gt;quote()-&gt;value();</div>
<div class="line"><span class="lineno">  792</span>            quotesAdded++;</div>
<div class="line"><span class="lineno">  793</span> </div>
<div class="line"><span class="lineno">  794</span>            <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Added quote &quot;</span> &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot;: (&quot;</span> &lt;&lt; io::iso_date(eDate) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9)</div>
<div class="line"><span class="lineno">  795</span>                                &lt;&lt; configuredStrikes[pos] &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; q-&gt;quote()-&gt;value() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno">  796</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  797</span>            skippedExpiredQuotes++;</div>
<div class="line"><span class="lineno">  798</span>            <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Skipped quote &quot;</span> &lt;&lt; q-&gt;name() &lt;&lt; <span class="stringliteral">&quot;: (&quot;</span> &lt;&lt; io::iso_date(eDate) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9)</div>
<div class="line"><span class="lineno">  799</span>                                  &lt;&lt; q-&gt;quote()-&gt;value() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno">  800</span>        }</div>
<div class="line"><span class="lineno">  801</span>    }</div>
<div class="line"><span class="lineno">  802</span> </div>
<div class="line"><span class="lineno">  803</span>    <a class="code hl_define" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: added &quot;</span> &lt;&lt; quotesAdded &lt;&lt; <span class="stringliteral">&quot; quotes in building explicit absolute strike surface.&quot;</span>);</div>
<div class="line"><span class="lineno">  804</span> </div>
<div class="line"><span class="lineno">  805</span>    QL_REQUIRE(vc.quotes().size() == quotesAdded + skippedExpiredQuotes,</div>
<div class="line"><span class="lineno">  806</span>               <span class="stringliteral">&quot;Found &quot;</span> &lt;&lt; quotesAdded &lt;&lt; <span class="stringliteral">&quot; live quotes and &quot;</span> &lt;&lt; skippedExpiredQuotes &lt;&lt; <span class="stringliteral">&quot;expired quotes, but &quot;</span> &lt;&lt; vc.quotes().size()</div>
<div class="line"><span class="lineno">  807</span>                        &lt;&lt; <span class="stringliteral">&quot; quotes required by config.&quot;</span>);</div>
<div class="line"><span class="lineno">  808</span> </div>
<div class="line"><span class="lineno">  809</span>    <span class="comment">// Set up the BlackVarianceSurface. Note that the rows correspond to strikes and that the columns correspond to</span></div>
<div class="line"><span class="lineno">  810</span>    <span class="comment">// the expiry dates in the matrix that is fed to the BlackVarianceSurface ctor.</span></div>
<div class="line"><span class="lineno">  811</span>    vector&lt;Date&gt; expiryDates;</div>
<div class="line"><span class="lineno">  812</span>    Matrix volatilities = Matrix(configuredStrikes.size(), surfaceData.size());</div>
<div class="line"><span class="lineno">  813</span>    Size expiryIdx = 0;</div>
<div class="line"><span class="lineno">  814</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; expiryRow : surfaceData) {</div>
<div class="line"><span class="lineno">  815</span>        expiryDates.push_back(expiryRow.first);</div>
<div class="line"><span class="lineno">  816</span>        <span class="keywordflow">for</span> (Size i = 0; i &lt; configuredStrikes.size(); i++) {</div>
<div class="line"><span class="lineno">  817</span>            volatilities[i][expiryIdx] = expiryRow.second[i];</div>
<div class="line"><span class="lineno">  818</span>        }</div>
<div class="line"><span class="lineno">  819</span>        expiryIdx++;</div>
<div class="line"><span class="lineno">  820</span>    }</div>
<div class="line"><span class="lineno">  821</span> </div>
<div class="line"><span class="lineno">  822</span>    <span class="comment">// set max expiry date (used in buildCalibrationInfo())</span></div>
<div class="line"><span class="lineno">  823</span>    <span class="keywordflow">if</span> (!expiryDates.empty())</div>
<div class="line"><span class="lineno">  824</span>        <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a83e7c296e20653ab73fa6c3b2ebed22a">maxExpiry_</a> = *max_element(expiryDates.begin(), expiryDates.end());</div>
<div class="line"><span class="lineno">  825</span> </div>
<div class="line"><span class="lineno">  826</span>    <span class="comment">// Trace log the surface</span></div>
<div class="line"><span class="lineno">  827</span>    <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Explicit strike surface grid points:&quot;</span>);</div>
<div class="line"><span class="lineno">  828</span>    <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;expiry,strike,volatility&quot;</span>);</div>
<div class="line"><span class="lineno">  829</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; volatilities.rows(); i++) {</div>
<div class="line"><span class="lineno">  830</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt; volatilities.columns(); j++) {</div>
<div class="line"><span class="lineno">  831</span>            <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(io::iso_date(expiryDates[j])</div>
<div class="line"><span class="lineno">  832</span>                 &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9) &lt;&lt; configuredStrikes[i] &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; volatilities[i][j]);</div>
<div class="line"><span class="lineno">  833</span>        }</div>
<div class="line"><span class="lineno">  834</span>    }</div>
<div class="line"><span class="lineno">  835</span> </div>
<div class="line"><span class="lineno">  836</span>    <span class="comment">// Set the strike extrapolation which only matters if extrapolation is turned on for the whole surface.</span></div>
<div class="line"><span class="lineno">  837</span>    <span class="comment">// BlackVarianceSurface time extrapolation is hard-coded to constant in volatility.</span></div>
<div class="line"><span class="lineno">  838</span>    BlackVarianceSurface::Extrapolation strikeExtrap = BlackVarianceSurface::ConstantExtrapolation;</div>
<div class="line"><span class="lineno">  839</span>    <span class="keywordflow">if</span> (vssc.extrapolation()) {</div>
<div class="line"><span class="lineno">  840</span> </div>
<div class="line"><span class="lineno">  841</span>        <span class="keyword">auto</span> strikeExtrapType = <a class="code hl_function" href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc">parseExtrapolation</a>(vssc.strikeExtrapolation());</div>
<div class="line"><span class="lineno">  842</span>        <span class="keywordflow">if</span> (strikeExtrapType == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a57c68e2bc2b5b45f0ca5a4fa3f3c6874">Extrapolation::UseInterpolator</a>) {</div>
<div class="line"><span class="lineno">  843</span>            <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Strike extrapolation switched to using interpolator.&quot;</span>);</div>
<div class="line"><span class="lineno">  844</span>            strikeExtrap = BlackVarianceSurface::InterpolatorDefaultExtrapolation;</div>
<div class="line"><span class="lineno">  845</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strikeExtrapType == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a6adf97f83acf6453d4a6a4b1070f3754">Extrapolation::None</a>) {</div>
<div class="line"><span class="lineno">  846</span>            <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Strike extrapolation cannot be turned off on its own so defaulting to flat.&quot;</span>);</div>
<div class="line"><span class="lineno">  847</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strikeExtrapType == <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a745e3db6a7ffd50e1a72b39482f0882d">Extrapolation::Flat</a>) {</div>
<div class="line"><span class="lineno">  848</span>            <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Strike extrapolation has been set to flat.&quot;</span>);</div>
<div class="line"><span class="lineno">  849</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  850</span>            <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Strike extrapolation &quot;</span> &lt;&lt; strikeExtrapType &lt;&lt; <span class="stringliteral">&quot; not expected so default to flat.&quot;</span>);</div>
<div class="line"><span class="lineno">  851</span>        }</div>
<div class="line"><span class="lineno">  852</span> </div>
<div class="line"><span class="lineno">  853</span>        <span class="keyword">auto</span> timeExtrapType = <a class="code hl_function" href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc">parseExtrapolation</a>(vssc.timeExtrapolation());</div>
<div class="line"><span class="lineno">  854</span>        <span class="keywordflow">if</span> (timeExtrapType != <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a8e2df513f6590afb6c85a22a458745c5a745e3db6a7ffd50e1a72b39482f0882d">Extrapolation::Flat</a>) {</div>
<div class="line"><span class="lineno">  855</span>            <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;BlackVarianceSurface only supports flat volatility extrapolation in the time direction&quot;</span>);</div>
<div class="line"><span class="lineno">  856</span>        }</div>
<div class="line"><span class="lineno">  857</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  858</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Extrapolation is turned off for the whole surface so the time and&quot;</span></div>
<div class="line"><span class="lineno">  859</span>             &lt;&lt; <span class="stringliteral">&quot; strike extrapolation settings are ignored&quot;</span>);</div>
<div class="line"><span class="lineno">  860</span>    }</div>
<div class="line"><span class="lineno">  861</span> </div>
<div class="line"><span class="lineno">  862</span>    <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Creating BlackVarianceSurface object&quot;</span>);</div>
<div class="line"><span class="lineno">  863</span>    <span class="keyword">auto</span> tmp = boost::make_shared&lt;BlackVarianceSurface&gt;(asof, <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a936be92f5f766489c24b9ce54d702b36">calendar_</a>, expiryDates, configuredStrikes, volatilities,</div>
<div class="line"><span class="lineno">  864</span>                                                        <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#ad54546634b68f067b0f3867f7283c998">dayCounter_</a>, strikeExtrap, strikeExtrap);</div>
<div class="line"><span class="lineno">  865</span> </div>
<div class="line"><span class="lineno">  866</span>    <span class="comment">// Set the interpolation if configured properly. The default is Bilinear.</span></div>
<div class="line"><span class="lineno">  867</span>    <span class="keywordflow">if</span> (!(vssc.timeInterpolation() == <span class="stringliteral">&quot;Linear&quot;</span> &amp;&amp; vssc.strikeInterpolation() == <span class="stringliteral">&quot;Linear&quot;</span>)) {</div>
<div class="line"><span class="lineno">  868</span>        <span class="keywordflow">if</span> (vssc.timeInterpolation() != vssc.strikeInterpolation()) {</div>
<div class="line"><span class="lineno">  869</span>            <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Time and strike interpolation must be the same for BlackVarianceSurface but we got strike &quot;</span></div>
<div class="line"><span class="lineno">  870</span>                 &lt;&lt; <span class="stringliteral">&quot;interpolation &quot;</span> &lt;&lt; vssc.strikeInterpolation() &lt;&lt; <span class="stringliteral">&quot; and time interpolation &quot;</span></div>
<div class="line"><span class="lineno">  871</span>                 &lt;&lt; vssc.timeInterpolation());</div>
<div class="line"><span class="lineno">  872</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vssc.timeInterpolation() == <span class="stringliteral">&quot;Cubic&quot;</span>) {</div>
<div class="line"><span class="lineno">  873</span>            <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Setting interpolation to BiCubic&quot;</span>);</div>
<div class="line"><span class="lineno">  874</span>            tmp-&gt;setInterpolation&lt;Bicubic&gt;();</div>
<div class="line"><span class="lineno">  875</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  876</span>            <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Interpolation type &quot;</span> &lt;&lt; vssc.timeInterpolation() &lt;&lt; <span class="stringliteral">&quot; not supported in 2 dimensions&quot;</span>);</div>
<div class="line"><span class="lineno">  877</span>        }</div>
<div class="line"><span class="lineno">  878</span>    }</div>
<div class="line"><span class="lineno">  879</span> </div>
<div class="line"><span class="lineno">  880</span>    <span class="comment">// Set the volatility_ member after we have possibly updated the interpolation.</span></div>
<div class="line"><span class="lineno">  881</span>    <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a> = tmp;</div>
<div class="line"><span class="lineno">  882</span> </div>
<div class="line"><span class="lineno">  883</span>    <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Setting BlackVarianceSurface extrapolation to &quot;</span> &lt;&lt; <a class="code hl_function" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">to_string</a>(vssc.extrapolation()));</div>
<div class="line"><span class="lineno">  884</span>    <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a>-&gt;enableExtrapolation(vssc.extrapolation());</div>
<div class="line"><span class="lineno">  885</span> </div>
<div class="line"><span class="lineno">  886</span>    <a class="code hl_define" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: finished building 2-D volatility absolute strike &quot;</span></div>
<div class="line"><span class="lineno">  887</span>        &lt;&lt; <span class="stringliteral">&quot;surface with explicit strikes and expiries&quot;</span>);</div>
<div class="line"><span class="lineno">  888</span>}</div>
<div class="ttc" id="aclassore_1_1data_1_1_market_datum_html_a78a53e954df1d387bae9b3680287ec69af2508b77da6363a9a9bc4ca0cf59db70"><div class="ttname"><a href="classore_1_1data_1_1_market_datum.html#a78a53e954df1d387bae9b3680287ec69af2508b77da6363a9a9bc4ca0cf59db70">ore::data::MarketDatum::InstrumentType::COMMODITY_OPTION</a></div><div class="ttdeci">@ COMMODITY_OPTION</div></div>
</div><!-- fragment --><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_commodity_vol_curve_accbfc0352ecd2e4be852a0cc6238fbb5_cgraph.png" border="0" usemap="#aclassore_1_1data_1_1_commodity_vol_curve_accbfc0352ecd2e4be852a0cc6238fbb5_cgraph" alt=""/></div>
<map name="aclassore_1_1data_1_1_commodity_vol_curve_accbfc0352ecd2e4be852a0cc6238fbb5_cgraph" id="aclassore_1_1data_1_1_commodity_vol_curve_accbfc0352ecd2e4be852a0cc6238fbb5_cgraph">
<area shape="rect" title=" " alt="" coords="5,426,148,451"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_config.html#a14dac022d83c5fa9597e6344199a41b6" title=" " alt="" coords="199,5,396,45"/>
<area shape="rect" href="classore_1_1data_1_1_curve_config.html#a469f15054f3eb55783dfeb953fdf4373" title=" " alt="" coords="223,69,372,109"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_surface_config.html#a7dd47beba239c5ffec6a4a50f4110664" title=" " alt="" coords="210,133,385,173"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_config.html#a83cc42ccc32e31a0b381be7782555cd2" title=" " alt="" coords="199,197,396,237"/>
<area shape="rect" href="classore_1_1data_1_1_loader.html#a1b9199cf1feab53f4fda69ddccc4a63c" title="get quote by its unique name, throws if not existent, override in derived classes for performance" alt="" coords="224,262,371,287"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_vol_curve.html#a53aacd04237d728a4918ea672c79ba9f" title="Get an explicit expiry date from a commodity option quote&#39;s Expiry." alt="" coords="259,311,336,337"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_config.html#a274ce630c64d8e1f9c038cde36c3055e" title=" " alt="" coords="199,361,396,401"/>
<area shape="rect" href="namespaceore_1_1data.html#aec1b45a4f7d2f40e0800b91d415b94fc" title="Parse Extrapolation from string." alt="" coords="203,426,392,451"/>
<area shape="rect" href="classore_1_1data_1_1_curve_config.html#a69738e85aa491109ae0e57fd5833aebb" title="Return all the market quotes required for this config." alt="" coords="223,476,372,516"/>
<area shape="rect" href="classore_1_1data_1_1_quote_based_volatility_config.html#a385c53054b5d8a065ba24438db33e705" title=" " alt="" coords="196,540,399,580"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_surface_config.html#ab066a0686be5c8dc20430121a7c7147d" title=" " alt="" coords="210,604,385,644"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_surface_config.html#aad34d8325ea5f1822af8c7a550880411" title=" " alt="" coords="210,668,385,708"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_surface_config.html#af0ab27eac5840f868d415cb197da2cf5" title=" " alt="" coords="210,732,385,772"/>
<area shape="rect" href="classore_1_1data_1_1_volatility_surface_config.html#a13c055eb05fe7ed1272d0021b11a7d61" title=" " alt="" coords="210,796,385,836"/>
<area shape="rect" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455" title=" " alt="" coords="232,885,363,910"/>
<area shape="rect" href="classore_1_1data_1_1_loader.html#a0113deda97c9b9f64d1a436cda884a51" title="get all quotes, TODO change the return value to std::set" alt="" coords="447,255,575,295"/>
</map>
</div>

</div>
</div>
<a id="aa772bf4579fcbb84db47720fd747a953" name="aa772bf4579fcbb84db47720fd747a953"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa772bf4579fcbb84db47720fd747a953">&#9670;&#160;</a></span>buildVolatility() <span class="overload">[4/7]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatility </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_volatility_delta_surface_config.html">VolatilityDeltaSurfaceConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vdsc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;&#160;</td>
          <td class="paramname"><em>loader</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Build a volatility surface from a collection of expiry and strike pairs where the strikes are defined in terms of option delta and ATM values. </p>

</div>
</div>
<a id="a215f4878146bd685646285b1c621ce23" name="a215f4878146bd685646285b1c621ce23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a215f4878146bd685646285b1c621ce23">&#9670;&#160;</a></span>buildVolatility() <span class="overload">[5/7]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatility </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_volatility_moneyness_surface_config.html">VolatilityMoneynessSurfaceConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vmsc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_loader.html">Loader</a> &amp;&#160;</td>
          <td class="paramname"><em>loader</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Build a volatility surface from a collection of expiry and strike pairs where the strikes are defined in terms of moneyness levels. </p>

</div>
</div>
<a id="a6ec3a734b609ed0a997abc1b4d62fc91" name="a6ec3a734b609ed0a997abc1b4d62fc91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ec3a734b609ed0a997abc1b4d62fc91">&#9670;&#160;</a></span>buildVolatility() <span class="overload">[6/7]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatility </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_volatility_apo_future_surface_config.html">VolatilityApoFutureSurfaceConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>vapo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const QuantLib::Handle&lt; QuantLib::BlackVolTermStructure &gt; &amp;&#160;</td>
          <td class="paramname"><em>baseVts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const QuantLib::Handle&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">QuantExt::PriceTermStructure</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>basePts</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Build a future price APO surface using a given price term structure. Use the natural expiries of the future options as the expiry pillar points and use configured moneyness levels in the strike dimension. </p>

</div>
</div>
<a id="a0df8dadb9ba46fdeeae5386e27ef59a3" name="a0df8dadb9ba46fdeeae5386e27ef59a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0df8dadb9ba46fdeeae5386e27ef59a3">&#9670;&#160;</a></span>buildVolatility() <span class="overload">[7/7]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void buildVolatility </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> &amp;&#160;</td>
          <td class="paramname"><em>spec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_curve_configurations.html">CurveConfigurations</a> &amp;&#160;</td>
          <td class="paramname"><em>curveConfigs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_proxy_volatility_config.html">ProxyVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>pvc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_curve.html">CommodityCurve</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>comCurves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_vol_curve.html">CommodityVolCurve</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>volCurves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_f_x_vol_curve.html">FXVolCurve</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>fxVolCurves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const map&lt; string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_correlation_curve.html">CorrelationCurve</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>correlationCurves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_market.html">Market</a> *&#160;</td>
          <td class="paramname"><em>fxIndices</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Build a volatility surface as a proxy from another volatility surface. </p>

<p class="definition">Definition at line <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l01442">1442</a> of file <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1447</span>                                                                                                              {</div>
<div class="line"><span class="lineno"> 1448</span> </div>
<div class="line"><span class="lineno"> 1449</span>    <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Build Proxy Vol surface&quot;</span>);</div>
<div class="line"><span class="lineno"> 1450</span>    <span class="comment">// get all the configurations and the curve needed for proxying</span></div>
<div class="line"><span class="lineno"> 1451</span>    <span class="keyword">auto</span> config = *<a class="code hl_variable" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>.commodityVolatilityConfig(<a class="code hl_function" href="classore_1_1data_1_1_commodity_vol_curve.html#aa29667d9b43959f91d90f8a9df92eec2">spec</a>.<a class="code hl_function" href="classore_1_1data_1_1_curve_spec.html#a15e57a287887def554123ab18355c33c">curveConfigID</a>());</div>
<div class="line"><span class="lineno"> 1452</span> </div>
<div class="line"><span class="lineno"> 1453</span>    <span class="keyword">auto</span> proxy = pvc.proxyVolatilityCurve();</div>
<div class="line"><span class="lineno"> 1454</span>    <span class="keyword">auto</span> comConfig = *<a class="code hl_variable" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>.commodityCurveConfig(<a class="code hl_function" href="classore_1_1data_1_1_commodity_vol_curve.html#aa29667d9b43959f91d90f8a9df92eec2">spec</a>.<a class="code hl_function" href="classore_1_1data_1_1_curve_spec.html#a15e57a287887def554123ab18355c33c">curveConfigID</a>());</div>
<div class="line"><span class="lineno"> 1455</span>    <span class="keyword">auto</span> proxyConfig = *<a class="code hl_variable" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>.commodityCurveConfig(proxy);</div>
<div class="line"><span class="lineno"> 1456</span>    <span class="keyword">auto</span> proxyVolConfig = *<a class="code hl_variable" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>.commodityVolatilityConfig(proxy);</div>
<div class="line"><span class="lineno"> 1457</span> </div>
<div class="line"><span class="lineno"> 1458</span>    <span class="comment">// create dummy specs to look up the required curves</span></div>
<div class="line"><span class="lineno"> 1459</span>    CommodityCurveSpec comSpec(comConfig.currency(), <a class="code hl_function" href="classore_1_1data_1_1_commodity_vol_curve.html#aa29667d9b43959f91d90f8a9df92eec2">spec</a>.<a class="code hl_function" href="classore_1_1data_1_1_curve_spec.html#a15e57a287887def554123ab18355c33c">curveConfigID</a>());</div>
<div class="line"><span class="lineno"> 1460</span>    CommodityCurveSpec proxySpec(proxyConfig.currency(), proxy);</div>
<div class="line"><span class="lineno"> 1461</span>    CommodityVolatilityCurveSpec proxyVolSpec(proxyVolConfig.currency(), proxy);</div>
<div class="line"><span class="lineno"> 1462</span> </div>
<div class="line"><span class="lineno"> 1463</span>    <span class="comment">// Get all necessary curves</span></div>
<div class="line"><span class="lineno"> 1464</span>    <span class="keyword">auto</span> curve = comCurves.find(comSpec.name());</div>
<div class="line"><span class="lineno"> 1465</span>    QL_REQUIRE(curve != comCurves.end(),</div>
<div class="line"><span class="lineno"> 1466</span>               <span class="stringliteral">&quot;CommodityVolCurve: Failed to find commodity curve, when building commodity vol curve &quot;</span> &lt;&lt; <a class="code hl_function" href="classore_1_1data_1_1_commodity_vol_curve.html#aa29667d9b43959f91d90f8a9df92eec2">spec</a>.<a class="code hl_function" href="classore_1_1data_1_1_curve_spec.html#afa7a10b4b56522f03c698ac514b0f844">name</a>());</div>
<div class="line"><span class="lineno"> 1467</span>    <span class="keyword">auto</span> proxyCurve = comCurves.find(proxySpec.name());</div>
<div class="line"><span class="lineno"> 1468</span>    QL_REQUIRE(proxyCurve != comCurves.end(), <span class="stringliteral">&quot;currency: Failed to find commodity curve for proxy &quot;</span></div>
<div class="line"><span class="lineno"> 1469</span>                                                 &lt;&lt; proxySpec.name() &lt;&lt; <span class="stringliteral">&quot;, when building commodity vol curve &quot;</span></div>
<div class="line"><span class="lineno"> 1470</span>                                                 &lt;&lt; <a class="code hl_function" href="classore_1_1data_1_1_commodity_vol_curve.html#aa29667d9b43959f91d90f8a9df92eec2">spec</a>.<a class="code hl_function" href="classore_1_1data_1_1_curve_spec.html#afa7a10b4b56522f03c698ac514b0f844">name</a>());</div>
<div class="line"><span class="lineno"> 1471</span>    <span class="keyword">auto</span> proxyVolCurve = volCurves.find(proxyVolSpec.name());</div>
<div class="line"><span class="lineno"> 1472</span>    QL_REQUIRE(proxyVolCurve != volCurves.end(), <span class="stringliteral">&quot;CommodityVolCurve: Failed to find commodity vol curve for proxy &quot;</span></div>
<div class="line"><span class="lineno"> 1473</span>                                                       &lt;&lt; proxyVolSpec.name() &lt;&lt; <span class="stringliteral">&quot;, when building currency vol curve &quot;</span></div>
<div class="line"><span class="lineno"> 1474</span>                                                       &lt;&lt; <a class="code hl_function" href="classore_1_1data_1_1_commodity_vol_curve.html#aa29667d9b43959f91d90f8a9df92eec2">spec</a>.<a class="code hl_function" href="classore_1_1data_1_1_curve_spec.html#afa7a10b4b56522f03c698ac514b0f844">name</a>());</div>
<div class="line"><span class="lineno"> 1475</span> </div>
<div class="line"><span class="lineno"> 1476</span>    <span class="comment">// check the currency against the proxy surface currrency</span></div>
<div class="line"><span class="lineno"> 1477</span> </div>
<div class="line"><span class="lineno"> 1478</span>    boost::shared_ptr&lt;BlackVolTermStructure&gt; fxSurface;</div>
<div class="line"><span class="lineno"> 1479</span>    boost::shared_ptr&lt;FxIndex&gt; fxIndex;</div>
<div class="line"><span class="lineno"> 1480</span>    boost::shared_ptr&lt;QuantExt::CorrelationTermStructure&gt; correlation;</div>
<div class="line"><span class="lineno"> 1481</span>    <span class="keywordflow">if</span> (config.currency() != proxyVolConfig.currency() &amp;&amp; fxIndices != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno"> 1482</span>        QL_REQUIRE(!pvc.fxVolatilityCurve().empty(),</div>
<div class="line"><span class="lineno"> 1483</span>                   <span class="stringliteral">&quot;CommodityVolCurve: FXVolatilityCurve must be provided for commodity vol config &quot;</span></div>
<div class="line"><span class="lineno"> 1484</span>                       &lt;&lt; <a class="code hl_function" href="classore_1_1data_1_1_commodity_vol_curve.html#aa29667d9b43959f91d90f8a9df92eec2">spec</a>.<a class="code hl_function" href="classore_1_1data_1_1_curve_spec.html#a15e57a287887def554123ab18355c33c">curveConfigID</a>() &lt;&lt; <span class="stringliteral">&quot; as proxy currencies if different from commodity currency.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1485</span>        QL_REQUIRE(!pvc.correlationCurve().empty(),</div>
<div class="line"><span class="lineno"> 1486</span>                   <span class="stringliteral">&quot;CommodityVolCurve: CorrelationCurve must be provided for commodity vol config &quot;</span></div>
<div class="line"><span class="lineno"> 1487</span>                       &lt;&lt; <a class="code hl_function" href="classore_1_1data_1_1_commodity_vol_curve.html#aa29667d9b43959f91d90f8a9df92eec2">spec</a>.<a class="code hl_function" href="classore_1_1data_1_1_curve_spec.html#a15e57a287887def554123ab18355c33c">curveConfigID</a>() &lt;&lt; <span class="stringliteral">&quot; as proxy currencies if different from commodity currency.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1488</span> </div>
<div class="line"><span class="lineno"> 1489</span>        <span class="comment">// get the fx vol surface</span></div>
<div class="line"><span class="lineno"> 1490</span>        QL_REQUIRE(pvc.fxVolatilityCurve().size() == 6, <span class="stringliteral">&quot;CommodityVolCurve: FXVolatilityCurve provided &quot;</span></div>
<div class="line"><span class="lineno"> 1491</span>                                                             &lt;&lt; pvc.fxVolatilityCurve() &lt;&lt; <span class="stringliteral">&quot; for commodity vol config &quot;</span></div>
<div class="line"><span class="lineno"> 1492</span>                                                             &lt;&lt; <a class="code hl_function" href="classore_1_1data_1_1_commodity_vol_curve.html#aa29667d9b43959f91d90f8a9df92eec2">spec</a>.<a class="code hl_function" href="classore_1_1data_1_1_curve_spec.html#a15e57a287887def554123ab18355c33c">curveConfigID</a>()</div>
<div class="line"><span class="lineno"> 1493</span>                                                             &lt;&lt; <span class="stringliteral">&quot; must be of length 6, and of form CC1CCY2 e.g EURUSD&quot;</span>);</div>
<div class="line"><span class="lineno"> 1494</span>        <span class="keywordtype">string</span> proxyVolForCcy = pvc.fxVolatilityCurve().substr(0, 3);</div>
<div class="line"><span class="lineno"> 1495</span>        <span class="keywordtype">string</span> proxyVolDomCcy = pvc.fxVolatilityCurve().substr(3, 3);</div>
<div class="line"><span class="lineno"> 1496</span>        FXVolatilityCurveSpec fxSpec(proxyVolForCcy, proxyVolDomCcy, pvc.fxVolatilityCurve());</div>
<div class="line"><span class="lineno"> 1497</span>        <span class="keyword">auto</span> volIt = fxVolCurves.find(fxSpec.name());</div>
<div class="line"><span class="lineno"> 1498</span>        <span class="keywordflow">if</span> (volIt == fxVolCurves.end())</div>
<div class="line"><span class="lineno"> 1499</span>            QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve: cannot find required Fx volatility surface &quot;</span></div>
<div class="line"><span class="lineno"> 1500</span>                    &lt;&lt; fxSpec.name() &lt;&lt; <span class="stringliteral">&quot; to build proxy vol surface for &quot;</span> &lt;&lt; comSpec.name());</div>
<div class="line"><span class="lineno"> 1501</span>        fxSurface = volIt-&gt;second-&gt;volTermStructure();</div>
<div class="line"><span class="lineno"> 1502</span> </div>
<div class="line"><span class="lineno"> 1503</span>        <span class="comment">// check if the fx vol surface needs to be inverted</span></div>
<div class="line"><span class="lineno"> 1504</span>        <span class="keywordflow">if</span> (proxyVolForCcy != proxyVolConfig.currency()) {</div>
<div class="line"><span class="lineno"> 1505</span>            Handle&lt;BlackVolTermStructure&gt; hFx(fxSurface);</div>
<div class="line"><span class="lineno"> 1506</span>            fxSurface = boost::make_shared&lt;QuantExt::BlackInvertedVolTermStructure&gt;(hFx);</div>
<div class="line"><span class="lineno"> 1507</span>            fxSurface-&gt;enableExtrapolation();</div>
<div class="line"><span class="lineno"> 1508</span>        }</div>
<div class="line"><span class="lineno"> 1509</span> </div>
<div class="line"><span class="lineno"> 1510</span>        fxIndex = fxIndices-&gt;fxIndex(proxyVolConfig.currency() + config.currency()).currentLink();</div>
<div class="line"><span class="lineno"> 1511</span>        FXSpotSpec spotSpec(proxyVolConfig.currency(), config.currency());</div>
<div class="line"><span class="lineno"> 1512</span>        </div>
<div class="line"><span class="lineno"> 1513</span>        CorrelationCurveSpec corrSpec(pvc.correlationCurve());</div>
<div class="line"><span class="lineno"> 1514</span>        <span class="keyword">auto</span> corrIt = requiredCorrelationCurves.find(corrSpec.name());</div>
<div class="line"><span class="lineno"> 1515</span>        <span class="keywordflow">if</span> (corrIt == requiredCorrelationCurves.end())</div>
<div class="line"><span class="lineno"> 1516</span>            QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve: cannot find required correlation curve &quot;</span></div>
<div class="line"><span class="lineno"> 1517</span>                    &lt;&lt; pvc.correlationCurve() &lt;&lt; <span class="stringliteral">&quot; to build proxy vol surface for &quot;</span> &lt;&lt; comSpec.name());</div>
<div class="line"><span class="lineno"> 1518</span>        correlation = corrIt-&gt;second-&gt;corrTermStructure();</div>
<div class="line"><span class="lineno"> 1519</span>    }</div>
<div class="line"><span class="lineno"> 1520</span> </div>
<div class="line"><span class="lineno"> 1521</span>    <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#abf4baf7de4b5a3c87a9d9291f7a18116">volatility_</a> = boost::make_shared&lt;BlackVolatilitySurfaceProxy&gt;(</div>
<div class="line"><span class="lineno"> 1522</span>        proxyVolCurve-&gt;second-&gt;volatility(), curve-&gt;second-&gt;commodityIndex(), proxyCurve-&gt;second-&gt;commodityIndex(),</div>
<div class="line"><span class="lineno"> 1523</span>        fxSurface, fxIndex, correlation);</div>
<div class="line"><span class="lineno"> 1524</span>}</div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_aa29667d9b43959f91d90f8a9df92eec2"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#aa29667d9b43959f91d90f8a9df92eec2">ore::data::CommodityVolCurve::spec</a></div><div class="ttdeci">const CommodityVolatilityCurveSpec &amp; spec() const</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00062">commodityvolcurve.hpp:62</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_curve_spec_html_a15e57a287887def554123ab18355c33c"><div class="ttname"><a href="classore_1_1data_1_1_curve_spec.html#a15e57a287887def554123ab18355c33c">ore::data::CurveSpec::curveConfigID</a></div><div class="ttdeci">const std::string &amp; curveConfigID() const</div><div class="ttdef"><b>Definition:</b> <a href="curvespec_8hpp_source.html#l00083">curvespec.hpp:83</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_curve_spec_html_afa7a10b4b56522f03c698ac514b0f844"><div class="ttname"><a href="classore_1_1data_1_1_curve_spec.html#afa7a10b4b56522f03c698ac514b0f844">ore::data::CurveSpec::name</a></div><div class="ttdeci">string name() const</div><div class="ttdoc">returns the unique curve name</div><div class="ttdef"><b>Definition:</b> <a href="curvespec_8hpp_source.html#l00078">curvespec.hpp:78</a></div></div>
</div><!-- fragment --><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_commodity_vol_curve_a0df8dadb9ba46fdeeae5386e27ef59a3_cgraph.png" border="0" usemap="#aclassore_1_1data_1_1_commodity_vol_curve_a0df8dadb9ba46fdeeae5386e27ef59a3_cgraph" alt=""/></div>
<map name="aclassore_1_1data_1_1_commodity_vol_curve_a0df8dadb9ba46fdeeae5386e27ef59a3_cgraph" id="aclassore_1_1data_1_1_commodity_vol_curve_a0df8dadb9ba46fdeeae5386e27ef59a3_cgraph">
<area shape="rect" title="Build a volatility surface as a proxy from another volatility surface." alt="" coords="5,311,104,336"/>
<area shape="rect" href="classore_1_1data_1_1_proxy_volatility_config.html#a202eea0c9db63c9182ad0fa06249a534" title=" " alt="" coords="159,87,325,127"/>
<area shape="rect" href="classore_1_1data_1_1_curve_spec.html#a15e57a287887def554123ab18355c33c" title=" " alt="" coords="171,151,313,191"/>
<area shape="rect" href="classore_1_1data_1_1_market.html#a8d884a61027d5434d524779453a5b918" title=" " alt="" coords="177,239,307,279"/>
<area shape="rect" href="classore_1_1data_1_1_proxy_volatility_config.html#a2af3a0a0994bfd36ea63c3558f8234cf" title=" " alt="" coords="159,303,325,343"/>
<area shape="rect" href="classore_1_1data_1_1_curve_spec.html#afa7a10b4b56522f03c698ac514b0f844" title="returns the unique curve name" alt="" coords="171,367,313,407"/>
<area shape="rect" href="classore_1_1data_1_1_proxy_volatility_config.html#a62d0f9f8dea5b372303fdc2de239a5c3" title=" " alt="" coords="152,431,332,471"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_vol_curve.html#aa29667d9b43959f91d90f8a9df92eec2" title=" " alt="" coords="217,496,267,521"/>
<area shape="rect" href="classore_1_1data_1_1_market.html#aff00023d0e25ad7c0bf29e8cc97f9e00" title=" " alt="" coords="395,303,524,343"/>
<area shape="rect" href="classore_1_1data_1_1_market.html#a2c559acede2b82e98252067757600b56" title=" " alt="" coords="629,199,759,239"/>
<area shape="rect" href="classore_1_1data_1_1_market.html#ad39b58fb3758f6506ed0c8d59beeeb15" title=" " alt="" coords="395,239,524,279"/>
<area shape="rect" href="namespaceore_1_1data.html#a123e19b0fac4f5124a8c26bad300de0e" title=" " alt="" coords="874,7,1011,32"/>
<area shape="rect" href="group__utilities.html#gaf0c22b2380b7865d6513ec50a6990bad" title="Convert std::string to QuantExt::FxIndex." alt="" coords="380,117,539,143"/>
<area shape="rect" href="classore_1_1data_1_1_market.html#a88d67016dee39ce8f4588deb0745460f" title=" " alt="" coords="1084,222,1244,262"/>
<area shape="rect" href="classore_1_1data_1_1_market.html#a47ddd567f84d73e5f1c8201823356b1c" title=" " alt="" coords="1090,295,1238,335"/>
<area shape="rect" href="classore_1_1data_1_1_market.html#a6ea1e978ddb0a43b487424e43d409021" title=" " alt="" coords="629,371,759,411"/>
<area shape="rect" href="classore_1_1data_1_1_market.html#ad806378863fc47de6f5febb66f41715b" title=" " alt="" coords="1099,154,1229,194"/>
<area shape="rect" href="classore_1_1data_1_1_market.html#aee41b57076315adbef995006e81a8147" title=" " alt="" coords="878,206,1007,246"/>
<area shape="rect" href="namespaceore_1_1data.html#a924eb5d1881d31c82ac8abbdc15a5027" title=" " alt="" coords="587,93,801,119"/>
<area shape="rect" href="group__utilities.html#ga6e9e781a58e78200301c76161589fc7b" title="Convert text to QuantLib::Currency." alt="" coords="611,143,777,168"/>
<area shape="rect" href="group__utilities.html#gac0cf10eef45b9d706e29e7eb2ddddc90" title="check for pseudo currency = precious metal or crypto currency *‍/" alt="" coords="849,105,1036,131"/>
<area shape="rect" href="group__utilities.html#ga0f72d6fcccae10a674bdcd5095200f14" title="Convert text to QuantLib::Calendar." alt="" coords="861,56,1025,81"/>
<area shape="rect" href="classore_1_1data_1_1_curve_spec.html#a3d24768215bf6280c80eca3930ea3f55" title=" " alt="" coords="388,453,531,493"/>
<area shape="rect" href="classore_1_1data_1_1_curve_spec.html#a471fbcf9df5ab7ac2153495b4c8ac723" title=" " alt="" coords="388,367,531,407"/>
<area shape="rect" href="classore_1_1data_1_1_curve_spec.html#a0106d2fb6472e64456c6ebd018aa6300" title=" " alt="" coords="623,510,765,550"/>
<area shape="rect" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455" title=" " alt="" coords="629,460,759,485"/>
</map>
</div>

</div>
</div>
<a id="ab7e1102e1a7fab6db190335153446ece" name="ab7e1102e1a7fab6db190335153446ece"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7e1102e1a7fab6db190335153446ece">&#9670;&#160;</a></span>correctFuturePriceCurve()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Handle&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">PriceTermStructure</a> &gt; correctFuturePriceCurve </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>contractName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const boost::shared_ptr&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">QuantExt::PriceTermStructure</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>pts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; QuantLib::Date &gt; &amp;&#160;</td>
          <td class="paramname"><em>optionExpiries</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Assume that the input price curve <code>pts</code> is a future price curve giving the price of a sequence of future contracts at the contract expiry. Create a copy of this input curve with additional pillar points at the future option contract expiries. The price returned when this curve is queried at the option contract expiry or the future contract expiry is the expected future contract price i.e. the quoted future price. We need this to allow option surface creation with our current infrastructure for options on futures in particular where the surface creation relies on knowing the "forward" price. </p>

<p class="definition">Definition at line <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l01526">1526</a> of file <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1528</span>                                                                                                                {</div>
<div class="line"><span class="lineno"> 1529</span> </div>
<div class="line"><span class="lineno"> 1530</span>    <a class="code hl_define" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: start adding future price correction at option expiry.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1531</span> </div>
<div class="line"><span class="lineno"> 1532</span>    <span class="comment">// Gather curve dates and prices</span></div>
<div class="line"><span class="lineno"> 1533</span>    map&lt;Date, Real&gt; curveData;</div>
<div class="line"><span class="lineno"> 1534</span> </div>
<div class="line"><span class="lineno"> 1535</span>    <span class="comment">// Get existing curve dates and prices. Messy but can&#39;t think of another way.</span></div>
<div class="line"><span class="lineno"> 1536</span>    vector&lt;Date&gt; ptsDates;</div>
<div class="line"><span class="lineno"> 1537</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="code hl_classRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;Linear&gt;</a>&gt;(pts)) {</div>
<div class="line"><span class="lineno"> 1538</span>        ptsDates = ipc-&gt;pillarDates();</div>
<div class="line"><span class="lineno"> 1539</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="code hl_classRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;LogLinear&gt;</a>&gt;(pts)) {</div>
<div class="line"><span class="lineno"> 1540</span>        ptsDates = ipc-&gt;pillarDates();</div>
<div class="line"><span class="lineno"> 1541</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="code hl_classRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;Cubic&gt;</a>&gt;(pts)) {</div>
<div class="line"><span class="lineno"> 1542</span>        ptsDates = ipc-&gt;pillarDates();</div>
<div class="line"><span class="lineno"> 1543</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="code hl_classRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;LinearFlat&gt;</a>&gt;(pts)) {</div>
<div class="line"><span class="lineno"> 1544</span>        ptsDates = ipc-&gt;pillarDates();</div>
<div class="line"><span class="lineno"> 1545</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="code hl_classRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;LogLinearFlat&gt;</a>&gt;(pts)) {</div>
<div class="line"><span class="lineno"> 1546</span>        ptsDates = ipc-&gt;pillarDates();</div>
<div class="line"><span class="lineno"> 1547</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="code hl_classRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;CubicFlat&gt;</a>&gt;(pts)) {</div>
<div class="line"><span class="lineno"> 1548</span>        ptsDates = ipc-&gt;pillarDates();</div>
<div class="line"><span class="lineno"> 1549</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1550</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Could not cast the price term structure so do not have its pillar dates.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1551</span>    }</div>
<div class="line"><span class="lineno"> 1552</span> </div>
<div class="line"><span class="lineno"> 1553</span>    <span class="comment">// Add existing dates and prices to data.</span></div>
<div class="line"><span class="lineno"> 1554</span>    <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Got &quot;</span> &lt;&lt; ptsDates.size() &lt;&lt; <span class="stringliteral">&quot; pillar dates from the price curve.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1555</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> Date&amp; d : ptsDates) {</div>
<div class="line"><span class="lineno"> 1556</span>        curveData[d] = pts-&gt;price(d);</div>
<div class="line"><span class="lineno"> 1557</span>        <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Added (&quot;</span> &lt;&lt; io::iso_date(d) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9) &lt;&lt; curveData.at(d) &lt;&lt; <span class="stringliteral">&quot;).&quot;</span>);</div>
<div class="line"><span class="lineno"> 1558</span>    }</div>
<div class="line"><span class="lineno"> 1559</span> </div>
<div class="line"><span class="lineno"> 1560</span>    <span class="comment">// Add future price at option expiry to the curve i.e. override any interpolation between future option</span></div>
<div class="line"><span class="lineno"> 1561</span>    <span class="comment">// expiry (oed) and future expiry (fed).</span></div>
<div class="line"><span class="lineno"> 1562</span>    <span class="keyword">auto</span> futureExpiryCalculator = <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a365f188d3c44026746409d5540137c79">expCalc_</a>;</div>
<div class="line"><span class="lineno"> 1563</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#ad9d85bafc53967e3a27153fbc1f3905d">convention_</a> &amp;&amp; !<a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#ad9d85bafc53967e3a27153fbc1f3905d">convention_</a>-&gt;optionUnderlyingFutureConvention().empty()) {</div>
<div class="line"><span class="lineno"> 1564</span>        boost::shared_ptr&lt;Conventions&gt; conventions = InstrumentConventions::instance().conventions();</div>
<div class="line"><span class="lineno"> 1565</span>        <span class="keyword">auto</span> [found, conv] =</div>
<div class="line"><span class="lineno"> 1566</span>            conventions-&gt;get(<a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#ad9d85bafc53967e3a27153fbc1f3905d">convention_</a>-&gt;optionUnderlyingFutureConvention(), <a class="code hl_enumvalue" href="classore_1_1data_1_1_convention.html#a1d1cfd8ffb84e947f82999c682b666a7a1ebac8c3b4df507faf583a933771c0c2">Convention::Type::CommodityFuture</a>);</div>
<div class="line"><span class="lineno"> 1567</span>        <span class="keywordflow">if</span> (found) {</div>
<div class="line"><span class="lineno"> 1568</span>            futureExpiryCalculator = boost::make_shared&lt;ConventionsBasedFutureExpiry&gt;(</div>
<div class="line"><span class="lineno"> 1569</span>                *boost::dynamic_pointer_cast&lt;CommodityFutureConvention&gt;(conv));</div>
<div class="line"><span class="lineno"> 1570</span>        }</div>
<div class="line"><span class="lineno"> 1571</span>    }</div>
<div class="line"><span class="lineno"> 1572</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> Date&amp; oed : optionExpiries) {</div>
<div class="line"><span class="lineno"> 1573</span>        Date fed = futureExpiryCalculator-&gt;nextExpiry(<span class="keyword">true</span>, oed, 0, <span class="keyword">false</span>);</div>
<div class="line"><span class="lineno"> 1574</span>        <span class="comment">// In general, expect that the future expiry date will already be in curveData but maybe not.</span></div>
<div class="line"><span class="lineno"> 1575</span>        <span class="keyword">auto</span> it = curveData.find(fed);</div>
<div class="line"><span class="lineno"> 1576</span>        <span class="keywordflow">if</span> (it != curveData.end()) {</div>
<div class="line"><span class="lineno"> 1577</span>            curveData[oed] = it-&gt;second;</div>
<div class="line"><span class="lineno"> 1578</span>            <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Found future expiry in existing data. (Option Expiry,Future Expiry,Future Price) is (&quot;</span></div>
<div class="line"><span class="lineno"> 1579</span>                 &lt;&lt; io::iso_date(oed) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; io::iso_date(fed) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9)</div>
<div class="line"><span class="lineno"> 1580</span>                 &lt;&lt; curveData.at(oed) &lt;&lt; <span class="stringliteral">&quot;).&quot;</span>);</div>
<div class="line"><span class="lineno"> 1581</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1582</span>            curveData[oed] = pts-&gt;price(fed);</div>
<div class="line"><span class="lineno"> 1583</span>            curveData[fed] = pts-&gt;price(fed);</div>
<div class="line"><span class="lineno"> 1584</span>            <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;Future expiry not found in existing data. (Option Expiry,Future Expiry,Future Price) is (&quot;</span></div>
<div class="line"><span class="lineno"> 1585</span>                 &lt;&lt; io::iso_date(oed) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; io::iso_date(fed) &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(9)</div>
<div class="line"><span class="lineno"> 1586</span>                 &lt;&lt; curveData.at(oed) &lt;&lt; <span class="stringliteral">&quot;).&quot;</span>);</div>
<div class="line"><span class="lineno"> 1587</span>        }</div>
<div class="line"><span class="lineno"> 1588</span>    }</div>
<div class="line"><span class="lineno"> 1589</span> </div>
<div class="line"><span class="lineno"> 1590</span>    <span class="comment">// Gather data for building the &quot;corrected&quot; curve.</span></div>
<div class="line"><span class="lineno"> 1591</span>    vector&lt;Date&gt; curveDates;</div>
<div class="line"><span class="lineno"> 1592</span>    vector&lt;Real&gt; curvePrices;</div>
<div class="line"><span class="lineno"> 1593</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; kv : curveData) {</div>
<div class="line"><span class="lineno"> 1594</span>        curveDates.push_back(kv.first);</div>
<div class="line"><span class="lineno"> 1595</span>        curvePrices.push_back(kv.second);</div>
<div class="line"><span class="lineno"> 1596</span>    }</div>
<div class="line"><span class="lineno"> 1597</span>    DayCounter dc = pts-&gt;dayCounter();</div>
<div class="line"><span class="lineno"> 1598</span> </div>
<div class="line"><span class="lineno"> 1599</span>    <span class="comment">// Create the &quot;corrected&quot; curve. Again messy but can&#39;t think of another way.</span></div>
<div class="line"><span class="lineno"> 1600</span>    boost::shared_ptr&lt;PriceTermStructure&gt; cpts;</div>
<div class="line"><span class="lineno"> 1601</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="code hl_classRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;Linear&gt;</a>&gt;(pts)) {</div>
<div class="line"><span class="lineno"> 1602</span>        cpts = boost::make_shared&lt;InterpolatedPriceCurve&lt;Linear&gt;&gt;(asof, curveDates, curvePrices, dc, pts-&gt;currency());</div>
<div class="line"><span class="lineno"> 1603</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="code hl_classRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;LogLinear&gt;</a>&gt;(pts)) {</div>
<div class="line"><span class="lineno"> 1604</span>        cpts =</div>
<div class="line"><span class="lineno"> 1605</span>            boost::make_shared&lt;InterpolatedPriceCurve&lt;LogLinear&gt;&gt;(asof, curveDates, curvePrices, dc, pts-&gt;currency());</div>
<div class="line"><span class="lineno"> 1606</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="code hl_classRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;Cubic&gt;</a>&gt;(pts)) {</div>
<div class="line"><span class="lineno"> 1607</span>        cpts = boost::make_shared&lt;InterpolatedPriceCurve&lt;Cubic&gt;&gt;(asof, curveDates, curvePrices, dc, pts-&gt;currency());</div>
<div class="line"><span class="lineno"> 1608</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="code hl_classRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;LinearFlat&gt;</a>&gt;(pts)) {</div>
<div class="line"><span class="lineno"> 1609</span>        cpts =</div>
<div class="line"><span class="lineno"> 1610</span>            boost::make_shared&lt;InterpolatedPriceCurve&lt;LinearFlat&gt;&gt;(asof, curveDates, curvePrices, dc, pts-&gt;currency());</div>
<div class="line"><span class="lineno"> 1611</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="code hl_classRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;LogLinearFlat&gt;</a>&gt;(pts)) {</div>
<div class="line"><span class="lineno"> 1612</span>        cpts = boost::make_shared&lt;InterpolatedPriceCurve&lt;LogLinearFlat&gt;&gt;(asof, curveDates, curvePrices, dc,</div>
<div class="line"><span class="lineno"> 1613</span>                                                                         pts-&gt;currency());</div>
<div class="line"><span class="lineno"> 1614</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ipc = boost::dynamic_pointer_cast&lt;<a class="code hl_classRef" href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">InterpolatedPriceCurve&lt;CubicFlat&gt;</a>&gt;(pts)) {</div>
<div class="line"><span class="lineno"> 1615</span>        cpts =</div>
<div class="line"><span class="lineno"> 1616</span>            boost::make_shared&lt;InterpolatedPriceCurve&lt;CubicFlat&gt;&gt;(asof, curveDates, curvePrices, dc, pts-&gt;currency());</div>
<div class="line"><span class="lineno"> 1617</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1618</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Could not cast the price term structure so corrected curve is a linear InterpolatedPriceCurve.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1619</span>        cpts = boost::make_shared&lt;InterpolatedPriceCurve&lt;Linear&gt;&gt;(asof, curveDates, curvePrices, dc, pts-&gt;currency());</div>
<div class="line"><span class="lineno"> 1620</span>    }</div>
<div class="line"><span class="lineno"> 1621</span>    cpts-&gt;enableExtrapolation(pts-&gt;allowsExtrapolation());</div>
<div class="line"><span class="lineno"> 1622</span> </div>
<div class="line"><span class="lineno"> 1623</span>    <a class="code hl_define" href="log_8hpp.html#a158e0f085ddedfe5c8ed069986039f50">LOG</a>(<span class="stringliteral">&quot;CommodityVolCurve: finished adding future price correction at option expiry.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1624</span> </div>
<div class="line"><span class="lineno"> 1625</span>    <span class="keywordflow">return</span> Handle&lt;PriceTermStructure&gt;(cpts);</div>
<div class="line"><span class="lineno"> 1626</span>}</div>
<div class="ttc" id="aclass_quant_ext_1_1_interpolated_price_curve_html"><div class="ttname"><a href="../qle/class_quant_ext_1_1_interpolated_price_curve.html">QuantExt::InterpolatedPriceCurve</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_a365f188d3c44026746409d5540137c79"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#a365f188d3c44026746409d5540137c79">ore::data::CommodityVolCurve::expCalc_</a></div><div class="ttdeci">boost::shared_ptr&lt; QuantExt::FutureExpiryCalculator &gt; expCalc_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00074">commodityvolcurve.hpp:74</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_vol_curve_html_ad9d85bafc53967e3a27153fbc1f3905d"><div class="ttname"><a href="classore_1_1data_1_1_commodity_vol_curve.html#ad9d85bafc53967e3a27153fbc1f3905d">ore::data::CommodityVolCurve::convention_</a></div><div class="ttdeci">boost::shared_ptr&lt; CommodityFutureConvention &gt; convention_</div><div class="ttdef"><b>Definition:</b> <a href="commodityvolcurve_8hpp_source.html#l00075">commodityvolcurve.hpp:75</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_convention_html_a1d1cfd8ffb84e947f82999c682b666a7a1ebac8c3b4df507faf583a933771c0c2"><div class="ttname"><a href="classore_1_1data_1_1_convention.html#a1d1cfd8ffb84e947f82999c682b666a7a1ebac8c3b4df507faf583a933771c0c2">ore::data::Convention::Type::CommodityFuture</a></div><div class="ttdeci">@ CommodityFuture</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a53aacd04237d728a4918ea672c79ba9f" name="a53aacd04237d728a4918ea672c79ba9f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53aacd04237d728a4918ea672c79ba9f">&#9670;&#160;</a></span>getExpiry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Date getExpiry </td>
          <td>(</td>
          <td class="paramtype">const QuantLib::Date &amp;&#160;</td>
          <td class="paramname"><em>asof</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_expiry.html">Expiry</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>expiry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QuantLib::Natural&#160;</td>
          <td class="paramname"><em>rollDays</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get an explicit expiry date from a commodity option quote's <a class="el" href="classore_1_1data_1_1_expiry.html">Expiry</a>. </p>

<p class="definition">Definition at line <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l01628">1628</a> of file <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1629</span>                                                          {</div>
<div class="line"><span class="lineno"> 1630</span> </div>
<div class="line"><span class="lineno"> 1631</span>    Date result;</div>
<div class="line"><span class="lineno"> 1632</span> </div>
<div class="line"><span class="lineno"> 1633</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> expiryDate = boost::dynamic_pointer_cast&lt;ExpiryDate&gt;(expiry)) {</div>
<div class="line"><span class="lineno"> 1634</span>        result = expiryDate-&gt;expiryDate();</div>
<div class="line"><span class="lineno"> 1635</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> expiryPeriod = boost::dynamic_pointer_cast&lt;ExpiryPeriod&gt;(expiry)) {</div>
<div class="line"><span class="lineno"> 1636</span>        <span class="comment">// We may need more conventions here eventually.</span></div>
<div class="line"><span class="lineno"> 1637</span>        result = <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a936be92f5f766489c24b9ce54d702b36">calendar_</a>.adjust(asof + expiryPeriod-&gt;expiryPeriod());</div>
<div class="line"><span class="lineno"> 1638</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> fcExpiry = boost::dynamic_pointer_cast&lt;FutureContinuationExpiry&gt;(expiry)) {</div>
<div class="line"><span class="lineno"> 1639</span> </div>
<div class="line"><span class="lineno"> 1640</span>        QL_REQUIRE(<a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a365f188d3c44026746409d5540137c79">expCalc_</a>, <span class="stringliteral">&quot;CommodityVolCurve::getExpiry: need a future expiry calculator for continuation quotes.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1641</span>        QL_REQUIRE(<a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#ad9d85bafc53967e3a27153fbc1f3905d">convention_</a>, <span class="stringliteral">&quot;CommodityVolCurve::getExpiry: need a future convention for continuation quotes.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1642</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Future option continuation expiry is &quot;</span> &lt;&lt; *fcExpiry);</div>
<div class="line"><span class="lineno"> 1643</span> </div>
<div class="line"><span class="lineno"> 1644</span>        <span class="comment">// Firstly, get the next option expiry on or after the asof date</span></div>
<div class="line"><span class="lineno"> 1645</span>        result = <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a365f188d3c44026746409d5540137c79">expCalc_</a>-&gt;nextExpiry(<span class="keyword">true</span>, asof, 0, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1646</span>        <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;CommodityVolCurve::getExpiry: next option expiry relative to &quot;</span> &lt;&lt; io::iso_date(asof) &lt;&lt; <span class="stringliteral">&quot; is &quot;</span></div>
<div class="line"><span class="lineno"> 1647</span>                                                                             &lt;&lt; io::iso_date(result) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1648</span> </div>
<div class="line"><span class="lineno"> 1649</span>        <span class="comment">// Market quotes may be delivered with a given number of roll days.</span></div>
<div class="line"><span class="lineno"> 1650</span>        <span class="keywordflow">if</span> (rollDays &gt; 0) {</div>
<div class="line"><span class="lineno"> 1651</span>            Date roll;</div>
<div class="line"><span class="lineno"> 1652</span>            roll = <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a936be92f5f766489c24b9ce54d702b36">calendar_</a>.advance(result, -<span class="keyword">static_cast&lt;</span>Integer<span class="keyword">&gt;</span>(rollDays), Days);</div>
<div class="line"><span class="lineno"> 1653</span>            <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;CommodityVolCurve::getExpiry: roll days is &quot;</span> &lt;&lt; rollDays &lt;&lt; <span class="stringliteral">&quot; giving a roll date &quot;</span></div>
<div class="line"><span class="lineno"> 1654</span>                                                               &lt;&lt; io::iso_date(roll) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1655</span>            <span class="comment">// Take the next option expiry if the roll days means the roll date is before asof.</span></div>
<div class="line"><span class="lineno"> 1656</span>            <span class="keywordflow">if</span> (roll &lt; asof) {</div>
<div class="line"><span class="lineno"> 1657</span>                result = <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a365f188d3c44026746409d5540137c79">expCalc_</a>-&gt;nextExpiry(<span class="keyword">true</span>, asof, 1, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1658</span>                roll = <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a936be92f5f766489c24b9ce54d702b36">calendar_</a>.advance(result, -<span class="keyword">static_cast&lt;</span>Integer<span class="keyword">&gt;</span>(rollDays), Days);</div>
<div class="line"><span class="lineno"> 1659</span>                QL_REQUIRE(roll &gt; asof, <span class="stringliteral">&quot;CommodityVolCurve::getExpiry: expected roll to be greater than asof.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1660</span>                <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;CommodityVolCurve::getExpiry: roll date &quot;</span> &lt;&lt; io::iso_date(roll) &lt;&lt; <span class="stringliteral">&quot; is less than asof &quot;</span></div>
<div class="line"><span class="lineno"> 1661</span>                                                                &lt;&lt; io::iso_date(asof) &lt;&lt; <span class="stringliteral">&quot; so take next option expiry &quot;</span></div>
<div class="line"><span class="lineno"> 1662</span>                                                                &lt;&lt; io::iso_date(result));</div>
<div class="line"><span class="lineno"> 1663</span>            }</div>
<div class="line"><span class="lineno"> 1664</span>        }</div>
<div class="line"><span class="lineno"> 1665</span> </div>
<div class="line"><span class="lineno"> 1666</span>        <span class="comment">// At this stage, &#39;result&#39; should hold the next option expiry on or after the asof date accounting for roll </span></div>
<div class="line"><span class="lineno"> 1667</span>        <span class="comment">// days.</span></div>
<div class="line"><span class="lineno"> 1668</span>        <a class="code hl_define" href="log_8hpp.html#a99aeca53f904c71a68070e1f9d310232">TLOG</a>(<span class="stringliteral">&quot;CommodityVolCurve::getExpiry: first option expiry is &quot;</span> &lt;&lt; io::iso_date(result) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1669</span> </div>
<div class="line"><span class="lineno"> 1670</span>        <span class="comment">// If the continuation index is greater than 1 get the corresponding expiry.</span></div>
<div class="line"><span class="lineno"> 1671</span>        Natural fcIndex = fcExpiry-&gt;expiryIndex();</div>
<div class="line"><span class="lineno"> 1672</span> </div>
<div class="line"><span class="lineno"> 1673</span>        <span class="comment">// The option continuation expiry may be mapped to another one.</span></div>
<div class="line"><span class="lineno"> 1674</span>        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; ocm = <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#ad9d85bafc53967e3a27153fbc1f3905d">convention_</a>-&gt;optionContinuationMappings();</div>
<div class="line"><span class="lineno"> 1675</span>        <span class="keyword">auto</span> it = ocm.find(fcIndex);</div>
<div class="line"><span class="lineno"> 1676</span>        <span class="keywordflow">if</span> (it != ocm.end())</div>
<div class="line"><span class="lineno"> 1677</span>            fcIndex = it-&gt;second;</div>
<div class="line"><span class="lineno"> 1678</span> </div>
<div class="line"><span class="lineno"> 1679</span>        <span class="keywordflow">if</span> (fcIndex &gt; 1) {</div>
<div class="line"><span class="lineno"> 1680</span>            result += 1 * Days;</div>
<div class="line"><span class="lineno"> 1681</span>            result = <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a365f188d3c44026746409d5540137c79">expCalc_</a>-&gt;nextExpiry(<span class="keyword">true</span>, result, fcIndex - 2, <span class="keyword">true</span>);</div>
<div class="line"><span class="lineno"> 1682</span>        }</div>
<div class="line"><span class="lineno"> 1683</span> </div>
<div class="line"><span class="lineno"> 1684</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Expiry date corresponding to continuation expiry, &quot;</span> &lt;&lt; *fcExpiry &lt;&lt;</div>
<div class="line"><span class="lineno"> 1685</span>            <span class="stringliteral">&quot;, is &quot;</span> &lt;&lt; io::iso_date(result) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1686</span> </div>
<div class="line"><span class="lineno"> 1687</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1688</span>        QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve::getExpiry: cannot determine expiry type.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1689</span>    }</div>
<div class="line"><span class="lineno"> 1690</span> </div>
<div class="line"><span class="lineno"> 1691</span>    <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno"> 1692</span>}</div>
</div><!-- fragment --><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_commodity_vol_curve_a53aacd04237d728a4918ea672c79ba9f_icgraph.png" border="0" usemap="#aclassore_1_1data_1_1_commodity_vol_curve_a53aacd04237d728a4918ea672c79ba9f_icgraph" alt=""/></div>
<map name="aclassore_1_1data_1_1_commodity_vol_curve_a53aacd04237d728a4918ea672c79ba9f_icgraph" id="aclassore_1_1data_1_1_commodity_vol_curve_a53aacd04237d728a4918ea672c79ba9f_icgraph">
<area shape="rect" title="Get an explicit expiry date from a commodity option quote&#39;s Expiry." alt="" coords="196,31,273,56"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_vol_curve.html#a782cc59a036687f2402136c9003e07c2" title="Build a volatility curve from a 1&#45;D curve of volatility quotes." alt="" coords="27,5,126,31"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_vol_curve.html#accbfc0352ecd2e4be852a0cc6238fbb5" title=" " alt="" coords="5,55,148,80"/>
</map>
</div>

</div>
</div>
<a id="a1b87e769e8e9c9d6c8b0038c470dcfd1" name="a1b87e769e8e9c9d6c8b0038c470dcfd1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b87e769e8e9c9d6c8b0038c470dcfd1">&#9670;&#160;</a></span>populateCurves()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void populateCurves </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classore_1_1data_1_1_commodity_volatility_config.html">CommodityVolatilityConfig</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_yield_curve.html">YieldCurve</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>yieldCurves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, boost::shared_ptr&lt; <a class="el" href="classore_1_1data_1_1_commodity_curve.html">CommodityCurve</a> &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>commodityCurves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>searchYield</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbool.html">bool</a>&#160;</td>
          <td class="paramname"><em>dontThrow</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Populate price curve, <code>pts_</code>, and yield curve, <code>yts_</code>. </p>

<p class="definition">Definition at line <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l01694">1694</a> of file <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1697</span>                                                                         {</div>
<div class="line"><span class="lineno"> 1698</span> </div>
<div class="line"><span class="lineno"> 1699</span>    <span class="keywordflow">if</span> (searchYield) {</div>
<div class="line"><span class="lineno"> 1700</span>        <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; ytsId = config.yieldCurveId();</div>
<div class="line"><span class="lineno"> 1701</span>        <span class="keywordflow">if</span> (!ytsId.empty()) {</div>
<div class="line"><span class="lineno"> 1702</span>            <span class="keyword">auto</span> itYts = yieldCurves.find(ytsId);</div>
<div class="line"><span class="lineno"> 1703</span>            <span class="keywordflow">if</span> (itYts != yieldCurves.end()) {</div>
<div class="line"><span class="lineno"> 1704</span>                <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#acb845122ddd1a21e03828d0cd39f2e0f">yts_</a> = itYts-&gt;second-&gt;handle();</div>
<div class="line"><span class="lineno"> 1705</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!dontThrow) {</div>
<div class="line"><span class="lineno"> 1706</span>                QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve: can&#39;t find yield curve with id &quot;</span> &lt;&lt; ytsId);</div>
<div class="line"><span class="lineno"> 1707</span>            }</div>
<div class="line"><span class="lineno"> 1708</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!dontThrow) {</div>
<div class="line"><span class="lineno"> 1709</span>            QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve: YieldCurveId was not populated for &quot;</span> &lt;&lt; config.curveID());</div>
<div class="line"><span class="lineno"> 1710</span>        }</div>
<div class="line"><span class="lineno"> 1711</span>    }</div>
<div class="line"><span class="lineno"> 1712</span> </div>
<div class="line"><span class="lineno"> 1713</span>    <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; ptsId = config.priceCurveId();</div>
<div class="line"><span class="lineno"> 1714</span>    <span class="keywordflow">if</span> (!ptsId.empty()) {</div>
<div class="line"><span class="lineno"> 1715</span>        <span class="keyword">auto</span> itPts = commodityCurves.find(ptsId);</div>
<div class="line"><span class="lineno"> 1716</span>        <span class="keywordflow">if</span> (itPts != commodityCurves.end()) {</div>
<div class="line"><span class="lineno"> 1717</span>            <a class="code hl_variable" href="classore_1_1data_1_1_commodity_vol_curve.html#a2bf289bf605afd1052086f88a33fc2d1">pts_</a> = Handle&lt;PriceTermStructure&gt;(itPts-&gt;second-&gt;commodityPriceCurve());</div>
<div class="line"><span class="lineno"> 1718</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!dontThrow) {</div>
<div class="line"><span class="lineno"> 1719</span>            QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve: can&#39;t find price curve with id &quot;</span> &lt;&lt; ptsId);</div>
<div class="line"><span class="lineno"> 1720</span>        }</div>
<div class="line"><span class="lineno"> 1721</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!dontThrow) {</div>
<div class="line"><span class="lineno"> 1722</span>        QL_FAIL(<span class="stringliteral">&quot;CommodityVolCurve: PriceCurveId was not populated for &quot;</span> &lt;&lt; config.curveID());</div>
<div class="line"><span class="lineno"> 1723</span>    }</div>
<div class="line"><span class="lineno"> 1724</span>}</div>
</div><!-- fragment --><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_commodity_vol_curve_a1b87e769e8e9c9d6c8b0038c470dcfd1_cgraph.png" border="0" usemap="#aclassore_1_1data_1_1_commodity_vol_curve_a1b87e769e8e9c9d6c8b0038c470dcfd1_cgraph" alt=""/></div>
<map name="aclassore_1_1data_1_1_commodity_vol_curve_a1b87e769e8e9c9d6c8b0038c470dcfd1_cgraph" id="aclassore_1_1data_1_1_commodity_vol_curve_a1b87e769e8e9c9d6c8b0038c470dcfd1_cgraph">
<area shape="rect" title="Populate price curve, pts_, and yield curve, yts_." alt="" coords="5,77,116,102"/>
<area shape="rect" href="classore_1_1data_1_1_curve_config.html#a469f15054f3eb55783dfeb953fdf4373" title=" " alt="" coords="188,5,337,45"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_config.html#a2fbdc44fecf20e44e0628909ec636b59" title=" " alt="" coords="164,69,361,109"/>
<area shape="rect" href="classore_1_1data_1_1_commodity_volatility_config.html#a2ae1d7d237a824b8c80c8d1afc4bcdb1" title=" " alt="" coords="164,133,361,173"/>
</map>
</div>

</div>
</div>
<a id="acc2a1854aa88b4b0963f1567425ba06c" name="acc2a1854aa88b4b0963f1567425ba06c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc2a1854aa88b4b0963f1567425ba06c">&#9670;&#160;</a></span>checkMoneyness()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt; Real &gt; checkMoneyness </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>moneynessLevels</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check and return moneyness levels. </p>

<p class="definition">Definition at line <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html#l01726">1726</a> of file <a class="el" href="ored_2marketdata_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1726</span>                                                                                             {</div>
<div class="line"><span class="lineno"> 1727</span> </div>
<div class="line"><span class="lineno"> 1728</span>    <span class="keyword">using </span>boost::adaptors::transformed;</div>
<div class="line"><span class="lineno"> 1729</span>    <span class="keyword">using </span>boost::algorithm::join;</div>
<div class="line"><span class="lineno"> 1730</span> </div>
<div class="line"><span class="lineno"> 1731</span>    vector&lt;Real&gt; moneynessLevels = parseVectorOfValues&lt;Real&gt;(strMoneynessLevels, &amp;parseReal);</div>
<div class="line"><span class="lineno"> 1732</span>    sort(moneynessLevels.begin(), moneynessLevels.end(), [](Real x, Real y) { return !close(x, y) &amp;&amp; x &lt; y; });</div>
<div class="line"><span class="lineno"> 1733</span>    QL_REQUIRE(adjacent_find(moneynessLevels.begin(), moneynessLevels.end(),</div>
<div class="line"><span class="lineno"> 1734</span>                             [](Real x, Real y) { return close(x, y); }) == moneynessLevels.end(),</div>
<div class="line"><span class="lineno"> 1735</span>               <span class="stringliteral">&quot;The configured moneyness levels contain duplicates&quot;</span>);</div>
<div class="line"><span class="lineno"> 1736</span>    <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;Parsed &quot;</span> &lt;&lt; moneynessLevels.size() &lt;&lt; <span class="stringliteral">&quot; unique configured moneyness levels.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1737</span>    <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;The moneyness levels are: &quot;</span> &lt;&lt; join(</div>
<div class="line"><span class="lineno"> 1738</span>             moneynessLevels | transformed([](Real d) { <span class="keywordflow">return</span> <a class="code hl_function" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">ore::data::to_string</a>(d); }), <span class="stringliteral">&quot;,&quot;</span>));</div>
<div class="line"><span class="lineno"> 1739</span> </div>
<div class="line"><span class="lineno"> 1740</span>    <span class="keywordflow">return</span> moneynessLevels;</div>
<div class="line"><span class="lineno"> 1741</span>}</div>
</div><!-- fragment --><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_commodity_vol_curve_acc2a1854aa88b4b0963f1567425ba06c_cgraph.png" border="0" usemap="#aclassore_1_1data_1_1_commodity_vol_curve_acc2a1854aa88b4b0963f1567425ba06c_cgraph" alt=""/></div>
<map name="aclassore_1_1data_1_1_commodity_vol_curve_acc2a1854aa88b4b0963f1567425ba06c_cgraph" id="aclassore_1_1data_1_1_commodity_vol_curve_acc2a1854aa88b4b0963f1567425ba06c_cgraph">
<area shape="rect" title="Check and return moneyness levels." alt="" coords="5,67,129,92"/>
<area shape="rect" href="group__utilities.html#gad1db2a68f9a73667c3b4084d63955bdd" title="Convert text to Real." alt="" coords="177,29,316,55"/>
<area shape="rect" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455" title=" " alt="" coords="181,103,312,128"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a2d6d676f5b66ce3ee357e308044138ba" name="a2d6d676f5b66ce3ee357e308044138ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d6d676f5b66ce3ee357e308044138ba">&#9670;&#160;</a></span>spec_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> spec_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00072">72</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="abf4baf7de4b5a3c87a9d9291f7a18116" name="abf4baf7de4b5a3c87a9d9291f7a18116"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf4baf7de4b5a3c87a9d9291f7a18116">&#9670;&#160;</a></span>volatility_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt;QuantLib::BlackVolTermStructure&gt; volatility_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00073">73</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="a365f188d3c44026746409d5540137c79" name="a365f188d3c44026746409d5540137c79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a365f188d3c44026746409d5540137c79">&#9670;&#160;</a></span>expCalc_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt;<a class="elRef" href="../qle/class_quant_ext_1_1_future_expiry_calculator.html">QuantExt::FutureExpiryCalculator</a>&gt; expCalc_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00074">74</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="ad9d85bafc53967e3a27153fbc1f3905d" name="ad9d85bafc53967e3a27153fbc1f3905d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9d85bafc53967e3a27153fbc1f3905d">&#9670;&#160;</a></span>convention_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt;<a class="el" href="classore_1_1data_1_1_commodity_future_convention.html">CommodityFutureConvention</a>&gt; convention_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00075">75</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="a936be92f5f766489c24b9ce54d702b36" name="a936be92f5f766489c24b9ce54d702b36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a936be92f5f766489c24b9ce54d702b36">&#9670;&#160;</a></span>calendar_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::Calendar calendar_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00076">76</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="ad54546634b68f067b0f3867f7283c998" name="ad54546634b68f067b0f3867f7283c998"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad54546634b68f067b0f3867f7283c998">&#9670;&#160;</a></span>dayCounter_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::DayCounter dayCounter_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00077">77</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="a6406d74151328ae90b3ebeecaf0ba9a9" name="a6406d74151328ae90b3ebeecaf0ba9a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6406d74151328ae90b3ebeecaf0ba9a9">&#9670;&#160;</a></span>calibrationInfo_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt;<a class="el" href="structore_1_1data_1_1_fx_eq_comm_vol_calibration_info.html">FxEqCommVolCalibrationInfo</a>&gt; calibrationInfo_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00078">78</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="a83e7c296e20653ab73fa6c3b2ebed22a" name="a83e7c296e20653ab73fa6c3b2ebed22a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83e7c296e20653ab73fa6c3b2ebed22a">&#9670;&#160;</a></span>maxExpiry_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::Date maxExpiry_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00079">79</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="a2bf289bf605afd1052086f88a33fc2d1" name="a2bf289bf605afd1052086f88a33fc2d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2bf289bf605afd1052086f88a33fc2d1">&#9670;&#160;</a></span>pts_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::Handle&lt;<a class="elRef" href="../qle/class_quant_ext_1_1_price_term_structure.html">QuantExt::PriceTermStructure</a>&gt; pts_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00082">82</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
<a id="acb845122ddd1a21e03828d0cd39f2e0f" name="acb845122ddd1a21e03828d0cd39f2e0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb845122ddd1a21e03828d0cd39f2e0f">&#9670;&#160;</a></span>yts_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">QuantLib::Handle&lt;QuantLib::YieldTermStructure&gt; yts_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="commodityvolcurve_8hpp_source.html#l00083">83</a> of file <a class="el" href="commodityvolcurve_8hpp_source.html">commodityvolcurve.hpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.9.5
</small></address>
</body>
</html>
