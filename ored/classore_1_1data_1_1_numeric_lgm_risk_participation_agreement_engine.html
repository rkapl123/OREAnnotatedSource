<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<title>OREData: NumericLgmRiskParticipationAgreementEngine Class Reference</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="oredextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-data@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.8.11</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceore.html">ore</a></li><li class="navelem"><a class="el" href="namespaceore_1_1data.html">data</a></li><li class="navelem"><a class="el" href="classore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine.html">NumericLgmRiskParticipationAgreementEngine</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="classore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">NumericLgmRiskParticipationAgreementEngine Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="numericlgmriskparticipationagreementengine_8hpp_source.html">ored/scripting/engines/numericlgmriskparticipationagreementengine.hpp</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for NumericLgmRiskParticipationAgreementEngine:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine__inherit__graph.png" border="0" usemap="#a_numeric_lgm_risk_participation_agreement_engine_inherit__map" alt="Inheritance graph"/></div>
<map name="a_numeric_lgm_risk_participation_agreement_engine_inherit__map" id="a_numeric_lgm_risk_participation_agreement_engine_inherit__map">
<area shape="rect" title=" " alt="" coords="106,416,317,515"/>
<area shape="rect" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html" title=" " alt="" coords="5,93,204,368"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_risk_participation_agreement_1_1engine.html" title=" " alt="" coords="73,5,137,45"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html" title=" " alt="" coords="229,123,407,339"/>
</map>
</div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for NumericLgmRiskParticipationAgreementEngine:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine__coll__graph.png" border="0" usemap="#a_numeric_lgm_risk_participation_agreement_engine_coll__map" alt="Collaboration graph"/></div>
<map name="a_numeric_lgm_risk_participation_agreement_engine_coll__map" id="a_numeric_lgm_risk_participation_agreement_engine_coll__map">
<area shape="rect" title=" " alt="" coords="1308,589,1519,688"/>
<area shape="rect" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html" title=" " alt="" coords="798,412,999,540"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_risk_participation_agreement_1_1engine.html" title=" " alt="" coords="5,273,69,313"/>
<area shape="rect" title=" " alt="" coords="132,123,191,163"/>
<area shape="rect" title=" " alt="" coords="229,265,398,320"/>
<area shape="rect" title=" " alt="" coords="503,265,673,320"/>
<area shape="rect" title=" " alt="" coords="88,5,235,45"/>
<area shape="rect" title=" " alt="" coords="261,123,462,163"/>
<area shape="rect" title=" " alt="" coords="744,5,811,45"/>
<area shape="rect" title=" " alt="" coords="715,123,840,163"/>
<area shape="rect" title=" " alt="" coords="839,187,1017,241"/>
<area shape="rect" title=" " alt="" coords="531,123,629,163"/>
<area shape="rect" title=" " alt="" coords="561,5,599,45"/>
<area shape="rect" title=" " alt="" coords="974,5,1013,45"/>
<area shape="rect" title=" " alt="" coords="1127,123,1217,163"/>
<area shape="rect" title=" " alt="" coords="1013,273,1065,313"/>
<area shape="rect" title=" " alt="" coords="1089,273,1199,313"/>
<area shape="rect" title=" " alt="" coords="1049,123,1103,163"/>
<area shape="rect" title=" " alt="" coords="1915,273,2026,313"/>
<area shape="rect" title=" " alt="" coords="1562,123,1614,163"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html" title=" " alt="" coords="1640,419,1821,533"/>
<area shape="rect" title=" " alt="" coords="1635,265,1826,320"/>
<area shape="rect" title=" " alt="" coords="1851,273,1891,313"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:abf16de518f0d9ff1c61de0bd846e4e94"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine.html#abf16de518f0d9ff1c61de0bd846e4e94">NumericLgmRiskParticipationAgreementEngine</a> (const std::string &amp;baseCcy, const std::map&lt; std::string, Handle&lt; YieldTermStructure &gt; &gt; &amp;discountCurves, const std::map&lt; std::string, Handle&lt; Quote &gt; &gt; &amp;fxSpots, const boost::shared_ptr&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_linear_gauss_markov_model.html">QuantExt::LinearGaussMarkovModel</a> &gt; &amp;<a class="elRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a050ea6a9d5bc55b5d766f615d91e257a">model</a>, const Real sy, const Size ny, const Real sx, const Size nx, const Handle&lt; DefaultProbabilityTermStructure &gt; &amp;defaultCurve, const Handle&lt; Quote &gt; &amp;recoveryRate, const Size maxGapDays=Null&lt; Size &gt;(), const Size maxDiscretisationPoints=Null&lt; Size &gt;())</td></tr>
<tr class="separator:abf16de518f0d9ff1c61de0bd846e4e94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classore_1_1data_1_1_risk_participation_agreement_base_engine')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html">RiskParticipationAgreementBaseEngine</a></td></tr>
<tr class="memitem:a6badd8d52618fb19929c5b604d4f7181 inherit pub_methods_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a6badd8d52618fb19929c5b604d4f7181">RiskParticipationAgreementBaseEngine</a> (const std::string &amp;baseCcy, const std::map&lt; std::string, Handle&lt; YieldTermStructure &gt; &gt; &amp;discountCurves, const std::map&lt; std::string, Handle&lt; Quote &gt; &gt; &amp;fxSpots, const Handle&lt; DefaultProbabilityTermStructure &gt; &amp;defaultCurve, const Handle&lt; Quote &gt; &amp;recoveryRate, const Size maxGapDays=Null&lt; Size &gt;(), const Size maxDiscretizsationPoints=Null&lt; Size &gt;())</td></tr>
<tr class="separator:a6badd8d52618fb19929c5b604d4f7181 inherit pub_methods_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:ade0a74a8fd16b945b60d4f9fec832fdc"><td class="memItemLeft" align="right" valign="top">Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine.html#ade0a74a8fd16b945b60d4f9fec832fdc">protectionLegNpv</a> () const override</td></tr>
<tr class="separator:ade0a74a8fd16b945b60d4f9fec832fdc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="inherited" name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pub_static_methods_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td colspan="2" onclick="javascript:toggleInherit('pub_static_methods_classore_1_1data_1_1_risk_participation_agreement_base_engine')"><img src="closed.png" alt="-"/>&#160;Static Public Member Functions inherited from <a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html">RiskParticipationAgreementBaseEngine</a></td></tr>
<tr class="memitem:a19fa7bb64d14323e611ea636f50726ea inherit pub_static_methods_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memItemLeft" align="right" valign="top">static std::vector&lt; Date &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a19fa7bb64d14323e611ea636f50726ea">buildDiscretisationGrid</a> (const Date &amp;<a class="el" href="model_2utilities_8cpp.html#a24bc06abadc72e51af462e64714c3822">referenceDate</a>, const Date &amp;protectionStart, const Date &amp;protectionEnd, const std::vector&lt; Leg &gt; &amp;underlying, const Size maxGapDays=Null&lt; Size &gt;(), const Size maxDiscretisationPoints=Null&lt; Size &gt;())</td></tr>
<tr class="separator:a19fa7bb64d14323e611ea636f50726ea inherit pub_static_methods_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_methods_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_classore_1_1data_1_1_risk_participation_agreement_base_engine')"><img src="closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html">RiskParticipationAgreementBaseEngine</a></td></tr>
<tr class="memitem:a469ecd4d7deacd2c23aabfa700b79bdf inherit pro_methods_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memItemLeft" align="right" valign="top">virtual Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a469ecd4d7deacd2c23aabfa700b79bdf">protectionLegNpv</a> () const =0</td></tr>
<tr class="separator:a469ecd4d7deacd2c23aabfa700b79bdf inherit pro_methods_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61eb1a24e5329ccc296715a40dc3a19a inherit pro_methods_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a61eb1a24e5329ccc296715a40dc3a19a">calculate</a> () const override</td></tr>
<tr class="separator:a61eb1a24e5329ccc296715a40dc3a19a inherit pro_methods_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_methods_class_quant_ext_1_1_lgm_convolution_solver2"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_class_quant_ext_1_1_lgm_convolution_solver2')"><img src="closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el"  href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html">LgmConvolutionSolver2</a></td></tr>
<tr class="memitem:afa2101f09c99ac47506d6ab50e2c5b05 inherit pro_methods_class_quant_ext_1_1_lgm_convolution_solver2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="elRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afa2101f09c99ac47506d6ab50e2c5b05">LgmConvolutionSolver2</a> (const boost::shared_ptr&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_linear_gauss_markov_model.html">LinearGaussMarkovModel</a> &gt; &amp;<a class="elRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a050ea6a9d5bc55b5d766f615d91e257a">model</a>, const Real sy, const Size ny, const Real sx, const Size nx)</td></tr>
<tr class="separator:afa2101f09c99ac47506d6ab50e2c5b05 inherit pro_methods_class_quant_ext_1_1_lgm_convolution_solver2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afaaf32c43925e8a0f85bbba660146b8d inherit pro_methods_class_quant_ext_1_1_lgm_convolution_solver2"><td class="memItemLeft" align="right" valign="top">Size&#160;</td><td class="memItemRight" valign="bottom"><a class="elRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a> () const</td></tr>
<tr class="separator:afaaf32c43925e8a0f85bbba660146b8d inherit pro_methods_class_quant_ext_1_1_lgm_convolution_solver2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad83fd8f4a99f30bee5b71ec156941d4a inherit pro_methods_class_quant_ext_1_1_lgm_convolution_solver2"><td class="memItemLeft" align="right" valign="top"><a class="elRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="elRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#ad83fd8f4a99f30bee5b71ec156941d4a">stateGrid</a> (const Real t) const</td></tr>
<tr class="separator:ad83fd8f4a99f30bee5b71ec156941d4a inherit pro_methods_class_quant_ext_1_1_lgm_convolution_solver2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f3971be25680a745b28f6fce69d31b6 inherit pro_methods_class_quant_ext_1_1_lgm_convolution_solver2"><td class="memItemLeft" align="right" valign="top"><a class="elRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="elRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a3f3971be25680a745b28f6fce69d31b6">rollback</a> (const <a class="elRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a> &amp;v, const Real t1, const Real t0) const</td></tr>
<tr class="separator:a3f3971be25680a745b28f6fce69d31b6 inherit pro_methods_class_quant_ext_1_1_lgm_convolution_solver2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a050ea6a9d5bc55b5d766f615d91e257a inherit pro_methods_class_quant_ext_1_1_lgm_convolution_solver2"><td class="memItemLeft" align="right" valign="top">const boost::shared_ptr&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_linear_gauss_markov_model.html">LinearGaussMarkovModel</a> &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="elRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a050ea6a9d5bc55b5d766f615d91e257a">model</a> () const</td></tr>
<tr class="separator:a050ea6a9d5bc55b5d766f615d91e257a inherit pro_methods_class_quant_ext_1_1_lgm_convolution_solver2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine')"><img src="closed.png" alt="-"/>&#160;Protected Attributes inherited from <a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html">RiskParticipationAgreementBaseEngine</a></td></tr>
<tr class="memitem:ae239c5725955937ec0ba66c592cecdd1 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae239c5725955937ec0ba66c592cecdd1">baseCcy_</a></td></tr>
<tr class="separator:ae239c5725955937ec0ba66c592cecdd1 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fbd2e40654f7b9b28d60c636126fe25 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memItemLeft" align="right" valign="top">std::map&lt; std::string, Handle&lt; YieldTermStructure &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a></td></tr>
<tr class="separator:a9fbd2e40654f7b9b28d60c636126fe25 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a876f97316c68159e07070d243a6e52ed inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memItemLeft" align="right" valign="top">std::map&lt; std::string, Handle&lt; Quote &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a876f97316c68159e07070d243a6e52ed">fxSpots_</a></td></tr>
<tr class="separator:a876f97316c68159e07070d243a6e52ed inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc213ca558c2cfd047dbced63bcab643 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memItemLeft" align="right" valign="top">Handle&lt; DefaultProbabilityTermStructure &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#acc213ca558c2cfd047dbced63bcab643">defaultCurve_</a></td></tr>
<tr class="separator:acc213ca558c2cfd047dbced63bcab643 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7ab2e6ca0ab7b7fdd155f4950b7b3d6 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memItemLeft" align="right" valign="top">Handle&lt; Quote &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#af7ab2e6ca0ab7b7fdd155f4950b7b3d6">recoveryRate_</a></td></tr>
<tr class="separator:af7ab2e6ca0ab7b7fdd155f4950b7b3d6 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4eaeca9e21e17bfd7efbf6621e756823 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memItemLeft" align="right" valign="top">Size&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a4eaeca9e21e17bfd7efbf6621e756823">maxGapDays_</a></td></tr>
<tr class="separator:a4eaeca9e21e17bfd7efbf6621e756823 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6a927076473671509505a47c34f7004 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memItemLeft" align="right" valign="top">Size&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae6a927076473671509505a47c34f7004">maxDiscretisationPoints_</a></td></tr>
<tr class="separator:ae6a927076473671509505a47c34f7004 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38a4e2098671399fba5f588ea75d5a10 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memItemLeft" align="right" valign="top">std::vector&lt; Date &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">gridDates_</a></td></tr>
<tr class="separator:a38a4e2098671399fba5f588ea75d5a10 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e22290961d6b56dce069c1c4fda6386 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memItemLeft" align="right" valign="top">Date&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a></td></tr>
<tr class="separator:a3e22290961d6b56dce069c1c4fda6386 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e6528316bc85aab2f93514aaae6cec8 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memItemLeft" align="right" valign="top">Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a2e6528316bc85aab2f93514aaae6cec8">effectiveRecoveryRate_</a></td></tr>
<tr class="separator:a2e6528316bc85aab2f93514aaae6cec8 inherit pro_attribs_classore_1_1data_1_1_risk_participation_agreement_base_engine"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="numericlgmriskparticipationagreementengine_8hpp_source.html#l00036">36</a> of file <a class="el" href="numericlgmriskparticipationagreementengine_8hpp_source.html">numericlgmriskparticipationagreementengine.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="abf16de518f0d9ff1c61de0bd846e4e94" name="abf16de518f0d9ff1c61de0bd846e4e94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf16de518f0d9ff1c61de0bd846e4e94">&#9670;&#160;</a></span>NumericLgmRiskParticipationAgreementEngine()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine.html">NumericLgmRiskParticipationAgreementEngine</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>baseCcy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, Handle&lt; YieldTermStructure &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>discountCurves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, Handle&lt; Quote &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>fxSpots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const boost::shared_ptr&lt; <a class="elRef" href="../qle/class_quant_ext_1_1_linear_gauss_markov_model.html">QuantExt::LinearGaussMarkovModel</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Real&#160;</td>
          <td class="paramname"><em>sy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Size&#160;</td>
          <td class="paramname"><em>ny</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Real&#160;</td>
          <td class="paramname"><em>sx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Size&#160;</td>
          <td class="paramname"><em>nx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Handle&lt; DefaultProbabilityTermStructure &gt; &amp;&#160;</td>
          <td class="paramname"><em>defaultCurve</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Handle&lt; Quote &gt; &amp;&#160;</td>
          <td class="paramname"><em>recoveryRate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Size&#160;</td>
          <td class="paramname"><em>maxGapDays</em> = <code>Null&lt;Size&gt;()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Size&#160;</td>
          <td class="paramname"><em>maxDiscretisationPoints</em> = <code>Null&lt;Size&gt;()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="numericlgmriskparticipationagreementengine_8cpp_source.html#l00037">37</a> of file <a class="el" href="numericlgmriskparticipationagreementengine_8cpp_source.html">numericlgmriskparticipationagreementengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   43</span>    : <a class="code hl_function" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a6badd8d52618fb19929c5b604d4f7181">RiskParticipationAgreementBaseEngine</a>(baseCcy, discountCurves, fxSpots, defaultCurve, recoveryRate, maxGapDays,</div>
<div class="line"><span class="lineno">   44</span>                                           maxDiscretisationPoints),</div>
<div class="line"><span class="lineno">   45</span>      <a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afa2101f09c99ac47506d6ab50e2c5b05">LgmConvolutionSolver2</a>(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a050ea6a9d5bc55b5d766f615d91e257a">model</a>, sy, ny, sx, nx) {</div>
<div class="line"><span class="lineno">   46</span>    registerWith(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a050ea6a9d5bc55b5d766f615d91e257a">LgmConvolutionSolver2::model</a>());</div>
<div class="line"><span class="lineno">   47</span>}</div>
<div class="ttc" id="aclass_quant_ext_1_1_lgm_convolution_solver2_html_a050ea6a9d5bc55b5d766f615d91e257a"><div class="ttname"><a href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a050ea6a9d5bc55b5d766f615d91e257a">QuantExt::LgmConvolutionSolver2::model</a></div><div class="ttdeci">const boost::shared_ptr&lt; LinearGaussMarkovModel &gt; &amp; model() const</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_lgm_convolution_solver2_html_afa2101f09c99ac47506d6ab50e2c5b05"><div class="ttname"><a href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afa2101f09c99ac47506d6ab50e2c5b05">QuantExt::LgmConvolutionSolver2::LgmConvolutionSolver2</a></div><div class="ttdeci">LgmConvolutionSolver2(const boost::shared_ptr&lt; LinearGaussMarkovModel &gt; &amp;model, const Real sy, const Size ny, const Real sx, const Size nx)</div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_a6badd8d52618fb19929c5b604d4f7181"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a6badd8d52618fb19929c5b604d4f7181">ore::data::RiskParticipationAgreementBaseEngine::RiskParticipationAgreementBaseEngine</a></div><div class="ttdeci">RiskParticipationAgreementBaseEngine(const std::string &amp;baseCcy, const std::map&lt; std::string, Handle&lt; YieldTermStructure &gt; &gt; &amp;discountCurves, const std::map&lt; std::string, Handle&lt; Quote &gt; &gt; &amp;fxSpots, const Handle&lt; DefaultProbabilityTermStructure &gt; &amp;defaultCurve, const Handle&lt; Quote &gt; &amp;recoveryRate, const Size maxGapDays=Null&lt; Size &gt;(), const Size maxDiscretizsationPoints=Null&lt; Size &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8cpp_source.html#l00029">riskparticipationagreementbaseengine.cpp:29</a></div></div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine_abf16de518f0d9ff1c61de0bd846e4e94_cgraph.png" border="0" usemap="#aclassore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine_abf16de518f0d9ff1c61de0bd846e4e94_cgraph" alt=""/></div>
<map name="aclassore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine_abf16de518f0d9ff1c61de0bd846e4e94_cgraph" id="aclassore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine_abf16de518f0d9ff1c61de0bd846e4e94_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,199,45"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a050ea6a9d5bc55b5d766f615d91e257a" title=" " alt="" coords="247,5,423,45"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ade0a74a8fd16b945b60d4f9fec832fdc" name="ade0a74a8fd16b945b60d4f9fec832fdc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade0a74a8fd16b945b60d4f9fec832fdc">&#9670;&#160;</a></span>protectionLegNpv()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Real protectionLegNpv </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">private</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a469ecd4d7deacd2c23aabfa700b79bdf">RiskParticipationAgreementBaseEngine</a>.</p>

<p class="definition">Definition at line <a class="el" href="numericlgmriskparticipationagreementengine_8cpp_source.html#l00331">331</a> of file <a class="el" href="numericlgmriskparticipationagreementengine_8cpp_source.html">numericlgmriskparticipationagreementengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  331</span>                                                                        {</div>
<div class="line"><span class="lineno">  332</span> </div>
<div class="line"><span class="lineno">  333</span>    <span class="comment">// check underlying legs are in the same ccy</span></div>
<div class="line"><span class="lineno">  334</span> </div>
<div class="line"><span class="lineno">  335</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; ccy : <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlyingCcys) {</div>
<div class="line"><span class="lineno">  336</span>        QL_REQUIRE(</div>
<div class="line"><span class="lineno">  337</span>            ccy == <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlyingCcys.front(),</div>
<div class="line"><span class="lineno">  338</span>            <span class="stringliteral">&quot;NumericLgmRiskParticipationAgreementEngine::protectionLegNpv(): underlying ccys must all be the same, got &quot;</span></div>
<div class="line"><span class="lineno">  339</span>                &lt;&lt; ccy &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlyingCcys.front());</div>
<div class="line"><span class="lineno">  340</span>    }</div>
<div class="line"><span class="lineno">  341</span> </div>
<div class="line"><span class="lineno">  342</span>    <span class="comment">// the option dates will be the mid points of the grid intervals</span></div>
<div class="line"><span class="lineno">  343</span> </div>
<div class="line"><span class="lineno">  344</span>    std::vector&lt;Date&gt; optionDates;</div>
<div class="line"><span class="lineno">  345</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">gridDates_</a>.size() - 1; ++i) {</div>
<div class="line"><span class="lineno">  346</span>        optionDates.push_back(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">gridDates_</a>[i] + (<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">gridDates_</a>[i + 1] - <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">gridDates_</a>[i]) / 2);</div>
<div class="line"><span class="lineno">  347</span>    }</div>
<div class="line"><span class="lineno">  348</span> </div>
<div class="line"><span class="lineno">  349</span>    <span class="comment">// collect simulation dates for coupons:</span></div>
<div class="line"><span class="lineno">  350</span>    <span class="comment">// - Ibor: these are future fixing dates resp. payment dates of an already fixed Ibor coupon</span></div>
<div class="line"><span class="lineno">  351</span>    <span class="comment">// - OIS : max( today , first fixing date )</span></div>
<div class="line"><span class="lineno">  352</span>    <span class="comment">// - Fixed: pay date</span></div>
<div class="line"><span class="lineno">  353</span> </div>
<div class="line"><span class="lineno">  354</span>    std::vector&lt;Date&gt; couponDates;</div>
<div class="line"><span class="lineno">  355</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; l : <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlying) {</div>
<div class="line"><span class="lineno">  356</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; c : l) {</div>
<div class="line"><span class="lineno">  357</span>            <span class="comment">// already paid =&gt; skip</span></div>
<div class="line"><span class="lineno">  358</span>            <span class="keywordflow">if</span> (c-&gt;date() &lt;= <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a>)</div>
<div class="line"><span class="lineno">  359</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  360</span>            IborCouponAnalyzer iborCouponAnalyzer(c);</div>
<div class="line"><span class="lineno">  361</span>            ONCouponAnalyzer onCouponAnalyzer(c);</div>
<div class="line"><span class="lineno">  362</span>            <span class="keywordflow">if</span> (iborCouponAnalyzer.underlying() != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  363</span>                <span class="keywordflow">if</span> (iborCouponAnalyzer.underlying()-&gt;fixingDate() &gt;= <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a>) {</div>
<div class="line"><span class="lineno">  364</span>                    <span class="comment">// Ibor Coupon with future fixing date</span></div>
<div class="line"><span class="lineno">  365</span>                    couponDates.push_back(iborCouponAnalyzer.underlying()-&gt;fixingDate());</div>
<div class="line"><span class="lineno">  366</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  367</span>                    <span class="comment">// Ibor Coupon with past fixing date</span></div>
<div class="line"><span class="lineno">  368</span>                    couponDates.push_back(c-&gt;date());</div>
<div class="line"><span class="lineno">  369</span>                }</div>
<div class="line"><span class="lineno">  370</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (onCouponAnalyzer.isONCoupon()) {</div>
<div class="line"><span class="lineno">  371</span>                <span class="keywordflow">if</span> (onCouponAnalyzer.fixingDates().empty())</div>
<div class="line"><span class="lineno">  372</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  373</span>                couponDates.push_back(std::max(onCouponAnalyzer.fixingDates().front(), <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a>));</div>
<div class="line"><span class="lineno">  374</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boost::dynamic_pointer_cast&lt;FixedRateCoupon&gt;(c) != <span class="keyword">nullptr</span> ||</div>
<div class="line"><span class="lineno">  375</span>                       boost::dynamic_pointer_cast&lt;SimpleCashFlow&gt;(c) != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  376</span>                couponDates.push_back(c-&gt;date());</div>
<div class="line"><span class="lineno">  377</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  378</span>                QL_FAIL(<span class="stringliteral">&quot;NumericLgmRiskParticipationAgreementEngine: unsupported coupon type  when constructing event &quot;</span></div>
<div class="line"><span class="lineno">  379</span>                        <span class="stringliteral">&quot;dates, only (capped/floored) Ibor, OIS, Fixed, SimpleCashFlow supported&quot;</span>);</div>
<div class="line"><span class="lineno">  380</span>            }</div>
<div class="line"><span class="lineno">  381</span>        }</div>
<div class="line"><span class="lineno">  382</span>    }</div>
<div class="line"><span class="lineno">  383</span> </div>
<div class="line"><span class="lineno">  384</span>    <span class="comment">// collect future call dates and associated rebates (if applicable)</span></div>
<div class="line"><span class="lineno">  385</span> </div>
<div class="line"><span class="lineno">  386</span>    std::vector&lt;Date&gt; callDates;</div>
<div class="line"><span class="lineno">  387</span>    std::vector&lt;Real&gt; callRebates;</div>
<div class="line"><span class="lineno">  388</span>    std::vector&lt;Date&gt; callRebatePayDates;</div>
<div class="line"><span class="lineno">  389</span>    <span class="keywordflow">if</span> (<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.exercise) {</div>
<div class="line"><span class="lineno">  390</span>        Size idx = 0;</div>
<div class="line"><span class="lineno">  391</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; d : <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.exercise-&gt;dates()) {</div>
<div class="line"><span class="lineno">  392</span>            <span class="keywordflow">if</span> (d &gt; <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a>) {</div>
<div class="line"><span class="lineno">  393</span>                callDates.push_back(d);</div>
<div class="line"><span class="lineno">  394</span>                <span class="keywordflow">if</span> (<span class="keyword">auto</span> r = boost::dynamic_pointer_cast&lt;QuantExt::RebatedExercise&gt;(<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.exercise)) {</div>
<div class="line"><span class="lineno">  395</span>                    callRebates.push_back(r-&gt;rebate(idx));</div>
<div class="line"><span class="lineno">  396</span>                    callRebatePayDates.push_back(r-&gt;rebatePaymentDate(idx));</div>
<div class="line"><span class="lineno">  397</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  398</span>                    callRebates.push_back(0);</div>
<div class="line"><span class="lineno">  399</span>                    callRebatePayDates.push_back(d);</div>
<div class="line"><span class="lineno">  400</span>                }</div>
<div class="line"><span class="lineno">  401</span>            }</div>
<div class="line"><span class="lineno">  402</span>            ++idx;</div>
<div class="line"><span class="lineno">  403</span>        }</div>
<div class="line"><span class="lineno">  404</span>    }</div>
<div class="line"><span class="lineno">  405</span> </div>
<div class="line"><span class="lineno">  406</span>    <span class="comment">// build event dates = optionDates + couponDates + exercise dates for callables / swaptions</span></div>
<div class="line"><span class="lineno">  407</span> </div>
<div class="line"><span class="lineno">  408</span>    std::set&lt;Date&gt; uniqueDates;</div>
<div class="line"><span class="lineno">  409</span>    uniqueDates.insert(optionDates.begin(), optionDates.end());</div>
<div class="line"><span class="lineno">  410</span>    uniqueDates.insert(couponDates.begin(), couponDates.end());</div>
<div class="line"><span class="lineno">  411</span>    uniqueDates.insert(callDates.begin(), callDates.end());</div>
<div class="line"><span class="lineno">  412</span> </div>
<div class="line"><span class="lineno">  413</span>    std::vector&lt;Date&gt; eventDates(uniqueDates.begin(), uniqueDates.end());</div>
<div class="line"><span class="lineno">  414</span> </div>
<div class="line"><span class="lineno">  415</span>    <span class="comment">// build event times</span></div>
<div class="line"><span class="lineno">  416</span> </div>
<div class="line"><span class="lineno">  417</span>    std::vector&lt;Real&gt; eventTimes;</div>
<div class="line"><span class="lineno">  418</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; d : eventDates) {</div>
<div class="line"><span class="lineno">  419</span>        eventTimes.push_back(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>[<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae239c5725955937ec0ba66c592cecdd1">baseCcy_</a>]-&gt;timeFromReference(d));</div>
<div class="line"><span class="lineno">  420</span>    }</div>
<div class="line"><span class="lineno">  421</span> </div>
<div class="line"><span class="lineno">  422</span>    <span class="comment">// build objects and collect information needed for rollback</span></div>
<div class="line"><span class="lineno">  423</span> </div>
<div class="line"><span class="lineno">  424</span>    std::vector&lt;std::vector&lt;Real&gt;&gt; fixedCoupons(eventDates.size());</div>
<div class="line"><span class="lineno">  425</span>    std::vector&lt;std::vector&lt;int&gt;&gt; fixedCouponsLatestRelevantCallEventIndex(eventDates.size());</div>
<div class="line"><span class="lineno">  426</span> </div>
<div class="line"><span class="lineno">  427</span>    std::vector&lt;std::vector&lt;boost::shared_ptr&lt;InterestRateIndex&gt;&gt;&gt; floatingIndices(eventDates.size());</div>
<div class="line"><span class="lineno">  428</span>    std::vector&lt;std::vector&lt;Real&gt;&gt; floatingGearings(eventDates.size());</div>
<div class="line"><span class="lineno">  429</span>    std::vector&lt;std::vector&lt;Real&gt;&gt; floatingSpreads(eventDates.size());</div>
<div class="line"><span class="lineno">  430</span>    std::vector&lt;std::vector&lt;Real&gt;&gt; floatingCaps(eventDates.size());</div>
<div class="line"><span class="lineno">  431</span>    std::vector&lt;std::vector&lt;Real&gt;&gt; floatingFloors(eventDates.size());</div>
<div class="line"><span class="lineno">  432</span>    std::vector&lt;std::vector&lt;Real&gt;&gt; floatingMultipliers(eventDates.size());</div>
<div class="line"><span class="lineno">  433</span>    std::vector&lt;std::vector&lt;Real&gt;&gt; payTimes(eventDates.size());</div>
<div class="line"><span class="lineno">  434</span>    std::vector&lt;std::vector&lt;bool&gt;&gt; nakedOption(eventDates.size());</div>
<div class="line"><span class="lineno">  435</span>    std::vector&lt;std::vector&lt;bool&gt;&gt; onIsAveraging(eventDates.size());</div>
<div class="line"><span class="lineno">  436</span>    std::vector&lt;std::vector&lt;std::vector&lt;Date&gt;&gt;&gt; onFixingDates(eventDates.size());</div>
<div class="line"><span class="lineno">  437</span>    std::vector&lt;std::vector&lt;std::vector&lt;Date&gt;&gt;&gt; onValueDates(eventDates.size());</div>
<div class="line"><span class="lineno">  438</span>    std::vector&lt;std::vector&lt;std::vector&lt;Real&gt;&gt;&gt; onDt(eventDates.size());</div>
<div class="line"><span class="lineno">  439</span>    std::vector&lt;std::vector&lt;Size&gt;&gt; onRateCutoff(eventDates.size());</div>
<div class="line"><span class="lineno">  440</span>    std::vector&lt;std::vector&lt;bool&gt;&gt; onIncludeSpread(eventDates.size());</div>
<div class="line"><span class="lineno">  441</span>    std::vector&lt;std::vector&lt;Period&gt;&gt; onLookback(eventDates.size());</div>
<div class="line"><span class="lineno">  442</span>    std::vector&lt;std::vector&lt;bool&gt;&gt; onLocalCapFloor(eventDates.size());</div>
<div class="line"><span class="lineno">  443</span>    std::vector&lt;std::vector&lt;int&gt;&gt; floatingCouponsLatestRelevantCallEventIndex(eventDates.size());</div>
<div class="line"><span class="lineno">  444</span> </div>
<div class="line"><span class="lineno">  445</span>    std::vector&lt;Size&gt; optionDateIndex(eventDates.size());</div>
<div class="line"><span class="lineno">  446</span> </div>
<div class="line"><span class="lineno">  447</span>    std::vector&lt;Size&gt; callDateIndex(eventDates.size());</div>
<div class="line"><span class="lineno">  448</span>    std::vector&lt;Real&gt; callRebateAmount(eventDates.size());</div>
<div class="line"><span class="lineno">  449</span>    std::vector&lt;Real&gt; callRebatePayTime(eventDates.size());</div>
<div class="line"><span class="lineno">  450</span> </div>
<div class="line"><span class="lineno">  451</span>    <span class="comment">// trapped coupons w.r.t. optionDates, these are coupons that are missing on the event</span></div>
<div class="line"><span class="lineno">  452</span>    <span class="comment">// date although they are relevant, i.e.</span></div>
<div class="line"><span class="lineno">  453</span>    <span class="comment">// - Ibor Coupons with fixingDate &lt; eventDate &lt; paymentDate</span></div>
<div class="line"><span class="lineno">  454</span>    <span class="comment">// - ON Coupons with first fixingDate &lt; eventDate &lt; paymentDate</span></div>
<div class="line"><span class="lineno">  455</span>    <span class="comment">// We memorise the original event index of these coupons, so that we can include them</span></div>
<div class="line"><span class="lineno">  456</span>    <span class="comment">// in the npv as seen from the event date</span></div>
<div class="line"><span class="lineno">  457</span>    std::vector&lt;std::set&lt;Size&gt;&gt; trappedCouponIndex(eventDates.size());</div>
<div class="line"><span class="lineno">  458</span> </div>
<div class="line"><span class="lineno">  459</span>    <span class="comment">// trapped coupons w.r.t. call dates, these are coupons that are missing on the event</span></div>
<div class="line"><span class="lineno">  460</span>    <span class="comment">// date although they are relevant, i.e.</span></div>
<div class="line"><span class="lineno">  461</span>    <span class="comment">// - Ibor Coupons with fixingDate &lt; eventDate &lt;= accrualStart</span></div>
<div class="line"><span class="lineno">  462</span>    <span class="comment">// - ON Coupons with first fixingDate &lt; eventDate &lt;= accrualStart</span></div>
<div class="line"><span class="lineno">  463</span>    <span class="comment">// Again we memorise the original event index of these coupons, so that we can include them</span></div>
<div class="line"><span class="lineno">  464</span>    <span class="comment">// in the exercise into npv as seen from the event date</span></div>
<div class="line"><span class="lineno">  465</span>    std::vector&lt;std::set&lt;Size&gt;&gt; trappedCouponIndexCall(eventDates.size());</div>
<div class="line"><span class="lineno">  466</span> </div>
<div class="line"><span class="lineno">  467</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; eventDates.size(); ++i) {</div>
<div class="line"><span class="lineno">  468</span> </div>
<div class="line"><span class="lineno">  469</span>        <span class="comment">// set option date index (or null if it is not an option date)</span></div>
<div class="line"><span class="lineno">  470</span> </div>
<div class="line"><span class="lineno">  471</span>        <span class="keyword">auto</span> od = std::find(optionDates.begin(), optionDates.end(), eventDates[i]);</div>
<div class="line"><span class="lineno">  472</span>        <span class="keywordflow">if</span> (od != optionDates.end()) {</div>
<div class="line"><span class="lineno">  473</span>            optionDateIndex[i] = std::distance(optionDates.begin(), od);</div>
<div class="line"><span class="lineno">  474</span>            <span class="comment">// on option dates, search for trapped coupons (see above for definition)</span></div>
<div class="line"><span class="lineno">  475</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; l : <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlying) {</div>
<div class="line"><span class="lineno">  476</span>                <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; c : l) {</div>
<div class="line"><span class="lineno">  477</span>                    IborCouponAnalyzer iborCouponAnalyzer(c);</div>
<div class="line"><span class="lineno">  478</span>                    ONCouponAnalyzer onCouponAnalyzer(c);</div>
<div class="line"><span class="lineno">  479</span>                    <span class="keywordflow">if</span> (iborCouponAnalyzer.underlying() != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  480</span>                        <span class="keywordflow">if</span> (iborCouponAnalyzer.underlying()-&gt;fixingDate() &gt;= <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a> &amp;&amp;</div>
<div class="line"><span class="lineno">  481</span>                            iborCouponAnalyzer.underlying()-&gt;fixingDate() &lt; eventDates[i] &amp;&amp;</div>
<div class="line"><span class="lineno">  482</span>                            eventDates[i] &lt; c-&gt;date()) {</div>
<div class="line"><span class="lineno">  483</span>                            trappedCouponIndex[i].insert(</div>
<div class="line"><span class="lineno">  484</span>                                getEventIndex(eventDates, iborCouponAnalyzer.underlying()-&gt;fixingDate()));</div>
<div class="line"><span class="lineno">  485</span>                        }</div>
<div class="line"><span class="lineno">  486</span>                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (onCouponAnalyzer.isONCoupon()) {</div>
<div class="line"><span class="lineno">  487</span>                        <span class="keywordflow">if</span> (onCouponAnalyzer.fixingDates().empty())</div>
<div class="line"><span class="lineno">  488</span>                            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  489</span>                        Date d = std::max(onCouponAnalyzer.fixingDates().front(), <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a>);</div>
<div class="line"><span class="lineno">  490</span>                        <span class="keywordflow">if</span> (d &lt; eventDates[i] &amp;&amp; eventDates[i] &lt; c-&gt;date()) {</div>
<div class="line"><span class="lineno">  491</span>                            trappedCouponIndex[i].insert(getEventIndex(eventDates, d));</div>
<div class="line"><span class="lineno">  492</span>                        }</div>
<div class="line"><span class="lineno">  493</span>                    }</div>
<div class="line"><span class="lineno">  494</span>                    <span class="comment">// fixed coupons and simple cashflows are not relevant here</span></div>
<div class="line"><span class="lineno">  495</span>                }</div>
<div class="line"><span class="lineno">  496</span>            }</div>
<div class="line"><span class="lineno">  497</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  498</span>            optionDateIndex[i] = Null&lt;Size&gt;();</div>
<div class="line"><span class="lineno">  499</span>        }</div>
<div class="line"><span class="lineno">  500</span> </div>
<div class="line"><span class="lineno">  501</span>        <span class="comment">// set exercise date index for callables / swaptions</span></div>
<div class="line"><span class="lineno">  502</span> </div>
<div class="line"><span class="lineno">  503</span>        <span class="keyword">auto</span> cd = std::find(callDates.begin(), callDates.end(), eventDates[i]);</div>
<div class="line"><span class="lineno">  504</span>        <span class="keywordflow">if</span> (cd != callDates.end()) {</div>
<div class="line"><span class="lineno">  505</span>            callDateIndex[i] = std::distance(callDates.begin(), cd);</div>
<div class="line"><span class="lineno">  506</span>            <span class="comment">// on call dates, search for trapped coupons, trapped coupons 2 (see above for definition)</span></div>
<div class="line"><span class="lineno">  507</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; l : <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlying) {</div>
<div class="line"><span class="lineno">  508</span>                <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; c : l) {</div>
<div class="line"><span class="lineno">  509</span>                    IborCouponAnalyzer iborCouponAnalyzer(c);</div>
<div class="line"><span class="lineno">  510</span>                    ONCouponAnalyzer onCouponAnalyzer(c);</div>
<div class="line"><span class="lineno">  511</span>                    <span class="keywordflow">if</span> (iborCouponAnalyzer.underlying() != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  512</span>                        <span class="keywordflow">if</span> (iborCouponAnalyzer.underlying()-&gt;fixingDate() &gt;= <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a> &amp;&amp;</div>
<div class="line"><span class="lineno">  513</span>                            iborCouponAnalyzer.underlying()-&gt;fixingDate() &lt; eventDates[i] &amp;&amp;</div>
<div class="line"><span class="lineno">  514</span>                            eventDates[i] &lt;= iborCouponAnalyzer.underlying()-&gt;accrualStartDate()) {</div>
<div class="line"><span class="lineno">  515</span>                            trappedCouponIndexCall[i].insert(</div>
<div class="line"><span class="lineno">  516</span>                                getEventIndex(eventDates, iborCouponAnalyzer.underlying()-&gt;fixingDate()));</div>
<div class="line"><span class="lineno">  517</span>                        }</div>
<div class="line"><span class="lineno">  518</span>                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (onCouponAnalyzer.isONCoupon()) {</div>
<div class="line"><span class="lineno">  519</span>                        <span class="keywordflow">if</span> (onCouponAnalyzer.fixingDates().empty())</div>
<div class="line"><span class="lineno">  520</span>                            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  521</span>                        Date d = std::max(onCouponAnalyzer.fixingDates().front(), <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a>);</div>
<div class="line"><span class="lineno">  522</span>                        <span class="keywordflow">if</span> (d &lt; eventDates[i] &amp;&amp; eventDates[i] &lt;= onCouponAnalyzer.accrualStartDate()) {</div>
<div class="line"><span class="lineno">  523</span>                            trappedCouponIndexCall[i].insert(getEventIndex(eventDates, d));</div>
<div class="line"><span class="lineno">  524</span>                        }</div>
<div class="line"><span class="lineno">  525</span>                    }</div>
<div class="line"><span class="lineno">  526</span>                    <span class="comment">// fixed coupons and simple cashflows are not relevant here</span></div>
<div class="line"><span class="lineno">  527</span>                }</div>
<div class="line"><span class="lineno">  528</span>            }</div>
<div class="line"><span class="lineno">  529</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  530</span>            callDateIndex[i] = Null&lt;Size&gt;();</div>
<div class="line"><span class="lineno">  531</span>        }</div>
<div class="line"><span class="lineno">  532</span> </div>
<div class="line"><span class="lineno">  533</span>        <span class="comment">// loop over coupons and fill vectors used in rollback for the current event date</span></div>
<div class="line"><span class="lineno">  534</span> </div>
<div class="line"><span class="lineno">  535</span>        <span class="keyword">auto</span> underlyingPayer = <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlyingPayer.begin();</div>
<div class="line"><span class="lineno">  536</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; l : <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlying) {</div>
<div class="line"><span class="lineno">  537</span>            <span class="keywordtype">bool</span> isPayer = *(underlyingPayer++);</div>
<div class="line"><span class="lineno">  538</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; c : l) {</div>
<div class="line"><span class="lineno">  539</span>                <span class="comment">// already paid =&gt; skip</span></div>
<div class="line"><span class="lineno">  540</span>                <span class="keywordflow">if</span> (c-&gt;date() &lt;= <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a>)</div>
<div class="line"><span class="lineno">  541</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  542</span>                IborCouponAnalyzer iborCouponAnalyzer(c);</div>
<div class="line"><span class="lineno">  543</span>                ONCouponAnalyzer onCouponAnalyzer(c);</div>
<div class="line"><span class="lineno">  544</span>                <span class="keywordflow">if</span> (iborCouponAnalyzer.underlying() != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  545</span>                    <span class="keywordflow">if</span> (iborCouponAnalyzer.underlying()-&gt;fixingDate() &gt;= <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a> &amp;&amp;</div>
<div class="line"><span class="lineno">  546</span>                        iborCouponAnalyzer.underlying()-&gt;fixingDate() == eventDates[i]) {</div>
<div class="line"><span class="lineno">  547</span>                        <span class="comment">// Ibor coupon with future fixing</span></div>
<div class="line"><span class="lineno">  548</span>                        floatingIndices[i].push_back(iborCouponAnalyzer.underlying()-&gt;iborIndex());</div>
<div class="line"><span class="lineno">  549</span>                        floatingGearings[i].push_back(iborCouponAnalyzer.underlying()-&gt;gearing());</div>
<div class="line"><span class="lineno">  550</span>                        floatingSpreads[i].push_back(iborCouponAnalyzer.underlying()-&gt;spread());</div>
<div class="line"><span class="lineno">  551</span>                        floatingMultipliers[i].push_back(iborCouponAnalyzer.underlying()-&gt;nominal() *</div>
<div class="line"><span class="lineno">  552</span>                                                         iborCouponAnalyzer.underlying()-&gt;accrualPeriod() *</div>
<div class="line"><span class="lineno">  553</span>                                                         (isPayer ? -1.0 : 1.0));</div>
<div class="line"><span class="lineno">  554</span>                        floatingCaps[i].push_back(iborCouponAnalyzer.cap());</div>
<div class="line"><span class="lineno">  555</span>                        floatingFloors[i].push_back(iborCouponAnalyzer.floor());</div>
<div class="line"><span class="lineno">  556</span>                        nakedOption[i].push_back(iborCouponAnalyzer.nakedOption());</div>
<div class="line"><span class="lineno">  557</span>                        payTimes[i].push_back(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>[<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae239c5725955937ec0ba66c592cecdd1">baseCcy_</a>]-&gt;timeFromReference(c-&gt;date()));</div>
<div class="line"><span class="lineno">  558</span>                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iborCouponAnalyzer.underlying()-&gt;fixingDate() &lt; <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a> &amp;&amp;</div>
<div class="line"><span class="lineno">  559</span>                               c-&gt;date() == eventDates[i]) {</div>
<div class="line"><span class="lineno">  560</span>                        <span class="comment">// already fixed Ibor coupon =&gt; treat as fixed coupon</span></div>
<div class="line"><span class="lineno">  561</span>                        fixedCoupons[i].push_back((isPayer ? -1.0 : 1.0) * c-&gt;amount());</div>
<div class="line"><span class="lineno">  562</span>                        fixedCouponsLatestRelevantCallEventIndex[i].push_back(getLatestRelevantCallIndex(</div>
<div class="line"><span class="lineno">  563</span>                            iborCouponAnalyzer.underlying()-&gt;accrualStartDate(), callDates, eventDates));</div>
<div class="line"><span class="lineno">  564</span>                    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  565</span>                        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  566</span>                    }</div>
<div class="line"><span class="lineno">  567</span>                    <span class="comment">// on coupon specifics, not relevant for ibor, but need to populate them as well</span></div>
<div class="line"><span class="lineno">  568</span>                    onFixingDates[i].push_back(std::vector&lt;Date&gt;());</div>
<div class="line"><span class="lineno">  569</span>                    onValueDates[i].push_back(std::vector&lt;Date&gt;());</div>
<div class="line"><span class="lineno">  570</span>                    onDt[i].push_back(std::vector&lt;Real&gt;());</div>
<div class="line"><span class="lineno">  571</span>                    onRateCutoff[i].push_back(0);</div>
<div class="line"><span class="lineno">  572</span>                    onIncludeSpread[i].push_back(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  573</span>                    onLookback[i].push_back(0 * Days);</div>
<div class="line"><span class="lineno">  574</span>                    onLocalCapFloor[i].push_back(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  575</span>                    onIsAveraging[i].push_back(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  576</span>                    floatingCouponsLatestRelevantCallEventIndex[i].push_back(getLatestRelevantCallIndex(</div>
<div class="line"><span class="lineno">  577</span>                        iborCouponAnalyzer.underlying()-&gt;accrualStartDate(), callDates, eventDates));</div>
<div class="line"><span class="lineno">  578</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (onCouponAnalyzer.isONCoupon()) {</div>
<div class="line"><span class="lineno">  579</span>                    <span class="keywordflow">if</span> (onCouponAnalyzer.fixingDates().empty())</div>
<div class="line"><span class="lineno">  580</span>                        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  581</span>                    <span class="comment">// ON coupon (avg, comp, with or without cf)</span></div>
<div class="line"><span class="lineno">  582</span>                    Date d = std::max(onCouponAnalyzer.fixingDates().front(), <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a>);</div>
<div class="line"><span class="lineno">  583</span>                    <span class="keywordflow">if</span> (d == eventDates[i]) {</div>
<div class="line"><span class="lineno">  584</span>                        floatingIndices[i].push_back(onCouponAnalyzer.overnightIndex());</div>
<div class="line"><span class="lineno">  585</span>                        floatingGearings[i].push_back(onCouponAnalyzer.gearing());</div>
<div class="line"><span class="lineno">  586</span>                        floatingSpreads[i].push_back(onCouponAnalyzer.spread());</div>
<div class="line"><span class="lineno">  587</span>                        floatingMultipliers[i].push_back(onCouponAnalyzer.nominal() * onCouponAnalyzer.accrualPeriod() *</div>
<div class="line"><span class="lineno">  588</span>                                                         (isPayer ? -1.0 : 1.0));</div>
<div class="line"><span class="lineno">  589</span>                        floatingCaps[i].push_back(onCouponAnalyzer.cap());</div>
<div class="line"><span class="lineno">  590</span>                        floatingFloors[i].push_back(onCouponAnalyzer.floor());</div>
<div class="line"><span class="lineno">  591</span>                        nakedOption[i].push_back(onCouponAnalyzer.nakedOption());</div>
<div class="line"><span class="lineno">  592</span>                        onLocalCapFloor[i].push_back(onCouponAnalyzer.localCapFloor());</div>
<div class="line"><span class="lineno">  593</span>                        onFixingDates[i].push_back(onCouponAnalyzer.fixingDates());</div>
<div class="line"><span class="lineno">  594</span>                        onValueDates[i].push_back(onCouponAnalyzer.valueDates());</div>
<div class="line"><span class="lineno">  595</span>                        onDt[i].push_back(onCouponAnalyzer.dt());</div>
<div class="line"><span class="lineno">  596</span>                        onRateCutoff[i].push_back(onCouponAnalyzer.rateCutoff());</div>
<div class="line"><span class="lineno">  597</span>                        onIncludeSpread[i].push_back(onCouponAnalyzer.includeSpread());</div>
<div class="line"><span class="lineno">  598</span>                        onLookback[i].push_back(onCouponAnalyzer.lookback());</div>
<div class="line"><span class="lineno">  599</span>                        onIsAveraging[i].push_back(onCouponAnalyzer.isAveraging());</div>
<div class="line"><span class="lineno">  600</span>                        payTimes[i].push_back(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>[<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae239c5725955937ec0ba66c592cecdd1">baseCcy_</a>]-&gt;timeFromReference(c-&gt;date()));</div>
<div class="line"><span class="lineno">  601</span>                        floatingCouponsLatestRelevantCallEventIndex[i].push_back(</div>
<div class="line"><span class="lineno">  602</span>                            getLatestRelevantCallIndex(onCouponAnalyzer.accrualStartDate(), callDates, eventDates));</div>
<div class="line"><span class="lineno">  603</span>                    }</div>
<div class="line"><span class="lineno">  604</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> cpn = boost::dynamic_pointer_cast&lt;FixedRateCoupon&gt;(c)) {</div>
<div class="line"><span class="lineno">  605</span>                    <span class="keywordflow">if</span> (c-&gt;date() == eventDates[i]) {</div>
<div class="line"><span class="lineno">  606</span>                        <span class="comment">// genuine fixed rate coupon</span></div>
<div class="line"><span class="lineno">  607</span>                        fixedCoupons[i].push_back((isPayer ? -1.0 : 1.0) * cpn-&gt;amount());</div>
<div class="line"><span class="lineno">  608</span>                        fixedCouponsLatestRelevantCallEventIndex[i].push_back(</div>
<div class="line"><span class="lineno">  609</span>                            getLatestRelevantCallIndex(cpn-&gt;accrualStartDate(), callDates, eventDates));</div>
<div class="line"><span class="lineno">  610</span>                    }</div>
<div class="line"><span class="lineno">  611</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (boost::dynamic_pointer_cast&lt;SimpleCashFlow&gt;(c) != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">  612</span>                    <span class="keywordflow">if</span> (c-&gt;date() == eventDates[i]) {</div>
<div class="line"><span class="lineno">  613</span>                        <span class="comment">// simple cash flow</span></div>
<div class="line"><span class="lineno">  614</span>                        fixedCoupons[i].push_back((isPayer ? -1.0 : 1.0) * c-&gt;amount());</div>
<div class="line"><span class="lineno">  615</span>                        fixedCouponsLatestRelevantCallEventIndex[i].push_back(</div>
<div class="line"><span class="lineno">  616</span>                            getLatestRelevantCallIndex(c-&gt;date(), callDates, eventDates));</div>
<div class="line"><span class="lineno">  617</span>                    }</div>
<div class="line"><span class="lineno">  618</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  619</span>                    QL_FAIL(<span class="stringliteral">&quot;NumericLgmRiskParticipationAgreementEngine: unsupported coupon type when collecting &quot;</span></div>
<div class="line"><span class="lineno">  620</span>                            <span class="stringliteral">&quot;coupon data, only (capped/floored) Ibor, OIS, Fixed, SimpleCashFlow supported&quot;</span>);</div>
<div class="line"><span class="lineno">  621</span>                }</div>
<div class="line"><span class="lineno">  622</span>            }</div>
<div class="line"><span class="lineno">  623</span>        }</div>
<div class="line"><span class="lineno">  624</span> </div>
<div class="line"><span class="lineno">  625</span>    } <span class="comment">// loop over event dates</span></div>
<div class="line"><span class="lineno">  626</span> </div>
<div class="line"><span class="lineno">  627</span>    <span class="comment">// setup the vectorised LGM model which we use for the calculations below</span></div>
<div class="line"><span class="lineno">  628</span> </div>
<div class="line"><span class="lineno">  629</span>    LgmVectorised lgm(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a050ea6a9d5bc55b5d766f615d91e257a">model</a>()-&gt;parametrization());</div>
<div class="line"><span class="lineno">  630</span> </div>
<div class="line"><span class="lineno">  631</span>    <span class="comment">// rollback</span></div>
<div class="line"><span class="lineno">  632</span> </div>
<div class="line"><span class="lineno">  633</span>    std::map&lt;int, RandomVariable&gt; underlyingPv;</div>
<div class="line"><span class="lineno">  634</span>    underlyingPv[0] = RandomVariable(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a>(), 0.0);</div>
<div class="line"><span class="lineno">  635</span> </div>
<div class="line"><span class="lineno">  636</span>    RandomVariable swaptionPv(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a>(), 0.0);</div>
<div class="line"><span class="lineno">  637</span> </div>
<div class="line"><span class="lineno">  638</span>    std::vector&lt;Real&gt; optionPv(optionDates.size(), 0.0);</div>
<div class="line"><span class="lineno">  639</span> </div>
<div class="line"><span class="lineno">  640</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(eventDates.size()) - 1; i &gt;= 0; --i) {</div>
<div class="line"><span class="lineno">  641</span> </div>
<div class="line"><span class="lineno">  642</span>        <span class="comment">// get states for current event dates</span></div>
<div class="line"><span class="lineno">  643</span> </div>
<div class="line"><span class="lineno">  644</span>        <span class="keyword">auto</span> states = <a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#ad83fd8f4a99f30bee5b71ec156941d4a">stateGrid</a>(eventTimes[i]);</div>
<div class="line"><span class="lineno">  645</span> </div>
<div class="line"><span class="lineno">  646</span>        <span class="comment">// rollback underlying PV to current event date, if we are not on the latest event date</span></div>
<div class="line"><span class="lineno">  647</span> </div>
<div class="line"><span class="lineno">  648</span>        <span class="keywordflow">if</span> (i &lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(eventDates.size()) - 1) {</div>
<div class="line"><span class="lineno">  649</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; u : underlyingPv) {</div>
<div class="line"><span class="lineno">  650</span>                u.second = <a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a3f3971be25680a745b28f6fce69d31b6">rollback</a>(u.second, eventTimes[i + 1], eventTimes[i]);</div>
<div class="line"><span class="lineno">  651</span>            }</div>
<div class="line"><span class="lineno">  652</span>        }</div>
<div class="line"><span class="lineno">  653</span> </div>
<div class="line"><span class="lineno">  654</span>        <span class="comment">// move relevant PV components to index 0</span></div>
<div class="line"><span class="lineno">  655</span> </div>
<div class="line"><span class="lineno">  656</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; u : underlyingPv) {</div>
<div class="line"><span class="lineno">  657</span>            <span class="keywordflow">if</span> (u.first != 0 &amp;&amp; i &lt;= u.first) {</div>
<div class="line"><span class="lineno">  658</span>                underlyingPv[0] += u.second;</div>
<div class="line"><span class="lineno">  659</span>                u.second = RandomVariable(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a>(), 0.0);</div>
<div class="line"><span class="lineno">  660</span>            }</div>
<div class="line"><span class="lineno">  661</span>        }</div>
<div class="line"><span class="lineno">  662</span> </div>
<div class="line"><span class="lineno">  663</span>        <span class="comment">// rollback swaption PV</span></div>
<div class="line"><span class="lineno">  664</span> </div>
<div class="line"><span class="lineno">  665</span>        <span class="keywordflow">if</span> (i &lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(eventDates.size()) - 1) {</div>
<div class="line"><span class="lineno">  666</span>            swaptionPv = <a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a3f3971be25680a745b28f6fce69d31b6">rollback</a>(swaptionPv, eventTimes[i + 1], eventTimes[i]);</div>
<div class="line"><span class="lineno">  667</span>        }</div>
<div class="line"><span class="lineno">  668</span> </div>
<div class="line"><span class="lineno">  669</span>        <span class="comment">// loop over floating coupons with fixingDate == eventDate and add them to the underlyingPv</span></div>
<div class="line"><span class="lineno">  670</span> </div>
<div class="line"><span class="lineno">  671</span>        <span class="keywordflow">for</span> (Size k = 0; k &lt; floatingIndices[i].size(); ++k) {</div>
<div class="line"><span class="lineno">  672</span>            RandomVariable rate;</div>
<div class="line"><span class="lineno">  673</span>            <span class="keywordflow">if</span> (<span class="keyword">auto</span> on = boost::dynamic_pointer_cast&lt;OvernightIndex&gt;(floatingIndices[i][k])) {</div>
<div class="line"><span class="lineno">  674</span>                <span class="keywordflow">if</span> (onIsAveraging[i][k]) {</div>
<div class="line"><span class="lineno">  675</span>                    rate =</div>
<div class="line"><span class="lineno">  676</span>                        lgm.averagedOnRate(on, onFixingDates[i][k], onValueDates[i][k], onDt[i][k], onRateCutoff[i][k],</div>
<div class="line"><span class="lineno">  677</span>                                           onIncludeSpread[i][k], floatingSpreads[i][k], floatingGearings[i][k],</div>
<div class="line"><span class="lineno">  678</span>                                           onLookback[i][k], floatingCaps[i][k], floatingFloors[i][k],</div>
<div class="line"><span class="lineno">  679</span>                                           onLocalCapFloor[i][k], nakedOption[i][k], eventTimes[i], states);</div>
<div class="line"><span class="lineno">  680</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  681</span>                    rate = lgm.compoundedOnRate(on, onFixingDates[i][k], onValueDates[i][k], onDt[i][k],</div>
<div class="line"><span class="lineno">  682</span>                                                onRateCutoff[i][k], onIncludeSpread[i][k], floatingSpreads[i][k],</div>
<div class="line"><span class="lineno">  683</span>                                                floatingGearings[i][k], onLookback[i][k], floatingCaps[i][k],</div>
<div class="line"><span class="lineno">  684</span>                                                floatingFloors[i][k], onLocalCapFloor[i][k], nakedOption[i][k],</div>
<div class="line"><span class="lineno">  685</span>                                                eventTimes[i], states);</div>
<div class="line"><span class="lineno">  686</span>                }</div>
<div class="line"><span class="lineno">  687</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ibor = boost::dynamic_pointer_cast&lt;IborIndex&gt;(floatingIndices[i][k])) {</div>
<div class="line"><span class="lineno">  688</span>                rate = computeIborRate(lgm.fixing(ibor, eventDates[i], eventTimes[i], states), floatingSpreads[i][k],</div>
<div class="line"><span class="lineno">  689</span>                                       floatingGearings[i][k], floatingFloors[i][k], floatingCaps[i][k],</div>
<div class="line"><span class="lineno">  690</span>                                       nakedOption[i][k]);</div>
<div class="line"><span class="lineno">  691</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  692</span>                QL_FAIL(<span class="stringliteral">&quot;NumericLgmRiskParticipationAgreementEngine: unexpected index, should be IborIndex or &quot;</span></div>
<div class="line"><span class="lineno">  693</span>                        <span class="stringliteral">&quot;OvernightIndex&quot;</span>);</div>
<div class="line"><span class="lineno">  694</span>            }</div>
<div class="line"><span class="lineno">  695</span>            <span class="keyword">auto</span> tmp = rate * RandomVariable(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a>(), floatingMultipliers[i][k]) *</div>
<div class="line"><span class="lineno">  696</span>                       lgm.reducedDiscountBond(eventTimes[i], payTimes[i][k], states,</div>
<div class="line"><span class="lineno">  697</span>                                               <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>[<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlyingCcys[0]]);</div>
<div class="line"><span class="lineno">  698</span>            getRv(underlyingPv, floatingCouponsLatestRelevantCallEventIndex[i][k], <a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a>()) += tmp;</div>
<div class="line"><span class="lineno">  699</span>        }</div>
<div class="line"><span class="lineno">  700</span> </div>
<div class="line"><span class="lineno">  701</span>        <span class="comment">// compute trapped coupon pvs</span></div>
<div class="line"><span class="lineno">  702</span> </div>
<div class="line"><span class="lineno">  703</span>        RandomVariable trappedCouponPv(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a>(), 0.0), trappedCouponPvCall(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a>(), 0.0);</div>
<div class="line"><span class="lineno">  704</span> </div>
<div class="line"><span class="lineno">  705</span>        <span class="keywordflow">if</span> (optionDateIndex[i] != Null&lt;Size&gt;()) {</div>
<div class="line"><span class="lineno">  706</span> </div>
<div class="line"><span class="lineno">  707</span>            <span class="comment">// loop over floating coupons with fixingDate &lt; eventDate &lt; paymentDate, add them to</span></div>
<div class="line"><span class="lineno">  708</span>            <span class="comment">// a temporary pv component for this event date (&quot;trapped coupons&quot;)</span></div>
<div class="line"><span class="lineno">  709</span>            <span class="comment">// assume that the unkonwn past fixing is the same as on the event date (modeling assumption)</span></div>
<div class="line"><span class="lineno">  710</span> </div>
<div class="line"><span class="lineno">  711</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; t : trappedCouponIndex[i]) {</div>
<div class="line"><span class="lineno">  712</span>                <span class="keywordflow">for</span> (Size k = 0; k &lt; floatingIndices[t].size(); ++k) {</div>
<div class="line"><span class="lineno">  713</span>                    <span class="keywordflow">if</span> (payTimes[t][k] &gt; eventTimes[i] &amp;&amp; !QuantLib::close_enough(eventTimes[i], payTimes[t][k])) {</div>
<div class="line"><span class="lineno">  714</span>                        RandomVariable rate;</div>
<div class="line"><span class="lineno">  715</span>                        <span class="keywordflow">if</span> (<span class="keyword">auto</span> on = boost::dynamic_pointer_cast&lt;OvernightIndex&gt;(floatingIndices[t][k])) {</div>
<div class="line"><span class="lineno">  716</span>                            <span class="keywordflow">if</span> (onIsAveraging[t][k]) {</div>
<div class="line"><span class="lineno">  717</span>                                rate = lgm.averagedOnRate(</div>
<div class="line"><span class="lineno">  718</span>                                    on, onFixingDates[t][k], onValueDates[t][k], onDt[t][k], onRateCutoff[t][k],</div>
<div class="line"><span class="lineno">  719</span>                                    onIncludeSpread[t][k], floatingSpreads[t][k], floatingGearings[t][k],</div>
<div class="line"><span class="lineno">  720</span>                                    onLookback[t][k], floatingCaps[t][k], floatingFloors[t][k], onLocalCapFloor[t][k],</div>
<div class="line"><span class="lineno">  721</span>                                    nakedOption[t][k], eventTimes[i], states);</div>
<div class="line"><span class="lineno">  722</span>                            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  723</span>                                rate = lgm.compoundedOnRate(</div>
<div class="line"><span class="lineno">  724</span>                                    on, onFixingDates[t][k], onValueDates[t][k], onDt[t][k], onRateCutoff[t][k],</div>
<div class="line"><span class="lineno">  725</span>                                    onIncludeSpread[t][k], floatingSpreads[t][k], floatingGearings[t][k],</div>
<div class="line"><span class="lineno">  726</span>                                    onLookback[t][k], floatingCaps[t][k], floatingFloors[t][k], onLocalCapFloor[t][k],</div>
<div class="line"><span class="lineno">  727</span>                                    nakedOption[t][k], eventTimes[i], states);</div>
<div class="line"><span class="lineno">  728</span>                            }</div>
<div class="line"><span class="lineno">  729</span>                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ibor = boost::dynamic_pointer_cast&lt;IborIndex&gt;(floatingIndices[t][k])) {</div>
<div class="line"><span class="lineno">  730</span>                            rate = computeIborRate(</div>
<div class="line"><span class="lineno">  731</span>                                lgm.fixing(ibor, ibor-&gt;fixingCalendar().adjust(eventDates[i]), eventTimes[i], states),</div>
<div class="line"><span class="lineno">  732</span>                                floatingSpreads[t][k], floatingGearings[t][k], floatingFloors[t][k], floatingCaps[t][k],</div>
<div class="line"><span class="lineno">  733</span>                                nakedOption[t][k]);</div>
<div class="line"><span class="lineno">  734</span>                        }</div>
<div class="line"><span class="lineno">  735</span>                        trappedCouponPv += rate * RandomVariable(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a>(), floatingMultipliers[t][k]) *</div>
<div class="line"><span class="lineno">  736</span>                                           lgm.reducedDiscountBond(eventTimes[i], payTimes[t][k], states,</div>
<div class="line"><span class="lineno">  737</span>                                                                   <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>[<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlyingCcys[0]]);</div>
<div class="line"><span class="lineno">  738</span>                    }</div>
<div class="line"><span class="lineno">  739</span>                }</div>
<div class="line"><span class="lineno">  740</span>            }</div>
<div class="line"><span class="lineno">  741</span>        }</div>
<div class="line"><span class="lineno">  742</span> </div>
<div class="line"><span class="lineno">  743</span>        <span class="keywordflow">if</span> (callDateIndex[i] != Null&lt;Size&gt;()) {</div>
<div class="line"><span class="lineno">  744</span> </div>
<div class="line"><span class="lineno">  745</span>            <span class="comment">// same for call dates: compute temp npv for coupons with fixingDate &lt; eventDate &lt;= accrualStartDate</span></div>
<div class="line"><span class="lineno">  746</span> </div>
<div class="line"><span class="lineno">  747</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; t : trappedCouponIndexCall[i]) {</div>
<div class="line"><span class="lineno">  748</span>                <span class="keywordflow">for</span> (Size k = 0; k &lt; floatingIndices[t].size(); ++k) {</div>
<div class="line"><span class="lineno">  749</span>                    <span class="keywordflow">if</span> (payTimes[t][k] &gt; eventTimes[i] &amp;&amp; !QuantLib::close_enough(eventTimes[i], payTimes[t][k])) {</div>
<div class="line"><span class="lineno">  750</span>                        RandomVariable rate;</div>
<div class="line"><span class="lineno">  751</span>                        <span class="keywordflow">if</span> (<span class="keyword">auto</span> on = boost::dynamic_pointer_cast&lt;OvernightIndex&gt;(floatingIndices[t][k])) {</div>
<div class="line"><span class="lineno">  752</span>                            <span class="keywordflow">if</span> (onIsAveraging[t][k]) {</div>
<div class="line"><span class="lineno">  753</span>                                rate = lgm.averagedOnRate(</div>
<div class="line"><span class="lineno">  754</span>                                    on, onFixingDates[t][k], onValueDates[t][k], onDt[t][k], onRateCutoff[t][k],</div>
<div class="line"><span class="lineno">  755</span>                                    onIncludeSpread[t][k], floatingSpreads[t][k], floatingGearings[t][k],</div>
<div class="line"><span class="lineno">  756</span>                                    onLookback[t][k], floatingCaps[t][k], floatingFloors[t][k], onLocalCapFloor[t][k],</div>
<div class="line"><span class="lineno">  757</span>                                    nakedOption[t][k], eventTimes[i], states);</div>
<div class="line"><span class="lineno">  758</span>                            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  759</span>                                rate = lgm.compoundedOnRate(</div>
<div class="line"><span class="lineno">  760</span>                                    on, onFixingDates[t][k], onValueDates[t][k], onDt[t][k], onRateCutoff[t][k],</div>
<div class="line"><span class="lineno">  761</span>                                    onIncludeSpread[t][k], floatingSpreads[t][k], floatingGearings[t][k],</div>
<div class="line"><span class="lineno">  762</span>                                    onLookback[t][k], floatingCaps[t][k], floatingFloors[t][k], onLocalCapFloor[t][k],</div>
<div class="line"><span class="lineno">  763</span>                                    nakedOption[t][k], eventTimes[i], states);</div>
<div class="line"><span class="lineno">  764</span>                            }</div>
<div class="line"><span class="lineno">  765</span>                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">auto</span> ibor = boost::dynamic_pointer_cast&lt;IborIndex&gt;(floatingIndices[t][k])) {</div>
<div class="line"><span class="lineno">  766</span>                            rate = computeIborRate(</div>
<div class="line"><span class="lineno">  767</span>                                lgm.fixing(ibor, ibor-&gt;fixingCalendar().adjust(eventDates[i]), eventTimes[i], states),</div>
<div class="line"><span class="lineno">  768</span>                                floatingSpreads[t][k], floatingGearings[t][k], floatingFloors[t][k], floatingCaps[t][k],</div>
<div class="line"><span class="lineno">  769</span>                                nakedOption[t][k]);</div>
<div class="line"><span class="lineno">  770</span>                        }</div>
<div class="line"><span class="lineno">  771</span>                        trappedCouponPvCall += rate * RandomVariable(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a>(), floatingMultipliers[t][k]) *</div>
<div class="line"><span class="lineno">  772</span>                                               lgm.reducedDiscountBond(eventTimes[i], payTimes[t][k], states,</div>
<div class="line"><span class="lineno">  773</span>                                                                       <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>[<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlyingCcys[0]]);</div>
<div class="line"><span class="lineno">  774</span>                    }</div>
<div class="line"><span class="lineno">  775</span>                }</div>
<div class="line"><span class="lineno">  776</span>            }</div>
<div class="line"><span class="lineno">  777</span> </div>
<div class="line"><span class="lineno">  778</span>            <span class="comment">// on a call date, update swaption value</span></div>
<div class="line"><span class="lineno">  779</span> </div>
<div class="line"><span class="lineno">  780</span>            Real rt = <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>[<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae239c5725955937ec0ba66c592cecdd1">baseCcy_</a>]-&gt;timeFromReference(callRebatePayDates[callDateIndex[i]]);</div>
<div class="line"><span class="lineno">  781</span>            <span class="keyword">auto</span> callRebateValue =</div>
<div class="line"><span class="lineno">  782</span>                RandomVariable(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a>(), callRebates[callDateIndex[i]]) *</div>
<div class="line"><span class="lineno">  783</span>                lgm.reducedDiscountBond(eventTimes[i], rt, states, <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>[<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlyingCcys[0]]);</div>
<div class="line"><span class="lineno">  784</span>            RandomVariable callMultiplier(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a>(), <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.exerciseIsLong ? 1.0 : -1.0);</div>
<div class="line"><span class="lineno">  785</span>            RandomVariable nakedOptionMultiplier(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a>(), <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.nakedOption ? 1.0 : -1.0);</div>
<div class="line"><span class="lineno">  786</span> </div>
<div class="line"><span class="lineno">  787</span>            swaptionPv = callMultiplier *</div>
<div class="line"><span class="lineno">  788</span>                         <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(callMultiplier * swaptionPv,</div>
<div class="line"><span class="lineno">  789</span>                             callMultiplier * (nakedOptionMultiplier * (underlyingPv[0] + trappedCouponPvCall)) +</div>
<div class="line"><span class="lineno">  790</span>                                 callRebateValue);</div>
<div class="line"><span class="lineno">  791</span>        }</div>
<div class="line"><span class="lineno">  792</span> </div>
<div class="line"><span class="lineno">  793</span>        <span class="comment">// compute positive pv as of event date</span></div>
<div class="line"><span class="lineno">  794</span> </div>
<div class="line"><span class="lineno">  795</span>        RandomVariable tmp = swaptionPv;</div>
<div class="line"><span class="lineno">  796</span>        <span class="keywordflow">if</span> (!<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.nakedOption) {</div>
<div class="line"><span class="lineno">  797</span>            tmp += trappedCouponPv;</div>
<div class="line"><span class="lineno">  798</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; u : underlyingPv)</div>
<div class="line"><span class="lineno">  799</span>                tmp += u.second;</div>
<div class="line"><span class="lineno">  800</span>        }</div>
<div class="line"><span class="lineno">  801</span> </div>
<div class="line"><span class="lineno">  802</span>        RandomVariable currentPositivePv = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a>(tmp, RandomVariable(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a>(), 0.0));</div>
<div class="line"><span class="lineno">  803</span> </div>
<div class="line"><span class="lineno">  804</span>        <span class="comment">// if on an option date, compute the option pv (as of t0)</span></div>
<div class="line"><span class="lineno">  805</span> </div>
<div class="line"><span class="lineno">  806</span>        <span class="keywordflow">if</span> (optionDateIndex[i] != Null&lt;Size&gt;()) {</div>
<div class="line"><span class="lineno">  807</span>            optionPv[optionDateIndex[i]] = <a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a3f3971be25680a745b28f6fce69d31b6">rollback</a>(currentPositivePv, eventTimes[i], 0.0).<a class="code hl_functionRef" href="../qle/struct_quant_ext_1_1_random_variable.html#a52b7b894964a2a061ce79c386c3e3e8f">at</a>(0);</div>
<div class="line"><span class="lineno">  808</span>        }</div>
<div class="line"><span class="lineno">  809</span> </div>
<div class="line"><span class="lineno">  810</span>        <span class="comment">// loop over fixed coupons with payment == eventDate and add them to the underlying pv</span></div>
<div class="line"><span class="lineno">  811</span> </div>
<div class="line"><span class="lineno">  812</span>        <span class="keywordflow">for</span> (Size k = 0; k &lt; fixedCoupons[i].size(); ++k) {</div>
<div class="line"><span class="lineno">  813</span>            RandomVariable tmp = RandomVariable(<a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a>(), fixedCoupons[i][k]) /</div>
<div class="line"><span class="lineno">  814</span>                                 lgm.numeraire(eventTimes[i], states, <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>[<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlyingCcys[0]]);</div>
<div class="line"><span class="lineno">  815</span>            getRv(underlyingPv, fixedCouponsLatestRelevantCallEventIndex[i][k], <a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">gridSize</a>()) += tmp;</div>
<div class="line"><span class="lineno">  816</span>        }</div>
<div class="line"><span class="lineno">  817</span> </div>
<div class="line"><span class="lineno">  818</span>    } <span class="comment">// loop over event dates</span></div>
<div class="line"><span class="lineno">  819</span> </div>
<div class="line"><span class="lineno">  820</span>    <span class="comment">// roll back to t = 0</span></div>
<div class="line"><span class="lineno">  821</span> </div>
<div class="line"><span class="lineno">  822</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; u : underlyingPv) {</div>
<div class="line"><span class="lineno">  823</span>        <span class="keywordflow">if</span> (u.first != 0)</div>
<div class="line"><span class="lineno">  824</span>            underlyingPv[0] += u.second;</div>
<div class="line"><span class="lineno">  825</span>    }</div>
<div class="line"><span class="lineno">  826</span> </div>
<div class="line"><span class="lineno">  827</span>    underlyingPv[0] = <a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a3f3971be25680a745b28f6fce69d31b6">rollback</a>(underlyingPv[0], eventTimes[0], 0.0);</div>
<div class="line"><span class="lineno">  828</span> </div>
<div class="line"><span class="lineno">  829</span>    swaptionPv = <a class="code hl_functionRef" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a3f3971be25680a745b28f6fce69d31b6">rollback</a>(swaptionPv, eventTimes[0], 0.0);</div>
<div class="line"><span class="lineno">  830</span> </div>
<div class="line"><span class="lineno">  831</span>    <span class="comment">// compute a CVA using the option pvs</span></div>
<div class="line"><span class="lineno">  832</span> </div>
<div class="line"><span class="lineno">  833</span>    QL_REQUIRE(!<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a876f97316c68159e07070d243a6e52ed">fxSpots_</a>[<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlyingCcys[0]].empty(),</div>
<div class="line"><span class="lineno">  834</span>               <span class="stringliteral">&quot;NumericLgmRiskParticipationAgreementEngine::protectionLegNpv(): empty fx spot for ccy pair &quot;</span></div>
<div class="line"><span class="lineno">  835</span>                   &lt;&lt; <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlyingCcys[0] + <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae239c5725955937ec0ba66c592cecdd1">baseCcy_</a>);</div>
<div class="line"><span class="lineno">  836</span> </div>
<div class="line"><span class="lineno">  837</span>    Real cva = 0.0;</div>
<div class="line"><span class="lineno">  838</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">gridDates_</a>.size() - 1; ++i) {</div>
<div class="line"><span class="lineno">  839</span>        Real pd = <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#acc213ca558c2cfd047dbced63bcab643">defaultCurve_</a>-&gt;defaultProbability(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">gridDates_</a>[i], <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">gridDates_</a>[i + 1]);</div>
<div class="line"><span class="lineno">  840</span>        cva += pd * (1.0 - <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a2e6528316bc85aab2f93514aaae6cec8">effectiveRecoveryRate_</a>) * optionPv[i] * <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a876f97316c68159e07070d243a6e52ed">fxSpots_</a>[<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlyingCcys[0]]-&gt;value();</div>
<div class="line"><span class="lineno">  841</span>    }</div>
<div class="line"><span class="lineno">  842</span> </div>
<div class="line"><span class="lineno">  843</span>    <span class="comment">// set additional results (grid and option pvs)</span></div>
<div class="line"><span class="lineno">  844</span> </div>
<div class="line"><span class="lineno">  845</span>    <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;OptionNpvs&quot;</span>] = optionPv;</div>
<div class="line"><span class="lineno">  846</span>    <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;OptionExerciseDates&quot;</span>] = optionDates;</div>
<div class="line"><span class="lineno">  847</span>    <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;UnderlyingNpv&quot;</span>] = underlyingPv.at(0).at(0);</div>
<div class="line"><span class="lineno">  848</span>    <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;SwaptionNpv&quot;</span>] = swaptionPv.at(0);</div>
<div class="line"><span class="lineno">  849</span>    <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FXSpot&quot;</span>] = <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a876f97316c68159e07070d243a6e52ed">fxSpots_</a>[<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlyingCcys[0]]-&gt;value();</div>
<div class="line"><span class="lineno">  850</span> </div>
<div class="line"><span class="lineno">  851</span>    <span class="comment">// return result</span></div>
<div class="line"><span class="lineno">  852</span> </div>
<div class="line"><span class="lineno">  853</span>    <span class="keywordflow">return</span> <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.participationRate * cva;</div>
<div class="line"><span class="lineno">  854</span>}</div>
<div class="ttc" id="acdsoption_8cpp_html_afeb3e8b4e6ab6604c185b2ea55bbc728"><div class="ttname"><a href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a></div><div class="ttdeci">const Instrument::results * results_</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_lgm_convolution_solver2_html_a3f3971be25680a745b28f6fce69d31b6"><div class="ttname"><a href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a3f3971be25680a745b28f6fce69d31b6">QuantExt::LgmConvolutionSolver2::rollback</a></div><div class="ttdeci">RandomVariable rollback(const RandomVariable &amp;v, const Real t1, const Real t0) const</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_lgm_convolution_solver2_html_ad83fd8f4a99f30bee5b71ec156941d4a"><div class="ttname"><a href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#ad83fd8f4a99f30bee5b71ec156941d4a">QuantExt::LgmConvolutionSolver2::stateGrid</a></div><div class="ttdeci">RandomVariable stateGrid(const Real t) const</div></div>
<div class="ttc" id="aclass_quant_ext_1_1_lgm_convolution_solver2_html_afaaf32c43925e8a0f85bbba660146b8d"><div class="ttname"><a href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d">QuantExt::LgmConvolutionSolver2::gridSize</a></div><div class="ttdeci">Size gridSize() const</div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_a2e6528316bc85aab2f93514aaae6cec8"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a2e6528316bc85aab2f93514aaae6cec8">ore::data::RiskParticipationAgreementBaseEngine::effectiveRecoveryRate_</a></div><div class="ttdeci">Real effectiveRecoveryRate_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00064">riskparticipationagreementbaseengine.hpp:64</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_a38a4e2098671399fba5f588ea75d5a10"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">ore::data::RiskParticipationAgreementBaseEngine::gridDates_</a></div><div class="ttdeci">std::vector&lt; Date &gt; gridDates_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00062">riskparticipationagreementbaseengine.hpp:62</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_a3e22290961d6b56dce069c1c4fda6386"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">ore::data::RiskParticipationAgreementBaseEngine::referenceDate_</a></div><div class="ttdeci">Date referenceDate_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00063">riskparticipationagreementbaseengine.hpp:63</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_a876f97316c68159e07070d243a6e52ed"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a876f97316c68159e07070d243a6e52ed">ore::data::RiskParticipationAgreementBaseEngine::fxSpots_</a></div><div class="ttdeci">std::map&lt; std::string, Handle&lt; Quote &gt; &gt; fxSpots_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00056">riskparticipationagreementbaseengine.hpp:56</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_a9fbd2e40654f7b9b28d60c636126fe25"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">ore::data::RiskParticipationAgreementBaseEngine::discountCurves_</a></div><div class="ttdeci">std::map&lt; std::string, Handle&lt; YieldTermStructure &gt; &gt; discountCurves_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00055">riskparticipationagreementbaseengine.hpp:55</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_acc213ca558c2cfd047dbced63bcab643"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#acc213ca558c2cfd047dbced63bcab643">ore::data::RiskParticipationAgreementBaseEngine::defaultCurve_</a></div><div class="ttdeci">Handle&lt; DefaultProbabilityTermStructure &gt; defaultCurve_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00057">riskparticipationagreementbaseengine.hpp:57</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_ae239c5725955937ec0ba66c592cecdd1"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae239c5725955937ec0ba66c592cecdd1">ore::data::RiskParticipationAgreementBaseEngine::baseCcy_</a></div><div class="ttdeci">std::string baseCcy_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00054">riskparticipationagreementbaseengine.hpp:54</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_a0780e43df89be3d7f7671eca2418cdd1"><div class="ttname"><a href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1">max</a></div><div class="ttdeci">RandomVariable max(RandomVariable x, const RandomVariable &amp;y)</div></div>
<div class="ttc" id="astruct_quant_ext_1_1_random_variable_html_a52b7b894964a2a061ce79c386c3e3e8f"><div class="ttname"><a href="../qle/struct_quant_ext_1_1_random_variable.html#a52b7b894964a2a061ce79c386c3e3e8f">QuantExt::RandomVariable::at</a></div><div class="ttdeci">Real at(const Size i) const</div></div>
<div class="ttc" id="atenorbasisswap_8cpp_html_a71b2ce0e52885aca4ce15e1d128b9f56"><div class="ttname"><a href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a></div><div class="ttdeci">Swap::arguments * arguments_</div></div>
</div><!-- fragment --><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine_ade0a74a8fd16b945b60d4f9fec832fdc_cgraph.png" border="0" usemap="#aclassore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine_ade0a74a8fd16b945b60d4f9fec832fdc_cgraph" alt=""/></div>
<map name="aclassore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine_ade0a74a8fd16b945b60d4f9fec832fdc_cgraph" id="aclassore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine_ade0a74a8fd16b945b60d4f9fec832fdc_cgraph">
<area shape="rect" title=" " alt="" coords="5,312,127,337"/>
<area shape="rect" target="_parent" href="../qle/struct_quant_ext_1_1_random_variable.html#a52b7b894964a2a061ce79c386c3e3e8f" title=" " alt="" coords="175,5,373,31"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_lgm_vectorised.html#a0f7a2ad59f8396ab1ff7efbf852df112" title=" " alt="" coords="188,55,360,95"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_lgm_vectorised.html#add6ae677f50c0490bc9d72ad877b6033" title=" " alt="" coords="188,119,360,159"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_lgm_vectorised.html#a671bc1fefafaf56ae7028084cec2ac5c" title=" " alt="" coords="188,183,360,223"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#afaaf32c43925e8a0f85bbba660146b8d" title=" " alt="" coords="186,247,362,287"/>
<area shape="rect" target="_parent" href="../qle/namespace_quant_ext.html#a0780e43df89be3d7f7671eca2418cdd1" title=" " alt="" coords="251,312,297,337"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a050ea6a9d5bc55b5d766f615d91e257a" title=" " alt="" coords="186,362,362,402"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_lgm_vectorised.html#acd02c2d3dce0c3416336f67441a99b39" title=" " alt="" coords="188,426,360,466"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_lgm_vectorised.html#afb843cf08dc78f1520c00a2e4a162457" title=" " alt="" coords="188,490,360,530"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#a3f3971be25680a745b28f6fce69d31b6" title=" " alt="" coords="186,554,362,594"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_lgm_convolution_solver2.html#ad83fd8f4a99f30bee5b71ec156941d4a" title=" " alt="" coords="186,618,362,658"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.9.5
</small></address>
</body>
</html>
