<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<title>OREData: RiskParticipationAgreementBaseEngine Class Reference</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="oredextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-data@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.8.11</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceore.html">ore</a></li><li class="navelem"><a class="el" href="namespaceore_1_1data.html">data</a></li><li class="navelem"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html">RiskParticipationAgreementBaseEngine</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="classore_1_1data_1_1_risk_participation_agreement_base_engine-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">RiskParticipationAgreementBaseEngine Class Reference<span class="mlabels"><span class="mlabel">abstract</span></span></div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html">ored/scripting/engines/riskparticipationagreementbaseengine.hpp</a>&gt;</code></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for RiskParticipationAgreementBaseEngine:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_risk_participation_agreement_base_engine__inherit__graph.png" border="0" usemap="#a_risk_participation_agreement_base_engine_inherit__map" alt="Inheritance graph"/></div>
<map name="a_risk_participation_agreement_base_engine_inherit__map" id="a_risk_participation_agreement_base_engine_inherit__map">
<area shape="rect" title=" " alt="" coords="332,93,531,368"/>
<area shape="rect" href="classore_1_1data_1_1_analytic_black_risk_participation_agreement_engine.html" title=" " alt="" coords="5,416,273,588"/>
<area shape="rect" href="classore_1_1data_1_1_analytic_x_ccy_black_risk_participation_agreement_engine.html" title=" " alt="" coords="297,438,565,566"/>
<area shape="rect" href="classore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine.html" title=" " alt="" coords="590,453,801,551"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_risk_participation_agreement_1_1engine.html" title=" " alt="" coords="399,5,463,45"/>
</map>
</div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for RiskParticipationAgreementBaseEngine:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_risk_participation_agreement_base_engine__coll__graph.png" border="0" usemap="#a_risk_participation_agreement_base_engine_coll__map" alt="Collaboration graph"/></div>
<map name="a_risk_participation_agreement_base_engine_coll__map" id="a_risk_participation_agreement_base_engine_coll__map">
<area shape="rect" title=" " alt="" coords="747,412,949,540"/>
<area shape="rect" target="_parent" href="../qle/class_quant_ext_1_1_risk_participation_agreement_1_1engine.html" title=" " alt="" coords="5,273,69,313"/>
<area shape="rect" title=" " alt="" coords="132,123,191,163"/>
<area shape="rect" title=" " alt="" coords="269,265,438,320"/>
<area shape="rect" title=" " alt="" coords="507,265,677,320"/>
<area shape="rect" title=" " alt="" coords="88,5,235,45"/>
<area shape="rect" title=" " alt="" coords="259,123,461,163"/>
<area shape="rect" title=" " alt="" coords="787,5,853,45"/>
<area shape="rect" title=" " alt="" coords="756,123,881,163"/>
<area shape="rect" title=" " alt="" coords="839,187,1017,241"/>
<area shape="rect" title=" " alt="" coords="529,123,628,163"/>
<area shape="rect" title=" " alt="" coords="558,5,597,45"/>
<area shape="rect" title=" " alt="" coords="1163,5,1202,45"/>
<area shape="rect" title=" " alt="" coords="1199,123,1289,163"/>
<area shape="rect" title=" " alt="" coords="1034,273,1086,313"/>
<area shape="rect" title=" " alt="" coords="1259,273,1370,313"/>
<area shape="rect" title=" " alt="" coords="1113,123,1167,163"/>
<area shape="rect" title=" " alt="" coords="1394,273,1446,313"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a6badd8d52618fb19929c5b604d4f7181"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a6badd8d52618fb19929c5b604d4f7181">RiskParticipationAgreementBaseEngine</a> (const std::string &amp;baseCcy, const std::map&lt; std::string, Handle&lt; YieldTermStructure &gt; &gt; &amp;discountCurves, const std::map&lt; std::string, Handle&lt; Quote &gt; &gt; &amp;fxSpots, const Handle&lt; DefaultProbabilityTermStructure &gt; &amp;defaultCurve, const Handle&lt; Quote &gt; &amp;recoveryRate, const Size maxGapDays=Null&lt; Size &gt;(), const Size maxDiscretizsationPoints=Null&lt; Size &gt;())</td></tr>
<tr class="separator:a6badd8d52618fb19929c5b604d4f7181"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a19fa7bb64d14323e611ea636f50726ea"><td class="memItemLeft" align="right" valign="top">static std::vector&lt; Date &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a19fa7bb64d14323e611ea636f50726ea">buildDiscretisationGrid</a> (const Date &amp;<a class="el" href="model_2utilities_8cpp.html#a24bc06abadc72e51af462e64714c3822">referenceDate</a>, const Date &amp;protectionStart, const Date &amp;protectionEnd, const std::vector&lt; Leg &gt; &amp;underlying, const Size maxGapDays=Null&lt; Size &gt;(), const Size maxDiscretisationPoints=Null&lt; Size &gt;())</td></tr>
<tr class="separator:a19fa7bb64d14323e611ea636f50726ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a469ecd4d7deacd2c23aabfa700b79bdf"><td class="memItemLeft" align="right" valign="top">virtual Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a469ecd4d7deacd2c23aabfa700b79bdf">protectionLegNpv</a> () const =0</td></tr>
<tr class="separator:a469ecd4d7deacd2c23aabfa700b79bdf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61eb1a24e5329ccc296715a40dc3a19a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a61eb1a24e5329ccc296715a40dc3a19a">calculate</a> () const override</td></tr>
<tr class="separator:a61eb1a24e5329ccc296715a40dc3a19a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-attribs" name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:ae239c5725955937ec0ba66c592cecdd1"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae239c5725955937ec0ba66c592cecdd1">baseCcy_</a></td></tr>
<tr class="separator:ae239c5725955937ec0ba66c592cecdd1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fbd2e40654f7b9b28d60c636126fe25"><td class="memItemLeft" align="right" valign="top">std::map&lt; std::string, Handle&lt; YieldTermStructure &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a></td></tr>
<tr class="separator:a9fbd2e40654f7b9b28d60c636126fe25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a876f97316c68159e07070d243a6e52ed"><td class="memItemLeft" align="right" valign="top">std::map&lt; std::string, Handle&lt; Quote &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a876f97316c68159e07070d243a6e52ed">fxSpots_</a></td></tr>
<tr class="separator:a876f97316c68159e07070d243a6e52ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc213ca558c2cfd047dbced63bcab643"><td class="memItemLeft" align="right" valign="top">Handle&lt; DefaultProbabilityTermStructure &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#acc213ca558c2cfd047dbced63bcab643">defaultCurve_</a></td></tr>
<tr class="separator:acc213ca558c2cfd047dbced63bcab643"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7ab2e6ca0ab7b7fdd155f4950b7b3d6"><td class="memItemLeft" align="right" valign="top">Handle&lt; Quote &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#af7ab2e6ca0ab7b7fdd155f4950b7b3d6">recoveryRate_</a></td></tr>
<tr class="separator:af7ab2e6ca0ab7b7fdd155f4950b7b3d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4eaeca9e21e17bfd7efbf6621e756823"><td class="memItemLeft" align="right" valign="top">Size&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a4eaeca9e21e17bfd7efbf6621e756823">maxGapDays_</a></td></tr>
<tr class="separator:a4eaeca9e21e17bfd7efbf6621e756823"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6a927076473671509505a47c34f7004"><td class="memItemLeft" align="right" valign="top">Size&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae6a927076473671509505a47c34f7004">maxDiscretisationPoints_</a></td></tr>
<tr class="separator:ae6a927076473671509505a47c34f7004"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38a4e2098671399fba5f588ea75d5a10"><td class="memItemLeft" align="right" valign="top">std::vector&lt; Date &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">gridDates_</a></td></tr>
<tr class="separator:a38a4e2098671399fba5f588ea75d5a10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e22290961d6b56dce069c1c4fda6386"><td class="memItemLeft" align="right" valign="top">Date&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a></td></tr>
<tr class="separator:a3e22290961d6b56dce069c1c4fda6386"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e6528316bc85aab2f93514aaae6cec8"><td class="memItemLeft" align="right" valign="top">Real&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a2e6528316bc85aab2f93514aaae6cec8">effectiveRecoveryRate_</a></td></tr>
<tr class="separator:a2e6528316bc85aab2f93514aaae6cec8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html#l00035">35</a> of file <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html">riskparticipationagreementbaseengine.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a6badd8d52618fb19929c5b604d4f7181" name="a6badd8d52618fb19929c5b604d4f7181"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6badd8d52618fb19929c5b604d4f7181">&#9670;&#160;</a></span>RiskParticipationAgreementBaseEngine()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html">RiskParticipationAgreementBaseEngine</a> </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>baseCcy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, Handle&lt; YieldTermStructure &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>discountCurves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; std::string, Handle&lt; Quote &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>fxSpots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Handle&lt; DefaultProbabilityTermStructure &gt; &amp;&#160;</td>
          <td class="paramname"><em>defaultCurve</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Handle&lt; Quote &gt; &amp;&#160;</td>
          <td class="paramname"><em>recoveryRate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Size&#160;</td>
          <td class="paramname"><em>maxGapDays</em> = <code>Null&lt;Size&gt;()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Size&#160;</td>
          <td class="paramname"><em>maxDiscretizsationPoints</em> = <code>Null&lt;Size&gt;()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="riskparticipationagreementbaseengine_8cpp_source.html#l00029">29</a> of file <a class="el" href="riskparticipationagreementbaseengine_8cpp_source.html">riskparticipationagreementbaseengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   33</span>    : <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae239c5725955937ec0ba66c592cecdd1">baseCcy_</a>(baseCcy), <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>(discountCurves), <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a876f97316c68159e07070d243a6e52ed">fxSpots_</a>(fxSpots), <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#acc213ca558c2cfd047dbced63bcab643">defaultCurve_</a>(defaultCurve),</div>
<div class="line"><span class="lineno">   34</span>      <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#af7ab2e6ca0ab7b7fdd155f4950b7b3d6">recoveryRate_</a>(recoveryRate), <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a4eaeca9e21e17bfd7efbf6621e756823">maxGapDays_</a>(maxGapDays), <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae6a927076473671509505a47c34f7004">maxDiscretisationPoints_</a>(maxDiscretisationPoints) {</div>
<div class="line"><span class="lineno">   35</span>    QL_REQUIRE(maxGapDays == Null&lt;Size&gt;() || maxGapDays &gt;= 1,</div>
<div class="line"><span class="lineno">   36</span>               <span class="stringliteral">&quot;invalid maxGapDays (&quot;</span> &lt;&lt; maxGapDays &lt;&lt; <span class="stringliteral">&quot;), must be &gt;= 1&quot;</span>);</div>
<div class="line"><span class="lineno">   37</span>    QL_REQUIRE(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae6a927076473671509505a47c34f7004">maxDiscretisationPoints_</a> == Null&lt;Size&gt;() || <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae6a927076473671509505a47c34f7004">maxDiscretisationPoints_</a> &gt;= 1,</div>
<div class="line"><span class="lineno">   38</span>               <span class="stringliteral">&quot;invalid maxDiscretisationPoints (&quot;</span> &lt;&lt; maxDiscretisationPoints &lt;&lt; <span class="stringliteral">&quot;), must be &gt;= 3&quot;</span>);</div>
<div class="line"><span class="lineno">   39</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; d : <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>)</div>
<div class="line"><span class="lineno">   40</span>        registerWith(d.second);</div>
<div class="line"><span class="lineno">   41</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; s : <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a876f97316c68159e07070d243a6e52ed">fxSpots_</a>)</div>
<div class="line"><span class="lineno">   42</span>        registerWith(s.second);</div>
<div class="line"><span class="lineno">   43</span>    registerWith(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#acc213ca558c2cfd047dbced63bcab643">defaultCurve_</a>);</div>
<div class="line"><span class="lineno">   44</span>    registerWith(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#af7ab2e6ca0ab7b7fdd155f4950b7b3d6">recoveryRate_</a>);</div>
<div class="line"><span class="lineno">   45</span>    <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a876f97316c68159e07070d243a6e52ed">fxSpots_</a>[<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae239c5725955937ec0ba66c592cecdd1">baseCcy_</a>] = Handle&lt;Quote&gt;(boost::make_shared&lt;SimpleQuote&gt;(1.0));</div>
<div class="line"><span class="lineno">   46</span>}</div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_a4eaeca9e21e17bfd7efbf6621e756823"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a4eaeca9e21e17bfd7efbf6621e756823">ore::data::RiskParticipationAgreementBaseEngine::maxGapDays_</a></div><div class="ttdeci">Size maxGapDays_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00059">riskparticipationagreementbaseengine.hpp:59</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_a876f97316c68159e07070d243a6e52ed"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a876f97316c68159e07070d243a6e52ed">ore::data::RiskParticipationAgreementBaseEngine::fxSpots_</a></div><div class="ttdeci">std::map&lt; std::string, Handle&lt; Quote &gt; &gt; fxSpots_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00056">riskparticipationagreementbaseengine.hpp:56</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_a9fbd2e40654f7b9b28d60c636126fe25"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">ore::data::RiskParticipationAgreementBaseEngine::discountCurves_</a></div><div class="ttdeci">std::map&lt; std::string, Handle&lt; YieldTermStructure &gt; &gt; discountCurves_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00055">riskparticipationagreementbaseengine.hpp:55</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_acc213ca558c2cfd047dbced63bcab643"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#acc213ca558c2cfd047dbced63bcab643">ore::data::RiskParticipationAgreementBaseEngine::defaultCurve_</a></div><div class="ttdeci">Handle&lt; DefaultProbabilityTermStructure &gt; defaultCurve_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00057">riskparticipationagreementbaseengine.hpp:57</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_ae239c5725955937ec0ba66c592cecdd1"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae239c5725955937ec0ba66c592cecdd1">ore::data::RiskParticipationAgreementBaseEngine::baseCcy_</a></div><div class="ttdeci">std::string baseCcy_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00054">riskparticipationagreementbaseengine.hpp:54</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_ae6a927076473671509505a47c34f7004"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae6a927076473671509505a47c34f7004">ore::data::RiskParticipationAgreementBaseEngine::maxDiscretisationPoints_</a></div><div class="ttdeci">Size maxDiscretisationPoints_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00059">riskparticipationagreementbaseengine.hpp:59</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_af7ab2e6ca0ab7b7fdd155f4950b7b3d6"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#af7ab2e6ca0ab7b7fdd155f4950b7b3d6">ore::data::RiskParticipationAgreementBaseEngine::recoveryRate_</a></div><div class="ttdeci">Handle&lt; Quote &gt; recoveryRate_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00058">riskparticipationagreementbaseengine.hpp:58</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a19fa7bb64d14323e611ea636f50726ea" name="a19fa7bb64d14323e611ea636f50726ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19fa7bb64d14323e611ea636f50726ea">&#9670;&#160;</a></span>buildDiscretisationGrid()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; Date &gt; buildDiscretisationGrid </td>
          <td>(</td>
          <td class="paramtype">const Date &amp;&#160;</td>
          <td class="paramname"><em>referenceDate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Date &amp;&#160;</td>
          <td class="paramname"><em>protectionStart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Date &amp;&#160;</td>
          <td class="paramname"><em>protectionEnd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; Leg &gt; &amp;&#160;</td>
          <td class="paramname"><em>underlying</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Size&#160;</td>
          <td class="paramname"><em>maxGapDays</em> = <code>Null&lt;Size&gt;()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Size&#160;</td>
          <td class="paramname"><em>maxDiscretisationPoints</em> = <code>Null&lt;Size&gt;()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="riskparticipationagreementbaseengine_8cpp_source.html#l00062">62</a> of file <a class="el" href="riskparticipationagreementbaseengine_8cpp_source.html">riskparticipationagreementbaseengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   64</span>                                                                                                 {</div>
<div class="line"><span class="lineno">   65</span> </div>
<div class="line"><span class="lineno">   66</span>    QL_REQUIRE(protectionEnd &gt; <a class="code hl_variable" href="model_2utilities_8cpp.html#a24bc06abadc72e51af462e64714c3822">referenceDate</a>,</div>
<div class="line"><span class="lineno">   67</span>               <span class="stringliteral">&quot;protection end (&quot;</span> &lt;&lt; protectionEnd &lt;&lt; <span class="stringliteral">&quot;) must be &gt; reference date (&quot;</span> &lt;&lt; <a class="code hl_variable" href="model_2utilities_8cpp.html#a24bc06abadc72e51af462e64714c3822">referenceDate</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="lineno">   68</span> </div>
<div class="line"><span class="lineno">   69</span>    <span class="comment">// collect the accrual end dates of the float coupons</span></div>
<div class="line"><span class="lineno">   70</span> </div>
<div class="line"><span class="lineno">   71</span>    std::vector&lt;Date&gt; accrualDates;</div>
<div class="line"><span class="lineno">   72</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; l : underlying) {</div>
<div class="line"><span class="lineno">   73</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; c : l) {</div>
<div class="line"><span class="lineno">   74</span>            <span class="keywordflow">if</span> (<span class="keyword">auto</span> f = boost::dynamic_pointer_cast&lt;FloatingRateCoupon&gt;(c)) {</div>
<div class="line"><span class="lineno">   75</span>                accrualDates.push_back(f-&gt;accrualEndDate());</div>
<div class="line"><span class="lineno">   76</span>            }</div>
<div class="line"><span class="lineno">   77</span>        }</div>
<div class="line"><span class="lineno">   78</span>    }</div>
<div class="line"><span class="lineno">   79</span> </div>
<div class="line"><span class="lineno">   80</span>    <span class="comment">// build the discretisation grid</span></div>
<div class="line"><span class="lineno">   81</span> </div>
<div class="line"><span class="lineno">   82</span>    accrualDates.push_back(std::max(protectionStart, <a class="code hl_variable" href="model_2utilities_8cpp.html#a24bc06abadc72e51af462e64714c3822">referenceDate</a>));</div>
<div class="line"><span class="lineno">   83</span>    accrualDates.push_back(protectionEnd);</div>
<div class="line"><span class="lineno">   84</span> </div>
<div class="line"><span class="lineno">   85</span>    std::sort(accrualDates.begin(), accrualDates.end());</div>
<div class="line"><span class="lineno">   86</span>    <span class="keyword">auto</span> it = std::unique(accrualDates.begin(), accrualDates.end());</div>
<div class="line"><span class="lineno">   87</span>    accrualDates.resize(it - accrualDates.begin());</div>
<div class="line"><span class="lineno">   88</span> </div>
<div class="line"><span class="lineno">   89</span>    <span class="keyword">auto</span> itStart = std::lower_bound(accrualDates.begin(), accrualDates.end(), <a class="code hl_variable" href="model_2utilities_8cpp.html#a24bc06abadc72e51af462e64714c3822">referenceDate</a>);</div>
<div class="line"><span class="lineno">   90</span>    <span class="keyword">auto</span> itEnd = std::upper_bound(accrualDates.begin(), accrualDates.end(), protectionEnd);</div>
<div class="line"><span class="lineno">   91</span> </div>
<div class="line"><span class="lineno">   92</span>    QL_REQUIRE(std::distance(itStart, itEnd) &gt;= 2, <span class="stringliteral">&quot;got invalid discretisationGrid for RPA, this is unexpected&quot;</span>);</div>
<div class="line"><span class="lineno">   93</span> </div>
<div class="line"><span class="lineno">   94</span>    std::vector&lt;Date&gt; gridDates(itStart, itEnd);</div>
<div class="line"><span class="lineno">   95</span> </div>
<div class="line"><span class="lineno">   96</span>    <span class="comment">// add additional dates on mid points of intervals that are exceeding the max gap given</span></div>
<div class="line"><span class="lineno">   97</span> </div>
<div class="line"><span class="lineno">   98</span>    <span class="keywordflow">if</span> (maxGapDays != Null&lt;Size&gt;()) {</div>
<div class="line"><span class="lineno">   99</span>        <span class="keywordtype">bool</span> refining;</div>
<div class="line"><span class="lineno">  100</span>        <span class="comment">// just to really make sure we exit the loop below!</span></div>
<div class="line"><span class="lineno">  101</span>        Size refiningIterations = 0;</div>
<div class="line"><span class="lineno">  102</span>        <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno">  103</span>            refining = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  104</span>            <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = gridDates.begin(); it &lt; gridDates.end() - 1; ++it) {</div>
<div class="line"><span class="lineno">  105</span>                <span class="keywordflow">if</span> (*(it + 1) - *it &gt; std::max&lt;int&gt;(1, maxGapDays)) {</div>
<div class="line"><span class="lineno">  106</span>                    it = gridDates.insert(it + 1, *it + (*(it + 1) - *it) / 2);</div>
<div class="line"><span class="lineno">  107</span>                    refining = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  108</span>                }</div>
<div class="line"><span class="lineno">  109</span>            }</div>
<div class="line"><span class="lineno">  110</span>        } <span class="keywordflow">while</span> (refining &amp;&amp; ++refiningIterations &lt; 100);</div>
<div class="line"><span class="lineno">  111</span>        QL_REQUIRE(refiningIterations &lt; 100, <span class="stringliteral">&quot;discretisationGrid refinement failed, this is unexpected&quot;</span>);</div>
<div class="line"><span class="lineno">  112</span>    }</div>
<div class="line"><span class="lineno">  113</span> </div>
<div class="line"><span class="lineno">  114</span>    <span class="comment">// if the number of intervals exceeds the max allowed number, remove points at the beginning and end like this</span></div>
<div class="line"><span class="lineno">  115</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  116</span>    <span class="comment">// (1) |  x  |  x  |  x  |  x  |  x  |  x  | x  |  x  |  x  |   =&gt;</span></div>
<div class="line"><span class="lineno">  117</span>    <span class="comment">// (2) |        x        |  x  |  x  |  x  | x  |  x  |  x  |   =&gt;</span></div>
<div class="line"><span class="lineno">  118</span>    <span class="comment">// (3) |        x        |  x  |  x  |  x  |       x        |   etc.</span></div>
<div class="line"><span class="lineno">  119</span>    <span class="comment">//</span></div>
<div class="line"><span class="lineno">  120</span>    <span class="comment">// where each &#39;|&#39; marks an entry in gridDates and &#39;x&#39; marks the midpoint of the intervals,</span></div>
<div class="line"><span class="lineno">  121</span>    <span class="comment">// until we reach the max allowed number of discretisation points.</span></div>
<div class="line"><span class="lineno">  122</span> </div>
<div class="line"><span class="lineno">  123</span>    <span class="comment">// just for debugging</span></div>
<div class="line"><span class="lineno">  124</span>    <span class="comment">// std::vector&lt;Date&gt; originalGridDates(gridDates);</span></div>
<div class="line"><span class="lineno">  125</span>    <span class="comment">// logGrid(originalGridDates, gridDates);</span></div>
<div class="line"><span class="lineno">  126</span> </div>
<div class="line"><span class="lineno">  127</span>    Size currentNumberOfDiscretisationPoints = gridDates.size() - 1,</div>
<div class="line"><span class="lineno">  128</span>         previousNumberOfDiscretisationPoints = QL_MAX_INTEGER;</div>
<div class="line"><span class="lineno">  129</span> </div>
<div class="line"><span class="lineno">  130</span>    <span class="keywordflow">while</span> (maxDiscretisationPoints != Null&lt;Size&gt;() &amp;&amp; currentNumberOfDiscretisationPoints &gt; maxDiscretisationPoints &amp;&amp;</div>
<div class="line"><span class="lineno">  131</span>           currentNumberOfDiscretisationPoints &lt; previousNumberOfDiscretisationPoints) {</div>
<div class="line"><span class="lineno">  132</span> </div>
<div class="line"><span class="lineno">  133</span>        previousNumberOfDiscretisationPoints = currentNumberOfDiscretisationPoints;</div>
<div class="line"><span class="lineno">  134</span>        Size currentLeftIndex = 0, currentRightIndex = gridDates.size() - 1;</div>
<div class="line"><span class="lineno">  135</span>        <span class="keywordtype">bool</span> nextErasureOnLeft = <span class="keyword">true</span>, canRemoveFurtherPointsInPass = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  136</span> </div>
<div class="line"><span class="lineno">  137</span>        <span class="keywordflow">while</span> (currentNumberOfDiscretisationPoints &gt; maxDiscretisationPoints &amp;&amp; canRemoveFurtherPointsInPass) {</div>
<div class="line"><span class="lineno">  138</span>            <span class="keywordflow">if</span> (nextErasureOnLeft) {</div>
<div class="line"><span class="lineno">  139</span>                <span class="keywordflow">if</span> (gridDates.size() &gt;= currentLeftIndex + 4 &amp;&amp; currentLeftIndex + 3 &lt;= currentRightIndex) {</div>
<div class="line"><span class="lineno">  140</span>                    gridDates.erase(std::next(gridDates.begin(), currentLeftIndex + 1),</div>
<div class="line"><span class="lineno">  141</span>                                    std::next(gridDates.begin(), currentLeftIndex + 3));</div>
<div class="line"><span class="lineno">  142</span>                    currentNumberOfDiscretisationPoints -= 2;</div>
<div class="line"><span class="lineno">  143</span>                    currentRightIndex -= 2;</div>
<div class="line"><span class="lineno">  144</span>                    currentLeftIndex++;</div>
<div class="line"><span class="lineno">  145</span>                    nextErasureOnLeft = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  146</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  147</span>                    canRemoveFurtherPointsInPass = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  148</span>                }</div>
<div class="line"><span class="lineno">  149</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  150</span>                <span class="keywordflow">if</span> (currentRightIndex &gt;= 3 &amp;&amp; currentLeftIndex + 3 &lt;= currentRightIndex) {</div>
<div class="line"><span class="lineno">  151</span>                    gridDates.erase(std::next(gridDates.begin(), currentRightIndex - 2),</div>
<div class="line"><span class="lineno">  152</span>                                    std::next(gridDates.begin(), currentRightIndex));</div>
<div class="line"><span class="lineno">  153</span>                    currentNumberOfDiscretisationPoints -= 2;</div>
<div class="line"><span class="lineno">  154</span>                    currentRightIndex -= 3;</div>
<div class="line"><span class="lineno">  155</span>                    nextErasureOnLeft = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  156</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  157</span>                    canRemoveFurtherPointsInPass = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  158</span>                }</div>
<div class="line"><span class="lineno">  159</span>            }</div>
<div class="line"><span class="lineno">  160</span>            <span class="comment">// just for debugging</span></div>
<div class="line"><span class="lineno">  161</span>            <span class="comment">// logGrid(originalGridDates, gridDates);</span></div>
<div class="line"><span class="lineno">  162</span>        }</div>
<div class="line"><span class="lineno">  163</span>    }</div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>    <span class="keywordflow">return</span> gridDates;</div>
<div class="line"><span class="lineno">  166</span>}</div>
<div class="ttc" id="amodel_2utilities_8cpp_html_a24bc06abadc72e51af462e64714c3822"><div class="ttname"><a href="model_2utilities_8cpp.html#a24bc06abadc72e51af462e64714c3822">referenceDate</a></div><div class="ttdeci">Date referenceDate</div><div class="ttdef"><b>Definition:</b> <a href="model_2utilities_8cpp_source.html#l00442">utilities.cpp:442</a></div></div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_risk_participation_agreement_base_engine_a19fa7bb64d14323e611ea636f50726ea_icgraph.png" border="0" usemap="#aclassore_1_1data_1_1_risk_participation_agreement_base_engine_a19fa7bb64d14323e611ea636f50726ea_icgraph" alt=""/></div>
<map name="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_a19fa7bb64d14323e611ea636f50726ea_icgraph" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_a19fa7bb64d14323e611ea636f50726ea_icgraph">
<area shape="rect" title=" " alt="" coords="303,37,455,63"/>
<area shape="rect" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="93,5,167,31"/>
<area shape="rect" href="classore_1_1data_1_1_risk_participation_agreement_swap_l_g_m_grid_engine_builder.html#a641881c9b5542adec793abef2d186faf" title=" " alt="" coords="5,55,255,109"/>
</map>
</div>

</div>
</div>
<a id="a469ecd4d7deacd2c23aabfa700b79bdf" name="a469ecd4d7deacd2c23aabfa700b79bdf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a469ecd4d7deacd2c23aabfa700b79bdf">&#9670;&#160;</a></span>protectionLegNpv()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual Real protectionLegNpv </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implemented in <a class="el" href="classore_1_1data_1_1_analytic_black_risk_participation_agreement_engine.html#ade0a74a8fd16b945b60d4f9fec832fdc">AnalyticBlackRiskParticipationAgreementEngine</a>, <a class="el" href="classore_1_1data_1_1_analytic_x_ccy_black_risk_participation_agreement_engine.html#ade0a74a8fd16b945b60d4f9fec832fdc">AnalyticXCcyBlackRiskParticipationAgreementEngine</a>, and <a class="el" href="classore_1_1data_1_1_numeric_lgm_risk_participation_agreement_engine.html#ade0a74a8fd16b945b60d4f9fec832fdc">NumericLgmRiskParticipationAgreementEngine</a>.</p>
<div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_risk_participation_agreement_base_engine_a469ecd4d7deacd2c23aabfa700b79bdf_icgraph.png" border="0" usemap="#aclassore_1_1data_1_1_risk_participation_agreement_base_engine_a469ecd4d7deacd2c23aabfa700b79bdf_icgraph" alt=""/></div>
<map name="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_a469ecd4d7deacd2c23aabfa700b79bdf_icgraph" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_a469ecd4d7deacd2c23aabfa700b79bdf_icgraph">
<area shape="rect" title=" " alt="" coords="128,5,249,31"/>
<area shape="rect" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a61eb1a24e5329ccc296715a40dc3a19a" title=" " alt="" coords="5,5,80,31"/>
</map>
</div>

</div>
</div>
<a id="a61eb1a24e5329ccc296715a40dc3a19a" name="a61eb1a24e5329ccc296715a40dc3a19a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61eb1a24e5329ccc296715a40dc3a19a">&#9670;&#160;</a></span>calculate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void calculate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="riskparticipationagreementbaseengine_8cpp_source.html#l00168">168</a> of file <a class="el" href="riskparticipationagreementbaseengine_8cpp_source.html">riskparticipationagreementbaseengine.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  168</span>                                                           {</div>
<div class="line"><span class="lineno">  169</span> </div>
<div class="line"><span class="lineno">  170</span>    QL_REQUIRE(!<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>[<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae239c5725955937ec0ba66c592cecdd1">baseCcy_</a>].empty(),</div>
<div class="line"><span class="lineno">  171</span>               <span class="stringliteral">&quot;RiskParticipationAgreementBaseEngine::calculate(): empty discount curve for ccy&quot;</span> &lt;&lt; <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae239c5725955937ec0ba66c592cecdd1">baseCcy_</a>);</div>
<div class="line"><span class="lineno">  172</span>    QL_REQUIRE(!<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#acc213ca558c2cfd047dbced63bcab643">defaultCurve_</a>.empty(), <span class="stringliteral">&quot;RiskParticipationAgreementBaseEngine::calculate(): empty default curve&quot;</span>);</div>
<div class="line"><span class="lineno">  173</span>    QL_REQUIRE(<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.fixedRecoveryRate != Null&lt;Real&gt;() || !<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#af7ab2e6ca0ab7b7fdd155f4950b7b3d6">recoveryRate_</a>.empty(),</div>
<div class="line"><span class="lineno">  174</span>               <span class="stringliteral">&quot;RiskParticipationAgreementBaseEngine::calculate(): empty recovery and trade does not specify &quot;</span></div>
<div class="line"><span class="lineno">  175</span>               <span class="stringliteral">&quot;fixed recovery&quot;</span>);</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>    <span class="comment">// asof date for valuation</span></div>
<div class="line"><span class="lineno">  178</span> </div>
<div class="line"><span class="lineno">  179</span>    <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a> = <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>[<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae239c5725955937ec0ba66c592cecdd1">baseCcy_</a>]-&gt;referenceDate();</div>
<div class="line"><span class="lineno">  180</span> </div>
<div class="line"><span class="lineno">  181</span>    <span class="comment">// effective recovery rate to use</span></div>
<div class="line"><span class="lineno">  182</span> </div>
<div class="line"><span class="lineno">  183</span>    <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a2e6528316bc85aab2f93514aaae6cec8">effectiveRecoveryRate_</a> =</div>
<div class="line"><span class="lineno">  184</span>        <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.fixedRecoveryRate == Null&lt;Real&gt;() ? <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#af7ab2e6ca0ab7b7fdd155f4950b7b3d6">recoveryRate_</a>-&gt;value() : <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.fixedRecoveryRate;</div>
<div class="line"><span class="lineno">  185</span> </div>
<div class="line"><span class="lineno">  186</span>    <span class="comment">// compute the fee leg NPV</span></div>
<div class="line"><span class="lineno">  187</span> </div>
<div class="line"><span class="lineno">  188</span>    Real fee = 0.0;</div>
<div class="line"><span class="lineno">  189</span>    Size idx = 0;</div>
<div class="line"><span class="lineno">  190</span>    std::vector&lt;std::vector&lt;Date&gt;&gt; feeStartDates;</div>
<div class="line"><span class="lineno">  191</span>    std::vector&lt;std::vector&lt;Date&gt;&gt; feeEndDates;</div>
<div class="line"><span class="lineno">  192</span>    std::vector&lt;std::vector&lt;Date&gt;&gt; feePayDates;</div>
<div class="line"><span class="lineno">  193</span>    std::vector&lt;std::vector&lt;Date&gt;&gt; feeMidDates;</div>
<div class="line"><span class="lineno">  194</span>    std::vector&lt;std::vector&lt;double&gt;&gt; feeAmounts;</div>
<div class="line"><span class="lineno">  195</span>    std::vector&lt;std::vector&lt;double&gt;&gt; feeMidAccrueds;</div>
<div class="line"><span class="lineno">  196</span>    std::vector&lt;std::vector&lt;double&gt;&gt; feeMidDiscounts;</div>
<div class="line"><span class="lineno">  197</span>    std::vector&lt;std::vector&lt;double&gt;&gt; feeDiscounts;</div>
<div class="line"><span class="lineno">  198</span>    std::vector&lt;std::vector&lt;double&gt;&gt; feeSurvivalProbs;</div>
<div class="line"><span class="lineno">  199</span>    std::vector&lt;std::vector&lt;double&gt;&gt; feePeriodPDs;</div>
<div class="line"><span class="lineno">  200</span>    std::vector&lt;double&gt; feeFXSpot;</div>
<div class="line"><span class="lineno">  201</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; l : <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionFee) {</div>
<div class="line"><span class="lineno">  202</span>        QL_REQUIRE(!<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>[<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionFeeCcys[idx]].empty(),</div>
<div class="line"><span class="lineno">  203</span>                   <span class="stringliteral">&quot;RiskParticipationAgreementBaseEngine::calculate(): empty discount curve for ccy &quot;</span></div>
<div class="line"><span class="lineno">  204</span>                       &lt;&lt; <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionFeeCcys[idx]);</div>
<div class="line"><span class="lineno">  205</span>        QL_REQUIRE(!<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a876f97316c68159e07070d243a6e52ed">fxSpots_</a>[<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionFeeCcys[idx]].empty(),</div>
<div class="line"><span class="lineno">  206</span>                   <span class="stringliteral">&quot;RiskParticipationAgreementBaseEngine::calculate(): empty fx spot for ccy &quot;</span></div>
<div class="line"><span class="lineno">  207</span>                       &lt;&lt; <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionFeeCcys[idx] + <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae239c5725955937ec0ba66c592cecdd1">baseCcy_</a>);</div>
<div class="line"><span class="lineno">  208</span>        feeFXSpot.push_back(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a876f97316c68159e07070d243a6e52ed">fxSpots_</a>[<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionFeeCcys[idx]]-&gt;value());</div>
<div class="line"><span class="lineno">  209</span>        std::vector&lt;Date&gt; thisFeeStartDates;</div>
<div class="line"><span class="lineno">  210</span>        std::vector&lt;Date&gt; thisFeeEndDates;</div>
<div class="line"><span class="lineno">  211</span>        std::vector&lt;Date&gt; thisFeePayDates;</div>
<div class="line"><span class="lineno">  212</span>        std::vector&lt;Date&gt; thisFeeMidDates;</div>
<div class="line"><span class="lineno">  213</span>        std::vector&lt;double&gt; thisFeeAmounts;</div>
<div class="line"><span class="lineno">  214</span>        std::vector&lt;double&gt; thisFeeMidAccrueds;</div>
<div class="line"><span class="lineno">  215</span>        std::vector&lt;double&gt; thisFeeMidDiscounts;</div>
<div class="line"><span class="lineno">  216</span>        std::vector&lt;double&gt; thisFeeDiscounts;</div>
<div class="line"><span class="lineno">  217</span>        std::vector&lt;double&gt; thisFeeSurvivalProbs;</div>
<div class="line"><span class="lineno">  218</span>        std::vector&lt;double&gt; thisFeePeriodPDs;</div>
<div class="line"><span class="lineno">  219</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; c : l) {</div>
<div class="line"><span class="lineno">  220</span>            <span class="keywordflow">if</span> (c-&gt;date() &lt;= <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a>)</div>
<div class="line"><span class="lineno">  221</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  222</span>            thisFeePayDates.push_back(c-&gt;date());</div>
<div class="line"><span class="lineno">  223</span>            thisFeeAmounts.push_back(c-&gt;amount());</div>
<div class="line"><span class="lineno">  224</span>            thisFeeDiscounts.push_back(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>[<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionFeeCcys[idx]]-&gt;discount(c-&gt;date()));</div>
<div class="line"><span class="lineno">  225</span>            thisFeeSurvivalProbs.push_back(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#acc213ca558c2cfd047dbced63bcab643">defaultCurve_</a>-&gt;survivalProbability(c-&gt;date()));</div>
<div class="line"><span class="lineno">  226</span>            <span class="comment">// the fee is only paid if the reference entity is still alive at the payment date</span></div>
<div class="line"><span class="lineno">  227</span>            fee += thisFeeAmounts.back() * thisFeeDiscounts.back() * feeFXSpot.back() * thisFeeSurvivalProbs.back();</div>
<div class="line"><span class="lineno">  228</span>            <span class="comment">// accrual settlement using the mid of the coupon periods</span></div>
<div class="line"><span class="lineno">  229</span>            <span class="keyword">auto</span> cpn = boost::dynamic_pointer_cast&lt;Coupon&gt;(c);</div>
<div class="line"><span class="lineno">  230</span>            <span class="keywordflow">if</span> (cpn &amp;&amp; <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.settlesAccrual) {</div>
<div class="line"><span class="lineno">  231</span>                Date start = std::max(cpn-&gt;accrualStartDate(), <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a>);</div>
<div class="line"><span class="lineno">  232</span>                Date end = cpn-&gt;accrualEndDate();</div>
<div class="line"><span class="lineno">  233</span>                thisFeeStartDates.push_back(start);</div>
<div class="line"><span class="lineno">  234</span>                thisFeeEndDates.push_back(end);</div>
<div class="line"><span class="lineno">  235</span>                <span class="keywordflow">if</span> (start &lt; end) {</div>
<div class="line"><span class="lineno">  236</span>                    Date mid = start + (end - start) / 2;</div>
<div class="line"><span class="lineno">  237</span>                    thisFeeMidDates.push_back(mid);</div>
<div class="line"><span class="lineno">  238</span>                    thisFeeMidAccrueds.push_back(cpn-&gt;accruedAmount(mid));</div>
<div class="line"><span class="lineno">  239</span>                    thisFeeMidDiscounts.push_back(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a9fbd2e40654f7b9b28d60c636126fe25">discountCurves_</a>[<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionFeeCcys[idx]]-&gt;discount(mid));</div>
<div class="line"><span class="lineno">  240</span>                    thisFeePeriodPDs.push_back(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#acc213ca558c2cfd047dbced63bcab643">defaultCurve_</a>-&gt;defaultProbability(start, end));</div>
<div class="line"><span class="lineno">  241</span>                    fee += thisFeeMidAccrueds.back() * thisFeeMidDiscounts.back() * feeFXSpot.back() *</div>
<div class="line"><span class="lineno">  242</span>                           thisFeePeriodPDs.back();</div>
<div class="line"><span class="lineno">  243</span>                }</div>
<div class="line"><span class="lineno">  244</span>            }</div>
<div class="line"><span class="lineno">  245</span>        }</div>
<div class="line"><span class="lineno">  246</span>        feeStartDates.push_back(thisFeeStartDates);</div>
<div class="line"><span class="lineno">  247</span>        feeEndDates.push_back(thisFeeEndDates);</div>
<div class="line"><span class="lineno">  248</span>        feePayDates.push_back(thisFeePayDates);</div>
<div class="line"><span class="lineno">  249</span>        feeMidDates.push_back(thisFeeMidDates);</div>
<div class="line"><span class="lineno">  250</span>        feeAmounts.push_back(thisFeeAmounts);</div>
<div class="line"><span class="lineno">  251</span>        feeMidAccrueds.push_back(thisFeeMidAccrueds);</div>
<div class="line"><span class="lineno">  252</span>        feeMidDiscounts.push_back(thisFeeMidDiscounts);</div>
<div class="line"><span class="lineno">  253</span>        feeDiscounts.push_back(thisFeeDiscounts);</div>
<div class="line"><span class="lineno">  254</span>        feeSurvivalProbs.push_back(thisFeeSurvivalProbs);</div>
<div class="line"><span class="lineno">  255</span>        feePeriodPDs.push_back(thisFeePeriodPDs);</div>
<div class="line"><span class="lineno">  256</span>        ++idx;</div>
<div class="line"><span class="lineno">  257</span>    }</div>
<div class="line"><span class="lineno">  258</span> </div>
<div class="line"><span class="lineno">  259</span>    <span class="comment">// if we are past the protection end date, the protection leg NPV is zero, otherwise we call into the</span></div>
<div class="line"><span class="lineno">  260</span>    <span class="comment">// derived engine to compute this</span></div>
<div class="line"><span class="lineno">  261</span> </div>
<div class="line"><span class="lineno">  262</span>    Real protection = 0.0;</div>
<div class="line"><span class="lineno">  263</span>    <span class="keywordflow">if</span> (<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionEnd &gt; <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a>) {</div>
<div class="line"><span class="lineno">  264</span>        <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">gridDates_</a> = <a class="code hl_function" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a19fa7bb64d14323e611ea636f50726ea">buildDiscretisationGrid</a>(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a>, <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionStart, <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionEnd,</div>
<div class="line"><span class="lineno">  265</span>                                             <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.underlying, <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a4eaeca9e21e17bfd7efbf6621e756823">maxGapDays_</a>, <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#ae6a927076473671509505a47c34f7004">maxDiscretisationPoints_</a>);</div>
<div class="line"><span class="lineno">  266</span>        protection = <a class="code hl_function" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a469ecd4d7deacd2c23aabfa700b79bdf">protectionLegNpv</a>();</div>
<div class="line"><span class="lineno">  267</span>    }</div>
<div class="line"><span class="lineno">  268</span> </div>
<div class="line"><span class="lineno">  269</span>    <span class="comment">// compute the total NPV, we buy the protection if we pay the fee</span></div>
<div class="line"><span class="lineno">  270</span> </div>
<div class="line"><span class="lineno">  271</span>    <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.value = (<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionFeePayer ? 1.0 : -1.0) * (protection - fee);</div>
<div class="line"><span class="lineno">  272</span> </div>
<div class="line"><span class="lineno">  273</span>    <span class="comment">// set additional results</span></div>
<div class="line"><span class="lineno">  274</span> </div>
<div class="line"><span class="lineno">  275</span>    std::vector&lt;Real&gt; gridPeriodPds;</div>
<div class="line"><span class="lineno">  276</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">gridDates_</a>.size() - 1; ++i)</div>
<div class="line"><span class="lineno">  277</span>        gridPeriodPds.push_back(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#acc213ca558c2cfd047dbced63bcab643">defaultCurve_</a>-&gt;defaultProbability(<a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">gridDates_</a>[i], <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">gridDates_</a>[i + 1]));</div>
<div class="line"><span class="lineno">  278</span> </div>
<div class="line"><span class="lineno">  279</span>    <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;GridDates&quot;</span>] = <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">gridDates_</a>;</div>
<div class="line"><span class="lineno">  280</span>    <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;ProtectionLegNpv&quot;</span>] = (<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionFeePayer ? 1.0 : -1.0) * protection;</div>
<div class="line"><span class="lineno">  281</span>    <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FeeLegNpv&quot;</span>] = (<a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionFeePayer ? 1.0 : -1.0) * fee;</div>
<div class="line"><span class="lineno">  282</span>    <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;RecoveryRate&quot;</span>] = <a class="code hl_variable" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a2e6528316bc85aab2f93514aaae6cec8">effectiveRecoveryRate_</a>;</div>
<div class="line"><span class="lineno">  283</span>    <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;GridPeriodPDs&quot;</span>] = gridPeriodPds;</div>
<div class="line"><span class="lineno">  284</span>    <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;ParticipationRate&quot;</span>] = <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.participationRate;</div>
<div class="line"><span class="lineno">  285</span> </div>
<div class="line"><span class="lineno">  286</span>    <span class="keywordflow">for</span> (Size l = 0; l &lt; <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionFee.size(); ++l) {</div>
<div class="line"><span class="lineno">  287</span>        <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FeeStartDates&quot;</span>] = feeStartDates[l];</div>
<div class="line"><span class="lineno">  288</span>        <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FeeEndDates&quot;</span>] = feeEndDates[l];</div>
<div class="line"><span class="lineno">  289</span>        <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FeePayDates&quot;</span>] = feePayDates[l];</div>
<div class="line"><span class="lineno">  290</span>        <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FeeMidDates&quot;</span>] = feeMidDates[l];</div>
<div class="line"><span class="lineno">  291</span>        <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FeeAmounts&quot;</span>] = feeAmounts[l];</div>
<div class="line"><span class="lineno">  292</span>        <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FeeMidAccrueds&quot;</span>] = feeMidAccrueds[l];</div>
<div class="line"><span class="lineno">  293</span>        <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FeeMidDiscounts&quot;</span>] = feeMidDiscounts[l];</div>
<div class="line"><span class="lineno">  294</span>        <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FeeDiscounts&quot;</span>] = feeDiscounts[l];</div>
<div class="line"><span class="lineno">  295</span>        <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FeeSurvivalProbs&quot;</span>] = feeSurvivalProbs[l];</div>
<div class="line"><span class="lineno">  296</span>        <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FeePeriodPDs&quot;</span>] = feePeriodPDs[l];</div>
<div class="line"><span class="lineno">  297</span>        <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FeeFXSpot&quot;</span>] = feeFXSpot;</div>
<div class="line"><span class="lineno">  298</span>        <a class="code hl_variableRef" href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a>.additionalResults[<span class="stringliteral">&quot;FeeCurrency&quot;</span>] = <a class="code hl_variableRef" href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a>.protectionFeeCcys[l];</div>
<div class="line"><span class="lineno">  299</span>    }</div>
<div class="line"><span class="lineno">  300</span>}</div>
<div class="ttc" id="acdsoption_8cpp_html_afeb3e8b4e6ab6604c185b2ea55bbc728"><div class="ttname"><a href="../qle/cdsoption_8cpp.html#afeb3e8b4e6ab6604c185b2ea55bbc728">results_</a></div><div class="ttdeci">const Instrument::results * results_</div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_a19fa7bb64d14323e611ea636f50726ea"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a19fa7bb64d14323e611ea636f50726ea">ore::data::RiskParticipationAgreementBaseEngine::buildDiscretisationGrid</a></div><div class="ttdeci">static std::vector&lt; Date &gt; buildDiscretisationGrid(const Date &amp;referenceDate, const Date &amp;protectionStart, const Date &amp;protectionEnd, const std::vector&lt; Leg &gt; &amp;underlying, const Size maxGapDays=Null&lt; Size &gt;(), const Size maxDiscretisationPoints=Null&lt; Size &gt;())</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8cpp_source.html#l00062">riskparticipationagreementbaseengine.cpp:62</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_a2e6528316bc85aab2f93514aaae6cec8"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a2e6528316bc85aab2f93514aaae6cec8">ore::data::RiskParticipationAgreementBaseEngine::effectiveRecoveryRate_</a></div><div class="ttdeci">Real effectiveRecoveryRate_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00064">riskparticipationagreementbaseengine.hpp:64</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_a38a4e2098671399fba5f588ea75d5a10"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a38a4e2098671399fba5f588ea75d5a10">ore::data::RiskParticipationAgreementBaseEngine::gridDates_</a></div><div class="ttdeci">std::vector&lt; Date &gt; gridDates_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00062">riskparticipationagreementbaseengine.hpp:62</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_a3e22290961d6b56dce069c1c4fda6386"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a3e22290961d6b56dce069c1c4fda6386">ore::data::RiskParticipationAgreementBaseEngine::referenceDate_</a></div><div class="ttdeci">Date referenceDate_</div><div class="ttdef"><b>Definition:</b> <a href="riskparticipationagreementbaseengine_8hpp_source.html#l00063">riskparticipationagreementbaseengine.hpp:63</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_html_a469ecd4d7deacd2c23aabfa700b79bdf"><div class="ttname"><a href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a469ecd4d7deacd2c23aabfa700b79bdf">ore::data::RiskParticipationAgreementBaseEngine::protectionLegNpv</a></div><div class="ttdeci">virtual Real protectionLegNpv() const =0</div></div>
<div class="ttc" id="atenorbasisswap_8cpp_html_a71b2ce0e52885aca4ce15e1d128b9f56"><div class="ttname"><a href="../qle/tenorbasisswap_8cpp.html#a71b2ce0e52885aca4ce15e1d128b9f56">arguments_</a></div><div class="ttdeci">Swap::arguments * arguments_</div></div>
</div><!-- fragment --><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classore_1_1data_1_1_risk_participation_agreement_base_engine_a61eb1a24e5329ccc296715a40dc3a19a_cgraph.png" border="0" usemap="#aclassore_1_1data_1_1_risk_participation_agreement_base_engine_a61eb1a24e5329ccc296715a40dc3a19a_cgraph" alt=""/></div>
<map name="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_a61eb1a24e5329ccc296715a40dc3a19a_cgraph" id="aclassore_1_1data_1_1_risk_participation_agreement_base_engine_a61eb1a24e5329ccc296715a40dc3a19a_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,80,56"/>
<area shape="rect" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a19fa7bb64d14323e611ea636f50726ea" title=" " alt="" coords="128,5,280,31"/>
<area shape="rect" href="classore_1_1data_1_1_risk_participation_agreement_base_engine.html#a469ecd4d7deacd2c23aabfa700b79bdf" title=" " alt="" coords="143,55,265,80"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="ae239c5725955937ec0ba66c592cecdd1" name="ae239c5725955937ec0ba66c592cecdd1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae239c5725955937ec0ba66c592cecdd1">&#9670;&#160;</a></span>baseCcy_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string baseCcy_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html#l00054">54</a> of file <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html">riskparticipationagreementbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a9fbd2e40654f7b9b28d60c636126fe25" name="a9fbd2e40654f7b9b28d60c636126fe25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fbd2e40654f7b9b28d60c636126fe25">&#9670;&#160;</a></span>discountCurves_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;std::string, Handle&lt;YieldTermStructure&gt; &gt; discountCurves_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html#l00055">55</a> of file <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html">riskparticipationagreementbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a876f97316c68159e07070d243a6e52ed" name="a876f97316c68159e07070d243a6e52ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a876f97316c68159e07070d243a6e52ed">&#9670;&#160;</a></span>fxSpots_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;std::string, Handle&lt;Quote&gt; &gt; fxSpots_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html#l00056">56</a> of file <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html">riskparticipationagreementbaseengine.hpp</a>.</p>

</div>
</div>
<a id="acc213ca558c2cfd047dbced63bcab643" name="acc213ca558c2cfd047dbced63bcab643"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc213ca558c2cfd047dbced63bcab643">&#9670;&#160;</a></span>defaultCurve_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Handle&lt;DefaultProbabilityTermStructure&gt; defaultCurve_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html#l00057">57</a> of file <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html">riskparticipationagreementbaseengine.hpp</a>.</p>

</div>
</div>
<a id="af7ab2e6ca0ab7b7fdd155f4950b7b3d6" name="af7ab2e6ca0ab7b7fdd155f4950b7b3d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7ab2e6ca0ab7b7fdd155f4950b7b3d6">&#9670;&#160;</a></span>recoveryRate_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Handle&lt;Quote&gt; recoveryRate_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html#l00058">58</a> of file <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html">riskparticipationagreementbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a4eaeca9e21e17bfd7efbf6621e756823" name="a4eaeca9e21e17bfd7efbf6621e756823"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4eaeca9e21e17bfd7efbf6621e756823">&#9670;&#160;</a></span>maxGapDays_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Size maxGapDays_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html#l00059">59</a> of file <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html">riskparticipationagreementbaseengine.hpp</a>.</p>

</div>
</div>
<a id="ae6a927076473671509505a47c34f7004" name="ae6a927076473671509505a47c34f7004"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6a927076473671509505a47c34f7004">&#9670;&#160;</a></span>maxDiscretisationPoints_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Size maxDiscretisationPoints_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html#l00059">59</a> of file <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html">riskparticipationagreementbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a38a4e2098671399fba5f588ea75d5a10" name="a38a4e2098671399fba5f588ea75d5a10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38a4e2098671399fba5f588ea75d5a10">&#9670;&#160;</a></span>gridDates_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;Date&gt; gridDates_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html#l00062">62</a> of file <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html">riskparticipationagreementbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a3e22290961d6b56dce069c1c4fda6386" name="a3e22290961d6b56dce069c1c4fda6386"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e22290961d6b56dce069c1c4fda6386">&#9670;&#160;</a></span>referenceDate_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Date referenceDate_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html#l00063">63</a> of file <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html">riskparticipationagreementbaseengine.hpp</a>.</p>

</div>
</div>
<a id="a2e6528316bc85aab2f93514aaae6cec8" name="a2e6528316bc85aab2f93514aaae6cec8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e6528316bc85aab2f93514aaae6cec8">&#9670;&#160;</a></span>effectiveRecoveryRate_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Real effectiveRecoveryRate_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html#l00064">64</a> of file <a class="el" href="riskparticipationagreementbaseengine_8hpp_source.html">riskparticipationagreementbaseengine.hpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.9.5
</small></address>
</body>
</html>
