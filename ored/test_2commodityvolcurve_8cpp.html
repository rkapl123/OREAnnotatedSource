<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<title>OREData: test/commodityvolcurve.cpp File Reference</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="oredextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-data@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.8.12</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_13e138d54eb8818da29c3992edef070a.html">test</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">commodityvolcurve.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;boost/test/unit_test.hpp&gt;</code><br />
<code>#include &lt;boost/test/data/test_case.hpp&gt;</code><br />
<code>#include &lt;oret/datapaths.hpp&gt;</code><br />
<code>#include &lt;oret/toplevelfixture.hpp&gt;</code><br />
<code>#include &lt;boost/make_shared.hpp&gt;</code><br />
<code>#include &lt;cmath&gt;</code><br />
<code>#include &lt;<a class="el" href="curveconfigurations_8hpp_source.html">ored/configuration/curveconfigurations.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="commodityvolcurve_8hpp_source.html">ored/marketdata/commodityvolcurve.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="csvloader_8hpp_source.html">ored/marketdata/csvloader.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="curvespec_8hpp_source.html">ored/marketdata/curvespec.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="loader_8hpp_source.html">ored/marketdata/loader.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="todaysmarket_8hpp_source.html">ored/marketdata/todaysmarket.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="csvfilereader_8hpp_source.html">ored/utilities/csvfilereader.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="parsers_8hpp_source.html">ored/utilities/parsers.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="to__string_8hpp_source.html">ored/utilities/to_string.hpp</a>&gt;</code><br />
<code>#include &lt;ql/termstructures/volatility/equityfx/blackvariancesurface.hpp&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../qle/dividendmanager_8hpp.html">qle/indexes/dividendmanager.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../qle/aposurface_8hpp.html">qle/termstructures/aposurface.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../qle/blackvariancesurfacesparse_8hpp.html">qle/termstructures/blackvariancesurfacesparse.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../qle/blackvolsurfacedelta_8hpp.html">qle/termstructures/blackvolsurfacedelta.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="elRef" href="../qle/blackvolsurfacewithatm_8hpp.html">qle/termstructures/blackvolsurfacewithatm.hpp</a>&gt;</code><br />
</div>
<p><a href="test_2commodityvolcurve_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1613fdabc3df596524914dd99c5716c9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2commodityvolcurve_8cpp.html#a1613fdabc3df596524914dd99c5716c9">BOOST_AUTO_TEST_CASE</a> (testCommodityVolCurveTypeConstant)</td></tr>
<tr class="separator:a1613fdabc3df596524914dd99c5716c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44ddfa6a405eb023a3a599fdbe9bcd0f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2commodityvolcurve_8cpp.html#a44ddfa6a405eb023a3a599fdbe9bcd0f">BOOST_AUTO_TEST_CASE</a> (testCommodityVolCurveTypeCurve)</td></tr>
<tr class="separator:a44ddfa6a405eb023a3a599fdbe9bcd0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad1f411bc09de6a360add401393db70e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2commodityvolcurve_8cpp.html#aad1f411bc09de6a360add401393db70e">BOOST_AUTO_TEST_CASE</a> (testCommodityVolCurveTypeSurface)</td></tr>
<tr class="separator:aad1f411bc09de6a360add401393db70e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abda3ef960ffff4cfd3f1877974cf40b9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2commodityvolcurve_8cpp.html#abda3ef960ffff4cfd3f1877974cf40b9">BOOST_AUTO_TEST_CASE</a> (testCommodityVolSurfaceWildcardExpiriesWildcardStrikes)</td></tr>
<tr class="separator:abda3ef960ffff4cfd3f1877974cf40b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a128655d3600f52d2be18afd6c0bf34e1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2commodityvolcurve_8cpp.html#a128655d3600f52d2be18afd6c0bf34e1">BOOST_AUTO_TEST_CASE</a> (testCommodityVolSurfaceWildcardExpiriesExplicitStrikes)</td></tr>
<tr class="separator:a128655d3600f52d2be18afd6c0bf34e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4544c5faede52660055714610f6d6fb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2commodityvolcurve_8cpp.html#ad4544c5faede52660055714610f6d6fb">BOOST_AUTO_TEST_CASE</a> (testCommodityVolSurfaceExplicitExpiriesWildcardStrikes)</td></tr>
<tr class="separator:ad4544c5faede52660055714610f6d6fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d725aa3c7c308186ea4a1fd870ad418"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2commodityvolcurve_8cpp.html#a4d725aa3c7c308186ea4a1fd870ad418">BOOST_AUTO_TEST_CASE</a> (testCommodityVolSurfaceExplicitExpiriesExplicitStrikes)</td></tr>
<tr class="separator:a4d725aa3c7c308186ea4a1fd870ad418"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8614f16d649a5fb64b81ce0ee6f49d89"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2commodityvolcurve_8cpp.html#a8614f16d649a5fb64b81ce0ee6f49d89">BOOST_DATA_TEST_CASE</a> (testCommodityVolDeltaSurface, bdata::make(<a class="el" href="test_2commodityvolcurve_8cpp.html#a03bf183dfd69eb1c21370c8f30d9de68">asofDates</a>) *bdata::make(<a class="el" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>), asof, curveConfig)</td></tr>
<tr class="separator:a8614f16d649a5fb64b81ce0ee6f49d89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc646673a48ac9d2a9b57e0c54250195"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2commodityvolcurve_8cpp.html#abc646673a48ac9d2a9b57e0c54250195">BOOST_DATA_TEST_CASE</a> (testCommodityVolMoneynessSurface, bdata::make(<a class="el" href="test_2commodityvolcurve_8cpp.html#a03bf183dfd69eb1c21370c8f30d9de68">asofDates</a>) *bdata::make(<a class="el" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>), asof, curveConfig)</td></tr>
<tr class="separator:abc646673a48ac9d2a9b57e0c54250195"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f750495eebfc246acfa03ade4e1c041"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2commodityvolcurve_8cpp.html#a6f750495eebfc246acfa03ade4e1c041">BOOST_DATA_TEST_CASE</a> (testCommodityApoSurface, bdata::make(<a class="el" href="test_2commodityvolcurve_8cpp.html#a03bf183dfd69eb1c21370c8f30d9de68">asofDates</a>), asof)</td></tr>
<tr class="separator:a6f750495eebfc246acfa03ade4e1c041"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a020df78606b2b7a7f1ff9d89a1d1f9cd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2commodityvolcurve_8cpp.html#a020df78606b2b7a7f1ff9d89a1d1f9cd">BOOST_AUTO_TEST_CASE</a> (testCommodityVolSurfaceMyrCrudePalmOil)</td></tr>
<tr class="separator:a020df78606b2b7a7f1ff9d89a1d1f9cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a03bf183dfd69eb1c21370c8f30d9de68"><td class="memItemLeft" align="right" valign="top">vector&lt; Date &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2commodityvolcurve_8cpp.html#a03bf183dfd69eb1c21370c8f30d9de68">asofDates</a> {Date(13, Jan, 2020), Date(15, Jan, 2020)}</td></tr>
<tr class="separator:a03bf183dfd69eb1c21370c8f30d9de68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96a582300d10244c7df851066de48438"><td class="memItemLeft" align="right" valign="top">vector&lt; string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a> {&quot;curveconfig_explicit_expiries.xml&quot;, &quot;curveconfig_wildcard_expiries.xml&quot;}</td></tr>
<tr class="separator:a96a582300d10244c7df851066de48438"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a1613fdabc3df596524914dd99c5716c9" name="a1613fdabc3df596524914dd99c5716c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1613fdabc3df596524914dd99c5716c9">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[1/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCommodityVolCurveTypeConstant&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2commodityvolcurve_8cpp_source.html#l00168">168</a> of file <a class="el" href="test_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  168</span>                                                        {</div>
<div class="line"><span class="lineno">  169</span> </div>
<div class="line"><span class="lineno">  170</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing commodity vol curve building with a single configured volatility&quot;</span>);</div>
<div class="line"><span class="lineno">  171</span> </div>
<div class="line"><span class="lineno">  172</span>    <span class="comment">// As of date</span></div>
<div class="line"><span class="lineno">  173</span>    Date asof(5, Feb, 2016);</div>
<div class="line"><span class="lineno">  174</span> </div>
<div class="line"><span class="lineno">  175</span>    <span class="comment">// Constant volatility config</span></div>
<div class="line"><span class="lineno">  176</span>    vector&lt;QuantLib::ext::shared_ptr&lt;VolatilityConfig&gt;&gt; cvc;</div>
<div class="line"><span class="lineno">  177</span>    cvc.push_back(QuantLib::ext::make_shared&lt;ConstantVolatilityConfig&gt;(<span class="stringliteral">&quot;COMMODITY_OPTION/RATE_LNVOL/GOLD/USD/2Y/ATM/AtmFwd&quot;</span>));</div>
<div class="line"><span class="lineno">  178</span> </div>
<div class="line"><span class="lineno">  179</span>    <span class="comment">// Volatility configuration with a single quote</span></div>
<div class="line"><span class="lineno">  180</span>    QuantLib::ext::shared_ptr&lt;CommodityVolatilityConfig&gt; curveConfig =</div>
<div class="line"><span class="lineno">  181</span>        QuantLib::ext::make_shared&lt;CommodityVolatilityConfig&gt;(<span class="stringliteral">&quot;GOLD_USD_VOLS&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;USD&quot;</span>, cvc, <span class="stringliteral">&quot;A365&quot;</span>, <span class="stringliteral">&quot;NullCalendar&quot;</span>);</div>
<div class="line"><span class="lineno">  182</span> </div>
<div class="line"><span class="lineno">  183</span>    <span class="comment">// Curve configurations</span></div>
<div class="line"><span class="lineno">  184</span>    <a class="code hl_class" href="classore_1_1data_1_1_curve_configurations.html">CurveConfigurations</a> <a class="code hl_variable" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>;</div>
<div class="line"><span class="lineno">  185</span>    <a class="code hl_variable" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>.add(CurveSpec::CurveType::CommodityVolatility, <span class="stringliteral">&quot;GOLD_USD_VOLS&quot;</span>, curveConfig);</div>
<div class="line"><span class="lineno">  186</span> </div>
<div class="line"><span class="lineno">  187</span>    <span class="comment">// Commodity curve spec</span></div>
<div class="line"><span class="lineno">  188</span>    <a class="code hl_class" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> curveSpec(<span class="stringliteral">&quot;USD&quot;</span>, <span class="stringliteral">&quot;GOLD_USD_VOLS&quot;</span>);</div>
<div class="line"><span class="lineno">  189</span> </div>
<div class="line"><span class="lineno">  190</span>    <span class="comment">// Market data loader</span></div>
<div class="line"><span class="lineno">  191</span>    MockLoader loader;</div>
<div class="line"><span class="lineno">  192</span> </div>
<div class="line"><span class="lineno">  193</span>    <span class="comment">// Empty Conventions</span></div>
<div class="line"><span class="lineno">  194</span>    <a class="code hl_class" href="classore_1_1data_1_1_conventions.html">Conventions</a> conventions;</div>
<div class="line"><span class="lineno">  195</span> </div>
<div class="line"><span class="lineno">  196</span>    <span class="comment">// Check commodity volatility construction works</span></div>
<div class="line"><span class="lineno">  197</span>    QuantLib::ext::shared_ptr&lt;CommodityVolCurve&gt; curve;</div>
<div class="line"><span class="lineno">  198</span>    BOOST_CHECK_NO_THROW(curve = QuantLib::ext::make_shared&lt;CommodityVolCurve&gt;(asof, curveSpec, loader, <a class="code hl_variable" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>));</div>
<div class="line"><span class="lineno">  199</span> </div>
<div class="line"><span class="lineno">  200</span>    <span class="comment">// Check volatilities are all equal to the configured volatility regardless of strike and expiry</span></div>
<div class="line"><span class="lineno">  201</span>    Real configuredVolatility = 0.10;</div>
<div class="line"><span class="lineno">  202</span>    QuantLib::ext::shared_ptr&lt;BlackVolTermStructure&gt; volatility = curve-&gt;volatility();</div>
<div class="line"><span class="lineno">  203</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(0.25, 1000.0), configuredVolatility, testTolerance);</div>
<div class="line"><span class="lineno">  204</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(0.25, 1200.0), configuredVolatility, testTolerance);</div>
<div class="line"><span class="lineno">  205</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 3 * Months, 1000.0), configuredVolatility, testTolerance);</div>
<div class="line"><span class="lineno">  206</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 3 * Months, 1200.0), configuredVolatility, testTolerance);</div>
<div class="line"><span class="lineno">  207</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(50.0, 1000.0), configuredVolatility, testTolerance);</div>
<div class="line"><span class="lineno">  208</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(50.0, 1200.0), configuredVolatility, testTolerance);</div>
<div class="line"><span class="lineno">  209</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 50 * Years, 1000.0), configuredVolatility, testTolerance);</div>
<div class="line"><span class="lineno">  210</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 50 * Years, 1200.0), configuredVolatility, testTolerance);</div>
<div class="line"><span class="lineno">  211</span>}</div>
<div class="ttc" id="aclassore_1_1data_1_1_commodity_volatility_curve_spec_html"><div class="ttname"><a href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">ore::data::CommodityVolatilityCurveSpec</a></div><div class="ttdoc">Commodity volatility description.</div><div class="ttdef"><b>Definition:</b> <a href="curvespec_8hpp_source.html#l00440">curvespec.hpp:440</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_conventions_html"><div class="ttname"><a href="classore_1_1data_1_1_conventions.html">ore::data::Conventions</a></div><div class="ttdoc">Repository for currency dependent market conventions.</div><div class="ttdef"><b>Definition:</b> <a href="conventions_8hpp_source.html#l00113">conventions.hpp:113</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_curve_configurations_html"><div class="ttname"><a href="classore_1_1data_1_1_curve_configurations.html">ore::data::CurveConfigurations</a></div><div class="ttdoc">Container class for all Curve Configurations.</div><div class="ttdef"><b>Definition:</b> <a href="curveconfigurations_8hpp_source.html#l00059">curveconfigurations.hpp:59</a></div></div>
<div class="ttc" id="atest_2commodityvolcurve_8cpp_html_a96a582300d10244c7df851066de48438"><div class="ttname"><a href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a></div><div class="ttdeci">vector&lt; string &gt; curveConfigs</div><div class="ttdef"><b>Definition:</b> <a href="test_2commodityvolcurve_8cpp_source.html#l00525">commodityvolcurve.cpp:525</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a44ddfa6a405eb023a3a599fdbe9bcd0f" name="a44ddfa6a405eb023a3a599fdbe9bcd0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44ddfa6a405eb023a3a599fdbe9bcd0f">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[2/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCommodityVolCurveTypeCurve&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2commodityvolcurve_8cpp_source.html#l00213">213</a> of file <a class="el" href="test_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  213</span>                                                     {</div>
<div class="line"><span class="lineno">  214</span> </div>
<div class="line"><span class="lineno">  215</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing commodity vol curve building with time dependent volatilities&quot;</span>);</div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>    <span class="comment">// As of date</span></div>
<div class="line"><span class="lineno">  218</span>    Date asof(5, Feb, 2016);</div>
<div class="line"><span class="lineno">  219</span> </div>
<div class="line"><span class="lineno">  220</span>    <span class="comment">// Quotes for the volatility curve</span></div>
<div class="line"><span class="lineno">  221</span>    vector&lt;string&gt; quotes{<span class="stringliteral">&quot;COMMODITY_OPTION/RATE_LNVOL/GOLD/USD/1Y/ATM/AtmFwd&quot;</span>,</div>
<div class="line"><span class="lineno">  222</span>                          <span class="stringliteral">&quot;COMMODITY_OPTION/RATE_LNVOL/GOLD/USD/2Y/ATM/AtmFwd&quot;</span>,</div>
<div class="line"><span class="lineno">  223</span>                          <span class="stringliteral">&quot;COMMODITY_OPTION/RATE_LNVOL/GOLD/USD/5Y/ATM/AtmFwd&quot;</span>};</div>
<div class="line"><span class="lineno">  224</span> </div>
<div class="line"><span class="lineno">  225</span>    <span class="comment">// Volatility curve config with linear interpolation and flat extrapolation.</span></div>
<div class="line"><span class="lineno">  226</span>    vector&lt;QuantLib::ext::shared_ptr&lt;VolatilityConfig&gt;&gt; vcc;</div>
<div class="line"><span class="lineno">  227</span>    vcc.push_back(QuantLib::ext::make_shared&lt;VolatilityCurveConfig&gt;(quotes, <span class="stringliteral">&quot;Linear&quot;</span>, <span class="stringliteral">&quot;Flat&quot;</span>));</div>
<div class="line"><span class="lineno">  228</span> </div>
<div class="line"><span class="lineno">  229</span>    <span class="comment">// Commodity volatility configuration with time dependent volatilities</span></div>
<div class="line"><span class="lineno">  230</span>    QuantLib::ext::shared_ptr&lt;CommodityVolatilityConfig&gt; curveConfig =</div>
<div class="line"><span class="lineno">  231</span>        QuantLib::ext::make_shared&lt;CommodityVolatilityConfig&gt;(<span class="stringliteral">&quot;GOLD_USD_VOLS&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;USD&quot;</span>, vcc, <span class="stringliteral">&quot;A365&quot;</span>, <span class="stringliteral">&quot;NullCalendar&quot;</span>);</div>
<div class="line"><span class="lineno">  232</span> </div>
<div class="line"><span class="lineno">  233</span>    <span class="comment">// Curve configurations</span></div>
<div class="line"><span class="lineno">  234</span>    <a class="code hl_class" href="classore_1_1data_1_1_curve_configurations.html">CurveConfigurations</a> <a class="code hl_variable" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>;</div>
<div class="line"><span class="lineno">  235</span>    <a class="code hl_variable" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>.add(CurveSpec::CurveType::CommodityVolatility,<span class="stringliteral">&quot;GOLD_USD_VOLS&quot;</span>, curveConfig);</div>
<div class="line"><span class="lineno">  236</span> </div>
<div class="line"><span class="lineno">  237</span>    <span class="comment">// Commodity curve spec</span></div>
<div class="line"><span class="lineno">  238</span>    <a class="code hl_class" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> curveSpec(<span class="stringliteral">&quot;USD&quot;</span>, <span class="stringliteral">&quot;GOLD_USD_VOLS&quot;</span>);</div>
<div class="line"><span class="lineno">  239</span> </div>
<div class="line"><span class="lineno">  240</span>    <span class="comment">// Market data loader</span></div>
<div class="line"><span class="lineno">  241</span>    MockLoader loader;</div>
<div class="line"><span class="lineno">  242</span> </div>
<div class="line"><span class="lineno">  243</span>    <span class="comment">// Empty Conventions</span></div>
<div class="line"><span class="lineno">  244</span>    <a class="code hl_class" href="classore_1_1data_1_1_conventions.html">Conventions</a> conventions;</div>
<div class="line"><span class="lineno">  245</span> </div>
<div class="line"><span class="lineno">  246</span>    <span class="comment">// Check commodity volatility construction works</span></div>
<div class="line"><span class="lineno">  247</span>    QuantLib::ext::shared_ptr&lt;CommodityVolCurve&gt; curve;</div>
<div class="line"><span class="lineno">  248</span>    BOOST_CHECK_NO_THROW(curve = QuantLib::ext::make_shared&lt;CommodityVolCurve&gt;(asof, curveSpec, loader, <a class="code hl_variable" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>));</div>
<div class="line"><span class="lineno">  249</span> </div>
<div class="line"><span class="lineno">  250</span>    <span class="comment">// Check time depending volatilities are as expected</span></div>
<div class="line"><span class="lineno">  251</span>    QuantLib::ext::shared_ptr&lt;BlackVolTermStructure&gt; volatility = curve-&gt;volatility();</div>
<div class="line"><span class="lineno">  252</span>    Real configuredVolatility;</div>
<div class="line"><span class="lineno">  253</span> </div>
<div class="line"><span class="lineno">  254</span>    <span class="comment">// Check configured pillar points: { (1Y, 0.11), (2Y, 0.10), (5Y, 0.09) }</span></div>
<div class="line"><span class="lineno">  255</span>    <span class="comment">// Check also strike independence</span></div>
<div class="line"><span class="lineno">  256</span>    configuredVolatility = 0.11;</div>
<div class="line"><span class="lineno">  257</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 1 * Years, 1000.0), configuredVolatility, testTolerance);</div>
<div class="line"><span class="lineno">  258</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 1 * Years, 1200.0), configuredVolatility, testTolerance);</div>
<div class="line"><span class="lineno">  259</span> </div>
<div class="line"><span class="lineno">  260</span>    configuredVolatility = 0.10;</div>
<div class="line"><span class="lineno">  261</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 2 * Years, 1000.0), configuredVolatility, testTolerance);</div>
<div class="line"><span class="lineno">  262</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 2 * Years, 1200.0), configuredVolatility, testTolerance);</div>
<div class="line"><span class="lineno">  263</span> </div>
<div class="line"><span class="lineno">  264</span>    configuredVolatility = 0.09;</div>
<div class="line"><span class="lineno">  265</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 5 * Years, 1000.0), configuredVolatility, testTolerance);</div>
<div class="line"><span class="lineno">  266</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 5 * Years, 1200.0), configuredVolatility, testTolerance);</div>
<div class="line"><span class="lineno">  267</span> </div>
<div class="line"><span class="lineno">  268</span>    <span class="comment">// Check briefly the default linear interpolation and extrapolation</span></div>
<div class="line"><span class="lineno">  269</span>    Time t_s = volatility-&gt;dayCounter().yearFraction(asof, asof + 2 * Years);</div>
<div class="line"><span class="lineno">  270</span>    Real v_s = 0.10;</div>
<div class="line"><span class="lineno">  271</span>    Time t_e = volatility-&gt;dayCounter().yearFraction(asof, asof + 5 * Years);</div>
<div class="line"><span class="lineno">  272</span>    Real v_e = 0.09;</div>
<div class="line"><span class="lineno">  273</span>    <span class="comment">// at 3 years</span></div>
<div class="line"><span class="lineno">  274</span>    Time t = volatility-&gt;dayCounter().yearFraction(asof, asof + 3 * Years);</div>
<div class="line"><span class="lineno">  275</span>    Real v = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a>((v_s * v_s * t_s + (v_e * v_e * t_e - v_s * v_s * t_s) * (t - t_s) / (t_e - t_s)) / t);</div>
<div class="line"><span class="lineno">  276</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 3 * Years, 1000.0), v, testTolerance);</div>
<div class="line"><span class="lineno">  277</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 3 * Years, 1200.0), v, testTolerance);</div>
<div class="line"><span class="lineno">  278</span>    <span class="comment">// at 6 years, extrapolation is with a flat vol</span></div>
<div class="line"><span class="lineno">  279</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 6 * Years, 1000.0), v_e, testTolerance);</div>
<div class="line"><span class="lineno">  280</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 6 * Years, 1200.0), v_e, testTolerance);</div>
<div class="line"><span class="lineno">  281</span>}</div>
<div class="ttc" id="anamespace_quant_ext_html_a1b4a64a3620f987e65fec4ccf7cadcf2"><div class="ttname"><a href="../qle/namespace_quant_ext.html#a1b4a64a3620f987e65fec4ccf7cadcf2">sqrt</a></div><div class="ttdeci">RandomVariable sqrt(RandomVariable x)</div></div>
</div><!-- fragment --><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="test_2commodityvolcurve_8cpp_a44ddfa6a405eb023a3a599fdbe9bcd0f_cgraph.svg" width="294" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aad1f411bc09de6a360add401393db70e" name="aad1f411bc09de6a360add401393db70e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad1f411bc09de6a360add401393db70e">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[3/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCommodityVolCurveTypeSurface&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2commodityvolcurve_8cpp_source.html#l00283">283</a> of file <a class="el" href="test_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  283</span>                                                       {</div>
<div class="line"><span class="lineno">  284</span> </div>
<div class="line"><span class="lineno">  285</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing commodity vol curve building with time and strike dependent volatilities&quot;</span>);</div>
<div class="line"><span class="lineno">  286</span> </div>
<div class="line"><span class="lineno">  287</span>    <span class="comment">// As of date</span></div>
<div class="line"><span class="lineno">  288</span>    Date asof(5, Feb, 2016);</div>
<div class="line"><span class="lineno">  289</span> </div>
<div class="line"><span class="lineno">  290</span>    <span class="comment">// Volatility configuration with expiry period vs. absolute strike matrix. Bilinear interpolation and flat</span></div>
<div class="line"><span class="lineno">  291</span>    <span class="comment">// extrapolation.</span></div>
<div class="line"><span class="lineno">  292</span>    vector&lt;string&gt; <a class="code hl_variableRef" href="../qle/test_2analyticcashsettledeuropeanengine_8cpp.html#aa7b6f0cca80627aec257d302511d608c">strikes</a>{<span class="stringliteral">&quot;1150&quot;</span>, <span class="stringliteral">&quot;1190&quot;</span>};</div>
<div class="line"><span class="lineno">  293</span>    vector&lt;string&gt; expiries{<span class="stringliteral">&quot;1Y&quot;</span>, <span class="stringliteral">&quot;2Y&quot;</span>, <span class="stringliteral">&quot;5Y&quot;</span>};</div>
<div class="line"><span class="lineno">  294</span> </div>
<div class="line"><span class="lineno">  295</span>    vector&lt;QuantLib::ext::shared_ptr&lt;VolatilityConfig&gt;&gt; vssc;</div>
<div class="line"><span class="lineno">  296</span>    vssc.push_back(</div>
<div class="line"><span class="lineno">  297</span>        QuantLib::ext::make_shared&lt;VolatilityStrikeSurfaceConfig&gt;(strikes, expiries, <span class="stringliteral">&quot;Linear&quot;</span>, <span class="stringliteral">&quot;Linear&quot;</span>, <span class="keyword">true</span>, <span class="stringliteral">&quot;Flat&quot;</span>, <span class="stringliteral">&quot;Flat&quot;</span>));</div>
<div class="line"><span class="lineno">  298</span> </div>
<div class="line"><span class="lineno">  299</span>    <span class="comment">// Commodity volatility configuration</span></div>
<div class="line"><span class="lineno">  300</span>    QuantLib::ext::shared_ptr&lt;CommodityVolatilityConfig&gt; curveConfig =</div>
<div class="line"><span class="lineno">  301</span>        QuantLib::ext::make_shared&lt;CommodityVolatilityConfig&gt;(<span class="stringliteral">&quot;GOLD_USD_VOLS&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;USD&quot;</span>, vssc, <span class="stringliteral">&quot;A365&quot;</span>, <span class="stringliteral">&quot;NullCalendar&quot;</span>);</div>
<div class="line"><span class="lineno">  302</span> </div>
<div class="line"><span class="lineno">  303</span>    <span class="comment">// Curve configurations</span></div>
<div class="line"><span class="lineno">  304</span>    <a class="code hl_class" href="classore_1_1data_1_1_curve_configurations.html">CurveConfigurations</a> <a class="code hl_variable" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>;</div>
<div class="line"><span class="lineno">  305</span>    <a class="code hl_variable" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>.add(CurveSpec::CurveType::CommodityVolatility, <span class="stringliteral">&quot;GOLD_USD_VOLS&quot;</span>, curveConfig);</div>
<div class="line"><span class="lineno">  306</span> </div>
<div class="line"><span class="lineno">  307</span>    <span class="comment">// Commodity curve spec</span></div>
<div class="line"><span class="lineno">  308</span>    <a class="code hl_class" href="classore_1_1data_1_1_commodity_volatility_curve_spec.html">CommodityVolatilityCurveSpec</a> curveSpec(<span class="stringliteral">&quot;USD&quot;</span>, <span class="stringliteral">&quot;GOLD_USD_VOLS&quot;</span>);</div>
<div class="line"><span class="lineno">  309</span> </div>
<div class="line"><span class="lineno">  310</span>    <span class="comment">// Market data loader</span></div>
<div class="line"><span class="lineno">  311</span>    MockLoader loader;</div>
<div class="line"><span class="lineno">  312</span> </div>
<div class="line"><span class="lineno">  313</span>    <span class="comment">// Empty Conventions</span></div>
<div class="line"><span class="lineno">  314</span>    <a class="code hl_class" href="classore_1_1data_1_1_conventions.html">Conventions</a> conventions;</div>
<div class="line"><span class="lineno">  315</span> </div>
<div class="line"><span class="lineno">  316</span>    <span class="comment">// Check commodity volatility construction works</span></div>
<div class="line"><span class="lineno">  317</span>    QuantLib::ext::shared_ptr&lt;CommodityVolCurve&gt; curve;</div>
<div class="line"><span class="lineno">  318</span>    BOOST_CHECK_NO_THROW(curve = QuantLib::ext::make_shared&lt;CommodityVolCurve&gt;(asof, curveSpec, loader, <a class="code hl_variable" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>));</div>
<div class="line"><span class="lineno">  319</span> </div>
<div class="line"><span class="lineno">  320</span>    <span class="comment">// Check time and strike depending volatilities are as expected</span></div>
<div class="line"><span class="lineno">  321</span>    QuantLib::ext::shared_ptr&lt;BlackVolTermStructure&gt; volatility = curve-&gt;volatility();</div>
<div class="line"><span class="lineno">  322</span> </div>
<div class="line"><span class="lineno">  323</span>    <span class="comment">// Check configured pillar points</span></div>
<div class="line"><span class="lineno">  324</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 1 * Years, 1150.0), 0.105, testTolerance);</div>
<div class="line"><span class="lineno">  325</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 1 * Years, 1190.0), 0.115, testTolerance);</div>
<div class="line"><span class="lineno">  326</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 2 * Years, 1150.0), 0.095, testTolerance);</div>
<div class="line"><span class="lineno">  327</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 2 * Years, 1190.0), 0.105, testTolerance);</div>
<div class="line"><span class="lineno">  328</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 5 * Years, 1150.0), 0.085, testTolerance);</div>
<div class="line"><span class="lineno">  329</span>    BOOST_CHECK_CLOSE(volatility-&gt;blackVol(asof + 5 * Years, 1190.0), 0.095, testTolerance);</div>
<div class="line"><span class="lineno">  330</span>}</div>
<div class="ttc" id="atest_2analyticcashsettledeuropeanengine_8cpp_html_aa7b6f0cca80627aec257d302511d608c"><div class="ttname"><a href="../qle/test_2analyticcashsettledeuropeanengine_8cpp.html#aa7b6f0cca80627aec257d302511d608c">strikes</a></div><div class="ttdeci">vector&lt; Real &gt; strikes</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abda3ef960ffff4cfd3f1877974cf40b9" name="abda3ef960ffff4cfd3f1877974cf40b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abda3ef960ffff4cfd3f1877974cf40b9">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[4/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCommodityVolSurfaceWildcardExpiriesWildcardStrikes&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2commodityvolcurve_8cpp_source.html#l00332">332</a> of file <a class="el" href="test_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  332</span>                                                                             {</div>
<div class="line"><span class="lineno">  333</span> </div>
<div class="line"><span class="lineno">  334</span>    <span class="comment">// Testing commodity volatility curve building wildcard expiries and strikes in configuration and more than one</span></div>
<div class="line"><span class="lineno">  335</span>    <span class="comment">// set of commodity volatility quotes in the market data. In particular, the market data in the wildcard_data</span></div>
<div class="line"><span class="lineno">  336</span>    <span class="comment">// folder has commodity volatility data for two surfaces NYMEX:CL and ICE:B. Check here that the commodity</span></div>
<div class="line"><span class="lineno">  337</span>    <span class="comment">// volatility curve building for NYMEX:CL uses only the 9 NYMEX:CL quotes - 3 tenors, each with 3 strikes.</span></div>
<div class="line"><span class="lineno">  338</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing commodity volatility curve building wildcard expiries and strikes in configuration&quot;</span>);</div>
<div class="line"><span class="lineno">  339</span> </div>
<div class="line"><span class="lineno">  340</span>    <span class="keyword">auto</span> todaysMarket =</div>
<div class="line"><span class="lineno">  341</span>        createTodaysMarket(Date(16, Sep, 2019), <span class="stringliteral">&quot;wildcard_data&quot;</span>, <span class="stringliteral">&quot;curveconfig_surface_wc_expiries_wc_strikes.xml&quot;</span>);</div>
<div class="line"><span class="lineno">  342</span> </div>
<div class="line"><span class="lineno">  343</span>    <span class="keyword">auto</span> vts = todaysMarket-&gt;commodityVolatility(<span class="stringliteral">&quot;NYMEX:CL&quot;</span>);</div>
<div class="line"><span class="lineno">  344</span> </div>
<div class="line"><span class="lineno">  345</span>    <span class="comment">// Wildcards in configuration so we know that a BlackVarianceSurfaceSparse has been created and fed to a</span></div>
<div class="line"><span class="lineno">  346</span>    <span class="comment">// BlackVolatilityWithATM surface in TodaysMarket</span></div>
<div class="line"><span class="lineno">  347</span>    <span class="keyword">auto</span> tmSurface = QuantLib::ext::dynamic_pointer_cast&lt;BlackVolatilityWithATM&gt;(*vts);</div>
<div class="line"><span class="lineno">  348</span>    BOOST_REQUIRE_MESSAGE(tmSurface, <span class="stringliteral">&quot;Expected the commodity vol structure in TodaysMarket&quot;</span></div>
<div class="line"><span class="lineno">  349</span>                                         &lt;&lt; <span class="stringliteral">&quot; to be of type BlackVolatilityWithATM&quot;</span>);</div>
<div class="line"><span class="lineno">  350</span>    <span class="keyword">auto</span> surface = QuantLib::ext::dynamic_pointer_cast&lt;BlackVarianceSurfaceSparse&gt;(tmSurface-&gt;surface());</div>
<div class="line"><span class="lineno">  351</span>    BOOST_REQUIRE_MESSAGE(tmSurface, <span class="stringliteral">&quot;Expected the commodity vol structure in TodaysMarket to contain&quot;</span></div>
<div class="line"><span class="lineno">  352</span>                                         &lt;&lt; <span class="stringliteral">&quot; a surface of type BlackVarianceSurfaceSparse&quot;</span>);</div>
<div class="line"><span class="lineno">  353</span> </div>
<div class="line"><span class="lineno">  354</span>    <span class="comment">// The expected NYMEX CL volatility data</span></div>
<div class="line"><span class="lineno">  355</span>    NymexVolatilityData expData;</div>
<div class="line"><span class="lineno">  356</span> </div>
<div class="line"><span class="lineno">  357</span>    <span class="comment">// Check what is loaded against expected data as provided in market data file for NYMEX:CL.</span></div>
<div class="line"><span class="lineno">  358</span>    <span class="comment">// Note: the BlackVarianceSurfaceSparse adds a dummy expiry slice at time zero</span></div>
<div class="line"><span class="lineno">  359</span>    BOOST_REQUIRE_EQUAL(surface-&gt;expiries().size() - 1, expData.expiries.size());</div>
<div class="line"><span class="lineno">  360</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; expData.strikes.size(); i++) {</div>
<div class="line"><span class="lineno">  361</span>        BOOST_CHECK_EQUAL(surface-&gt;expiries()[i + 1], expData.expiries[i]);</div>
<div class="line"><span class="lineno">  362</span>    }</div>
<div class="line"><span class="lineno">  363</span> </div>
<div class="line"><span class="lineno">  364</span>    BOOST_REQUIRE_EQUAL(surface-&gt;strikes().size() - 1, expData.strikes.size());</div>
<div class="line"><span class="lineno">  365</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; expData.strikes.size(); i++) {</div>
<div class="line"><span class="lineno">  366</span> </div>
<div class="line"><span class="lineno">  367</span>        <span class="comment">// Check the strikes against the input</span></div>
<div class="line"><span class="lineno">  368</span>        Date e = expData.expiries[i];</div>
<div class="line"><span class="lineno">  369</span>        BOOST_REQUIRE_EQUAL(surface-&gt;strikes()[i + 1].size(), expData.strikes[e].size());</div>
<div class="line"><span class="lineno">  370</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt; surface-&gt;strikes()[i + 1].<a class="code hl_function" href="namespaceore_1_1data.html#a777e216dee6069b548bb87da7152699e">size</a>(); j++) {</div>
<div class="line"><span class="lineno">  371</span>            BOOST_CHECK_CLOSE(expData.strikes[e][j], surface-&gt;strikes()[i + 1][j], 1e-12);</div>
<div class="line"><span class="lineno">  372</span>        }</div>
<div class="line"><span class="lineno">  373</span> </div>
<div class="line"><span class="lineno">  374</span>        <span class="comment">// Check the volatilities against the input</span></div>
<div class="line"><span class="lineno">  375</span>        BOOST_REQUIRE_EQUAL(surface-&gt;values()[i + 1].size(), expData.volatilities[e].size());</div>
<div class="line"><span class="lineno">  376</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt; surface-&gt;values()[i + 1].<a class="code hl_function" href="namespaceore_1_1data.html#a777e216dee6069b548bb87da7152699e">size</a>(); j++) {</div>
<div class="line"><span class="lineno">  377</span>            BOOST_CHECK_CLOSE(expData.volatilities[e][j], surface-&gt;blackVol(e, surface-&gt;strikes()[i + 1][j]), 1e-12);</div>
<div class="line"><span class="lineno">  378</span>        }</div>
<div class="line"><span class="lineno">  379</span>    }</div>
<div class="line"><span class="lineno">  380</span>}</div>
<div class="ttc" id="anamespaceore_1_1data_html_a777e216dee6069b548bb87da7152699e"><div class="ttname"><a href="namespaceore_1_1data.html#a777e216dee6069b548bb87da7152699e">ore::data::size</a></div><div class="ttdeci">Size size(const ValueType &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="ored_2scripting_2value_8cpp_source.html#l00145">value.cpp:145</a></div></div>
</div><!-- fragment --><div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="test_2commodityvolcurve_8cpp_abda3ef960ffff4cfd3f1877974cf40b9_cgraph.svg" width="355" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a128655d3600f52d2be18afd6c0bf34e1" name="a128655d3600f52d2be18afd6c0bf34e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a128655d3600f52d2be18afd6c0bf34e1">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[5/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCommodityVolSurfaceWildcardExpiriesExplicitStrikes&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2commodityvolcurve_8cpp_source.html#l00382">382</a> of file <a class="el" href="test_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  382</span>                                                                             {</div>
<div class="line"><span class="lineno">  383</span> </div>
<div class="line"><span class="lineno">  384</span>    BOOST_TEST_MESSAGE(</div>
<div class="line"><span class="lineno">  385</span>        <span class="stringliteral">&quot;Testing commodity volatility curve building wildcard expiries and explicit strikes in configuration&quot;</span>);</div>
<div class="line"><span class="lineno">  386</span> </div>
<div class="line"><span class="lineno">  387</span>    <span class="keyword">auto</span> todaysMarket = createTodaysMarket(Date(16, Sep, 2019), <span class="stringliteral">&quot;wildcard_data&quot;</span>,</div>
<div class="line"><span class="lineno">  388</span>                                           <span class="stringliteral">&quot;curveconfig_surface_wc_expiries_explicit_strikes.xml&quot;</span>);</div>
<div class="line"><span class="lineno">  389</span> </div>
<div class="line"><span class="lineno">  390</span>    <span class="keyword">auto</span> vts = todaysMarket-&gt;commodityVolatility(<span class="stringliteral">&quot;NYMEX:CL&quot;</span>);</div>
<div class="line"><span class="lineno">  391</span> </div>
<div class="line"><span class="lineno">  392</span>    <span class="comment">// Wildcards in configuration so we know that a BlackVarianceSurfaceSparse has been created and fed to a</span></div>
<div class="line"><span class="lineno">  393</span>    <span class="comment">// BlackVolatilityWithATM surface in TodaysMarket</span></div>
<div class="line"><span class="lineno">  394</span>    <span class="keyword">auto</span> tmSurface = QuantLib::ext::dynamic_pointer_cast&lt;BlackVolatilityWithATM&gt;(*vts);</div>
<div class="line"><span class="lineno">  395</span>    BOOST_REQUIRE_MESSAGE(tmSurface, <span class="stringliteral">&quot;Expected the commodity vol structure in TodaysMarket&quot;</span></div>
<div class="line"><span class="lineno">  396</span>                                         &lt;&lt; <span class="stringliteral">&quot; to be of type BlackVolatilityWithATM&quot;</span>);</div>
<div class="line"><span class="lineno">  397</span>    <span class="keyword">auto</span> surface = QuantLib::ext::dynamic_pointer_cast&lt;BlackVarianceSurfaceSparse&gt;(tmSurface-&gt;surface());</div>
<div class="line"><span class="lineno">  398</span>    BOOST_REQUIRE_MESSAGE(tmSurface, <span class="stringliteral">&quot;Expected the commodity vol structure in TodaysMarket to contain&quot;</span></div>
<div class="line"><span class="lineno">  399</span>                                         &lt;&lt; <span class="stringliteral">&quot; a surface of type BlackVarianceSurfaceSparse&quot;</span>);</div>
<div class="line"><span class="lineno">  400</span> </div>
<div class="line"><span class="lineno">  401</span>    <span class="comment">// The expected NYMEX CL volatility data</span></div>
<div class="line"><span class="lineno">  402</span>    NymexVolatilityData expData;</div>
<div class="line"><span class="lineno">  403</span> </div>
<div class="line"><span class="lineno">  404</span>    <span class="comment">// Check what is loaded against expected data as provided in market data file for NYMEX:CL. The explicit strikes</span></div>
<div class="line"><span class="lineno">  405</span>    <span class="comment">// that we have chosen lead have only two corresponding expiries i.e. 2019-10-17 and 2019-12-16</span></div>
<div class="line"><span class="lineno">  406</span>    <span class="comment">// Note: the BlackVarianceSurfaceSparse adds a dummy expiry slice at time zero</span></div>
<div class="line"><span class="lineno">  407</span>    vector&lt;Date&gt; expExpiries{Date(17, Oct, 2019), Date(16, Dec, 2019)};</div>
<div class="line"><span class="lineno">  408</span>    BOOST_REQUIRE_EQUAL(surface-&gt;expiries().size() - 1, expExpiries.size());</div>
<div class="line"><span class="lineno">  409</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; expExpiries.size(); i++) {</div>
<div class="line"><span class="lineno">  410</span>        BOOST_CHECK_EQUAL(surface-&gt;expiries()[i + 1], expExpiries[i]);</div>
<div class="line"><span class="lineno">  411</span>    }</div>
<div class="line"><span class="lineno">  412</span> </div>
<div class="line"><span class="lineno">  413</span>    <span class="comment">// The explicit strikes in the config are 60 and 61</span></div>
<div class="line"><span class="lineno">  414</span>    vector&lt;Real&gt; expStrikes{60, 61};</div>
<div class="line"><span class="lineno">  415</span>    BOOST_REQUIRE_EQUAL(surface-&gt;strikes().size() - 1, expExpiries.size());</div>
<div class="line"><span class="lineno">  416</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; expExpiries.size(); i++) {</div>
<div class="line"><span class="lineno">  417</span> </div>
<div class="line"><span class="lineno">  418</span>        <span class="comment">// Check the strikes against the expected explicit strikes</span></div>
<div class="line"><span class="lineno">  419</span>        BOOST_REQUIRE_EQUAL(surface-&gt;strikes()[i + 1].size(), expStrikes.size());</div>
<div class="line"><span class="lineno">  420</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt; surface-&gt;strikes()[i + 1].<a class="code hl_function" href="namespaceore_1_1data.html#a777e216dee6069b548bb87da7152699e">size</a>(); j++) {</div>
<div class="line"><span class="lineno">  421</span>            BOOST_CHECK_CLOSE(expStrikes[j], surface-&gt;strikes()[i + 1][j], 1e-12);</div>
<div class="line"><span class="lineno">  422</span>        }</div>
<div class="line"><span class="lineno">  423</span> </div>
<div class="line"><span class="lineno">  424</span>        <span class="comment">// Check the volatilities against the input</span></div>
<div class="line"><span class="lineno">  425</span>        Date e = expExpiries[i];</div>
<div class="line"><span class="lineno">  426</span>        BOOST_REQUIRE_EQUAL(surface-&gt;values()[i + 1].size(), expStrikes.size());</div>
<div class="line"><span class="lineno">  427</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt; surface-&gt;values()[i + 1].<a class="code hl_function" href="namespaceore_1_1data.html#a777e216dee6069b548bb87da7152699e">size</a>(); j++) {</div>
<div class="line"><span class="lineno">  428</span>            <span class="comment">// Find the index of the explicit strike in the input data</span></div>
<div class="line"><span class="lineno">  429</span>            Real expStrike = expStrikes[j];</div>
<div class="line"><span class="lineno">  430</span>            <span class="keyword">auto</span> it = find_if(expData.strikes[e].begin(), expData.strikes[e].end(),</div>
<div class="line"><span class="lineno">  431</span>                              [expStrike](Real s) { return close(expStrike, s); });</div>
<div class="line"><span class="lineno">  432</span>            BOOST_REQUIRE_MESSAGE(it != expData.strikes[e].end(), <span class="stringliteral">&quot;Strike not found in input strikes&quot;</span>);</div>
<div class="line"><span class="lineno">  433</span>            <span class="keyword">auto</span> idx = distance(expData.strikes[e].begin(), it);</div>
<div class="line"><span class="lineno">  434</span> </div>
<div class="line"><span class="lineno">  435</span>            BOOST_CHECK_CLOSE(expData.volatilities[e][idx], surface-&gt;blackVol(e, surface-&gt;strikes()[i + 1][j]), 1e-12);</div>
<div class="line"><span class="lineno">  436</span>        }</div>
<div class="line"><span class="lineno">  437</span>    }</div>
<div class="line"><span class="lineno">  438</span>}</div>
</div><!-- fragment --><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="test_2commodityvolcurve_8cpp_a128655d3600f52d2be18afd6c0bf34e1_cgraph.svg" width="355" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad4544c5faede52660055714610f6d6fb" name="ad4544c5faede52660055714610f6d6fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4544c5faede52660055714610f6d6fb">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[6/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCommodityVolSurfaceExplicitExpiriesWildcardStrikes&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2commodityvolcurve_8cpp_source.html#l00440">440</a> of file <a class="el" href="test_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  440</span>                                                                             {</div>
<div class="line"><span class="lineno">  441</span> </div>
<div class="line"><span class="lineno">  442</span>    BOOST_TEST_MESSAGE(</div>
<div class="line"><span class="lineno">  443</span>        <span class="stringliteral">&quot;Testing commodity volatility curve building explicit expiries and wildcard strikes in configuration&quot;</span>);</div>
<div class="line"><span class="lineno">  444</span> </div>
<div class="line"><span class="lineno">  445</span>    <span class="keyword">auto</span> todaysMarket = createTodaysMarket(Date(16, Sep, 2019), <span class="stringliteral">&quot;wildcard_data&quot;</span>,</div>
<div class="line"><span class="lineno">  446</span>                                           <span class="stringliteral">&quot;curveconfig_surface_explicit_expiries_wc_strikes.xml&quot;</span>);</div>
<div class="line"><span class="lineno">  447</span> </div>
<div class="line"><span class="lineno">  448</span>    <span class="keyword">auto</span> vts = todaysMarket-&gt;commodityVolatility(<span class="stringliteral">&quot;NYMEX:CL&quot;</span>);</div>
<div class="line"><span class="lineno">  449</span> </div>
<div class="line"><span class="lineno">  450</span>    <span class="comment">// Wildcards in configuration so we know that a BlackVarianceSurfaceSparse has been created and fed to a</span></div>
<div class="line"><span class="lineno">  451</span>    <span class="comment">// BlackVolatilityWithATM surface in TodaysMarket</span></div>
<div class="line"><span class="lineno">  452</span>    <span class="keyword">auto</span> tmSurface = QuantLib::ext::dynamic_pointer_cast&lt;BlackVolatilityWithATM&gt;(*vts);</div>
<div class="line"><span class="lineno">  453</span>    BOOST_REQUIRE_MESSAGE(tmSurface, <span class="stringliteral">&quot;Expected the commodity vol structure in TodaysMarket&quot;</span></div>
<div class="line"><span class="lineno">  454</span>                                         &lt;&lt; <span class="stringliteral">&quot; to be of type BlackVolatilityWithATM&quot;</span>);</div>
<div class="line"><span class="lineno">  455</span>    <span class="keyword">auto</span> surface = QuantLib::ext::dynamic_pointer_cast&lt;BlackVarianceSurfaceSparse&gt;(tmSurface-&gt;surface());</div>
<div class="line"><span class="lineno">  456</span>    BOOST_REQUIRE_MESSAGE(tmSurface, <span class="stringliteral">&quot;Expected the commodity vol structure in TodaysMarket to contain&quot;</span></div>
<div class="line"><span class="lineno">  457</span>                                         &lt;&lt; <span class="stringliteral">&quot; a surface of type BlackVarianceSurfaceSparse&quot;</span>);</div>
<div class="line"><span class="lineno">  458</span> </div>
<div class="line"><span class="lineno">  459</span>    <span class="comment">// The expected NYMEX CL volatility data</span></div>
<div class="line"><span class="lineno">  460</span>    NymexVolatilityData expData;</div>
<div class="line"><span class="lineno">  461</span> </div>
<div class="line"><span class="lineno">  462</span>    <span class="comment">// Check what is loaded against expected data as provided in market data file for NYMEX:CL.</span></div>
<div class="line"><span class="lineno">  463</span>    <span class="comment">// We have chosen the explicit expiries 2019-10-17 and 2019-12-16</span></div>
<div class="line"><span class="lineno">  464</span>    <span class="comment">// Note: the BlackVarianceSurfaceSparse adds a dummy expiry slice at time zero</span></div>
<div class="line"><span class="lineno">  465</span>    vector&lt;Date&gt; expExpiries{Date(17, Oct, 2019), Date(16, Dec, 2019)};</div>
<div class="line"><span class="lineno">  466</span>    BOOST_REQUIRE_EQUAL(surface-&gt;expiries().size() - 1, expExpiries.size());</div>
<div class="line"><span class="lineno">  467</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; expExpiries.size(); i++) {</div>
<div class="line"><span class="lineno">  468</span>        BOOST_CHECK_EQUAL(surface-&gt;expiries()[i + 1], expExpiries[i]);</div>
<div class="line"><span class="lineno">  469</span>    }</div>
<div class="line"><span class="lineno">  470</span> </div>
<div class="line"><span class="lineno">  471</span>    BOOST_REQUIRE_EQUAL(surface-&gt;strikes().size() - 1, expExpiries.size());</div>
<div class="line"><span class="lineno">  472</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; expExpiries.size(); i++) {</div>
<div class="line"><span class="lineno">  473</span> </div>
<div class="line"><span class="lineno">  474</span>        <span class="comment">// Check the strikes against the input</span></div>
<div class="line"><span class="lineno">  475</span>        Date e = expExpiries[i];</div>
<div class="line"><span class="lineno">  476</span>        BOOST_REQUIRE_EQUAL(surface-&gt;strikes()[i + 1].size(), expData.strikes[e].size());</div>
<div class="line"><span class="lineno">  477</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt; surface-&gt;strikes()[i + 1].<a class="code hl_function" href="namespaceore_1_1data.html#a777e216dee6069b548bb87da7152699e">size</a>(); j++) {</div>
<div class="line"><span class="lineno">  478</span>            BOOST_CHECK_CLOSE(expData.strikes[e][j], surface-&gt;strikes()[i + 1][j], 1e-12);</div>
<div class="line"><span class="lineno">  479</span>        }</div>
<div class="line"><span class="lineno">  480</span> </div>
<div class="line"><span class="lineno">  481</span>        <span class="comment">// Check the volatilities against the input</span></div>
<div class="line"><span class="lineno">  482</span>        BOOST_REQUIRE_EQUAL(surface-&gt;values()[i + 1].size(), expData.volatilities[e].size());</div>
<div class="line"><span class="lineno">  483</span>        <span class="keywordflow">for</span> (Size j = 0; j &lt; surface-&gt;values()[i + 1].<a class="code hl_function" href="namespaceore_1_1data.html#a777e216dee6069b548bb87da7152699e">size</a>(); j++) {</div>
<div class="line"><span class="lineno">  484</span>            BOOST_CHECK_CLOSE(expData.volatilities[e][j], surface-&gt;blackVol(e, surface-&gt;strikes()[i + 1][j]), 1e-12);</div>
<div class="line"><span class="lineno">  485</span>        }</div>
<div class="line"><span class="lineno">  486</span>    }</div>
<div class="line"><span class="lineno">  487</span>}</div>
</div><!-- fragment --><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="test_2commodityvolcurve_8cpp_ad4544c5faede52660055714610f6d6fb_cgraph.svg" width="355" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a4d725aa3c7c308186ea4a1fd870ad418" name="a4d725aa3c7c308186ea4a1fd870ad418"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d725aa3c7c308186ea4a1fd870ad418">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[7/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCommodityVolSurfaceExplicitExpiriesExplicitStrikes&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2commodityvolcurve_8cpp_source.html#l00489">489</a> of file <a class="el" href="test_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  489</span>                                                                             {</div>
<div class="line"><span class="lineno">  490</span> </div>
<div class="line"><span class="lineno">  491</span>    BOOST_TEST_MESSAGE(</div>
<div class="line"><span class="lineno">  492</span>        <span class="stringliteral">&quot;Testing commodity volatility curve building explicit expiries and explicit strikes in configuration&quot;</span>);</div>
<div class="line"><span class="lineno">  493</span> </div>
<div class="line"><span class="lineno">  494</span>    <span class="keyword">auto</span> todaysMarket = createTodaysMarket(Date(16, Sep, 2019), <span class="stringliteral">&quot;wildcard_data&quot;</span>,</div>
<div class="line"><span class="lineno">  495</span>                                           <span class="stringliteral">&quot;curveconfig_surface_explicit_expiries_explicit_strikes.xml&quot;</span>);</div>
<div class="line"><span class="lineno">  496</span> </div>
<div class="line"><span class="lineno">  497</span>    <span class="keyword">auto</span> vts = todaysMarket-&gt;commodityVolatility(<span class="stringliteral">&quot;NYMEX:CL&quot;</span>);</div>
<div class="line"><span class="lineno">  498</span> </div>
<div class="line"><span class="lineno">  499</span>    <span class="comment">// The expected NYMEX CL volatility data</span></div>
<div class="line"><span class="lineno">  500</span>    NymexVolatilityData expData;</div>
<div class="line"><span class="lineno">  501</span> </div>
<div class="line"><span class="lineno">  502</span>    <span class="comment">// We have provided two explicit expiries, 2019-10-17 and 2019-12-16, and two explicit strikes, 60 and 61.</span></div>
<div class="line"><span class="lineno">  503</span>    <span class="comment">// We check the volatility term structure at these 4 points against the input data</span></div>
<div class="line"><span class="lineno">  504</span>    vector&lt;Date&gt; expExpiries{Date(17, Oct, 2019), Date(16, Dec, 2019)};</div>
<div class="line"><span class="lineno">  505</span>    vector&lt;Real&gt; expStrikes{60, 61};</div>
<div class="line"><span class="lineno">  506</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> Date&amp; e : expExpiries) {</div>
<div class="line"><span class="lineno">  507</span>        <span class="keywordflow">for</span> (Real s : expStrikes) {</div>
<div class="line"><span class="lineno">  508</span>            <span class="comment">// Find the index of the explicit strike in the input data</span></div>
<div class="line"><span class="lineno">  509</span>            <span class="keyword">auto</span> it = find_if(expData.strikes[e].begin(), expData.strikes[e].end(),</div>
<div class="line"><span class="lineno">  510</span>                              [s](Real strike) { return close(strike, s); });</div>
<div class="line"><span class="lineno">  511</span>            BOOST_REQUIRE_MESSAGE(it != expData.strikes[e].end(), <span class="stringliteral">&quot;Strike not found in input strikes&quot;</span>);</div>
<div class="line"><span class="lineno">  512</span>            <span class="keyword">auto</span> idx = distance(expData.strikes[e].begin(), it);</div>
<div class="line"><span class="lineno">  513</span> </div>
<div class="line"><span class="lineno">  514</span>            Real inputVol = expData.volatilities[e][idx];</div>
<div class="line"><span class="lineno">  515</span>            BOOST_CHECK_CLOSE(inputVol, vts-&gt;blackVol(e, s), 1e-12);</div>
<div class="line"><span class="lineno">  516</span>        }</div>
<div class="line"><span class="lineno">  517</span>    }</div>
<div class="line"><span class="lineno">  518</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8614f16d649a5fb64b81ce0ee6f49d89" name="a8614f16d649a5fb64b81ce0ee6f49d89"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8614f16d649a5fb64b81ce0ee6f49d89">&#9670;&#160;</a></span>BOOST_DATA_TEST_CASE() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_DATA_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCommodityVolDeltaSurface&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bdata::make(<a class="el" href="test_2commodityvolcurve_8cpp.html#a03bf183dfd69eb1c21370c8f30d9de68">asofDates</a>) *bdata::make(<a class="el" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>)&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">asof&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">curveConfig&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2commodityvolcurve_8cpp_source.html#l00527">527</a> of file <a class="el" href="test_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  528</span>                                  {</div>
<div class="line"><span class="lineno">  529</span> </div>
<div class="line"><span class="lineno">  530</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing commodity volatility delta surface building&quot;</span>);</div>
<div class="line"><span class="lineno">  531</span> </div>
<div class="line"><span class="lineno">  532</span>    <span class="keyword">auto</span> todaysMarket = createTodaysMarket(asof, <span class="stringliteral">&quot;delta_surface&quot;</span>, curveConfig, <span class="stringliteral">&quot;market.txt&quot;</span>);</div>
<div class="line"><span class="lineno">  533</span> </div>
<div class="line"><span class="lineno">  534</span>    <span class="comment">// Get the built commodity volatility surface</span></div>
<div class="line"><span class="lineno">  535</span>    <span class="keyword">auto</span> vts = todaysMarket-&gt;commodityVolatility(<span class="stringliteral">&quot;NYMEX:CL&quot;</span>);</div>
<div class="line"><span class="lineno">  536</span> </div>
<div class="line"><span class="lineno">  537</span>    <span class="comment">// Cast to expected type and check that it succeeds</span></div>
<div class="line"><span class="lineno">  538</span>    <span class="comment">// For some reason, todaysmarket wraps the surface built in CommodityVolCurve in a BlackVolatilityWithATM.</span></div>
<div class="line"><span class="lineno">  539</span>    <span class="keyword">auto</span> bvwa = dynamic_pointer_cast&lt;BlackVolatilityWithATM&gt;(*vts);</div>
<div class="line"><span class="lineno">  540</span>    BOOST_REQUIRE(bvwa);</div>
<div class="line"><span class="lineno">  541</span>    <span class="keyword">auto</span> bvsd = QuantLib::ext::dynamic_pointer_cast&lt;BlackVolatilitySurfaceDelta&gt;(bvwa-&gt;surface());</div>
<div class="line"><span class="lineno">  542</span>    BOOST_REQUIRE(bvsd);</div>
<div class="line"><span class="lineno">  543</span> </div>
<div class="line"><span class="lineno">  544</span>    <span class="comment">// Tolerance for float comparison</span></div>
<div class="line"><span class="lineno">  545</span>    Real tol = 1e-12;</div>
<div class="line"><span class="lineno">  546</span> </div>
<div class="line"><span class="lineno">  547</span>    <span class="comment">// Read in the expected on-grid results for the given date.</span></div>
<div class="line"><span class="lineno">  548</span>    <span class="keywordtype">string</span> filename = <span class="stringliteral">&quot;delta_surface/expected_grid_&quot;</span> + <a class="code hl_function" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">to_string</a>(io::iso_date(asof)) + <span class="stringliteral">&quot;.csv&quot;</span>;</div>
<div class="line"><span class="lineno">  549</span>    <a class="code hl_class" href="classore_1_1data_1_1_c_s_v_file_reader.html">CSVFileReader</a> reader(TEST_INPUT_FILE(filename), <span class="keyword">true</span>, <span class="stringliteral">&quot;,&quot;</span>);</div>
<div class="line"><span class="lineno">  550</span>    BOOST_REQUIRE_EQUAL(reader.numberOfColumns(), 3);</div>
<div class="line"><span class="lineno">  551</span> </div>
<div class="line"><span class="lineno">  552</span>    <span class="keywordflow">while</span> (reader.next()) {</div>
<div class="line"><span class="lineno">  553</span> </div>
<div class="line"><span class="lineno">  554</span>        <span class="comment">// Get the expected expiry date, strike and volatility grid point</span></div>
<div class="line"><span class="lineno">  555</span>        Date expiryDate = <a class="code hl_function" href="group__utilities.html#ga59b5fdda574d90facae95dec2d13040d">parseDate</a>(reader.get(0));</div>
<div class="line"><span class="lineno">  556</span>        Real strike = <a class="code hl_function" href="group__utilities.html#gad1db2a68f9a73667c3b4084d63955bdd">parseReal</a>(reader.get(1));</div>
<div class="line"><span class="lineno">  557</span>        Real volatility = <a class="code hl_function" href="group__utilities.html#gad1db2a68f9a73667c3b4084d63955bdd">parseReal</a>(reader.get(2));</div>
<div class="line"><span class="lineno">  558</span> </div>
<div class="line"><span class="lineno">  559</span>        <span class="comment">// Check that the expected grid expiry date is one of the surface dates</span></div>
<div class="line"><span class="lineno">  560</span>        <span class="keyword">auto</span> itExpiry = find(bvsd-&gt;dates().begin(), bvsd-&gt;dates().end(), expiryDate);</div>
<div class="line"><span class="lineno">  561</span>        BOOST_REQUIRE(itExpiry != bvsd-&gt;dates().end());</div>
<div class="line"><span class="lineno">  562</span> </div>
<div class="line"><span class="lineno">  563</span>        <span class="comment">// Get the smile section, cast to expected type and check cast succeeds.</span></div>
<div class="line"><span class="lineno">  564</span>        <span class="keyword">auto</span> fxss = bvsd-&gt;blackVolSmile(expiryDate);</div>
<div class="line"><span class="lineno">  565</span>        <span class="keyword">auto</span> iss = QuantLib::ext::dynamic_pointer_cast&lt;InterpolatedSmileSection&gt;(fxss);</div>
<div class="line"><span class="lineno">  566</span>        BOOST_REQUIRE(iss);</div>
<div class="line"><span class="lineno">  567</span> </div>
<div class="line"><span class="lineno">  568</span>        <span class="comment">// Check that the expected grid strike is one of the smile section strikes.</span></div>
<div class="line"><span class="lineno">  569</span>        <span class="keyword">auto</span> itStrike =</div>
<div class="line"><span class="lineno">  570</span>            find_if(iss-&gt;strikes().begin(), iss-&gt;strikes().end(), [&amp;](Real s) { return std::abs(s - strike) &lt; tol; });</div>
<div class="line"><span class="lineno">  571</span>        BOOST_REQUIRE(itStrike != iss-&gt;strikes().end());</div>
<div class="line"><span class="lineno">  572</span> </div>
<div class="line"><span class="lineno">  573</span>        <span class="comment">// Check that the expected volatility is equal to that at the grid strike</span></div>
<div class="line"><span class="lineno">  574</span>        <span class="keyword">auto</span> pos = distance(iss-&gt;strikes().begin(), itStrike);</div>
<div class="line"><span class="lineno">  575</span>        BOOST_CHECK_SMALL(volatility - iss-&gt;volatilities()[pos], tol);</div>
<div class="line"><span class="lineno">  576</span>    }</div>
<div class="line"><span class="lineno">  577</span> </div>
<div class="line"><span class="lineno">  578</span>    <span class="comment">// Check flat time extrapolation</span></div>
<div class="line"><span class="lineno">  579</span>    <span class="keyword">auto</span> fxss = bvsd-&gt;blackVolSmile(bvsd-&gt;dates().back());</div>
<div class="line"><span class="lineno">  580</span>    <span class="keyword">auto</span> iss = QuantLib::ext::dynamic_pointer_cast&lt;InterpolatedSmileSection&gt;(fxss);</div>
<div class="line"><span class="lineno">  581</span>    BOOST_REQUIRE(iss);</div>
<div class="line"><span class="lineno">  582</span>    vector&lt;Real&gt; lastVolatilities = iss-&gt;volatilities();</div>
<div class="line"><span class="lineno">  583</span> </div>
<div class="line"><span class="lineno">  584</span>    fxss = bvsd-&gt;blackVolSmile(bvsd-&gt;dates().back() + 1 * Years);</div>
<div class="line"><span class="lineno">  585</span>    iss = QuantLib::ext::dynamic_pointer_cast&lt;InterpolatedSmileSection&gt;(fxss);</div>
<div class="line"><span class="lineno">  586</span>    BOOST_REQUIRE(iss);</div>
<div class="line"><span class="lineno">  587</span>    vector&lt;Real&gt; extrapVolatilities = iss-&gt;volatilities();</div>
<div class="line"><span class="lineno">  588</span> </div>
<div class="line"><span class="lineno">  589</span>    BOOST_REQUIRE_EQUAL(lastVolatilities.size(), extrapVolatilities.size());</div>
<div class="line"><span class="lineno">  590</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; lastVolatilities.size(); i++) {</div>
<div class="line"><span class="lineno">  591</span>        BOOST_CHECK_SMALL(lastVolatilities[i] - extrapVolatilities[i], tol);</div>
<div class="line"><span class="lineno">  592</span>    }</div>
<div class="line"><span class="lineno">  593</span> </div>
<div class="line"><span class="lineno">  594</span>    <span class="comment">// Check flat strike extrapolation.</span></div>
<div class="line"><span class="lineno">  595</span>    Date testDate = asof + 1 * Years;</div>
<div class="line"><span class="lineno">  596</span> </div>
<div class="line"><span class="lineno">  597</span>    fxss = bvsd-&gt;blackVolSmile(testDate);</div>
<div class="line"><span class="lineno">  598</span>    iss = QuantLib::ext::dynamic_pointer_cast&lt;InterpolatedSmileSection&gt;(fxss);</div>
<div class="line"><span class="lineno">  599</span>    BOOST_REQUIRE(iss);</div>
<div class="line"><span class="lineno">  600</span> </div>
<div class="line"><span class="lineno">  601</span>    <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a1dd3178717c03aef7d6851a3dfd92207ad4192ca9679d38110983141b896eebbf">Volatility</a> volAtMinStrike = iss-&gt;volatilities().front();</div>
<div class="line"><span class="lineno">  602</span>    Real minStrike = iss-&gt;strikes().front();</div>
<div class="line"><span class="lineno">  603</span>    Real extrapStrike = minStrike / 2.0;</div>
<div class="line"><span class="lineno">  604</span>    BOOST_CHECK_SMALL(volAtMinStrike - bvsd-&gt;blackVol(testDate, extrapStrike), tol);</div>
<div class="line"><span class="lineno">  605</span> </div>
<div class="line"><span class="lineno">  606</span>    <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a1dd3178717c03aef7d6851a3dfd92207ad4192ca9679d38110983141b896eebbf">Volatility</a> volAtMaxStrike = iss-&gt;volatilities().back();</div>
<div class="line"><span class="lineno">  607</span>    Real maxStrike = iss-&gt;strikes().back();</div>
<div class="line"><span class="lineno">  608</span>    extrapStrike = maxStrike * 2.0;</div>
<div class="line"><span class="lineno">  609</span>    BOOST_CHECK_SMALL(volAtMaxStrike - bvsd-&gt;blackVol(testDate, extrapStrike), tol);</div>
<div class="line"><span class="lineno">  610</span>}</div>
<div class="ttc" id="aclassore_1_1data_1_1_c_s_v_file_reader_html"><div class="ttname"><a href="classore_1_1data_1_1_c_s_v_file_reader.html">ore::data::CSVFileReader</a></div><div class="ttdef"><b>Definition:</b> <a href="csvfilereader_8hpp_source.html#l00076">csvfilereader.hpp:76</a></div></div>
<div class="ttc" id="agroup__utilities_html_ga59b5fdda574d90facae95dec2d13040d"><div class="ttname"><a href="group__utilities.html#ga59b5fdda574d90facae95dec2d13040d">ore::data::parseDate</a></div><div class="ttdeci">Date parseDate(const string &amp;s)</div><div class="ttdoc">Convert std::string to QuantLib::Date.</div><div class="ttdef"><b>Definition:</b> <a href="parsers_8cpp_source.html#l00051">parsers.cpp:51</a></div></div>
<div class="ttc" id="agroup__utilities_html_gad1db2a68f9a73667c3b4084d63955bdd"><div class="ttname"><a href="group__utilities.html#gad1db2a68f9a73667c3b4084d63955bdd">ore::data::parseReal</a></div><div class="ttdeci">Real parseReal(const string &amp;s)</div><div class="ttdoc">Convert text to Real.</div><div class="ttdef"><b>Definition:</b> <a href="parsers_8cpp_source.html#l00112">parsers.cpp:112</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a1dd3178717c03aef7d6851a3dfd92207ad4192ca9679d38110983141b896eebbf"><div class="ttname"><a href="namespaceore_1_1data.html#a1dd3178717c03aef7d6851a3dfd92207ad4192ca9679d38110983141b896eebbf">ore::data::MomentType::Volatility</a></div><div class="ttdeci">@ Volatility</div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a86651dfeb5c18ee891f7a4734d8cf455"><div class="ttname"><a href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">ore::data::to_string</a></div><div class="ttdeci">std::string to_string(const LocationInfo &amp;l)</div><div class="ttdef"><b>Definition:</b> <a href="ast_8cpp_source.html#l00028">ast.cpp:28</a></div></div>
</div><!-- fragment --><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="test_2commodityvolcurve_8cpp_a8614f16d649a5fb64b81ce0ee6f49d89_cgraph.svg" width="624" height="386"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="abc646673a48ac9d2a9b57e0c54250195" name="abc646673a48ac9d2a9b57e0c54250195"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc646673a48ac9d2a9b57e0c54250195">&#9670;&#160;</a></span>BOOST_DATA_TEST_CASE() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_DATA_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCommodityVolMoneynessSurface&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bdata::make(<a class="el" href="test_2commodityvolcurve_8cpp.html#a03bf183dfd69eb1c21370c8f30d9de68">asofDates</a>) *bdata::make(<a class="el" href="test_2commodityvolcurve_8cpp.html#a96a582300d10244c7df851066de48438">curveConfigs</a>)&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">asof&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">curveConfig&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2commodityvolcurve_8cpp_source.html#l00612">612</a> of file <a class="el" href="test_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  613</span>                                  {</div>
<div class="line"><span class="lineno">  614</span> </div>
<div class="line"><span class="lineno">  615</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing commodity volatility forward moneyness surface building&quot;</span>);</div>
<div class="line"><span class="lineno">  616</span> </div>
<div class="line"><span class="lineno">  617</span>    Settings::instance().evaluationDate() = asof;</div>
<div class="line"><span class="lineno">  618</span>    <span class="keyword">auto</span> todaysMarket = createTodaysMarket(asof, <span class="stringliteral">&quot;moneyness_surface&quot;</span>, curveConfig, <span class="stringliteral">&quot;market.txt&quot;</span>);</div>
<div class="line"><span class="lineno">  619</span> </div>
<div class="line"><span class="lineno">  620</span>    <span class="comment">// Get the built commodity volatility surface</span></div>
<div class="line"><span class="lineno">  621</span>    <span class="keyword">auto</span> vts = todaysMarket-&gt;commodityVolatility(<span class="stringliteral">&quot;NYMEX:CL&quot;</span>);</div>
<div class="line"><span class="lineno">  622</span> </div>
<div class="line"><span class="lineno">  623</span>    <span class="comment">// Tolerance for float comparison</span></div>
<div class="line"><span class="lineno">  624</span>    Real tol = 1e-12;</div>
<div class="line"><span class="lineno">  625</span> </div>
<div class="line"><span class="lineno">  626</span>    <span class="comment">// Read in the expected on-grid results for the given date.</span></div>
<div class="line"><span class="lineno">  627</span>    <span class="keywordtype">string</span> filename = <span class="stringliteral">&quot;moneyness_surface/expected_grid_&quot;</span> + <a class="code hl_function" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">to_string</a>(io::iso_date(asof)) + <span class="stringliteral">&quot;.csv&quot;</span>;</div>
<div class="line"><span class="lineno">  628</span>    <a class="code hl_class" href="classore_1_1data_1_1_c_s_v_file_reader.html">CSVFileReader</a> reader(TEST_INPUT_FILE(filename), <span class="keyword">true</span>, <span class="stringliteral">&quot;,&quot;</span>);</div>
<div class="line"><span class="lineno">  629</span>    BOOST_REQUIRE_EQUAL(reader.numberOfColumns(), 3);</div>
<div class="line"><span class="lineno">  630</span> </div>
<div class="line"><span class="lineno">  631</span>    <span class="keywordflow">while</span> (reader.next()) {</div>
<div class="line"><span class="lineno">  632</span> </div>
<div class="line"><span class="lineno">  633</span>        <span class="comment">// Get the expected expiry date, strike and volatility grid point</span></div>
<div class="line"><span class="lineno">  634</span>        Date expiryDate = <a class="code hl_function" href="group__utilities.html#ga59b5fdda574d90facae95dec2d13040d">parseDate</a>(reader.get(0));</div>
<div class="line"><span class="lineno">  635</span>        Real strike = <a class="code hl_function" href="group__utilities.html#gad1db2a68f9a73667c3b4084d63955bdd">parseReal</a>(reader.get(1));</div>
<div class="line"><span class="lineno">  636</span>        Real volatility = <a class="code hl_function" href="group__utilities.html#gad1db2a68f9a73667c3b4084d63955bdd">parseReal</a>(reader.get(2));</div>
<div class="line"><span class="lineno">  637</span> </div>
<div class="line"><span class="lineno">  638</span>        <span class="comment">// Check the surface on the grid point.</span></div>
<div class="line"><span class="lineno">  639</span>        BOOST_CHECK_SMALL(volatility - vts-&gt;blackVol(expiryDate, strike), tol);</div>
<div class="line"><span class="lineno">  640</span>    }</div>
<div class="line"><span class="lineno">  641</span> </div>
<div class="line"><span class="lineno">  642</span>    <span class="comment">// Price term structure</span></div>
<div class="line"><span class="lineno">  643</span>    <span class="keyword">auto</span> pts = todaysMarket-&gt;commodityPriceCurve(<span class="stringliteral">&quot;NYMEX:CL&quot;</span>);</div>
<div class="line"><span class="lineno">  644</span> </div>
<div class="line"><span class="lineno">  645</span>    <span class="comment">// Pick two future expiries beyond max vol surface time and get their prices</span></div>
<div class="line"><span class="lineno">  646</span>    <span class="comment">// This should correspond to moneyness 1.0 and we should see flat vol extrapolation.</span></div>
<div class="line"><span class="lineno">  647</span>    <span class="comment">// This only passes because we have set sticky strike to false in CommodityVolCurve.</span></div>
<div class="line"><span class="lineno">  648</span>    Date extrapDate_1(20, Mar, 2024);</div>
<div class="line"><span class="lineno">  649</span>    Date extrapDate_2(22, Apr, 2024);</div>
<div class="line"><span class="lineno">  650</span>    Real strike_1 = pts-&gt;price(extrapDate_1);</div>
<div class="line"><span class="lineno">  651</span>    Real strike_2 = pts-&gt;price(extrapDate_2);</div>
<div class="line"><span class="lineno">  652</span>    <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a1dd3178717c03aef7d6851a3dfd92207ad4192ca9679d38110983141b896eebbf">Volatility</a> vol_1 = vts-&gt;blackVol(extrapDate_1, strike_1);</div>
<div class="line"><span class="lineno">  653</span>    <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a1dd3178717c03aef7d6851a3dfd92207ad4192ca9679d38110983141b896eebbf">Volatility</a> vol_2 = vts-&gt;blackVol(extrapDate_2, strike_2);</div>
<div class="line"><span class="lineno">  654</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;The two time extrapolated volatilities are: &quot;</span> &lt;&lt; fixed &lt;&lt; setprecision(12) &lt;&lt; vol_1 &lt;&lt; <span class="stringliteral">&quot;,&quot;</span></div>
<div class="line"><span class="lineno">  655</span>                                                                      &lt;&lt; vol_2 &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><span class="lineno">  656</span>    BOOST_CHECK_SMALL(vol_1 - vol_2, tol);</div>
<div class="line"><span class="lineno">  657</span> </div>
<div class="line"><span class="lineno">  658</span>    <span class="comment">// Test flat strike extrapolation at lower and upper strikes i.e. at 50% and 150% forward moneyness.</span></div>
<div class="line"><span class="lineno">  659</span>    Date optionExpiry(14, Jan, 2021);</div>
<div class="line"><span class="lineno">  660</span>    Date futureExpiry(20, Jan, 2021);</div>
<div class="line"><span class="lineno">  661</span>    Real futurePrice = pts-&gt;price(futureExpiry);</div>
<div class="line"><span class="lineno">  662</span> </div>
<div class="line"><span class="lineno">  663</span>    Real lowerStrike = 0.5 * futurePrice;</div>
<div class="line"><span class="lineno">  664</span>    <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a1dd3178717c03aef7d6851a3dfd92207ad4192ca9679d38110983141b896eebbf">Volatility</a> volLowerStrike = vts-&gt;blackVol(optionExpiry, lowerStrike);</div>
<div class="line"><span class="lineno">  665</span>    <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a1dd3178717c03aef7d6851a3dfd92207ad4192ca9679d38110983141b896eebbf">Volatility</a> volLowerExtrapStrike = vts-&gt;blackVol(optionExpiry, lowerStrike / 2.0);</div>
<div class="line"><span class="lineno">  666</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;The two lower strike extrapolated volatilities are: &quot;</span></div>
<div class="line"><span class="lineno">  667</span>                       &lt;&lt; fixed &lt;&lt; setprecision(12) &lt;&lt; volLowerStrike &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; volLowerExtrapStrike &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><span class="lineno">  668</span>    BOOST_CHECK_SMALL(volLowerStrike - volLowerExtrapStrike, tol);</div>
<div class="line"><span class="lineno">  669</span> </div>
<div class="line"><span class="lineno">  670</span>    Real upperStrike = 1.5 * futurePrice;</div>
<div class="line"><span class="lineno">  671</span>    <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a1dd3178717c03aef7d6851a3dfd92207ad4192ca9679d38110983141b896eebbf">Volatility</a> volUpperStrike = vts-&gt;blackVol(optionExpiry, upperStrike);</div>
<div class="line"><span class="lineno">  672</span>    <a class="code hl_enumvalue" href="namespaceore_1_1data.html#a1dd3178717c03aef7d6851a3dfd92207ad4192ca9679d38110983141b896eebbf">Volatility</a> volUpperExtrapStrike = vts-&gt;blackVol(optionExpiry, upperStrike * 2.0);</div>
<div class="line"><span class="lineno">  673</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;The two upper strike extrapolated volatilities are: &quot;</span></div>
<div class="line"><span class="lineno">  674</span>                       &lt;&lt; fixed &lt;&lt; setprecision(12) &lt;&lt; volUpperStrike &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; volUpperExtrapStrike &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><span class="lineno">  675</span>    BOOST_CHECK_SMALL(volUpperStrike - volUpperExtrapStrike, tol);</div>
<div class="line"><span class="lineno">  676</span>}</div>
</div><!-- fragment --><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="test_2commodityvolcurve_8cpp_abc646673a48ac9d2a9b57e0c54250195_cgraph.svg" width="624" height="386"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a6f750495eebfc246acfa03ade4e1c041" name="a6f750495eebfc246acfa03ade4e1c041"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f750495eebfc246acfa03ade4e1c041">&#9670;&#160;</a></span>BOOST_DATA_TEST_CASE() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_DATA_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCommodityApoSurface&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bdata::make(<a class="el" href="test_2commodityvolcurve_8cpp.html#a03bf183dfd69eb1c21370c8f30d9de68">asofDates</a>)&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">asof&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2commodityvolcurve_8cpp_source.html#l00678">678</a> of file <a class="el" href="test_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  678</span>                                                                          {</div>
<div class="line"><span class="lineno">  679</span> </div>
<div class="line"><span class="lineno">  680</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing commodity volatility forward moneyness surface building&quot;</span>);</div>
<div class="line"><span class="lineno">  681</span> </div>
<div class="line"><span class="lineno">  682</span>    Settings::instance().evaluationDate() = asof;</div>
<div class="line"><span class="lineno">  683</span> </div>
<div class="line"><span class="lineno">  684</span>    <span class="keywordtype">string</span> fixingsFile = <span class="stringliteral">&quot;fixings_&quot;</span> + <a class="code hl_function" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">to_string</a>(io::iso_date(asof)) + <span class="stringliteral">&quot;.txt&quot;</span>;</div>
<div class="line"><span class="lineno">  685</span>    <span class="keyword">auto</span> todaysMarket = createTodaysMarket(asof, <span class="stringliteral">&quot;apo_surface&quot;</span>, <span class="stringliteral">&quot;curveconfig.xml&quot;</span>, <span class="stringliteral">&quot;market.txt&quot;</span>, fixingsFile);</div>
<div class="line"><span class="lineno">  686</span> </div>
<div class="line"><span class="lineno">  687</span>    <span class="comment">// Get the built commodity volatility surface</span></div>
<div class="line"><span class="lineno">  688</span>    <span class="keyword">auto</span> vts = todaysMarket-&gt;commodityVolatility(<span class="stringliteral">&quot;NYMEX:FF&quot;</span>);</div>
<div class="line"><span class="lineno">  689</span> </div>
<div class="line"><span class="lineno">  690</span>    <span class="comment">// Tolerance for float comparison</span></div>
<div class="line"><span class="lineno">  691</span>    Real tol = 1e-12;</div>
<div class="line"><span class="lineno">  692</span> </div>
<div class="line"><span class="lineno">  693</span>    <span class="comment">// Read in the expected on-grid results for the given date.</span></div>
<div class="line"><span class="lineno">  694</span>    <span class="keywordtype">string</span> filename = <span class="stringliteral">&quot;apo_surface/expected_grid_&quot;</span> + <a class="code hl_function" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">to_string</a>(io::iso_date(asof)) + <span class="stringliteral">&quot;.csv&quot;</span>;</div>
<div class="line"><span class="lineno">  695</span>    <a class="code hl_class" href="classore_1_1data_1_1_c_s_v_file_reader.html">CSVFileReader</a> reader(TEST_INPUT_FILE(filename), <span class="keyword">true</span>, <span class="stringliteral">&quot;,&quot;</span>);</div>
<div class="line"><span class="lineno">  696</span>    BOOST_REQUIRE_EQUAL(reader.numberOfColumns(), 3);</div>
<div class="line"><span class="lineno">  697</span> </div>
<div class="line"><span class="lineno">  698</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;exp_vol,calc_vol,difference&quot;</span>);</div>
<div class="line"><span class="lineno">  699</span>    <span class="keywordflow">while</span> (reader.next()) {</div>
<div class="line"><span class="lineno">  700</span> </div>
<div class="line"><span class="lineno">  701</span>        <span class="comment">// Get the expected expiry date, strike and volatility grid point</span></div>
<div class="line"><span class="lineno">  702</span>        Date expiryDate = <a class="code hl_function" href="group__utilities.html#ga59b5fdda574d90facae95dec2d13040d">parseDate</a>(reader.get(0));</div>
<div class="line"><span class="lineno">  703</span>        Real strike = <a class="code hl_function" href="group__utilities.html#gad1db2a68f9a73667c3b4084d63955bdd">parseReal</a>(reader.get(1));</div>
<div class="line"><span class="lineno">  704</span>        Real volatility = <a class="code hl_function" href="group__utilities.html#gad1db2a68f9a73667c3b4084d63955bdd">parseReal</a>(reader.get(2));</div>
<div class="line"><span class="lineno">  705</span> </div>
<div class="line"><span class="lineno">  706</span>        <span class="comment">// Check the surface on the grid point.</span></div>
<div class="line"><span class="lineno">  707</span>        <span class="keyword">auto</span> calcVolatility = vts-&gt;blackVol(expiryDate, strike);</div>
<div class="line"><span class="lineno">  708</span>        <span class="keyword">auto</span> difference = volatility - calcVolatility;</div>
<div class="line"><span class="lineno">  709</span>        BOOST_TEST_MESSAGE(std::fixed &lt;&lt; std::setprecision(12) &lt;&lt; strike &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; volatility &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; calcVolatility</div>
<div class="line"><span class="lineno">  710</span>                                      &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; difference);</div>
<div class="line"><span class="lineno">  711</span>        BOOST_CHECK_SMALL(difference, tol);</div>
<div class="line"><span class="lineno">  712</span>    }</div>
<div class="line"><span class="lineno">  713</span>}</div>
</div><!-- fragment --><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="test_2commodityvolcurve_8cpp_a6f750495eebfc246acfa03ade4e1c041_cgraph.svg" width="624" height="386"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a020df78606b2b7a7f1ff9d89a1d1f9cd" name="a020df78606b2b7a7f1ff9d89a1d1f9cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a020df78606b2b7a7f1ff9d89a1d1f9cd">&#9670;&#160;</a></span>BOOST_AUTO_TEST_CASE() <span class="overload">[8/8]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOST_AUTO_TEST_CASE </td>
          <td>(</td>
          <td class="paramtype">testCommodityVolSurfaceMyrCrudePalmOil&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2commodityvolcurve_8cpp_source.html#l00716">716</a> of file <a class="el" href="test_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  716</span>                                                             {</div>
<div class="line"><span class="lineno">  717</span> </div>
<div class="line"><span class="lineno">  718</span>    BOOST_TEST_MESSAGE(<span class="stringliteral">&quot;Testing commodity volatility delta surface building for MYR Crude Palm Oil&quot;</span>);</div>
<div class="line"><span class="lineno">  719</span> </div>
<div class="line"><span class="lineno">  720</span>    Date asof(14, Oct, 2020);</div>
<div class="line"><span class="lineno">  721</span>    <span class="keyword">auto</span> todaysMarket = createTodaysMarket(asof, <span class="stringliteral">&quot;myr_crude_palm_oil&quot;</span>, <span class="stringliteral">&quot;curveconfig.xml&quot;</span>, <span class="stringliteral">&quot;market.txt&quot;</span>);</div>
<div class="line"><span class="lineno">  722</span> </div>
<div class="line"><span class="lineno">  723</span>    <span class="comment">// Get the built commodity volatility surface</span></div>
<div class="line"><span class="lineno">  724</span>    <span class="keyword">auto</span> vts = todaysMarket-&gt;commodityVolatility(<span class="stringliteral">&quot;XKLS:FCPO&quot;</span>);</div>
<div class="line"><span class="lineno">  725</span> </div>
<div class="line"><span class="lineno">  726</span>    <span class="comment">// Check that it built ok i.e. can query a volatility.</span></div>
<div class="line"><span class="lineno">  727</span>    BOOST_CHECK_NO_THROW(vts-&gt;blackVol(1.0, 2800));</div>
<div class="line"><span class="lineno">  728</span> </div>
<div class="line"><span class="lineno">  729</span>    <span class="comment">// Cast to expected type and check that it succeeds</span></div>
<div class="line"><span class="lineno">  730</span>    <span class="comment">// For some reason, todaysmarket wraps the surface built in CommodityVolCurve in a BlackVolatilityWithATM.</span></div>
<div class="line"><span class="lineno">  731</span>    <span class="keyword">auto</span> bvwa = dynamic_pointer_cast&lt;BlackVolatilityWithATM&gt;(*vts);</div>
<div class="line"><span class="lineno">  732</span>    BOOST_REQUIRE(bvwa);</div>
<div class="line"><span class="lineno">  733</span>    <span class="keyword">auto</span> bvsd = QuantLib::ext::dynamic_pointer_cast&lt;BlackVolatilitySurfaceDelta&gt;(bvwa-&gt;surface());</div>
<div class="line"><span class="lineno">  734</span>    BOOST_REQUIRE(bvsd);</div>
<div class="line"><span class="lineno">  735</span> </div>
<div class="line"><span class="lineno">  736</span>    <span class="comment">// Now check that the surface dates are as expected.</span></div>
<div class="line"><span class="lineno">  737</span> </div>
<div class="line"><span class="lineno">  738</span>    <span class="comment">// Calculated surface dates.</span></div>
<div class="line"><span class="lineno">  739</span>    <span class="keyword">const</span> vector&lt;Date&gt;&amp; surfaceDates = bvsd-&gt;dates();</div>
<div class="line"><span class="lineno">  740</span> </div>
<div class="line"><span class="lineno">  741</span>    <span class="comment">// Read in the expected dates.</span></div>
<div class="line"><span class="lineno">  742</span>    vector&lt;Date&gt; expectedDates;</div>
<div class="line"><span class="lineno">  743</span>    <span class="keywordtype">string</span> filename = <span class="stringliteral">&quot;myr_crude_palm_oil/expected_expiries.csv&quot;</span>;</div>
<div class="line"><span class="lineno">  744</span>    <a class="code hl_class" href="classore_1_1data_1_1_c_s_v_file_reader.html">CSVFileReader</a> reader(TEST_INPUT_FILE(filename), <span class="keyword">true</span>, <span class="stringliteral">&quot;,&quot;</span>);</div>
<div class="line"><span class="lineno">  745</span>    BOOST_REQUIRE_EQUAL(reader.numberOfColumns(), 1);</div>
<div class="line"><span class="lineno">  746</span>    <span class="keywordflow">while</span> (reader.next()) {</div>
<div class="line"><span class="lineno">  747</span>        expectedDates.push_back(<a class="code hl_function" href="group__utilities.html#ga59b5fdda574d90facae95dec2d13040d">parseDate</a>(reader.get(0)));</div>
<div class="line"><span class="lineno">  748</span>    }</div>
<div class="line"><span class="lineno">  749</span> </div>
<div class="line"><span class="lineno">  750</span>    <span class="comment">// Check equal.</span></div>
<div class="line"><span class="lineno">  751</span>    BOOST_CHECK_EQUAL_COLLECTIONS(surfaceDates.begin(), surfaceDates.end(), expectedDates.begin(), expectedDates.end());</div>
<div class="line"><span class="lineno">  752</span>}</div>
</div><!-- fragment --><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="test_2commodityvolcurve_8cpp_a020df78606b2b7a7f1ff9d89a1d1f9cd_cgraph.svg" width="624" height="263"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a03bf183dfd69eb1c21370c8f30d9de68" name="a03bf183dfd69eb1c21370c8f30d9de68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03bf183dfd69eb1c21370c8f30d9de68">&#9670;&#160;</a></span>asofDates</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt;Date&gt; asofDates {Date(13, Jan, 2020), Date(15, Jan, 2020)}</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2commodityvolcurve_8cpp_source.html#l00522">522</a> of file <a class="el" href="test_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>

</div>
</div>
<a id="a96a582300d10244c7df851066de48438" name="a96a582300d10244c7df851066de48438"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96a582300d10244c7df851066de48438">&#9670;&#160;</a></span>curveConfigs</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt;string&gt; curveConfigs {&quot;curveconfig_explicit_expiries.xml&quot;, &quot;curveconfig_wildcard_expiries.xml&quot;}</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="test_2commodityvolcurve_8cpp_source.html#l00525">525</a> of file <a class="el" href="test_2commodityvolcurve_8cpp_source.html">commodityvolcurve.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.9.5
</small></address>
</body>
</html>
