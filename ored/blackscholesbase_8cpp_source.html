<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<title>OREData: ored/scripting/models/blackscholesbase.cpp Source File</title>
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Open+Sans" rel="stylesheet">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/png" href="favicon.png">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="oredextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname"><a href="https://rkapl123.github.io/OREAnnotatedSource/">
       <img src="logo-data@2x.png" alt="Logo" width="150" height="68" style="float: left; padding: 15px;"/></a>
   <div id="projectbrief">Fully annotated reference manual - version 1.8.12</div>
   </div>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_3e56cb31e3027d5bae8796cb64b50d07.html">ored</a></li><li class="navelem"><a class="el" href="dir_5ec8a1e1d14eaa47b1b0e648274be507.html">scripting</a></li><li class="navelem"><a class="el" href="dir_f42446cc52b32b57df5f03cb32d31df7.html">models</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">blackscholesbase.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="blackscholesbase_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> Copyright (C) 2019 Quaternion Risk Management Ltd</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> All rights reserved.</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"></span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> This file is part of ORE, a free-software/open-source library</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> for transparent pricing and risk analysis - http://opensourcerisk.org</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"></span> </div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment"> ORE is free software: you can redistribute it and/or modify it</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment"> under the terms of the Modified BSD License.  You should have received a</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment"> copy of the license along with this program.</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment"> The license is also available online at &lt;http://opensourcerisk.org&gt;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment"></span> </div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment"> This program is distributed on the basis that it will form a useful</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"> contribution to risk analytics and model standardisation, but WITHOUT</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment"> ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment"> FITNESS FOR A PARTICULAR PURPOSE. See the license for more details.</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment">*/</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span> </div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &lt;<a class="code" href="blackscholesbase_8hpp.html">ored/scripting/models/blackscholesbase.hpp</a>&gt;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &lt;<a class="codeRef" href="../qle/randomvariablelsmbasissystem_8hpp.html">qle/math/randomvariablelsmbasissystem.hpp</a>&gt;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span> </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &lt;<a class="code" href="indexparser_8hpp.html">ored/utilities/indexparser.hpp</a>&gt;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &lt;<a class="code" href="to__string_8hpp.html">ored/utilities/to_string.hpp</a>&gt;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span> </div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &lt;<a class="codeRef" href="../qle/averageonindexedcoupon_8hpp.html">qle/cashflows/averageonindexedcoupon.hpp</a>&gt;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &lt;<a class="codeRef" href="../qle/averageonindexedcouponpricer_8hpp.html">qle/cashflows/averageonindexedcouponpricer.hpp</a>&gt;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &lt;<a class="codeRef" href="../qle/overnightindexedcoupon_8hpp.html">qle/cashflows/overnightindexedcoupon.hpp</a>&gt;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span> </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &lt;ql/math/comparison.hpp&gt;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &lt;ql/quotes/simplequote.hpp&gt;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span> </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceore.html">ore</a> {</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="keyword">namespace </span><a class="code hl_enumvalue" href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a> {</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span> </div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespace_quant_lib.html">QuantLib</a>;</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespace_quant_ext.html">QuantExt</a>;</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span> </div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#a659ef5ae0ddbff22ed9bca52c174f552">   39</a></span><a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#aa901a14e051e92c78560e640eda098ed">BlackScholesBase::BlackScholesBase</a>(<span class="keyword">const</span> Size paths, <span class="keyword">const</span> std::string&amp; currency,</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>                                   <span class="keyword">const</span> Handle&lt;YieldTermStructure&gt;&amp; curve, <span class="keyword">const</span> std::string&amp; index,</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>                                   <span class="keyword">const</span> std::string&amp; indexCurrency, <span class="keyword">const</span> Handle&lt;BlackScholesModelWrapper&gt;&amp; model,</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>                                   <span class="keyword">const</span> <a class="code hl_struct" href="structore_1_1data_1_1_model_1_1_mc_params.html">Model::McParams</a>&amp; mcParams, <span class="keyword">const</span> std::set&lt;Date&gt;&amp; simulationDates,</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>                                   <span class="keyword">const</span> <a class="code hl_class" href="classore_1_1data_1_1_ibor_fallback_config.html">IborFallbackConfig</a>&amp; iborFallbackConfig)</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>    : <a class="code hl_class" href="classore_1_1data_1_1_black_scholes_base.html">BlackScholesBase</a>(paths, {currency}, {curve}, {}, {}, {}, {index}, {indexCurrency}, model, {}, mcParams,</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>                       simulationDates, iborFallbackConfig) {}</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span> </div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#aa901a14e051e92c78560e640eda098ed">   47</a></span><a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#aa901a14e051e92c78560e640eda098ed">BlackScholesBase::BlackScholesBase</a>(</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>    <span class="keyword">const</span> Size paths, <span class="keyword">const</span> std::vector&lt;std::string&gt;&amp; currencies, <span class="keyword">const</span> std::vector&lt;Handle&lt;YieldTermStructure&gt;&gt;&amp; curves,</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>    <span class="keyword">const</span> std::vector&lt;Handle&lt;Quote&gt;&gt;&amp; fxSpots,</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>    <span class="keyword">const</span> std::vector&lt;std::pair&lt;std::string, QuantLib::ext::shared_ptr&lt;InterestRateIndex&gt;&gt;&gt;&amp; irIndices,</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    <span class="keyword">const</span> std::vector&lt;std::pair&lt;std::string, QuantLib::ext::shared_ptr&lt;ZeroInflationIndex&gt;&gt;&gt;&amp; infIndices,</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>    <span class="keyword">const</span> std::vector&lt;std::string&gt;&amp; indices, <span class="keyword">const</span> std::vector&lt;std::string&gt;&amp; indexCurrencies,</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    <span class="keyword">const</span> Handle&lt;BlackScholesModelWrapper&gt;&amp; model,</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    <span class="keyword">const</span> std::map&lt;std::pair&lt;std::string, std::string&gt;, Handle&lt;QuantExt::CorrelationTermStructure&gt;&gt;&amp; correlations,</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structore_1_1data_1_1_model_1_1_mc_params.html">Model::McParams</a>&amp; mcParams, <span class="keyword">const</span> std::set&lt;Date&gt;&amp; simulationDates,</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    <span class="keyword">const</span> <a class="code hl_class" href="classore_1_1data_1_1_ibor_fallback_config.html">IborFallbackConfig</a>&amp; iborFallbackConfig)</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>    : <a class="code hl_class" href="classore_1_1data_1_1_model_impl.html">ModelImpl</a>(curves.at(0)-&gt;dayCounter(), paths, currencies, irIndices, infIndices, indices, indexCurrencies,</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>                simulationDates, iborFallbackConfig),</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>      curves_(curves), fxSpots_(fxSpots), <a class="code hl_variable" href="computationgraphbuilder_8cpp.html#aed320df30b396f762682cba8e5e1b736">model_</a>(model), <a class="code hl_variable" href="blackscholescg_8cpp.html#aa842cc62b4fc38f8bf8f022be3504f03">correlations_</a>(correlations), mcParams_(mcParams) {</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    <span class="comment">// check inputs</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span> </div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    QL_REQUIRE(!<a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#ab695da1eaa09dc5436c91089c0888f59">model_</a>.empty(), <span class="stringliteral">&quot;model is empty&quot;</span>);</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    QL_REQUIRE(!<a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#af9092b7d1618dd9a9092dc9dae37ea75">curves_</a>.empty(), <span class="stringliteral">&quot;no curves given&quot;</span>);</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    QL_REQUIRE(<a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a14efd0665cded9d6785314f26306e91b">currencies_</a>.size() == <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#af9092b7d1618dd9a9092dc9dae37ea75">curves_</a>.size(), <span class="stringliteral">&quot;number of currencies (&quot;</span> &lt;&lt; <a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a14efd0665cded9d6785314f26306e91b">currencies_</a>.size()</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>                                                                              &lt;&lt; <span class="stringliteral">&quot;) does not match number of curves (&quot;</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>                                                                              &lt;&lt; <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#af9092b7d1618dd9a9092dc9dae37ea75">curves_</a>.size() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    QL_REQUIRE(<a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a14efd0665cded9d6785314f26306e91b">currencies_</a>.size() == <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#aaf8a64586eb5db2781e2ba5c0597041f">fxSpots_</a>.size() + 1,</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>               <span class="stringliteral">&quot;number of currencies (&quot;</span> &lt;&lt; <a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a14efd0665cded9d6785314f26306e91b">currencies_</a>.size() &lt;&lt; <span class="stringliteral">&quot;) does not match number of fx spots (&quot;</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>                                        &lt;&lt; <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#aaf8a64586eb5db2781e2ba5c0597041f">fxSpots_</a>.size() &lt;&lt; <span class="stringliteral">&quot;) + 1&quot;</span>);</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span> </div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    QL_REQUIRE(<a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">indices_</a>.size() == <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#ab695da1eaa09dc5436c91089c0888f59">model_</a>-&gt;processes().size(),</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>               <span class="stringliteral">&quot;mismatch of processes size (&quot;</span> &lt;&lt; <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#ab695da1eaa09dc5436c91089c0888f59">model_</a>-&gt;processes().size() &lt;&lt; <span class="stringliteral">&quot;) and number of indices (&quot;</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>                                              &lt;&lt; <a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">indices_</a>.size() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span> </div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    <span class="comment">// register with observables</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span> </div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; o : <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#aaf8a64586eb5db2781e2ba5c0597041f">fxSpots_</a>)</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>        registerWith(o);</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; o : <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#aeb5929f7ce6e2d52f420ca71b7caaae1">correlations_</a>)</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>        registerWith(o.second);</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span> </div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    registerWith(<a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#ab695da1eaa09dc5436c91089c0888f59">model_</a>);</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span> </div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>} <span class="comment">// BlackScholesBase ctor</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span> </div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#afa6dbc82775f93a3bb6b225320c8e685">   87</a></span>Matrix <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#afa6dbc82775f93a3bb6b225320c8e685">BlackScholesBase::getCorrelation</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    Matrix correlation(<a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">indices_</a>.size(), <a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">indices_</a>.size(), 0.0);</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; <a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">indices_</a>.size(); ++i)</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>        correlation[i][i] = 1.0;</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; c : <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#aeb5929f7ce6e2d52f420ca71b7caaae1">correlations_</a>) {</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>        <a class="code hl_class" href="classore_1_1data_1_1_index_info.html">IndexInfo</a> inf1(c.first.first), inf2(c.first.second);</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>        <span class="keyword">auto</span> ind1 = std::find(<a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">indices_</a>.begin(), <a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">indices_</a>.end(), inf1);</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>        <span class="keyword">auto</span> ind2 = std::find(<a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">indices_</a>.begin(), <a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">indices_</a>.end(), inf2);</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>        <span class="keywordflow">if</span> (ind1 != <a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">indices_</a>.end() &amp;&amp; ind2 != <a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">indices_</a>.end()) {</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>            <span class="comment">// EQ, FX, COMM index</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>            Size i1 = std::distance(<a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">indices_</a>.begin(), ind1);</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>            Size i2 = std::distance(<a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">indices_</a>.begin(), ind2);</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>            correlation[i1][i2] = correlation[i2][i1] = c.second-&gt;correlation(0.0); <span class="comment">// we assume a constant correlation!</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>        }</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    }</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;BlackScholesBase correlation matrix:&quot;</span>);</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    <a class="code hl_define" href="log_8hpp.html#af89b5b8c4f598a066ffe6eddd697a46d">DLOGGERSTREAM</a>(correlation);</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    <span class="keywordflow">return</span> correlation;</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>}</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span> </div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#a5ce8b0af276b7c06ab424e688ae2d318">  107</a></span><span class="keyword">const</span> Date&amp; <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a5ce8b0af276b7c06ab424e688ae2d318">BlackScholesBase::referenceDate</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    calculate();</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a>;</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>}</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#a1127cccc9668a02247dc139d27121708">  112</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a1127cccc9668a02247dc139d27121708">BlackScholesBase::performCalculations</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span> </div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    QL_REQUIRE(!<a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#aec271be46c547c89cd27b4d9c811a37d">inTrainingPhase_</a>,</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>               <span class="stringliteral">&quot;BlackScholesBase::performCalculations(): state inTrainingPhase should be false, this was &quot;</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>               <span class="stringliteral">&quot;not resetted appropriately.&quot;</span>);</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a3e22290961d6b56dce069c1c4fda6386">referenceDate_</a> = <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#af9092b7d1618dd9a9092dc9dae37ea75">curves_</a>.front()-&gt;referenceDate();</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span> </div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    <span class="comment">// set up time grid</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span> </div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a9356ce4490b329fbfbad73fa28841898">effectiveSimulationDates_</a> = <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#ab695da1eaa09dc5436c91089c0888f59">model_</a>-&gt;effectiveSimulationDates();</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span> </div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    std::vector&lt;Real&gt; times;</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; d : <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a9356ce4490b329fbfbad73fa28841898">effectiveSimulationDates_</a>) {</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>        times.push_back(<a class="code hl_function" href="classore_1_1data_1_1_model.html#a6fead1da49affdddae755f95d693c4f3">timeFromReference</a>(d));</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    }</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span> </div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#adda5ae6c670bdbb1857509a4aa20ec25">timeGrid_</a> = <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#ab695da1eaa09dc5436c91089c0888f59">model_</a>-&gt;discretisationTimeGrid();</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#af9be63a7f055dbb0ed0fc95090d92e87">positionInTimeGrid_</a>.resize(times.size());</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <span class="keywordflow">for</span> (Size i = 0; i &lt; <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#af9be63a7f055dbb0ed0fc95090d92e87">positionInTimeGrid_</a>.size(); ++i)</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>        <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#af9be63a7f055dbb0ed0fc95090d92e87">positionInTimeGrid_</a>[i] = <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#adda5ae6c670bdbb1857509a4aa20ec25">timeGrid_</a>.index(times[i]);</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span> </div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a8d84524f3d537eadc02dbca5ec4826f5">underlyingPaths_</a>.clear();</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a5e67018fb05525c8b8a040d102e98564">underlyingPathsTraining_</a>.clear();</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>}</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span> </div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#ac2531b45af9259f8b3af891fac9f5d03">  138</a></span><a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a> <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#ac2531b45af9259f8b3af891fac9f5d03">BlackScholesBase::getIndexValue</a>(<span class="keyword">const</span> Size indexNo, <span class="keyword">const</span> Date&amp; d, <span class="keyword">const</span> Date&amp; fwd)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    Date effFwd = fwd;</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">indices_</a>[indexNo].isComm()) {</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>        Date expiry = <a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">indices_</a>[indexNo].comm(d)-&gt;expiryDate();</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>        <span class="comment">// if a future is referenced we set the forward date effectively used below to the future&#39;s expiry date</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>        <span class="keywordflow">if</span> (expiry != Date())</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>            effFwd = expiry;</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>        <span class="comment">// if the future expiry is past the obsdate, we return the spot as of the obsdate, i.e. we</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>        <span class="comment">// freeze the future value after its expiry, but keep it available for observation</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>        <span class="comment">// TOOD should we throw an exception instead?</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>        effFwd = std::max(effFwd, d);</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    }</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    QL_REQUIRE(<a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a8d84524f3d537eadc02dbca5ec4826f5">underlyingPaths_</a>.find(d) != <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a8d84524f3d537eadc02dbca5ec4826f5">underlyingPaths_</a>.end(), <span class="stringliteral">&quot;did not find path for &quot;</span> &lt;&lt; d);</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    <span class="keyword">auto</span> res = <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a8d84524f3d537eadc02dbca5ec4826f5">underlyingPaths_</a>.at(d).at(indexNo);</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    <span class="comment">// compute forwarding factor</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    <span class="keywordflow">if</span> (effFwd != Null&lt;Date&gt;()) {</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>        <span class="keyword">auto</span> p = <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#ab695da1eaa09dc5436c91089c0888f59">model_</a>-&gt;processes().at(indexNo);</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>        res *= <a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a>(<a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a22f414d57ba9b94e5696ae6fb61352a2">size</a>(), p-&gt;dividendYield()-&gt;discount(effFwd) / p-&gt;dividendYield()-&gt;discount(d) /</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>                                          (p-&gt;riskFreeRate()-&gt;discount(effFwd) / p-&gt;riskFreeRate()-&gt;discount(d)));</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    }</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    <span class="keywordflow">return</span> res;</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>}</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span> </div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#a31ea941e2c5742d1de925abc758a422e">  161</a></span><a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a> <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a31ea941e2c5742d1de925abc758a422e">BlackScholesBase::getIrIndexValue</a>(<span class="keyword">const</span> Size indexNo, <span class="keyword">const</span> Date&amp; d, <span class="keyword">const</span> Date&amp; fwd)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    Date effFixingDate = d;</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>    <span class="keywordflow">if</span> (fwd != Null&lt;Date&gt;())</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>        effFixingDate = fwd;</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    <span class="comment">// ensure a valid fixing date</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    effFixingDate = <a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#aa91202692df7316a0cee91b39edf9ff8">irIndices_</a>.at(indexNo).second-&gt;fixingCalendar().adjust(effFixingDate);</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    <span class="keywordflow">return</span> <a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a>(<a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a22f414d57ba9b94e5696ae6fb61352a2">size</a>(), <a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#aa91202692df7316a0cee91b39edf9ff8">irIndices_</a>.at(indexNo).second-&gt;fixing(effFixingDate));</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>}</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span> </div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#a0e7b4b054beda325e75ce61b56405d20">  170</a></span><a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a> <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a0e7b4b054beda325e75ce61b56405d20">BlackScholesBase::getInfIndexValue</a>(<span class="keyword">const</span> Size indexNo, <span class="keyword">const</span> Date&amp; d, <span class="keyword">const</span> Date&amp; fwd)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    Date effFixingDate = d;</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    <span class="keywordflow">if</span> (fwd != Null&lt;Date&gt;())</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>        effFixingDate = fwd;</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>    <span class="keywordflow">return</span> <a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a>(<a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a22f414d57ba9b94e5696ae6fb61352a2">size</a>(), <a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#a4e8d617c4ada27621326891fa7fa009f">infIndices_</a>.at(indexNo).second-&gt;fixing(effFixingDate));</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>}</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span><span class="keyword">struct </span>comp {</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    comp(<span class="keyword">const</span> std::string&amp; indexInput) : <a class="code hl_variable" href="blackscholes_8cpp.html#a8051603eb6af9788531ccaeb8d2ac103">indexInput_</a>(indexInput) {}</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> std::pair&lt;<a class="code hl_class" href="classore_1_1data_1_1_index_info.html">IndexInfo</a>, QuantLib::ext::shared_ptr&lt;T&gt;&gt;&amp; p)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>        <span class="keywordflow">return</span> p.first.name() == <a class="code hl_variable" href="blackscholes_8cpp.html#a8051603eb6af9788531ccaeb8d2ac103">indexInput_</a>;</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    }</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno"><a class="line" href="blackscholesbase_8cpp.html#a8051603eb6af9788531ccaeb8d2ac103">  183</a></span>    <span class="keyword">const</span> std::string <a class="code hl_variable" href="blackscholes_8cpp.html#a8051603eb6af9788531ccaeb8d2ac103">indexInput_</a>;</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>};</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>} <span class="comment">// namespace</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span> </div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#aef2fa78219e2206833d4d8f63bf20a70">  187</a></span><a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a> <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#aef2fa78219e2206833d4d8f63bf20a70">BlackScholesBase::fwdCompAvg</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> isAvg, <span class="keyword">const</span> std::string&amp; indexInput, <span class="keyword">const</span> Date&amp; obsdate,</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>                                            <span class="keyword">const</span> Date&amp; start, <span class="keyword">const</span> Date&amp; end, <span class="keyword">const</span> Real spread, <span class="keyword">const</span> Real gearing,</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>                                            <span class="keyword">const</span> Integer lookback, <span class="keyword">const</span> Natural rateCutoff, <span class="keyword">const</span> Natural fixingDays,</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>                                            <span class="keyword">const</span> <span class="keywordtype">bool</span> includeSpread, <span class="keyword">const</span> Real cap, <span class="keyword">const</span> Real floor,</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>                                            <span class="keyword">const</span> <span class="keywordtype">bool</span> nakedOption, <span class="keyword">const</span> <span class="keywordtype">bool</span> localCapFloor)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    calculate();</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <span class="keyword">auto</span> index = std::find_if(<a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#aa91202692df7316a0cee91b39edf9ff8">irIndices_</a>.begin(), <a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#aa91202692df7316a0cee91b39edf9ff8">irIndices_</a>.end(), comp(indexInput));</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    QL_REQUIRE(index != <a class="code hl_variable" href="classore_1_1data_1_1_model_impl.html#aa91202692df7316a0cee91b39edf9ff8">irIndices_</a>.end(),</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>               <span class="stringliteral">&quot;BlackScholesBase::fwdCompAvg(): did not find ir index &quot;</span> &lt;&lt; indexInput &lt;&lt; <span class="stringliteral">&quot; - this is unexpected.&quot;</span>);</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    <span class="keyword">auto</span> on = QuantLib::ext::dynamic_pointer_cast&lt;OvernightIndex&gt;(index-&gt;second);</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    QL_REQUIRE(on, <span class="stringliteral">&quot;BlackScholesBase::fwdCompAvg(): expected on index for &quot;</span> &lt;&lt; indexInput);</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    <span class="comment">// if we want to support cap / floors we need the OIS CF surface</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    QL_REQUIRE(cap &gt; 999998.0 &amp;&amp; floor &lt; -999998.0,</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>               <span class="stringliteral">&quot;BlackScholesBase:fwdCompAvg(): cap (&quot;</span> &lt;&lt; cap &lt;&lt; <span class="stringliteral">&quot;) / floor (&quot;</span> &lt;&lt; floor &lt;&lt; <span class="stringliteral">&quot;) not supported&quot;</span>);</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    QuantLib::ext::shared_ptr&lt;QuantLib::FloatingRateCoupon&gt; coupon;</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    QuantLib::ext::shared_ptr&lt;QuantLib::FloatingRateCouponPricer&gt; pricer;</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    <span class="keywordflow">if</span> (isAvg) {</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>        coupon = QuantLib::ext::make_shared&lt;QuantExt::AverageONIndexedCoupon&gt;(</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>            end, 1.0, start, end, on, gearing, spread, rateCutoff, on-&gt;dayCounter(), lookback * Days, fixingDays);</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>        pricer = QuantLib::ext::make_shared&lt;AverageONIndexedCouponPricer&gt;();</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>        coupon = QuantLib::ext::make_shared&lt;QuantExt::OvernightIndexedCoupon&gt;(end, 1.0, start, end, on, gearing, spread, Date(),</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>                                                                      Date(), on-&gt;dayCounter(), <span class="keyword">false</span>, includeSpread,</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>                                                                      lookback * Days, rateCutoff, fixingDays);</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>        pricer = QuantLib::ext::make_shared&lt;OvernightIndexedCouponPricer&gt;();</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    }</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    coupon-&gt;setPricer(pricer);</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    <span class="keywordflow">return</span> <a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a>(<a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a22f414d57ba9b94e5696ae6fb61352a2">size</a>(), coupon-&gt;rate());</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>}</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span> </div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#abb84774b08d6924094481e3ed5821a8d">  217</a></span><a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a> <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#abb84774b08d6924094481e3ed5821a8d">BlackScholesBase::getDiscount</a>(<span class="keyword">const</span> Size idx, <span class="keyword">const</span> Date&amp; s, <span class="keyword">const</span> Date&amp; t)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    <span class="keywordflow">return</span> <a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a>(<a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a22f414d57ba9b94e5696ae6fb61352a2">size</a>(), <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#af9092b7d1618dd9a9092dc9dae37ea75">curves_</a>.at(idx)-&gt;discount(t) / <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#af9092b7d1618dd9a9092dc9dae37ea75">curves_</a>.at(idx)-&gt;discount(s));</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>}</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#a698c2421ff0b896c0388b6d6477cd7b6">  221</a></span><a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a> <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a698c2421ff0b896c0388b6d6477cd7b6">BlackScholesBase::getNumeraire</a>(<span class="keyword">const</span> Date&amp; s)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    <span class="keywordflow">return</span> <a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a>(<a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a22f414d57ba9b94e5696ae6fb61352a2">size</a>(), 1.0 / <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#af9092b7d1618dd9a9092dc9dae37ea75">curves_</a>.at(0)-&gt;discount(s));</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>}</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#a3430beef258b2f54144fc121011267e6">  225</a></span>Real <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a3430beef258b2f54144fc121011267e6">BlackScholesBase::getFxSpot</a>(<span class="keyword">const</span> Size idx)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#aaf8a64586eb5db2781e2ba5c0597041f">fxSpots_</a>.at(idx)-&gt;value(); }</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#a32a74f796461167901dcb7df1c74cbba">  227</a></span><a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a> <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a32a74f796461167901dcb7df1c74cbba">BlackScholesBase::npv</a>(<span class="keyword">const</span> <a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a>&amp; amount, <span class="keyword">const</span> Date&amp; obsdate, <span class="keyword">const</span> <a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_filter.html">Filter</a>&amp; <a class="code hl_variable" href="computationgraphbuilder_8cpp.html#abd640cc39af07965a8475be310893006">filter</a>,</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>                                     <span class="keyword">const</span> boost::optional&lt;long&gt;&amp; memSlot, <span class="keyword">const</span> <a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a>&amp; addRegressor1,</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>                                     <span class="keyword">const</span> <a class="code hl_structRef" href="../qle/struct_quant_ext_1_1_random_variable.html">RandomVariable</a>&amp; addRegressor2)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span> </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>    calculate();</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span> </div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    <span class="comment">// short cut, if amount is deterministic and no memslot is given</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span> </div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    <span class="keywordflow">if</span> (amount.<a class="code hl_functionRef" href="../qle/struct_quant_ext_1_1_random_variable.html#a6e0fdc031c26ed1d1a956019d2cee4a1">deterministic</a>() &amp;&amp; !memSlot)</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>        <span class="keywordflow">return</span> amount;</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span> </div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    <span class="comment">// if obsdate is today, take a plain expectation</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span> </div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>    <span class="keywordflow">if</span> (obsdate == <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a5ce8b0af276b7c06ab424e688ae2d318">referenceDate</a>())</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>        <span class="keywordflow">return</span> <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a8c7149e5256e71f377e1810576ac6b4c">expectation</a>(amount);</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span> </div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <span class="comment">// build the state</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span> </div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    std::vector&lt;const RandomVariable*&gt; state;</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span> </div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a8d84524f3d537eadc02dbca5ec4826f5">underlyingPaths_</a>.empty()) {</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; r : <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a8d84524f3d537eadc02dbca5ec4826f5">underlyingPaths_</a>.at(obsdate))</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>            state.push_back(&amp;r);</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    }</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span> </div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>    Size nModelStates = state.size();</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <span class="keywordflow">if</span> (addRegressor1.<a class="code hl_functionRef" href="../qle/struct_quant_ext_1_1_random_variable.html#adaeda39d7b8cc716a40c4da65b00ba77">initialised</a>() &amp;&amp; (memSlot || !addRegressor1.<a class="code hl_functionRef" href="../qle/struct_quant_ext_1_1_random_variable.html#a6e0fdc031c26ed1d1a956019d2cee4a1">deterministic</a>()))</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>        state.push_back(&amp;addRegressor1);</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    <span class="keywordflow">if</span> (addRegressor2.<a class="code hl_functionRef" href="../qle/struct_quant_ext_1_1_random_variable.html#adaeda39d7b8cc716a40c4da65b00ba77">initialised</a>() &amp;&amp; (memSlot || !addRegressor2.<a class="code hl_functionRef" href="../qle/struct_quant_ext_1_1_random_variable.html#a6e0fdc031c26ed1d1a956019d2cee4a1">deterministic</a>()))</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>        state.push_back(&amp;addRegressor2);</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    Size nAddReg = state.size() - nModelStates;</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span> </div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    <span class="comment">// if the state is empty, return the plain expectation (no conditioning)</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span> </div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    <span class="keywordflow">if</span> (state.empty()) {</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>        <span class="keywordflow">return</span> <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a8c7149e5256e71f377e1810576ac6b4c">expectation</a>(amount);</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>    }</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    <span class="comment">// the regression model is given by coefficients and an optional coordinate transform</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span> </div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    Array coeff;</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    Matrix coordinateTransform;</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span> </div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>    <span class="comment">// if a memSlot is given and coefficients / coordinate transform are stored, we use them</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span> </div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    <span class="keywordtype">bool</span> haveStoredModel = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span> </div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    <span class="keywordflow">if</span> (memSlot) {</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>        <span class="keywordflow">if</span> (<span class="keyword">auto</span> it = <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a5dc20065794f26aa93ef3959071b3814">storedRegressionModel_</a>.find(*memSlot); it != <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a5dc20065794f26aa93ef3959071b3814">storedRegressionModel_</a>.end()) {</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>            coeff = std::get&lt;0&gt;(it-&gt;second);</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>            coordinateTransform = std::get&lt;2&gt;(it-&gt;second);</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>            QL_REQUIRE(std::get&lt;1&gt;(it-&gt;second) == state.size(),</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>                       <span class="stringliteral">&quot;BlackScholesBase::npv(): stored regression coefficients at mem slot &quot;</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>                           &lt;&lt; *memSlot &lt;&lt; <span class="stringliteral">&quot; are for state size &quot;</span> &lt;&lt; std::get&lt;1&gt;(it-&gt;second) &lt;&lt; <span class="stringliteral">&quot;, actual state size is &quot;</span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>                           &lt;&lt; state.size() &lt;&lt; <span class="stringliteral">&quot; (before possible coordinate transform).&quot;</span>);</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>            haveStoredModel = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>        }</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>    }</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span> </div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>    <span class="comment">// if we do not have retrieved a model in the previous step, we create it now</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span> </div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    std::vector&lt;RandomVariable&gt; transformedState;</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span> </div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>    <span class="keywordflow">if</span>(!haveStoredModel) {</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span> </div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>        <span class="comment">// factor reduction to reduce dimensionalitty and handle collinearity</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span> </div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a7681fcd6d75035e16931f946f1b84fbc">mcParams_</a>.<a class="code hl_variable" href="structore_1_1data_1_1_model_1_1_mc_params.html#abecddfc422bbe23a7e3bbadc3cfc4077">regressionVarianceCutoff</a> != Null&lt;Real&gt;()) {</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>            coordinateTransform = pcaCoordinateTransform(state, <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a7681fcd6d75035e16931f946f1b84fbc">mcParams_</a>.<a class="code hl_variable" href="structore_1_1data_1_1_model_1_1_mc_params.html#abecddfc422bbe23a7e3bbadc3cfc4077">regressionVarianceCutoff</a>);</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>            transformedState = applyCoordinateTransform(state, coordinateTransform);</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>            state = vec2vecptr(transformedState);</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>        }</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span> </div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>        <span class="comment">// train coefficients</span></div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span> </div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>        coeff = <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#a548cb27798b6f38a502e71240377a255">regressionCoefficients</a>(amount, state,</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>                                       multiPathBasisSystem(state.size(), <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a7681fcd6d75035e16931f946f1b84fbc">mcParams_</a>.<a class="code hl_variable" href="structore_1_1data_1_1_model_1_1_mc_params.html#acd2409cd1ff4c11fd24593d0b4338c75">regressionOrder</a>,</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>                                                            <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a7681fcd6d75035e16931f946f1b84fbc">mcParams_</a>.<a class="code hl_variable" href="structore_1_1data_1_1_model_1_1_mc_params.html#af47330752b982eb481cd9bf41e6444dc">polynomType</a>, std::min(<a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a22f414d57ba9b94e5696ae6fb61352a2">size</a>(), <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#ac41c73ef8085aa5b72bf6009f56011ff">trainingSamples</a>())),</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>                                       <a class="code hl_variable" href="computationgraphbuilder_8cpp.html#abd640cc39af07965a8475be310893006">filter</a>, RandomVariableRegressionMethod::QR);</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>        <a class="code hl_define" href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a>(<span class="stringliteral">&quot;BlackScholesBase::npv(&quot;</span> &lt;&lt; <a class="code hl_function" href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">ore::data::to_string</a>(obsdate) &lt;&lt; <span class="stringliteral">&quot;): regression coefficients are &quot;</span> &lt;&lt; coeff</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>                                      &lt;&lt; <span class="stringliteral">&quot; (got model state size &quot;</span> &lt;&lt; nModelStates &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; nAddReg</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>                                      &lt;&lt; <span class="stringliteral">&quot; additional regressors, coordinate transform &quot;</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>                                      &lt;&lt; coordinateTransform.columns() &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; coordinateTransform.rows() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span> </div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>        <span class="comment">// store model if requried</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>        <span class="keywordflow">if</span> (memSlot) {</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>            <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a5dc20065794f26aa93ef3959071b3814">storedRegressionModel_</a>[*memSlot] = std::make_tuple(coeff, nModelStates, coordinateTransform);</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>        }</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span> </div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span> </div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>        <span class="comment">// apply the stored coordinate transform to the state</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span> </div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>        <span class="keywordflow">if</span>(!coordinateTransform.empty()) {</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>            transformedState = applyCoordinateTransform(state, coordinateTransform);</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>            state = vec2vecptr(transformedState);</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>        }</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>    }</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span> </div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    <span class="comment">// compute conditional expectation and return the result</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span> </div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    <span class="keywordflow">return</span> <a class="code hl_functionRef" href="../qle/namespace_quant_ext.html#aa20ffa6fc84566f721a455a1bb72502b">conditionalExpectation</a>(state,</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>                                  multiPathBasisSystem(state.size(), <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a7681fcd6d75035e16931f946f1b84fbc">mcParams_</a>.<a class="code hl_variable" href="structore_1_1data_1_1_model_1_1_mc_params.html#acd2409cd1ff4c11fd24593d0b4338c75">regressionOrder</a>, <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a7681fcd6d75035e16931f946f1b84fbc">mcParams_</a>.<a class="code hl_variable" href="structore_1_1data_1_1_model_1_1_mc_params.html#af47330752b982eb481cd9bf41e6444dc">polynomType</a>,</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>                                                       std::min(<a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a22f414d57ba9b94e5696ae6fb61352a2">size</a>(), <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#ac41c73ef8085aa5b72bf6009f56011ff">trainingSamples</a>())),</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>                                  coeff);</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>}</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span> </div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#a15aa444a844bc8f8670058816b9dcc0c">  337</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a15aa444a844bc8f8670058816b9dcc0c">BlackScholesBase::releaseMemory</a>() {</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a8d84524f3d537eadc02dbca5ec4826f5">underlyingPaths_</a>.clear();</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>    <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a5e67018fb05525c8b8a040d102e98564">underlyingPathsTraining_</a>.clear();</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>}</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span> </div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#ad48a455c1a5496f2a02cd0640356b86b">  342</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#ad48a455c1a5496f2a02cd0640356b86b">BlackScholesBase::resetNPVMem</a>() { <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a5dc20065794f26aa93ef3959071b3814">storedRegressionModel_</a>.clear(); }</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span> </div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#adf22662f450d61eb77d17f2ea7f4376d">  344</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#adf22662f450d61eb77d17f2ea7f4376d">BlackScholesBase::toggleTrainingPaths</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    std::swap(<a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a8d84524f3d537eadc02dbca5ec4826f5">underlyingPaths_</a>, <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a5e67018fb05525c8b8a040d102e98564">underlyingPathsTraining_</a>);</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#aec271be46c547c89cd27b4d9c811a37d">inTrainingPhase_</a> = !<a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#aec271be46c547c89cd27b4d9c811a37d">inTrainingPhase_</a>;</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>}</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span> </div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#ac41c73ef8085aa5b72bf6009f56011ff">  349</a></span>Size <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#ac41c73ef8085aa5b72bf6009f56011ff">BlackScholesBase::trainingSamples</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a7681fcd6d75035e16931f946f1b84fbc">mcParams_</a>.<a class="code hl_variable" href="structore_1_1data_1_1_model_1_1_mc_params.html#a150e9051900157f9eeb47db76a408ba8">trainingSamples</a>; }</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span> </div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno"><a class="line" href="classore_1_1data_1_1_black_scholes_base.html#a22f414d57ba9b94e5696ae6fb61352a2">  351</a></span>Size <a class="code hl_function" href="classore_1_1data_1_1_black_scholes_base.html#a22f414d57ba9b94e5696ae6fb61352a2">BlackScholesBase::size</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#aec271be46c547c89cd27b4d9c811a37d">inTrainingPhase_</a>)</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="classore_1_1data_1_1_black_scholes_base.html#a7681fcd6d75035e16931f946f1b84fbc">mcParams_</a>.<a class="code hl_variable" href="structore_1_1data_1_1_model_1_1_mc_params.html#a150e9051900157f9eeb47db76a408ba8">trainingSamples</a>;</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classore_1_1data_1_1_model.html#a9edcd102946c4e3bd0bcdba2fc64e397">Model::size</a>();</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>}</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span> </div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>} <span class="comment">// namespace data</span></div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>} <span class="comment">// namespace ore</span></div>
<div class="ttc" id="aaverageonindexedcoupon_8hpp_html"><div class="ttname"><a href="../qle/averageonindexedcoupon_8hpp.html">averageonindexedcoupon.hpp</a></div></div>
<div class="ttc" id="aaverageonindexedcouponpricer_8hpp_html"><div class="ttname"><a href="../qle/averageonindexedcouponpricer_8hpp.html">averageonindexedcouponpricer.hpp</a></div></div>
<div class="ttc" id="ablackscholes_8cpp_html_a8051603eb6af9788531ccaeb8d2ac103"><div class="ttname"><a href="blackscholes_8cpp.html#a8051603eb6af9788531ccaeb8d2ac103">indexInput_</a></div><div class="ttdeci">const std::string indexInput_</div><div class="ttdef"><b>Definition:</b> <a href="blackscholes_8cpp_source.html#l00288">blackscholes.cpp:288</a></div></div>
<div class="ttc" id="ablackscholesbase_8hpp_html"><div class="ttname"><a href="blackscholesbase_8hpp.html">blackscholesbase.hpp</a></div><div class="ttdoc">black scholes model base class for n underlyings (fx, equity or commodity)</div></div>
<div class="ttc" id="ablackscholescg_8cpp_html_aa842cc62b4fc38f8bf8f022be3504f03"><div class="ttname"><a href="blackscholescg_8cpp.html#aa842cc62b4fc38f8bf8f022be3504f03">correlations_</a></div><div class="ttdeci">const std::map&lt; std::pair&lt; std::string, std::string &gt;, Handle&lt; QuantExt::CorrelationTermStructure &gt; &gt; &amp; correlations_</div><div class="ttdef"><b>Definition:</b> <a href="blackscholescg_8cpp_source.html#l00229">blackscholescg.cpp:229</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html">ore::data::BlackScholesBase</a></div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8hpp_source.html#l00039">blackscholesbase.hpp:39</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_a0e7b4b054beda325e75ce61b56405d20"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#a0e7b4b054beda325e75ce61b56405d20">ore::data::BlackScholesBase::getInfIndexValue</a></div><div class="ttdeci">RandomVariable getInfIndexValue(const Size indexNo, const Date &amp;d, const Date &amp;fwd=Null&lt; Date &gt;()) const override</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00170">blackscholesbase.cpp:170</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_a1127cccc9668a02247dc139d27121708"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#a1127cccc9668a02247dc139d27121708">ore::data::BlackScholesBase::performCalculations</a></div><div class="ttdeci">void performCalculations() const override</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00112">blackscholesbase.cpp:112</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_a15aa444a844bc8f8670058816b9dcc0c"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#a15aa444a844bc8f8670058816b9dcc0c">ore::data::BlackScholesBase::releaseMemory</a></div><div class="ttdeci">void releaseMemory() override</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00337">blackscholesbase.cpp:337</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_a22f414d57ba9b94e5696ae6fb61352a2"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#a22f414d57ba9b94e5696ae6fb61352a2">ore::data::BlackScholesBase::size</a></div><div class="ttdeci">Size size() const override</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00351">blackscholesbase.cpp:351</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_a31ea941e2c5742d1de925abc758a422e"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#a31ea941e2c5742d1de925abc758a422e">ore::data::BlackScholesBase::getIrIndexValue</a></div><div class="ttdeci">RandomVariable getIrIndexValue(const Size indexNo, const Date &amp;d, const Date &amp;fwd=Null&lt; Date &gt;()) const override</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00161">blackscholesbase.cpp:161</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_a32a74f796461167901dcb7df1c74cbba"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#a32a74f796461167901dcb7df1c74cbba">ore::data::BlackScholesBase::npv</a></div><div class="ttdeci">RandomVariable npv(const RandomVariable &amp;amount, const Date &amp;obsdate, const Filter &amp;filter, const boost::optional&lt; long &gt; &amp;memSlot, const RandomVariable &amp;addRegressor1, const RandomVariable &amp;addRegressor2) const override</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00227">blackscholesbase.cpp:227</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_a3430beef258b2f54144fc121011267e6"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#a3430beef258b2f54144fc121011267e6">ore::data::BlackScholesBase::getFxSpot</a></div><div class="ttdeci">Real getFxSpot(const Size idx) const override</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00225">blackscholesbase.cpp:225</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_a3e22290961d6b56dce069c1c4fda6386"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#a3e22290961d6b56dce069c1c4fda6386">ore::data::BlackScholesBase::referenceDate_</a></div><div class="ttdeci">Date referenceDate_</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8hpp_source.html#l00106">blackscholesbase.hpp:106</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_a5ce8b0af276b7c06ab424e688ae2d318"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#a5ce8b0af276b7c06ab424e688ae2d318">ore::data::BlackScholesBase::referenceDate</a></div><div class="ttdeci">const Date &amp; referenceDate() const override</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00107">blackscholesbase.cpp:107</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_a5dc20065794f26aa93ef3959071b3814"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#a5dc20065794f26aa93ef3959071b3814">ore::data::BlackScholesBase::storedRegressionModel_</a></div><div class="ttdeci">std::map&lt; long, std::tuple&lt; Array, Size, Matrix &gt; &gt; storedRegressionModel_</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8hpp_source.html#l00115">blackscholesbase.hpp:115</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_a5e67018fb05525c8b8a040d102e98564"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#a5e67018fb05525c8b8a040d102e98564">ore::data::BlackScholesBase::underlyingPathsTraining_</a></div><div class="ttdeci">std::map&lt; Date, std::vector&lt; RandomVariable &gt; &gt; underlyingPathsTraining_</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8hpp_source.html#l00111">blackscholesbase.hpp:111</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_a698c2421ff0b896c0388b6d6477cd7b6"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#a698c2421ff0b896c0388b6d6477cd7b6">ore::data::BlackScholesBase::getNumeraire</a></div><div class="ttdeci">RandomVariable getNumeraire(const Date &amp;s) const override</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00221">blackscholesbase.cpp:221</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_a7681fcd6d75035e16931f946f1b84fbc"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#a7681fcd6d75035e16931f946f1b84fbc">ore::data::BlackScholesBase::mcParams_</a></div><div class="ttdeci">const McParams mcParams_</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8hpp_source.html#l00102">blackscholesbase.hpp:102</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_a8d84524f3d537eadc02dbca5ec4826f5"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#a8d84524f3d537eadc02dbca5ec4826f5">ore::data::BlackScholesBase::underlyingPaths_</a></div><div class="ttdeci">std::map&lt; Date, std::vector&lt; RandomVariable &gt; &gt; underlyingPaths_</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8hpp_source.html#l00110">blackscholesbase.hpp:110</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_a9356ce4490b329fbfbad73fa28841898"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#a9356ce4490b329fbfbad73fa28841898">ore::data::BlackScholesBase::effectiveSimulationDates_</a></div><div class="ttdeci">std::set&lt; Date &gt; effectiveSimulationDates_</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8hpp_source.html#l00107">blackscholesbase.hpp:107</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_aa901a14e051e92c78560e640eda098ed"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#aa901a14e051e92c78560e640eda098ed">ore::data::BlackScholesBase::BlackScholesBase</a></div><div class="ttdeci">BlackScholesBase(const Size paths, const std::vector&lt; std::string &gt; &amp;currencies, const std::vector&lt; Handle&lt; YieldTermStructure &gt; &gt; &amp;curves, const std::vector&lt; Handle&lt; Quote &gt; &gt; &amp;fxSpots, const std::vector&lt; std::pair&lt; std::string, QuantLib::ext::shared_ptr&lt; InterestRateIndex &gt; &gt; &gt; &amp;irIndices, const std::vector&lt; std::pair&lt; std::string, QuantLib::ext::shared_ptr&lt; ZeroInflationIndex &gt; &gt; &gt; &amp;infIndices, const std::vector&lt; std::string &gt; &amp;indices, const std::vector&lt; std::string &gt; &amp;indexCurrencies, const Handle&lt; BlackScholesModelWrapper &gt; &amp;model, const std::map&lt; std::pair&lt; std::string, std::string &gt;, Handle&lt; QuantExt::CorrelationTermStructure &gt; &gt; &amp;correlations, const McParams &amp;mcParams, const std::set&lt; Date &gt; &amp;simulationDates, const IborFallbackConfig &amp;iborFallbackConfig)</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00047">blackscholesbase.cpp:47</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_aaf8a64586eb5db2781e2ba5c0597041f"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#aaf8a64586eb5db2781e2ba5c0597041f">ore::data::BlackScholesBase::fxSpots_</a></div><div class="ttdeci">const std::vector&lt; Handle&lt; Quote &gt; &gt; fxSpots_</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8hpp_source.html#l00099">blackscholesbase.hpp:99</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_ab695da1eaa09dc5436c91089c0888f59"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#ab695da1eaa09dc5436c91089c0888f59">ore::data::BlackScholesBase::model_</a></div><div class="ttdeci">const Handle&lt; BlackScholesModelWrapper &gt; model_</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8hpp_source.html#l00100">blackscholesbase.hpp:100</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_abb84774b08d6924094481e3ed5821a8d"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#abb84774b08d6924094481e3ed5821a8d">ore::data::BlackScholesBase::getDiscount</a></div><div class="ttdeci">RandomVariable getDiscount(const Size idx, const Date &amp;s, const Date &amp;t) const override</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00217">blackscholesbase.cpp:217</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_ac2531b45af9259f8b3af891fac9f5d03"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#ac2531b45af9259f8b3af891fac9f5d03">ore::data::BlackScholesBase::getIndexValue</a></div><div class="ttdeci">RandomVariable getIndexValue(const Size indexNo, const Date &amp;d, const Date &amp;fwd=Null&lt; Date &gt;()) const override</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00138">blackscholesbase.cpp:138</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_ac41c73ef8085aa5b72bf6009f56011ff"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#ac41c73ef8085aa5b72bf6009f56011ff">ore::data::BlackScholesBase::trainingSamples</a></div><div class="ttdeci">Size trainingSamples() const override</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00349">blackscholesbase.cpp:349</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_ad48a455c1a5496f2a02cd0640356b86b"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#ad48a455c1a5496f2a02cd0640356b86b">ore::data::BlackScholesBase::resetNPVMem</a></div><div class="ttdeci">void resetNPVMem() override</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00342">blackscholesbase.cpp:342</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_adda5ae6c670bdbb1857509a4aa20ec25"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#adda5ae6c670bdbb1857509a4aa20ec25">ore::data::BlackScholesBase::timeGrid_</a></div><div class="ttdeci">TimeGrid timeGrid_</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8hpp_source.html#l00108">blackscholesbase.hpp:108</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_adf22662f450d61eb77d17f2ea7f4376d"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#adf22662f450d61eb77d17f2ea7f4376d">ore::data::BlackScholesBase::toggleTrainingPaths</a></div><div class="ttdeci">void toggleTrainingPaths() const override</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00344">blackscholesbase.cpp:344</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_aeb5929f7ce6e2d52f420ca71b7caaae1"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#aeb5929f7ce6e2d52f420ca71b7caaae1">ore::data::BlackScholesBase::correlations_</a></div><div class="ttdeci">const std::map&lt; std::pair&lt; std::string, std::string &gt;, Handle&lt; QuantExt::CorrelationTermStructure &gt; &gt; correlations_</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8hpp_source.html#l00101">blackscholesbase.hpp:101</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_aec271be46c547c89cd27b4d9c811a37d"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#aec271be46c547c89cd27b4d9c811a37d">ore::data::BlackScholesBase::inTrainingPhase_</a></div><div class="ttdeci">bool inTrainingPhase_</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8hpp_source.html#l00112">blackscholesbase.hpp:112</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_aef2fa78219e2206833d4d8f63bf20a70"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#aef2fa78219e2206833d4d8f63bf20a70">ore::data::BlackScholesBase::fwdCompAvg</a></div><div class="ttdeci">RandomVariable fwdCompAvg(const bool isAvg, const std::string &amp;index, const Date &amp;obsdate, const Date &amp;start, const Date &amp;end, const Real spread, const Real gearing, const Integer lookback, const Natural rateCutoff, const Natural fixingDays, const bool includeSpread, const Real cap, const Real floor, const bool nakedOption, const bool localCapFloor) const override</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00187">blackscholesbase.cpp:187</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_af9092b7d1618dd9a9092dc9dae37ea75"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#af9092b7d1618dd9a9092dc9dae37ea75">ore::data::BlackScholesBase::curves_</a></div><div class="ttdeci">const std::vector&lt; Handle&lt; YieldTermStructure &gt; &gt; curves_</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8hpp_source.html#l00098">blackscholesbase.hpp:98</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_af9be63a7f055dbb0ed0fc95090d92e87"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#af9be63a7f055dbb0ed0fc95090d92e87">ore::data::BlackScholesBase::positionInTimeGrid_</a></div><div class="ttdeci">std::vector&lt; Size &gt; positionInTimeGrid_</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8hpp_source.html#l00109">blackscholesbase.hpp:109</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_black_scholes_base_html_afa6dbc82775f93a3bb6b225320c8e685"><div class="ttname"><a href="classore_1_1data_1_1_black_scholes_base.html#afa6dbc82775f93a3bb6b225320c8e685">ore::data::BlackScholesBase::getCorrelation</a></div><div class="ttdeci">Matrix getCorrelation() const</div><div class="ttdef"><b>Definition:</b> <a href="blackscholesbase_8cpp_source.html#l00087">blackscholesbase.cpp:87</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_ibor_fallback_config_html"><div class="ttname"><a href="classore_1_1data_1_1_ibor_fallback_config.html">ore::data::IborFallbackConfig</a></div><div class="ttdef"><b>Definition:</b> <a href="iborfallbackconfig_8hpp_source.html#l00031">iborfallbackconfig.hpp:31</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_index_info_html"><div class="ttname"><a href="classore_1_1data_1_1_index_info.html">ore::data::IndexInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="scripting_2utilities_8hpp_source.html#l00093">utilities.hpp:93</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_model_html_a6fead1da49affdddae755f95d693c4f3"><div class="ttname"><a href="classore_1_1data_1_1_model.html#a6fead1da49affdddae755f95d693c4f3">ore::data::Model::timeFromReference</a></div><div class="ttdeci">Real timeFromReference(const Date &amp;d) const</div><div class="ttdef"><b>Definition:</b> <a href="model_8hpp_source.html#l00092">model.hpp:92</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_model_html_a9edcd102946c4e3bd0bcdba2fc64e397"><div class="ttname"><a href="classore_1_1data_1_1_model.html#a9edcd102946c4e3bd0bcdba2fc64e397">ore::data::Model::size</a></div><div class="ttdeci">virtual Size size() const</div><div class="ttdef"><b>Definition:</b> <a href="model_8hpp_source.html#l00071">model.hpp:71</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_model_impl_html"><div class="ttname"><a href="classore_1_1data_1_1_model_impl.html">ore::data::ModelImpl</a></div><div class="ttdef"><b>Definition:</b> <a href="modelimpl_8hpp_source.html#l00044">modelimpl.hpp:44</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_model_impl_html_a14efd0665cded9d6785314f26306e91b"><div class="ttname"><a href="classore_1_1data_1_1_model_impl.html#a14efd0665cded9d6785314f26306e91b">ore::data::ModelImpl::currencies_</a></div><div class="ttdeci">const std::vector&lt; std::string &gt; currencies_</div><div class="ttdef"><b>Definition:</b> <a href="modelimpl_8hpp_source.html#l00107">modelimpl.hpp:107</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_model_impl_html_a4e8d617c4ada27621326891fa7fa009f"><div class="ttname"><a href="classore_1_1data_1_1_model_impl.html#a4e8d617c4ada27621326891fa7fa009f">ore::data::ModelImpl::infIndices_</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; IndexInfo, QuantLib::ext::shared_ptr&lt; ZeroInflationIndex &gt; &gt; &gt; infIndices_</div><div class="ttdef"><b>Definition:</b> <a href="modelimpl_8hpp_source.html#l00113">modelimpl.hpp:113</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_model_impl_html_a7033255d9f10aca8436bdf488964db70"><div class="ttname"><a href="classore_1_1data_1_1_model_impl.html#a7033255d9f10aca8436bdf488964db70">ore::data::ModelImpl::indices_</a></div><div class="ttdeci">std::vector&lt; IndexInfo &gt; indices_</div><div class="ttdef"><b>Definition:</b> <a href="modelimpl_8hpp_source.html#l00114">modelimpl.hpp:114</a></div></div>
<div class="ttc" id="aclassore_1_1data_1_1_model_impl_html_aa91202692df7316a0cee91b39edf9ff8"><div class="ttname"><a href="classore_1_1data_1_1_model_impl.html#aa91202692df7316a0cee91b39edf9ff8">ore::data::ModelImpl::irIndices_</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; IndexInfo, QuantLib::ext::shared_ptr&lt; InterestRateIndex &gt; &gt; &gt; irIndices_</div><div class="ttdef"><b>Definition:</b> <a href="modelimpl_8hpp_source.html#l00112">modelimpl.hpp:112</a></div></div>
<div class="ttc" id="acomputationgraphbuilder_8cpp_html_abd640cc39af07965a8475be310893006"><div class="ttname"><a href="computationgraphbuilder_8cpp.html#abd640cc39af07965a8475be310893006">filter</a></div><div class="ttdeci">SafeStack&lt; Filter &gt; filter</div><div class="ttdef"><b>Definition:</b> <a href="computationgraphbuilder_8cpp_source.html#l01477">computationgraphbuilder.cpp:1477</a></div></div>
<div class="ttc" id="acomputationgraphbuilder_8cpp_html_aed320df30b396f762682cba8e5e1b736"><div class="ttname"><a href="computationgraphbuilder_8cpp.html#aed320df30b396f762682cba8e5e1b736">model_</a></div><div class="ttdeci">const QuantLib::ext::shared_ptr&lt; ModelCG &gt; model_</div><div class="ttdef"><b>Definition:</b> <a href="computationgraphbuilder_8cpp_source.html#l01465">computationgraphbuilder.cpp:1465</a></div></div>
<div class="ttc" id="aindexparser_8hpp_html"><div class="ttname"><a href="indexparser_8hpp.html">indexparser.hpp</a></div><div class="ttdoc">Map text representations to QuantLib/QuantExt types.</div></div>
<div class="ttc" id="alog_8hpp_html_a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b"><div class="ttname"><a href="log_8hpp.html#a08cf33440c824c6fda734c566a726536a604ac82e88d7a367d4c2830411520c2b">data</a></div><div class="ttdeci">@ data</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00077">log.hpp:77</a></div></div>
<div class="ttc" id="alog_8hpp_html_a34c7c8cde9b91d2eee82d7b9a0b66fd5"><div class="ttname"><a href="log_8hpp.html#a34c7c8cde9b91d2eee82d7b9a0b66fd5">DLOG</a></div><div class="ttdeci">#define DLOG(text)</div><div class="ttdoc">Logging Macro (Level = Debug)</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00554">log.hpp:554</a></div></div>
<div class="ttc" id="alog_8hpp_html_af89b5b8c4f598a066ffe6eddd697a46d"><div class="ttname"><a href="log_8hpp.html#af89b5b8c4f598a066ffe6eddd697a46d">DLOGGERSTREAM</a></div><div class="ttdeci">#define DLOGGERSTREAM(text)</div><div class="ttdef"><b>Definition:</b> <a href="log_8hpp_source.html#l00632">log.hpp:632</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html"><div class="ttname"><a href="namespace_quant_ext.html">QuantExt</a></div></div>
<div class="ttc" id="anamespace_quant_ext_html_a548cb27798b6f38a502e71240377a255"><div class="ttname"><a href="../qle/namespace_quant_ext.html#a548cb27798b6f38a502e71240377a255">QuantExt::regressionCoefficients</a></div><div class="ttdeci">Array regressionCoefficients(RandomVariable r, const std::vector&lt; const RandomVariable * &gt; &amp;regressor, const std::vector&lt; std::function&lt; RandomVariable(const std::vector&lt; const RandomVariable * &gt; &amp;)&gt; &gt; &amp;basisFn, const Filter &amp;filter, const RandomVariableRegressionMethod regressionMethod, const std::string &amp;debugLabel)</div></div>
<div class="ttc" id="anamespace_quant_ext_html_a8c7149e5256e71f377e1810576ac6b4c"><div class="ttname"><a href="../qle/namespace_quant_ext.html#a8c7149e5256e71f377e1810576ac6b4c">QuantExt::expectation</a></div><div class="ttdeci">RandomVariable expectation(const RandomVariable &amp;r)</div></div>
<div class="ttc" id="anamespace_quant_ext_html_aa20ffa6fc84566f721a455a1bb72502b"><div class="ttname"><a href="../qle/namespace_quant_ext.html#aa20ffa6fc84566f721a455a1bb72502b">QuantExt::conditionalExpectation</a></div><div class="ttdeci">RandomVariable conditionalExpectation(const std::vector&lt; const RandomVariable * &gt; &amp;regressor, const std::vector&lt; std::function&lt; RandomVariable(const std::vector&lt; const RandomVariable * &gt; &amp;)&gt; &gt; &amp;basisFn, const Array &amp;coefficients)</div></div>
<div class="ttc" id="anamespace_quant_lib_html"><div class="ttname"><a href="namespace_quant_lib.html">QuantLib</a></div></div>
<div class="ttc" id="anamespaceore_1_1data_html_a86651dfeb5c18ee891f7a4734d8cf455"><div class="ttname"><a href="namespaceore_1_1data.html#a86651dfeb5c18ee891f7a4734d8cf455">ore::data::to_string</a></div><div class="ttdeci">std::string to_string(const LocationInfo &amp;l)</div><div class="ttdef"><b>Definition:</b> <a href="ast_8cpp_source.html#l00028">ast.cpp:28</a></div></div>
<div class="ttc" id="anamespaceore_html"><div class="ttname"><a href="namespaceore.html">ore</a></div><div class="ttdoc">Serializable Credit Default Swap.</div><div class="ttdef"><b>Definition:</b> <a href="namespaces_8docs.html_source#l00023">namespaces.docs:23</a></div></div>
<div class="ttc" id="aovernightindexedcoupon_8hpp_html"><div class="ttname"><a href="../qle/overnightindexedcoupon_8hpp.html">overnightindexedcoupon.hpp</a></div></div>
<div class="ttc" id="arandomvariablelsmbasissystem_8hpp_html"><div class="ttname"><a href="../qle/randomvariablelsmbasissystem_8hpp.html">randomvariablelsmbasissystem.hpp</a></div></div>
<div class="ttc" id="astruct_quant_ext_1_1_filter_html"><div class="ttname"><a href="../qle/struct_quant_ext_1_1_filter.html">QuantExt::Filter</a></div></div>
<div class="ttc" id="astruct_quant_ext_1_1_random_variable_html"><div class="ttname"><a href="../qle/struct_quant_ext_1_1_random_variable.html">QuantExt::RandomVariable</a></div></div>
<div class="ttc" id="astruct_quant_ext_1_1_random_variable_html_a6e0fdc031c26ed1d1a956019d2cee4a1"><div class="ttname"><a href="../qle/struct_quant_ext_1_1_random_variable.html#a6e0fdc031c26ed1d1a956019d2cee4a1">QuantExt::RandomVariable::deterministic</a></div><div class="ttdeci">bool deterministic() const</div></div>
<div class="ttc" id="astruct_quant_ext_1_1_random_variable_html_adaeda39d7b8cc716a40c4da65b00ba77"><div class="ttname"><a href="../qle/struct_quant_ext_1_1_random_variable.html#adaeda39d7b8cc716a40c4da65b00ba77">QuantExt::RandomVariable::initialised</a></div><div class="ttdeci">bool initialised() const</div></div>
<div class="ttc" id="astructore_1_1data_1_1_model_1_1_mc_params_html"><div class="ttname"><a href="structore_1_1data_1_1_model_1_1_mc_params.html">ore::data::Model::McParams</a></div><div class="ttdef"><b>Definition:</b> <a href="model_8hpp_source.html#l00049">model.hpp:49</a></div></div>
<div class="ttc" id="astructore_1_1data_1_1_model_1_1_mc_params_html_a150e9051900157f9eeb47db76a408ba8"><div class="ttname"><a href="structore_1_1data_1_1_model_1_1_mc_params.html#a150e9051900157f9eeb47db76a408ba8">ore::data::Model::McParams::trainingSamples</a></div><div class="ttdeci">Size trainingSamples</div><div class="ttdef"><b>Definition:</b> <a href="model_8hpp_source.html#l00053">model.hpp:53</a></div></div>
<div class="ttc" id="astructore_1_1data_1_1_model_1_1_mc_params_html_abecddfc422bbe23a7e3bbadc3cfc4077"><div class="ttname"><a href="structore_1_1data_1_1_model_1_1_mc_params.html#abecddfc422bbe23a7e3bbadc3cfc4077">ore::data::Model::McParams::regressionVarianceCutoff</a></div><div class="ttdeci">QuantLib::Real regressionVarianceCutoff</div><div class="ttdef"><b>Definition:</b> <a href="model_8hpp_source.html#l00061">model.hpp:61</a></div></div>
<div class="ttc" id="astructore_1_1data_1_1_model_1_1_mc_params_html_acd2409cd1ff4c11fd24593d0b4338c75"><div class="ttname"><a href="structore_1_1data_1_1_model_1_1_mc_params.html#acd2409cd1ff4c11fd24593d0b4338c75">ore::data::Model::McParams::regressionOrder</a></div><div class="ttdeci">Size regressionOrder</div><div class="ttdef"><b>Definition:</b> <a href="model_8hpp_source.html#l00057">model.hpp:57</a></div></div>
<div class="ttc" id="astructore_1_1data_1_1_model_1_1_mc_params_html_af47330752b982eb481cd9bf41e6444dc"><div class="ttname"><a href="structore_1_1data_1_1_model_1_1_mc_params.html#af47330752b982eb481cd9bf41e6444dc">ore::data::Model::McParams::polynomType</a></div><div class="ttdeci">QuantLib::LsmBasisSystem::PolynomialType polynomType</div><div class="ttdef"><b>Definition:</b> <a href="model_8hpp_source.html#l00058">model.hpp:58</a></div></div>
<div class="ttc" id="ato__string_8hpp_html"><div class="ttname"><a href="to__string_8hpp.html">to_string.hpp</a></div><div class="ttdoc">string conversion utilities</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.9.5
</small></address>
</body>
</html>
